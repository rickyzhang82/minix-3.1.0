%!PS-AdobeFont-1.1: LucidaSans-Typewriter 1.003
%%CreationDate: 1993 Dec 07 10:43:50

% Lucida is a registered trademark of Bigelow & Holmes Inc.

11 dict begin
/FontInfo 9 dict dup begin
/version (1.003) readonly def
/Notice ((c) 1991 Bigelow & Homes Inc. Pat. Des. 289,422. All Rights Reserved.) readonly def
/Notice ((c) 1991, 1992 by Y&Y Inc. All Rights Reserved.) readonly def
/FullName (Lucida Sans Typewriter) readonly def
/FamilyName (LucidaSansTypewriter) readonly def
/Weight (Medium) readonly def
/ItalicAngle 0 def
/isFixedPitch true def
/UnderlinePosition -100 def
/UnderlineThickness 50 def
end readonly def
/FontName /LucidaSans-Typewriter def
/PaintType 0 def
/FontType 1 def
/FontMatrix [0.001 0 0 0.001 0 0] readonly def
/Encoding StandardEncoding def
/FontBBox{-12 -205 618 928}readonly def
/UniqueID 5029009 def
currentdict end
currentfile eexec
80347982AB3942D930E069A70D0D48311D7190FA2D133A583138F76695558E7AE9348D37CAC665
1806D08527C1BB4A062A4835AC37784CC39AD8841404E438B4D52D3901E47A1DE4F7924E0FB3DA
F442499175BAB1226EDF692A4956739F8828E80592F450C5D5C22AC88BCFBE9748F61D18243A16
F4A4467F084E8E2BE46EF47FC51C3A8199E3CDA62FF9C4FB73956DAB8B6683D2156377808CB350
26073E80523F59A30D195FCF9B9FCE4FFAFFF195AA1C31AE164F9B6A929E4FF572FD5D100F7E72
C3258853BB8A8928B38669590B921E9AB5CD4D604AE6C1E4E917CFFB9D25B5FDEC06E29EBCCA01
F203B4FFF0D15FCC154910C3473B8BB1349848A84948348D5F7D1C8C99677E192540A106C2E5D7
C072044B1342A4A898D0E11A8BB05DF48BC18677E2EAC3D363200A81536405F42A3A155EB2A4CA
A64C1087E14DF889B0131468C586D2061A3BE7853A84DF2A3BF3C832449479673E63BD7E1BB396
D69DF396075092908B4757E7A3705E3CEDC3B5C75FB4F8960016BA8B91F6C9099D05FE6C775BA9
FF429651538051F8A1B563650D3538B81FE98AD2766390B28CA9871D7F38E207B0D3A1DF48A939
FA933463497A4CA8FDEF76F90C7BC2CB080C5C92F0312F323000741EC1B9F7F969C5FD5A04FE08
DAA9270F26ABF908CBF5C1B0484677CDED8400C34B4EFC4F4C573B39F4B7361ECE30C41AB0ADFF
0A721FE2A1379D8A296B17D18BFF613729B1FB5130CA7E1BF2740A49D5EE61E14DDD9AADA0BD35
88F6B87853AC946274DE848F36C6FCEB6CDC7BE1564677B6B5097E4022077DED0642BCE40B37EF
7193B7F185963855392F11614C7FDBF62DA70A31FE157650A77512879EF2BEAA85E59931948252
02238B78BE634DBB292635A47381D836AD137040CE30F549BD8CE6D91E8DD1E3B9F02ED9072FB5
85FA32F7CDA45F53651577228A42990D66835C3BA3B47A7102E94DD8ABC4FFA5877F9707B83D87
AEE2F5B83EABB347E8D3167260D31585B4ABAAAAFB96613347201166512A97137A47FEDF6A1C91
350559A6D458112EF1FA850FA4F1BD9D1711E5680100E99908F7213CD3030B8255F7C59CAE7B32
F29E2B53AA4C4E6B228026191AA17F75D36F7194C37E1B2EDE3B442965666F20F98CD6DD8CC10E
1231763E116AC107F38A21A7E646084C54C26ED1701649C5F3C80FF3CBC419EF43EC22A93679BD
2A6D8E70F039BA9D55448135414172CF93B9B43D1EE84E77FA872022C9926E6A00C6D1C574F104
3E73CB78D50FB37D61B7F461569A6AFBEE3C89C6233A1EF8D3A2AF4485E2D56F25317C7FBFB9FE
6E3EBD443EC5DA4E9885C5DB47923A66962F4AF9B1B62E646A5DBAF76F6C7355804E998F6ABA74
56AF8458162D424494E8BB2704EB37E84A81B0D976FBEA02720F60A740128149645BC6784423AB
9BDEA0A77828F74126ABC75A660FEDC531BD75FA864BAA25C90DE1E6F1EA2C15AB002038DEC79E
7271767EDE8532D31B84E6CFC4DB0935DC1CEB13FFACBB1528261DE12232992976806812CD8F00
B8CF4ACD3E62453DCD22155A37BABDE46B405B20ED68EE263AB4CC810775F55803AA22E6BD4618
D916A30EC708494799F4F226E1361F3621C2537BE50F85CD10CB2240B2E24C8585F36DE5D29693
3BABCDAD9841B483FD07F8412DFDB2D0FD2B8A0CDD91E2EB4E4511336EAD6A049847E3F119914C
043DFE6F770C564FD46B7101FFC01CBAD3BFB95517D8A2C45D0D60EA091889067710EC2A2783CB
50C493699F0E68263B143EE2582C96058D2B137DF1776FF22B51E30ADEC17ED5A614D678D087B2
31111D2A9DAC0C40AD4881E9A422773DE7329E539CCE3E101BE0FBA4EE2E4B7931575B1BD754F9
74A142800F1E823AA68A0F3DC32D9EE21691E324D582A909C79B817AB971AEC21B99C854DE530E
DD047A53B5B5960149F62F8B36645A49F666504F7F96041F93C927144A48493B209B320CC4B3F8
5C31BE5BB72245218ED830ACF5E525C0517C41D87CAEB7165CF35E7C2D23B2F5AFF639A51A814A
0408391729344BDC01A56736E64D147F54A0A9D2934E3209D4220BFEE5FE2B9D3886D8B4550D52
16A9A531CF62033929A89C9A06EF93B3D5EFEC7979EB05F5DE7AF64EAC98AFF7F36E4A678BD885
7D176C21D12BAFBA4892733F161A4A8960E4D2CDF70E0BC2CB702A2D9CCE6EB457E00D5AD68EEE
1DCC3161BFEB1508B1C760741CAC9A1BE851F740AF041A698E2D65CB581C266CE0F84E68279150
92D08D78DB2A32A8473ED908A1ACBB6A5ECBB2A80903B3EFEA6A43B924922D6E0ADB1F79860696
B5C0E5B08F88C9FF42A83F83EB72A4BD3BA72EAF7BF6A63D7D0904AEA98DF971B5A4D0AC102C2A
0A7E777E3A9742F8E59F11E158022077EC2068E4CA6309285E6199FA761EFF3FF401566060BC5F
4CC83DB3632F33B5AA4F881B0A885611C75B3B70A3C679036B9FCEC9F2DE7421A9AF6AB9F7B12A
F05A133EABCFF4B8ACF442FDA230138215D16785341C3038AE36CE13A306E080926688173C86C2
5B1C1FF05C752E150072EAEE9AA8671A3B3CB80BA601DC9F58C02BDB75C68441D7A87716A8DB6D
70B1A52B91FB3C6CE7BCA723C16C70D09C7E8F4576E077BBD5EEBD21F3B395F44297EE74CFC4B5
F743C497A77F962CFA87D31E239067AB6131371CD9722A559F7D50AF53DB5B0568F175FF0A0636
9E5301A9EE90AE2BA6F3D440DD7C786912D3EB3FBFA504BFAD15DE908F46B606AB184B74C17AB0
AF629CEADE877C33A577807E96D7DF59BCC4EE3526BB7CA3C763C186578D1281BF558A2461541F
1CBB1588430E8470CE5B643208DEF67DAFEF78D776AC0FCA3C34259900567CA3BE4149ABA57BBC
2A9EF57F22D4ECAEEDA15E4C0B9522FE08E41E08F97909EFB1115A948327DDAE0466FD76E80E99
AA9BC408158271C2C120073EB6F518818DA9095D6AEF9EDDDFC414C57A0CA9A7343568080DD258
8E0AC50B1646A5B53D80A56721E7C127296A7AE17B804EDA28954F5ED60ED96C42F7C9C1C5150D
5FB6515BDBFD0163C0304762A700C014F6C4969799FEF3389B792513D0898602104DF32A472D53
24A413D49A8806C74B5575D0D919F7CBF7F9008FEFDF722AAF10D7FB238085D136332060D218DD
9D8AE75F89A18C4B23451142DF6F826D66E131E405FFC3924923D86BBA7879DE3027020E8A8AF7
33008B2E8088B7B4224B0834B2512919FD997FD926D555625AD9B6A5F1C9E9783982B805B71A7E
2C5D19FAD2B290714A7C2CE47E02E012059CBD3F3E47B7FD9AAE535F8CE94B274F684F7A25628B
1BD5E021BE984446AB62E018FA4B37A9F14080FAA03FD51AE522AA36001488008ACCB27474500A
2EEBC765A9247D34DAB8DE5C4016018EED9BDB5C5D446E2482CDD6A3136B2FAB3D7E216F93B237
C3725008ED36ED10AAD15BC8FE38CDF68EF5F112CD43A1F8AED3FF19D582615B432EA4041DC498
644FB1EFB012F9B7A24C2F8B4CA02D2A15F9AFE86361B3981ECC46610BC92E4A55F0BE41EC6000
09B7DE1444AF1D6B40B11D1E2BB3F6CBF9F5125D501A7DDCE85B1BDC9AD9BA6BFFC8D0915EEC85
F2ADFCAA024EE914B38D84B5BD83C87603CB53975AA28149918623FDB154E15A9CB0F2962FCF5C
EADD6B6065E2B84E65683B9DA53DF277BD786656A92D57EAB3BA70F58CBFF25B54B3AC954A61EB
3101C8EAF896E0185EF17F073E954324A62F5EA10E8EE17151308D7F3513C3B977C67A6F1F36D7
94BFD3619D85AC01958C32B8A88FFCEBCBD888C26DD5D75DD3A221E783F104811222B521E0DBB1
1B2D1048E02928AF1181CA59297ECCED92338B42872374A4C45878CF5A9718ACFBA4E61A813EB2
DF6D3BACAC75EEC2CAE433F045912BE593C8E9A369DE63D518C4661F2C1F00F5F68C2EF939947D
456013DA0D80C5DAE5A460240A59F41143CA2A96BB93742DB47824F8FEA05484F934FC5F649E81
EC405D6BC89199C31592E5D0D73590E6DB20579BC82764F9CF5F5E881B862D51E77924D071739F
D160855B65F2280A4F1D302B9642BE9D08636CECF50EADECDC4AA006369B0894DF4303C0DAC203
E5ABCEE18467015016F20551D6097FBEDAF520E01AB7715786F88E1991B44E283E1C39F5385F6D
1A13C69A8CF941EACE3386CFBB2EE1B776718C67A669C5C0D31AE0B32F3A8098E11597E73B4175
782FB4889329A48FE151588535B7F72D3D8CA7AC85F4BED9CF38D3621169EFFE14A390B4C02815
32239B9036D8871F8D4C9A9DC5204C4B9FC20B045BEFC8FE20A0B7B1C955D00495C15766C28D52
63EE6311C0BFB769F38FBDA24BE7ADDE053145B44680ABB3AE0B7D4EB860969970B5B519ED5E42
DB7820D6A19F99307BCC946487B5315FCE66BAE2E54BD20610DCA53019DE8B515EFCA0CE4774F5
BC79310AB1A0CA93E74403A389525F00274C5894EB80010FD77EBB734907707E29C1E8ABE73575
002176C43C345A4CE85BAA397A7BCD51631D606DE89935C103AE7648CB4841905E7282EBA54DC3
D0B79729709355CED80225E5FEEB82B1DB705C712919055985244E721081E93DD213F7ED935418
51852A26A3AC2C6D9E1B121820B07EC27FF7E9453C0F4BBEEA6B8022E15C1E7FC33C664C84F1D0
6CF17B3612B2271775070860D775BDCC65E7DC255DFD7B5A812456A7EB28781609F3372D5B0F0B
6D94B78CA7C62597B48412177C647232859B4A9DA35AFD288E394CB723E9ABBD36D87089888901
AF6E8D76600829725313B117161F269CFBB14A160B46B9DE8FF0761209F7B2DD5F19C6325BECA6
FEB7AA638E1FC9D3AE6177FB0F7C6CADCB89159F718FEABABE586B41CE4DAD020647F744A7F5FF
2DAA17C26F0E1301D083164BE0FEF9D60CC2C66319D4135569113EAE174987C77EC433EA2B7B78
3D091DBE51DCDC4702722FC7049B30BEA7D0C1228965E28ECE1609F52157E2FFD2F465B4723525
7755C3F9A9962D95032B63E09FB9FD0D523DAA08998FFEF96184271B5329B8C5D047EB5983D50E
0068BE0D1DADDC22B8AC96B7E5E42BA1D12AF80061BD2148AE149C09FD325E3031B1820DBCD170
ED3178447D1C351BCCC4B1D6F3602661A6741AAEE55A15C0949E1DD9C993D0F88CD2DCA25E4981
109BDC5A3FD2FA92EA6EED8A3237EA523E544D09C97D232A6117459097758864DB287ED7C3E921
6C6E3FEC4A5C31C04277A591DC85376693B385737DCE6CFD27CE6E4251CBD7E97E91544738903B
27FFC04D5AE20B1012BC6E392496793C0113DC8E875EE132E776B339F1FB789B4A1A3EFD177266
F9D40E238F474F51FBD5CDF96165BDB5F673EF193D6421580FF43342309F94A3B516B3DEC92EEA
BE3A0529846B70B52791E18788899DD29DCABD656C19EF1102226E146E65D5D4B78B81AB91B8FE
016CE87307E5EB7257F45A0C8A40A15AACF4AF68968FB5B4605D03BCFF286F873666DE68281910
2296C3000871433CE9DC6334A22708A01655D3BB91875BB8F23841892935E5CF791E7B65FDBC05
771E09B28DFEF457E1A81040DA1301DD1F2FC5F417D0715546D5A01E346E319203EFEA677C8013
2C66E8CE92684C3A2E01605AB7A1F299C5A6082513A1FBE5830F6C19B94FB2BCC9F93B8144056D
FB906628EDA3540C0431EED16991479DF6727B5D4D32EF563D88555DDE7BDD8B83300D4B3D5D6C
81D8CDA03EE2870D1A241E77434B8ADF36E0CE6D8309496A59475093FFB833F202E6B6DCA3CABB
D68C3DC919A3E4EC0DFC31F4F95EED52EB825942D9DC5EF20BD9149A2C38A442068581F5DEAE47
E806219F20FEB4E228923910739BCBB7B58E32106B706FC526EAE0E03BC4625BECAF67CC05F3ED
092EF69FD4286AF10EC2CA2F5943F58907421D9170DC4C8D7F286C846D4C6864F867690DB8A5A6
615989B3C2B9C6F6B93BC081E9C5EA2948D98547E31355C541A300FC983609A56A91CE719F612C
1FB9BF360B17F927E9FD488CD86929E61EBBB4CA8E7CE6719DC72AB8CBAFCF9D503C4083CC9E01
23053FBDA18D0C4700263BEEEC6894EA45A20BA47912A67E46C970ED2577A546DDEDA497744752
46CD0E32A0945379F91D65A070E5963E4DED4374268A07F574E7E6E79D7317353B99CBEBEE9CDB
DFEA305C711FB0CF1A48ED66AEC764C3F3F82CCB1E2B0D587590EA1714E787C743496AC5EFB96C
B08B702D0E99395901457687C5485496B5E39996E811BC883383DA4847D0EA692AE9FA4966FC70
C46133E4A72CAEFEDAC8CF1DC3341F6D85FFAA800607CB8544B9FDE76E33FCC84573AA68C01B64
CD5DE1A5054F11DB94265D6FE331146DD1702D042722B99AF4AC49487135825DFBC313C313ECE0
138364A7F3D95BEAD409168A040F1AB890DAE0DF0F88CEFF0662802D43AE636D1E05C0BD477456
FAD7E2B067FCA66763DDF2B2F48C35FE6AFBF4FB94C71A090B1B22494C0E40CD02546524660E56
79D22CB569DC1FCF9800865DC4BE8054FF3B7141992CD3C43F4812EE52011BD1495A170AE9B9C5
0FF0B3B71A35F0381EDEB68C007BBB36CB9C9D84234580A229205DDDFDF5E64D14C16D40C0EDD7
B1810A488F43C469E927370EFC0670C8BE1AC737464BACDB6B2C731DC8CC153A072E2C908AE987
879C3D6EB1B9938D737F621B539F25F6F6E827382CF7DE633E657C0B728B0ED2F1A6748DA9E494
4D4CD89967D1FA8F4459670FB83B55D35F0B1E252851B97816B116603F8973B569993E907E466A
23B6FB210BAF37818744C23E82F081830259EDE57DDA652167EDFAA46EE27167845EAFA6E2EE04
9C31CFC7D3E3CC450CA873634B9F203CE5E3E1CBAF3A233872AE92C8DA42F94D8B3453B4962993
C186682FAE7D3707EC032283DBB107897AC64E7C36CCF0E56FF3BFC4E0A9C65CE4CEA2B42F39A4
F6A57C74B4300577850DF849DF24B0481AE7C76CD43D04B80A7CCCDB8E3600550243C7100237E9
AEA0126BD52C5B1CB73AE45BD48478C6EB2FEFAB9DF9A83C88353695286EA021BABF9B4887F370
9A46930FDF8905651138D70B5A472A67DDBBE343A54960B8F30BE92BF0FEE15CA238961550B391
D332809F59E58DFB2CE34FA60A8AA50B00DA8091362129DDC7735A63926A8F7E97DB69CE55FD92
8515BD2B49EE44E225687D167A0C37992C0173DB1A5122D7CF34315C82D9E4CE1231A28EE4ACFE
C38C5B0F5F60C94025DA4114121CF1F54BEB83375C50D77D1B4CA88BE0F359A42A97B1D5CFF784
4D33D511A43545D1437EA03BBE19D79BE26F65C99044C5321EE327C8B5C18B0A4BB6316426901F
9B8EFF2C94E12EEE1DC7DD131AD6B5E3CBD5A8715BD08B65A2AB8EDBA47DAA97BB30064F5613C9
2519E9B6B57AE188A83E5314BC4B7C8FBB1E65CE75ABA028161B0654763214F8C0517E104C1BA3
365A725416392313D023656DF547E668383E981FE0B47EE47E8AADE05E056E3CE11D8EE4ED6EA7
5509610E3FA72C8A114C91ED36C8E10F49AF79B58CC4DC4C2EE75FC406AB1145133035E272C7DE
4702AE746E696FED6CCE73E2D8EB5B2E5B76571D0EC223870F7F070708C3765504E4DA1FE4F0D2
65EC038612D0357AA0B7955FDDA48D4836FEBBBE883CC3ADFEBD9BEBADC1252572B5BDA920AF01
8FD0F0A4BF1784CF8CD1B3DF93F54EE9670CB20E15C4E175D0E7B7EDD9A23AEB4CAE31EC62440B
1131FBE36CD897F3635575AB613F0681F86BD54AA325587335EC4DFE96CBB83125DB1FC22F1632
48643C9BA4C18D791A6A02E445F0C1EA7A2984FFF475F77A816FBA783761E3DF373A0D67FBD746
F02B28B5FBF9A4111FAA90BF43C4B0CC735576A3A80768A37B53EF1C572E4F9E5034AF1D724F79
68CB67172C260C0978734894D9FEE4962C0253FF45A1D430BC811C4B6A3BDB41DBE14E7BF61325
3455B5CE94D280152ACB404A831686EDA6F73E08D1BD923D34015C5F719BF51DDEA94CBF1CDA88
A69B428FB80BCE5FBD4883F24D490420FC98AD264135807F094402DCEF720B3EA1E9DBBABFCC9A
8D7AF57B6B2947F7E8B10D3F9651658B7B1EE1894FD8F3E365A834BBFE1AE0BD7623279BCAEC50
F798DF73887F42C53190D650FD1F1C5BD06CD44B48860CD3CDB492E0327DD6F862906A05AEA32D
0A6353A729DFE4CFD51AF6101972D3005BC698C459CE627692C5B7742F4022F16939602EDABA26
FACB235A1C0EFC9C6950D7011BAE92C78A25865E129D9E81824B18B3EA9F2CC49D70F99FDBC426
090836F7D71384A60657FB7DEE4349CEA8646DC9AA31A76E974D32C325FDA6B72B3208F01FFCF8
76FC29D82C552F9B2B1C0A7240BCC2F5B0312AD679DA1DD3B9919629DDEAD61FBFF78DF1C5DB67
E8D113A2AB1B593B853584CACED175084AD759B80082AF87A678FD3FEDA9DFA1F3BF74DBE41591
E038E69AAE06F0A264CD9293B5DFD22BC301145E2AF7024FCD3AE5331C88BDC47634D25D072E3C
C40F4294CD918344A410F9629D11DF1EF5A2AF06229E7623E22644A504D3DB978B4AB30D65E8BE
2DF68581D03DFDC3592CB062A5DFDEE297CF5FFC53EB1DC823C945741929270938B68E1BBBB7CD
FA84083496A81E13BFBFCA2499E00D55F76CB8DBAC73F323AFE1FBAD876A9DD5F6B2FB20F32705
2CD97B53C402319ABADF7B5C0C25E29BB9948D624056B6C0E1438922E7E4D0FFCDB57C4AFC7125
23B1AB8DE52A597C863636AFE60FDEE42E80CB77926FDB919D159E08817292F39F0E70FA81978F
B4A84EDCC17CD081BC0E3B26BFE1A1C90734789D91D298B2F528EBA92EE9B1DC1D872E20E3DBF2
E48C3D102BFC521C5952AFDF8F3B2724636FB948BF5A32A44800CA86728AD6FE3A28E5A8AA88AF
21BCE92824A5FE0C350BC8DD45C179FC99D8EDE7C4E2E540BBECB5D4ECA4FCA61B9EB4931510A0
22433F3958913ABB171980B2293A228D39F2F44714C6BC608C74FDC38F30D7BBD035BC0D59DFF9
5C7E4DBB7051B624134E94C5256460A8B80B50266D4AE3197C792AC29A17D43687A380CD2C4CE3
3576F354C9249D12B06C6434B7EB010AF6CBC8A996502CD5CEB596B1DB59AEA6E9E574BB75EFB7
92C68E9AC4BB33B4CCA25C49E75BE532E70764B7D33815AD2BB426BA9016263DAFE484537D7D3B
BDBC8A993DA7E203796C89A7FB00A1CB1C2E6F20B999FC5B48DE08D7352C779E0BD6E738124508
859D6F20FE35550A1DF28FF2C2B2A0FEECA943F7E82A0E26998FB5F025F0D39BFA2B98503D6D02
24C9E7D172D2B59B15A1E4EA69E98981A6C78D5BA939D7EB72C26846E1B26CA6BC330678556195
F0C274C6813BB44E9FFFEE955E5C8C6E12EA000D9DC9403A9D27D62B9F08A88D03C328009EB84C
B337E9E3CEB50B16BD5C39A65B39C41EC8AB5BE869BF418C3265D240E692EDE50B6F4ACD869556
82E44F22C0BE7C8431A1400D8DA19CCC022100EE4313D44E310A33369ADDFAABC8A2DC1A877067
3E8F0F2D4A7C0645FF518B6EDF52516AAAF8209539DEFB283EDF8E7A9E37A9F24278740640A031
B0D7D7434898AA663FE729A7E26BB48BCAF3A970ECE76CA17664D78D07B3C3466DDB39D2AF51B7
662E1558939DA84CF608FD7C32FBEC38E8F54896E23CB21CDC8C7923B09EC9640755E713A78F61
B4B45A2FC07C1F06F9F4255C91EB5232A339CD63F75BCDF45EA035E2B96B47E47365245F960581
C5D97D51D13B78E3E359091A70747AF05FB337AF170C90FF30C007B6599C0DB5732CC430339269
0CB2FDFE033140604692F0D5A4E365D5A8EE1FBD32D2A53F446946521955D5DF87AE6E14AC1E8A
0693307715C8D894AC2434A96A7A4A973246738DE3311497A9B1942513AC5E9471AB02DB7BBA2E
74FC7D3E9129C801FDF493FDF1FF022E65AA75DE37ED4301EEACD5428B0993681BA64A7E36B5C7
4B38E5423FCD620D2EE4159078E3A58B332EAD5B9DE338AAD660ACC2B6950AEC2C3BDB289367D8
F9F7A9962D9551BD6969FC2553876104BE1BDF57ADFD6CDE5AD047F832F2F015AA1F99B38216CD
8BDDB3AB8183F205F37B97D4035FCAFEF1276231591B6C82587DAF42D7FBBEE606B6123F25A154
42287299DCA7A8A34F15BFCCD296D192CA8FD06C2437948FFB9C3F25B459EE494D5E546DD9C75D
CC0AAF4F4C76289AA899BC162119A7A0EF713217DA826CB9760C48C2914B98F00886CEA4CC5FC0
4C587BD2945A227E168B6AD9CE4C1362F852E4AB3F2E8739D9B79E45649C50FDFA6D65AE7B45A2
729DF2CFA6DEBB1C816B7A2065AC59E542F6823AAF429590FA1862B212CB122651F961F1A356DC
BCD1AF549A7751F4DB86A70884C73FA94FB82138308071A253BADBAF146BC004141F752F74D44D
5D7F55D58AE914F0BD8A2566A65C619F561835D9648BDE284B89AA8A53023C36389FDB6288FB2F
C218ED885306940C52FB774BDA7627AF008A3678B30914997B05B1C409C88A985F90F3FF7FE23D
1482B58618E5FD7936DBA63CC820650E5412E7D62B45452B3217B713B86D51E7446B0FF3469560
A28F2820853946F486DD17DFAA17C74003FA12DE3DD305CBA22D9A50EA35DB906F1A8217FD071A
B82458233ECEF214D288374C9BE83B037AD4FB633C634AA9F09B798D21D1B8DF90054A1B2B8857
86D77B1192DBE60FD32FF40410AD68539C133C354C6010048EA85BA346CF60EFF9EEFAD0108AE7
5BCEED3E10F286DB6FB7869C884E3138445C031743F8F86BEE3918A8A3980E56CA73608B61A2D9
8BA969D01049850D5EF412D278962F8C36B27ED6834B94F8EAAD50D7492E60426D47120B871A54
EF9A59EAE00F422682DD8B9A324707273C7F670BF986D3505066380E4475D590744F04E99E0985
7AD34EFD29B511EB2C785B20C5A674F7BF2E4ADC21144C4673F4F08155E3455DEB2942D9B43314
CF1061D82D85B3453D1E60DCC00F302E8CCE62EB03E30FFC68C9E35D3B133CF47B4C22357D66EA
9EF24A08E83CD01B49FB4A0F080439EC635FEAC1AAA7EB8F10DBB8F4A9BF589798682CD9C76D47
5A83EE38578ED97240ECA8CF3ABC86E9039C0648EDA0AC7A3DF5E9513305DC57E959959A4AB17A
36B2F5AB95ADA16426DBCCBA44222D08CC2D5001C93DA9CC80C4C64704C32723505DD8E010F210
5F71A7624556A5F99036767785D8D6CBE71B618EC534D0E0B6CDA8A05AC3DF8EFF71A34D62B568
5A347D35069848018BF071990E045DFE4B83B3CCAA03ED98745E79297EEC74FC6105A2BA13BD3C
3388F31F3D7DD671749538CD1F92D548E1E7A2E060E34D6C77583C6C84CB8D69121DEC579DADA9
B4CECD31983D50A8B43D83DA2EB087322C2F6D63113007E200132028654E7315AA91AE1EB41DAD
32B5433D0C180D728A8E06EF6D743206715208C5A23B3EAB4F2CAE378EC9F3FCD3CF21F1542F79
36C6BCCB6C5F62EE7D20738308410B7CD713B11288B8FD486184CB3E245D760972D1149AAFC010
1151590F83A3E0BA818F8DEE183D44F4B1BA5F1549C42E6F594BB6BD46F781E36195B970AEFB95
D97AA3C275F4C61B106ACF580D39A662FEE59C3928B14FFC8584AF74012EC28F815172B1DD7459
66AFE1EBC7D006CE7ADC4A71BB7A2C2EDEF03B3B4A5D261EB60E694DB0161196E3424B1B341076
FEB779EA7BD8587DEFF55B651240D62C5D9F5A12BB3B67429D7FC20A48F9CDF80750381B9AE9FF
392C73C12B85F4821DE8C1482CB2ED52888CE61A6CF714351718F041C825F4E057345CCD97D54F
654627A7EA321C68624C459AA3E24A44CC4A1888198F48D6A7713226AFE74934C528167BE92DA5
DADE309964F41B210EE50599A435E2C6B388B927D012700E796F64ED7E6BDAC411CD0E25528A3F
C0310AA3E2C2121BC38B1FD733953CDB98DD301484E45C9489B9366616817DD8979F9160F1B772
A28C3562262BC8B049036D04B95BB5F1371B51193B752E5DFF1ACFE48A2F2518A45AED8F144592
CB31B04FB714847A753C0EC1686981E54C960F610F7C33CA71BDA5C9F4DE0C08DC75E01BB4CDF5
14CE5F2FEECBC7547FB519F5CBC38A98288DA77C4E356BBAF79728A13A62DE1C8E615D1D62A084
8ECD5DF9DEA921993964B3FDE3B962E55CB5F3989C5422EDAEA23D7E015828A02AB1E4B5940EC1
4EBDF382EFA326989E70F9C787EB077BDEE3EC99D0285E8D773F0756065898A908C01C067C0C35
A0D16D4981577527DD768EA39010060BDFB4649BCCEC6B6180877BE87FE245E5754E59BC6BB1DB
BD93B74A96DB6272C25ED551C56CAC3F1F745325DF82949244F1DBA6B4EBB7610F3579133A755B
134BC1B1EE8FBBA2AF5001CF661ECFC2A91373C0F02B51999C0AA92C2709439B2FCEFB5162F08D
15174B2CA3DA9B51912A65E98028B2EFB8A9E10F441BEF3CB13A09BDDC84533BB4CBA1C2063269
89C0F2E8930176FAD49C78AAA0525D0E6075A07A3F39D31D9CD9AEBDA82C14766F19E92C33EFA0
EC50FE845BED28EB50F9DBE902DA3B0F74E24916B4215F0D926D80C6040804D161CE9A94C2C220
FE0BAF924C8C7E058853D2E6010752076C6CE09CEE7D657AD3442E43A81289BB710D97E29FB63B
8E6752B7748BBE757E8B0A3DCD949B6BBE93EF241A001741FD32ADEDD56CCA2EBAB10F31DDAC90
9947B298A8DB477CC5BB6BAB746160F0F55AFDB57A5160C84B6BC90A1406494CACD5C315425D8A
109AA335676C6F515DF429789EF40B50623DF66ACE39198F58301BE456A8B41252446382B83528
1694605880C8977AFEFDEA4E1F3668004EBF88634D0DC5A432FA8783A8151BF6C33A2B7EED5A80
6A4B32BFF45F611FB648547A9E6E6D70444EFC0211A2927672D790CA7284CEFF818499669D1644
0134ECAA5D6AAABFA5AFCBC5CEDFBE0C02F6263AF2C3D6EF7209CA72B6814C93EC17B226D568A2
B0DDA5B80038C8CDB3735FE6C331D9010BE8AFF004B255886D2D2288B8C0EFD09A5F355346FAF0
7EB49A280EC3825A9AA616B78CBE810D469E896AAFD5F6C067FF30C199A02D1FB433E2FB007B69
FE51F00F455021E4530956B56A334FA16D1C284129EBA2D3017C749552D78ABC252BAEE36519E7
2E35E55C1574706E4054FE6144FA5ADD33694633DE2552D2E4F4C4D4116051C8CED1E01D23F099
39226AE71B81C342ADDB52F2B5450F62A4BC7F698CEE716B7074E646C4F5BD3EC2AE6862E9CE85
010F4C0873E5ADD4F6020958BFDD0032DB6A554AB14F85D5E07634D734081993ACDA7077A7CC8C
4176DFC682D58AE0FA8708B6E9EF4813F4145FDD8ADE57AE8F97607B044F88A5F7678E9D457EDC
F479F004AFF3D3C261D453797AB1D678717C0D5F8840DA2B67C0E656D7D07B5245D5FDED44DE63
D56430DA5D2AF09F428DCADEFEC43718D9A6BDBB3E4192345308B3C816C0CAA79B6A688D15D078
D5F8BFCE1DB975D0B9E30332EA7C6E129C6DC71793D763E2B6B4DD8D4C08F8EDA4D5A130F02DD5
1553CF972B0EF9756DB691B6C73447051A7E20E184C86BB15A4F6DFA4B45BCA782F940BDDAD49A
D09A5B9923A0FE8349E48A8BDBFDD87917529AE502C1BC13587B1439BBD6F2A73F09F8934B4E5F
B733F0BC077781B985D557B97C1437B83D9104024BA8878735F64E3B5538873C51636A658FE150
EECB05A43B4A0113D2C8070A0FEFAF5DDD3DA0906A48CC0B2CD1517E9F586FCF5DD1F8997F1F11
5B15B10324E054ABD563B42B1F3A72D56E7245E8A435C3411D06DC0435DD87801566EB6A024BA9
EBACB893B85903CE125FE69740D4F744E61D694E7219DAD84211494D1AB8C8780B10AA90FF4734
A9857A254EA9FA9E314C36D55458E8183B9BF4B8FB539887B4E010264F9614C82B0B8FDFC3864D
C5C0BC6B84E18E19BA44A8ADF4215F38DCF7F5ADAF8965E2F932A11A367C609733F016220D781E
269940327EF297151D63DA444F604D9F9724D819337F5675D544D2E8E4CDA2346D7D5CAEC7DD34
3A8C0257CB19837EF8C2E77F96A3074E657ED05F42D3936829D7796A43E177C2C19F4BF8829382
1221154909DFCCFE498C9EFB1E14A9C1F7AD77B96202B092B040D9AE30A87FFAA34F88105EFF84
6F4F8EF7264DDDCE905EC7C843960220F10ADC59119D6D06B9D247C5461F8CBF681178CEFEEE32
3AE09F613B2522BAB825B333A70B901CDF8375C618C83E58B829229C2ABD03BF0AFDBCF8634ACC
60DAA587DA70F648D99CCAF73AB7DF09C537C2D1635C6B5FE35C5DB458FF06C59B644DFE250A12
D34DBC6C31BF89A11CE5485A773270859F3C488F2B60904908130C0A5E2F16CF62DCF3C12BE566
E2614237B8A5FAFE0C8AAE18B5184F2D6C98C1F0F165AE856A1743694C87C84ABD3D0F17B5E4FF
8DC1BD2D6CE94E5FB36F2899F1DDC548282992C3531FC51016C04359C7EFEA514920597EDB0964
996215AECC91DB25C3990578FAB7EF75D59BD78DEDBD06FD1AD8B4F8E575FBA2ED7B0DA4F026BD
A03BDF5BA7D8170C06F0EB9BB69AA2DB5783B745383F2E3996BCB25F2FD2063E127B75BBDD079B
859B37543003D02EE7B95400152A5F303D8363FF2095EF7CDF4F66AC11B30CDBAFB208B83B6B92
4371AFCE88290D376CFA4AB9C76D3E5AD057E03DCA5B6EA54A940F0017577993BC968A0B3527C3
0B18D027CA61B02E29E6AFC4F749359C7EF508F12461BB50C01F148A6298B124E77CD3C3BB7085
55AC18B12A801A74B3A5D1046FF37D7362D2AFB4FD9DE499985C375A8BD28F341E2FC27BF18CB3
E359B03123D70B74017FF0DBCD3653656570C7B80E515C458F353FA8EB9CC191F41E50D5FF59BE
EF3164DE3C4AE2799E95DE6B3E6FED2D959433054E64D5FD92D712CEAFB788B6F5A8DFE7E2A0A6
E48CC2F2F69B853EF7A18B42C682909D4E1146A4A7B95116411230D30780E2348230325CC710D5
17CCA422A59077335D45DD6BD5736F4D749BBF4E406452196D47AC032F6C4FCA712F237C536791
63966D9F4F4ADA45F06DA077A06681B8B539CDBC773B810F0E02642F9E495520F7950CB9C45C46
1BF70409FDE1871213CC9F1546C39ACC71E36001F06A2A181CCBA3C2C55DC076C493D6FAC14BFB
FEC84C3E12C5E198052C2B9A49A66D20457382C89149A598EEF9339FCE2CDBBD9AF29BAAC26413
6EE3E44B4EEDC87C881610C05A5582C448FB93CA91712A3076B54257908448CC71CB7227643A9A
96DF4C7D9B8A0D996A19A0E11EF80828A0090BF2654326217B8D7F990EC76CCD6D720CBE9FA5E8
EAC40E49D43481E6BED53D07FC9A6FAEEE5CC8CE3A0A029E81A98257B6D38E40A3C451AC155D28
A6FDAD25B05BCC64D9FED3C5CA600CEBF0FECA2AD224705F35B178E653420C638CA892AF01C12A
45A1EA9B032E87FAC7A3F8A69958D3F39D90363A846FCB4375A3BF0DEFE9A9672EFD9CFCA3CC09
11E6F06DE7E102BA0A0B8EC32B3EDA3286C24B9DFD7C43844D8D3D0B92115191AFEC6B1BA5FA21
BD14D2280A834DD8A50AB94815712F6D59397F6F8F6D63F2E5B6FB7CEBBCDB865CCF09C372A403
CE102BB0A90859EC9F4AAD5D99C71CC96D71D358EC06FC69CE829469CABBA887A42E46DD7BDB6B
E0E1D67E2E93AA7B4D9FC75AD4EB0765746649DD8B6A3B4FD16E5E2CA44B292BDC69811373F019
B85F2F890240DBC2F791AD2698117D472AB3BD118225B88AA181575F8C1C7E7481279C1107F325
4D0798B31C4EDABF0E432050F7067FE95DDC9DF01E05300BCCA6788A88289D543023A09D020C64
2D65F22D1FAD2C14228E0D595227A090B3F82A5CE118F608FD187E5F13B1E9F1CB54CA1341B982
92C762EF6E1E52810AE05E8554B5CA4D87675FD683289CA82B0CBD708C90FD94C8E9B3A3214BC0
856C98CAD6F9F3B56214AD55170C0A3A4219B91B0A0C801E84D5F56B97B853EA74D9B58BD57EEC
C17FD28FE0AEA9117AB7D2F1A5FBD75F727A9D100986BCAB0927738CF220F0CE18399A542C56D3
C0BD12F8F246004618A86E9E18DD7FADCDB8404E02AE6404EF073C1FE34543399F4772CD6E22D5
714DB9C2CCE15C2E2CBCCC9A68265EA3A32721605C53A4C306DBACD8A779D9A0DF8A1926F8E42E
2CDB1F46C31FB412F98D9808972DF4002FD65D7F5B96B314004AE6B6B709EFA2E6A49B1C31BA55
0A10DD1945B136F921EC17E21F3C9D6815375925E8EEEFD8FD7C2F15D7194A834DF35A35BE8B24
BB45B3952D93235376D10391D5E58730040D5B253830F3E655222B09C3E3A664D5794B04E635C1
0BFDD36F18DDEDB17E51F800AC25F05965C8707D2933403E9FE4AB48360E419002114F9CEF75D3
EB54286C7F00B684E5FFA031AD012B8E0DAB9447F78BE250CFF72D11E24BFE1264FA4B71D6BA4D
F7CB1385BB1D1C6EF00AF8282030ABFBF29DE78B1916A44717EE583DB2C84059C7CCAAB49BE02C
30D53FF768C8F231C9D5C8772E0FBC9A7A1536D7F5D4888E944D0BCB958DC530FDCD04F2207AE6
3DF8E6DDFAC7C9D0369F0BEE2F4F9795B41D5BD7EC7692EEDA3E1A8A0453A0B40DE0BB9FAA328A
73550C63E27D38F64DAA400CA3C81E2578C1CC3BB055BDD49B22B52B88593497F1B6DBC999CB1C
327BE56E059621C8BFD536F310E03873E81B5895FC68C4A0C72FCB98B8A98CC122635A81130683
0400547A90A05A7327609240F35D8790B922621BEFF076D6E647AFC9032EA1953C90A9A9D11BD3
64E9D87543FF80E34C200820F7F8BB68EAA09B633888CC422C929A1FCA49B0C8393BE700519D46
65D21D7BCC4EC8510C41F5CC8689A010BD296695A51D21311DA3870A51495C3D9A13813ABDC188
23B1769AF5CFEED3A8392558BEC27D969A221BDA4D144CC3932A6802BDED7B25CEA53BF95C4A72
FCD47372755B37DC6CF5AFD06277E76609AA469DE57D466FEE4E715D1AC66F64CF9DB8D05BCD18
59B5DC1DAF729B383164CB053BF7E4C4D493BCF44D99CF208733DBDAE346BA78FEBA77D0B17A2D
ACC1DE0F39A8775AAAD9801C8418FADA320FED9E65A49C36772B2DBF7D71CD102746D59E7725D3
7BEA820C5D6305310C5CD7A50F39E18E137D4B6B1EE220F169C1FCEF8A98C4CED943B281247AE0
8D386ADADA8CCE9336D87BC5E7D692C2841AF112286AD49D5EF79B986ED45430BC405521BD830F
F16615BE70784CD01B0618A1853F5E9A88D04E51D4AC23EAB78BF4F85E47CD4DB133029413C186
44944BCDC34A24640B771499B40638F78E5B623DAC344E749FFFDD9290AD0F7BE9C685AD0907B6
E4AA05F33873352D9DB2EB0915F113725A14BDDA96967C87A23E2A6275B455F253B97D75C6713C
F009F1E418C6E884721FEACD3A6CFE38F0864D679FAA2B2C31709BD0801A99334667C825E67660
C12BD8CA5C572DC3722824F9E25A1B1812CAB1406325974AF78D670C8F2807103D541C59C5F2E0
6234089015F8FD6FBFBEB35D75AE47CB5041AD85E67218D00A8179530FED513183C62BCE29DA93
F3F3D70B25B14DDCEDEA1F2F48248311955E29412FCAE9DB44E395FF396A7A06D5A943044618C2
842722E872376FB6E4BDE34155096DD1711ECEE313725726D719EF982730D17DA8F26BB14DE038
4F0FC0D9EE37460BDFB6D9C8386FA60FFD86903F26C397062111986DFFDF147AB56704B467AC7C
7561B372C8ABB68339E951A9E87F8546B221E1246155521FC4A48CE4F84A28072BE14AA4319FB6
423AE21D46E0C186BEE518ED3C1621818C00B20202B177FACA5D2A85BC7447E00332F11260DAB9
CD96BF6A11C5D4A09A9F263C1F6C6699B1CB3CDC59F2F4B2CF6E525F9A010828738C9DF39BDC85
99964AEE155ACE538B8F6BF722EC89DA93206D462D776DF245B3321F89F4E46890C007C7E333AE
CAF4DBD225E8FD258A0450837BCEF402753457BCE9067C05185AC346F5E44EDD0B68637C237FB7
B1C2F4C75F507DDCD66E7E101093E44898F41BEEC8B9BC48D0DCEB874C15BED8B25368FD484C5D
FB8B6BC4FA6786945230DF8043EAA343B6BE8FA132D41359B43A4F60F2C983B2B4D906EC2D5ED2
C2696C67D08E52D0E1798C4AF43B9B2763BC2BF12039F72EF27FD80DE60D92EBE9CBC1A3E8163F
5CE2C00915E43A5C83496F45615D9381F68DD0D098273BFBFC7629CCD3A4A7AE1D11A486557C9D
B608C1782CDF3BCD87E2EE66F7468F4251692A871F3057E862661E815A6DBDA226985D9FEC11A8
591304B1B18DBCC74013988E9D3B93D5FFAF27381DDBD216ADF278E5B71575CC2BDD17E907A23E
19445A306D30E8FA8CE1DA8944597EB3950AA88453D3DB6A4CA02A93633AC02FB1A7745EDD01A6
22AAF9B5415838D133E6F80163B097AFA4AB0E9182DD78A457566804D399118404EA8A9499FF2C
D1EEC42B3F281B15391F3B310A99F4F9164D622F8842F3F963C5472CFE321717C4D33C2C819951
701163CB605B9046561A6FBE2502527618DB66AF43AC1327ECF117F3E85D6CE81A8DBF43B28B68
D745BE0BCE958C004B04F78B82C480FF101857B92D4B9E9815E7C355E9AA3DE5C39CA54A209C4D
CA9C21C9BCBFA0749214787D7C247B7FC748959DDAC2F640C24D33BB37EFFB4DF28CD65750C125
8E70CAC3B3C36A200899112179C297B946A568757F36F7CB774570C85B349BB139F784BDD3C920
F86E8DA4B788D205772D2B62F7477BE13FA0E9610B238335A67954716B4909907D20F0CFE6196D
857FDE7A44F39312B316030838D02A36EBCF8B870391EE40FB292AEDDC9DEED63BCF0C8409E252
A173AE07D9A611D4141840CDCA032D6AE8E83A820423D15FB4F63998B376B7F50186A4869F8E38
4B37F73ABD480EFCF4A583F8A5875941602FE5C7D896777D7A0AF8E3F1C562DF8BC838B7017A6B
47E13FB3FBBDBEF6BB53A405F077FF283CEBB69401B418EE4576D4229329DA34D892A7B79CB624
7C3093FF086361A54244449478FD24EDFF753174283BD2D23B04A43A539DFDA813783A2673EAD3
94DC1C7BA99521E111D2E110614CB4BE1239F953ABAAC0700882F1617E0D489F1CE93F5A48F5E1
54095EE460866CE774D5814B0A8619DF648F48D47D9BA23D38DAB204C1EBDE97B71724A22A7841
DB447BE695A3AA9388AE8D1758EB235E941312EEBB7A7C07D2AB10850A4389BB5545AF0A0DA374
DD3C0DD99647805AAD730FBEA3887E926B517134D1080159B4D8DCAB9C172B56E759EBAE0A46C3
BE2FD8F5754D8AB7182A54FBFC44D3584DB57252560FE95BCE466B3E218D239C6E06F05DFDF4FE
8568EBEF0228FAB2FBC6FD0F8685D229375F308643D36B73A300D7E8756A1F8AD9472A37C0ACD3
7E3040A2AFE716C1755407D4B906170C85D489EA734296E0FB7B7ACA211FA5EAE56B74A41BE5F9
5997AD6413317C0AAA8D173240D337B32A7135FFD717545238D54ABCD1F944477CCA6D6028C6FB
5A6A737B7C1AAA39C69090BC2A53794D68B4AF866EBF33856ED2E8B0DF3BA0A09777001F471D71
81B05063794FC89EDDAE2A68C085ABD09786DCFD6743F15127B2D5ADEFD7EBE51E0486F07E9429
400955A45929834C76A786E00C04DDEDEB5C1B76128E9068A1AEAE4698BE63C0E395FD18826E6C
CDFB8C213FD1F829314043E93E5651677615C08AC37731FC55C21CD07720D3E121E909BDC9C4A5
EFD4C68372C583F526FB89F9143D19AF9D69053BFD270B8716CAB06174F57A51CADBB715510C5E
044E7E320531505158A5D576E223018D84C3D7269C9938AA60B0D170877A8B40D12EEBBFA13F17
6152ED8EF28523FFCDB41B39B5FA1D15ED76CDBE81C4275DD0FCF5ECE65CF6AFF600535777C62B
44E6EDA97600D0E1BE18AE3E783AC4FDFCAF3E4EDD6F64509C2CC6F52241187836FC6855BAC176
7C17E51846461598E6FF50E5D83B836C045313D0B05D2255030D6D8ACAC59E8D19112ED35D9090
7315A4337C24F2B37732DA72E5434213E401D199F6D522B631B2F41A5957A83C1E3AFA22BCAE28
F96E28102CF54473EBE69B91C5AE89FAFC7599357EADE06FBA3FDB22C05585981DB1DE82015B55
68A96CFFB401C19697B7211620097FEDE0ACC60197CE35BBE8F702C237EE6323D8042AB0D6EBCC
95D15296AE877D4F1381F0F5905FA3E89DD29FAB61F3946922D8B35ED0B4B72E1DD48E10801D82
4AE57BA03A658F4884915D0019CC5FEE2CC608AB01148C16CDC9FA5882AAF57683F36B9B5A6DF1
13405088DE6103CFE4383EDC9867788BAAF26696F6557A073E3DE77CD28C3E27164EDA87EF315A
4F5B7B40FFD2323928C7D2650BB39A7ADA11DF5939B82835DA765D1B0A748B0EE387DEB549DC86
7CB2CCDB3280870BA08E81BF592314B5F82D8546A4034D5640A04743C9161FB84E0CA3BE45833D
8944D539D0B36D279DFC5845C66514D4B2D7D2156A4AF72A091379F3666A93B786DC1BB81C997A
34F0299F67EC943D095FC4C602EE580A4F8911C6E972A70BBFB9BC654F46111333AA1B5C541CD6
44BA9858AFE25F6209D3B71A64D9C9B3ECBDC79DC58732FC534C4CF670096D9B093F654B13493F
0396E0136837AFCE1483829B30A1B3C119BB3091E4E22CB40E7E5E80C6A37A33FDE00EC668988A
09EF9DE214CB72A03C0518CD274E694B611C33C0532769C8A54735953514626EF4111E74504612
57BA5CE74AA8758F795644DC7C4824ECE4FF0B04745F72B31B14A999961D6646FEECC62D4CC32E
9C829616A5D3E557F3C3BA0C07C384625B66B28D62465BF56A7361E0136722FA532EFBD55EDABF
443FDE0F534897C62F65A7F6072CC9469CCE92AC1C7A453DECE5D1EC9A49DD9FC3676BCFD905CE
7AED294C1628B900D02BFD67FF36F0F7E093BE743C40851D9F555A4D9769107E9BAA74DD77F49E
2F267F3B1CE16365B95ECF58491A78C38889D8EA183B2A46B5A5A9F7CB2C92E6853C32814BCBCC
87DC59E472A974EAF549841C90A6177120E9B88BD46619F82888737A264F60F42EB160A9D02769
5BF7BF633E311B69B953A925277862954881EF4D2DEF6FEBD17CFF70A22A3E42E9FA7F2488550F
A654243BFFCC031BD954905626095855BC4AE6DADE90AF2D16B9EC3C942428065E707A0EF65C32
2A03C9AE3AB46DD85938C19D1628F91DD016AE574637DCFE1F323ABC2A3810ED8E398C3C7940F1
36CD20B270F52B94E51631A87C3325857A005BDD3D60A0D6E7CE191187D6F3E6D1B99F489E800D
A18CD5180FA5BA082F71E69F292E870FF74B6228BE9DF6EE24CF5DA97EFE2DA4B58FB08F5B08D3
46F34D0996E2C14E991E8312BB9D0839F361C6487E62E4130912B4E2CC9EF0870E5323E3FD0CC9
9A89079D2C5A3A13D373DDC02A978CF60F127E4699A465BD531EBD6CDAE38EF80B06327CD5C6DF
EC55D74B38AD5CE7A57BA6944E0B3970ADA9F7C4986BBA65FB0C65A44E6D46FC7975339273165A
C3044B36EA90D02260ABADB4BBC814EE0D790E2D9B3CE1F9DE5FBD0E919EC87E17CBBE01AE9DBF
B229F2FABEF668CC8AA7E603CCEA85CD4EAD276848919BE1FA01AB638C9E1071DA42CA17BFC2F1
887B0E45162F159A6178C4ECDD80D6B44FC6AD617FE55E474677D4F2CFCBD97917DB0F544E41D2
DEC35CAFE5E3595D6B2ED09CDF4B045766BC62EE0EE914F9F2778C152D23878EC16A4B814DDF4A
883818DC1D44FC8973496B6037FCE8E4A731DAC9A4F9268980703296D04AC9A53EAB3BF5ED7455
CC32C6C208DB744089101E0236525E217B70C03705B953F68811D2CB7464D6165CCE30EA5E767B
B3698643F13375A4130BF5E97FCCDF7BFF99CDB4F39CDEEAF81A080C288A2CA5D361BF168343AB
03D36CEBE860841C37EF52DF82A43882C9570256DA290A0CF749C6C7CE93DAB3531F00E8BEA53E
15B1110D5A734B1495D11341B4FD68BA619FFF2DA63C6242DB22560026055DF454C8A814C03934
9E525BD852E006B9B7668EEC5F4AEE12B44EB2DC26033B92892DFA7347075BD60560328028C9EB
6EFB146C4F8196812DEF47353337502C4098B90A3DAD5A280671B6FABC5F65B54DB02D45D29595
778209CEA884D7C56CC028BCFE3C7A3392053D9F063D7D2DF78599329DB13EBA49211D32840FF2
31C379825E3BB9627654DF612A0535CD81498961ADAC6BEC414DCA2E21BBBEB447E5C6B1A157F2
85BA680FFC83F042ABF78BB438CC97B3F50A28137C99F5D7BFB0D7479FA9584A90BEC374B5FEA7
AF96B49C5ED5A26E81BFB27F2B4DF36445FE422019BFDA71349B9AF421FE2F682949035999D079
6FFCBA7181C3309059401E011BA660B5680AB60D5D1F7386E10BB72FF3A147AEC947C35872511A
E673BBE88963B56C3C0FA1B0FFE1B8A33D12ED714FD9595481FED55AFFF3057FDADE75E42F3C00
79B50404C980FFD51596795AAD2DAA665E836EA1163031D964B3C118FF934B8987D36F909FF64A
2A9A7CEAE9EE69E17921B77A1494034F3A6840C94957A7C1A7E23F393BE569F8ED7CCC23781128
07F23F8CCCF87B73927D35FD956582CE4CCD1108CC79641822240872F79A115F6D33ABEDE36E28
5757F0D921639A6F24F0206A8382ED126EA7C8979506DD0D1E4514ECF586AF9BF3D5E10E30DEF9
97429D261204D4961180FA62EB145C91EBE47EE3F5C884152D1F61F4D70D7CDADE3CECC993000A
D523A71BBA4393A06C543F12E1156AFD5D65AC954BA9937B87F1F7C9B96C7D4798EDEFDB1FB05B
E7FF94F96FE5BE338C15F9EF6098819CB5802FDB3E72EF67EAEE7856DAC816DB5DBE6BF3FD0111
D282428650C5932B10B6BE12361F69E8F4688193CA93970B92627434422578CC4003F81F5387DD
733DBA53AA585E23C7A20FFE149D68A4D639EA12C831FA47061C1A89384321FF047D3A64A28933
23E2D43C6D0416F19A79BE56DF5C2041C3292F2392399B1DE67A2BDC9028D7671366940D5E5B8B
5D007C8B3D53CA44332A2ADFA05800A77C0B1DF4BEFCFC874DF5B9D57AE882A4989944C032BA40
F2A1D1B9220C6F061075D605EA700BD6A891F6BD64230839B355B58A1892641B78DB9E0F1141D4
2422AA341FB68C7FC90B57695DA8A64DDFE8D8B4E44E4CD131279D2E0962D19010BFCBCAC566A0
8EBDB99E39F64D54C07DABD00F3D328CC5C65D196A8BC8AD6255DD3A33E1146EDD911C654D3189
ACF60C190D1CC5E799D645C774F879BE91B76508D99197B8A60254054A68353D2893790CE0D11B
70F5BDFB0A775CF879AA9EDBDBFAC2131A8DB2A24C1F3412579A7A37148C97814835B174C92F72
AE56EA550DEF367F83FE50EA54CE3A0B5F7B79B35332D04EA2A94F02D45F5C0B0C76519C25E20E
B7E245B71F68B86CCB20B3A6B755AAEB6DB0614DC6F6A94E94B439D67A6427448C85B336E258C4
7E26498B1F31EB989BF6562630AF6C6A7E46BB2962BEAA8E95685BFE76E43050AC70C18521E680
3CE9DF184985FADB3DD13BD42769801F43A0DF483F3EE980569B2806F421455D96E1E6C0191A93
92CC3DBAF35615BC2ADDB5359B8326E0704457841C7330798FF80A756845A729E38E4FF92FE39B
D2A5A30D767CE603850474EC24E42E654FDE170686157167566F4C4371C30C556933CD3591CD03
E744829CEE4E16758C4C50A7E9ACA1C415A04247353B89BF6696AB6ED79C92FA2B8028A3B8D574
7F07A38D5AEAF2566266A8D0E14392A61D6590428FAEDE28C9C547D29572A5BC0F4DB8AFEB8F64
5B710B94C1DA6218DE06B2AF35ABA9CD313085AAFE9696029FF62149AE8B443D7FA405130E407A
8E003B4B1E1CCC3601240341AB7DA66FD3980FAB563A511F684F61DFA210A358E19C644C00BCD2
19190FB506A069CD49EB4131BC27BFA3D8A1E0B2E5957D84AA0947638F157DC432ADCF45C95338
69455A09B06DC7F5E762FEE8B42F0740B07697CC74E335B7A8E9EAC55A4134B1EEECE4DEEB00C2
8534C68F84A99A57AB811A48285556EE8C1CD8E172B6C664474CE910E43160B5C94B377890FC2F
98B3C11A4D610AB6C482662BE303A2CA61B78430040B2BE4FEAC3358EE74FEA12A10BF9963013B
DC4B9A5EF1D79E6F3B3079D3EE5984098532DDBFD9C8765403B3F470D14025925AF74292828555
62EA17C547699028442CC6FD6527961208438078AEA6C9A2FB733E2C72AFCDA26CFA1B4CE6E646
4BB15A2715CA8F809831A23ABCA866604814525B20AD472111B682078FCB1D960C5E375855E9C1
D80651D14399737DE2D38F48D09D337A02C64E9EB9A1C0E23D690CE6E9258EE14EFF596A958699
DD810DC8B222883D43F7869A8E213740E162ECC2783904487CBF3A3C97C56C4AEE84E8533271D0
2F896B8EB751F542ED1D2983226BB3E57CDEB4AB5567B1432BF7BEA1F8F7894FC682EEF187AD81
B3039FB86F145A50988D4DFEF875B2C5DC4E49482B8EF771EB5BC54851A73D7B56E9DE49ABF01D
583D6ACFF6477AD40F2ACA0FBDBFA6A40067A3222ECCAE1303B4690B5A1407102DE47AF40222AB
459C4EAC55C9BDEEAC5F8DA0D654BA0A234D3C41154CC17DEA99B5106B0F9AB27B278FF7FDDC96
B1F168893E2012001B7E593C5AA6D8F3F9D35EED9A5FFDE0020CFE52C05282EF07A948EFCAC993
3847F09F065CBC2CBE94B941757AA94226BD5A8C91B2EE4D8B3CBADA7218C21F7F729D66C7F510
5AE36A75C545582C25B9B1802CA9B2EA745255B52D47EA2FD9C24FB97A7283BD50A9CC03AA1AD6
2A8A02765D74858B964FA2FADC2A2BC486E29644E42D508992CB4E872C6ABF33C64631BD6CF58A
C5439124920B901CC163DB5F612E42B4707869BAD07633538468173D4C9DD48C1AF8C92EE1997B
C51A2FAB8FE50338D4749C4359702692A4AFA55526FD413BEE9DB5AF4CB7D7828A80636F7FA06D
29CFFD5B04C977DB4271B523D1E741CAD63FC362A2202BF69519C4902A8F40C1AB648E17122DC5
E03D0BD34E138A7E8EB55889504CB628B0EB62329CB20BA119F8C17FAED74BA7674E61032B06E0
002770A09F752D2E70EAFF01D45E7C59B21DF3DD19F4118431AF7D25753FC58A03CD1D1EF0FFDD
52C3ED6A1D4A0262106CB73E68690A0C8E4A8DDAED8B69E2BF4D65BAAA8C0312B6768123B47EB1
AC65E4E194695F7BC3BA514909848DD02B00401DCBAA5F0F0380874E762BD8DD3ADC9A3C2044B3
B67B91FF7E5B1DDD2F6FCD0D3437B9400602A1767E6E5838592697B146CDE3596DA1FF9DE0B105
6B24A875D5BD44A0676B04F32DB385EA594FEF43DFA0932B45533DF133ECDB6876F9479A639F6B
261727D92074D1394EC144D001187DEB273A233BF57DC9C85B1E3556E563A42917A501B4471BA8
7FFF51AA45C839C94840640FEC93C6840E13598AF12AF9B1A295DDEA337AED3FB0D03FEDAE105E
416AF3C492F8BE6991507D0CFEF533F4BC45ADCF2A5A388546386B0DCFAB9F31146F9A301CBA7B
ED659E538556D012CE4FED30C1E9104F2363185AF568D43E9A1943667EB976A20FCBBCA89E3D09
2D7BE98F9E3DF0D48E09B4E0313450DC13895C8F513FF1BBAAB38D5381410E9B8F318FFEF7C7C7
B2F45426684E5131BA0969E0065113BB6E83DE771660C126980B24781516AFB2F0BAC2EB9B702D
A33E2820EDDA16A9AD5407DA34D1CB67D793E863698942C07B609A8C8B88E231703AA662303101
A8673B923CFE67A73593A9BEF84CFFCF53FE3248197B4ECEA6238A8F92A5131CCA4D64343B69B5
69603F4DF8D4D1EC5A3B68A7C6CBD8365E56A0A526108052824081F0B8D78C69BBA02E8C72EC7E
A453D9EA3EE4E9E140918A29643C98422192824F885EBEF73E9F33B8F48FE8FD12B1700D2111FD
D8882430B6A6EAA914FE4264F95BF77E5E5F710A645F5CB6AF1CDFD36C59958D13B19986DA56EE
816A564E5BEC79CCD7B568040CAF66D37DC5984D674747228AC390D5E759103F4C543FDC1EDBE0
6B7B20861DE6440D00BDC04C64FA797176D3E2B310231430AF9C40A88ED9F6221218FF9BB415A7
A4AB3C4DAA41A0F9E0090BA49DFBD2BCA7ED706126C7213B79CC6C0C7F8CD21A0C52054F76CA33
760CB9B1993DB2FEF43D9238DC3DFEFC4DAED5B2135FA02B2343AAD0B4ACE70E241DBD27DBC46A
56FA1C0195C832594424C7125CC041002BBFF738A4D74D7A1BC221A0B77B4F96DECEA0D07BE373
DEBCE653C06493ABC66E6749738D82C32457D6359D3BA2BAE0D04060401528A2A21259C75C82DB
9E5187EC11D12E588DB76BE357D3156116C9B46A25A5DD03667BF4C43656A1AF21AF6877B7CFB2
8E409C664825DB7764C12BF2EB48AC80D24FA2084B29A19690E353058D9511F66E9FB66F4B0261
0310E5ED3BC55AAE9E3D6A68FCD22472F51D851D84D4DD2784B8511EF998BAE50FBE0420A3E2BF
0076DEE20166B996310FA532E160392A7721FFBFE25E6A69D6F5B16CD2061A38EA814D34055FE2
CC65A79C6B22F6D2A7776075F84167CAEE14FE886B29B08BB95FECFB4451D774DCD191DDA88943
87910C0BEF73DE1DE664A49191BEB6768BBD92C7E7D5281B1D51E7DC8FCB496D46895D2A148B64
2ED57CDA5664884F6B70CA7A3A091AB3E2339D12EBCE9B47EB1707E48B56BD8F29DAC469F42702
5172B67C4937399E7C316954363B69C0EBBCDCEB711309C8EA26E0FD1045A3692C738C31BB97F2
8C777CF1922142F441EEF8E93F02A51935F100FD66626B9C3D3E8C3B83D595282DE70AD3972DA5
256430EC845CDB0BD2734E819BF9E95FAB963DC5B4D4091D2A5E8DE0627CC66E2931F6DA7F7176
4BE63AE929289B110F4A9AFE2C369052D26AB4A96E028C077034D1FF17064AFBB88BE82D89874C
B66909B6C81F18AE0A86789168D9B12B7B7BEA6BEB15A73CC7A005162C1E457AE16A617A1988D3
C1473D5860077D2FF90948B0BD19FD27596F28BA3113491797E84C756DB59E807D488A824067D4
6640852FFFE3B7B8FD241D1BAC1BBB32DF42B1B42914E2FA4E12B76EACF42FD8FABEAF5C11A256
D26459955C27E3EB3CFC27C92029EEC69DFCFD57E2AB17B2DF848ACDADFC14DE5FC9CDC11C310B
DCA14008FC41526FCA4A305194197B3F5663A4F2B167728CA682896732ECA225D6A2D9A5A8DAE0
7F29B32CA5748FC9A4769BA800B85177C7232CF9FF4239954B2C9D67793E181F9D1777189107B8
CCFB27B78A20A717F84026040644ABD08E36FB945379144B7BD28C3C26473D6E1B54F5D9852AA5
262EC45F73F77FC1D23DEED42448109F5B07DCAF7F65B255F91CD1D2803DEC7EB6274A699E70F2
085B50833C8739EB175282318DF6DEFC7EC9BE52C59102C0BCE45605D5106E47D5BC617628A904
CD04E8F5B6AFE2D15B70868251015AF9AA13B02DB03A24D54358886CBCDE6C5F92220DD809577A
85AFD0035A393BC25314899EC0B6BF1877E5B649EFC9A3FB1F1BDFB458573C969961ADD6D584E6
EF1EEF516BA2B53EDFBDF7A1D8E742311F88275E6414934DAE2C7BAD2536A8B8B6BB636BF9EE59
371DDB92BFD229F101F5D1E0016AC733CFEC9E4EFE210C75A875860C6B30A0FB4D59A68B45D1F8
6BCCAEB64069A5B8B74841F9769A5DC42D9D9997C3D1C75534081D44B2E866FA168D1C8E99831E
EB5E51BDE2A858AF18F34427CC6611EF89293496FC353C7618F423991EB0C5499B7B5F31F18DEC
F2C5B58C0DAA57E06BB8CB5F16182E60AD68D8973C8C88CC5CB0DBF436C7396567DBD8364EF84B
8B4255B8A6E078B5F4FE72D5E94711CE14C0AE6A3FDB7025ECA332E0F0E73AA9A345E0F07405D7
DE0E3717DB9C1872BE57604D8CC0B60F5CBAAC2FD58AADFC97E6E4D20E2B4A2049C64B12F4AFD0
3E1FB8407F2485C0283A9C9E29C5A469525599A80D35087150B19A9664E867A3EF85629E27AF8C
32522E06EFA204179573A6C8B91C8B2FA87A21A14238370F8E25F454A84F65D46D6032DF1B80C6
C65B11BE58B6857C777EC5F08094FC463D7E2BCA255176B7181D312602207226A5D645E9050785
C2CE0CE541AFF12E72E0885161975974374832D80D66667CEA20425B951F8B284928D731056736
730A601E24C644A57BDFA39C2A47D1374CAC0DFB32B6E8BD03AD4FB5D65D70A71F61CB60E6D5C5
43A30B539A55DC0D25DC2B26E89BE4EDAA97725D17E15661520DB4EC2C91C7DFAA02FEA8E1BEE8
FCD1AEE0883CF0D71318E54864DF4D64977CA9EC63B1E80F0DC57B8F28B0FC1F82F0C65A625977
94B3D07F850EE592550DB3316146A637C5374D500E95CDAF32ADBB1CDBB26AFF2390E6ACA9057C
AC94E20BD8594B9D8AFBFB83450F859D8E509CA55C4B0731565B803E6F4164CB9CDB1A56762262
1BA8B1ABF656EC9FC8CDEE8462EB1E34FFF1A05981551A4AAB7A2905F1ABEDD56C7571C71F82CE
6A4713F2BB7C962FDC547D57A316FADB15D9A656B2A52713B5D3DC13931D672A2CD26AABF8192C
63D662CBC09605C13CD361C1985B626401C71F7FC6C95620B390310E404B9821EDDA0C2252C675
58AC71DABD86C60B28ABEFF122D88E4BCBAD706BE21398983BDDA7A0BEE1E5FEE3B1C43141660F
420F6DBC56D20C8C8870B1C8A73E0F6099B5A314B97C04A3633F23A2DCCB0968AE32B9D00D941C
2768A82E59EF75127DE80A548411F7883F556FF356680B109B6365DA4164E558548330F99856C1
FD15DDC164BB77204DEAB3C54F62B2FB464E4E76850AD14886EFD8788EAE3E0DC6F6FA0B2E304F
BA04856033301F8A580055539E14B91C2F7FFE7C34CE3B54A18FDE8538939D38C854C8EDC9B7DF
C61C1D7FD04596E71AA0D3DFD8A5086F5529BC78625E19329EB91D03A510F6D90E6D4A70B6B02C
999F4ADDF87EB893C120FDAFBF8643074DE177691CF3861C54C5F6479AF71DED476F30164B5437
F75609892F059B79CD8D4DF9DF08FF3D356458587D86EC5B75F4688151E08FF5E3F7E15059B00B
F02A6071BEC3BFBD09026EE3E44B4EED8B9892C9C4A5996EB8BFD9F2C3F8E120D62B863F65C291
2950355AE8F5F961FF03DA04AC9D172843FD370343932F9089CC1BCC97FD9EA1302B335D328C94
5F31B63E1B11392FDF32DF4982648F4214B8156B9BBD604842E446C5BA91326AE2105FFE6B5D60
E8AEB89B6DA38926742089816CC8D970890D686B593742B7E4ACC4AF5642DB6DE618D35BC777DC
B78681BA2898DF7C8B6599DDB71C4E9767D486976AC0945A093A8921DF989FEE56977435068E5E
3B1E777B3101DE057DE46363ED35F29D1D8BD5607EF3F3F405E7A9CF0FA0F6C75D0E1945B7F115
D4F1C3820483E591809B24C0FE08DD7BE132DD404ABC80A104CE6F23165094BAA2C6B26F25D9E4
E3EEBD280037C981527A4A92286632B261918293CDDF14FC5AC579ADEE68728DA2D1EB4E7A7CE9
F35AA2B553CF88D76876B7CF669C698FF001F3B74FE5A0F279866E4B1DC74DEB73F20201A5B488
B48A4B7134D80A563ADA5F56D8988F85AA869D898596CB628D342AB3DFB754BADADF20A5F6A7A4
A096B5E06A2D529848EB493F5C279ACA127B4642CB46FF78F546089D360E2847A64FF3881DB7F5
D58A07F5FD3898E7A23C8BA43DA812643684AB81B95C78600D58AF3FE1C7215A7F51103081C938
EC5C942BE3A349FEDF4A790B60CD497BFF4995260EB2B03576BE129CD14C8D25425067F49867A3
20664346BE5ED2714778F69D7E18237778661F75F00F4FBEED52A4ACEE7D07631084C77D8818AE
E151C9EBEEF041DBCB32C5DA35F9C2F29429C280ADC8B4806333B1A2E1C04DE755D0A6494AC50A
CCE092111AE534DE1F1E096E66553D2F882A7A5C4682B003C5CAC009B9E8CB1DCE098603A0C66D
A81CD06F5B6E3F11725A4F8A43D271431885826ABA1F5B62F19EBA700201D733D0F485A8C84DD4
2A3437AF9E4D252958D6EBB5AF05E8327B1E48CF5E504F63C6A7AE307F9B2FD50823A84CE1BC7F
C0D399C7056C69236B54E9AD27B2CBBB65280A1E92D5D0B1ABE64F9B3F223D1969E095E294D60B
F3A7EE0E444DF073EF6DF079659EE7EB96067377E3A6AC3F716AC6A67D2CF348CE94F4BC7C0567
C9A42AE9E6F2C137936A192F04C16264CD6B33E339F664040772112A5C993DD64E3F4F2EC74E5A
920650E5B10427F30D1B47D8F07AFE973DA8125BD04066C9065F77C733F516A6E04B1E2C77A85E
E796C4B255665739396D14691DFE6ACCA718A072D333C72FE2F149F7EF0FB8ECB3D8CAA86A5932
7A244A19F52A73227027F936C828E1A818226FC07DD620476324A40C3CF26996B4CC434C6A922D
FF3510A2EA7009E7460207E68D3B6E382633059EE70ED6F985E7BFB9A5EEA5B5649CC54EFC0123
B68341BCE62B06A06E7B532118269C6E5329E898DC781D5A3B160222D22EA6197FE5E57226BDCB
9279AF8B6D4060FFCD523FCDA77372EBAFDD0DE50AF4A02D2AF6CB1B8AE822AA1FCB9F89D05B67
704DD347BC5475A45AE1B1CD1404C4991C3D81B1FD2ED40314F9F6CAAE0CBF6492523EB48A8AD4
7D65B906D5E8B9341273D6D2FED1B1DAB8981E7DACC352BD2FAD2E68AE5640EE8B571E59DA4C79
E80CB6FAE9C04545D586D3440B6ACB143C423ACEEDC11362C055ADC4E0057D01B7248BC1746917
A55BA0B6177A12C2CF02CFED592FF6C3517D47293E0A992D6A831BDF5855C6320BEBD3FBDFC6DB
4FE559A6D9807C389B1EE6413071F8E6BC170F246994B1516CCD55C35507ADDB63038326FD77C6
C89800A85C512498C7DB43D3BA4E69BFFC78BA43CB380FB257691289AF0C288E36690C29C904C7
9245CBFBA9FF5E949384E075B189C052B0D6FC990ACD232A7470CCF70F4ECA2B17601C45EDEDD8
4AC6C8A27812482BE6276F8004C55B9FFDE8121AB911E56CA1124C963DBA9CD95B169EA152172D
FFFAFEC440727A94FFFB5BE82275E03C59775BABD36C2FA89048152E3AF9CC153B89A5F61F350F
1DC66200036BF96405E771CB344B52EAC96E23928C3823812E28878CC2078146BD9B9810A6C41C
B6256281EC107760898EC967BBDE56F508F1FDEA0DDBA93FF86EF0E66FB038DCBA58B515BCDFB2
90D3B28527AFAF825F1AABE2A385B79892C461A624256B4B959B9F4A7AE9E846A27602932402F0
7E5E360D3ACD0EF2092ACE9C9360E164E92B7EA5FB9701BBA12605501F30B4B2BA357E4D943B3A
D352C2C3E3B40F3C539AB12994D2DC927567D9ABE7614A73342A679BFDFD3628C08338E9D1767E
496441F33A6F9DEFAB64B4C442BBE4025B64E8A12F660611DD5D7F5F0E142F9D4EB3F349B9DF32
6856559E27C4FAA8CC210AC101AC6C90F16CDCE70C6CB10160E353269572D13D1F2CF4C76E8102
2540E91EC82D673BCD4019BFED28896CDE1B25D69CE7C80C194B5F1D9A4D4C19B7556203E088E5
5D0EC411D1ACB8287DA4E128B8AAAB35D0E9D628817ED04BAD8F86872D4253884AE65A16718436
F8315E22C943D093E1EFF6A1D64ADDB89F9F3D6F670043531F1ED5653F45C84513C4B4B5C997DF
41E8A831750423FB403E1542C988F2ECE71C3CB38303B103CDECBB88E009FBAC4B551B80B39AEA
6E647504505BB77955ADDE0931783E2AED5597D0C645B1095E9ED313385D29D279DDDC4AC49B80
87B9E50EC1034564856A231E2F3D3C9A04DBDF6DE8A045A46845EF87E674B8605A097DFB72B126
45904D1CFDB0D8CB5BB87DBA997F68A6DC62D2E81A42B011BB0D8C7D5D8A5A81AD95E2A7140258
AE4ECDBDA30D5AEDE8EFF4375151A6D408A2C522510CC34DFC2A9EC729505143711BF851E2D777
0201B0AE6AB508A9F650A377D7DD307EAD18A588B2855311C3231BCB25D92A1ABE095A6AE6DB8B
BE6C8A7276E5B49C4E0AFE1C5164A833E6C7C67A19E8269566BC2C1C999A5F012FD42B1C23848E
71B5855A0CF6F5F99EF2DA0C0CAF3ADE979A7A8CD593DB6CC6CA2C4469AE5CF95A1D2E0324CA91
8B2559D6787571AD08E9C2560C38F6A4B09EBA079F0A3518E7ECB53AAD8EE37E3F69CD6256F141
CA498168425598ECDF2DC6844AC8EA07293A59C6B3B8B103D8D49A1CCE2023B72EF6AB271A6031
CA3F4D10EF334A1C339E3BA3556FFFECDA64FC49BABF5B1C4A4C1865DCA3788526C09FF0A11BA2
09B9FE59BD3E4FF0F00083A1C469EDC6D5BEC739378EB7879ED3C8228046532C32502DD4BC69E4
18B298A6C43046DD7FD422F914D56471602C28C7228E713CA64BDFAC11D01F63A648B9CC182C0D
09B26C6CE1E0642D689145BB5BECF10491EE137EE8E6871B8D1411837C2B4D07D8C60E0E6BA8EF
39BE53F89E0C7EF30BA237A63D2A860E7D8DEBE9351298EFABC6909674F9CAE43E608F0C153412
52C452C0D0457DE692F825B04EAE56100BD2E224E17675D938C5948B6310D444D803AD8F2EF6F8
08529ACE131AB84D81CE168C8331E6F4551FE86AA52C4028447444BE4E8DB2CF36DE7A106F8C46
0EFFC56BA0D3B5C6E22E6C0AE54AB480B177FD81BF41F2D389BB19E47CE98A1F0E943A1837D29D
9E0DB9E49C079DF7D36DE5B253192FCFE6B890CD44C59250692602ECB3DA5FBFD8B5C2D174BA46
FECFD139111D4B06A5C6E1E977D4E65D2532A9E6BED141D0C7CD241E02F607E118369CFA5C077D
7399EA411B6DF118ACEBD61808E84025F1BD17B1F365FC82B25EC292B0BD1453C312DBAEEA0750
58B7E2A076B773CACA3A367B5E45F53CEB177AE25417BE06DC44078624E2E871A10F90BC341DA9
79F2BB7026DA11FFA15352FCA7D6999E111E5BF8BAF04542345DB050BB5B9EB59812BFBE86C41C
BB82931CE69F76D3979CAB2E2F32C21E9708A44C072CB6A2A6FEDACE5A436A294C98879DF73C54
973A902145FD96A083C5DD25DBFCC41E1E1D738E2290EDB1E424C4017386EB7828DA15D4AABAD1
6F6A1946893E0486D738294D4DE535547BB0CB70EE87B8CF7A4067FBDF77E6EB7505D378FB944D
017D3873B1B7C648E57A284B51EC33253D0D300DB5C91D1C0D5BE7A27D1444B1ED7AAAEA3BF5DC
2B3BA22246F2764AC360B1E339F9F62409FB4F059E8BC33DAD0ABCD986BD8D3F9D40F7726C3F0A
019C381152487E4F32CDB0FB1FA225AFF04D68B5BF9D61A0C50E88D4F7B905E46F5A0F52BF052A
6077CB01EBF51ADBBE43B7952839BBCD4DC7BA6CDE368730E772EA68F73F8D088E156C595760AA
C12D6C196AE8824F90A7E3BEC1E48CD99046CFD36C5F744BAA619BC681152A70BB42CAEF8ED3B3
7B713510106C494DE34A682D49011C3A2DE2909FF5E97635831AF676C49268FBEBDA1D877F81E5
0BADA456935D7A5F67798D5D90243C62BFB7EA16BD2E0C38773EFBF9B6CE7F8121845330596E92
28EB4570E0FD4563C763B61D2378D15E871DF2C180D371A7E8B522F94447CA5FD631461E4E9233
07031D1C7F525FD692D665173F11CB1611C6AA9E2E64CD7E1C0D594C3F81B8A80D88EFA3E8BBA8
2DBE99D954DE0D5164D66EACC56E8DB5FABF645EDF69054628AD4C68F02AC935D5FCC1469DE9E3
3CAD6574F9E9C1DC6A40EF89D03AD93A3AC47E49347A5207A57946E72686AFC72FA20A43C79E13
770502F745E2A89E5AE6A534E434FC2FEA7F377FF916E2947B1E8E1B5B53FEB4E5D5067B818198
008988331E7F09AA7720680E694F88F94FC62E82E284A40A01E5C19626218277633B5FDAC33CBD
2A89CFE51DF3CFAF5AD9CA44B333CFC4001649C5E59A7005ACEDE2D21F149CA8AA2FC080047187
142878DD224373E2594B4A6E2EAA6E08CA2FD1BDD079AFC2E9A7CF4FCC57D0CA62D1C43EB40290
4BE9A5AA2D4B364A4471A4979EE4A80C2DAE9B944B6362815DFEE4EBA189DE7A0546C6EDEF5BE6
AC4A9E87F65770A4827FD4774E8D97ABDB5DE4FFCFA1A01B92DA3525701700786F3DA6129DEBC1
783F3DB14322AB9B30A1CB2F365F6DB3A7036EE76E3AD0054CF800708F24FC2BA03D3EB297D200
1192EF57B84C8F98FA2B8403F63F3A82220089B8D742FB85B83552A9A58EA1F2E2B22FDF969273
06F2F0EF11A9E389F8571BBDBB948305D11B10FAC6EA68082B7FC210C10E35D138051995D57E45
C2356F60EAC7AC895E10C46D350194CC8BBD3914694456F216A2BBA872ED26EC0A92CF32FC0C86
BF74CA3C679EFA12DF549075B593E886AA2CC19F112CDEA530727AE6389B8F3D8767C187CC9DEF
E73B32F4C6B8B4B190F0D3E3F44CDDEE0505F0F9A374B3B8146FE5508E4EE41CAF82BAA2013243
EF03BD53D67581A1B80B96AEC280A0BFA45C698CB917D650C31665E3FFA9413A2F901D1FA96945
E6628B7479FFBEFD28C1692555C6DEE0F1CA39D6D2208320F47EA3D7A2F2A6EE8CDC5E84B1E09A
3AB908C39D698A684C7A34A671516FD3A82A378C18012E0407B9024114DBA2DC872EC7700613C0
68CC520150E71F65C8F68A97692643F708AF398D8CE88887C22287A57D5BC3E890ABC2EAC84152
6C77789E389DD24EA263A9DCBC66775A9BDC13AA2E59977E90D354309E7BE04F9578E54C99DC68
B7C0072AEAE1978458ACFA56A847FFA38C298DCBF8257826588F9AE94B1996BA7C07D67354A2A5
7DA5C499E6BA5CB7001A7BF534B3558DC2BFD9AF68EA2671601BDCF8220CFBEE27122A7CFF0191
5B2496E00C4D55CBCD80F75547898D0B7D52BCB10B8BE9FE97120D26ABB67DABE38D5E0A7E1123
5E3ACE13126DA4296B0A748663A5FF0F784688FD0AD4EF01D9B6C60BD35D8EF581886235D020C4
AE0E4C60C0270F6C80FC59A9A2E93BC26C90D99A293533BB276E94BD41E38EBE26E2EE26D4706C
B58529CE97A64BF989F83EBA022E660A488B7BFBBB957E946972570F3524E4AE398AF63E355B7C
BED51947D57A0757A6B70DC3E14E489CC3C0A85E1B89D35C37D91C95D63362541BDB71C7195343
41A574512A6F3B42040C7F962AA555FBE963FEDFCD9C0C400CBD57BFD4D8D1639C26427C97CA9A
1249202871C127084A1514FF7D10CEECD7B9AD892364EFB929F2D250F7CC048DD93274A3E5EA5D
83FA072FD1C7B6576551E9585C91CF15E72E35E54BE529CF74B0505520D22D3F42551C315DE398
7DE084973499DD79EB5C3C93BFB65AFFBD531CFFDEC705A9FC1AB99E6D02F6601107D45CF1B6DA
D436767D681FCFAC276C5E12AE94EFFE963C1E06FF39AE292869E6EEFF3DEFAF0505710F8FFE49
9C1E087D67C472CBB5DFA62D98D46EDE92910466285AA6C01CF1B7452DFC1E43A9B8BD6F9DFA03
6B67361C22BFB630AC0C3A3C5705D70F7CD582349B6F0C03E4A8EBAC31FD1A571A9593289796D0
EDE52B6A2759B8F7C70486CF4E48AE8430D135CBFB84E86BCCAE96E534B59EF8A044BB6FF7243B
2B876D2A60E3F4DFF82DF100F678D87E234408D4A11CD668A49285DC7E76AA5FFD323C980FC8A2
ED7322B786346E177C097F6949013D146DFE17D0E098B7916E6D182CAB71590A26579FDCEFAB93
7BEAB669C7D53E3655B980EEF2F069AC324228533053061C040C80A51C72613498B689EA087F00
517C0433949A9455219AD3BF63716CDC6EAD6950D507F48912C2F81DAFC57DFC55839735080A88
B781AD0F4DD39C3C4F67FB160E0AF9446A5E7BF2FEA8862EADFBE3F848653BF171126EB617DE96
37AA1F2C10CF6DAED1E4B375A1AFED43B0B6184F96423E774D6DFD82AC4CDB7D9B7D5E015647C1
4126A7076613CD4BFF90044E63E173F6DDF479C99DED7F4A817E20C8D732F5A6DF24EBC6B0EA56
2204F4496C140A6703B102E573FE7143F19A07C8EA08A79CBACD100D1A4F110059E6CC2552F08E
A200C9FFA68A15B27B8E899847AA6C8E5B2147D5CA9A001A49E40E768FA625B0F2FB59C265A82B
7DD316E8D24DF1C37B43CB06D560A5E098305A0E3BA91E5EE8B15D74E2DE05739D7EC683DE3D04
0228225D33BACA2AEA8941202981495239DB7C7902000743D158AE7B0403525A10C5FB67AC51DE
FED5E11DA963252EF3E6321D28DDB995E43796C26254789760E23FE91D93112BEF6D7E73B70697
8F9A3320AE0BAA88E9E5CE72A173DC9823E3328F2CEB8D54A4194A2EB624BECB042AF35CE8EBE6
40E6AB7CDCF3977A638C120BCC8D3CF16D1E3886260C94787BD81950985FE1585AF56E75A32F72
719F933B32B0EFBCDF6FC9866C1BEF5C1D24D36A44A396E7934DF2893D6FDA7DFE1ED78F1CBB17
770465423A1ED92C0327436F0D3EE716751B00865BE1BC72033D6EF49EEBE9659E5AF17EACA02E
2FA65807954AC9A81EBFB397111C77B5FA4F4883760B80F65DF76FB11AB820E4330BFAF999FA96
012C3EF20EC105FF40429C107BA590499ED9B9F62CB139766987E58E36507C0593F6E20E314EE9
6C617B04C14C5BC39C38F42B4F9DDB7BE676820DF530D87C1CAA5C91A35A05E5F565121A1897AD
81C878A4F0A051AB24D28A60D09A44560685EBE9D1A8B6C50C93FB445066B599076AC8B486E174
AE265FE494EAC2E381AA48D6BEEBA8AEDD3140C85246F54123DE9905DCB409CD5B2B4A4AB70436
44A945D612DA34C172AE630EC25EFE4BCDA0A0BA8AA13ABA9044C96F18E2F817876F768B5C8430
57D382363DF658BE9A11D66AF675130F39EEDD460F2A2B0AEBEBE81B082B51B4D7222E342DE5DF
9011B73444A272C394FB616A01AF6C1057DCD19A5CD49191F755327F11FD7E65600EB331394A61
B6788558352C9A60809903AE2B4D9C9D2285E10C69EAAC4DC12AB5BF95EB77C6FC5790122D5C5A
4598BFF66CE01BD7190F852B5883891CE5088F19ECCAA29F88677AD08C1F83AF3EA696B15732EB
A4B709EFCAFFC3798C4200F91F70878BBA86641AD7AF5BEF57F7B217F58E6585A3383808E8552E
B377D30E245F9F2BE278B1D0F749E061E40B590E92283F72D82EFE635E4181755EC8CAFC0D3DF4
60A2E6E16845F5AEEE149B5854ABF1CD856F517A0538527E2D2F5A1CE2E3EA151CF77176A50113
B54432E5B8B1E983212540F9C7C3FA63CAB53E75B02481E7B9E725AA51B100C5B0CA251F54132D
8BA3AA574B472E4B05FF2A213F6E7AFBFA27F796F5B622338AC7602CCC54BB721C81E1B931ABBA
F0AA1A8C
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
cleartomark

%!PS-Adobe-1.0
%%Creator: devps (Pipeline Associates, Inc.)
%%CreationDate: Sun Oct 16 13:24:22 2005
%%Pages: (atend)
%%DocumentFonts: (atend)

/devps 180 dict def devps begin
/res 10.000000 def
/y_offset 843 def
/X{exch}bind def
/mm {transform round X round X itransform} bind def
/r{rmoveto}bind def
/m{moveto}bind def
/l{lineto}bind def
/rl{rlineto}bind def
/st{stroke}bind def
/gs{gsave}bind def
/gr{grestore}bind def
/cp{currentpoint}bind def
/np{newpath}bind def
/ct{curveto}bind def
systemdict /setpacking known
 { /savepacking currentpacking def true setpacking } if
/m0{0 0 moveto}bind def
/xc{//res div}bind def
/yc{//res neg div //y_offset add}bind def
/lc{yc X xc X l st}bind def
/mc{yc X xc X m}bind def
/el{gs /a X def a div 1 X scale cp np a xc 2 div 0 360 arc st gr}bind def
/ar{cp 7 2 roll np xc 5 1 roll atan 3 1 roll atan X arc st}bind def
/sp{yc X xc X 6 2 roll yc X xc X 6 2 roll yc X xc X 6 2 roll ct}bind def
/V{//res neg div //y_offset add
currentpoint pop X
m}bind def
/H{//res div
0 transform X round X itransform pop
currentpoint X pop
moveto}bind def
/h{//res div 0 r}bind def
/v{//res neg div 0 X r}bind def
/S{X H show}bind def
/A{H //res div 1 index stringwidth pop sub 1 index length div 0 3 2 roll ashow}bind def
/psize 10 def
/height 0 def
/cheight { height 0 ne { height } { psize } ifelse } bind def
/slant 0 def
/FF{findfont X dup 30 div 0 mm pop setlinewidth /psize X def
    [psize 0 cheight slant sin slant cos div mul cheight 0 0]
    makefont setfont}bind def
/shade{gs
 /dy X def
 /dx X def
 np m
 0 /dy rl
 /dx 0 rl
 0 /dy neg rl
 /dx neg 0 rl
 closepath
 .9 setgray
 fill
gr}bind def
1 setlinecap

/resolution res 72 mul def


/startFig {
	/SavedState save def
	userdict maxlength dict begin
	currentpoint transform

	DocumentInitState setmiterlimit setgray setdash setlinejoin setlinecap
		setlinewidth setmatrix

	itransform moveto

	/ury exch def
	/urx exch def
	/lly exch def
	/llx exch def
	/y exch 72 mul resolution div def
	/x exch 72 mul resolution div def
	
	currentpoint /cy exch def /cx exch def

	/sx x urx llx sub div def
	/sy y ury lly sub div def

	sx sy scale

	cx sx div llx sub
	cy sy div ury sub translate
	
	/DefFigCTM matrix currentmatrix def

	/initmatrix {
		DefFigCTM setmatrix
	} def
	/defaultmatrix {
		DefFigCTM exch copy
	} def

	/initgraphics {
		DocumentInitState setmiterlimit setgray setdash 
			setlinejoin setlinecap setlinewidth setmatrix
		DefFigCTM setmatrix
	} def

	/showpage {
		initgraphics
	} def

}bind  def
/clipFig {
	currentpoint 6 2 roll
	newpath 4 copy
	4 2 roll moveto
	6 -1 roll exch lineto
	exch lineto
	exch lineto
	closepath clip
	newpath
	moveto
}bind  def
/doclip { llx lly urx ury clipFig } def
/endFig {
	end SavedState restore
}bind  def
/globalstart {
	fontnum psize slant height resolution currentpoint 
	pagesave restore gsave 
}bind  def
/globalend {
	grestore moveto
	/resolution exch def /height exch def
	/slant exch def /psize exch def /fontnum exch def
	F
	/pagesave save def
}bind  def


/fontnum 1 def 
systemdict /setpacking known { savepacking setpacking} if
end
/BP{
save mark devps begin m0
/DocumentInitState [ matrix currentmatrix currentlinewidth currentlinecap
currentlinejoin currentdash currentgray currentmiterlimit ] cvx def
}bind def
/EP{
end cleartomark restore showpage}def
/R{/Times-Roman FF}def
/B{/Times-Bold FF}def
/LST{/LucidaSans-Typewriter FF}def
%%EndProlog
%%Page: 1 1
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2453(File:)S
2686(include/ansi.h)S
12 B
4620(1)S
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(include/ansi.h)588 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(00000)210 1122 A
1440(/*)S
(The)126 1566 A
(<ansi.h>)336 1734 A
(header)252 2112 A
(attempts)336 2406 A
2784(to)S
(decide)252 2910 A
(whether)294 3204 A
(the)126 3540 A
(compiler)336 3708 A
(has)126 4086 A
(enough)252 4254 A
2295 V
(00001)210 1122 A
1482(*)S
(conformance)462 1566 A
2070(to)S
(Standard)336 2196 A
2574(C)S
(for)126 2658 A
(Minix)210 2826 A
3078(to)S
(take)168 3204 A
(advantage)378 3414 A
(of.)126 3834 A
4044(If)S
(so,)126 4170 A
(the)126 4338 A
2385 V
(00002)210 1122 A
1482(*)S
(symbol)252 1566 A
(_ANSI)210 1860 A
2112(is)S
(defined)294 2238 A
(\(as)126 2574 A
(31459\).)294 2742 A
(Otherwise)378 3120 A
(_ANSI)210 3540 A
3792(is)S
(not)126 3918 A
(defined)294 4086 A
2475 V
(00003)210 1122 A
1482(*)S
(here,)210 1566 A
(but)126 1818 A
1986(it)S
(may)126 2112 A
2280(be)S
(defined)294 2406 A
2742(by)S
(applications)504 2868 A
(that)168 3414 A
(want)168 3624 A
3834(to)S
(bend)168 3960 A
(the)126 4170 A
(rules.)252 4338 A
2565 V
(00004)210 1122 A
1482(*)S
(The)126 1566 A
(magic)210 1734 A
(number)252 1986 A
2280(in)S
(the)126 2406 A
(definition)420 2574 A
3036(is)S
3162(to)S
(inhibit)294 3288 A
(unnecessary)462 3624 A
(bending)294 4128 A
2655 V
(00005)210 1122 A
1482(*)S
1566(of)S
(the)126 1692 A
(rules.)252 1860 A
(\(For)168 2196 A
(consistency)462 2406 A
(with)168 2910 A
(the)126 3120 A
(new)126 3288 A
('#ifdef)294 3456 A
(_ANSI")252 3792 A
(tests)210 4086 A
4338(in)S
2745 V
(00006)210 1122 A
1482(*)S
(the)126 1566 A
(headers,)336 1734 A
(_ANSI)210 2112 A
(should)252 2364 A
(really)252 2658 A
2952(be)S
(defined)294 3078 A
3414(as)S
(nothing,)336 3540 A
(but)126 3918 A
(that)168 4086 A
(would)210 4296 A
2835 V
(00007)210 1122 A
1482(*)S
(break)210 1566 A
(many)168 1818 A
(library)294 2028 A
(routines)336 2364 A
(that)168 2742 A
(use)126 2952 A
("#if)168 3120 A
(_ANSI".\))336 3330 A
2925 V
(00008)210 1122 A
3015 V
(00009)210 1122 A
1482(*)S
1566(If)S
(_ANSI)210 1692 A
(ends)168 1944 A
2154(up)S
(being)210 2280 A
(defined,)336 2532 A
2910(a)S
(macro)210 2994 A
3105 V
(00010)210 1122 A
1482(*)S
3195 V
(00011)210 1122 A
1482(*)S
(_PROTOTYPE\(function,)840 1776 A
(params\))294 2658 A
3285 V
(00012)210 1122 A
1482(*)S
3375 V
(00013)210 1122 A
1482(*)S
1566(is)S
(defined.)336 1692 A
(This)168 2112 A
(macro)210 2322 A
(expands)294 2574 A
2910(in)S
(different)378 3036 A
(ways,)210 3456 A
(generating)420 3708 A
(either)252 4170 A
3465 V
(00014)210 1122 A
1482(*)S
(ANSI)168 1566 A
(Standard)336 1776 A
2154(C)S
(prototypes)420 2238 A
2700(or)S
(old-style)378 2826 A
(K&R)126 3246 A
(\(Kernighan)420 3414 A
3876(&)S
(Ritchie\))336 3960 A
3555 V
(00015)210 1122 A
1482(*)S
(prototypes,)462 1566 A
2070(as)S
(needed.)294 2196 A
(Finally,)336 2574 A
(some)168 2952 A
(programs)336 3162 A
(use)126 3540 A
(_CONST,)294 3708 A
(_VOIDSTAR)378 4044 A
(etc)126 4464 A
3645 V
(00016)210 1122 A
1482(*)S
1566(in)S
(such)168 1692 A
1902(a)S
(way)126 1986 A
(that)168 2154 A
(they)168 2364 A
(are)126 2574 A
(portable)336 2742 A
(over)168 3120 A
(both)168 3330 A
(ANSI)168 3540 A
(and)126 3750 A
(K&R)126 3918 A
(compilers.)420 4086 A
3735 V
(00017)210 1122 A
1482(*)S
(The)126 1566 A
(appropriate)462 1734 A
(macros)252 2238 A
(are)126 2532 A
(defined)294 2700 A
(here.)210 3036 A
3825 V
(00018)210 1122 A
1482(*/)S
3915 V
(00019)210 1122 A
4005 V
(00020)210 1122 A
(#ifndef)294 1440 A
(_ANSI_H)294 1776 A
4095 V
(00021)210 1122 A
(#define)294 1440 A
(_ANSI_H)294 1776 A
4185 V
(00022)210 1122 A
4275 V
(00023)210 1122 A
(#if)126 1440 A
(__STDC__)336 1608 A
1986(==)S
2112(1)S
4365 V
(00024)210 1122 A
(#define)294 1440 A
(_ANSI)210 1776 A
(31459)210 2448 A
2784(/*)S
(compiler)336 2910 A
(claims)252 3288 A
(full)168 3582 A
(ANSI)168 3792 A
(conformance)462 4002 A
4506(*/)S
4455 V
(00025)210 1122 A
(#endif)252 1440 A
4545 V
(00026)210 1122 A
4635 V
(00027)210 1122 A
(#ifdef)252 1440 A
(__GNUC__)336 1734 A
4725 V
(00028)210 1122 A
(#define)294 1440 A
(_ANSI)210 1776 A
(31459)210 2448 A
2784(/*)S
(gcc)126 2910 A
(conforms)336 3078 A
(enough)252 3456 A
(even)168 3750 A
3960(in)S
(non-ANSI)336 4086 A
(mode)168 4464 A
4674(*/)S
4815 V
(00029)210 1122 A
(#endif)252 1440 A
4905 V
(00030)210 1122 A
4995 V
(00031)210 1122 A
(#ifdef)252 1440 A
(_ANSI)210 1734 A
5085 V
(00032)210 1122 A
5175 V
(00033)210 1122 A
1440(/*)S
(Keep)168 1566 A
(everything)420 1776 A
(for)126 2238 A
(ANSI)168 2406 A
(prototypes.)462 2616 A
3120(*/)S
5265 V
(00034)210 1122 A
(#define)294 1440 A
(_PROTOTYPE\(function,)840 1776 A
(params\))294 2658 A
(function)336 3120 A
(params)252 3498 A
5355 V
(00035)210 1122 A
(#define)294 1440 A
(_ARGS\(params\))546 1776 A
(params)252 3120 A
5445 V
(00036)210 1122 A
5535 V
(00037)210 1122 A
(#define)294 1440 A
(_VOIDSTAR)378 1776 A
(void)168 2448 A
2658(*)S
5625 V
(00038)210 1122 A
(#define)294 1440 A
(_VOID)210 1776 A
(void)168 2448 A
5715 V
(00039)210 1122 A
(#define)294 1440 A
(_CONST)252 1776 A
(const)210 2448 A
5805 V
(00040)210 1122 A
(#define)294 1440 A
(_VOLATILE)378 1776 A
(volatile)336 2448 A
5895 V
(00041)210 1122 A
(#define)294 1440 A
(_SIZET)252 1776 A
(size_t)252 2448 A
5985 V
(00042)210 1122 A
6075 V
(00043)210 1122 A
(#else)210 1440 A
6165 V
(00044)210 1122 A
6255 V
(00045)210 1122 A
1440(/*)S
(Throw)210 1566 A
(away)168 1818 A
(the)126 2028 A
(parameters)420 2196 A
(for)126 2658 A
(K&R)126 2826 A
(prototypes.)462 2994 A
3498(*/)S
6345 V
(00046)210 1122 A
(#define)294 1440 A
(_PROTOTYPE\(function,)840 1776 A
(params\))294 2658 A
(function\(\))420 3120 A
6435 V
(00047)210 1122 A
(#define)294 1440 A
(_ARGS\(params\))546 1776 A
3120(\(\))S
6525 V
(00048)210 1122 A
6615 V
(00049)210 1122 A
(#define)294 1440 A
(_VOIDSTAR)378 1776 A
(void)168 2448 A
2658(*)S
6705 V
(00050)210 1122 A
(#define)294 1440 A
(_VOID)210 1776 A
(void)168 2448 A
6795 V
(00051)210 1122 A
(#define)294 1440 A
(_CONST)252 1776 A
6885 V
(00052)210 1122 A
(#define)294 1440 A
(_VOLATILE)378 1776 A
6975 V
(00053)210 1122 A
(#define)294 1440 A
(_SIZET)252 1776 A
(int)126 2448 A
7065 V
(00054)210 1122 A
8418 V
EP
%%Page: 2 2
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(2)S
11 R
2453(File:)S
2686(include/ansi.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(00055)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_ANSI)210 1860 A
2112(*/)S
1845 V
(00056)210 1122 A
1935 V
(00057)210 1122 A
1440(/*)S
(This)168 1566 A
(should)252 1776 A
2070(be)S
(defined)294 2196 A
2532(as)S
(restrict)336 2658 A
(when)168 3036 A
3246(a)S
(C99)126 3330 A
(compiler)336 3498 A
3876(is)S
(used.)210 4002 A
4254(*/)S
2025 V
(00058)210 1122 A
(#define)294 1440 A
(_RESTRICT)378 1776 A
2115 V
(00059)210 1122 A
2205 V
(00060)210 1122 A
1440(/*)S
(Setting)294 1566 A
(any)126 1902 A
2070(of)S
(_MINIX,)294 2196 A
(_POSIX_C_SOURCE)630 2532 A
3204(or)S
(_POSIX2_SOURCE)588 3330 A
(implies)294 3960 A
2295 V
(00061)210 1122 A
1482(*)S
(_POSIX_SOURCE.)588 1566 A
(\(Seems)252 2238 A
(wrong)210 2532 A
2784(to)S
(put)126 2910 A
(this)168 3078 A
(here)168 3288 A
3498(in)S
(ANSI)168 3624 A
(space.\))294 3834 A
2385 V
(00062)210 1122 A
1482(*/)S
2475 V
(00063)210 1122 A
(#if)126 1440 A
(defined\(_MINIX\))630 1608 A
2280(||)S
(_POSIX_C_SOURCE)630 2406 A
3078(>)S
3162(0)S
3246(||)S
(defined\(_POSIX2_SOURCE\))966 3372 A
2565 V
(00064)210 1122 A
(#undef)252 1440 A
(_POSIX_SOURCE)546 1734 A
2655 V
(00065)210 1122 A
(#define)294 1440 A
(_POSIX_SOURCE)546 1776 A
2448(1)S
2745 V
(00066)210 1122 A
(#endif)252 1440 A
2835 V
(00067)210 1122 A
2925 V
(00068)210 1122 A
(#endif)252 1440 A
1734(/*)S
(ANSI_H)252 1860 A
2154(*/)S
3195 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3285 V
(include/limits.h)672 2676 A
3375 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3555 V
(00100)210 1122 A
1440(/*)S
(The)126 1566 A
(<limits.h>)420 1734 A
(header)252 2196 A
(defines)294 2490 A
(some)168 2826 A
(basic)210 3036 A
(sizes,)252 3288 A
(both)168 3582 A
3792(of)S
(the)126 3918 A
(language)336 4086 A
(types)210 4464 A
3645 V
(00101)210 1122 A
1482(*)S
(\(e.g.,)252 1566 A
(the)126 1860 A
(number)252 2028 A
2322(of)S
(bits)168 2448 A
2658(in)S
2784(an)S
(integer\),)378 2910 A
(and)126 3330 A
3498(of)S
(the)126 3624 A
(operating)378 3792 A
(system)252 4212 A
(\(e.g.)210 4506 A
3735 V
(00102)210 1122 A
1482(*)S
(the)126 1566 A
(number)252 1734 A
2028(of)S
(characters)420 2154 A
2616(in)S
2742(a)S
(file)168 2826 A
(name.)210 3036 A
3825 V
(00103)210 1122 A
1482(*/)S
3915 V
(00104)210 1122 A
4005 V
(00105)210 1122 A
(#ifndef)294 1440 A
(_LIMITS_H)378 1776 A
4095 V
(00106)210 1122 A
(#define)294 1440 A
(_LIMITS_H)378 1776 A
4185 V
(00107)210 1122 A
4275 V
(00108)210 1122 A
1440(/*)S
(Definitions)462 1566 A
(about)210 2070 A
(chars)210 2322 A
2574(\(8)S
(bits)168 2700 A
2910(in)S
(MINIX,)252 3036 A
(and)126 3330 A
(signed\).)336 3498 A
3876(*/)S
4365 V
(00109)210 1122 A
(#define)294 1440 A
(CHAR_BIT)336 1776 A
2574(8)S
2784(/*)S
2910(#)S
(bits)168 2994 A
3204(in)S
3330(a)S
(char)168 3414 A
3624(*/)S
4455 V
(00110)210 1122 A
(#define)294 1440 A
(CHAR_MIN)336 1776 A
(-128)168 2448 A
2784(/*)S
(minimum)294 2910 A
(value)210 3246 A
3498(of)S
3624(a)S
(char)168 3708 A
3918(*/)S
4545 V
(00111)210 1122 A
(#define)294 1440 A
(CHAR_MAX)336 1776 A
(127)126 2490 A
2784(/*)S
(maximum)294 2910 A
(value)210 3246 A
3498(of)S
3624(a)S
(char)168 3708 A
3918(*/)S
4635 V
(00112)210 1122 A
(#define)294 1440 A
(SCHAR_MIN)378 1776 A
(-128)168 2448 A
2784(/*)S
(minimum)294 2910 A
(value)210 3246 A
3498(of)S
3624(a)S
(signed)252 3708 A
(char)168 4002 A
4212(*/)S
4725 V
(00113)210 1122 A
(#define)294 1440 A
(SCHAR_MAX)378 1776 A
(127)126 2490 A
2784(/*)S
(maximum)294 2910 A
(value)210 3246 A
3498(of)S
3624(a)S
(signed)252 3708 A
(char)168 4002 A
4212(*/)S
4815 V
(00114)210 1122 A
(#define)294 1440 A
(UCHAR_MAX)378 1776 A
(255)126 2490 A
2784(/*)S
(maximum)294 2910 A
(value)210 3246 A
3498(of)S
3624(an)S
(unsigned)336 3750 A
(char)168 4128 A
4338(*/)S
4905 V
(00115)210 1122 A
(#define)294 1440 A
(MB_LEN_MAX)420 1776 A
2574(1)S
2784(/*)S
(maximum)294 2910 A
(length)252 3246 A
3540(of)S
3666(a)S
(multibyte)378 3750 A
(char)168 4170 A
4380(*/)S
4995 V
(00116)210 1122 A
5085 V
(00117)210 1122 A
1440(/*)S
(Definitions)462 1566 A
(about)210 2070 A
(shorts)252 2322 A
(\(16)126 2616 A
(bits)168 2784 A
2994(in)S
(MINIX\).)294 3120 A
3456(*/)S
5175 V
(00118)210 1122 A
(#define)294 1440 A
(SHRT_MIN)336 1776 A
(\(-32767-1\))420 2196 A
2784(/*)S
(minimum)294 2910 A
(value)210 3246 A
3498(of)S
3624(a)S
(short)210 3708 A
3960(*/)S
5265 V
(00119)210 1122 A
(#define)294 1440 A
(SHRT_MAX)336 1776 A
(32767)210 2406 A
2784(/*)S
(maximum)294 2910 A
(value)210 3246 A
3498(of)S
3624(a)S
(short)210 3708 A
3960(*/)S
5355 V
(00120)210 1122 A
(#define)294 1440 A
(USHRT_MAX)378 1776 A
(0xFFFF)252 2364 A
2784(/*)S
(maximum)294 2910 A
(value)210 3246 A
3498(of)S
(unsigned)336 3624 A
(short)210 4002 A
4254(*/)S
5445 V
(00121)210 1122 A
5535 V
(00122)210 1122 A
1440(/*)S
(_EM_WSIZE)378 1566 A
1986(is)S
2112(a)S
(compiler-generated)756 2196 A
(symbol)252 2994 A
(giving)252 3288 A
(the)126 3582 A
(word)168 3750 A
(size)168 3960 A
4170(in)S
(bytes.)252 4296 A
4590(*/)S
5625 V
(00123)210 1122 A
(#define)294 1440 A
(INT_MIN)294 1776 A
(\(-2147483647-1\))630 2112 A
2784(/*)S
(minimum)294 2910 A
(value)210 3246 A
3498(of)S
3624(a)S
(32-bit)252 3708 A
(int)126 4002 A
4170(*/)S
5715 V
(00124)210 1122 A
(#define)294 1440 A
(INT_MAX)294 1776 A
(2147483647)420 2196 A
2784(/*)S
(maximum)294 2910 A
(value)210 3246 A
3498(of)S
3624(a)S
(32-bit)252 3708 A
(int)126 4002 A
4170(*/)S
5805 V
(00125)210 1122 A
(#define)294 1440 A
(UINT_MAX)336 1776 A
(0xFFFFFFFF)420 2196 A
2784(/*)S
(maximum)294 2910 A
(value)210 3246 A
3498(of)S
3624(an)S
(unsigned)336 3750 A
(32-bit)252 4128 A
(int)126 4422 A
4590(*/)S
5895 V
(00126)210 1122 A
5985 V
(00127)210 1122 A
(/*Definitions)546 1440 A
(about)210 2028 A
(longs)210 2280 A
(\(32)126 2532 A
(bits)168 2700 A
2910(in)S
(MINIX\).)294 3036 A
3372(*/)S
6075 V
(00128)210 1122 A
(#define)294 1440 A
(LONG_MIN)336 1776 A
(\(-2147483647L-1\)/*)756 2154 A
(minimum)294 2952 A
(value)210 3288 A
3540(of)S
3666(a)S
(long)168 3750 A
3960(*/)S
6165 V
(00129)210 1122 A
(#define)294 1440 A
(LONG_MAX)336 1776 A
(2147483647L)462 2196 A
2784(/*)S
(maximum)294 2910 A
(value)210 3246 A
3498(of)S
3624(a)S
(long)168 3708 A
3918(*/)S
6255 V
(00130)210 1122 A
(#define)294 1440 A
(ULONG_MAX)378 1776 A
(0xFFFFFFFFL)462 2196 A
2784(/*)S
(maximum)294 2910 A
(value)210 3246 A
3498(of)S
3624(an)S
(unsigned)336 3750 A
(long)168 4128 A
4338(*/)S
6345 V
(00131)210 1122 A
6435 V
(00132)210 1122 A
(#include)336 1440 A
(<sys/dir.h>)462 1818 A
6525 V
(00133)210 1122 A
6615 V
(00134)210 1122 A
1440(/*)S
(Minimum)294 1566 A
(sizes)210 1902 A
(required)336 2154 A
2532(by)S
(the)126 2658 A
(POSIX)210 2826 A
(P1003.1)294 3078 A
(standard)336 3414 A
(\(Table)252 3792 A
(2-3\).)210 4086 A
4338(*/)S
6705 V
(00135)210 1122 A
(#ifdef)252 1440 A
(_POSIX_SOURCE)546 1734 A
2784(/*)S
(these)210 2910 A
(are)126 3162 A
(only)168 3330 A
(visible)294 3540 A
(for)126 3876 A
(POSIX)210 4044 A
4296(*/)S
6795 V
(00136)210 1122 A
(#define)294 1440 A
(_POSIX_ARG_MAX)588 1776 A
(4096)168 2532 A
2784(/*)S
(exec\(\))252 2910 A
(may)126 3204 A
(have)168 3372 A
3582(4K)S
(worth)210 3708 A
3960(of)S
(args)168 4086 A
4296(*/)S
6885 V
(00137)210 1122 A
(#define)294 1440 A
(_POSIX_CHILD_MAX)672 1776 A
2658(6)S
2784(/*)S
2910(a)S
(process)294 2994 A
(may)126 3330 A
(have)168 3498 A
3708(6)S
(children)336 3792 A
4170(*/)S
6975 V
(00138)210 1122 A
(#define)294 1440 A
(_POSIX_LINK_MAX)630 1776 A
2658(8)S
2784(/*)S
2910(a)S
(file)168 2994 A
(may)126 3204 A
(have)168 3372 A
3582(8)S
(links)210 3666 A
3918(*/)S
7065 V
(00139)210 1122 A
(#define)294 1440 A
(_POSIX_MAX_CANON)672 1776 A
(255)126 2574 A
2784(/*)S
(size)168 2910 A
3120(of)S
(the)126 3246 A
(canonical)378 3414 A
(input)210 3834 A
(queue)210 4086 A
4338(*/)S
8418 V
EP
%%Page: 3 3
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2416(File:)S
(include/limits.h)694 2649 A
12 B
4620(3)S
1755 V
7 LST
(00140)210 1122 A
(#define)294 1440 A
(_POSIX_MAX_INPUT)672 1776 A
(255)126 2574 A
2784(/*)S
(you)126 2910 A
(can)126 3078 A
(type)168 3246 A
(255)126 3456 A
(chars)210 3624 A
(ahead)210 3876 A
4128(*/)S
1845 V
(00141)210 1122 A
(#define)294 1440 A
(_POSIX_NAME_MAX)630 1776 A
(DIRSIZ)252 2448 A
2784(/*)S
2910(a)S
(file)168 2994 A
(name)168 3204 A
(may)126 3414 A
(have)168 3582 A
3792(14)S
(chars)210 3918 A
4170(*/)S
1935 V
(00142)210 1122 A
(#define)294 1440 A
(_POSIX_NGROUPS_MAX)756 1776 A
2658(0)S
2784(/*)S
(supplementary)546 2910 A
(group)210 3498 A
(IDs)126 3750 A
(are)126 3918 A
(optional)336 4086 A
4464(*/)S
2025 V
(00143)210 1122 A
(#define)294 1440 A
(_POSIX_OPEN_MAX)630 1776 A
2616(16)S
2784(/*)S
2910(a)S
(process)294 2994 A
(may)126 3330 A
(have)168 3498 A
3708(16)S
(files)210 3834 A
(open)168 4086 A
4296(*/)S
2115 V
(00144)210 1122 A
(#define)294 1440 A
(_POSIX_PATH_MAX)630 1776 A
(255)126 2574 A
2784(/*)S
2910(a)S
(pathname)336 2994 A
(may)126 3372 A
(contain)294 3540 A
(255)126 3876 A
(chars)210 4044 A
4296(*/)S
2205 V
(00145)210 1122 A
(#define)294 1440 A
(_POSIX_PIPE_BUF)630 1776 A
(512)126 2574 A
2784(/*)S
(pipes)210 2910 A
(writes)252 3162 A
3456(of)S
(512)126 3582 A
(bytes)210 3750 A
(must)168 4002 A
4212(be)S
(atomic)252 4338 A
4632(*/)S
2295 V
(00146)210 1122 A
(#define)294 1440 A
(_POSIX_STREAM_MAX)714 1776 A
2658(8)S
2784(/*)S
2910(at)S
(least)210 3036 A
3288(8)S
(FILEs)210 3372 A
(can)126 3624 A
3792(be)S
(open)168 3918 A
4128(at)S
(once)168 4254 A
4464(*/)S
2385 V
(00147)210 1122 A
(#define)294 1440 A
(_POSIX_TZNAME_MAX)714 1776 A
2658(3)S
2784(/*)S
(time)168 2910 A
(zone)168 3120 A
(names)210 3330 A
(can)126 3582 A
3750(be)S
3876(at)S
(least)210 4002 A
4254(3)S
(chars)210 4338 A
4590(*/)S
2475 V
(00148)210 1122 A
(#define)294 1440 A
(_POSIX_SSIZE_MAX)672 1776 A
(32767)210 2490 A
2784(/*)S
(read\(\))252 2910 A
(must)168 3204 A
(support)294 3414 A
(32767)210 3750 A
(byte)168 4002 A
(reads)210 4212 A
4464(*/)S
2565 V
(00149)210 1122 A
2655 V
(00150)210 1122 A
1440(/*)S
(Values)252 1566 A
(actually)336 1860 A
(implemented)462 2238 A
2742(by)S
(MINIX)210 2868 A
(\(Tables)294 3120 A
(2-4,)168 3456 A
(2-5,)168 3666 A
(2-6,)168 3876 A
(and)126 4086 A
(2-7\).)210 4254 A
4506(*/)S
2745 V
(00151)210 1122 A
1440(/*)S
(Some)168 1566 A
1776(of)S
(these)210 1902 A
(old)126 2154 A
(names)210 2322 A
(had)126 2574 A
(better)252 2742 A
3036(be)S
(defined)294 3162 A
(when)168 3498 A
(not)126 3708 A
(POSIX.)252 3876 A
4170(*/)S
2835 V
(00152)210 1122 A
(#define)294 1440 A
(_NO_LIMIT)378 1776 A
(100)126 2574 A
2784(/*)S
(arbitrary)378 2910 A
(number;)294 3330 A
(limit)210 3666 A
(not)126 3918 A
(enforced)336 4086 A
4464(*/)S
2925 V
(00153)210 1122 A
3015 V
(00154)210 1122 A
(#define)294 1440 A
(NGROUPS_MAX)462 1776 A
2658(0)S
2784(/*)S
(supplemental)504 2910 A
(group)210 3456 A
(IDs)126 3708 A
(not)126 3876 A
(available)378 4044 A
4464(*/)S
3105 V
(00155)210 1122 A
(#define)294 1440 A
(ARG_MAX)294 1776 A
(16384)210 2490 A
2784(/*)S
2910(#)S
(bytes)210 2994 A
3246(of)S
(args)168 3372 A
3582(+)S
(environ)294 3666 A
(for)126 4002 A
(exec\(\))252 4170 A
4464(*/)S
3195 V
(00156)210 1122 A
(#define)294 1440 A
(CHILD_MAX)378 1776 A
(_NO_LIMIT)378 2322 A
2784(/*)S
(MINIX)210 2910 A
(does)168 3162 A
(not)126 3372 A
(limit)210 3540 A
(children)336 3792 A
4170(*/)S
3285 V
(00157)210 1122 A
(#define)294 1440 A
(OPEN_MAX)336 1776 A
2616(20)S
2784(/*)S
2910(#)S
(open)168 2994 A
(files)210 3204 A
3456(a)S
(process)294 3540 A
(may)126 3876 A
(have)168 4044 A
4254(*/)S
3375 V
(00158)210 1122 A
(#define)294 1440 A
(LINK_MAX)336 1776 A
(SHRT_MAX)336 2364 A
2784(/*)S
2910(#)S
(links)210 2994 A
3246(a)S
(file)168 3330 A
(may)126 3540 A
(have)168 3708 A
3918(*/)S
3465 V
(00159)210 1122 A
(#define)294 1440 A
(MAX_CANON)378 1776 A
(255)126 2574 A
2784(/*)S
(size)168 2910 A
3120(of)S
(the)126 3246 A
(canonical)378 3414 A
(input)210 3834 A
(queue)210 4086 A
4338(*/)S
3555 V
(00160)210 1122 A
(#define)294 1440 A
(MAX_INPUT)378 1776 A
(255)126 2574 A
2784(/*)S
(size)168 2910 A
3120(of)S
(the)126 3246 A
(type-ahead)420 3414 A
(buffer)252 3876 A
4170(*/)S
3645 V
(00161)210 1122 A
(#define)294 1440 A
(NAME_MAX)336 1776 A
(DIRSIZ)252 2448 A
2784(/*)S
2910(#)S
(chars)210 2994 A
3246(in)S
3372(a)S
(file)168 3456 A
(name)168 3666 A
3876(*/)S
3735 V
(00162)210 1122 A
(#define)294 1440 A
(PATH_MAX)336 1776 A
(255)126 2574 A
2784(/*)S
2910(#)S
(chars)210 2994 A
3246(in)S
3372(a)S
(path)168 3456 A
(name)168 3666 A
3876(*/)S
3825 V
(00163)210 1122 A
(#define)294 1440 A
(PIPE_BUF)336 1776 A
(7168)168 2532 A
2784(/*)S
2910(#)S
(bytes)210 2994 A
3246(in)S
(atomic)252 3372 A
(write)210 3666 A
3918(to)S
4044(a)S
(pipe)168 4128 A
4338(*/)S
3915 V
(00164)210 1122 A
(#define)294 1440 A
(STREAM_MAX)420 1776 A
2616(20)S
2784(/*)S
(must)168 2910 A
3120(be)S
(the)126 3246 A
(same)168 3414 A
3624(as)S
(FOPEN_MAX)378 3750 A
4170(in)S
(stdio.h)294 4296 A
4632(*/)S
4005 V
(00165)210 1122 A
(#define)294 1440 A
(TZNAME_MAX)420 1776 A
2658(3)S
2784(/*)S
(maximum)294 2910 A
(bytes)210 3246 A
3498(in)S
3624(a)S
(time)168 3708 A
(zone)168 3918 A
(name)168 4128 A
4338(is)S
4464(3)S
4548(*/)S
4095 V
(00166)210 1122 A
(#define)294 1440 A
(SSIZE_MAX)378 1776 A
(32767)210 2490 A
2784(/*)S
(max)126 2910 A
(defined)294 3078 A
(byte)168 3414 A
(count)210 3624 A
(for)126 3876 A
(read\(\))252 4044 A
4338(*/)S
4185 V
(00167)210 1122 A
4275 V
(00168)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_POSIX_SOURCE)546 1860 A
2448(*/)S
4365 V
(00169)210 1122 A
4455 V
(00170)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_LIMITS_H)378 1860 A
2280(*/)S
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(include/errno.h)630 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(00200)210 1122 A
1440(/*)S
(The)126 1566 A
(<errno.h>)378 1734 A
(header)252 2154 A
(defines)294 2448 A
(the)126 2784 A
(numbers)294 2952 A
3288(of)S
(the)126 3414 A
(various)294 3582 A
(errors)252 3918 A
(that)168 4212 A
(can)126 4422 A
5445 V
(00201)210 1122 A
1482(*)S
(occur)210 1566 A
(during)252 1818 A
(program)294 2112 A
(execution.)420 2448 A
(They)168 2952 A
(are)126 3162 A
(visible)294 3330 A
3666(to)S
(user)168 3792 A
(programs)336 4002 A
(and)126 4380 A
5535 V
(00202)210 1122 A
1482(*)S
(should)252 1566 A
1860(be)S
(small)210 1986 A
(positive)336 2238 A
(integers.)378 2616 A
(However,)336 3078 A
(they)168 3456 A
(are)126 3666 A
(also)168 3834 A
(used)168 4044 A
(within)252 4254 A
5625 V
(00203)210 1122 A
1482(*)S
(MINIX,)252 1566 A
(where)210 1860 A
(they)168 2112 A
(must)168 2322 A
2532(be)S
(negative.)378 2658 A
(For)126 3120 A
(example,)336 3288 A
(the)126 3666 A
(READ)168 3834 A
(system)252 4044 A
(call)168 4338 A
4548(is)S
5715 V
(00204)210 1122 A
1482(*)S
(executed)336 1566 A
(internally)420 1944 A
2406(by)S
(calling)294 2532 A
(do_read\(\).)420 2868 A
(This)168 3372 A
(function)336 3582 A
(returns)294 3960 A
(either)252 4296 A
4590(a)S
5805 V
(00205)210 1122 A
1482(*)S
(\(negative\))420 1566 A
(error)210 2028 A
(number)252 2280 A
2574(or)S
2700(a)S
(\(positive\))420 2784 A
(number)252 3246 A
3540(of)S
(bytes)210 3666 A
(actually)336 3918 A
(read.)210 4296 A
5895 V
(00206)210 1122 A
1482(*)S
5985 V
(00207)210 1122 A
1482(*)S
1566(To)S
(solve)210 1692 A
(the)126 1944 A
(problem)294 2112 A
2448(of)S
(having)252 2574 A
(the)126 2868 A
(error)210 3036 A
(numbers)294 3288 A
3624(be)S
(negative)336 3750 A
(inside)252 4128 A
(the)126 4422 A
6075 V
(00208)210 1122 A
1482(*)S
(the)126 1566 A
(system)252 1734 A
(and)126 2028 A
(positive)336 2196 A
(outside,)336 2574 A
(the)126 2952 A
(following)378 3120 A
(mechanism)378 3540 A
3960(is)S
(used.)210 4086 A
(All)126 4380 A
(the)126 4548 A
6165 V
(00209)210 1122 A
1482(*)S
(definitions)462 1566 A
(are)126 2070 A
(are)126 2238 A
(the)126 2406 A
(form:)210 2574 A
6255 V
(00210)210 1122 A
1482(*)S
6345 V
(00211)210 1122 A
1482(*)S
(#define)294 1776 A
(EPERM)210 2112 A
(\(_SIGN)252 2784 A
3078(1\))S
6435 V
(00212)210 1122 A
1482(*)S
6525 V
(00213)210 1122 A
1482(*)S
1566(If)S
(the)126 1692 A
(macro)210 1860 A
(_SYSTEM)294 2112 A
2448(is)S
(defined,)336 2574 A
(then)168 2952 A
(_SIGN)210 3204 A
3456(is)S
(set)126 3582 A
3750(to)S
("-",)168 3876 A
(otherwise)378 4086 A
4506(it)S
4632(is)S
6615 V
(00214)210 1122 A
1482(*)S
(set)126 1566 A
1734(to)S
("".)126 1860 A
(Thus)168 2070 A
(when)168 2280 A
(compiling)378 2490 A
(the)126 2910 A
(operating)378 3078 A
(system,)294 3498 A
(the)126 3834 A
(macro)210 4044 A
(_SYSTEM)294 4296 A
6705 V
(00215)210 1122 A
1482(*)S
(will)168 1566 A
1776(be)S
(defined,)336 1902 A
(setting)294 2280 A
(EPERM)210 2616 A
2868(to)S
2994(\(-)S
(1\),)126 3120 A
(whereas)294 3288 A
(when)168 3624 A
(when)168 3834 A
(this)168 4044 A
6795 V
(00216)210 1122 A
1482(*)S
(file)168 1566 A
1776(is)S
(included)336 1902 A
2280(in)S
2406(an)S
(ordinary)336 2532 A
(user)168 2910 A
(program,)336 3120 A
(EPERM)210 3498 A
(has)126 3750 A
(the)126 3918 A
(value)210 4086 A
4338(\()S
(1\).)126 4422 A
6885 V
(00217)210 1122 A
1482(*/)S
6975 V
(00218)210 1122 A
7065 V
(00219)210 1122 A
(#ifndef)294 1440 A
(_ERRNO_H)336 1776 A
2784(/*)S
(check)210 2910 A
3162(if)S
(<errno.h>)378 3288 A
3708(is)S
(already)294 3834 A
(included)336 4170 A
4548(*/)S
8418 V
EP
%%Page: 4 4
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(4)S
11 R
2426(File:)S
2659(include/errno.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(00220)210 1122 A
(#define)294 1440 A
(_ERRNO_H)336 1776 A
2784(/*)S
2910(it)S
3036(is)S
(not)126 3162 A
(included;)378 3330 A
(note)168 3750 A
(that)168 3960 A
(fact)168 4170 A
4380(*/)S
1845 V
(00221)210 1122 A
1935 V
(00222)210 1122 A
1440(/*)S
(Now)126 1566 A
(define)252 1734 A
(_SIGN)210 2028 A
2280(as)S
2406("")S
2532(or)S
("-")126 2658 A
(depending)378 2826 A
3246(on)S
(_SYSTEM.)336 3372 A
3750(*/)S
2025 V
(00223)210 1122 A
(#ifdef)252 1440 A
(_SYSTEM)294 1734 A
2115 V
(00224)210 1122 A
1440(#)S
(define)252 1608 A
(_SIGN)210 1902 A
2490(-)S
2205 V
(00225)210 1122 A
1440(#)S
(define)252 1608 A
1902(OK)S
2490(0)S
2295 V
(00226)210 1122 A
(#else)210 1440 A
2385 V
(00227)210 1122 A
1440(#)S
(define)252 1608 A
(_SIGN)210 1902 A
2475 V
(00228)210 1122 A
(#endif)252 1440 A
2565 V
(00229)210 1122 A
2655 V
(00230)210 1122 A
(extern)252 1440 A
(int)126 1734 A
(errno;)252 1902 A
2868(/*)S
(place)210 2994 A
(where)210 3246 A
(the)126 3498 A
(error)210 3666 A
(numbers)294 3918 A
4254(go)S
4380(*/)S
2745 V
(00231)210 1122 A
2835 V
(00232)210 1122 A
1440(/*)S
(Here)168 1566 A
(are)126 1776 A
(the)126 1944 A
(numerical)378 2112 A
(values)252 2532 A
2826(of)S
(the)126 2952 A
(error)210 3120 A
(numbers.)336 3372 A
3750(*/)S
2925 V
(00233)210 1122 A
(#define)294 1440 A
(_NERROR)294 1776 A
2700(70)S
2868(/*)S
(number)252 2994 A
3288(of)S
(errors)252 3414 A
3708(*/)S
3015 V
(00234)210 1122 A
3105 V
(00235)210 1122 A
(#define)294 1440 A
(EGENERIC)336 1776 A
(\(_SIGN)252 2364 A
(99\))126 2658 A
2868(/*)S
(generic)294 2994 A
(error)210 3330 A
3582(*/)S
3195 V
(00236)210 1122 A
(#define)294 1440 A
(EPERM)210 1776 A
(\(_SIGN)252 2364 A
2700(1\))S
2868(/*)S
(operation)378 2994 A
(not)126 3414 A
(permitted)378 3582 A
4002(*/)S
3285 V
(00237)210 1122 A
(#define)294 1440 A
(ENOENT)252 1776 A
(\(_SIGN)252 2364 A
2700(2\))S
2868(/*)S
2994(no)S
(such)168 3120 A
(file)168 3330 A
3540(or)S
(directory)378 3666 A
4086(*/)S
3375 V
(00238)210 1122 A
(#define)294 1440 A
(ESRCH)210 1776 A
(\(_SIGN)252 2364 A
2700(3\))S
2868(/*)S
2994(no)S
(such)168 3120 A
(process)294 3330 A
3666(*/)S
3465 V
(00239)210 1122 A
(#define)294 1440 A
(EINTR)210 1776 A
(\(_SIGN)252 2364 A
2700(4\))S
2868(/*)S
(interrupted)462 2994 A
(function)336 3498 A
(call)168 3876 A
4086(*/)S
3555 V
(00240)210 1122 A
(#define)294 1440 A
(EIO)126 1776 A
(\(_SIGN)252 2364 A
2700(5\))S
2868(/*)S
(input/output)504 2994 A
(error)210 3540 A
3792(*/)S
3645 V
(00241)210 1122 A
(#define)294 1440 A
(ENXIO)210 1776 A
(\(_SIGN)252 2364 A
2700(6\))S
2868(/*)S
2994(no)S
(such)168 3120 A
(device)252 3330 A
3624(or)S
(address)294 3750 A
4086(*/)S
3735 V
(00242)210 1122 A
(#define)294 1440 A
(E2BIG)210 1776 A
(\(_SIGN)252 2364 A
2700(7\))S
2868(/*)S
(arg)126 2994 A
(list)168 3162 A
(too)126 3372 A
(long)168 3540 A
3750(*/)S
3825 V
(00243)210 1122 A
(#define)294 1440 A
(ENOEXEC)294 1776 A
(\(_SIGN)252 2364 A
2700(8\))S
2868(/*)S
(exec)168 2994 A
(format)252 3204 A
(error)210 3498 A
3750(*/)S
3915 V
(00244)210 1122 A
(#define)294 1440 A
(EBADF)210 1776 A
(\(_SIGN)252 2364 A
2700(9\))S
2868(/*)S
(bad)126 2994 A
(file)168 3162 A
(descriptor)420 3372 A
3834(*/)S
4005 V
(00245)210 1122 A
(#define)294 1440 A
(ECHILD)252 1776 A
(\(_SIGN)252 2364 A
(10\))126 2658 A
2868(/*)S
2994(no)S
(child)210 3120 A
(process)294 3372 A
3708(*/)S
4095 V
(00246)210 1122 A
(#define)294 1440 A
(EAGAIN)252 1776 A
(\(_SIGN)252 2364 A
(11\))126 2658 A
2868(/*)S
(resource)336 2994 A
(temporarily)462 3372 A
(unavailable)462 3876 A
4380(*/)S
4185 V
(00247)210 1122 A
(#define)294 1440 A
(ENOMEM)252 1776 A
(\(_SIGN)252 2364 A
(12\))126 2658 A
2868(/*)S
(not)126 2994 A
(enough)252 3162 A
(space)210 3456 A
3708(*/)S
4275 V
(00248)210 1122 A
(#define)294 1440 A
(EACCES)252 1776 A
(\(_SIGN)252 2364 A
(13\))126 2658 A
2868(/*)S
(permission)420 2994 A
(denied)252 3456 A
3750(*/)S
4365 V
(00249)210 1122 A
(#define)294 1440 A
(EFAULT)252 1776 A
(\(_SIGN)252 2364 A
(14\))126 2658 A
2868(/*)S
(bad)126 2994 A
(address)294 3162 A
3498(*/)S
4455 V
(00250)210 1122 A
(#define)294 1440 A
(ENOTBLK)294 1776 A
(\(_SIGN)252 2364 A
(15\))126 2658 A
2868(/*)S
(Extension:)420 2994 A
(not)126 3456 A
3624(a)S
(block)210 3708 A
(special)294 3960 A
(file)168 4296 A
4506(*/)S
4545 V
(00251)210 1122 A
(#define)294 1440 A
(EBUSY)210 1776 A
(\(_SIGN)252 2364 A
(16\))126 2658 A
2868(/*)S
(resource)336 2994 A
(busy)168 3372 A
3582(*/)S
4635 V
(00252)210 1122 A
(#define)294 1440 A
(EEXIST)252 1776 A
(\(_SIGN)252 2364 A
(17\))126 2658 A
2868(/*)S
(file)168 2994 A
(exists)252 3204 A
3498(*/)S
4725 V
(00253)210 1122 A
(#define)294 1440 A
(EXDEV)210 1776 A
(\(_SIGN)252 2364 A
(18\))126 2658 A
2868(/*)S
(improper)336 2994 A
(link)168 3372 A
3582(*/)S
4815 V
(00254)210 1122 A
(#define)294 1440 A
(ENODEV)252 1776 A
(\(_SIGN)252 2364 A
(19\))126 2658 A
2868(/*)S
2994(no)S
(such)168 3120 A
(device)252 3330 A
3624(*/)S
4905 V
(00255)210 1122 A
(#define)294 1440 A
(ENOTDIR)294 1776 A
(\(_SIGN)252 2364 A
(20\))126 2658 A
2868(/*)S
(not)126 2994 A
3162(a)S
(directory)378 3246 A
3666(*/)S
4995 V
(00256)210 1122 A
(#define)294 1440 A
(EISDIR)252 1776 A
(\(_SIGN)252 2364 A
(21\))126 2658 A
2868(/*)S
2994(is)S
3120(a)S
(directory)378 3204 A
3624(*/)S
5085 V
(00257)210 1122 A
(#define)294 1440 A
(EINVAL)252 1776 A
(\(_SIGN)252 2364 A
(22\))126 2658 A
2868(/*)S
(invalid)294 2994 A
(argument)336 3330 A
3708(*/)S
5175 V
(00258)210 1122 A
(#define)294 1440 A
(ENFILE)252 1776 A
(\(_SIGN)252 2364 A
(23\))126 2658 A
2868(/*)S
(too)126 2994 A
(many)168 3162 A
(open)168 3372 A
(files)210 3582 A
3834(in)S
(system)252 3960 A
4254(*/)S
5265 V
(00259)210 1122 A
(#define)294 1440 A
(EMFILE)252 1776 A
(\(_SIGN)252 2364 A
(24\))126 2658 A
2868(/*)S
(too)126 2994 A
(many)168 3162 A
(open)168 3372 A
(files)210 3582 A
3834(*/)S
5355 V
(00260)210 1122 A
(#define)294 1440 A
(ENOTTY)252 1776 A
(\(_SIGN)252 2364 A
(25\))126 2658 A
2868(/*)S
(inappropriate)546 2994 A
(I/O)126 3582 A
(control)294 3750 A
(operation)378 4086 A
4506(*/)S
5445 V
(00261)210 1122 A
(#define)294 1440 A
(ETXTBSY)294 1776 A
(\(_SIGN)252 2364 A
(26\))126 2658 A
2868(/*)S
2994(no)S
(longer)252 3120 A
(used)168 3414 A
3624(*/)S
5535 V
(00262)210 1122 A
(#define)294 1440 A
(EFBIG)210 1776 A
(\(_SIGN)252 2364 A
(27\))126 2658 A
2868(/*)S
(file)168 2994 A
(too)126 3204 A
(large)210 3372 A
3624(*/)S
5625 V
(00263)210 1122 A
(#define)294 1440 A
(ENOSPC)252 1776 A
(\(_SIGN)252 2364 A
(28\))126 2658 A
2868(/*)S
2994(no)S
(space)210 3120 A
(left)168 3372 A
3582(on)S
(device)252 3708 A
4002(*/)S
5715 V
(00264)210 1122 A
(#define)294 1440 A
(ESPIPE)252 1776 A
(\(_SIGN)252 2364 A
(29\))126 2658 A
2868(/*)S
(invalid)294 2994 A
(seek)168 3330 A
3540(*/)S
5805 V
(00265)210 1122 A
(#define)294 1440 A
(EROFS)210 1776 A
(\(_SIGN)252 2364 A
(30\))126 2658 A
2868(/*)S
(read-only)378 2994 A
(file)168 3414 A
(system)252 3624 A
3918(*/)S
5895 V
(00266)210 1122 A
(#define)294 1440 A
(EMLINK)252 1776 A
(\(_SIGN)252 2364 A
(31\))126 2658 A
2868(/*)S
(too)126 2994 A
(many)168 3162 A
(links)210 3372 A
3624(*/)S
5985 V
(00267)210 1122 A
(#define)294 1440 A
(EPIPE)210 1776 A
(\(_SIGN)252 2364 A
(32\))126 2658 A
2868(/*)S
(broken)252 2994 A
(pipe)168 3288 A
3498(*/)S
6075 V
(00268)210 1122 A
(#define)294 1440 A
(EDOM)168 1776 A
(\(_SIGN)252 2364 A
(33\))126 2658 A
2868(/*)S
(domain)252 2994 A
(error)210 3288 A
(\(from)210 3792 A
(ANSI)168 4044 A
4254(C)S
(std\))168 4338 A
4548(*/)S
6165 V
(00269)210 1122 A
(#define)294 1440 A
(ERANGE)252 1776 A
(\(_SIGN)252 2364 A
(34\))126 2658 A
2868(/*)S
(result)252 2994 A
(too)126 3288 A
(large)210 3456 A
(\(from)210 3792 A
(ANSI)168 4044 A
4254(C)S
(std\))168 4338 A
4548(*/)S
6255 V
(00270)210 1122 A
(#define)294 1440 A
(EDEADLK)294 1776 A
(\(_SIGN)252 2364 A
(35\))126 2658 A
2868(/*)S
(resource)336 2994 A
(deadlock)336 3372 A
(avoided)294 3750 A
4086(*/)S
6345 V
(00271)210 1122 A
(#define)294 1440 A
(ENAMETOOLONG)504 1776 A
(\(_SIGN)252 2364 A
(36\))126 2658 A
2868(/*)S
(file)168 2994 A
(name)168 3204 A
(too)126 3414 A
(long)168 3582 A
3792(*/)S
6435 V
(00272)210 1122 A
(#define)294 1440 A
(ENOLCK)252 1776 A
(\(_SIGN)252 2364 A
(37\))126 2658 A
2868(/*)S
2994(no)S
(locks)210 3120 A
(available)378 3372 A
3792(*/)S
6525 V
(00273)210 1122 A
(#define)294 1440 A
(ENOSYS)252 1776 A
(\(_SIGN)252 2364 A
(38\))126 2658 A
2868(/*)S
(function)336 2994 A
(not)126 3372 A
(implemented)462 3540 A
4044(*/)S
6615 V
(00274)210 1122 A
(#define)294 1440 A
(ENOTEMPTY)378 1776 A
(\(_SIGN)252 2364 A
(39\))126 2658 A
2868(/*)S
(directory)378 2994 A
(not)126 3414 A
(empty)210 3582 A
3834(*/)S
6705 V
(00275)210 1122 A
6795 V
(00276)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(errors)252 2154 A
(relate)252 2448 A
2742(to)S
(networking.)462 2868 A
3372(*/)S
6885 V
(00277)210 1122 A
(#define)294 1440 A
(EPACKSIZE)378 1776 A
(\(_SIGN)252 2364 A
(50\))126 2658 A
2868(/*)S
(invalid)294 2994 A
(packet)252 3330 A
(size)168 3624 A
(for)126 3834 A
(some)168 4002 A
(protocol)336 4212 A
4590(*/)S
6975 V
(00278)210 1122 A
(#define)294 1440 A
(EOUTOFBUFS)420 1776 A
(\(_SIGN)252 2364 A
(51\))126 2658 A
2868(/*)S
(not)126 2994 A
(enough)252 3162 A
(buffers)294 3456 A
(left)168 3792 A
4002(*/)S
7065 V
(00279)210 1122 A
(#define)294 1440 A
(EBADIOCTL)378 1776 A
(\(_SIGN)252 2364 A
(52\))126 2658 A
2868(/*)S
(illegal)294 2994 A
(ioctl)210 3330 A
(for)126 3582 A
(device)252 3750 A
4044(*/)S
8418 V
EP
%%Page: 5 5
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2426(File:)S
2659(include/errno.h)S
12 B
4620(5)S
1755 V
7 LST
(00280)210 1122 A
(#define)294 1440 A
(EBADMODE)336 1776 A
(\(_SIGN)252 2364 A
(53\))126 2658 A
2868(/*)S
(badmode)294 2994 A
3330(in)S
(ioctl)210 3456 A
3708(*/)S
1845 V
(00281)210 1122 A
(#define)294 1440 A
(EWOULDBLOCK)462 1776 A
(\(_SIGN)252 2364 A
(54\))126 2658 A
1935 V
(00282)210 1122 A
(#define)294 1440 A
(EBADDEST)336 1776 A
(\(_SIGN)252 2364 A
(55\))126 2658 A
2868(/*)S
(not)126 2994 A
3162(a)S
(valid)210 3246 A
(destination)462 3498 A
(address)294 4002 A
4338(*/)S
2025 V
(00283)210 1122 A
(#define)294 1440 A
(EDSTNOTRCH)420 1776 A
(\(_SIGN)252 2364 A
(56\))126 2658 A
2868(/*)S
(destination)462 2994 A
(not)126 3498 A
(reachable)378 3666 A
4086(*/)S
2115 V
(00284)210 1122 A
(#define)294 1440 A
(EISCONN)294 1776 A
(\(_SIGN)252 2364 A
(57\))126 2658 A
2868(/*)S
(all)126 2994 A
(ready)210 3162 A
(connected)378 3414 A
3834(*/)S
2205 V
(00285)210 1122 A
(#define)294 1440 A
(EADDRINUSE)420 1776 A
(\(_SIGN)252 2364 A
(58\))126 2658 A
2868(/*)S
(address)294 2994 A
3330(in)S
(use)126 3456 A
3624(*/)S
2295 V
(00286)210 1122 A
(#define)294 1440 A
(ECONNREFUSED)504 1776 A
(\(_SIGN)252 2364 A
(59\))126 2658 A
2868(/*)S
(connection)420 2994 A
(refused)294 3456 A
3792(*/)S
2385 V
(00287)210 1122 A
(#define)294 1440 A
(ECONNRESET)420 1776 A
(\(_SIGN)252 2364 A
(60\))126 2658 A
2868(/*)S
(connection)420 2994 A
(reset)210 3456 A
3708(*/)S
2475 V
(00288)210 1122 A
(#define)294 1440 A
(ETIMEDOUT)378 1776 A
(\(_SIGN)252 2364 A
(61\))126 2658 A
2868(/*)S
(connection)420 2994 A
(timed)210 3456 A
(out)126 3708 A
3876(*/)S
2565 V
(00289)210 1122 A
(#define)294 1440 A
(EURG)168 1776 A
(\(_SIGN)252 2364 A
(62\))126 2658 A
2868(/*)S
(urgent)252 2994 A
(data)168 3288 A
(present)294 3498 A
3834(*/)S
2655 V
(00290)210 1122 A
(#define)294 1440 A
(ENOURG)252 1776 A
(\(_SIGN)252 2364 A
(63\))126 2658 A
2868(/*)S
2994(no)S
(urgent)252 3120 A
(data)168 3414 A
(present)294 3624 A
3960(*/)S
2745 V
(00291)210 1122 A
(#define)294 1440 A
(ENOTCONN)336 1776 A
(\(_SIGN)252 2364 A
(64\))126 2658 A
2868(/*)S
2994(no)S
(connection)420 3120 A
(\(yet)168 3582 A
3792(or)S
(anymore\))336 3918 A
4296(*/)S
2835 V
(00292)210 1122 A
(#define)294 1440 A
(ESHUTDOWN)378 1776 A
(\(_SIGN)252 2364 A
(65\))126 2658 A
2868(/*)S
2994(a)S
(write)210 3078 A
(call)168 3330 A
3540(to)S
3666(a)S
(shutdown)336 3750 A
(connection)420 4128 A
4590(*/)S
2925 V
(00293)210 1122 A
(#define)294 1440 A
(ENOCONN)294 1776 A
(\(_SIGN)252 2364 A
(66\))126 2658 A
2868(/*)S
2994(no)S
(such)168 3120 A
(connection)420 3330 A
3792(*/)S
3015 V
(00294)210 1122 A
(#define)294 1440 A
(EAFNOSUPPORT)504 1776 A
(\(_SIGN)252 2364 A
(67\))126 2658 A
2868(/*)S
(address)294 2994 A
(family)252 3330 A
(not)126 3624 A
(supported)378 3792 A
4212(*/)S
3105 V
(00295)210 1122 A
(#define)294 1440 A
(EPROTONOSUPPORT)630 1776 A
(\(_SIGN)252 2448 A
(68\))126 2742 A
2910(/*)S
(protocol)336 3036 A
(not)126 3414 A
(supported)378 3582 A
4002(by)S
4128(AF)S
4254(*/)S
3195 V
(00296)210 1122 A
(#define)294 1440 A
(EPROTOTYPE)420 1776 A
(\(_SIGN)252 2364 A
(69\))126 2658 A
2868(/*)S
(Protocol)336 2994 A
(wrong)210 3372 A
(type)168 3624 A
(for)126 3834 A
(socket)252 4002 A
4296(*/)S
3285 V
(00297)210 1122 A
(#define)294 1440 A
(EINPROGRESS)462 1776 A
(\(_SIGN)252 2364 A
(70\))126 2658 A
2868(/*)S
(Operation)378 2994 A
(now)126 3414 A
3582(in)S
(progress)336 3708 A
4086(*/)S
3375 V
(00298)210 1122 A
(#define)294 1440 A
(EADDRNOTAVAIL)546 1776 A
(\(_SIGN)252 2364 A
(71\))126 2658 A
2868(/*)S
(Can't)210 2994 A
(assign)252 3246 A
(requested)378 3540 A
(address)294 3960 A
4296(*/)S
3465 V
(00299)210 1122 A
(#define)294 1440 A
(EALREADY)336 1776 A
(\(_SIGN)252 2364 A
(72\))126 2658 A
2868(/*)S
(Connection)420 2994 A
(already)294 3456 A
3792(in)S
(progress)336 3918 A
4296(*/)S
3555 V
(00300)210 1122 A
(#define)294 1440 A
(EMSGSIZE)336 1776 A
(\(_SIGN)252 2364 A
(73\))126 2658 A
2868(/*)S
(Message)294 2994 A
(too)126 3330 A
(long)168 3498 A
3708(*/)S
3645 V
(00301)210 1122 A
3735 V
(00302)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(are)126 2154 A
(not)126 2322 A
(POSIX)210 2490 A
(errors,)294 2742 A
(but)126 3078 A
(they)168 3246 A
(can)126 3456 A
(still)210 3624 A
(happen.)294 3876 A
3825 V
(00303)210 1122 A
1482(*)S
(All)126 1566 A
1734(of)S
(these)210 1860 A
(are)126 2112 A
(generated)378 2280 A
2700(by)S
(the)126 2826 A
(kernel)252 2994 A
(and)126 3288 A
(relate)252 3456 A
3750(to)S
(message)294 3876 A
(passing.)336 4212 A
3915 V
(00304)210 1122 A
1482(*/)S
4005 V
(00305)210 1122 A
(#define)294 1440 A
(ELOCKED)294 1776 A
(\(_SIGN)252 2322 A
(101\))168 2616 A
2868(/*)S
(can't)210 2994 A
(send)168 3246 A
(message)294 3456 A
(due)126 3792 A
3960(to)S
(deadlock)336 4086 A
4464(*/)S
4095 V
(00306)210 1122 A
(#define)294 1440 A
(EBADCALL)336 1776 A
(\(_SIGN)252 2322 A
(102\))168 2616 A
2868(/*)S
(illegal)294 2994 A
(system)252 3330 A
(call)168 3624 A
(number)252 3834 A
4128(*/)S
4185 V
(00307)210 1122 A
(#define)294 1440 A
(EBADSRCDST)420 1776 A
(\(_SIGN)252 2322 A
(103\))168 2616 A
2868(/*)S
(bad)126 2994 A
(source)252 3162 A
3456(or)S
(destination)462 3582 A
(process)294 4086 A
4422(*/)S
4275 V
(00308)210 1122 A
(#define)294 1440 A
(ECALLDENIED)462 1776 A
(\(_SIGN)252 2322 A
(104\))168 2616 A
2868(/*)S
2994(no)S
(permission)420 3120 A
(for)126 3582 A
(system)252 3750 A
(call)168 4044 A
4254(*/)S
4365 V
(00309)210 1122 A
(#define)294 1440 A
(EDEADDST)336 1776 A
(\(_SIGN)252 2322 A
(105\))168 2616 A
2868(/*)S
(send)168 2994 A
(destination)462 3204 A
3708(is)S
(not)126 3834 A
(alive)210 4002 A
4254(*/)S
4455 V
(00310)210 1122 A
(#define)294 1440 A
(ENOTREADY)378 1776 A
(\(_SIGN)252 2322 A
(106\))168 2616 A
2868(/*)S
(source)252 2994 A
3288(or)S
(destination)462 3414 A
3918(is)S
(not)126 4044 A
(ready)210 4212 A
4464(*/)S
4545 V
(00311)210 1122 A
(#define)294 1440 A
(EBADREQUEST)462 1776 A
(\(_SIGN)252 2322 A
(107\))168 2616 A
2868(/*)S
(destination)462 2994 A
(cannot)252 3498 A
(handle)252 3792 A
(request)294 4086 A
4422(*/)S
4635 V
(00312)210 1122 A
(#define)294 1440 A
(EDONTREPLY)420 1776 A
(\(_SIGN)252 2322 A
(201\))168 2616 A
2868(/*)S
(pseudo-code:)504 2994 A
(don't)210 3540 A
(send)168 3792 A
4002(a)S
(reply)210 4086 A
4338(*/)S
4725 V
(00313)210 1122 A
4815 V
(00314)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_ERRNO_H)336 1860 A
2238(*/)S
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(include/unistd.h)672 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(00400)210 1122 A
1440(/*)S
(The)126 1566 A
(<unistd.h>)420 1734 A
(header)252 2196 A
(contains)336 2490 A
2868(a)S
(few)126 2952 A
(miscellaneous)546 3120 A
(manifest)336 3708 A
(constants.)420 4086 A
4548(*/)S
5445 V
(00401)210 1122 A
5535 V
(00402)210 1122 A
(#ifndef)294 1440 A
(_UNISTD_H)378 1776 A
5625 V
(00403)210 1122 A
(#define)294 1440 A
(_UNISTD_H)378 1776 A
5715 V
(00404)210 1122 A
5805 V
(00405)210 1122 A
(#ifndef)294 1440 A
(_TYPES_H)336 1776 A
5895 V
(00406)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
5985 V
(00407)210 1122 A
(#endif)252 1440 A
6075 V
(00408)210 1122 A
6165 V
(00409)210 1122 A
1440(/*)S
(Values)252 1566 A
(used)168 1860 A
2070(by)S
(access\(\).)378 2196 A
(POSIX)210 2658 A
(Table)210 2910 A
(2-8.)168 3162 A
3372(*/)S
6255 V
(00410)210 1122 A
(#define)294 1440 A
(F_OK)168 1776 A
2574(0)S
2784(/*)S
(test)168 2910 A
3120(if)S
(file)168 3246 A
(exists)252 3456 A
3750(*/)S
6345 V
(00411)210 1122 A
(#define)294 1440 A
(X_OK)168 1776 A
2574(1)S
2784(/*)S
(test)168 2910 A
3120(if)S
(file)168 3246 A
3456(is)S
(executable)420 3582 A
4044(*/)S
6435 V
(00412)210 1122 A
(#define)294 1440 A
(W_OK)168 1776 A
2574(2)S
2784(/*)S
(test)168 2910 A
3120(if)S
(file)168 3246 A
3456(is)S
(writable)336 3582 A
3960(*/)S
6525 V
(00413)210 1122 A
(#define)294 1440 A
(R_OK)168 1776 A
2574(4)S
2784(/*)S
(test)168 2910 A
3120(if)S
(file)168 3246 A
3456(is)S
(readable)336 3582 A
3960(*/)S
6615 V
(00414)210 1122 A
6705 V
(00415)210 1122 A
1440(/*)S
(Values)252 1566 A
(used)168 1860 A
(for)126 2070 A
(whence)252 2238 A
2532(in)S
(lseek\(fd,)378 2658 A
(offset,)294 3078 A
(whence\).)336 3414 A
(POSIX)210 3834 A
(Table)210 4086 A
(2-9.)168 4338 A
4548(*/)S
6795 V
(00416)210 1122 A
(#define)294 1440 A
(SEEK_SET)336 1776 A
2574(0)S
2784(/*)S
(offset)252 2910 A
3204(is)S
(absolute)336 3330 A
3750(*/)S
6885 V
(00417)210 1122 A
(#define)294 1440 A
(SEEK_CUR)336 1776 A
2574(1)S
2784(/*)S
(offset)252 2910 A
3204(is)S
(relative)336 3330 A
3708(to)S
(current)294 3834 A
(position)336 4170 A
4548(*/)S
6975 V
(00418)210 1122 A
(#define)294 1440 A
(SEEK_END)336 1776 A
2574(2)S
2784(/*)S
(offset)252 2910 A
3204(is)S
(relative)336 3330 A
3708(to)S
(end)126 3834 A
4002(of)S
(file)168 4128 A
4338(*/)S
7065 V
(00419)210 1122 A
8418 V
EP
%%Page: 6 6
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(6)S
11 R
2408(File:)S
2641(include/unistd.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(00420)210 1122 A
1440(/*)S
(This)168 1566 A
(value)210 1776 A
2028(is)S
(required)336 2154 A
2532(by)S
(POSIX)210 2658 A
(Table)210 2910 A
(2-10.)210 3162 A
3414(*/)S
1845 V
(00421)210 1122 A
(#define)294 1440 A
(_POSIX_VERSION)588 1776 A
(199009L)294 2406 A
2784(/*)S
(which)210 2910 A
(standard)336 3162 A
3540(is)S
(being)210 3666 A
(conformed)378 3918 A
4338(to)S
4464(*/)S
1935 V
(00422)210 1122 A
2025 V
(00423)210 1122 A
1440(/*)S
(These)210 1566 A
(three)210 1818 A
(definitions)462 2070 A
(are)126 2574 A
(required)336 2742 A
3120(by)S
(POSIX)210 3246 A
(Sec.)168 3498 A
(8.2.1.2.)336 3708 A
4086(*/)S
2115 V
(00424)210 1122 A
(#define)294 1440 A
(STDIN_FILENO)504 1776 A
2574(0)S
2784(/*)S
(file)168 2910 A
(descriptor)420 3120 A
(for)126 3582 A
(stdin)210 3750 A
4002(*/)S
2205 V
(00425)210 1122 A
(#define)294 1440 A
(STDOUT_FILENO)546 1776 A
2574(1)S
2784(/*)S
(file)168 2910 A
(descriptor)420 3120 A
(for)126 3582 A
(stdout)252 3750 A
4044(*/)S
2295 V
(00426)210 1122 A
(#define)294 1440 A
(STDERR_FILENO)546 1776 A
2574(2)S
2784(/*)S
(file)168 2910 A
(descriptor)420 3120 A
(for)126 3582 A
(stderr)252 3750 A
4044(*/)S
2385 V
(00427)210 1122 A
2475 V
(00428)210 1122 A
(#ifdef)252 1440 A
(_MINIX)252 1734 A
2565 V
(00429)210 1122 A
1440(/*)S
(How)126 1566 A
1734(to)S
(exit)168 1860 A
(the)126 2070 A
(system)252 2238 A
2532(or)S
(stop)168 2658 A
2868(a)S
(server)252 2952 A
(process.)336 3246 A
3624(*/)S
2655 V
(00430)210 1122 A
(#define)294 1440 A
(RBT_HALT)336 1776 A
2574(0)S
2745 V
(00431)210 1122 A
(#define)294 1440 A
(RBT_REBOOT)420 1776 A
2574(1)S
2835 V
(00432)210 1122 A
(#define)294 1440 A
(RBT_PANIC)378 1776 A
2574(2)S
2784(/*)S
2910(a)S
(server)252 2994 A
(panics)252 3288 A
3582(*/)S
2925 V
(00433)210 1122 A
(#define)294 1440 A
(RBT_MONITOR)462 1776 A
2574(3)S
2784(/*)S
(let)126 2910 A
(the)126 3078 A
(monitor)294 3246 A
3582(do)S
(this)168 3708 A
3918(*/)S
3015 V
(00434)210 1122 A
(#define)294 1440 A
(RBT_RESET)378 1776 A
2574(4)S
2784(/*)S
(hard)168 2910 A
(reset)210 3120 A
(the)126 3372 A
(system)252 3540 A
3834(*/)S
3105 V
(00435)210 1122 A
(#endif)252 1440 A
3195 V
(00436)210 1122 A
3285 V
(00437)210 1122 A
1440(/*)S
(What)168 1566 A
(system)252 1776 A
(info)168 2070 A
2280(to)S
(retrieve)336 2406 A
(with)168 2784 A
(sysgetinfo\(\).)546 2994 A
3582(*/)S
3375 V
(00438)210 1122 A
(#define)294 1440 A
(SI_KINFO)336 1776 A
2574(0)S
2784(/*)S
(get)126 2910 A
(kernel)252 3078 A
(info)168 3372 A
(via)126 3582 A
3750(PM)S
3876(*/)S
3465 V
(00439)210 1122 A
(#define)294 1440 A
(SI_PROC_ADDR)504 1776 A
2574(1)S
2784(/*)S
(address)294 2910 A
3246(of)S
(process)294 3372 A
(table)210 3708 A
3960(*/)S
3555 V
(00440)210 1122 A
(#define)294 1440 A
(SI_PROC_TAB)462 1776 A
2574(2)S
2784(/*)S
(copy)168 2910 A
3120(of)S
(entire)252 3246 A
(process)294 3540 A
(table)210 3876 A
4128(*/)S
3645 V
(00441)210 1122 A
(#define)294 1440 A
(SI_DMAP_TAB)462 1776 A
2574(3)S
2784(/*)S
(get)126 2910 A
(device)252 3078 A
(<->)126 3372 A
(driver)252 3540 A
(mappings)336 3834 A
4212(*/)S
3735 V
(00442)210 1122 A
3825 V
(00443)210 1122 A
1440(/*)S
(NULL)168 1566 A
(must)168 1776 A
1986(be)S
(defined)294 2112 A
2448(in)S
(<unistd.h>)420 2574 A
(according)378 3036 A
3456(to)S
(POSIX)210 3582 A
(Sec.)168 3834 A
(2.7.1.)252 4044 A
4338(*/)S
3915 V
(00444)210 1122 A
(#define)294 1440 A
(NULL)168 1776 A
(\(\(void)252 2112 A
(*\)0\))168 2406 A
4005 V
(00445)210 1122 A
4095 V
(00446)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(relate)252 2154 A
2448(to)S
(configurable)504 2574 A
(system)252 3120 A
(variables.)420 3414 A
(POSIX)210 3876 A
(Table)210 4128 A
(4-2.)168 4380 A
4590(*/)S
4185 V
(00447)210 1122 A
(#define)294 1440 A
(_SC_ARG_MAX)462 1776 A
2574(1)S
4275 V
(00448)210 1122 A
(#define)294 1440 A
(_SC_CHILD_MAX)546 1776 A
2574(2)S
4365 V
(00449)210 1122 A
(#define)294 1440 A
(_SC_CLOCKS_PER_SEC)756 1776 A
2574(3)S
4455 V
(00450)210 1122 A
(#define)294 1440 A
(_SC_CLK_TCK)462 1776 A
2574(3)S
4545 V
(00451)210 1122 A
(#define)294 1440 A
(_SC_NGROUPS_MAX)630 1776 A
2574(4)S
4635 V
(00452)210 1122 A
(#define)294 1440 A
(_SC_OPEN_MAX)504 1776 A
2574(5)S
4725 V
(00453)210 1122 A
(#define)294 1440 A
(_SC_JOB_CONTROL)630 1776 A
2574(6)S
4815 V
(00454)210 1122 A
(#define)294 1440 A
(_SC_SAVED_IDS)546 1776 A
2574(7)S
4905 V
(00455)210 1122 A
(#define)294 1440 A
(_SC_VERSION)462 1776 A
2574(8)S
4995 V
(00456)210 1122 A
(#define)294 1440 A
(_SC_STREAM_MAX)588 1776 A
2574(9)S
5085 V
(00457)210 1122 A
(#define)294 1440 A
(_SC_TZNAME_MAX)588 1776 A
2532(10)S
5175 V
(00458)210 1122 A
5265 V
(00459)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(relate)252 2154 A
2448(to)S
(configurable)504 2574 A
(pathname)336 3120 A
(variables.)420 3498 A
(POSIX)210 3960 A
(Table)210 4212 A
(5-2.)168 4464 A
4674(*/)S
5355 V
(00460)210 1122 A
(#define)294 1440 A
(_PC_LINK_MAX)504 1776 A
2574(1)S
2784(/*)S
(link)168 2910 A
(count)210 3120 A
3372(*/)S
5445 V
(00461)210 1122 A
(#define)294 1440 A
(_PC_MAX_CANON)546 1776 A
2574(2)S
2784(/*)S
(size)168 2910 A
3120(of)S
(the)126 3246 A
(canonical)378 3414 A
(input)210 3834 A
(queue)210 4086 A
4338(*/)S
5535 V
(00462)210 1122 A
(#define)294 1440 A
(_PC_MAX_INPUT)546 1776 A
2574(3)S
2784(/*)S
(type-ahead)420 2910 A
(buffer)252 3372 A
(size)168 3666 A
3876(*/)S
5625 V
(00463)210 1122 A
(#define)294 1440 A
(_PC_NAME_MAX)504 1776 A
2574(4)S
2784(/*)S
(file)168 2910 A
(name)168 3120 A
(size)168 3330 A
3540(*/)S
5715 V
(00464)210 1122 A
(#define)294 1440 A
(_PC_PATH_MAX)504 1776 A
2574(5)S
2784(/*)S
(pathname)336 2910 A
(size)168 3288 A
3498(*/)S
5805 V
(00465)210 1122 A
(#define)294 1440 A
(_PC_PIPE_BUF)504 1776 A
2574(6)S
2784(/*)S
(pipe)168 2910 A
(size)168 3120 A
3330(*/)S
5895 V
(00466)210 1122 A
(#define)294 1440 A
(_PC_NO_TRUNC)504 1776 A
2574(7)S
2784(/*)S
(treatment)378 2910 A
3330(of)S
(long)168 3456 A
(name)168 3666 A
(components)420 3876 A
4338(*/)S
5985 V
(00467)210 1122 A
(#define)294 1440 A
(_PC_VDISABLE)504 1776 A
2574(8)S
2784(/*)S
(tty)126 2910 A
(disable)294 3078 A
3414(*/)S
6075 V
(00468)210 1122 A
(#define)294 1440 A
(_PC_CHOWN_RESTRICTED)840 1776 A
2658(9)S
2784(/*)S
(chown)210 2910 A
(restricted)420 3162 A
3624(or)S
(not)126 3750 A
3918(*/)S
6165 V
(00469)210 1122 A
6255 V
(00470)210 1122 A
1440(/*)S
(POSIX)210 1566 A
(defines)294 1818 A
(several)294 2154 A
(options)294 2490 A
(that)168 2826 A
(may)126 3036 A
3204(be)S
(implemented)462 3330 A
3834(or)S
(not,)168 3960 A
4170(at)S
(the)126 4296 A
6345 V
(00471)210 1122 A
1482(*)S
(implementer's)546 1566 A
(whim.)210 2154 A
(This)168 2448 A
(implementer)462 2658 A
(has)126 3162 A
(made)168 3330 A
(the)126 3540 A
(following)378 3708 A
(choices:)336 4128 A
6435 V
(00472)210 1122 A
1482(*)S
6525 V
(00473)210 1122 A
1482(*)S
(_POSIX_JOB_CONTROL)756 1566 A
(not)126 2616 A
(defined:)336 2784 A
3456(no)S
(job)126 3582 A
(control)294 3750 A
6615 V
(00474)210 1122 A
1482(*)S
(_POSIX_SAVED_IDS)672 1566 A
(not)126 2616 A
(defined:)336 2784 A
3456(no)S
(saved)210 3582 A
(uid/gid)294 3834 A
6705 V
(00475)210 1122 A
1482(*)S
(_POSIX_NO_TRUNC)630 1566 A
(defined)294 2616 A
2952(as)S
(-1:)126 3078 A
(long)168 3456 A
(path)168 3666 A
(names)210 3876 A
(are)126 4128 A
(truncated)378 4296 A
6795 V
(00476)210 1122 A
1482(*)S
(_POSIX_CHOWN_RESTRICTED)966 1566 A
(defined:)336 2616 A
(you)126 3456 A
(can't)210 3624 A
(give)168 3876 A
(away)168 4086 A
(files)210 4296 A
6885 V
(00477)210 1122 A
1482(*)S
(_POSIX_VDISABLE)630 1566 A
(defined:)336 2616 A
(tty)126 3456 A
(functions)378 3624 A
(can)126 4044 A
4212(be)S
(disabled)336 4338 A
6975 V
(00478)210 1122 A
1482(*/)S
7065 V
(00479)210 1122 A
(#define)294 1440 A
(_POSIX_NO_TRUNC)630 1776 A
(\(-1\))168 2700 A
8418 V
EP
%%Page: 7 7
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2408(File:)S
2641(include/unistd.h)S
12 B
4620(7)S
1755 V
7 LST
(00480)210 1122 A
(#define)294 1440 A
(_POSIX_CHOWN_RESTRICTED)966 1776 A
2826(1)S
1845 V
(00481)210 1122 A
1935 V
(00482)210 1122 A
1440(/*)S
(Function)336 1566 A
(Prototypes.)462 1944 A
2448(*/)S
2025 V
(00483)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(_exit,)252 2154 A
(\(int)168 2448 A
(_status\))336 2658 A
4464(\);)S
2115 V
(00484)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(access,)294 2112 A
(\(const)252 2448 A
(char)168 2742 A
(*_path,)294 2952 A
(int)126 3288 A
(_amode\))294 3456 A
4464(\);)S
2205 V
(00485)210 1122 A
(_PROTOTYPE\()462 1440 A
(unsigned)336 1944 A
(int)126 2322 A
(alarm,)252 2490 A
(\(unsigned)378 2784 A
(int)126 3204 A
(_seconds\))378 3372 A
4464(\);)S
2295 V
(00486)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(chdir,)252 2112 A
(\(const)252 2406 A
(char)168 2700 A
(*_path\))294 2910 A
4464(\);)S
2385 V
(00487)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(fchdir,)294 2112 A
(\(int)168 2448 A
(fd\))126 2658 A
4464(\);)S
2475 V
(00488)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(chown,)252 2112 A
(\(const)252 2406 A
(char)168 2700 A
(*_path,)294 2910 A
(_mnx_Uid_t)420 3246 A
(_owner,)294 3708 A
(_mnx_Gid_t)420 4044 A
(_group\))294 4506 A
5136(\);)S
2565 V
(00489)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(close,)252 2112 A
(\(int)168 2406 A
(_fd\))168 2616 A
4464(\);)S
2655 V
(00490)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*ctermid,)378 2154 A
(\(char)210 2574 A
(*_s\))168 2826 A
4464(\);)S
2745 V
(00491)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*cuserid,)378 2154 A
(\(char)210 2574 A
(*_s\))168 2826 A
4464(\);)S
2835 V
(00492)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(dup,)168 2112 A
(\(int)168 2322 A
(_fd\))168 2532 A
4464(\);)S
2925 V
(00493)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(dup2,)210 2112 A
(\(int)168 2364 A
(_fd,)168 2574 A
(int)126 2784 A
(_fd2\))210 2952 A
4464(\);)S
3015 V
(00494)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(execl,)252 2112 A
(\(const)252 2406 A
(char)168 2700 A
(*_path,)294 2910 A
(const)210 3246 A
(char)168 3498 A
(*_arg,)252 3708 A
(...\))168 4002 A
4464(\);)S
3105 V
(00495)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(execle,)294 2112 A
(\(const)252 2448 A
(char)168 2742 A
(*_path,)294 2952 A
(const)210 3288 A
(char)168 3540 A
(*_arg,)252 3750 A
(...\))168 4044 A
4464(\);)S
3195 V
(00496)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(execlp,)294 2112 A
(\(const)252 2448 A
(char)168 2742 A
(*_file,)294 2952 A
(const)210 3288 A
(char)168 3540 A
(*arg,)210 3750 A
(...\))168 4002 A
4464(\);)S
3285 V
(00497)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(execv,)252 2112 A
(\(const)252 2406 A
(char)168 2700 A
(*_path,)294 2910 A
(char)168 3246 A
(*const)252 3456 A
(_argv[]\))336 3750 A
4464(\);)S
3375 V
(00498)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(execve,)294 2112 A
(\(const)252 2448 A
(char)168 2742 A
(*_path,)294 2952 A
(char)168 3288 A
(*const)252 3498 A
(_argv[],)336 3792 A
3465 V
(00499)210 1122 A
(char)168 3456 A
(*const)252 3666 A
(_envp[]\))336 3960 A
4464(\);)S
3555 V
(00500)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(execvp,)294 2112 A
(\(const)252 2448 A
(char)168 2742 A
(*_file,)294 2952 A
(char)168 3288 A
(*const)252 3498 A
(_argv[]\))336 3792 A
4464(\);)S
3645 V
(00501)210 1122 A
(_PROTOTYPE\()462 1440 A
(pid_t)210 1944 A
(fork,)210 2196 A
(\(void\))252 2448 A
4464(\);)S
3735 V
(00502)210 1122 A
(_PROTOTYPE\()462 1440 A
(long)168 1944 A
(fpathconf,)420 2154 A
(\(int)168 2616 A
(_fd,)168 2826 A
(int)126 3036 A
(_name\))252 3204 A
4464(\);)S
3825 V
(00503)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*getcwd,)336 2154 A
(\(char)210 2532 A
(*_buf,)252 2784 A
(size_t)252 3078 A
(_size\))252 3372 A
4464(\);)S
3915 V
(00504)210 1122 A
(_PROTOTYPE\()462 1440 A
(gid_t)210 1944 A
(getegid,)336 2196 A
(\(void\))252 2574 A
4464(\);)S
4005 V
(00505)210 1122 A
(_PROTOTYPE\()462 1440 A
(uid_t)210 1944 A
(geteuid,)336 2196 A
(\(void\))252 2574 A
4464(\);)S
4095 V
(00506)210 1122 A
(_PROTOTYPE\()462 1440 A
(gid_t)210 1944 A
(getgid,)294 2196 A
(\(void\))252 2532 A
4464(\);)S
4185 V
(00507)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(getgroups,)420 2112 A
(\(int)168 2574 A
(_gidsetsize,)504 2784 A
(gid_t)210 3330 A
(_grouplist[]\))546 3582 A
4464(\);)S
4275 V
(00508)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*getlogin,)420 2154 A
(\(void\))252 2616 A
4464(\);)S
4365 V
(00509)210 1122 A
(_PROTOTYPE\()462 1440 A
(pid_t)210 1944 A
(getpgrp,)336 2196 A
(\(void\))252 2574 A
4464(\);)S
4455 V
(00510)210 1122 A
(_PROTOTYPE\()462 1440 A
(pid_t)210 1944 A
(getpid,)294 2196 A
(\(void\))252 2532 A
4464(\);)S
4545 V
(00511)210 1122 A
(_PROTOTYPE\()462 1440 A
(pid_t)210 1944 A
(getppid,)336 2196 A
(\(void\))252 2574 A
4464(\);)S
4635 V
(00512)210 1122 A
(_PROTOTYPE\()462 1440 A
(uid_t)210 1944 A
(getuid,)294 2196 A
(\(void\))252 2532 A
4464(\);)S
4725 V
(00513)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(isatty,)294 2112 A
(\(int)168 2448 A
(_fd\))168 2658 A
4464(\);)S
4815 V
(00514)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(link,)210 2112 A
(\(const)252 2364 A
(char)168 2658 A
(*_existing,)462 2868 A
(const)210 3372 A
(char)168 3624 A
(*_new\))252 3834 A
4464(\);)S
4905 V
(00515)210 1122 A
(_PROTOTYPE\()462 1440 A
(off_t)210 1944 A
(lseek,)252 2196 A
(\(int)168 2490 A
(_fd,)168 2700 A
(off_t)210 2910 A
(_offset,)336 3162 A
(int)126 3540 A
(_whence\))336 3708 A
4464(\);)S
4995 V
(00516)210 1122 A
(_PROTOTYPE\()462 1440 A
(long)168 1944 A
(pathconf,)378 2154 A
(\(const)252 2574 A
(char)168 2868 A
(*_path,)294 3078 A
(int)126 3414 A
(_name\))252 3582 A
4464(\);)S
5085 V
(00517)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(pause,)252 2112 A
(\(void\))252 2406 A
4464(\);)S
5175 V
(00518)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(pipe,)210 2112 A
(\(int)168 2364 A
(_fildes[2]\))462 2574 A
4464(\);)S
5265 V
(00519)210 1122 A
(_PROTOTYPE\()462 1440 A
(ssize_t)294 1944 A
(read,)210 2280 A
(\(int)168 2532 A
(_fd,)168 2742 A
(void)168 2952 A
(*_buf,)252 3162 A
(size_t)252 3456 A
(_n\))126 3750 A
4464(\);)S
5355 V
(00520)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(rmdir,)252 2112 A
(\(const)252 2406 A
(char)168 2700 A
(*_path\))294 2910 A
4464(\);)S
5445 V
(00521)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(setgid,)294 2112 A
(\(_mnx_Gid_t)462 2448 A
(_gid\))210 2952 A
4464(\);)S
5535 V
(00522)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(setpgid,)336 2112 A
(\(pid_t)252 2490 A
(_pid,)210 2784 A
(pid_t)210 3036 A
(_pgid\))252 3288 A
4464(\);)S
5625 V
(00523)210 1122 A
(_PROTOTYPE\()462 1440 A
(pid_t)210 1944 A
(setsid,)294 2196 A
(\(void\))252 2532 A
4464(\);)S
5715 V
(00524)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(setuid,)294 2112 A
(\(_mnx_Uid_t)462 2448 A
(_uid\))210 2952 A
4464(\);)S
5805 V
(00525)210 1122 A
(_PROTOTYPE\()462 1440 A
(unsigned)336 1944 A
(int)126 2322 A
(sleep,)252 2490 A
(\(unsigned)378 2784 A
(int)126 3204 A
(_seconds\))378 3372 A
4464(\);)S
5895 V
(00526)210 1122 A
(_PROTOTYPE\()462 1440 A
(long)168 1944 A
(sysconf,)336 2154 A
(\(int)168 2532 A
(_name\))252 2742 A
4464(\);)S
5985 V
(00527)210 1122 A
(_PROTOTYPE\()462 1440 A
(pid_t)210 1944 A
(tcgetpgrp,)420 2196 A
(\(int)168 2658 A
(_fd\))168 2868 A
4464(\);)S
6075 V
(00528)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(tcsetpgrp,)420 2112 A
(\(int)168 2574 A
(_fd,)168 2784 A
(pid_t)210 2994 A
(_pgrp_id\))378 3246 A
4464(\);)S
6165 V
(00529)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*ttyname,)378 2154 A
(\(int)168 2574 A
(_fd\))168 2784 A
4464(\);)S
6255 V
(00530)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(unlink,)294 2112 A
(\(const)252 2448 A
(char)168 2742 A
(*_path\))294 2952 A
4464(\);)S
6345 V
(00531)210 1122 A
(_PROTOTYPE\()462 1440 A
(ssize_t)294 1944 A
(write,)252 2280 A
(\(int)168 2574 A
(_fd,)168 2784 A
(const)210 2994 A
(void)168 3246 A
(*_buf,)252 3456 A
(size_t)252 3750 A
(_n\))126 4044 A
4464(\);)S
6435 V
(00532)210 1122 A
6525 V
(00533)210 1122 A
1440(/*)S
(Open)168 1566 A
(Group)210 1776 A
(Base)168 2028 A
(Specifications)588 2238 A
(Issue)210 2868 A
3120(6)S
(\(not)168 3204 A
(complete\))378 3414 A
3834(*/)S
6615 V
(00534)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(symlink,)336 2112 A
(\(const)252 2490 A
(char)168 2784 A
(*path1,)294 2994 A
(const)210 3330 A
(char)168 3582 A
(*path2\))294 3792 A
4464(\);)S
6705 V
(00535)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(getopt,)294 2112 A
(\(int)168 2448 A
(_argc,)252 2658 A
(char)168 2952 A
(**_argv,)336 3162 A
(char)168 3540 A
(*_opts\))294 3750 A
4464(\);)S
6795 V
(00536)210 1122 A
(extern)252 1440 A
(char)168 1734 A
(*optarg;)336 1944 A
6885 V
(00537)210 1122 A
(extern)252 1440 A
(int)126 1734 A
(optind,)294 1902 A
(opterr,)294 2238 A
(optopt;)294 2574 A
6975 V
(00538)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(usleep,)294 2112 A
(\(useconds_t)462 2448 A
(_useconds\))420 2952 A
4464(\);)S
7065 V
(00539)210 1122 A
8418 V
EP
%%Page: 8 8
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(8)S
11 R
2408(File:)S
2641(include/unistd.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(00540)210 1122 A
(#ifdef)252 1440 A
(_MINIX)252 1734 A
1845 V
(00541)210 1122 A
(#ifndef)294 1440 A
(_TYPE_H)294 1776 A
1935 V
(00542)210 1122 A
(#include)336 1440 A
(<minix/type.h>)588 1818 A
2025 V
(00543)210 1122 A
(#endif)252 1440 A
2115 V
(00544)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(brk,)168 2112 A
(\(char)210 2322 A
(*_addr\))294 2574 A
4464(\);)S
2205 V
(00545)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(chroot,)294 2112 A
(\(const)252 2448 A
(char)168 2742 A
(*_name\))294 2952 A
4464(\);)S
2295 V
(00546)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(mknod,)252 2112 A
(\(const)252 2406 A
(char)168 2700 A
(*_name,)294 2910 A
(_mnx_Mode_t)462 3246 A
(_mode,)252 3750 A
(Dev_t)210 4044 A
(_addr\))252 4296 A
4800(\);)S
2385 V
(00547)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(mknod4,)294 2112 A
(\(const)252 2448 A
(char)168 2742 A
(*_name,)294 2952 A
(_mnx_Mode_t)462 3288 A
(_mode,)252 3792 A
(Dev_t)210 4086 A
(_addr,)252 4338 A
2475 V
(00548)210 1122 A
(long)168 1944 A
(_size\))252 2154 A
4464(\);)S
2565 V
(00549)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*mktemp,)336 2154 A
(\(char)210 2532 A
(*_template\))462 2784 A
4464(\);)S
2655 V
(00550)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(mount,)252 2112 A
(\(char)210 2406 A
(*_spec,)294 2658 A
(char)168 2994 A
(*_name,)294 3204 A
(int)126 3540 A
(_flag\))252 3708 A
4464(\);)S
2745 V
(00551)210 1122 A
(_PROTOTYPE\()462 1440 A
(long)168 1944 A
(ptrace,)294 2154 A
(\(int)168 2490 A
(_req,)210 2700 A
(pid_t)210 2952 A
(_pid,)210 3204 A
(long)168 3456 A
(_addr,)252 3666 A
(long)168 3960 A
(_data\))252 4170 A
4464(\);)S
2835 V
(00552)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*sbrk,)252 2154 A
(\(int)168 2448 A
(_incr\))252 2658 A
4464(\);)S
2925 V
(00553)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sync,)210 2112 A
(\(void\))252 2364 A
4464(\);)S
3015 V
(00554)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(fsync,)252 2112 A
(\(int)168 2406 A
(fd\))126 2616 A
4464(\);)S
3105 V
(00555)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(umount,)294 2112 A
(\(const)252 2448 A
(char)168 2742 A
(*_name\))294 2952 A
4464(\);)S
3195 V
(00556)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(reboot,)294 2112 A
(\(int)168 2448 A
(_how,)210 2658 A
(...\))168 2910 A
4464(\);)S
3285 V
(00557)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(gethostname,)504 2112 A
(\(char)210 2658 A
(*_hostname,)462 2910 A
(size_t)252 3414 A
(_len\))210 3708 A
4464(\);)S
3375 V
(00558)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(getdomainname,)588 2112 A
(\(char)210 2742 A
(*_domain,)378 2994 A
(size_t)252 3414 A
(_len\))210 3708 A
4464(\);)S
3465 V
(00559)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(ttyslot,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
3555 V
(00560)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(fttyslot,)378 2112 A
(\(int)168 2532 A
(_fd\))168 2742 A
4464(\);)S
3645 V
(00561)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*crypt,)294 2154 A
(\(const)252 2490 A
(char)168 2784 A
(*_key,)252 2994 A
(const)210 3288 A
(char)168 3540 A
(*_salt\))294 3750 A
4464(\);)S
3735 V
(00562)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(getsysinfo,)462 2112 A
(\(int)168 2616 A
(who,)168 2826 A
(int)126 3036 A
(what,)210 3204 A
(void)168 3456 A
(*where\))294 3666 A
4464(\);)S
3825 V
(00563)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(getprocnr,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
3915 V
(00564)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(findproc,)378 2112 A
(\(char)210 2532 A
(*proc_name,)462 2784 A
(int)126 3288 A
(*proc_nr\))378 3456 A
4464(\);)S
4005 V
(00565)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(allocmem,)378 2112 A
(\(phys_bytes)462 2532 A
(size,)210 3036 A
(phys_bytes)420 3288 A
(*base\))252 3750 A
4464(\);)S
4095 V
(00566)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(freemem,)336 2112 A
(\(phys_bytes)462 2490 A
(size,)210 2994 A
(phys_bytes)420 3246 A
(base\))210 3708 A
4464(\);)S
4185 V
(00567)210 1122 A
(#define)294 1440 A
(DEV_MAP)294 1776 A
2112(1)S
4275 V
(00568)210 1122 A
(#define)294 1440 A
(DEV_UNMAP)378 1776 A
2196(2)S
4365 V
(00569)210 1122 A
(#define)294 1440 A
(mapdriver\(driver,)714 1776 A
(device,)294 2532 A
(style\))252 2868 A
(devctl\(DEV_MAP,)630 3162 A
(driver,)294 3834 A
(device,)294 4170 A
(style\))252 4506 A
4455 V
(00570)210 1122 A
(#define)294 1440 A
(unmapdriver\(device\))798 1776 A
(devctl\(DEV_UNMAP,)714 2616 A
3372(0,)S
(device,)294 3498 A
3834(0\))S
4545 V
(00571)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(devctl,)294 2112 A
(\(int)168 2448 A
(ctl_req,)336 2658 A
(int)126 3036 A
(driver,)294 3204 A
(int)126 3540 A
(device,)294 3708 A
(int)126 4044 A
(style\)\);)336 4212 A
4635 V
(00572)210 1122 A
4725 V
(00573)210 1122 A
1440(/*)S
(For)126 1566 A
(compatibility)546 1734 A
(with)168 2322 A
(other)210 2532 A
(Unix)168 2784 A
(systems)294 2994 A
3330(*/)S
4815 V
(00574)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(getpagesize,)504 2112 A
(\(void\))252 2658 A
4464(\);)S
4905 V
(00575)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(setgroups,)420 2112 A
(\(int)168 2574 A
(ngroups,)336 2784 A
(const)210 3162 A
(gid_t)210 3414 A
(*gidset\))336 3666 A
4464(\);)S
4995 V
(00576)210 1122 A
5085 V
(00577)210 1122 A
(#endif)252 1440 A
5175 V
(00578)210 1122 A
5265 V
(00579)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(readlink,)378 2112 A
(\(const)252 2532 A
(char)168 2826 A
3036(*,)S
(char)168 3162 A
3372(*,)S
(int\)\);)252 3498 A
5355 V
(00580)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(getopt,)294 2112 A
(\(int,)210 2448 A
(char)168 2700 A
(**,)126 2910 A
(char)168 3078 A
(*\)\);)168 3288 A
5445 V
(00581)210 1122 A
(extern)252 1440 A
(int)126 1734 A
(optind,)294 1902 A
(opterr,)294 2238 A
(optopt;)294 2574 A
5535 V
(00582)210 1122 A
5625 V
(00583)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_UNISTD_H)378 1860 A
2280(*/)S
5895 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5985 V
(include/string.h)672 2676 A
6075 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6255 V
(00600)210 1122 A
1440(/*)S
(The)126 1566 A
(<string.h>)420 1734 A
(header)252 2196 A
(contains)336 2490 A
(prototypes)420 2868 A
(for)126 3330 A
(the)126 3498 A
(string)252 3666 A
(handling)336 3960 A
6345 V
(00601)210 1122 A
1482(*)S
(functions.)420 1566 A
6435 V
(00602)210 1122 A
1482(*/)S
6525 V
(00603)210 1122 A
6615 V
(00604)210 1122 A
(#ifndef)294 1440 A
(_STRING_H)378 1776 A
6705 V
(00605)210 1122 A
(#define)294 1440 A
(_STRING_H)378 1776 A
6795 V
(00606)210 1122 A
6885 V
(00607)210 1122 A
(#define)294 1440 A
(NULL)168 1776 A
(\(\(void)252 2112 A
(*\)0\))168 2406 A
6975 V
(00608)210 1122 A
7065 V
(00609)210 1122 A
(#ifndef)294 1440 A
(_SIZE_T)294 1776 A
8418 V
EP
%%Page: 9 9
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2417(File:)S
2650(include/string.h)S
12 B
4620(9)S
1755 V
7 LST
(00610)210 1122 A
(#define)294 1440 A
(_SIZE_T)294 1776 A
1845 V
(00611)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(int)126 2154 A
(size_t;)294 2322 A
2784(/*)S
(type)168 2910 A
(returned)336 3120 A
3498(by)S
(sizeof)252 3624 A
3918(*/)S
1935 V
(00612)210 1122 A
(#endif)252 1440 A
(/*_SIZE_T)378 1734 A
2154(*/)S
2025 V
(00613)210 1122 A
2115 V
(00614)210 1122 A
1440(/*)S
(Function)336 1566 A
(Prototypes.)462 1944 A
2448(*/)S
2205 V
(00615)210 1122 A
(#ifndef)294 1440 A
(_ANSI_H)294 1776 A
2295 V
(00616)210 1122 A
(#include)336 1440 A
(<ansi.h>)336 1818 A
2385 V
(00617)210 1122 A
(#endif)252 1440 A
2475 V
(00618)210 1122 A
2565 V
(00619)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(*memchr,)336 2154 A
(\(const)252 2532 A
(void)168 2826 A
(*_s,)168 3036 A
(int)126 3246 A
(_c,)126 3414 A
(size_t)252 3582 A
(_n\))126 3876 A
4464(\);)S
2655 V
(00620)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(memcmp,)294 2112 A
(\(const)252 2448 A
(void)168 2742 A
(*_s1,)210 2952 A
(const)210 3204 A
(void)168 3456 A
(*_s2,)210 3666 A
(size_t)252 3918 A
(_n\))126 4212 A
4464(\);)S
2745 V
(00621)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(*memcpy,)336 2154 A
(\(void)210 2532 A
(*_s1,)210 2784 A
(const)210 3036 A
(void)168 3288 A
(*_s2,)210 3498 A
(size_t)252 3750 A
(_n\))126 4044 A
4464(\);)S
2835 V
(00622)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(*memmove,)378 2154 A
(\(void)210 2574 A
(*_s1,)210 2826 A
(const)210 3078 A
(void)168 3330 A
(*_s2,)210 3540 A
(size_t)252 3792 A
(_n\))126 4086 A
4464(\);)S
2925 V
(00623)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(*memset,)336 2154 A
(\(void)210 2532 A
(*_s,)168 2784 A
(int)126 2994 A
(_c,)126 3162 A
(size_t)252 3330 A
(_n\))126 3624 A
4464(\);)S
3015 V
(00624)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*strcat,)336 2154 A
(\(char)210 2532 A
(*_s1,)210 2784 A
(const)210 3036 A
(char)168 3288 A
(*_s2\))210 3498 A
4464(\);)S
3105 V
(00625)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*strchr,)336 2154 A
(\(const)252 2532 A
(char)168 2826 A
(*_s,)168 3036 A
(int)126 3246 A
(_c\))126 3414 A
4464(\);)S
3195 V
(00626)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(strncmp,)336 2112 A
(\(const)252 2490 A
(char)168 2784 A
(*_s1,)210 2994 A
(const)210 3246 A
(char)168 3498 A
(*_s2,)210 3708 A
(size_t)252 3960 A
(_n\))126 4254 A
4464(\);)S
3285 V
(00627)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(strcmp,)294 2112 A
(\(const)252 2448 A
(char)168 2742 A
(*_s1,)210 2952 A
(const)210 3204 A
(char)168 3456 A
(*_s2\))210 3666 A
4464(\);)S
3375 V
(00628)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(strcoll,)336 2112 A
(\(const)252 2490 A
(char)168 2784 A
(*_s1,)210 2994 A
(const)210 3246 A
(char)168 3498 A
(*_s2\))210 3708 A
4464(\);)S
3465 V
(00629)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*strcpy,)336 2154 A
(\(char)210 2532 A
(*_s1,)210 2784 A
(const)210 3036 A
(char)168 3288 A
(*_s2\))210 3498 A
4464(\);)S
3555 V
(00630)210 1122 A
(_PROTOTYPE\()462 1440 A
(size_t)252 1944 A
(strcspn,)336 2238 A
(\(const)252 2616 A
(char)168 2910 A
(*_s1,)210 3120 A
(const)210 3372 A
(char)168 3624 A
(*_s2\))210 3834 A
4464(\);)S
3645 V
(00631)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*strerror,)420 2154 A
(\(int)168 2616 A
(_errnum\))336 2826 A
4464(\);)S
3735 V
(00632)210 1122 A
(_PROTOTYPE\()462 1440 A
(size_t)252 1944 A
(strlen,)294 2238 A
(\(const)252 2574 A
(char)168 2868 A
(*_s\))168 3078 A
4464(\);)S
3825 V
(00633)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*strncat,)378 2154 A
(\(char)210 2574 A
(*_s1,)210 2826 A
(const)210 3078 A
(char)168 3330 A
(*_s2,)210 3540 A
(size_t)252 3792 A
(_n\))126 4086 A
4464(\);)S
3915 V
(00634)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*strncpy,)378 2154 A
(\(char)210 2574 A
(*_s1,)210 2826 A
(const)210 3078 A
(char)168 3330 A
(*_s2,)210 3540 A
(size_t)252 3792 A
(_n\))126 4086 A
4464(\);)S
4005 V
(00635)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*strpbrk,)378 2154 A
(\(const)252 2574 A
(char)168 2868 A
(*_s1,)210 3078 A
(const)210 3330 A
(char)168 3582 A
(*_s2\))210 3792 A
4464(\);)S
4095 V
(00636)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*strrchr,)378 2154 A
(\(const)252 2574 A
(char)168 2868 A
(*_s,)168 3078 A
(int)126 3288 A
(_c\))126 3456 A
4464(\);)S
4185 V
(00637)210 1122 A
(_PROTOTYPE\()462 1440 A
(size_t)252 1944 A
(strspn,)294 2238 A
(\(const)252 2574 A
(char)168 2868 A
(*_s1,)210 3078 A
(const)210 3330 A
(char)168 3582 A
(*_s2\))210 3792 A
4464(\);)S
4275 V
(00638)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*strstr,)336 2154 A
(\(const)252 2532 A
(char)168 2826 A
(*_s1,)210 3036 A
(const)210 3288 A
(char)168 3540 A
(*_s2\))210 3750 A
4464(\);)S
4365 V
(00639)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*strtok,)336 2154 A
(\(char)210 2532 A
(*_s1,)210 2784 A
(const)210 3036 A
(char)168 3288 A
(*_s2\))210 3498 A
4464(\);)S
4455 V
(00640)210 1122 A
(_PROTOTYPE\()462 1440 A
(size_t)252 1944 A
(strxfrm,)336 2238 A
(\(char)210 2616 A
(*_s1,)210 2868 A
(const)210 3120 A
(char)168 3372 A
(*_s2,)210 3582 A
(size_t)252 3834 A
(_n\))126 4128 A
4464(\);)S
4545 V
(00641)210 1122 A
4635 V
(00642)210 1122 A
(#ifdef)252 1440 A
(_POSIX_SOURCE)546 1734 A
4725 V
(00643)210 1122 A
1440(/*)S
(Open)168 1566 A
(Group)210 1776 A
(Base)168 2028 A
(Specifications)588 2238 A
(Issue)210 2868 A
3120(6)S
(\(not)168 3204 A
(complete\))378 3414 A
3834(*/)S
4815 V
(00644)210 1122 A
(char)168 1482 A
(*strdup\(const)546 1692 A
(char)168 2280 A
(*_s1\);)252 2490 A
4905 V
(00645)210 1122 A
(#endif)252 1440 A
4995 V
(00646)210 1122 A
5085 V
(00647)210 1122 A
(#ifdef)252 1440 A
(_MINIX)252 1734 A
5175 V
(00648)210 1122 A
1440(/*)S
(For)126 1566 A
(backward)336 1734 A
(compatibility.)588 2112 A
2742(*/)S
5265 V
(00649)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*index,)294 2154 A
(\(const)252 2490 A
(char)168 2784 A
(*_s,)168 2994 A
(int)126 3204 A
(_charwanted\))504 3372 A
4464(\);)S
5355 V
(00650)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*rindex,)336 2154 A
(\(const)252 2532 A
(char)168 2826 A
(*_s,)168 3036 A
(int)126 3246 A
(_charwanted\))504 3414 A
4464(\);)S
5445 V
(00651)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(bcopy,)252 2154 A
(\(const)252 2448 A
(void)168 2742 A
(*_src,)252 2952 A
(void)168 3246 A
(*_dst,)252 3456 A
(size_t)252 3750 A
(_length\))336 4044 A
4464(\);)S
5535 V
(00652)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(bcmp,)210 2112 A
(\(const)252 2364 A
(void)168 2658 A
(*_s1,)210 2868 A
(const)210 3120 A
(void)168 3372 A
(*_s2,)210 3582 A
(size_t)252 3834 A
(_length\)\);)420 4128 A
5625 V
(00653)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(bzero,)252 2154 A
(\(void)210 2448 A
(*_dst,)252 2700 A
(size_t)252 2994 A
(_length\))336 3288 A
4464(\);)S
5715 V
(00654)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(*memccpy,)378 2154 A
(\(char)210 2574 A
(*_dst,)252 2826 A
(const)210 3120 A
(char)168 3372 A
(*_src,)252 3582 A
(int)126 3876 A
(_ucharstop,)462 4044 A
5805 V
(00655)210 1122 A
(size_t)252 3624 A
(_size\))252 3918 A
4464(\);)S
5895 V
(00656)210 1122 A
5985 V
(00657)210 1122 A
1440(/*)S
(Misc.)210 1566 A
(extra)210 1818 A
(functions)378 2070 A
2490(*/)S
6075 V
(00658)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(strcasecmp,)462 2112 A
(\(const)252 2616 A
(char)168 2910 A
(*_s1,)210 3120 A
(const)210 3372 A
(char)168 3624 A
(*_s2\))210 3834 A
4464(\);)S
6165 V
(00659)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(strncasecmp,)504 2112 A
(\(const)252 2658 A
(char)168 2952 A
(*_s1,)210 3162 A
(const)210 3414 A
(char)168 3666 A
(*_s2,)210 3876 A
6255 V
(00660)210 1122 A
(size_t)252 3792 A
(_len\))210 4086 A
4464(\);)S
6345 V
(00661)210 1122 A
(_PROTOTYPE\()462 1440 A
(size_t)252 1944 A
(strnlen,)336 2238 A
(\(const)252 2616 A
(char)168 2910 A
(*_s,)168 3120 A
(size_t)252 3330 A
(_n\))126 3624 A
4464(\);)S
6435 V
(00662)210 1122 A
(#endif)252 1440 A
6525 V
(00663)210 1122 A
6615 V
(00664)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_STRING_H)378 1860 A
2280(*/)S
8418 V
EP
%%Page: 10 10
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(10)S
11 R
2410(File:)S
2643(include/signal.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(include/signal.h)672 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(00700)210 1122 A
1440(/*)S
(The)126 1566 A
(<signal.h>)420 1734 A
(header)252 2196 A
(defines)294 2490 A
(all)126 2826 A
(the)126 2994 A
(ANSI)168 3162 A
(and)126 3372 A
(POSIX)210 3540 A
(signals.)336 3792 A
2295 V
(00701)210 1122 A
1482(*)S
(MINIX)210 1566 A
(supports)336 1818 A
(all)126 2196 A
(the)126 2364 A
(signals)294 2532 A
(required)336 2868 A
3246(by)S
(POSIX.)252 3372 A
(They)168 3666 A
(are)126 3876 A
(defined)294 4044 A
(below.)252 4380 A
2385 V
(00702)210 1122 A
1482(*)S
(Some)168 1566 A
(additional)420 1776 A
(signals)294 2238 A
(are)126 2574 A
(also)168 2742 A
(supported.)420 2952 A
2475 V
(00703)210 1122 A
1482(*/)S
2565 V
(00704)210 1122 A
2655 V
(00705)210 1122 A
(#ifndef)294 1440 A
(_SIGNAL_H)378 1776 A
2745 V
(00706)210 1122 A
(#define)294 1440 A
(_SIGNAL_H)378 1776 A
2835 V
(00707)210 1122 A
2925 V
(00708)210 1122 A
(#ifndef)294 1440 A
(_ANSI_H)294 1776 A
3015 V
(00709)210 1122 A
(#include)336 1440 A
(<ansi.h>)336 1818 A
3105 V
(00710)210 1122 A
(#endif)252 1440 A
3195 V
(00711)210 1122 A
(#ifdef)252 1440 A
(_POSIX_SOURCE)546 1734 A
3285 V
(00712)210 1122 A
(#ifndef)294 1440 A
(_TYPES_H)336 1776 A
3375 V
(00713)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
3465 V
(00714)210 1122 A
(#endif)252 1440 A
3555 V
(00715)210 1122 A
(#endif)252 1440 A
3645 V
(00716)210 1122 A
3735 V
(00717)210 1122 A
1440(/*)S
(Here)168 1566 A
(are)126 1776 A
(types)210 1944 A
(that)168 2196 A
(are)126 2406 A
(closely)294 2574 A
(associated)420 2910 A
(with)168 3372 A
(signal)252 3582 A
(handling.)378 3876 A
4296(*/)S
3825 V
(00718)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(sig_atomic_t;)546 1944 A
3915 V
(00719)210 1122 A
4005 V
(00720)210 1122 A
(#ifdef)252 1440 A
(_POSIX_SOURCE)546 1734 A
4095 V
(00721)210 1122 A
(#ifndef)294 1440 A
(_SIGSET_T)378 1776 A
4185 V
(00722)210 1122 A
(#define)294 1440 A
(_SIGSET_T)378 1776 A
4275 V
(00723)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(sigset_t;)378 2364 A
4365 V
(00724)210 1122 A
(#endif)252 1440 A
4455 V
(00725)210 1122 A
(#endif)252 1440 A
4545 V
(00726)210 1122 A
4635 V
(00727)210 1122 A
(#define)294 1440 A
(_NSIG)210 1776 A
2532(20)S
2784(/*)S
(number)252 2910 A
3204(of)S
(signals)294 3330 A
(used)168 3666 A
3876(*/)S
4725 V
(00728)210 1122 A
4815 V
(00729)210 1122 A
(#define)294 1440 A
(SIGHUP)252 1776 A
2574(1)S
2784(/*)S
(hangup)252 2910 A
3204(*/)S
4905 V
(00730)210 1122 A
(#define)294 1440 A
(SIGINT)252 1776 A
2574(2)S
2784(/*)S
(interrupt)378 2910 A
(\(DEL\))210 3330 A
3582(*/)S
4995 V
(00731)210 1122 A
(#define)294 1440 A
(SIGQUIT)294 1776 A
2574(3)S
2784(/*)S
(quit)168 2910 A
(\(ASCII)252 3120 A
(FS\))126 3414 A
3582(*/)S
5085 V
(00732)210 1122 A
(#define)294 1440 A
(SIGILL)252 1776 A
2574(4)S
2784(/*)S
(illegal)294 2910 A
(instruction)462 3246 A
3750(*/)S
5175 V
(00733)210 1122 A
(#define)294 1440 A
(SIGTRAP)294 1776 A
2574(5)S
2784(/*)S
(trace)210 2910 A
(trap)168 3162 A
(\(not)168 3372 A
(reset)210 3582 A
(when)168 3834 A
(caught\))294 4044 A
4380(*/)S
5265 V
(00734)210 1122 A
(#define)294 1440 A
(SIGABRT)294 1776 A
2574(6)S
2784(/*)S
(IOT)126 2910 A
(instruction)462 3078 A
3582(*/)S
5355 V
(00735)210 1122 A
(#define)294 1440 A
(SIGIOT)252 1776 A
2574(6)S
2784(/*)S
(SIGABRT)294 2910 A
(for)126 3246 A
(people)252 3414 A
(who)126 3708 A
(speak)210 3876 A
(PDP-11)252 4128 A
4422(*/)S
5445 V
(00736)210 1122 A
(#define)294 1440 A
(SIGUNUSED)378 1776 A
2574(7)S
2784(/*)S
(spare)210 2910 A
(code)168 3162 A
3372(*/)S
5535 V
(00737)210 1122 A
(#define)294 1440 A
(SIGFPE)252 1776 A
2574(8)S
2784(/*)S
(floating)336 2910 A
(point)210 3288 A
(exception)378 3540 A
3960(*/)S
5625 V
(00738)210 1122 A
(#define)294 1440 A
(SIGKILL)294 1776 A
2574(9)S
2784(/*)S
(kill)168 2910 A
(\(cannot)294 3120 A
3456(be)S
(caught)252 3582 A
3876(or)S
(ignored\))336 4002 A
4380(*/)S
5715 V
(00739)210 1122 A
(#define)294 1440 A
(SIGUSR1)294 1776 A
2532(10)S
2784(/*)S
(user)168 2910 A
(defined)294 3120 A
(signal)252 3456 A
3750(#)S
3834(1)S
3918(*/)S
5805 V
(00740)210 1122 A
(#define)294 1440 A
(SIGSEGV)294 1776 A
2532(11)S
2784(/*)S
(segmentation)504 2910 A
(violation)378 3456 A
3876(*/)S
5895 V
(00741)210 1122 A
(#define)294 1440 A
(SIGUSR2)294 1776 A
2532(12)S
2784(/*)S
(user)168 2910 A
(defined)294 3120 A
(signal)252 3456 A
3750(#)S
3834(2)S
3918(*/)S
5985 V
(00742)210 1122 A
(#define)294 1440 A
(SIGPIPE)294 1776 A
2532(13)S
2784(/*)S
(write)210 2910 A
3162(on)S
3288(a)S
(pipe)168 3372 A
(with)168 3582 A
3792(no)S
(one)126 3918 A
4086(to)S
(read)168 4212 A
4422(it)S
4548(*/)S
6075 V
(00743)210 1122 A
(#define)294 1440 A
(SIGALRM)294 1776 A
2532(14)S
2784(/*)S
(alarm)210 2910 A
(clock)210 3162 A
3414(*/)S
6165 V
(00744)210 1122 A
(#define)294 1440 A
(SIGTERM)294 1776 A
2532(15)S
2784(/*)S
(software)336 2910 A
(termination)462 3288 A
(signal)252 3792 A
(from)168 4086 A
(kill)168 4296 A
4506(*/)S
6255 V
(00745)210 1122 A
(#define)294 1440 A
(SIGCHLD)294 1776 A
2532(17)S
2784(/*)S
(child)210 2910 A
(process)294 3162 A
(terminated)420 3498 A
3960(or)S
(stopped)294 4086 A
4422(*/)S
6345 V
(00746)210 1122 A
6435 V
(00747)210 1122 A
(#define)294 1440 A
(SIGEMT)252 1776 A
2574(7)S
2784(/*)S
(obsolete)336 2910 A
3288(*/)S
6525 V
(00748)210 1122 A
(#define)294 1440 A
(SIGBUS)252 1776 A
2532(10)S
2784(/*)S
(obsolete)336 2910 A
3288(*/)S
6615 V
(00749)210 1122 A
6705 V
(00750)210 1122 A
1440(/*)S
(MINIX)210 1566 A
(specific)336 1818 A
(signals.)336 2196 A
(These)210 2574 A
(signals)294 2826 A
(are)126 3162 A
(not)126 3330 A
(used)168 3498 A
3708(by)S
(user)168 3834 A
(proceses,)378 4044 A
6795 V
(00751)210 1122 A
1482(*)S
(but)126 1566 A
(meant)210 1734 A
1986(to)S
(inform)252 2112 A
(system)252 2406 A
(processes,)420 2700 A
(like)168 3162 A
(the)126 3372 A
(PM,)126 3540 A
(about)210 3708 A
(system)252 3960 A
(events.)294 4254 A
6885 V
(00752)210 1122 A
1482(*/)S
6975 V
(00753)210 1122 A
(#define)294 1440 A
(SIGKMESS)336 1776 A
2532(18)S
2784(/*)S
(new)126 2910 A
(kernel)252 3078 A
(message)294 3372 A
3708(*/)S
7065 V
(00754)210 1122 A
(#define)294 1440 A
(SIGKSIG)294 1776 A
2532(19)S
2784(/*)S
(kernel)252 2910 A
(signal)252 3204 A
(pending)294 3498 A
3834(*/)S
8418 V
EP
%%Page: 11 11
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2410(File:)S
2643(include/signal.h)S
12 B
4560(11)S
1755 V
7 LST
(00755)210 1122 A
(#define)294 1440 A
(SIGKSTOP)336 1776 A
2532(20)S
2784(/*)S
(kernel)252 2910 A
(shutting)336 3204 A
(down)168 3582 A
3792(*/)S
1845 V
(00756)210 1122 A
1935 V
(00757)210 1122 A
1440(/*)S
(POSIX)210 1566 A
(requires)336 1818 A
(the)126 2196 A
(following)378 2364 A
(signals)294 2784 A
3120(to)S
3246(be)S
(defined,)336 3372 A
(even)168 3750 A
3960(if)S
(they)168 4086 A
(are)126 4296 A
2025 V
(00758)210 1122 A
1482(*)S
(not)126 1566 A
(supported.)420 1734 A
(Here)168 2238 A
(are)126 2448 A
(the)126 2616 A
(definitions,)504 2784 A
(but)126 3330 A
(they)168 3498 A
(are)126 3708 A
(not)126 3876 A
(supported.)420 4044 A
2115 V
(00759)210 1122 A
1482(*/)S
2205 V
(00760)210 1122 A
(#define)294 1440 A
(SIGCONT)294 1776 A
2532(18)S
2784(/*)S
(continue)336 2910 A
3288(if)S
(stopped)294 3414 A
3750(*/)S
2295 V
(00761)210 1122 A
(#define)294 1440 A
(SIGSTOP)294 1776 A
2532(19)S
2784(/*)S
(stop)168 2910 A
(signal)252 3120 A
3414(*/)S
2385 V
(00762)210 1122 A
(#define)294 1440 A
(SIGTSTP)294 1776 A
2532(20)S
2784(/*)S
(interactive)462 2910 A
(stop)168 3414 A
(signal)252 3624 A
3918(*/)S
2475 V
(00763)210 1122 A
(#define)294 1440 A
(SIGTTIN)294 1776 A
2532(21)S
2784(/*)S
(background)420 2910 A
(process)294 3372 A
(wants)210 3708 A
3960(to)S
(read)168 4086 A
4296(*/)S
2565 V
(00764)210 1122 A
(#define)294 1440 A
(SIGTTOU)294 1776 A
2532(22)S
2784(/*)S
(background)420 2910 A
(process)294 3372 A
(wants)210 3708 A
3960(to)S
(write)210 4086 A
4338(*/)S
2655 V
(00765)210 1122 A
2745 V
(00766)210 1122 A
1440(/*)S
(The)126 1566 A
(sighandler_t)504 1734 A
(type)168 2280 A
2490(is)S
(not)126 2616 A
(allowed)294 2784 A
(unless)252 3120 A
(_POSIX_SOURCE)546 3414 A
4002(is)S
(defined.)336 4128 A
4506(*/)S
2835 V
(00767)210 1122 A
(typedef)294 1440 A
(void)168 1776 A
(_PROTOTYPE\()462 1986 A
(\(*__sighandler_t\),)756 2490 A
(\(int\))210 3288 A
3540(\);)S
2925 V
(00768)210 1122 A
3015 V
(00769)210 1122 A
1440(/*)S
(Macros)252 1566 A
(used)168 1860 A
2070(as)S
(function)336 2196 A
(pointers.)378 2574 A
2994(*/)S
3105 V
(00770)210 1122 A
(#define)294 1440 A
(SIG_ERR)294 1776 A
(\(\(__sighandler_t\))714 2238 A
(-1\))126 2994 A
3456(/*)S
(error)210 3582 A
(return)252 3834 A
4128(*/)S
3195 V
(00771)210 1122 A
(#define)294 1440 A
(SIG_DFL)294 1776 A
(\(\(__sighandler_t\))714 2238 A
3036(0\))S
3456(/*)S
(default)294 3582 A
(signal)252 3918 A
(handling)336 4212 A
4590(*/)S
3285 V
(00772)210 1122 A
(#define)294 1440 A
(SIG_IGN)294 1776 A
(\(\(__sighandler_t\))714 2238 A
3036(1\))S
3456(/*)S
(ignore)252 3582 A
(signal)252 3876 A
4170(*/)S
3375 V
(00773)210 1122 A
(#define)294 1440 A
(SIG_HOLD)336 1776 A
(\(\(__sighandler_t\))714 2238 A
3036(2\))S
3456(/*)S
(block)210 3582 A
(signal)252 3834 A
4128(*/)S
3465 V
(00774)210 1122 A
(#define)294 1440 A
(SIG_CATCH)378 1776 A
(\(\(__sighandler_t\))714 2238 A
3036(3\))S
3456(/*)S
(catch)210 3582 A
(signal)252 3834 A
4128(*/)S
3555 V
(00775)210 1122 A
(#define)294 1440 A
(SIG_MESS)336 1776 A
(\(\(__sighandler_t\))714 2238 A
3036(4\))S
3456(/*)S
(pass)168 3582 A
3792(as)S
(message)294 3918 A
(\(MINIX\))294 4254 A
4590(*/)S
3645 V
(00776)210 1122 A
3735 V
(00777)210 1122 A
(#ifdef)252 1440 A
(_POSIX_SOURCE)546 1734 A
3825 V
(00778)210 1122 A
(struct)252 1440 A
(sigaction)378 1734 A
2154({)S
3915 V
(00779)210 1122 A
(__sighandler_t)588 1524 A
(sa_handler;)462 2154 A
2784(/*)S
(SIG_DFL,)336 2910 A
(SIG_IGN,)336 3288 A
3666(or)S
(pointer)294 3792 A
4128(to)S
(function)336 4254 A
4632(*/)S
4005 V
(00780)210 1122 A
(sigset_t)336 1524 A
(sa_mask;)336 1902 A
2784(/*)S
(signals)294 2910 A
3246(to)S
3372(be)S
(blocked)294 3498 A
(during)252 3834 A
(handler)294 4128 A
4464(*/)S
4095 V
(00781)210 1122 A
(int)126 1524 A
(sa_flags;)378 1692 A
2784(/*)S
(special)294 2910 A
(flags)210 3246 A
3498(*/)S
4185 V
(00782)210 1122 A
1440(};)S
4275 V
(00783)210 1122 A
4365 V
(00784)210 1122 A
1440(/*)S
(Fields)252 1566 A
(for)126 1860 A
(sa_flags.)378 2028 A
2448(*/)S
4455 V
(00785)210 1122 A
(#define)294 1440 A
(SA_ONSTACK)420 1776 A
(0x0001)252 2322 A
2784(/*)S
(deliver)294 2910 A
(signal)252 3246 A
3540(on)S
(alternate)378 3666 A
(stack)210 4086 A
4338(*/)S
4545 V
(00786)210 1122 A
(#define)294 1440 A
(SA_RESETHAND)504 1776 A
(0x0002)252 2322 A
2784(/*)S
(reset)210 2910 A
(signal)252 3162 A
(handler)294 3456 A
(when)168 3792 A
(signal)252 4002 A
(caught)252 4296 A
4590(*/)S
4635 V
(00787)210 1122 A
(#define)294 1440 A
(SA_NODEFER)420 1776 A
(0x0004)252 2322 A
2784(/*)S
(don't)210 2910 A
(block)210 3162 A
(signal)252 3414 A
(while)210 3708 A
(catching)336 3960 A
4338(it)S
4464(*/)S
4725 V
(00788)210 1122 A
(#define)294 1440 A
(SA_RESTART)420 1776 A
(0x0008)252 2322 A
2784(/*)S
(automatic)378 2910 A
(system)252 3330 A
(call)168 3624 A
(restart)294 3834 A
4170(*/)S
4815 V
(00789)210 1122 A
(#define)294 1440 A
(SA_SIGINFO)420 1776 A
(0x0010)252 2322 A
2784(/*)S
(extended)336 2910 A
(signal)252 3288 A
(handling)336 3582 A
3960(*/)S
4905 V
(00790)210 1122 A
(#define)294 1440 A
(SA_NOCLDWAIT)504 1776 A
(0x0020)252 2322 A
2784(/*)S
(don't)210 2910 A
(create)252 3162 A
(zombies)294 3456 A
3792(*/)S
4995 V
(00791)210 1122 A
(#define)294 1440 A
(SA_NOCLDSTOP)504 1776 A
(0x0040)252 2322 A
2784(/*)S
(don't)210 2910 A
(receive)294 3162 A
(SIGCHLD)294 3498 A
(when)168 3834 A
(child)210 4044 A
(stops)210 4296 A
4548(*/)S
5085 V
(00792)210 1122 A
5175 V
(00793)210 1122 A
1440(/*)S
(POSIX)210 1566 A
(requires)336 1818 A
(these)210 2196 A
(values)252 2448 A
(for)126 2742 A
(use)126 2910 A
(with)168 3078 A
(sigprocmask\(2\).)630 3288 A
3960(*/)S
5265 V
(00794)210 1122 A
(#define)294 1440 A
(SIG_BLOCK)378 1776 A
2574(0)S
2784(/*)S
(for)126 2910 A
(blocking)336 3078 A
(signals)294 3456 A
3792(*/)S
5355 V
(00795)210 1122 A
(#define)294 1440 A
(SIG_UNBLOCK)462 1776 A
2574(1)S
2784(/*)S
(for)126 2910 A
(unblocking)420 3078 A
(signals)294 3540 A
3876(*/)S
5445 V
(00796)210 1122 A
(#define)294 1440 A
(SIG_SETMASK)462 1776 A
2574(2)S
2784(/*)S
(for)126 2910 A
(setting)294 3078 A
(the)126 3414 A
(signal)252 3582 A
(mask)168 3876 A
4086(*/)S
5535 V
(00797)210 1122 A
(#define)294 1440 A
(SIG_INQUIRE)462 1776 A
2574(4)S
2784(/*)S
(for)126 2910 A
(internal)336 3078 A
(use)126 3456 A
(only)168 3624 A
3834(*/)S
5625 V
(00798)210 1122 A
(#endif)252 1440 A
1776(/*)S
(_POSIX_SOURCE)546 1902 A
2490(*/)S
5715 V
(00799)210 1122 A
5805 V
(00800)210 1122 A
1440(/*)S
(POSIX)210 1566 A
(and)126 1818 A
(ANSI)168 1986 A
(function)336 2196 A
(prototypes.)462 2574 A
3078(*/)S
5895 V
(00801)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(raise,)252 2112 A
(\(int)168 2406 A
(_sig\))210 2616 A
4464(\);)S
5985 V
(00802)210 1122 A
(_PROTOTYPE\()462 1440 A
(__sighandler_t)588 1944 A
(signal,)294 2574 A
(\(int)168 2910 A
(_sig,)210 3120 A
(__sighandler_t)588 3372 A
(_func\))252 4002 A
4464(\);)S
6075 V
(00803)210 1122 A
6165 V
(00804)210 1122 A
(#ifdef)252 1440 A
(_POSIX_SOURCE)546 1734 A
6255 V
(00805)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(kill,)210 2112 A
(\(pid_t)252 2364 A
(_pid,)210 2658 A
(int)126 2910 A
(_sig\))210 3078 A
4464(\);)S
6345 V
(00806)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sigaction,)420 2112 A
6435 V
(00807)210 1122 A
(\(int)168 1608 A
(_sig,)210 1818 A
(const)210 2070 A
(struct)252 2322 A
(sigaction)378 2616 A
(*_act,)252 3036 A
(struct)252 3330 A
(sigaction)378 3624 A
(*_oact\))294 4044 A
4464(\);)S
6525 V
(00808)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sigaddset,)420 2112 A
(\(sigset_t)378 2574 A
(*_set,)252 2994 A
(int)126 3288 A
(_sig\))210 3456 A
4464(\);)S
6615 V
(00809)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sigdelset,)420 2112 A
(\(sigset_t)378 2574 A
(*_set,)252 2994 A
(int)126 3288 A
(_sig\))210 3456 A
4464(\);)S
6705 V
(00810)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sigemptyset,)504 2112 A
(\(sigset_t)378 2658 A
(*_set\))252 3078 A
4464(\);)S
6795 V
(00811)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sigfillset,)462 2112 A
(\(sigset_t)378 2616 A
(*_set\))252 3036 A
4464(\);)S
6885 V
(00812)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sigismember,)504 2112 A
(\(const)252 2658 A
(sigset_t)336 2952 A
(*_set,)252 3330 A
(int)126 3624 A
(_sig\))210 3792 A
4464(\);)S
6975 V
(00813)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sigpending,)462 2112 A
(\(sigset_t)378 2616 A
(*_set\))252 3036 A
4464(\);)S
7065 V
(00814)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sigprocmask,)504 2112 A
8418 V
EP
%%Page: 12 12
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(12)S
11 R
2410(File:)S
2643(include/signal.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(00815)210 1122 A
(\(int)168 1944 A
(_how,)210 2154 A
(const)210 2406 A
(sigset_t)336 2658 A
(*_set,)252 3036 A
(sigset_t)336 3330 A
(*_oset\))294 3708 A
4464(\);)S
1845 V
(00816)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sigsuspend,)462 2112 A
(\(const)252 2616 A
(sigset_t)336 2910 A
(*_sigmask\))420 3288 A
4464(\);)S
1935 V
(00817)210 1122 A
(#endif)252 1440 A
2025 V
(00818)210 1122 A
2115 V
(00819)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_SIGNAL_H)378 1860 A
2280(*/)S
2295 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2385 V
(include/fcntl.h)630 2676 A
2475 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2655 V
(00900)210 1122 A
1440(/*)S
(The)126 1566 A
(<fcntl.h>)378 1734 A
(header)252 2154 A
2448(is)S
(needed)252 2574 A
2868(by)S
(the)126 2994 A
(open\(\))252 3162 A
(and)126 3456 A
(fcntl\(\))294 3624 A
(system)252 3960 A
(calls,)252 4254 A
2745 V
(00901)210 1122 A
1482(*)S
(which)210 1566 A
(have)168 1860 A
2070(a)S
(variety)294 2154 A
2490(of)S
(parameters)420 2616 A
(and)126 3078 A
(flags.)252 3246 A
(They)168 3582 A
(are)126 3792 A
(described)378 3960 A
(here.)210 4380 A
2835 V
(00902)210 1122 A
1482(*)S
(The)126 1566 A
(formats)294 1734 A
2070(of)S
(the)126 2196 A
(calls)210 2364 A
2616(to)S
(each)168 2742 A
2952(of)S
(these)210 3078 A
(are:)168 3330 A
2925 V
(00903)210 1122 A
1482(*)S
3015 V
(00904)210 1122 A
1482(*)S
(open\(path,)420 1776 A
(oflag)210 2238 A
([,mode]\))336 2490 A
(open)168 3120 A
3330(a)S
(file)168 3414 A
3105 V
(00905)210 1122 A
1482(*)S
(fcntl\(fd,)378 1776 A
(cmd)126 2196 A
([,arg]\))294 2364 A
(get)126 3120 A
3288(or)S
(set)126 3414 A
(file)168 3582 A
(attributes)420 3792 A
3195 V
(00906)210 1122 A
1482(*)S
3285 V
(00907)210 1122 A
1482(*/)S
3375 V
(00908)210 1122 A
3465 V
(00909)210 1122 A
(#ifndef)294 1440 A
(_FCNTL_H)336 1776 A
3555 V
(00910)210 1122 A
(#define)294 1440 A
(_FCNTL_H)336 1776 A
3645 V
(00911)210 1122 A
3735 V
(00912)210 1122 A
(#ifndef)294 1440 A
(_TYPES_H)336 1776 A
3825 V
(00913)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
3915 V
(00914)210 1122 A
(#endif)252 1440 A
4005 V
(00915)210 1122 A
4095 V
(00916)210 1122 A
1440(/*)S
(These)210 1566 A
(values)252 1818 A
(are)126 2112 A
(used)168 2280 A
(for)126 2490 A
(cmd)126 2658 A
2826(in)S
(fcntl\(\).)336 2952 A
(POSIX)210 3372 A
(Table)210 3624 A
(6-1.)168 3876 A
4128(*/)S
4185 V
(00917)210 1122 A
(#define)294 1440 A
(F_DUPFD)294 1776 A
2574(0)S
2784(/*)S
(duplicate)378 2910 A
(file)168 3330 A
(descriptor)420 3540 A
4002(*/)S
4275 V
(00918)210 1122 A
(#define)294 1440 A
(F_GETFD)294 1776 A
2574(1)S
2784(/*)S
(get)126 2910 A
(file)168 3078 A
(descriptor)420 3288 A
(flags)210 3750 A
4002(*/)S
4365 V
(00919)210 1122 A
(#define)294 1440 A
(F_SETFD)294 1776 A
2574(2)S
2784(/*)S
(set)126 2910 A
(file)168 3078 A
(descriptor)420 3288 A
(flags)210 3750 A
4002(*/)S
4455 V
(00920)210 1122 A
(#define)294 1440 A
(F_GETFL)294 1776 A
2574(3)S
2784(/*)S
(get)126 2910 A
(file)168 3078 A
(status)252 3288 A
(flags)210 3582 A
3834(*/)S
4545 V
(00921)210 1122 A
(#define)294 1440 A
(F_SETFL)294 1776 A
2574(4)S
2784(/*)S
(set)126 2910 A
(file)168 3078 A
(status)252 3288 A
(flags)210 3582 A
3834(*/)S
4635 V
(00922)210 1122 A
(#define)294 1440 A
(F_GETLK)294 1776 A
2574(5)S
2784(/*)S
(get)126 2910 A
(record)252 3078 A
(locking)294 3372 A
(information)462 3708 A
4212(*/)S
4725 V
(00923)210 1122 A
(#define)294 1440 A
(F_SETLK)294 1776 A
2574(6)S
2784(/*)S
(set)126 2910 A
(record)252 3078 A
(locking)294 3372 A
(information)462 3708 A
4212(*/)S
4815 V
(00924)210 1122 A
(#define)294 1440 A
(F_SETLKW)336 1776 A
2574(7)S
2784(/*)S
(set)126 2910 A
(record)252 3078 A
(locking)294 3372 A
(info;)210 3708 A
(wait)168 3960 A
4170(if)S
(blocked)294 4296 A
4632(*/)S
4905 V
(00925)210 1122 A
4995 V
(00926)210 1122 A
1440(/*)S
(File)168 1566 A
(descriptor)420 1776 A
(flags)210 2238 A
(used)168 2490 A
(for)126 2700 A
(fcntl\(\).)336 2868 A
(POSIX)210 3288 A
(Table)210 3540 A
(6-2.)168 3792 A
4002(*/)S
5085 V
(00927)210 1122 A
(#define)294 1440 A
(FD_CLOEXEC)420 1776 A
2574(1)S
2784(/*)S
(close)210 2910 A
3162(on)S
(exec)168 3288 A
(flag)168 3498 A
(for)126 3708 A
(third)210 3876 A
(arg)126 4128 A
4296(of)S
(fcntl)210 4422 A
4674(*/)S
5175 V
(00928)210 1122 A
5265 V
(00929)210 1122 A
1440(/*)S
(L_type)252 1566 A
(values)252 1860 A
(for)126 2154 A
(record)252 2322 A
(locking)294 2616 A
(with)168 2952 A
(fcntl\(\).)336 3162 A
(POSIX)210 3582 A
(Table)210 3834 A
(6-3.)168 4086 A
4296(*/)S
5355 V
(00930)210 1122 A
(#define)294 1440 A
(F_RDLCK)294 1776 A
2574(1)S
2784(/*)S
(shared)252 2910 A
3204(or)S
(read)168 3330 A
(lock)168 3540 A
3750(*/)S
5445 V
(00931)210 1122 A
(#define)294 1440 A
(F_WRLCK)294 1776 A
2574(2)S
2784(/*)S
(exclusive)378 2910 A
3330(or)S
(write)210 3456 A
(lock)168 3708 A
3918(*/)S
5535 V
(00932)210 1122 A
(#define)294 1440 A
(F_UNLCK)294 1776 A
2574(3)S
2784(/*)S
(unlock)252 2910 A
3204(*/)S
5625 V
(00933)210 1122 A
5715 V
(00934)210 1122 A
1440(/*)S
(Oflag)210 1566 A
(values)252 1818 A
(for)126 2112 A
(open\(\).)294 2280 A
(POSIX)210 2658 A
(Table)210 2910 A
(6-4.)168 3162 A
3372(*/)S
5805 V
(00935)210 1122 A
(#define)294 1440 A
(O_CREAT)294 1776 A
(00100)210 2406 A
2784(/*)S
(creat)210 2910 A
(file)168 3162 A
3372(if)S
3498(it)S
(doesn't)294 3624 A
(exist)210 3960 A
4212(*/)S
5895 V
(00936)210 1122 A
(#define)294 1440 A
(O_EXCL)252 1776 A
(00200)210 2406 A
2784(/*)S
(exclusive)378 2910 A
(use)126 3330 A
(flag)168 3498 A
3708(*/)S
5985 V
(00937)210 1122 A
(#define)294 1440 A
(O_NOCTTY)336 1776 A
(00400)210 2406 A
2784(/*)S
2910(do)S
(not)126 3036 A
(assign)252 3204 A
3498(a)S
(controlling)462 3582 A
(terminal)336 4086 A
4464(*/)S
6075 V
(00938)210 1122 A
(#define)294 1440 A
(O_TRUNC)294 1776 A
(01000)210 2406 A
2784(/*)S
(truncate)336 2910 A
(flag)168 3288 A
3498(*/)S
6165 V
(00939)210 1122 A
6255 V
(00940)210 1122 A
1440(/*)S
(File)168 1566 A
(status)252 1776 A
(flags)210 2070 A
(for)126 2322 A
(open\(\))252 2490 A
(and)126 2784 A
(fcntl\(\).)336 2952 A
(POSIX)210 3372 A
(Table)210 3624 A
(6-5.)168 3876 A
4086(*/)S
6345 V
(00941)210 1122 A
(#define)294 1440 A
(O_APPEND)336 1776 A
(02000)210 2406 A
2784(/*)S
(set)126 2910 A
(append)252 3078 A
(mode)168 3372 A
3582(*/)S
6435 V
(00942)210 1122 A
(#define)294 1440 A
(O_NONBLOCK)420 1776 A
(04000)210 2406 A
2784(/*)S
2910(no)S
(delay)210 3036 A
3288(*/)S
6525 V
(00943)210 1122 A
6615 V
(00944)210 1122 A
1440(/*)S
(File)168 1566 A
(access)252 1776 A
(modes)210 2070 A
(for)126 2322 A
(open\(\))252 2490 A
(and)126 2784 A
(fcntl\(\).)336 2952 A
(POSIX)210 3372 A
(Table)210 3624 A
(6-6.)168 3876 A
4086(*/)S
6705 V
(00945)210 1122 A
(#define)294 1440 A
(O_RDONLY)336 1776 A
2574(0)S
2784(/*)S
(open\(name,)420 2910 A
(O_RDONLY\))378 3372 A
(opens)210 3792 A
(read)168 4044 A
(only)168 4254 A
4464(*/)S
6795 V
(00946)210 1122 A
(#define)294 1440 A
(O_WRONLY)336 1776 A
2574(1)S
2784(/*)S
(open\(name,)420 2910 A
(O_WRONLY\))378 3372 A
(opens)210 3792 A
(write)210 4044 A
(only)168 4296 A
4506(*/)S
6885 V
(00947)210 1122 A
(#define)294 1440 A
(O_RDWR)252 1776 A
2574(2)S
2784(/*)S
(open\(name,)420 2910 A
(O_RDWR\))294 3372 A
(opens)210 3708 A
(read/write)420 3960 A
4422(*/)S
6975 V
(00948)210 1122 A
7065 V
(00949)210 1122 A
1440(/*)S
(Mask)168 1566 A
(for)126 1776 A
(use)126 1944 A
(with)168 2112 A
(file)168 2322 A
(access)252 2532 A
(modes.)252 2826 A
(POSIX)210 3162 A
(Table)210 3414 A
(6-7.)168 3666 A
3876(*/)S
8418 V
EP
%%Page: 13 13
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2441(File:)S
2674(include/fcntl.h)S
12 B
4560(13)S
1755 V
7 LST
(00950)210 1122 A
(#define)294 1440 A
(O_ACCMODE)378 1776 A
2532(03)S
2784(/*)S
(mask)168 2910 A
(for)126 3120 A
(file)168 3288 A
(access)252 3498 A
(modes)210 3792 A
4044(*/)S
1845 V
(00951)210 1122 A
1935 V
(00952)210 1122 A
1440(/*)S
(Struct)252 1566 A
(used)168 1860 A
(for)126 2070 A
(locking.)336 2238 A
(POSIX)210 2658 A
(Table)210 2910 A
(6-8.)168 3162 A
3372(*/)S
2025 V
(00953)210 1122 A
(struct)252 1440 A
(flock)210 1734 A
1986({)S
2115 V
(00954)210 1122 A
(short)210 1524 A
(l_type;)294 1776 A
2784(/*)S
(type:)210 2910 A
(F_RDLCK,)336 3162 A
(F_WRLCK,)336 3540 A
3918(or)S
(F_UNLCK)294 4044 A
4380(*/)S
2205 V
(00955)210 1122 A
(short)210 1524 A
(l_whence;)378 1776 A
2784(/*)S
(flag)168 2910 A
(for)126 3120 A
(starting)336 3288 A
(offset)252 3666 A
3960(*/)S
2295 V
(00956)210 1122 A
(off_t)210 1524 A
(l_start;)336 1776 A
2784(/*)S
(relative)336 2910 A
(offset)252 3288 A
3582(in)S
(bytes)210 3708 A
3960(*/)S
2385 V
(00957)210 1122 A
(off_t)210 1524 A
(l_len;)252 1776 A
2784(/*)S
(size;)210 2910 A
3162(if)S
3288(0,)S
(then)168 3414 A
(until)210 3624 A
(EOF)126 3876 A
4044(*/)S
2475 V
(00958)210 1122 A
(pid_t)210 1524 A
(l_pid;)252 1776 A
2784(/*)S
(process)294 2910 A
3246(id)S
3372(of)S
(the)126 3498 A
(locks')252 3666 A
(owner)210 3960 A
4212(*/)S
2565 V
(00959)210 1122 A
1440(};)S
2655 V
(00960)210 1122 A
2745 V
(00961)210 1122 A
1440(/*)S
(Function)336 1566 A
(Prototypes.)462 1944 A
2448(*/)S
2835 V
(00962)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(creat,)252 2112 A
(\(const)252 2406 A
(char)168 2700 A
(*_path,)294 2910 A
(_mnx_Mode_t)462 3246 A
(_mode\))252 3750 A
4464(\);)S
2925 V
(00963)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(fcntl,)252 2112 A
(\(int)168 2406 A
(_filedes,)378 2616 A
(int)126 3036 A
(_cmd,)210 3204 A
(...\))168 3456 A
4464(\);)S
3015 V
(00964)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(open,)210 2112 A
(\(const)252 2406 A
(char)168 2700 A
(*_path,)294 2910 A
(int)126 3246 A
(_oflag,)294 3414 A
(...\))168 3750 A
4464(\);)S
3105 V
(00965)210 1122 A
3195 V
(00966)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_FCNTL_H)336 1860 A
2238(*/)S
3645 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3735 V
(include/termios.h)714 2676 A
3825 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4005 V
(01000)210 1122 A
1440(/*)S
(The)126 1566 A
(<termios.h>)462 1734 A
(header)252 2238 A
2532(is)S
(used)168 2658 A
(for)126 2868 A
(controlling)462 3036 A
(tty)126 3540 A
(modes.)252 3708 A
4002(*/)S
4095 V
(01001)210 1122 A
4185 V
(01002)210 1122 A
(#ifndef)294 1440 A
(_TERMIOS_H)420 1776 A
4275 V
(01003)210 1122 A
(#define)294 1440 A
(_TERMIOS_H)420 1776 A
4365 V
(01004)210 1122 A
4455 V
(01005)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(short)210 2154 A
(tcflag_t;)378 2406 A
4545 V
(01006)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(char)168 2154 A
(cc_t;)210 2364 A
4635 V
(01007)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(int)126 2154 A
(speed_t;)336 2322 A
4725 V
(01008)210 1122 A
4815 V
(01009)210 1122 A
(#define)294 1440 A
(NCCS)168 1776 A
2574(20)S
2784(/*)S
(size)168 2910 A
3120(of)S
(cc_c)168 3246 A
(array,)252 3456 A
(some)168 3750 A
(extra)210 3960 A
(space)210 4212 A
4905 V
(01010)210 1122 A
2826(*)S
(for)126 2910 A
(extensions.)462 3078 A
3582(*/)S
4995 V
(01011)210 1122 A
5085 V
(01012)210 1122 A
1440(/*)S
(Primary)294 1566 A
(terminal)336 1902 A
(control)294 2280 A
(structure.)420 2616 A
(POSIX)210 3078 A
(Table)210 3330 A
(7-1.)168 3582 A
3792(*/)S
5175 V
(01013)210 1122 A
(struct)252 1440 A
(termios)294 1734 A
2070({)S
5265 V
(01014)210 1122 A
(tcflag_t)336 1524 A
(c_iflag;)336 1902 A
2784(/*)S
(input)210 2910 A
(modes)210 3162 A
3414(*/)S
5355 V
(01015)210 1122 A
(tcflag_t)336 1524 A
(c_oflag;)336 1902 A
2784(/*)S
(output)252 2910 A
(modes)210 3204 A
3456(*/)S
5445 V
(01016)210 1122 A
(tcflag_t)336 1524 A
(c_cflag;)336 1902 A
2784(/*)S
(control)294 2910 A
(modes)210 3246 A
3498(*/)S
5535 V
(01017)210 1122 A
(tcflag_t)336 1524 A
(c_lflag;)336 1902 A
2784(/*)S
(local)210 2910 A
(modes)210 3162 A
3414(*/)S
5625 V
(01018)210 1122 A
(speed_t)294 1524 A
(c_ispeed;)378 1902 A
2784(/*)S
(input)210 2910 A
(speed)210 3162 A
3414(*/)S
5715 V
(01019)210 1122 A
(speed_t)294 1524 A
(c_ospeed;)378 1902 A
2784(/*)S
(output)252 2910 A
(speed)210 3204 A
3456(*/)S
5805 V
(01020)210 1122 A
(cc_t)168 1524 A
(c_cc[NCCS];)462 1734 A
2784(/*)S
(control)294 2910 A
(characters)420 3246 A
3708(*/)S
5895 V
(01021)210 1122 A
1440(};)S
5985 V
(01022)210 1122 A
6075 V
(01023)210 1122 A
1440(/*)S
(Values)252 1566 A
(for)126 1860 A
(termios)294 2028 A
(c_iflag)294 2364 A
(bit)126 2700 A
(map.)168 2868 A
(POSIX)210 3120 A
(Table)210 3372 A
(7-2.)168 3624 A
3834(*/)S
6165 V
(01024)210 1122 A
(#define)294 1440 A
(BRKINT)252 1776 A
(0x0001)252 2448 A
2784(/*)S
(signal)252 2910 A
(interrupt)378 3204 A
3624(on)S
(break)210 3750 A
4002(*/)S
6255 V
(01025)210 1122 A
(#define)294 1440 A
(ICRNL)210 1776 A
(0x0002)252 2448 A
2784(/*)S
(map)126 2910 A
3078(CR)S
3204(to)S
3330(NL)S
3456(on)S
(input)210 3582 A
3834(*/)S
6345 V
(01026)210 1122 A
(#define)294 1440 A
(IGNBRK)252 1776 A
(0x0004)252 2448 A
2784(/*)S
(ignore)252 2910 A
(break)210 3204 A
3456(*/)S
6435 V
(01027)210 1122 A
(#define)294 1440 A
(IGNCR)210 1776 A
(0x0008)252 2448 A
2784(/*)S
(ignore)252 2910 A
3204(CR)S
3330(*/)S
6525 V
(01028)210 1122 A
(#define)294 1440 A
(IGNPAR)252 1776 A
(0x0010)252 2448 A
2784(/*)S
(ignore)252 2910 A
(characters)420 3204 A
(with)168 3666 A
(parity)252 3876 A
(errors)252 4170 A
4464(*/)S
6615 V
(01029)210 1122 A
(#define)294 1440 A
(INLCR)210 1776 A
(0x0020)252 2448 A
2784(/*)S
(map)126 2910 A
3078(NL)S
3204(to)S
3330(CR)S
3456(on)S
(input)210 3582 A
3834(*/)S
6705 V
(01030)210 1122 A
(#define)294 1440 A
(INPCK)210 1776 A
(0x0040)252 2448 A
2784(/*)S
(enable)252 2910 A
(input)210 3204 A
(parity)252 3456 A
(check)210 3750 A
4002(*/)S
6795 V
(01031)210 1122 A
(#define)294 1440 A
(ISTRIP)252 1776 A
(0x0080)252 2448 A
2784(/*)S
(mask)168 2910 A
(off)126 3120 A
(8th)126 3288 A
(bit)126 3456 A
3624(*/)S
6885 V
(01032)210 1122 A
(#define)294 1440 A
(IXOFF)210 1776 A
(0x0100)252 2448 A
2784(/*)S
(enable)252 2910 A
(start/stop)420 3204 A
(input)210 3666 A
(control)294 3918 A
4254(*/)S
6975 V
(01033)210 1122 A
(#define)294 1440 A
(IXON)168 1776 A
(0x0200)252 2448 A
2784(/*)S
(enable)252 2910 A
(start/stop)420 3204 A
(output)252 3666 A
(control)294 3960 A
4296(*/)S
7065 V
(01034)210 1122 A
(#define)294 1440 A
(PARMRK)252 1776 A
(0x0400)252 2448 A
2784(/*)S
(mark)168 2910 A
(parity)252 3120 A
(errors)252 3414 A
3708(in)S
(the)126 3834 A
(input)210 4002 A
(queue)210 4254 A
4506(*/)S
8418 V
EP
%%Page: 14 14
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(14)S
11 R
2376(File:)S
2609(include/termios.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(01035)210 1122 A
1845 V
(01036)210 1122 A
1440(/*)S
(Values)252 1566 A
(for)126 1860 A
(termios)294 2028 A
(c_oflag)294 2364 A
(bit)126 2700 A
(map.)168 2868 A
(POSIX)210 3120 A
(Sec.)168 3372 A
(7.1.2.3.)336 3582 A
3960(*/)S
1935 V
(01037)210 1122 A
(#define)294 1440 A
(OPOST)210 1776 A
(0x0001)252 2448 A
2784(/*)S
(perform)294 2910 A
(output)252 3246 A
(processing)420 3540 A
4002(*/)S
2025 V
(01038)210 1122 A
2115 V
(01039)210 1122 A
1440(/*)S
(Values)252 1566 A
(for)126 1860 A
(termios)294 2028 A
(c_cflag)294 2364 A
(bit)126 2700 A
(map.)168 2868 A
(POSIX)210 3120 A
(Table)210 3372 A
(7-3.)168 3624 A
3834(*/)S
2205 V
(01040)210 1122 A
(#define)294 1440 A
(CLOCAL)252 1776 A
(0x0001)252 2448 A
2784(/*)S
(ignore)252 2910 A
(modem)210 3204 A
(status)252 3456 A
(lines)210 3750 A
4002(*/)S
2295 V
(01041)210 1122 A
(#define)294 1440 A
(CREAD)210 1776 A
(0x0002)252 2448 A
2784(/*)S
(enable)252 2910 A
(receiver)336 3204 A
3582(*/)S
2385 V
(01042)210 1122 A
(#define)294 1440 A
(CSIZE)210 1776 A
(0x000C)252 2448 A
2784(/*)S
(number)252 2910 A
3204(of)S
(bits)168 3330 A
(per)126 3540 A
(character)378 3708 A
4128(*/)S
2475 V
(01043)210 1122 A
(#define)294 1440 A
(CS5)126 2112 A
(0x0000)252 2448 A
2784(/*)S
2910(if)S
(CSIZE)210 3036 A
3288(is)S
(CS5,)168 3414 A
(characters)420 3624 A
(are)126 4086 A
4254(5)S
(bits)168 4338 A
4548(*/)S
2565 V
(01044)210 1122 A
(#define)294 1440 A
(CS6)126 2112 A
(0x0004)252 2448 A
2784(/*)S
2910(if)S
(CSIZE)210 3036 A
3288(is)S
(CS6,)168 3414 A
(characters)420 3624 A
(are)126 4086 A
4254(6)S
(bits)168 4338 A
4548(*/)S
2655 V
(01045)210 1122 A
(#define)294 1440 A
(CS7)126 2112 A
(0x0008)252 2448 A
2784(/*)S
2910(if)S
(CSIZE)210 3036 A
3288(is)S
(CS7,)168 3414 A
(characters)420 3624 A
(are)126 4086 A
4254(7)S
(bits)168 4338 A
4548(*/)S
2745 V
(01046)210 1122 A
(#define)294 1440 A
(CS8)126 2112 A
(0x000C)252 2448 A
2784(/*)S
2910(if)S
(CSIZE)210 3036 A
3288(is)S
(CS8,)168 3414 A
(characters)420 3624 A
(are)126 4086 A
4254(8)S
(bits)168 4338 A
4548(*/)S
2835 V
(01047)210 1122 A
(#define)294 1440 A
(CSTOPB)252 1776 A
(0x0010)252 2448 A
2784(/*)S
(send)168 2910 A
3120(2)S
(stop)168 3204 A
(bits)168 3414 A
3624(if)S
(set,)168 3750 A
(else)168 3960 A
4170(1)S
4254(*/)S
2925 V
(01048)210 1122 A
(#define)294 1440 A
(HUPCL)210 1776 A
(0x0020)252 2448 A
2784(/*)S
(hang)168 2910 A
3120(up)S
3246(on)S
(last)168 3372 A
(close)210 3582 A
3834(*/)S
3015 V
(01049)210 1122 A
(#define)294 1440 A
(PARENB)252 1776 A
(0x0040)252 2448 A
2784(/*)S
(enable)252 2910 A
(parity)252 3204 A
3498(on)S
(output)252 3624 A
3918(*/)S
3105 V
(01050)210 1122 A
(#define)294 1440 A
(PARODD)252 1776 A
(0x0080)252 2448 A
2784(/*)S
(use)126 2910 A
(odd)126 3078 A
(parity)252 3246 A
3540(if)S
(set,)168 3666 A
(else)168 3876 A
(even)168 4086 A
4296(*/)S
3195 V
(01051)210 1122 A
3285 V
(01052)210 1122 A
1440(/*)S
(Values)252 1566 A
(for)126 1860 A
(termios)294 2028 A
(c_lflag)294 2364 A
(bit)126 2700 A
(map.)168 2868 A
(POSIX)210 3120 A
(Table)210 3372 A
(7-4.)168 3624 A
3834(*/)S
3375 V
(01053)210 1122 A
(#define)294 1440 A
(ECHO)168 1776 A
(0x0001)252 2448 A
2784(/*)S
(enable)252 2910 A
(echoing)294 3204 A
3540(of)S
(input)210 3666 A
(characters)420 3918 A
4380(*/)S
3465 V
(01054)210 1122 A
(#define)294 1440 A
(ECHOE)210 1776 A
(0x0002)252 2448 A
2784(/*)S
(echo)168 2910 A
(ERASE)210 3120 A
3372(as)S
(backspace)378 3498 A
3918(*/)S
3555 V
(01055)210 1122 A
(#define)294 1440 A
(ECHOK)210 1776 A
(0x0004)252 2448 A
2784(/*)S
(echo)168 2910 A
(KILL)168 3120 A
3330(*/)S
3645 V
(01056)210 1122 A
(#define)294 1440 A
(ECHONL)252 1776 A
(0x0008)252 2448 A
2784(/*)S
(echo)168 2910 A
3120(NL)S
3246(*/)S
3735 V
(01057)210 1122 A
(#define)294 1440 A
(ICANON)252 1776 A
(0x0010)252 2448 A
2784(/*)S
(canonical)378 2910 A
(input)210 3330 A
(\(erase)252 3582 A
(and)126 3876 A
(kill)168 4044 A
(enabled\))336 4254 A
4632(*/)S
3825 V
(01058)210 1122 A
(#define)294 1440 A
(IEXTEN)252 1776 A
(0x0020)252 2448 A
2784(/*)S
(enable)252 2910 A
(extended)336 3204 A
(functions)378 3582 A
4002(*/)S
3915 V
(01059)210 1122 A
(#define)294 1440 A
(ISIG)168 1776 A
(0x0040)252 2448 A
2784(/*)S
(enable)252 2910 A
(signals)294 3204 A
3540(*/)S
4005 V
(01060)210 1122 A
(#define)294 1440 A
(NOFLSH)252 1776 A
(0x0080)252 2448 A
2784(/*)S
(disable)294 2910 A
(flush)210 3246 A
(after)210 3498 A
(interrupt)378 3750 A
4170(or)S
(quit)168 4296 A
4506(*/)S
4095 V
(01061)210 1122 A
(#define)294 1440 A
(TOSTOP)252 1776 A
(0x0100)252 2448 A
2784(/*)S
(send)168 2910 A
(SIGTTOU)294 3120 A
(\(job)168 3456 A
(control,)336 3666 A
(not)126 4044 A
(implemented*/)546 4212 A
4185 V
(01062)210 1122 A
4275 V
(01063)210 1122 A
1440(/*)S
(Indices)294 1566 A
(into)168 1902 A
(c_cc)168 2112 A
(array.)252 2322 A
(Default)294 2658 A
(values)252 2994 A
3288(in)S
(parentheses.)504 3414 A
(POSIX)210 3960 A
(Table)210 4212 A
(7-5.)168 4464 A
4674(*/)S
4365 V
(01064)210 1122 A
(#define)294 1440 A
(VEOF)168 1776 A
2658(0)S
2784(/*)S
(cc_c[VEOF])420 2910 A
3372(=)S
(EOF)126 3456 A
(char)168 3624 A
(\(\303D\))168 3834 A
4044(*/)S
4455 V
(01065)210 1122 A
(#define)294 1440 A
(VEOL)168 1776 A
2658(1)S
2784(/*)S
(cc_c[VEOL])420 2910 A
3372(=)S
(EOL)126 3456 A
(char)168 3624 A
(\(undef\))294 3834 A
4170(*/)S
4545 V
(01066)210 1122 A
(#define)294 1440 A
(VERASE)252 1776 A
2658(2)S
2784(/*)S
(cc_c[VERASE])504 2910 A
3456(=)S
(ERASE)210 3540 A
(char)168 3792 A
(\(\303H\))168 4002 A
4212(*/)S
4635 V
(01067)210 1122 A
(#define)294 1440 A
(VINTR)210 1776 A
2658(3)S
2784(/*)S
(cc_c[VINTR])462 2910 A
3414(=)S
(INTR)168 3498 A
(char)168 3708 A
(\(DEL\))210 3918 A
4170(*/)S
4725 V
(01068)210 1122 A
(#define)294 1440 A
(VKILL)210 1776 A
2658(4)S
2784(/*)S
(cc_c[VKILL])462 2910 A
3414(=)S
(KILL)168 3498 A
(char)168 3708 A
(\(\303U\))168 3918 A
4128(*/)S
4815 V
(01069)210 1122 A
(#define)294 1440 A
(VMIN)168 1776 A
2658(5)S
2784(/*)S
(cc_c[VMIN])420 2910 A
3372(=)S
(MIN)126 3456 A
(value)210 3624 A
(for)126 3876 A
(timer)210 4044 A
4296(*/)S
4905 V
(01070)210 1122 A
(#define)294 1440 A
(VQUIT)210 1776 A
2658(6)S
2784(/*)S
(cc_c[VQUIT])462 2910 A
3414(=)S
(QUIT)168 3498 A
(char)168 3708 A
(\(\303\\\))168 3918 A
4128(*/)S
4995 V
(01071)210 1122 A
(#define)294 1440 A
(VTIME)210 1776 A
2658(7)S
2784(/*)S
(cc_c[VTIME])462 2910 A
3414(=)S
(TIME)168 3498 A
(value)210 3708 A
(for)126 3960 A
(timer)210 4128 A
4380(*/)S
5085 V
(01072)210 1122 A
(#define)294 1440 A
(VSUSP)210 1776 A
2658(8)S
2784(/*)S
(cc_c[VSUSP])462 2910 A
3414(=)S
(SUSP)168 3498 A
(\(\303Z,)168 3708 A
(ignored\))336 3918 A
4296(*/)S
5175 V
(01073)210 1122 A
(#define)294 1440 A
(VSTART)252 1776 A
2658(9)S
2784(/*)S
(cc_c[VSTART])504 2910 A
3456(=)S
(START)210 3540 A
(char)168 3792 A
(\(\303S\))168 4002 A
4212(*/)S
5265 V
(01074)210 1122 A
(#define)294 1440 A
(VSTOP)210 1776 A
2616(10)S
2784(/*)S
(cc_c[VSTOP])462 2910 A
3414(=)S
(STOP)168 3498 A
(char)168 3708 A
(\(\303Q\))168 3918 A
4128(*/)S
5355 V
(01075)210 1122 A
5445 V
(01076)210 1122 A
(#define)294 1440 A
(_POSIX_VDISABLE)630 1776 A
(\(cc_t\)0xFF)420 2532 A
3120(/*)S
(You)126 3246 A
(can't)210 3414 A
(even)168 3666 A
(generate)336 3876 A
(this)168 4254 A
5535 V
(01077)210 1122 A
3162(*)S
(character)378 3246 A
(with)168 3666 A
('normal')336 3876 A
(keyboards.)420 4254 A
5625 V
(01078)210 1122 A
3162(*)S
(But)126 3246 A
(some)168 3414 A
(language)336 3624 A
(specific)336 4002 A
(keyboards)378 4380 A
5715 V
(01079)210 1122 A
3162(*)S
(can)126 3246 A
(generate)336 3414 A
(0xFF.)210 3792 A
4044(It)S
(seems)210 4170 A
(that)168 4422 A
(all)126 4632 A
5805 V
(01080)210 1122 A
3162(*)S
(256)126 3246 A
(are)126 3414 A
(used,)210 3582 A
3834(so)S
(cc_t)168 3960 A
(should)252 4170 A
4464(be)S
4590(a)S
5895 V
(01081)210 1122 A
3162(*)S
(short...)336 3246 A
5985 V
(01082)210 1122 A
3162(*/)S
6075 V
(01083)210 1122 A
6165 V
(01084)210 1122 A
1440(/*)S
(Values)252 1566 A
(for)126 1860 A
(the)126 2028 A
(baud)168 2196 A
(rate)168 2406 A
(settings.)378 2616 A
(POSIX)210 3078 A
(Table)210 3330 A
(7-6.)168 3582 A
3792(*/)S
6255 V
(01085)210 1122 A
(#define)294 1440 A
1776(B0)S
(0x0000)252 2448 A
2784(/*)S
(hang)168 2910 A
3120(up)S
(the)126 3246 A
(line)168 3414 A
3624(*/)S
6345 V
(01086)210 1122 A
(#define)294 1440 A
(B50)126 1776 A
(0x1000)252 2448 A
2784(/*)S
2910(50)S
(baud)168 3036 A
3246(*/)S
6435 V
(01087)210 1122 A
(#define)294 1440 A
(B75)126 1776 A
(0x2000)252 2448 A
2784(/*)S
2910(75)S
(baud)168 3036 A
3246(*/)S
6525 V
(01088)210 1122 A
(#define)294 1440 A
(B110)168 1776 A
(0x3000)252 2448 A
2784(/*)S
(110)126 2910 A
(baud)168 3078 A
3288(*/)S
6615 V
(01089)210 1122 A
(#define)294 1440 A
(B134)168 1776 A
(0x4000)252 2448 A
2784(/*)S
(134.5)210 2910 A
(baud)168 3162 A
3372(*/)S
6705 V
(01090)210 1122 A
(#define)294 1440 A
(B150)168 1776 A
(0x5000)252 2448 A
2784(/*)S
(150)126 2910 A
(baud)168 3078 A
3288(*/)S
6795 V
(01091)210 1122 A
(#define)294 1440 A
(B200)168 1776 A
(0x6000)252 2448 A
2784(/*)S
(200)126 2910 A
(baud)168 3078 A
3288(*/)S
6885 V
(01092)210 1122 A
(#define)294 1440 A
(B300)168 1776 A
(0x7000)252 2448 A
2784(/*)S
(300)126 2910 A
(baud)168 3078 A
3288(*/)S
6975 V
(01093)210 1122 A
(#define)294 1440 A
(B600)168 1776 A
(0x8000)252 2448 A
2784(/*)S
(600)126 2910 A
(baud)168 3078 A
3288(*/)S
7065 V
(01094)210 1122 A
(#define)294 1440 A
(B1200)210 1776 A
(0x9000)252 2448 A
2784(/*)S
(1200)168 2910 A
(baud)168 3120 A
3330(*/)S
8418 V
EP
%%Page: 15 15
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2376(File:)S
2609(include/termios.h)S
12 B
4560(15)S
1755 V
7 LST
(01095)210 1122 A
(#define)294 1440 A
(B1800)210 1776 A
(0xA000)252 2448 A
2784(/*)S
(1800)168 2910 A
(baud)168 3120 A
3330(*/)S
1845 V
(01096)210 1122 A
(#define)294 1440 A
(B2400)210 1776 A
(0xB000)252 2448 A
2784(/*)S
(2400)168 2910 A
(baud)168 3120 A
3330(*/)S
1935 V
(01097)210 1122 A
(#define)294 1440 A
(B4800)210 1776 A
(0xC000)252 2448 A
2784(/*)S
(4800)168 2910 A
(baud)168 3120 A
3330(*/)S
2025 V
(01098)210 1122 A
(#define)294 1440 A
(B9600)210 1776 A
(0xD000)252 2448 A
2784(/*)S
(9600)168 2910 A
(baud)168 3120 A
3330(*/)S
2115 V
(01099)210 1122 A
(#define)294 1440 A
(B19200)252 1776 A
(0xE000)252 2448 A
2784(/*)S
(19200)210 2910 A
(baud)168 3162 A
3372(*/)S
2205 V
(01100)210 1122 A
(#define)294 1440 A
(B38400)252 1776 A
(0xF000)252 2448 A
2784(/*)S
(38400)210 2910 A
(baud)168 3162 A
3372(*/)S
2295 V
(01101)210 1122 A
2385 V
(01102)210 1122 A
1440(/*)S
(Optional)336 1566 A
(actions)294 1944 A
(for)126 2280 A
(tcsetattr\(\).)504 2448 A
(POSIX)210 3036 A
(Sec.)168 3288 A
(7.2.1.2.)336 3498 A
3876(*/)S
2475 V
(01103)210 1122 A
(#define)294 1440 A
(TCSANOW)294 1776 A
2574(1)S
2784(/*)S
(changes)294 2910 A
(take)168 3246 A
(effect)252 3456 A
(immediately)462 3750 A
4254(*/)S
2565 V
(01104)210 1122 A
(#define)294 1440 A
(TCSADRAIN)378 1776 A
2574(2)S
2784(/*)S
(changes)294 2910 A
(take)168 3246 A
(effect)252 3456 A
(after)210 3750 A
(output)252 4002 A
4296(is)S
(done)168 4422 A
4632(*/)S
2655 V
(01105)210 1122 A
(#define)294 1440 A
(TCSAFLUSH)378 1776 A
2574(3)S
2784(/*)S
(wait)168 2910 A
(for)126 3120 A
(output)252 3288 A
3582(to)S
(finish)252 3708 A
(and)126 4002 A
(flush)210 4170 A
(input)210 4422 A
4674(*/)S
2745 V
(01106)210 1122 A
2835 V
(01107)210 1122 A
1440(/*)S
(Queue_selector)588 1566 A
(values)252 2196 A
(for)126 2490 A
(tcflush\(\).)420 2658 A
(POSIX)210 3162 A
(Sec.)168 3414 A
(7.2.2.2.)336 3624 A
4002(*/)S
2925 V
(01108)210 1122 A
(#define)294 1440 A
(TCIFLUSH)336 1776 A
2574(1)S
2784(/*)S
(flush)210 2910 A
(accumulated)462 3162 A
(input)210 3666 A
(data)168 3918 A
4128(*/)S
3015 V
(01109)210 1122 A
(#define)294 1440 A
(TCOFLUSH)336 1776 A
2574(2)S
2784(/*)S
(flush)210 2910 A
(accumulated)462 3162 A
(output)252 3666 A
(data)168 3960 A
4170(*/)S
3105 V
(01110)210 1122 A
(#define)294 1440 A
(TCIOFLUSH)378 1776 A
2574(3)S
2784(/*)S
(flush)210 2910 A
(accumulated)462 3162 A
(input)210 3666 A
(and)126 3918 A
(output)252 4086 A
(data)168 4380 A
4590(*/)S
3195 V
(01111)210 1122 A
3285 V
(01112)210 1122 A
1440(/*)S
(Action)252 1566 A
(values)252 1860 A
(for)126 2154 A
(tcflow\(\).)378 2322 A
(POSIX)210 2784 A
(Sec.)168 3036 A
(7.2.2.2.)336 3246 A
3624(*/)S
3375 V
(01113)210 1122 A
(#define)294 1440 A
(TCOOFF)252 1776 A
2574(1)S
2784(/*)S
(suspend)294 2910 A
(output)252 3246 A
3540(*/)S
3465 V
(01114)210 1122 A
(#define)294 1440 A
(TCOON)210 1776 A
2574(2)S
2784(/*)S
(restart)294 2910 A
(suspended)378 3246 A
(output)252 3666 A
3960(*/)S
3555 V
(01115)210 1122 A
(#define)294 1440 A
(TCIOFF)252 1776 A
2574(3)S
2784(/*)S
(transmit)336 2910 A
3288(a)S
(STOP)168 3372 A
(character)378 3582 A
4002(on)S
(the)126 4128 A
(line)168 4296 A
4506(*/)S
3645 V
(01116)210 1122 A
(#define)294 1440 A
(TCION)210 1776 A
2574(4)S
2784(/*)S
(transmit)336 2910 A
3288(a)S
(START)210 3372 A
(character)378 3624 A
4044(on)S
(the)126 4170 A
(line)168 4338 A
4548(*/)S
3735 V
(01117)210 1122 A
3825 V
(01118)210 1122 A
1440(/*)S
(Function)336 1566 A
(Prototypes.)462 1944 A
2448(*/)S
3915 V
(01119)210 1122 A
(#ifndef)294 1440 A
(_ANSI_H)294 1776 A
4005 V
(01120)210 1122 A
(#include)336 1440 A
(<ansi.h>)336 1818 A
4095 V
(01121)210 1122 A
(#endif)252 1440 A
4185 V
(01122)210 1122 A
4275 V
(01123)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(tcsendbreak,)504 2112 A
(\(int)168 2658 A
(_fildes,)336 2868 A
(int)126 3246 A
(_duration\))420 3414 A
4674(\);)S
4365 V
(01124)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(tcdrain,)336 2112 A
(\(int)168 2490 A
(_filedes\))378 2700 A
4674(\);)S
4455 V
(01125)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(tcflush,)336 2112 A
(\(int)168 2490 A
(_filedes,)378 2700 A
(int)126 3120 A
(_queue_selector\))672 3288 A
4674(\);)S
4545 V
(01126)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(tcflow,)294 2112 A
(\(int)168 2448 A
(_filedes,)378 2658 A
(int)126 3078 A
(_action\))336 3246 A
4674(\);)S
4635 V
(01127)210 1122 A
(_PROTOTYPE\()462 1440 A
(speed_t)294 1944 A
(cfgetispeed,)504 2280 A
(\(const)252 2826 A
(struct)252 3120 A
(termios)294 3414 A
(*_termios_p\))504 3750 A
4674(\);)S
4725 V
(01128)210 1122 A
(_PROTOTYPE\()462 1440 A
(speed_t)294 1944 A
(cfgetospeed,)504 2280 A
(\(const)252 2826 A
(struct)252 3120 A
(termios)294 3414 A
(*_termios_p\))504 3750 A
4674(\);)S
4815 V
(01129)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(cfsetispeed,)504 2112 A
(\(struct)294 2658 A
(termios)294 2994 A
(*_termios_p,)504 3330 A
(speed_t)294 3876 A
(_speed\))294 4212 A
4674(\);)S
4905 V
(01130)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(cfsetospeed,)504 2112 A
(\(struct)294 2658 A
(termios)294 2994 A
(*_termios_p,)504 3330 A
(speed_t)294 3876 A
(_speed\))294 4212 A
4674(\);)S
4995 V
(01131)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(tcgetattr,)420 2112 A
(\(int)168 2574 A
(_filedes,)378 2784 A
(struct)252 3204 A
(termios)294 3498 A
(*_termios_p\))504 3834 A
4674(\);)S
5085 V
(01132)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(tcsetattr,)420 2112 A
2574(\\)S
5175 V
(01133)210 1122 A
(\(int)168 1776 A
(_filedes,)378 1986 A
(int)126 2406 A
(_opt_actions,)546 2574 A
(const)210 3162 A
(struct)252 3414 A
(termios)294 3708 A
(*_termios_p\))504 4044 A
4674(\);)S
5265 V
(01134)210 1122 A
5355 V
(01135)210 1122 A
(#define)294 1440 A
(cfgetispeed\(termios_p\))924 1776 A
(\(\(termios_p\)->c_ispeed\))966 3120 A
5445 V
(01136)210 1122 A
(#define)294 1440 A
(cfgetospeed\(termios_p\))924 1776 A
(\(\(termios_p\)->c_ospeed\))966 3120 A
5535 V
(01137)210 1122 A
(#define)294 1440 A
(cfsetispeed\(termios_p,)924 1776 A
(speed\))252 2742 A
(\(\(termios_p\)->c_ispeed)924 3120 A
4086(=)S
(\(speed\),)336 4170 A
4548(0\))S
5625 V
(01138)210 1122 A
(#define)294 1440 A
(cfsetospeed\(termios_p,)924 1776 A
(speed\))252 2742 A
(\(\(termios_p\)->c_ospeed)924 3120 A
4086(=)S
(\(speed\),)336 4170 A
4548(0\))S
5715 V
(01139)210 1122 A
5805 V
(01140)210 1122 A
(#ifdef)252 1440 A
(_MINIX)252 1734 A
5895 V
(01141)210 1122 A
1440(/*)S
(Here)168 1566 A
(are)126 1776 A
(the)126 1944 A
(local)210 2112 A
(extensions)420 2364 A
2826(to)S
(the)126 2952 A
(POSIX)210 3120 A
(standard)336 3372 A
(for)126 3750 A
(Minix.)252 3918 A
(Posix)210 4212 A
5985 V
(01142)210 1122 A
1482(*)S
(conforming)420 1566 A
(programs)336 2028 A
(are)126 2406 A
(not)126 2574 A
(able)168 2742 A
2952(to)S
(access)252 3078 A
(these,)252 3372 A
(and)126 3666 A
(therefore)378 3834 A
(they)168 4254 A
(are)126 4464 A
6075 V
(01143)210 1122 A
1482(*)S
(only)168 1566 A
(defined)294 1776 A
(when)168 2112 A
2322(a)S
(Minix)210 2406 A
(program)294 2658 A
2994(is)S
(compiled.)378 3120 A
6165 V
(01144)210 1122 A
1482(*/)S
6255 V
(01145)210 1122 A
6345 V
(01146)210 1122 A
1440(/*)S
(Extensions)420 1566 A
2028(to)S
(the)126 2154 A
(termios)294 2322 A
(c_iflag)294 2658 A
(bit)126 2994 A
(map.)168 3162 A
3414(*/)S
6435 V
(01147)210 1122 A
(#define)294 1440 A
(IXANY)210 1776 A
(0x0800)252 2448 A
2784(/*)S
(allow)210 2910 A
(any)126 3162 A
(key)126 3330 A
3498(to)S
(continue)336 3624 A
(ouptut)252 4002 A
4296(*/)S
6525 V
(01148)210 1122 A
6615 V
(01149)210 1122 A
1440(/*)S
(Extensions)420 1566 A
2028(to)S
(the)126 2154 A
(termios)294 2322 A
(c_oflag)294 2658 A
(bit)126 2994 A
(map.)168 3162 A
(They)168 3372 A
(are)126 3582 A
(only)168 3750 A
(active)252 3960 A
(iff)126 4254 A
6705 V
(01150)210 1122 A
1482(*)S
(OPOST)210 1566 A
1818(is)S
(enabled.)336 1944 A
2322(*/)S
6795 V
(01151)210 1122 A
(#define)294 1440 A
(ONLCR)210 1776 A
(0x0002)252 2448 A
2784(/*)S
(Map)126 2910 A
3078(NL)S
3204(to)S
(CR-NL)210 3330 A
3582(on)S
(output)252 3708 A
4002(*/)S
6885 V
(01152)210 1122 A
(#define)294 1440 A
(XTABS)210 1776 A
(0x0004)252 2448 A
2784(/*)S
(Expand)252 2910 A
(tabs)168 3204 A
3414(to)S
(spaces)252 3540 A
3834(*/)S
6975 V
(01153)210 1122 A
(#define)294 1440 A
(ONOEOT)252 1776 A
(0x0008)252 2448 A
2784(/*)S
(discard)294 2910 A
(EOT's)210 3246 A
(\(\303D\))168 3498 A
3708(on)S
(output\))294 3834 A
4170(*/)S
7065 V
(01154)210 1122 A
8418 V
EP
%%Page: 16 16
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(16)S
11 R
2376(File:)S
2609(include/termios.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(01155)210 1122 A
1440(/*)S
(Extensions)420 1566 A
2028(to)S
(the)126 2154 A
(termios)294 2322 A
(c_lflag)294 2658 A
(bit)126 2994 A
(map.)168 3162 A
3414(*/)S
1845 V
(01156)210 1122 A
(#define)294 1440 A
(LFLUSHO)294 1776 A
(0x0200)252 2448 A
2784(/*)S
(Flush)210 2910 A
(output.)294 3162 A
3498(*/)S
1935 V
(01157)210 1122 A
2025 V
(01158)210 1122 A
1440(/*)S
(Extensions)420 1566 A
2028(to)S
(the)126 2154 A
(c_cc)168 2322 A
(array.)252 2532 A
2826(*/)S
2115 V
(01159)210 1122 A
(#define)294 1440 A
(VREPRINT)336 1776 A
2532(11)S
2784(/*)S
(cc_c[VREPRINT])588 2910 A
(\(\303R\))168 3540 A
3750(*/)S
2205 V
(01160)210 1122 A
(#define)294 1440 A
(VLNEXT)252 1776 A
2532(12)S
2784(/*)S
(cc_c[VLNEXT])504 2910 A
(\(\303V\))168 3456 A
3666(*/)S
2295 V
(01161)210 1122 A
(#define)294 1440 A
(VDISCARD)336 1776 A
2532(13)S
2784(/*)S
(cc_c[VDISCARD])588 2910 A
(\(\303O\))168 3540 A
3750(*/)S
2385 V
(01162)210 1122 A
2475 V
(01163)210 1122 A
1440(/*)S
(Extensions)420 1566 A
2028(to)S
(baud)168 2154 A
(rate)168 2364 A
(settings.)378 2574 A
2994(*/)S
2565 V
(01164)210 1122 A
(#define)294 1440 A
(B57600)252 1776 A
(0x0100)252 2448 A
2784(/*)S
(57600)210 2910 A
(baud)168 3162 A
3372(*/)S
2655 V
(01165)210 1122 A
(#define)294 1440 A
(B115200)294 1776 A
(0x0200)252 2448 A
2784(/*)S
(115200)252 2910 A
(baud)168 3204 A
3414(*/)S
2745 V
(01166)210 1122 A
2835 V
(01167)210 1122 A
1440(/*)S
(These)210 1566 A
(are)126 1818 A
(the)126 1986 A
(default)294 2154 A
(settings)336 2490 A
(used)168 2868 A
3078(by)S
(the)126 3204 A
(kernel)252 3372 A
(and)126 3666 A
3834(by)S
('stty)210 3960 A
(sane')210 4212 A
4464(*/)S
2925 V
(01168)210 1122 A
3015 V
(01169)210 1122 A
(#define)294 1440 A
(TCTRL_DEF)378 1776 A
(\(CREAD)252 2448 A
2742(|)S
(CS8)126 2826 A
2994(|)S
(HUPCL\))252 3078 A
3105 V
(01170)210 1122 A
(#define)294 1440 A
(TINPUT_DEF)420 1776 A
(\(BRKINT)294 2448 A
2784(|)S
(ICRNL)210 2868 A
3120(|)S
(IXON)168 3204 A
3414(|)S
(IXANY\))252 3498 A
3195 V
(01171)210 1122 A
(#define)294 1440 A
(TOUTPUT_DEF)462 1776 A
(\(OPOST)252 2448 A
2742(|)S
(ONLCR\))252 2826 A
3285 V
(01172)210 1122 A
(#define)294 1440 A
(TLOCAL_DEF)420 1776 A
(\(ISIG)210 2448 A
2700(|)S
(IEXTEN)252 2784 A
3078(|)S
(ICANON)252 3162 A
3456(|)S
(ECHO)168 3540 A
3750(|)S
(ECHOE\))252 3834 A
3375 V
(01173)210 1122 A
(#define)294 1440 A
(TSPEED_DEF)420 1776 A
(B9600)210 2448 A
3465 V
(01174)210 1122 A
3555 V
(01175)210 1122 A
(#define)294 1440 A
(TEOF_DEF)336 1776 A
('\\4')168 2448 A
2784(/*)S
2910(\303D)S
3036(*/)S
3645 V
(01176)210 1122 A
(#define)294 1440 A
(TEOL_DEF)336 1776 A
(_POSIX_VDISABLE)630 2448 A
3735 V
(01177)210 1122 A
(#define)294 1440 A
(TERASE_DEF)420 1776 A
('\\10')210 2448 A
2784(/*)S
2910(\303H)S
3036(*/)S
3825 V
(01178)210 1122 A
(#define)294 1440 A
(TINTR_DEF)378 1776 A
('\\3')168 2448 A
2784(/*)S
2910(\303C)S
3036(*/)S
3915 V
(01179)210 1122 A
(#define)294 1440 A
(TKILL_DEF)378 1776 A
('\\25')210 2448 A
2784(/*)S
2910(\303U)S
3036(*/)S
4005 V
(01180)210 1122 A
(#define)294 1440 A
(TMIN_DEF)336 1776 A
2448(1)S
4095 V
(01181)210 1122 A
(#define)294 1440 A
(TQUIT_DEF)378 1776 A
('\\34')210 2448 A
2784(/*)S
2910(\303\\)S
3036(*/)S
4185 V
(01182)210 1122 A
(#define)294 1440 A
(TSTART_DEF)420 1776 A
('\\21')210 2448 A
2784(/*)S
2910(\303Q)S
3036(*/)S
4275 V
(01183)210 1122 A
(#define)294 1440 A
(TSTOP_DEF)378 1776 A
('\\23')210 2448 A
2784(/*)S
2910(\303S)S
3036(*/)S
4365 V
(01184)210 1122 A
(#define)294 1440 A
(TSUSP_DEF)378 1776 A
('\\32')210 2448 A
2784(/*)S
2910(\303Z)S
3036(*/)S
4455 V
(01185)210 1122 A
(#define)294 1440 A
(TTIME_DEF)378 1776 A
2448(0)S
4545 V
(01186)210 1122 A
(#define)294 1440 A
(TREPRINT_DEF)504 1776 A
('\\22')210 2448 A
2784(/*)S
2910(\303R)S
3036(*/)S
4635 V
(01187)210 1122 A
(#define)294 1440 A
(TLNEXT_DEF)420 1776 A
('\\26')210 2448 A
2784(/*)S
2910(\303V)S
3036(*/)S
4725 V
(01188)210 1122 A
(#define)294 1440 A
(TDISCARD_DEF)504 1776 A
('\\17')210 2448 A
2784(/*)S
2910(\303O)S
3036(*/)S
4815 V
(01189)210 1122 A
4905 V
(01190)210 1122 A
1440(/*)S
(Window)252 1566 A
(size.)210 1860 A
(This)168 2112 A
(information)462 2322 A
2826(is)S
(stored)252 2952 A
3246(in)S
(the)126 3372 A
(TTY)126 3540 A
(driver)252 3708 A
(but)126 4002 A
(not)126 4170 A
(used.)210 4338 A
4995 V
(01191)210 1122 A
1482(*)S
(This)168 1566 A
(can)126 1776 A
1944(be)S
(used)168 2070 A
(for)126 2280 A
(screen)252 2448 A
(based)210 2742 A
(applications)504 2994 A
3540(in)S
3666(a)S
(window)252 3750 A
(environment.)504 4044 A
5085 V
(01192)210 1122 A
1482(*)S
(The)126 1566 A
(ioctls)252 1734 A
(TIOCGWINSZ)420 2028 A
(and)126 2490 A
(TIOCSWINSZ)420 2658 A
(can)126 3120 A
3288(be)S
(used)168 3414 A
3624(to)S
(get)126 3750 A
(and)126 3918 A
(set)126 4086 A
(this)168 4254 A
5175 V
(01193)210 1122 A
1482(*)S
(information.)504 1566 A
5265 V
(01194)210 1122 A
1482(*/)S
5355 V
(01195)210 1122 A
5445 V
(01196)210 1122 A
(struct)252 1440 A
(winsize)294 1734 A
5535 V
(01197)210 1122 A
1440({)S
5625 V
(01198)210 1122 A
(unsigned)336 1776 A
(short)210 2154 A
(ws_row;)294 2448 A
3120(/*)S
(rows,)210 3246 A
3498(in)S
(characters)420 3624 A
4086(*/)S
5715 V
(01199)210 1122 A
(unsigned)336 1776 A
(short)210 2154 A
(ws_col;)294 2448 A
3120(/*)S
(columns,)336 3246 A
3624(in)S
(characters)420 3750 A
4212(*/)S
5805 V
(01200)210 1122 A
(unsigned)336 1776 A
(short)210 2154 A
(ws_xpixel;)420 2448 A
3120(/*)S
(horizontal)420 3246 A
(size,)210 3708 A
(pixels)252 3960 A
4254(*/)S
5895 V
(01201)210 1122 A
(unsigned)336 1776 A
(short)210 2154 A
(ws_ypixel;)420 2448 A
3120(/*)S
(vertical)336 3246 A
(size,)210 3624 A
(pixels)252 3876 A
4170(*/)S
5985 V
(01202)210 1122 A
1440(};)S
6075 V
(01203)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_MINIX)252 1860 A
2154(*/)S
6165 V
(01204)210 1122 A
6255 V
(01205)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_TERMIOS_H)420 1860 A
2322(*/)S
8418 V
EP
%%Page: 17 17
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2404(File:)S
(include/timers.h)719 2637 A
12 B
4560(17)S
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(include/timers.h)672 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(01300)210 1122 A
1440(/*)S
(This)168 1566 A
(library)294 1776 A
(provides)336 2112 A
(generic)294 2490 A
(watchdog)336 2826 A
(timer)210 3204 A
(management)420 3456 A
(functionality.)588 3918 A
2295 V
(01301)210 1122 A
1482(*)S
(The)126 1566 A
(functions)378 1734 A
(operate)294 2154 A
2490(on)S
2616(a)S
(timer)210 2700 A
(queue)210 2952 A
(provided)336 3204 A
3582(by)S
(the)126 3708 A
(caller.)294 3876 A
(Note)168 4212 A
(that)168 4422 A
2385 V
(01302)210 1122 A
1482(*)S
(the)126 1566 A
(timers)252 1734 A
(must)168 2028 A
(use)126 2238 A
(absolute)336 2406 A
(time)168 2784 A
2994(to)S
(allow)210 3120 A
(sorting.)336 3372 A
(The)126 3750 A
(library)294 3918 A
(provides:)378 4254 A
2475 V
(01303)210 1122 A
1482(*)S
2565 V
(01304)210 1122 A
1482(*)S
(tmrs_settimer:)588 1692 A
(\(re\)set)294 2490 A
2826(a)S
(new)126 2910 A
(watchdog)336 3078 A
(timer)210 3456 A
3708(in)S
(the)126 3834 A
(timers)252 4002 A
(queue)210 4296 A
2655 V
(01305)210 1122 A
1482(*)S
(tmrs_clrtimer:)588 1692 A
(remove)252 2490 A
2784(a)S
(timer)210 2868 A
(from)168 3120 A
(both)168 3330 A
(the)126 3540 A
(timers)252 3708 A
(queue)210 4002 A
2745 V
(01306)210 1122 A
1482(*)S
(tmrs_exptimers:)630 1692 A
(check)210 2490 A
(for)126 2742 A
(expired)294 2910 A
(timers)252 3246 A
(and)126 3540 A
(run)126 3708 A
(watchdog)336 3876 A
(functions)378 4254 A
2835 V
(01307)210 1122 A
1482(*)S
2925 V
(01308)210 1122 A
1482(*)S
(Author:)294 1566 A
3015 V
(01309)210 1122 A
1482(*)S
(Jorrit)252 1692 A
1986(N.)S
(Herder)252 2112 A
(<jnherder@cs.vu.nl>)798 2406 A
3105 V
(01310)210 1122 A
1482(*)S
(Adapted)294 1692 A
(from)168 2028 A
(tmr_settimer)504 2238 A
(and)126 2784 A
(tmr_clrtimer)504 2952 A
3498(in)S
(src/kernel/clock.c.)798 3624 A
3195 V
(01311)210 1122 A
1482(*)S
(Last)168 1692 A
(modified:)378 1902 A
(September)378 2322 A
(30,)126 2742 A
(2004.)210 2910 A
3285 V
(01312)210 1122 A
1482(*/)S
3375 V
(01313)210 1122 A
3465 V
(01314)210 1122 A
(#ifndef)294 1440 A
(_TIMERS_H)378 1776 A
3555 V
(01315)210 1122 A
(#define)294 1440 A
(_TIMERS_H)378 1776 A
3645 V
(01316)210 1122 A
3735 V
(01317)210 1122 A
(#include)336 1440 A
(<limits.h>)420 1818 A
3825 V
(01318)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
3915 V
(01319)210 1122 A
4005 V
(01320)210 1122 A
(struct)252 1440 A
(timer;)252 1734 A
4095 V
(01321)210 1122 A
(typedef)294 1440 A
(void)168 1776 A
(\(*tmr_func_t\)\(struct)840 1986 A
(timer)210 2868 A
(*tp\);)210 3120 A
4185 V
(01322)210 1122 A
(typedef)294 1440 A
(union)210 1776 A
2028({)S
(int)126 2112 A
(ta_int;)294 2280 A
(long)168 2616 A
(ta_long;)336 2826 A
(void)168 3204 A
(*ta_ptr;)336 3414 A
3792(})S
(tmr_arg_t;)420 3876 A
4275 V
(01323)210 1122 A
4365 V
(01324)210 1122 A
1440(/*)S
1566(A)S
(timer_t)294 1650 A
(variable)336 1986 A
(must)168 2364 A
2574(be)S
(declare)294 2700 A
(for)126 3036 A
(each)168 3204 A
(distinct)336 3414 A
(timer)210 3792 A
4044(to)S
4170(be)S
(used.)210 4296 A
4455 V
(01325)210 1122 A
1482(*)S
(The)126 1566 A
(timers)252 1734 A
(watchdog)336 2028 A
(function)336 2406 A
(and)126 2784 A
(expiration)420 2952 A
(time)168 3414 A
(are)126 3624 A
(automatically)546 3792 A
(set)126 4380 A
4545 V
(01326)210 1122 A
1482(*)S
1566(by)S
(the)126 1692 A
(library)294 1860 A
(function)336 2196 A
(tmrs_settimer,)588 2574 A
(but)126 3204 A
(its)126 3372 A
(argument)336 3540 A
3918(is)S
(not.)168 4044 A
4635 V
(01327)210 1122 A
1482(*/)S
4725 V
(01328)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
(timer)210 2070 A
4815 V
(01329)210 1122 A
1440({)S
4905 V
(01330)210 1122 A
(struct)252 1524 A
(timer)210 1818 A
(*tmr_next;)420 2112 A
2784(/*)S
(next)168 2910 A
3120(in)S
3246(a)S
(timer)210 3330 A
(chain)210 3582 A
3834(*/)S
4995 V
(01331)210 1122 A
(clock_t)294 1524 A
(tmr_exp_time;)546 2112 A
2784(/*)S
(expiration)420 2910 A
(time)168 3372 A
3582(*/)S
5085 V
(01332)210 1122 A
(tmr_func_t)420 1524 A
(tmr_func;)378 2112 A
2784(/*)S
(function)336 2910 A
3288(to)S
(call)168 3414 A
(when)168 3624 A
(expired)294 3834 A
4170(*/)S
5175 V
(01333)210 1122 A
(tmr_arg_t)378 1524 A
(tmr_arg;)336 2112 A
2784(/*)S
(random)252 2910 A
(argument)336 3204 A
3582(*/)S
5265 V
(01334)210 1122 A
1440(})S
(timer_t;)336 1524 A
5355 V
(01335)210 1122 A
5445 V
(01336)210 1122 A
1440(/*)S
(Used)168 1566 A
(when)168 1776 A
(the)126 1986 A
(timer)210 2154 A
2406(is)S
(not)126 2532 A
(active.)294 2700 A
3036(*/)S
5535 V
(01337)210 1122 A
(#define)294 1440 A
(TMR_NEVER)378 1776 A
(\(\(clock_t\))420 2322 A
2784(-1)S
2910(<)S
2994(0\))S
3120(?)S
(\(\(clock_t\))420 3204 A
(LONG_MAX\))378 3666 A
4086(:)S
(\(\(clock_t\))420 4170 A
(-1\))126 4632 A
5625 V
(01338)210 1122 A
(#undef)252 1440 A
(TMR_NEVER)378 1734 A
5715 V
(01339)210 1122 A
(#define)294 1440 A
(TMR_NEVER)378 1776 A
(\(\(clock_t\))420 2448 A
(LONG_MAX\))378 2910 A
5805 V
(01340)210 1122 A
5895 V
(01341)210 1122 A
1440(/*)S
(These)210 1566 A
(definitions)462 1818 A
(can)126 2322 A
2490(be)S
(used)168 2616 A
2826(to)S
(set)126 2952 A
3120(or)S
(get)126 3246 A
(data)168 3414 A
(from)168 3624 A
3834(a)S
(timer)210 3918 A
(variable.)378 4170 A
4590(*/)S
5985 V
(01342)210 1122 A
(#define)294 1440 A
(tmr_arg\(tp\))462 1776 A
(\(&\(tp\)->tmr_arg\))672 2280 A
6075 V
(01343)210 1122 A
(#define)294 1440 A
(tmr_exp_time\(tp\))672 1776 A
(\(&\(tp\)->tmr_exp_time\))882 2490 A
6165 V
(01344)210 1122 A
6255 V
(01345)210 1122 A
1440(/*)S
(Timers)252 1566 A
(should)252 1860 A
2154(be)S
(initialized)462 2280 A
(once)168 2784 A
(before)252 2994 A
(they)168 3288 A
(are)126 3498 A
(being)210 3666 A
(used.)210 3918 A
4170(Be)S
(careful)294 4296 A
6345 V
(01346)210 1122 A
1482(*)S
(not)126 1566 A
1734(to)S
(reinitialize)504 1860 A
2406(a)S
(timer)210 2490 A
(that)168 2742 A
2952(is)S
3078(in)S
3204(a)S
(list)168 3288 A
3498(of)S
(timers,)294 3624 A
3960(or)S
(the)126 4086 A
(chain)210 4254 A
6435 V
(01347)210 1122 A
1482(*)S
(will)168 1566 A
1776(be)S
(broken.)294 1902 A
6525 V
(01348)210 1122 A
1482(*/)S
6615 V
(01349)210 1122 A
(#define)294 1440 A
(tmr_inittimer\(tp\))714 1776 A
(\(void\)\(\(tp\)->tmr_exp_time)1050 2532 A
3624(=)S
(TMR_NEVER,)420 3708 A
4170(\\)S
6705 V
(01350)210 1122 A
(\(tp\)->tmr_next)588 1776 A
2406(=)S
(NULL\))210 2490 A
6795 V
(01351)210 1122 A
6885 V
(01352)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(generic)294 2154 A
(timer)210 2490 A
(management)420 2742 A
(functions)378 3204 A
(are)126 3624 A
(available.)420 3792 A
(They)168 4254 A
6975 V
(01353)210 1122 A
1482(*)S
(can)126 1566 A
1734(be)S
(used)168 1860 A
2070(to)S
(operate)294 2196 A
2532(on)S
(the)126 2658 A
(lists)210 2826 A
3078(of)S
(timers.)294 3204 A
(Adding)252 3540 A
3834(a)S
(timer)210 3918 A
4170(to)S
4296(a)S
(list)168 4380 A
7065 V
(01354)210 1122 A
1482(*)S
(automatically)546 1566 A
(takes)210 2154 A
(care)168 2406 A
2616(of)S
(removing)336 2742 A
(it.)126 3120 A
8418 V
EP
%%Page: 18 18
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(18)S
11 R
2404(File:)S
(include/timers.h)719 2637 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(01355)210 1122 A
1482(*/)S
1845 V
(01356)210 1122 A
(_PROTOTYPE\()462 1440 A
(clock_t)294 1944 A
(tmrs_clrtimer,)588 2280 A
(\(timer_t)336 2910 A
(**tmrs,)294 3288 A
(timer_t)294 3624 A
(*tp,)168 3960 A
(clock_t)294 4170 A
(*new_head\))420 4506 A
5472(\);)S
1935 V
(01357)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(tmrs_exptimers,)630 2154 A
(\(timer_t)336 2826 A
(**tmrs,)294 3204 A
(clock_t)294 3540 A
(now,)168 3876 A
(clock_t)294 4086 A
(*new_head\))420 4422 A
5472(\);)S
2025 V
(01358)210 1122 A
(_PROTOTYPE\()462 1440 A
(clock_t)294 1944 A
(tmrs_settimer,)588 2280 A
(\(timer_t)336 2910 A
(**tmrs,)294 3288 A
(timer_t)294 3624 A
(*tp,)168 3960 A
2115 V
(01359)210 1122 A
(clock_t)294 1776 A
(exp_time,)378 2112 A
(tmr_func_t)420 2532 A
(watchdog,)378 2994 A
(clock_t)294 3414 A
(*new_head\))420 3750 A
5472(\);)S
2205 V
(01360)210 1122 A
2295 V
(01361)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_TIMERS_H)378 1860 A
2280(*/)S
2385 V
(01362)210 1122 A
2745 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2835 V
(include/sys/types.h)798 2676 A
2925 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3105 V
(01400)210 1122 A
1440(/*)S
(The)126 1566 A
(<sys/types.h>)546 1734 A
(header)252 2322 A
(contains)336 2616 A
(important)378 2994 A
(data)168 3414 A
(type)168 3624 A
(definitions.)504 3834 A
3195 V
(01401)210 1122 A
1482(*)S
1566(It)S
1692(is)S
(considered)420 1818 A
(good)168 2280 A
(programming)462 2490 A
(practice)336 2994 A
3372(to)S
(use)126 3498 A
(these)210 3666 A
(definitions,)504 3918 A
3285 V
(01402)210 1122 A
1482(*)S
(instead)294 1566 A
1902(of)S
(the)126 2028 A
(underlying)420 2196 A
(base)168 2658 A
(type.)210 2868 A
3162(By)S
(convention,)462 3288 A
(all)126 3792 A
(type)168 3960 A
(names)210 4170 A
(end)126 4422 A
3375 V
(01403)210 1122 A
1482(*)S
(with)168 1566 A
(_t.)126 1776 A
3465 V
(01404)210 1122 A
1482(*/)S
3555 V
(01405)210 1122 A
3645 V
(01406)210 1122 A
(#ifndef)294 1440 A
(_TYPES_H)336 1776 A
3735 V
(01407)210 1122 A
(#define)294 1440 A
(_TYPES_H)336 1776 A
3825 V
(01408)210 1122 A
3915 V
(01409)210 1122 A
(#ifndef)294 1440 A
(_ANSI_H)294 1776 A
4005 V
(01410)210 1122 A
(#include)336 1440 A
(<ansi.h>)336 1818 A
4095 V
(01411)210 1122 A
(#endif)252 1440 A
4185 V
(01412)210 1122 A
4275 V
(01413)210 1122 A
1440(/*)S
(The)126 1566 A
(type)168 1734 A
(size_t)252 1944 A
(holds)210 2238 A
(all)126 2490 A
(results)294 2658 A
2994(of)S
(the)126 3120 A
(sizeof)252 3288 A
(operator.)378 3582 A
4044(At)S
(first)210 4170 A
(glance,)294 4422 A
4365 V
(01414)210 1122 A
1482(*)S
1566(it)S
(seems)210 1692 A
(obvious)294 1944 A
(that)168 2280 A
2490(it)S
(should)252 2616 A
2910(be)S
3036(an)S
(unsigned)336 3162 A
(int,)168 3540 A
(but)126 3750 A
(this)168 3918 A
4128(is)S
(not)126 4254 A
(always)252 4422 A
4455 V
(01415)210 1122 A
1482(*)S
(the)126 1566 A
(case.)210 1734 A
(For)126 1986 A
(example,)336 2154 A
(MINIX-ST)336 2532 A
(\(68000\))294 2910 A
(has)126 3246 A
(32-bit)252 3414 A
(pointers)336 3708 A
(and)126 4086 A
(16-bit)252 4254 A
4545 V
(01416)210 1122 A
1482(*)S
(integers.)378 1566 A
(When)168 1986 A
(one)126 2196 A
(asks)168 2364 A
(for)126 2574 A
(the)126 2742 A
(size)168 2910 A
3120(of)S
3246(a)S
(70K)126 3330 A
(struct)252 3498 A
3792(or)S
(array,)252 3918 A
(the)126 4212 A
(result)252 4380 A
4635 V
(01417)210 1122 A
1482(*)S
(requires)336 1566 A
1944(17)S
(bits)168 2070 A
2280(to)S
(express,)336 2406 A
2784(so)S
(size_t)252 2910 A
(must)168 3204 A
3414(be)S
3540(a)S
(long)168 3624 A
(type.)210 3834 A
(The)126 4128 A
(type)168 4296 A
4725 V
(01418)210 1122 A
1482(*)S
(ssize_t)294 1566 A
1902(is)S
(the)126 2028 A
(signed)252 2196 A
(version)294 2490 A
2826(of)S
(size_t.)294 2952 A
4815 V
(01419)210 1122 A
1482(*/)S
4905 V
(01420)210 1122 A
(#ifndef)294 1440 A
(_SIZE_T)294 1776 A
4995 V
(01421)210 1122 A
(#define)294 1440 A
(_SIZE_T)294 1776 A
5085 V
(01422)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(int)126 2154 A
(size_t;)294 2322 A
5175 V
(01423)210 1122 A
(#endif)252 1440 A
5265 V
(01424)210 1122 A
5355 V
(01425)210 1122 A
(#ifndef)294 1440 A
(_SSIZE_T)336 1776 A
5445 V
(01426)210 1122 A
(#define)294 1440 A
(_SSIZE_T)336 1776 A
5535 V
(01427)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(ssize_t;)336 1944 A
5625 V
(01428)210 1122 A
(#endif)252 1440 A
5715 V
(01429)210 1122 A
5805 V
(01430)210 1122 A
(#ifndef)294 1440 A
(_TIME_T)294 1776 A
5895 V
(01431)210 1122 A
(#define)294 1440 A
(_TIME_T)294 1776 A
5985 V
(01432)210 1122 A
(typedef)294 1440 A
(long)168 1776 A
(time_t;)294 1986 A
2910(/*)S
(time)168 3036 A
3246(in)S
(sec)126 3372 A
(since)210 3540 A
3792(1)S
(Jan)126 3876 A
(1970)168 4044 A
(0000)168 4254 A
(GMT)126 4464 A
4632(*/)S
6075 V
(01433)210 1122 A
(#endif)252 1440 A
6165 V
(01434)210 1122 A
6255 V
(01435)210 1122 A
(#ifndef)294 1440 A
(_CLOCK_T)336 1776 A
6345 V
(01436)210 1122 A
(#define)294 1440 A
(_CLOCK_T)336 1776 A
6435 V
(01437)210 1122 A
(typedef)294 1440 A
(long)168 1776 A
(clock_t;)336 1986 A
2910(/*)S
(unit)168 3036 A
(for)126 3246 A
(system)252 3414 A
(accounting)420 3708 A
4170(*/)S
6525 V
(01438)210 1122 A
(#endif)252 1440 A
6615 V
(01439)210 1122 A
6705 V
(01440)210 1122 A
(#ifndef)294 1440 A
(_SIGSET_T)378 1776 A
6795 V
(01441)210 1122 A
(#define)294 1440 A
(_SIGSET_T)378 1776 A
6885 V
(01442)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(sigset_t;)378 2364 A
6975 V
(01443)210 1122 A
(#endif)252 1440 A
7065 V
(01444)210 1122 A
8418 V
EP
%%Page: 19 19
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2340(File:)S
2573(include/sys/types.h)S
12 B
4560(19)S
1755 V
7 LST
(01445)210 1122 A
1440(/*)S
(Open)168 1566 A
(Group)210 1776 A
(Base)168 2028 A
(Specifications)588 2238 A
(Issue)210 2868 A
3120(6)S
(\(not)168 3204 A
(complete\))378 3414 A
3834(*/)S
1845 V
(01446)210 1122 A
(typedef)294 1440 A
(long)168 1776 A
(useconds_t;)462 1986 A
2784(/*)S
(Time)168 2910 A
3120(in)S
(microseconds)504 3246 A
3792(*/)S
1935 V
(01447)210 1122 A
2025 V
(01448)210 1122 A
1440(/*)S
(Types)210 1566 A
(used)168 1818 A
2028(in)S
(disk,)210 2154 A
(inode,)252 2406 A
(etc.)168 2700 A
(data)168 2910 A
(structures.)462 3120 A
3624(*/)S
2115 V
(01449)210 1122 A
(typedef)294 1440 A
(short)210 1776 A
(dev_t;)252 2406 A
2910(/*)S
(holds)210 3036 A
(\(major|minor\))546 3288 A
(device)252 3876 A
(pair)168 4170 A
4380(*/)S
2205 V
(01450)210 1122 A
(typedef)294 1440 A
(char)168 1776 A
(gid_t;)252 2406 A
2910(/*)S
(group)210 3036 A
3288(id)S
3414(*/)S
2295 V
(01451)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(ino_t;)252 2406 A
2910(/*)S
(i-node)252 3036 A
(number)252 3330 A
(\(V3)126 3624 A
(filesystem\))462 3792 A
4296(*/)S
2385 V
(01452)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(short)210 2154 A
(mode_t;)294 2406 A
2910(/*)S
(file)168 3036 A
(type)168 3246 A
(and)126 3456 A
(permissions)462 3624 A
(bits)168 4128 A
4338(*/)S
2475 V
(01453)210 1122 A
(typedef)294 1440 A
(short)210 1776 A
(nlink_t;)336 2322 A
2910(/*)S
(number)252 3036 A
3330(of)S
(links)210 3456 A
3708(to)S
3834(a)S
(file)168 3918 A
4128(*/)S
2565 V
(01454)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(off_t;)252 2406 A
2910(/*)S
(offset)252 3036 A
(within)252 3330 A
3624(a)S
(file)168 3708 A
3918(*/)S
2655 V
(01455)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(pid_t;)252 2406 A
2910(/*)S
(process)294 3036 A
3372(id)S
(\(must)210 3498 A
3750(be)S
(signed\))294 3876 A
4212(*/)S
2745 V
(01456)210 1122 A
(typedef)294 1440 A
(short)210 1776 A
(uid_t;)252 2406 A
2910(/*)S
(user)168 3036 A
3246(id)S
3372(*/)S
2835 V
(01457)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(zone_t;)294 2364 A
2910(/*)S
(zone)168 3036 A
(number)252 3246 A
3540(*/)S
2925 V
(01458)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(block_t;)336 2364 A
2910(/*)S
(block)210 3036 A
(number)252 3288 A
3582(*/)S
3015 V
(01459)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(bit_t;)252 2406 A
2910(/*)S
(bit)126 3036 A
(number)252 3204 A
3498(in)S
3624(a)S
(bit)126 3708 A
(map)126 3876 A
4044(*/)S
3105 V
(01460)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(short)210 2154 A
(zone1_t;)336 2406 A
2910(/*)S
(zone)168 3036 A
(number)252 3246 A
(for)126 3540 A
3708(V1)S
(file)168 3834 A
(systems)294 4044 A
4380(*/)S
3195 V
(01461)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(short)210 2154 A
(bitchunk_t;)462 2406 A
2910(/*)S
(collection)420 3036 A
3498(of)S
(bits)168 3624 A
3834(in)S
3960(a)S
(bitmap)252 4044 A
4338(*/)S
3285 V
(01462)210 1122 A
3375 V
(01463)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(char)168 2154 A
(u8_t;)210 2448 A
2910(/*)S
3036(8)S
(bit)126 3120 A
(type)168 3288 A
3498(*/)S
3465 V
(01464)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(short)210 2154 A
(u16_t;)252 2406 A
2910(/*)S
3036(16)S
(bit)126 3162 A
(type)168 3330 A
3540(*/)S
3555 V
(01465)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(u32_t;)252 2406 A
2910(/*)S
3036(32)S
(bit)126 3162 A
(type)168 3330 A
3540(*/)S
3645 V
(01466)210 1122 A
3735 V
(01467)210 1122 A
(typedef)294 1440 A
(char)168 1776 A
(i8_t;)210 2448 A
2910(/*)S
3036(8)S
(bit)126 3120 A
(signed)252 3288 A
(type)168 3582 A
3792(*/)S
3825 V
(01468)210 1122 A
(typedef)294 1440 A
(short)210 1776 A
(i16_t;)252 2406 A
2910(/*)S
3036(16)S
(bit)126 3162 A
(signed)252 3330 A
(type)168 3624 A
3834(*/)S
3915 V
(01469)210 1122 A
(typedef)294 1440 A
(long)168 1776 A
(i32_t;)252 2406 A
2910(/*)S
3036(32)S
(bit)126 3162 A
(signed)252 3330 A
(type)168 3624 A
3834(*/)S
4005 V
(01470)210 1122 A
4095 V
(01471)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
2070({)S
(u32_t)210 2154 A
(_[2];)210 2406 A
2658(})S
(u64_t;)252 2742 A
4185 V
(01472)210 1122 A
4275 V
(01473)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(types)210 2154 A
(are)126 2406 A
(needed)252 2574 A
(because)294 2868 A
(MINIX)210 3204 A
(uses)168 3456 A
(K&R)126 3666 A
(style)210 3834 A
(function)336 4086 A
4365 V
(01474)210 1122 A
1482(*)S
(definitions)462 1566 A
(\(for)168 2070 A
(maximum)294 2280 A
(portability\).)546 2616 A
(When)168 3246 A
3456(a)S
(short,)252 3540 A
(such)168 3834 A
4044(as)S
(dev_t,)252 4170 A
4464(is)S
4455 V
(01475)210 1122 A
1482(*)S
(passed)252 1566 A
1860(to)S
1986(a)S
(function)336 2070 A
(with)168 2448 A
2658(a)S
(K&R)126 2742 A
(definition,)462 2910 A
(the)126 3414 A
(compiler)336 3582 A
(automatically)546 3960 A
4545 V
(01476)210 1122 A
1482(*)S
(promotes)336 1566 A
1944(it)S
2070(to)S
2196(an)S
(int.)168 2322 A
(The)126 2574 A
(prototype)378 2742 A
(must)168 3162 A
(contain)294 3372 A
3708(an)S
(int)126 3834 A
4002(as)S
(the)126 4128 A
(parameter,)420 4296 A
4635 V
(01477)210 1122 A
1482(*)S
(not)126 1566 A
1734(a)S
(short,)252 1818 A
(because)294 2112 A
2448(an)S
(int)126 2574 A
2742(is)S
(what)168 2868 A
3078(an)S
(old-style)378 3204 A
(function)336 3624 A
(definition)420 4002 A
4725 V
(01478)210 1122 A
1482(*)S
(expects.)336 1566 A
(Thus)168 1986 A
(using)210 2196 A
(dev_t)210 2448 A
2700(in)S
2826(a)S
(prototype)378 2910 A
(would)210 3330 A
3582(be)S
(incorrect.)420 3708 A
4212(It)S
(would)210 4338 A
4590(be)S
4815 V
(01479)210 1122 A
1482(*)S
(sufficient)420 1566 A
2028(to)S
(just)168 2154 A
(use)126 2364 A
(int)126 2532 A
(instead)294 2700 A
3036(of)S
(dev_t)210 3162 A
3414(in)S
(the)126 3540 A
(prototypes,)462 3708 A
(but)126 4212 A
(Dev_t)210 4380 A
4905 V
(01480)210 1122 A
1482(*)S
1566(is)S
(clearer.)336 1692 A
4995 V
(01481)210 1122 A
1482(*/)S
5085 V
(01482)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(Dev_t;)252 2406 A
5175 V
(01483)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(_mnx_Gid_t;)462 2196 A
5265 V
(01484)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(Nlink_t;)336 2322 A
5355 V
(01485)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(_mnx_Uid_t;)462 2196 A
5445 V
(01486)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(U8_t;)210 2448 A
5535 V
(01487)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(U32_t;)252 2406 A
5625 V
(01488)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(I8_t;)210 2448 A
5715 V
(01489)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(I16_t;)252 2406 A
5805 V
(01490)210 1122 A
(typedef)294 1440 A
(long)168 1776 A
(I32_t;)252 2406 A
5895 V
(01491)210 1122 A
5985 V
(01492)210 1122 A
1440(/*)S
(ANSI)168 1566 A
1776(C)S
(makes)210 1860 A
(writing)294 2112 A
(down)168 2448 A
(the)126 2658 A
(promotion)378 2826 A
3246(of)S
(unsigned)336 3372 A
(types)210 3750 A
(very)168 4002 A
(messy.)252 4212 A
(When)168 4548 A
6075 V
(01493)210 1122 A
1482(*)S
(sizeof\(short\))546 1566 A
2154(==)S
(sizeof\(int\),)504 2280 A
(there)210 2826 A
3078(is)S
3204(no)S
(promotion,)420 3330 A
3792(so)S
(the)126 3918 A
(type)168 4086 A
(stays)210 4296 A
6165 V
(01494)210 1122 A
1482(*)S
(unsigned.)378 1566 A
(When)168 2028 A
(the)126 2238 A
(compiler)336 2406 A
2784(is)S
(not)126 2910 A
(ANSI,)210 3078 A
(there)210 3330 A
3582(is)S
(usually)294 3708 A
4044(no)S
(loss)168 4170 A
4380(of)S
6255 V
(01495)210 1122 A
1482(*)S
(unsignedness,)546 1566 A
(and)126 2154 A
(there)210 2322 A
(are)126 2574 A
(usually)294 2742 A
3078(no)S
(prototypes)420 3204 A
3666(so)S
(the)126 3792 A
(promoted)336 3960 A
(type)168 4338 A
6345 V
(01496)210 1122 A
1482(*)S
(doesn't)294 1566 A
(matter.)294 1902 A
(The)126 2280 A
(use)126 2448 A
2616(of)S
(types)210 2742 A
(like)168 2994 A
(Ino_t)210 3204 A
3456(is)S
3582(an)S
(attempt)294 3708 A
4044(to)S
(use)126 4170 A
(ints)168 4338 A
6435 V
(01497)210 1122 A
1482(*)S
(\(which)252 1566 A
(are)126 1860 A
(not)126 2028 A
(promoted\))378 2196 A
(while)210 2616 A
(providing)378 2868 A
(information)462 3288 A
3792(to)S
(the)126 3918 A
(reader.)294 4086 A
6525 V
(01498)210 1122 A
1482(*/)S
6615 V
(01499)210 1122 A
6705 V
(01500)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(Ino_t;)252 2406 A
6795 V
(01501)210 1122 A
6885 V
(01502)210 1122 A
(#if)126 1440 A
(_EM_WSIZE)378 1608 A
2028(==)S
2154(2)S
6975 V
(01503)210 1122 A
(/*typedef)378 1440 A
(unsigned)336 1860 A
(int)126 2238 A
(Ino_t;)252 2616 A
(Ino_t)210 2910 A
3162(is)S
(now)126 3288 A
3456(32)S
(bits)168 3582 A
3792(*/)S
7065 V
(01504)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(int)126 2154 A
(Zone1_t;)336 2448 A
8418 V
EP
%%Page: 20 20
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(20)S
11 R
2340(File:)S
2573(include/sys/types.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(01505)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(int)126 2154 A
(Bitchunk_t;)462 2322 A
1845 V
(01506)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(int)126 2154 A
(U16_t;)252 2532 A
1935 V
(01507)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(int)126 2154 A
(_mnx_Mode_t;)504 2364 A
2025 V
(01508)210 1122 A
2115 V
(01509)210 1122 A
(#else)210 1440 A
1692(/*)S
(_EM_WSIZE)378 1818 A
2238(==)S
2364(4,)S
2490(or)S
(_EM_WSIZE)378 2616 A
(undefined)378 3036 A
3456(*/)S
2205 V
(01510)210 1122 A
(/*typedef)378 1440 A
(int)126 1860 A
(Ino_t;)252 2532 A
(Ino_t)210 2826 A
3078(is)S
(now)126 3204 A
3372(32)S
(bits)168 3498 A
3708(*/)S
2295 V
(01511)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(Zone1_t;)336 2448 A
2385 V
(01512)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(Bitchunk_t;)462 2322 A
2475 V
(01513)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(U16_t;)252 2532 A
2565 V
(01514)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(_mnx_Mode_t;)504 2280 A
2655 V
(01515)210 1122 A
2745 V
(01516)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_EM_WSIZE)378 1860 A
2280(==)S
2406(2,)S
(etc)126 2532 A
2700(*/)S
2835 V
(01517)210 1122 A
2925 V
(01518)210 1122 A
1440(/*)S
(Signal)252 1566 A
(handler)294 1860 A
(type,)210 2196 A
(e.g.)168 2448 A
(SIG_IGN)294 2658 A
2994(*/)S
3015 V
(01519)210 1122 A
(typedef)294 1440 A
(void)168 1776 A
(_PROTOTYPE\()462 1986 A
(\(*sighandler_t\),)672 2490 A
(\(int\))210 3204 A
3456(\);)S
3105 V
(01520)210 1122 A
3195 V
(01521)210 1122 A
1440(/*)S
(Compatibility)546 1566 A
(with)168 2154 A
(other)210 2364 A
(systems)294 2616 A
2952(*/)S
3285 V
(01522)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(char)168 2154 A
(u_char;)294 2448 A
3375 V
(01523)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(short)210 2154 A
(u_short;)336 2448 A
3465 V
(01524)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(int)126 2154 A
(u_int;)252 2448 A
3555 V
(01525)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(u_long;)294 2448 A
3645 V
(01526)210 1122 A
(typedef)294 1440 A
(char)168 1776 A
(*caddr_t;)378 2448 A
3735 V
(01527)210 1122 A
3825 V
(01528)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_TYPES_H)336 1860 A
2238(*/)S
4095 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4185 V
(include/sys/sigcontext.h)1008 2676 A
4275 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4455 V
(01600)210 1122 A
(#ifndef)294 1440 A
(_SIGCONTEXT_H)546 1776 A
4545 V
(01601)210 1122 A
(#define)294 1440 A
(_SIGCONTEXT_H)546 1776 A
4635 V
(01602)210 1122 A
4725 V
(01603)210 1122 A
1440(/*)S
(The)126 1566 A
(sigcontext)420 1734 A
(structure)378 2196 A
2616(is)S
(used)168 2742 A
2952(by)S
(the)126 3078 A
(sigreturn\(2\))504 3246 A
(system)252 3792 A
(call.)210 4086 A
4815 V
(01604)210 1122 A
1482(*)S
(sigreturn\(\))462 1566 A
2070(is)S
(seldom)252 2196 A
(called)252 2490 A
2784(by)S
(user)168 2910 A
(programs,)378 3120 A
(but)126 3540 A
3708(it)S
3834(is)S
(used)168 3960 A
(internally)420 4170 A
4905 V
(01605)210 1122 A
1482(*)S
1566(by)S
(the)126 1692 A
(signal)252 1860 A
(catching)336 2154 A
(mechanism.)420 2532 A
4995 V
(01606)210 1122 A
1482(*/)S
5085 V
(01607)210 1122 A
5175 V
(01608)210 1122 A
(#ifndef)294 1440 A
(_ANSI_H)294 1776 A
5265 V
(01609)210 1122 A
(#include)336 1440 A
(<ansi.h>)336 1818 A
5355 V
(01610)210 1122 A
(#endif)252 1440 A
5445 V
(01611)210 1122 A
5535 V
(01612)210 1122 A
(#ifndef)294 1440 A
(_MINIX_SYS_CONFIG_H)798 1776 A
5625 V
(01613)210 1122 A
(#include)336 1440 A
(<minix/sys_config.h>)840 1818 A
5715 V
(01614)210 1122 A
(#endif)252 1440 A
5805 V
(01615)210 1122 A
5895 V
(01616)210 1122 A
(#if)126 1440 A
(!defined\(_MINIX_CHIP\))882 1608 A
5985 V
(01617)210 1122 A
(#include)336 1440 A
("error,)294 1818 A
(configuration)546 2154 A
2742(is)S
(not)126 2868 A
(known")252 3036 A
6075 V
(01618)210 1122 A
(#endif)252 1440 A
6165 V
(01619)210 1122 A
6255 V
(01620)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(structure)378 2154 A
(should)252 2574 A
(match)210 2868 A
(the)126 3120 A
(stackframe_s)504 3288 A
(structure)378 3834 A
(used)168 4254 A
6345 V
(01621)210 1122 A
1482(*)S
1566(by)S
(the)126 1692 A
(kernel's)336 1860 A
(context)294 2238 A
(switching)378 2574 A
(code.)210 2994 A
(Floating)336 3288 A
(point)210 3666 A
(registers)378 3918 A
(should)252 4338 A
6435 V
(01622)210 1122 A
1482(*)S
1566(be)S
(added)210 1692 A
1944(in)S
2070(a)S
(different)378 2154 A
(struct.)294 2574 A
6525 V
(01623)210 1122 A
1482(*/)S
6615 V
(01624)210 1122 A
(struct)252 1440 A
(sigregs)294 1734 A
2070({)S
6705 V
(01625)210 1122 A
(short)210 1524 A
(sr_gs;)252 1776 A
6795 V
(01626)210 1122 A
(short)210 1524 A
(sr_fs;)252 1776 A
6885 V
(01627)210 1122 A
(short)210 1524 A
(sr_es;)252 1776 A
6975 V
(01628)210 1122 A
(short)210 1524 A
(sr_ds;)252 1776 A
7065 V
(01629)210 1122 A
(int)126 1524 A
(sr_di;)252 1692 A
8418 V
EP
%%Page: 21 21
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2229(File:)S
2462(include/sys/sigcontext.h)S
12 B
4560(21)S
1755 V
7 LST
(01630)210 1122 A
(int)126 1524 A
(sr_si;)252 1692 A
1845 V
(01631)210 1122 A
(int)126 1524 A
(sr_bp;)252 1692 A
1935 V
(01632)210 1122 A
(int)126 1524 A
(sr_st;)252 1692 A
2784(/*)S
(stack)210 2910 A
(top)126 3162 A
3330(--)S
(used)168 3456 A
3666(in)S
(kernel)252 3792 A
4086(*/)S
2025 V
(01633)210 1122 A
(int)126 1524 A
(sr_bx;)252 1692 A
2115 V
(01634)210 1122 A
(int)126 1524 A
(sr_dx;)252 1692 A
2205 V
(01635)210 1122 A
(int)126 1524 A
(sr_cx;)252 1692 A
2295 V
(01636)210 1122 A
(int)126 1524 A
(sr_retreg;)420 1692 A
2385 V
(01637)210 1122 A
(int)126 1524 A
(sr_retadr;)420 1692 A
2784(/*)S
(return)252 2910 A
(address)294 3204 A
3540(to)S
(caller)252 3666 A
3960(of)S
(save)168 4086 A
4296(--)S
(used)168 4422 A
2475 V
(01638)210 1122 A
2826(*)S
2910(in)S
(kernel)252 3036 A
3330(*/)S
2565 V
(01639)210 1122 A
(int)126 1524 A
(sr_pc;)252 1692 A
2655 V
(01640)210 1122 A
(int)126 1524 A
(sr_cs;)252 1692 A
2745 V
(01641)210 1122 A
(int)126 1524 A
(sr_psw;)294 1692 A
2835 V
(01642)210 1122 A
(int)126 1524 A
(sr_sp;)252 1692 A
2925 V
(01643)210 1122 A
(int)126 1524 A
(sr_ss;)252 1692 A
3015 V
(01644)210 1122 A
1440(};)S
3105 V
(01645)210 1122 A
3195 V
(01646)210 1122 A
(struct)252 1440 A
(sigframe)336 1734 A
2112({)S
2784(/*)S
(stack)210 2910 A
(frame)210 3162 A
(created)294 3414 A
(for)126 3750 A
(signalled)378 3918 A
(process)294 4338 A
4674(*/)S
3285 V
(01647)210 1122 A
(_PROTOTYPE\()462 1524 A
(void)168 2028 A
(\(*sf_retadr\),)546 2238 A
(\(void\))252 2826 A
3120(\);)S
3375 V
(01648)210 1122 A
(int)126 1524 A
(sf_signo;)378 1692 A
3465 V
(01649)210 1122 A
(int)126 1524 A
(sf_code;)336 1692 A
3555 V
(01650)210 1122 A
(struct)252 1524 A
(sigcontext)420 1818 A
(*sf_scp;)336 2280 A
3645 V
(01651)210 1122 A
(int)126 1524 A
(sf_fp;)252 1692 A
3735 V
(01652)210 1122 A
(_PROTOTYPE\()462 1524 A
(void)168 2028 A
(\(*sf_retadr2\),)588 2238 A
(\(void\))252 2868 A
3162(\);)S
3825 V
(01653)210 1122 A
(struct)252 1524 A
(sigcontext)420 1818 A
(*sf_scpcopy;)504 2280 A
3915 V
(01654)210 1122 A
1440(};)S
4005 V
(01655)210 1122 A
4095 V
(01656)210 1122 A
(struct)252 1440 A
(sigcontext)420 1734 A
2196({)S
4185 V
(01657)210 1122 A
(int)126 1524 A
(sc_flags;)378 1692 A
2784(/*)S
(sigstack)336 2910 A
(state)210 3288 A
3540(to)S
(restore)294 3666 A
4002(*/)S
4275 V
(01658)210 1122 A
(long)168 1524 A
(sc_mask;)336 1734 A
2784(/*)S
(signal)252 2910 A
(mask)168 3204 A
3414(to)S
(restore)294 3540 A
3876(*/)S
4365 V
(01659)210 1122 A
(struct)252 1524 A
(sigregs)294 1818 A
(sc_regs;)336 2154 A
2784(/*)S
(register)336 2910 A
(set)126 3288 A
3456(to)S
(restore)294 3582 A
3918(*/)S
4455 V
(01660)210 1122 A
1440(};)S
4545 V
(01661)210 1122 A
4635 V
(01662)210 1122 A
(#define)294 1440 A
(sc_gs)210 1776 A
(sc_regs.sr_gs)546 2028 A
4725 V
(01663)210 1122 A
(#define)294 1440 A
(sc_fs)210 1776 A
(sc_regs.sr_fs)546 2028 A
4815 V
(01664)210 1122 A
(#define)294 1440 A
(sc_es)210 1776 A
(sc_regs.sr_es)546 2028 A
4905 V
(01665)210 1122 A
(#define)294 1440 A
(sc_ds)210 1776 A
(sc_regs.sr_ds)546 2028 A
4995 V
(01666)210 1122 A
(#define)294 1440 A
(sc_di)210 1776 A
(sc_regs.sr_di)546 2028 A
5085 V
(01667)210 1122 A
(#define)294 1440 A
(sc_si)210 1776 A
(sc_regs.sr_si)546 2028 A
5175 V
(01668)210 1122 A
(#define)294 1440 A
(sc_fp)210 1776 A
(sc_regs.sr_bp)546 2028 A
5265 V
(01669)210 1122 A
(#define)294 1440 A
(sc_st)210 1776 A
(sc_regs.sr_st)546 2028 A
3120(/*)S
(stack)210 3246 A
(top)126 3498 A
3666(--)S
(used)168 3792 A
4002(in)S
(kernel)252 4128 A
4422(*/)S
5355 V
(01670)210 1122 A
(#define)294 1440 A
(sc_bx)210 1776 A
(sc_regs.sr_bx)546 2028 A
5445 V
(01671)210 1122 A
(#define)294 1440 A
(sc_dx)210 1776 A
(sc_regs.sr_dx)546 2028 A
5535 V
(01672)210 1122 A
(#define)294 1440 A
(sc_cx)210 1776 A
(sc_regs.sr_cx)546 2028 A
5625 V
(01673)210 1122 A
(#define)294 1440 A
(sc_retreg)378 1776 A
(sc_regs.sr_retreg)714 2196 A
5715 V
(01674)210 1122 A
(#define)294 1440 A
(sc_retadr)378 1776 A
(sc_regs.sr_retadr)714 2196 A
3120(/*)S
(return)252 3246 A
(address)294 3540 A
3876(to)S
(caller)252 4002 A
4296(of)S
5805 V
(01675)210 1122 A
(save)168 3120 A
3330(--)S
(used)168 3456 A
3666(in)S
(kernel)252 3792 A
4086(*/)S
5895 V
(01676)210 1122 A
(#define)294 1440 A
(sc_pc)210 1776 A
(sc_regs.sr_pc)546 2028 A
5985 V
(01677)210 1122 A
(#define)294 1440 A
(sc_cs)210 1776 A
(sc_regs.sr_cs)546 2028 A
6075 V
(01678)210 1122 A
(#define)294 1440 A
(sc_psw)252 1776 A
(sc_regs.sr_psw)588 2070 A
6165 V
(01679)210 1122 A
(#define)294 1440 A
(sc_sp)210 1776 A
(sc_regs.sr_sp)546 2028 A
6255 V
(01680)210 1122 A
(#define)294 1440 A
(sc_ss)210 1776 A
(sc_regs.sr_ss)546 2028 A
6345 V
(01681)210 1122 A
6435 V
(01682)210 1122 A
1440(/*)S
(Values)252 1566 A
(for)126 1860 A
(sc_flags.)378 2028 A
(Must)168 2490 A
(agree)210 2700 A
(with)168 2952 A
(<minix/jmp_buf.h>.)756 3162 A
3960(*/)S
6525 V
(01683)210 1122 A
(#define)294 1440 A
(SC_SIGCONTEXT)546 1776 A
2448(2)S
2784(/*)S
(nonzero)294 2910 A
(when)168 3246 A
(signal)252 3456 A
(context)294 3750 A
4086(is)S
(included)336 4212 A
4590(*/)S
6615 V
(01684)210 1122 A
(#define)294 1440 A
(SC_NOREGLOCALS)588 1776 A
2448(4)S
2784(/*)S
(nonzero)294 2910 A
(when)168 3246 A
(registers)378 3456 A
(are)126 3876 A
(not)126 4044 A
4212(to)S
4338(be)S
6705 V
(01685)210 1122 A
(saved)210 3120 A
(and)126 3372 A
(restored)336 3540 A
3918(*/)S
6795 V
(01686)210 1122 A
6885 V
(01687)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sigreturn,)420 2112 A
(\(struct)294 2574 A
(sigcontext)420 2910 A
(*_scp\))252 3372 A
4464(\);)S
6975 V
(01688)210 1122 A
7065 V
(01689)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_SIGCONTEXT_H)546 1860 A
2448(*/)S
8418 V
EP
%%Page: 22 22
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(22)S
11 R
2379(File:)S
2612(include/sys/stat.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(include/sys/stat.h)756 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(01700)210 1122 A
1440(/*)S
(The)126 1566 A
(<sys/stat.h>)504 1734 A
(header)252 2280 A
(defines)294 2574 A
2910(a)S
(struct)252 2994 A
(that)168 3288 A
3498(is)S
(used)168 3624 A
3834(in)S
(the)126 3960 A
(stat\(\))252 4128 A
(and)126 4422 A
2295 V
(01701)210 1122 A
1482(*)S
(fstat)210 1566 A
(functions.)420 1818 A
(The)126 2322 A
(information)462 2490 A
2994(in)S
(this)168 3120 A
(struct)252 3330 A
(comes)210 3624 A
(from)168 3876 A
(the)126 4086 A
(i-node)252 4254 A
4548(of)S
2385 V
(01702)210 1122 A
1482(*)S
(some)168 1566 A
(file.)210 1776 A
(These)210 2070 A
(calls)210 2322 A
(are)126 2574 A
(the)126 2742 A
(only)168 2910 A
(approved)336 3120 A
(way)126 3498 A
3666(to)S
(inspect)294 3792 A
(i-nodes.)336 4128 A
2475 V
(01703)210 1122 A
1482(*/)S
2565 V
(01704)210 1122 A
2655 V
(01705)210 1122 A
(#ifndef)294 1440 A
(_STAT_H)294 1776 A
2745 V
(01706)210 1122 A
(#define)294 1440 A
(_STAT_H)294 1776 A
2835 V
(01707)210 1122 A
2925 V
(01708)210 1122 A
(#ifndef)294 1440 A
(_TYPES_H)336 1776 A
3015 V
(01709)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
3105 V
(01710)210 1122 A
(#endif)252 1440 A
3195 V
(01711)210 1122 A
3285 V
(01712)210 1122 A
(struct)252 1440 A
(stat)168 1734 A
1944({)S
3375 V
(01713)210 1122 A
(dev_t)210 1524 A
(st_dev;)294 1776 A
2784(/*)S
(major/minor)462 2910 A
(device)252 3414 A
(number)252 3708 A
4002(*/)S
3465 V
(01714)210 1122 A
(ino_t)210 1524 A
(st_ino;)294 1776 A
2784(/*)S
(i-node)252 2910 A
(number)252 3204 A
3498(*/)S
3555 V
(01715)210 1122 A
(mode_t)252 1524 A
(st_mode;)336 1818 A
2784(/*)S
(file)168 2910 A
(mode,)210 3120 A
(protection)420 3372 A
(bits,)210 3834 A
(etc.)168 4086 A
4296(*/)S
3645 V
(01716)210 1122 A
(short)210 1524 A
(int)126 1776 A
(st_nlink;)378 1944 A
2784(/*)S
2910(#)S
(links;)252 2994 A
(TEMPORARY)378 3288 A
(HACK:)210 3708 A
(should)252 3960 A
4254(be)S
(nlink_t*/)378 4380 A
3735 V
(01717)210 1122 A
(uid_t)210 1524 A
(st_uid;)294 1776 A
2784(/*)S
(uid)126 2910 A
3078(of)S
(the)126 3204 A
(file's)252 3372 A
(owner)210 3666 A
3918(*/)S
3825 V
(01718)210 1122 A
(short)210 1524 A
(int)126 1776 A
(st_gid;)294 1944 A
2784(/*)S
(gid;)168 2910 A
(TEMPORARY)378 3120 A
(HACK:)210 3540 A
(should)252 3792 A
4086(be)S
(gid_t)210 4212 A
4464(*/)S
3915 V
(01719)210 1122 A
(dev_t)210 1524 A
(st_rdev;)336 1776 A
4005 V
(01720)210 1122 A
(off_t)210 1524 A
(st_size;)336 1776 A
2784(/*)S
(file)168 2910 A
(size)168 3120 A
3330(*/)S
4095 V
(01721)210 1122 A
(time_t)252 1524 A
(st_atime;)378 1818 A
2784(/*)S
(time)168 2910 A
3120(of)S
(last)168 3246 A
(access)252 3456 A
3750(*/)S
4185 V
(01722)210 1122 A
(time_t)252 1524 A
(st_mtime;)378 1818 A
2784(/*)S
(time)168 2910 A
3120(of)S
(last)168 3246 A
(data)168 3456 A
(modification)504 3666 A
4212(*/)S
4275 V
(01723)210 1122 A
(time_t)252 1524 A
(st_ctime;)378 1818 A
2784(/*)S
(time)168 2910 A
3120(of)S
(last)168 3246 A
(file)168 3456 A
(status)252 3666 A
(change)252 3960 A
4254(*/)S
4365 V
(01724)210 1122 A
1440(};)S
4455 V
(01725)210 1122 A
4545 V
(01726)210 1122 A
1440(/*)S
(Traditional)462 1566 A
(mask)168 2070 A
(definitions)462 2280 A
(for)126 2784 A
(st_mode.)336 2952 A
3330(*/)S
4635 V
(01727)210 1122 A
1440(/*)S
(The)126 1566 A
(ugly)168 1734 A
(casts)210 1944 A
2196(on)S
(only)168 2322 A
(some)168 2532 A
2742(of)S
(the)126 2868 A
(definitions)462 3036 A
(are)126 3540 A
3708(to)S
(avoid)210 3834 A
(suprising)378 4086 A
(sign)168 4506 A
4725 V
(01728)210 1122 A
1482(*)S
(extensions)420 1566 A
(such)168 2028 A
2238(as)S
(S_IFREG)294 2364 A
2700(!=)S
(\(mode_t\))336 2826 A
(S_IFREG)294 3204 A
(when)168 3540 A
(ints)168 3750 A
(are)126 3960 A
4128(32)S
(bits.)210 4254 A
4815 V
(01729)210 1122 A
1482(*/)S
4905 V
(01730)210 1122 A
(#define)294 1440 A
(S_IFMT)252 1776 A
(\(\(mode_t\))378 2112 A
(0170000\))336 2532 A
3120(/*)S
(type)168 3246 A
3456(of)S
(file)168 3582 A
3792(*/)S
4995 V
(01731)210 1122 A
(#define)294 1440 A
(S_IFLNK)294 1776 A
(\(\(mode_t\))378 2112 A
(0120000\))336 2532 A
3120(/*)S
(symbolic)336 3246 A
(link,)210 3624 A
(not)126 3876 A
(implemented)462 4044 A
4548(*/)S
5085 V
(01732)210 1122 A
(#define)294 1440 A
(S_IFREG)294 1776 A
(\(\(mode_t\))378 2112 A
(0100000\))336 2532 A
3120(/*)S
(regular)294 3246 A
3582(*/)S
5175 V
(01733)210 1122 A
(#define)294 1440 A
(S_IFBLK)294 1776 A
(0060000)294 2112 A
2784(/*)S
(block)210 2910 A
(special)294 3162 A
3498(*/)S
5265 V
(01734)210 1122 A
(#define)294 1440 A
(S_IFDIR)294 1776 A
(0040000)294 2112 A
2784(/*)S
(directory)378 2910 A
3330(*/)S
5355 V
(01735)210 1122 A
(#define)294 1440 A
(S_IFCHR)294 1776 A
(0020000)294 2112 A
2784(/*)S
(character)378 2910 A
(special)294 3330 A
3666(*/)S
5445 V
(01736)210 1122 A
(#define)294 1440 A
(S_IFIFO)294 1776 A
(0010000)294 2112 A
2784(/*)S
(this)168 2910 A
3120(is)S
3246(a)S
(FIFO)168 3330 A
3540(*/)S
5535 V
(01737)210 1122 A
(#define)294 1440 A
(S_ISUID)294 1776 A
(0004000)294 2112 A
2784(/*)S
(set)126 2910 A
(user)168 3078 A
3288(id)S
3414(on)S
(execution)378 3540 A
3960(*/)S
5625 V
(01738)210 1122 A
(#define)294 1440 A
(S_ISGID)294 1776 A
(0002000)294 2112 A
2784(/*)S
(set)126 2910 A
(group)210 3078 A
3330(id)S
3456(on)S
(execution)378 3582 A
4002(*/)S
5715 V
(01739)210 1122 A
2784(/*)S
(next)168 2910 A
3120(is)S
(reserved)336 3246 A
(for)126 3624 A
(future)252 3792 A
(use)126 4086 A
4254(*/)S
5805 V
(01740)210 1122 A
(#define)294 1440 A
(S_ISVTX)294 1776 A
(01000)210 2196 A
2784(/*)S
(save)168 2910 A
(swapped)294 3120 A
(text)168 3456 A
(even)168 3666 A
(after)210 3876 A
(use)126 4128 A
4296(*/)S
5895 V
(01741)210 1122 A
5985 V
(01742)210 1122 A
1440(/*)S
(POSIX)210 1566 A
(masks)210 1818 A
(for)126 2070 A
(st_mode.)336 2238 A
2616(*/)S
6075 V
(01743)210 1122 A
(#define)294 1440 A
(S_IRWXU)294 1776 A
(00700)210 2196 A
2784(/*)S
(owner:)252 2910 A
(rwx------)378 3246 A
3666(*/)S
6165 V
(01744)210 1122 A
(#define)294 1440 A
(S_IRUSR)294 1776 A
(00400)210 2196 A
2784(/*)S
(owner:)252 2910 A
(r--------)378 3246 A
3666(*/)S
6255 V
(01745)210 1122 A
(#define)294 1440 A
(S_IWUSR)294 1776 A
(00200)210 2196 A
2784(/*)S
(owner:)252 2910 A
(-w-------)378 3246 A
3666(*/)S
6345 V
(01746)210 1122 A
(#define)294 1440 A
(S_IXUSR)294 1776 A
(00100)210 2196 A
2784(/*)S
(owner:)252 2910 A
(--x------)378 3246 A
3666(*/)S
6435 V
(01747)210 1122 A
6525 V
(01748)210 1122 A
(#define)294 1440 A
(S_IRWXG)294 1776 A
(00070)210 2196 A
2784(/*)S
(group:)252 2910 A
(---rwx---)378 3246 A
3666(*/)S
6615 V
(01749)210 1122 A
(#define)294 1440 A
(S_IRGRP)294 1776 A
(00040)210 2196 A
2784(/*)S
(group:)252 2910 A
(---r-----)378 3246 A
3666(*/)S
6705 V
(01750)210 1122 A
(#define)294 1440 A
(S_IWGRP)294 1776 A
(00020)210 2196 A
2784(/*)S
(group:)252 2910 A
(----w----)378 3246 A
3666(*/)S
6795 V
(01751)210 1122 A
(#define)294 1440 A
(S_IXGRP)294 1776 A
(00010)210 2196 A
2784(/*)S
(group:)252 2910 A
(-----x---)378 3246 A
3666(*/)S
6885 V
(01752)210 1122 A
6975 V
(01753)210 1122 A
(#define)294 1440 A
(S_IRWXO)294 1776 A
(00007)210 2196 A
2784(/*)S
(others:)294 2910 A
(------rwx)378 3246 A
3666(*/)S
7065 V
(01754)210 1122 A
(#define)294 1440 A
(S_IROTH)294 1776 A
(00004)210 2196 A
2784(/*)S
(others:)294 2910 A
(------r--)378 3246 A
3666(*/)S
8418 V
EP
%%Page: 23 23
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2379(File:)S
2612(include/sys/stat.h)S
12 B
4560(23)S
1755 V
7 LST
(01755)210 1122 A
(#define)294 1440 A
(S_IWOTH)294 1776 A
(00002)210 2196 A
2784(/*)S
(others:)294 2910 A
(-------w-)378 3246 A
3666(*/)S
1845 V
(01756)210 1122 A
(#define)294 1440 A
(S_IXOTH)294 1776 A
(00001)210 2196 A
2784(/*)S
(others:)294 2910 A
(--------x)378 3246 A
3666(*/)S
1935 V
(01757)210 1122 A
2025 V
(01758)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(macros)252 2154 A
(test)168 2448 A
(st_mode)294 2658 A
(\(from)210 2994 A
(POSIX)210 3246 A
(Sec.)168 3498 A
(5.6.1.1\).)378 3708 A
4128(*/)S
2115 V
(01759)210 1122 A
(#define)294 1440 A
(S_ISREG\(m\))420 1776 A
(\(\(\(m\))210 2448 A
2700(&)S
(S_IFMT\))294 2784 A
3120(==)S
(S_IFREG\))336 3246 A
3792(/*)S
3918(is)S
4044(a)S
(reg)126 4128 A
(file)168 4296 A
4506(*/)S
2205 V
(01760)210 1122 A
(#define)294 1440 A
(S_ISDIR\(m\))420 1776 A
(\(\(\(m\))210 2448 A
2700(&)S
(S_IFMT\))294 2784 A
3120(==)S
(S_IFDIR\))336 3246 A
3792(/*)S
3918(is)S
4044(a)S
(directory)378 4128 A
4548(*/)S
2295 V
(01761)210 1122 A
(#define)294 1440 A
(S_ISCHR\(m\))420 1776 A
(\(\(\(m\))210 2448 A
2700(&)S
(S_IFMT\))294 2784 A
3120(==)S
(S_IFCHR\))336 3246 A
3792(/*)S
3918(is)S
4044(a)S
(char)168 4128 A
(spec)168 4338 A
4548(*/)S
2385 V
(01762)210 1122 A
(#define)294 1440 A
(S_ISBLK\(m\))420 1776 A
(\(\(\(m\))210 2448 A
2700(&)S
(S_IFMT\))294 2784 A
3120(==)S
(S_IFBLK\))336 3246 A
3792(/*)S
3918(is)S
4044(a)S
(block)210 4128 A
(spec)168 4380 A
4590(*/)S
2475 V
(01763)210 1122 A
(#define)294 1440 A
(S_ISFIFO\(m\))462 1776 A
(\(\(\(m\))210 2448 A
2700(&)S
(S_IFMT\))294 2784 A
3120(==)S
(S_IFIFO\))336 3246 A
3792(/*)S
3918(is)S
4044(a)S
(pipe/FIFO)378 4128 A
4548(*/)S
2565 V
(01764)210 1122 A
(#define)294 1440 A
(S_ISLNK\(m\))420 1776 A
(\(\(\(m\))210 2448 A
2700(&)S
(S_IFMT\))294 2784 A
3120(==)S
(S_IFLNK\))336 3246 A
3792(/*)S
3918(is)S
4044(a)S
(sym)126 4128 A
(link)168 4296 A
4506(*/)S
2655 V
(01765)210 1122 A
2745 V
(01766)210 1122 A
1440(/*)S
(Function)336 1566 A
(Prototypes.)462 1944 A
2448(*/)S
2835 V
(01767)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(chmod,)252 2112 A
(\(const)252 2406 A
(char)168 2700 A
(*_path,)294 2910 A
(_mnx_Mode_t)462 3246 A
(_mode\))252 3750 A
4464(\);)S
2925 V
(01768)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(fstat,)252 2112 A
(\(int)168 2406 A
(_fildes,)336 2616 A
(struct)252 2994 A
(stat)168 3288 A
(*_buf\))252 3498 A
4464(\);)S
3015 V
(01769)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(mkdir,)252 2112 A
(\(const)252 2406 A
(char)168 2700 A
(*_path,)294 2910 A
(_mnx_Mode_t)462 3246 A
(_mode\))252 3750 A
4464(\);)S
3105 V
(01770)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(mkfifo,)294 2112 A
(\(const)252 2448 A
(char)168 2742 A
(*_path,)294 2952 A
(_mnx_Mode_t)462 3288 A
(_mode\))252 3792 A
4464(\);)S
3195 V
(01771)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(stat,)210 2112 A
(\(const)252 2364 A
(char)168 2658 A
(*_path,)294 2868 A
(struct)252 3204 A
(stat)168 3498 A
(*_buf\))252 3708 A
4464(\);)S
3285 V
(01772)210 1122 A
(_PROTOTYPE\()462 1440 A
(mode_t)252 1944 A
(umask,)252 2238 A
(\(_mnx_Mode_t)504 2532 A
(_cmask\))294 3078 A
4464(\);)S
3375 V
(01773)210 1122 A
3465 V
(01774)210 1122 A
1440(/*)S
(Open)168 1566 A
(Group)210 1776 A
(Base)168 2028 A
(Specifications)588 2238 A
(Issue)210 2868 A
3120(6)S
(\(not)168 3204 A
(complete\))378 3414 A
3834(*/)S
3555 V
(01775)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(lstat,)252 2112 A
(\(const)252 2406 A
(char)168 2700 A
(*_path,)294 2910 A
(struct)252 3246 A
(stat)168 3540 A
(*_buf\))252 3750 A
4464(\);)S
3645 V
(01776)210 1122 A
3735 V
(01777)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_STAT_H)294 1860 A
2196(*/)S
4095 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4185 V
(include/sys/dir.h)714 2676 A
4275 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4455 V
(01800)210 1122 A
1440(/*)S
(The)126 1566 A
(<dir.h>)294 1734 A
(header)252 2070 A
(gives)210 2364 A
(the)126 2616 A
(layout)252 2784 A
3078(of)S
3204(a)S
(directory.)420 3288 A
3750(*/)S
4545 V
(01801)210 1122 A
4635 V
(01802)210 1122 A
(#ifndef)294 1440 A
(_DIR_H)252 1776 A
4725 V
(01803)210 1122 A
(#define)294 1440 A
(_DIR_H)252 1776 A
4815 V
(01804)210 1122 A
4905 V
(01805)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
4995 V
(01806)210 1122 A
5085 V
(01807)210 1122 A
(#define)294 1440 A
(DIRBLKSIZ)378 1776 A
(512)126 2448 A
2784(/*)S
(size)168 2910 A
3120(of)S
(directory)378 3246 A
(block)210 3666 A
3918(*/)S
5175 V
(01808)210 1122 A
5265 V
(01809)210 1122 A
(#ifndef)294 1440 A
(DIRSIZ)252 1776 A
5355 V
(01810)210 1122 A
(#define)294 1440 A
(DIRSIZ)252 1776 A
2112(60)S
5445 V
(01811)210 1122 A
(#endif)252 1440 A
5535 V
(01812)210 1122 A
5625 V
(01813)210 1122 A
(struct)252 1440 A
(direct)252 1734 A
2028({)S
5715 V
(01814)210 1122 A
(ino_t)210 1524 A
(d_ino;)252 1776 A
5805 V
(01815)210 1122 A
(char)168 1524 A
(d_name[DIRSIZ];)630 1734 A
5895 V
(01816)210 1122 A
1440(};)S
5985 V
(01817)210 1122 A
6075 V
(01818)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_DIR_H)252 1860 A
2154(*/)S
6345 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6435 V
(include/sys/wait.h)756 2676 A
6525 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6705 V
(01900)210 1122 A
1440(/*)S
(The)126 1566 A
(<sys/wait.h>)504 1734 A
(header)252 2280 A
(contains)336 2574 A
(macros)252 2952 A
(related)294 3246 A
3582(to)S
(wait\(\).)294 3708 A
(The)126 4044 A
(value)210 4212 A
6795 V
(01901)210 1122 A
1482(*)S
(returned)336 1566 A
1944(by)S
(wait\(\))252 2070 A
(and)126 2364 A
(waitpid\(\))378 2532 A
(depends)294 2952 A
3288(on)S
(whether)294 3414 A
(the)126 3750 A
(process)294 3918 A
6885 V
(01902)210 1122 A
1482(*)S
(terminated)420 1566 A
2028(by)S
2154(an)S
(exit\(\))252 2280 A
(call,)210 2574 A
(was)126 2826 A
(killed)252 2994 A
3288(by)S
3414(a)S
(signal,)294 3498 A
3834(or)S
(was)126 3960 A
(stopped)294 4128 A
6975 V
(01903)210 1122 A
1482(*)S
(due)126 1566 A
1734(to)S
(job)126 1860 A
(control,)336 2028 A
2406(as)S
(follows:)336 2532 A
7065 V
(01904)210 1122 A
1482(*)S
8418 V
EP
%%Page: 24 24
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(24)S
11 R
2361(File:)S
2594(include/sys/wait.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(01905)210 1122 A
1482(*)S
(High)168 2826 A
(byte)168 3036 A
(Low)126 3330 A
(byte)168 3498 A
1845 V
(01906)210 1122 A
1482(*)S
(+---------------------+)966 2784 A
1935 V
(01907)210 1122 A
1482(*)S
(exit\(status\))504 1776 A
2784(|)S
(status)252 2910 A
3246(|)S
3456(0)S
3708(|)S
2025 V
(01908)210 1122 A
1482(*)S
(+---------------------+)966 2784 A
2115 V
(01909)210 1122 A
1482(*)S
(killed)252 1776 A
2070(by)S
(signal)252 2196 A
2784(|)S
2994(0)S
3246(|)S
(signal)252 3372 A
3708(|)S
2205 V
(01910)210 1122 A
1482(*)S
(+---------------------+)966 2784 A
2295 V
(01911)210 1122 A
1482(*)S
(stopped)294 1776 A
(\(job)168 2112 A
(control\))336 2322 A
2784(|)S
(signal)252 2910 A
3246(|)S
(0177)168 3414 A
3708(|)S
2385 V
(01912)210 1122 A
1482(*)S
(+---------------------+)966 2784 A
2475 V
(01913)210 1122 A
1482(*/)S
2565 V
(01914)210 1122 A
2655 V
(01915)210 1122 A
(#ifndef)294 1440 A
(_WAIT_H)294 1776 A
2745 V
(01916)210 1122 A
(#define)294 1440 A
(_WAIT_H)294 1776 A
2835 V
(01917)210 1122 A
2925 V
(01918)210 1122 A
(#ifndef)294 1440 A
(_TYPES_H)336 1776 A
3015 V
(01919)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
3105 V
(01920)210 1122 A
(#endif)252 1440 A
3195 V
(01921)210 1122 A
3285 V
(01922)210 1122 A
(#define)294 1440 A
(_LOW\(v\))294 1776 A
2448(\()S
(\(v\))126 2532 A
2700(&)S
(0377\))210 2784 A
3375 V
(01923)210 1122 A
(#define)294 1440 A
(_HIGH\(v\))336 1776 A
2448(\()S
(\(\(v\))168 2532 A
2742(>>)S
2868(8\))S
2994(&)S
(0377\))210 3078 A
3465 V
(01924)210 1122 A
3555 V
(01925)210 1122 A
(#define)294 1440 A
(WNOHANG)294 1776 A
2448(1)S
2784(/*)S
2910(do)S
(not)126 3036 A
(wait)168 3204 A
(for)126 3414 A
(child)210 3582 A
3834(to)S
(exit)168 3960 A
4170(*/)S
3645 V
(01926)210 1122 A
(#define)294 1440 A
(WUNTRACED)378 1776 A
2448(2)S
2784(/*)S
(for)126 2910 A
(job)126 3078 A
(control;)336 3246 A
(not)126 3624 A
(implemented)462 3792 A
4296(*/)S
3735 V
(01927)210 1122 A
3825 V
(01928)210 1122 A
(#define)294 1440 A
(WIFEXITED\(s\))504 1776 A
(\(_LOW\(s\))336 2448 A
2826(==)S
2952(0\))S
3960(/*)S
(normal)252 4086 A
(exit)168 4380 A
4590(*/)S
3915 V
(01929)210 1122 A
(#define)294 1440 A
(WEXITSTATUS\(s\))588 1776 A
(\(_HIGH\(s\)\))420 2448 A
3960(/*)S
(exit)168 4086 A
(status)252 4296 A
4590(*/)S
4005 V
(01930)210 1122 A
(#define)294 1440 A
(WTERMSIG\(s\))462 1776 A
(\(_LOW\(s\))336 2448 A
2826(&)S
(0177\))210 2910 A
3960(/*)S
(sig)126 4086 A
(value)210 4254 A
4506(*/)S
4095 V
(01931)210 1122 A
(#define)294 1440 A
(WIFSIGNALED\(s\))588 1776 A
(\(\(\(unsigned)462 2448 A
(int\)\(s\)-1)378 2952 A
3372(&)S
(0xFFFF\))294 3456 A
3792(<)S
(0xFF\))210 3876 A
4128(/*)S
(signaled)336 4254 A
4632(*/)S
4185 V
(01932)210 1122 A
(#define)294 1440 A
(WIFSTOPPED\(s\))546 1776 A
(\(_LOW\(s\))336 2448 A
2826(==)S
(0177\))210 2952 A
3960(/*)S
(stopped)294 4086 A
4422(*/)S
4275 V
(01933)210 1122 A
(#define)294 1440 A
(WSTOPSIG\(s\))462 1776 A
(\(_HIGH\(s\))378 2448 A
2868(&)S
(0377\))210 2952 A
3960(/*)S
(stop)168 4086 A
(signal)252 4296 A
4590(*/)S
4365 V
(01934)210 1122 A
4455 V
(01935)210 1122 A
1440(/*)S
(Function)336 1566 A
(Prototypes.)462 1944 A
2448(*/)S
4545 V
(01936)210 1122 A
(_PROTOTYPE\()462 1440 A
(pid_t)210 1944 A
(wait,)210 2196 A
(\(int)168 2448 A
(*_stat_loc\))462 2658 A
4590(\);)S
4635 V
(01937)210 1122 A
(_PROTOTYPE\()462 1440 A
(pid_t)210 1944 A
(waitpid,)336 2196 A
(\(pid_t)252 2574 A
(_pid,)210 2868 A
(int)126 3120 A
(*_stat_loc,)462 3288 A
(int)126 3792 A
(_options\))378 3960 A
4590(\);)S
4725 V
(01938)210 1122 A
4815 V
(01939)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_WAIT_H)294 1860 A
2196(*/)S
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(include/sys/ioctl.h)798 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(02000)210 1122 A
1440(/*)S
(sys/ioctl.h)462 1776 A
2280(-)S
(All)126 2364 A
(ioctl\(\))294 2532 A
(command)294 2868 A
(codes.)252 3204 A
(Author:)294 3792 A
(Kees)168 4128 A
4338(J.)S
(Bot)126 4464 A
5445 V
(02001)210 1122 A
1482(*)S
4128(23)S
(Nov)126 4254 A
(2002)168 4422 A
5535 V
(02002)210 1122 A
1482(*)S
5625 V
(02003)210 1122 A
1482(*)S
(This)168 1566 A
(header)252 1776 A
(file)168 2070 A
(includes)336 2280 A
(all)126 2658 A
(other)210 2826 A
(ioctl)210 3078 A
(command)294 3330 A
(code)168 3666 A
(headers.)336 3876 A
5715 V
(02004)210 1122 A
1482(*/)S
5805 V
(02005)210 1122 A
5895 V
(02006)210 1122 A
(#ifndef)294 1440 A
(_S_IOCTL_H)420 1776 A
5985 V
(02007)210 1122 A
(#define)294 1440 A
(_S_IOCTL_H)420 1776 A
6075 V
(02008)210 1122 A
6165 V
(02009)210 1122 A
1440(/*)S
1566(A)S
(driver)252 1650 A
(that)168 1944 A
(uses)168 2154 A
(ioctls)252 2364 A
(claims)252 2658 A
2952(a)S
(character)378 3036 A
(for)126 3456 A
(its)126 3624 A
(series)252 3792 A
4086(of)S
(commands.)378 4212 A
6255 V
(02010)210 1122 A
1482(*)S
(For)126 1566 A
(instance:)378 1734 A
(#define)294 2196 A
(TCGETS)252 2532 A
(_IOR\('T',)378 2868 A
3330(8,)S
(struct)252 3456 A
(termios\))336 3750 A
6345 V
(02011)210 1122 A
1482(*)S
(This)168 1566 A
1776(is)S
1902(a)S
(terminal)336 1986 A
(ioctl)210 2364 A
(that)168 2616 A
(uses)168 2826 A
(the)126 3036 A
(character)378 3204 A
('T'.)168 3624 A
(The)126 3876 A
(character\(s\))504 4044 A
6435 V
(02012)210 1122 A
1482(*)S
(used)168 1566 A
1776(in)S
(each)168 1902 A
(header)252 2112 A
(file)168 2406 A
(are)126 2616 A
(shown)210 2784 A
3036(in)S
(the)126 3162 A
(comment)294 3330 A
(following.)420 3666 A
6525 V
(02013)210 1122 A
1482(*/)S
6615 V
(02014)210 1122 A
6705 V
(02015)210 1122 A
(#include)336 1440 A
(<sys/ioc_tty.h>)630 1818 A
2784(/*)S
('T')126 2910 A
('t')126 3078 A
('k')126 3246 A
3792(*/)S
6795 V
(02016)210 1122 A
(#include)336 1440 A
(<sys/ioc_disk.h>)672 1818 A
2784(/*)S
('d')126 2910 A
3792(*/)S
6885 V
(02017)210 1122 A
(#include)336 1440 A
(<sys/ioc_memory.h>)756 1818 A
2784(/*)S
('m')126 2910 A
3792(*/)S
6975 V
(02018)210 1122 A
(#include)336 1440 A
(<sys/ioc_cmos.h>)672 1818 A
2784(/*)S
('c')126 2910 A
3792(*/)S
7065 V
(02019)210 1122 A
8418 V
EP
%%Page: 25 25
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2358(File:)S
2591(include/sys/ioctl.h)S
12 B
4560(25)S
1755 V
7 LST
(02020)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_S_IOCTL_H)420 1860 A
2322(*/)S
2295 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2385 V
(include/sys/ioc_disk.h)924 2676 A
2475 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2655 V
(02100)210 1122 A
1440(/*)S
(sys/ioc_disk.h)588 1776 A
2406(-)S
(Disk)168 2490 A
(ioctl\(\))294 2700 A
(command)294 3036 A
(codes.)252 3372 A
(Author:)294 3792 A
(Kees)168 4128 A
4338(J.)S
(Bot)126 4464 A
2745 V
(02101)210 1122 A
1482(*)S
4128(23)S
(Nov)126 4254 A
(2002)168 4422 A
2835 V
(02102)210 1122 A
1482(*)S
2925 V
(02103)210 1122 A
1482(*/)S
3015 V
(02104)210 1122 A
3105 V
(02105)210 1122 A
(#ifndef)294 1440 A
(_S_I_DISK_H)462 1776 A
3195 V
(02106)210 1122 A
(#define)294 1440 A
(_S_I_DISK_H)462 1776 A
3285 V
(02107)210 1122 A
3375 V
(02108)210 1122 A
(#include)336 1440 A
(<minix/ioctl.h>)630 1818 A
3465 V
(02109)210 1122 A
3555 V
(02110)210 1122 A
(#define)294 1440 A
(DIOCSETP)336 1776 A
(_IOW\('d',)378 2448 A
2868(3,)S
(struct)252 2994 A
(partition\))420 3288 A
3645 V
(02111)210 1122 A
(#define)294 1440 A
(DIOCGETP)336 1776 A
(_IOR\('d',)378 2448 A
2868(4,)S
(struct)252 2994 A
(partition\))420 3288 A
3735 V
(02112)210 1122 A
(#define)294 1440 A
(DIOCEJECT)378 1776 A
(_IO)126 2448 A
(\('d',)210 2616 A
2868(5\))S
3825 V
(02113)210 1122 A
(#define)294 1440 A
(DIOCTIMEOUT)462 1776 A
(_IOW\('d',)378 2448 A
2868(6,)S
(int\))168 2994 A
3915 V
(02114)210 1122 A
(#define)294 1440 A
(DIOCOPENCT)420 1776 A
(_IOR\('d',)378 2448 A
2868(7,)S
(int\))168 2994 A
4005 V
(02115)210 1122 A
4095 V
(02116)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_S_I_DISK_H)462 1860 A
2364(*/)S
4545 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4635 V
(include/minix/ioctl.h)882 2676 A
4725 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4905 V
(02200)210 1122 A
1440(/*)S
(minix/ioctl.h)546 1776 A
2364(-)S
(Ioctl)210 2448 A
(helper)252 2700 A
(definitions.)504 2994 A
(Author:)294 3792 A
(Kees)168 4128 A
4338(J.)S
(Bot)126 4464 A
4995 V
(02201)210 1122 A
1482(*)S
4128(23)S
(Nov)126 4254 A
(2002)168 4422 A
5085 V
(02202)210 1122 A
1482(*)S
5175 V
(02203)210 1122 A
1482(*)S
(This)168 1566 A
(file)168 1776 A
1986(is)S
(included)336 2112 A
2490(by)S
(every)210 2616 A
(header)252 2868 A
(file)168 3162 A
(that)168 3372 A
(defines)294 3582 A
(ioctl)210 3918 A
(codes.)252 4170 A
5265 V
(02204)210 1122 A
1482(*/)S
5355 V
(02205)210 1122 A
5445 V
(02206)210 1122 A
(#ifndef)294 1440 A
(_M_IOCTL_H)420 1776 A
5535 V
(02207)210 1122 A
(#define)294 1440 A
(_M_IOCTL_H)420 1776 A
5625 V
(02208)210 1122 A
5715 V
(02209)210 1122 A
(#ifndef)294 1440 A
(_TYPES_H)336 1776 A
5805 V
(02210)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
5895 V
(02211)210 1122 A
(#endif)252 1440 A
5985 V
(02212)210 1122 A
6075 V
(02213)210 1122 A
(#if)126 1440 A
(_EM_WSIZE)378 1608 A
2028(>=)S
2154(4)S
6165 V
(02214)210 1122 A
1440(/*)S
(Ioctls)252 1566 A
(have)168 1860 A
(the)126 2070 A
(command)294 2238 A
(encoded)294 2574 A
2910(in)S
(the)126 3036 A
(low-order)378 3204 A
(word,)210 3624 A
(and)126 3876 A
(the)126 4044 A
(size)168 4212 A
6255 V
(02215)210 1122 A
1482(*)S
1566(of)S
(the)126 1692 A
(parameter)378 1860 A
2280(in)S
(the)126 2406 A
(high-order)420 2574 A
(word.)210 3036 A
(The)126 3288 A
3456(3)S
(high)168 3540 A
(bits)168 3750 A
3960(of)S
(the)126 4086 A
(high-)210 4254 A
6345 V
(02216)210 1122 A
1482(*)S
(order)210 1566 A
(word)168 1818 A
(are)126 2028 A
(used)168 2196 A
2406(to)S
(encode)252 2532 A
(the)126 2826 A
(in/out/void)462 2994 A
(status)252 3498 A
3792(of)S
(the)126 3918 A
(parameter.)420 4086 A
6435 V
(02217)210 1122 A
1482(*/)S
6525 V
(02218)210 1122 A
(#define)294 1440 A
(_IOCPARM_MASK)546 1776 A
(0x1FFF)252 2448 A
6615 V
(02219)210 1122 A
(#define)294 1440 A
(_IOC_VOID)378 1776 A
(0x20000000)420 2448 A
6705 V
(02220)210 1122 A
(#define)294 1440 A
(_IOCTYPE_MASK)546 1776 A
(0xFFFF)252 2448 A
6795 V
(02221)210 1122 A
(#define)294 1440 A
(_IOC_IN)294 1776 A
(0x40000000)420 2448 A
6885 V
(02222)210 1122 A
(#define)294 1440 A
(_IOC_OUT)336 1776 A
(0x80000000)420 2448 A
6975 V
(02223)210 1122 A
(#define)294 1440 A
(_IOC_INOUT)420 1776 A
(\(_IOC_IN)336 2448 A
2826(|)S
(_IOC_OUT\))378 2910 A
7065 V
(02224)210 1122 A
8418 V
EP
%%Page: 26 26
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(26)S
11 R
2299(File:)S
2532(include/minix/ioctl.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(02225)210 1122 A
(#define)294 1440 A
(_IO\(x,y\))336 1776 A
(\(\(x)126 2448 A
2616(<<)S
2742(8\))S
2868(|)S
2952(y)S
3036(|)S
(_IOC_VOID\))420 3120 A
1845 V
(02226)210 1122 A
(#define)294 1440 A
(_IOR\(x,y,t\))462 1776 A
(\(\(x)126 2448 A
2616(<<)S
2742(8\))S
2868(|)S
2952(y)S
3036(|)S
(\(\(sizeof\(t\))462 3120 A
3624(&)S
(_IOCPARM_MASK\))588 3708 A
4338(<<)S
(16\))126 4464 A
4632(|\\)S
1935 V
(02227)210 1122 A
(_IOC_OUT\))378 2784 A
2025 V
(02228)210 1122 A
(#define)294 1440 A
(_IOW\(x,y,t\))462 1776 A
(\(\(x)126 2448 A
2616(<<)S
2742(8\))S
2868(|)S
2952(y)S
3036(|)S
(\(\(sizeof\(t\))462 3120 A
3624(&)S
(_IOCPARM_MASK\))588 3708 A
4338(<<)S
(16\))126 4464 A
4632(|\\)S
2115 V
(02229)210 1122 A
(_IOC_IN\))336 2784 A
2205 V
(02230)210 1122 A
(#define)294 1440 A
(_IORW\(x,y,t\))504 1776 A
(\(\(x)126 2448 A
2616(<<)S
2742(8\))S
2868(|)S
2952(y)S
3036(|)S
(\(\(sizeof\(t\))462 3120 A
3624(&)S
(_IOCPARM_MASK\))588 3708 A
4338(<<)S
(16\))126 4464 A
4632(|\\)S
2295 V
(02231)210 1122 A
(_IOC_INOUT\))462 2784 A
2385 V
(02232)210 1122 A
(#else)210 1440 A
2475 V
(02233)210 1122 A
1440(/*)S
1566(No)S
(fancy)210 1692 A
(encoding)336 1944 A
2322(on)S
2448(a)S
(16-bit)252 2532 A
(machine.)336 2826 A
3204(*/)S
2565 V
(02234)210 1122 A
2655 V
(02235)210 1122 A
(#define)294 1440 A
(_IO\(x,y\))336 1776 A
(\(\(x)126 2448 A
2616(<<)S
2742(8\))S
2868(|)S
2952(y\))S
2745 V
(02236)210 1122 A
(#define)294 1440 A
(_IOR\(x,y,t\))462 1776 A
(_IO\(x,y\))336 2448 A
2835 V
(02237)210 1122 A
(#define)294 1440 A
(_IOW\(x,y,t\))462 1776 A
(_IO\(x,y\))336 2448 A
2925 V
(02238)210 1122 A
(#define)294 1440 A
(_IORW\(x,y,t\))504 1776 A
(_IO\(x,y\))336 2448 A
3015 V
(02239)210 1122 A
(#endif)252 1440 A
3105 V
(02240)210 1122 A
3195 V
(02241)210 1122 A
(int)126 1440 A
(ioctl\(int)378 1608 A
(_fd,)168 2028 A
(int)126 2238 A
(_request,)378 2406 A
(void)168 2826 A
(*_data\);)336 3036 A
3285 V
(02242)210 1122 A
3375 V
(02243)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_M_IOCTL_H)420 1860 A
2322(*/)S
3645 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3735 V
(include/minix/config.h)924 2676 A
3825 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4005 V
(02300)210 1122 A
(#ifndef)294 1440 A
(_CONFIG_H)378 1776 A
4095 V
(02301)210 1122 A
(#define)294 1440 A
(_CONFIG_H)378 1776 A
4185 V
(02302)210 1122 A
4275 V
(02303)210 1122 A
1440(/*)S
(Minix)210 1566 A
(release)294 1818 A
(and)126 2154 A
(version)294 2322 A
(numbers.)336 2658 A
3036(*/)S
4365 V
(02304)210 1122 A
(#define)294 1440 A
(OS_RELEASE)420 1776 A
("3")126 2238 A
4455 V
(02305)210 1122 A
(#define)294 1440 A
(OS_VERSION)420 1776 A
("1.0")210 2238 A
4545 V
(02306)210 1122 A
4635 V
(02307)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(sets)168 1986 A
(configuration)546 2196 A
(parameters)420 2784 A
(for)126 3246 A
(the)126 3414 A
(MINIX)210 3582 A
(kernel,)294 3834 A
(FS,)126 4170 A
(and)126 4338 A
(PM.)126 4506 A
4725 V
(02308)210 1122 A
1482(*)S
1566(It)S
1692(is)S
(divided)294 1818 A
2154(up)S
(into)168 2280 A
(two)126 2490 A
(main)168 2658 A
(sections.)378 2868 A
(The)126 3330 A
(first)210 3498 A
(section)294 3750 A
(contains)336 4086 A
4815 V
(02309)210 1122 A
1482(*)S
(user-settable)546 1566 A
(parameters.)462 2154 A
2700(In)S
(the)126 2826 A
(second)252 2994 A
(section,)336 3288 A
(various)294 3666 A
(internal)336 4002 A
(system)252 4380 A
4905 V
(02310)210 1122 A
1482(*)S
(parameters)420 1566 A
(are)126 2028 A
(set)126 2196 A
(based)210 2364 A
2616(on)S
(the)126 2742 A
(user-settable)546 2910 A
(parameters.)462 3498 A
4995 V
(02311)210 1122 A
1482(*)S
5085 V
(02312)210 1122 A
1482(*)S
(Parts)210 1566 A
1818(of)S
(config.h)336 1944 A
(have)168 2322 A
(been)168 2532 A
(moved)210 2742 A
2994(to)S
(sys_config.h,)546 3120 A
(which)210 3708 A
(can)126 3960 A
4128(be)S
(included)336 4254 A
5175 V
(02313)210 1122 A
1482(*)S
1566(by)S
(other)210 1692 A
(include)294 1944 A
(files)210 2280 A
(that)168 2532 A
(wish)168 2742 A
2952(to)S
(get)126 3078 A
3246(at)S
(the)126 3372 A
(configuration)546 3540 A
(data,)210 4128 A
(but)126 4380 A
5265 V
(02314)210 1122 A
1482(*)S
(don't)210 1566 A
(want)168 1818 A
2028(to)S
(pollute)294 2154 A
(the)126 2490 A
(users)210 2658 A
(namespace.)420 2910 A
(Some)168 3372 A
(editable)336 3582 A
(values)252 3960 A
(have)168 4254 A
5355 V
(02315)210 1122 A
1482(*)S
(gone)168 1566 A
(there.)252 1776 A
5445 V
(02316)210 1122 A
1482(*)S
5535 V
(02317)210 1122 A
1482(*)S
(This)168 1566 A
1776(is)S
1902(a)S
(modified)336 1986 A
(version)294 2364 A
2700(of)S
(config.h)336 2826 A
(for)126 3204 A
(compiling)378 3372 A
3792(a)S
(small)210 3876 A
(Minix)210 4128 A
(system)252 4380 A
5625 V
(02318)210 1122 A
1482(*)S
(with)168 1566 A
(only)168 1776 A
(the)126 1986 A
(options)294 2154 A
(described)378 2490 A
2910(in)S
(the)126 3036 A
(text,)210 3204 A
(Operating)378 3456 A
(Systems)294 3876 A
(Design)252 4212 A
(and)126 4506 A
5715 V
(02319)210 1122 A
1482(*)S
(Implementation,)630 1566 A
(3rd)126 2238 A
(edition.)336 2406 A
(See)126 2784 A
(the)126 2952 A
(version)294 3120 A
3456(of)S
(config.h)336 3582 A
3960(in)S
(the)126 4086 A
(full)168 4254 A
5805 V
(02320)210 1122 A
1482(*)S
(source)252 1566 A
(code)168 1860 A
(directory)378 2070 A
(for)126 2490 A
(information)462 2658 A
3162(on)S
(alternatives)504 3288 A
(omitted)294 3834 A
(here.)210 4170 A
5895 V
(02321)210 1122 A
1482(*/)S
5985 V
(02322)210 1122 A
6075 V
(02323)210 1122 A
1440(/*)S
(The)126 1566 A
(MACHINE)294 1734 A
(\(called)294 2070 A
(_MINIX_MACHINE\))630 2406 A
(setting)294 3078 A
(can)126 3414 A
3582(be)S
(done)168 3708 A
6165 V
(02324)210 1122 A
1482(*)S
1566(in)S
(<minix/machine.h>.)756 1692 A
6255 V
(02325)210 1122 A
1482(*/)S
6345 V
(02326)210 1122 A
(#include)336 1440 A
(<minix/sys_config.h>)840 1818 A
6435 V
(02327)210 1122 A
6525 V
(02328)210 1122 A
(#define)294 1440 A
(MACHINE)294 1776 A
(_MINIX_MACHINE)588 2322 A
6615 V
(02329)210 1122 A
6705 V
(02330)210 1122 A
(#define)294 1440 A
(IBM_PC)252 1776 A
(_MACHINE_IBM_PC)630 2322 A
6795 V
(02331)210 1122 A
(#define)294 1440 A
(SUN_4)210 1776 A
(_MACHINE_SUN_4)588 2322 A
6885 V
(02332)210 1122 A
(#define)294 1440 A
(SUN_4_60)336 1776 A
(_MACHINE_SUN_4_60)714 2322 A
6975 V
(02333)210 1122 A
(#define)294 1440 A
(ATARI)210 1776 A
(_MACHINE_ATARI)588 2322 A
7065 V
(02334)210 1122 A
(#define)294 1440 A
(MACINTOSH)378 1776 A
(_MACHINE_MACINTOSH)756 2322 A
8418 V
EP
%%Page: 27 27
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2257(File:)S
2490(include/minix/config.h)S
12 B
4560(27)S
1755 V
7 LST
(02335)210 1122 A
1845 V
(02336)210 1122 A
1440(/*)S
(Number)252 1566 A
1860(of)S
(slots)210 1986 A
2238(in)S
(the)126 2364 A
(process)294 2532 A
(table)210 2868 A
(for)126 3120 A
(non-kernel)420 3288 A
(processes.)420 3750 A
(The)126 4212 A
(number)252 4380 A
1935 V
(02337)210 1122 A
1482(*)S
1566(of)S
(system)252 1692 A
(processes)378 1986 A
(defines)294 2406 A
(how)126 2742 A
(many)168 2910 A
(processes)378 3120 A
(with)168 3540 A
(special)294 3750 A
(privileges)420 4086 A
2025 V
(02338)210 1122 A
1482(*)S
(there)210 1566 A
(can)126 1818 A
(be.)126 1986 A
(User)168 2154 A
(processes)378 2364 A
(share)210 2784 A
(the)126 3036 A
(same)168 3204 A
(properties)420 3414 A
(and)126 3876 A
(count)210 4044 A
(for)126 4296 A
(one.)168 4464 A
2115 V
(02339)210 1122 A
1482(*)S
2205 V
(02340)210 1122 A
1482(*)S
(These)210 1566 A
(can)126 1818 A
1986(be)S
(changed)294 2112 A
2448(in)S
(sys_config.h.)546 2574 A
2295 V
(02341)210 1122 A
1482(*/)S
2385 V
(02342)210 1122 A
(#define)294 1440 A
(NR_PROCS)336 1776 A
(_NR_PROCS)378 2532 A
2475 V
(02343)210 1122 A
(#define)294 1440 A
(NR_SYS_PROCS)504 1776 A
(_NR_SYS_PROCS)546 2532 A
2565 V
(02344)210 1122 A
2655 V
(02345)210 1122 A
(#define)294 1440 A
(NR_BUFS)294 1776 A
(128)126 2112 A
2745 V
(02346)210 1122 A
(#define)294 1440 A
(NR_BUF_HASH)462 1776 A
(128)126 2280 A
2835 V
(02347)210 1122 A
2925 V
(02348)210 1122 A
1440(/*)S
(Number)252 1566 A
1860(of)S
(controller)420 1986 A
(tasks)210 2448 A
(\(/dev/cN)336 2700 A
(device)252 3078 A
(classes\).)378 3372 A
3792(*/)S
3015 V
(02349)210 1122 A
(#define)294 1440 A
(NR_CTRLRS)378 1776 A
2574(2)S
3105 V
(02350)210 1122 A
3195 V
(02351)210 1122 A
1440(/*)S
(Enable)252 1566 A
1860(or)S
(disable)294 1986 A
(the)126 2322 A
(second)252 2490 A
(level)210 2784 A
(file)168 3036 A
(system)252 3246 A
(cache)210 3540 A
3792(on)S
(the)126 3918 A
(RAM)126 4086 A
(disk.)210 4254 A
4506(*/)S
3285 V
(02352)210 1122 A
(#define)294 1440 A
(ENABLE_CACHE2)546 1776 A
2574(0)S
3375 V
(02353)210 1122 A
3465 V
(02354)210 1122 A
1440(/*)S
(Enable)252 1566 A
1860(or)S
(disable)294 1986 A
(swapping)336 2322 A
(processes)378 2700 A
3120(to)S
(disk.)210 3246 A
3498(*/)S
3555 V
(02355)210 1122 A
(#define)294 1440 A
(ENABLE_SWAP)462 1776 A
2574(0)S
3645 V
(02356)210 1122 A
3735 V
(02357)210 1122 A
1440(/*)S
(Include)294 1566 A
1902(or)S
(exclude)294 2028 A
2364(an)S
(image)210 2490 A
2742(of)S
(/dev/boot)378 2868 A
3288(in)S
(the)126 3414 A
(boot)168 3582 A
(image.)252 3792 A
3825 V
(02358)210 1122 A
1482(*)S
(Please)252 1566 A
(update)252 1860 A
(the)126 2154 A
(makefile)336 2322 A
2700(in)S
(/usr/src/tools/)630 2826 A
3498(as)S
(well.)210 3624 A
3915 V
(02359)210 1122 A
1482(*/)S
4005 V
(02360)210 1122 A
(#define)294 1440 A
(ENABLE_BOOTDEV)588 1776 A
2574(0)S
2784(/*)S
(load)168 2910 A
(image)210 3120 A
3372(of)S
(/dev/boot)378 3498 A
3918(at)S
(boot)168 4044 A
(time)168 4254 A
4464(*/)S
4095 V
(02361)210 1122 A
4185 V
(02362)210 1122 A
1440(/*)S
(DMA_SECTORS)462 1566 A
(may)126 2070 A
2238(be)S
(increased)378 2364 A
2784(to)S
(speed)210 2910 A
3162(up)S
(DMA)126 3288 A
(based)210 3456 A
(drivers.)336 3708 A
4086(*/)S
4275 V
(02363)210 1122 A
(#define)294 1440 A
(DMA_SECTORS)462 1776 A
2574(1)S
2784(/*)S
(DMA)126 2910 A
(buffer)252 3078 A
(size)168 3372 A
(\(must)210 3582 A
3834(be)S
3960(>=)S
4086(1\))S
4212(*/)S
4365 V
(02364)210 1122 A
4455 V
(02365)210 1122 A
1440(/*)S
(Include)294 1566 A
1902(or)S
(exclude)294 2028 A
(backwards)378 2364 A
(compatibility)546 2784 A
(code.)210 3372 A
3624(*/)S
4545 V
(02366)210 1122 A
(#define)294 1440 A
(ENABLE_BINCOMPAT)672 1776 A
2574(0)S
2784(/*)S
(for)126 2910 A
(binaries)336 3078 A
(using)210 3456 A
(obsolete)336 3708 A
(calls)210 4086 A
4338(*/)S
4635 V
(02367)210 1122 A
(#define)294 1440 A
(ENABLE_SRCCOMPAT)672 1776 A
2574(0)S
2784(/*)S
(for)126 2910 A
(sources)294 3078 A
(using)210 3414 A
(obsolete)336 3666 A
(calls)210 4044 A
4296(*/)S
4725 V
(02368)210 1122 A
4815 V
(02369)210 1122 A
1440(/*)S
(Which)210 1566 A
(process)294 1818 A
(should)252 2154 A
(receive)294 2448 A
(diagnostics)462 2784 A
(from)168 3288 A
(the)126 3498 A
(kernel)252 3666 A
(and)126 3960 A
(system?)294 4128 A
4905 V
(02370)210 1122 A
1482(*)S
(Directly)336 1566 A
(sending)294 1944 A
2280(it)S
2406(to)S
(TTY)126 2532 A
(only)168 2700 A
(displays)336 2910 A
(the)126 3288 A
(output.)294 3456 A
(Sending)294 3792 A
4128(it)S
4254(to)S
(the)126 4380 A
4995 V
(02371)210 1122 A
1482(*)S
(log)126 1566 A
(driver)252 1734 A
(will)168 2028 A
(cause)210 2238 A
(the)126 2490 A
(diagnostics)462 2658 A
3162(to)S
3288(be)S
(buffered)336 3414 A
(and)126 3792 A
(displayed.)420 3960 A
5085 V
(02372)210 1122 A
1482(*/)S
5175 V
(02373)210 1122 A
(#define)294 1440 A
(OUTPUT_PROC_NR)588 1776 A
(LOG_PROC_NR)462 2448 A
3120(/*)S
(TTY_PROC_NR)462 3246 A
3750(or)S
(LOG_PROC_NR)462 3876 A
4380(*/)S
5265 V
(02374)210 1122 A
5355 V
(02375)210 1122 A
1440(/*)S
(NR_CONS,)336 1566 A
(NR_RS_LINES,)504 1944 A
(and)126 2490 A
(NR_PTYS)294 2658 A
(determine)378 2994 A
(the)126 3414 A
(number)252 3582 A
3876(of)S
(terminals)378 4002 A
(the)126 4422 A
5445 V
(02376)210 1122 A
1482(*)S
(system)252 1566 A
(can)126 1860 A
(handle.)294 2028 A
5535 V
(02377)210 1122 A
1482(*/)S
5625 V
(02378)210 1122 A
(#define)294 1440 A
(NR_CONS)294 1776 A
2574(4)S
2784(/*)S
2910(#)S
(system)252 2994 A
(consoles)336 3288 A
3666(\(1)S
3792(to)S
3918(8\))S
4044(*/)S
5715 V
(02379)210 1122 A
(#define)294 1440 A
(NR_RS_LINES)462 1776 A
2574(0)S
2784(/*)S
2910(#)S
(rs232)210 2994 A
(terminals)378 3246 A
3666(\(0)S
3792(to)S
3918(4\))S
4044(*/)S
5805 V
(02380)210 1122 A
(#define)294 1440 A
(NR_PTYS)294 1776 A
2574(0)S
2784(/*)S
2910(#)S
(pseudo)252 2994 A
(terminals)378 3288 A
3708(\(0)S
3834(to)S
(64\))126 3960 A
4128(*/)S
5895 V
(02381)210 1122 A
5985 V
(02382)210 1122 A
(/*===========================================================================*)3276 1440 A
6075 V
(02383)210 1122 A
1482(*)S
(There)210 1776 A
(are)126 2028 A
2196(no)S
(user-settable)546 2322 A
(parameters)420 2910 A
(after)210 3372 A
(this)168 3624 A
(line)168 3834 A
4674(*)S
6165 V
(02384)210 1122 A
(*===========================================================================*/)3276 1482 A
6255 V
(02385)210 1122 A
1440(/*)S
(Set)126 1566 A
(the)126 1734 A
(CHIP)168 1902 A
(type)168 2112 A
(based)210 2322 A
2574(on)S
(the)126 2700 A
(machine)294 2868 A
(selected.)378 3204 A
(The)126 3624 A
(symbol)252 3792 A
(CHIP)168 4086 A
4296(is)S
(actually)336 4422 A
6345 V
(02386)210 1122 A
1482(*)S
(indicative)420 1566 A
2028(of)S
(more)168 2154 A
(than)168 2364 A
(just)168 2574 A
(the)126 2784 A
(CPU.)168 2952 A
(For)126 3204 A
(example,)336 3372 A
(machines)336 3750 A
(for)126 4128 A
(which)210 4296 A
6435 V
(02387)210 1122 A
1482(*)S
(CHIP)168 1566 A
1776(==)S
(INTEL)210 1902 A
(are)126 2154 A
(expected)336 2322 A
2700(to)S
(have)168 2826 A
(8259A)210 3036 A
(interrrupt)420 3288 A
(controllers)462 3750 A
(and)126 4254 A
(the)126 4422 A
6525 V
(02388)210 1122 A
1482(*)S
(other)210 1566 A
(properties)420 1818 A
2280(of)S
(IBM)126 2406 A
(PC/XT/AT/386)504 2574 A
(types)210 3120 A
(machines)336 3372 A
3750(in)S
(general.)336 3876 A
4254(*/)S
6615 V
(02389)210 1122 A
(#define)294 1440 A
(INTEL)210 1776 A
(_CHIP_INTEL)462 2532 A
3120(/*)S
(CHIP)168 3246 A
(type)168 3456 A
(for)126 3666 A
(PC,)126 3834 A
(XT,)126 4002 A
(AT,)126 4170 A
(386)126 4338 A
(and)126 4506 A
(clones)252 4674 A
4968(*/)S
6705 V
(02390)210 1122 A
(#define)294 1440 A
(M68000)252 1776 A
(_CHIP_M68000)504 2532 A
3120(/*)S
(CHIP)168 3246 A
(type)168 3456 A
(for)126 3666 A
(Atari,)252 3834 A
(Amiga,)252 4128 A
(Macintosh)378 4422 A
4968(*/)S
6795 V
(02391)210 1122 A
(#define)294 1440 A
(SPARC)210 1776 A
(_CHIP_SPARC)462 2532 A
3120(/*)S
(CHIP)168 3246 A
(type)168 3456 A
(for)126 3666 A
(SUN-4)210 3834 A
(\(e.g.)210 4086 A
(SPARCstation\))546 4338 A
4968(*/)S
6885 V
(02392)210 1122 A
6975 V
(02393)210 1122 A
1440(/*)S
(Set)126 1566 A
(the)126 1734 A
(FP_FORMAT)378 1902 A
(type)168 2322 A
(based)210 2532 A
2784(on)S
(the)126 2910 A
(machine)294 3078 A
(selected,)378 3414 A
(either)252 3834 A
4128(hw)S
4254(or)S
4380(sw)S
4632(*/)S
7065 V
(02394)210 1122 A
(#define)294 1440 A
(FP_NONE)294 1776 A
(_FP_NONE)336 2154 A
2784(/*)S
2910(no)S
(floating)336 3036 A
(point)210 3414 A
(support)294 3666 A
4632(*/)S
8418 V
EP
%%Page: 28 28
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(28)S
11 R
2257(File:)S
2490(include/minix/config.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(02395)210 1122 A
(#define)294 1440 A
(FP_IEEE)294 1776 A
(_FP_IEEE)336 2154 A
2784(/*)S
(conform)294 2910 A
(IEEE)168 3246 A
(floating)336 3456 A
(point)210 3834 A
(standard)336 4086 A
4632(*/)S
1845 V
(02396)210 1122 A
1935 V
(02397)210 1122 A
1440(/*)S
(_MINIX_CHIP)462 1566 A
2070(is)S
(defined)294 2196 A
2532(in)S
(sys_config.h.)546 2658 A
3246(*/)S
2025 V
(02398)210 1122 A
(#define)294 1440 A
(CHIP)168 1776 A
(_MINIX_CHIP)462 2112 A
2115 V
(02399)210 1122 A
2205 V
(02400)210 1122 A
1440(/*)S
(_MINIX_FP_FORMAT)672 1566 A
2280(is)S
(defined)294 2406 A
2742(in)S
(sys_config.h.)546 2868 A
3456(*/)S
2295 V
(02401)210 1122 A
(#define)294 1440 A
(FP_FORMAT)378 1776 A
(_MINIX_FP_FORMAT)672 2448 A
2385 V
(02402)210 1122 A
2475 V
(02403)210 1122 A
1440(/*)S
(_ASKDEV)294 1566 A
(and)126 1902 A
(_FASTLOAD)378 2070 A
(are)126 2490 A
(defined)294 2658 A
2994(in)S
(sys_config.h.)546 3120 A
3708(*/)S
2565 V
(02404)210 1122 A
(#define)294 1440 A
(ASKDEV)252 1776 A
(_ASKDEV)294 2070 A
2655 V
(02405)210 1122 A
(#define)294 1440 A
(FASTLOAD)336 1776 A
(_FASTLOAD)378 2154 A
2745 V
(02406)210 1122 A
2835 V
(02407)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_CONFIG_H)378 1860 A
2280(*/)S
3195 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3285 V
(include/minix/sys_config.h)1092 2676 A
3375 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3555 V
(02500)210 1122 A
(#ifndef)294 1440 A
(_MINIX_SYS_CONFIG_H)798 1776 A
3645 V
(02501)210 1122 A
(#define)294 1440 A
(_MINIX_SYS_CONFIG_H)798 1776 A
2616(1)S
3735 V
(02502)210 1122 A
3825 V
(02503)210 1122 A
1440(/*)S
(This)168 1566 A
1776(is)S
1902(a)S
(modified)336 1986 A
(sys_config.h)504 2364 A
(for)126 2910 A
(compiling)378 3078 A
3498(a)S
(small)210 3582 A
(Minix)210 3834 A
(system)252 4086 A
3915 V
(02504)210 1122 A
1482(*)S
(with)168 1566 A
(only)168 1776 A
(the)126 1986 A
(options)294 2154 A
(described)378 2490 A
2910(in)S
(the)126 3036 A
(text,)210 3204 A
(Operating)378 3456 A
(Systems)294 3876 A
(Design)252 4212 A
(and)126 4506 A
4005 V
(02505)210 1122 A
1482(*)S
(Implementation,)630 1566 A
(3rd)126 2238 A
(edition.)336 2406 A
(See)126 2784 A
(the)126 2952 A
(sys_config.h)504 3120 A
3666(in)S
(the)126 3792 A
(full)168 3960 A
4095 V
(02506)210 1122 A
1482(*)S
(source)252 1566 A
(code)168 1860 A
(directory)378 2070 A
(for)126 2490 A
(information)462 2658 A
3162(on)S
(alternatives)504 3288 A
(omitted)294 3834 A
(here.)210 4170 A
4185 V
(02507)210 1122 A
1482(*/)S
4275 V
(02508)210 1122 A
4365 V
(02509)210 1122 A
(/*===========================================================================*)3276 1440 A
4455 V
(02510)210 1122 A
1482(*)S
(This)168 2112 A
(section)294 2322 A
(contains)336 2658 A
(user-settable)546 3036 A
(parameters)420 3624 A
4674(*)S
4545 V
(02511)210 1122 A
(*===========================================================================*/)3276 1482 A
4635 V
(02512)210 1122 A
(#define)294 1440 A
(_MINIX_MACHINE)588 1776 A
(_MACHINE_IBM_PC)630 2658 A
4725 V
(02513)210 1122 A
4815 V
(02514)210 1122 A
(#define)294 1440 A
(_MACHINE_IBM_PC)630 1776 A
2952(1)S
3120(/*)S
(any)126 3246 A
(8088)168 3456 A
3666(or)S
(80x86-based)462 3792 A
(system)252 4296 A
4590(*/)S
4905 V
(02515)210 1122 A
4995 V
(02516)210 1122 A
1440(/*)S
(Word)168 1566 A
(size)168 1776 A
1986(in)S
(bytes)210 2112 A
2364(\(a)S
(constant)336 2490 A
(equal)210 2868 A
3120(to)S
(sizeof\(int\)\).)546 3246 A
3834(*/)S
5085 V
(02517)210 1122 A
(#if)126 1440 A
(__ACK__)294 1608 A
1944(||)S
(__GNUC__)336 2070 A
5175 V
(02518)210 1122 A
(#define)294 1440 A
(_WORD_SIZE)420 1776 A
(_EM_WSIZE)378 2448 A
5265 V
(02519)210 1122 A
(#define)294 1440 A
(_PTR_SIZE)378 1776 A
(_EM_WSIZE)378 2448 A
5355 V
(02520)210 1122 A
(#endif)252 1440 A
5445 V
(02521)210 1122 A
5535 V
(02522)210 1122 A
(#define)294 1440 A
(_NR_PROCS)378 1776 A
2448(64)S
5625 V
(02523)210 1122 A
(#define)294 1440 A
(_NR_SYS_PROCS)546 1776 A
2448(32)S
5715 V
(02524)210 1122 A
5805 V
(02525)210 1122 A
1440(/*)S
(Set)126 1566 A
(the)126 1734 A
(CHIP)168 1902 A
(type)168 2112 A
(based)210 2322 A
2574(on)S
(the)126 2700 A
(machine)294 2868 A
(selected.)378 3204 A
(The)126 3624 A
(symbol)252 3792 A
(CHIP)168 4086 A
4296(is)S
(actually)336 4422 A
5895 V
(02526)210 1122 A
1482(*)S
(indicative)420 1566 A
2028(of)S
(more)168 2154 A
(than)168 2364 A
(just)168 2574 A
(the)126 2784 A
(CPU.)168 2952 A
(For)126 3204 A
(example,)336 3372 A
(machines)336 3750 A
(for)126 4128 A
(which)210 4296 A
5985 V
(02527)210 1122 A
1482(*)S
(CHIP)168 1566 A
1776(==)S
(INTEL)210 1902 A
(are)126 2154 A
(expected)336 2322 A
2700(to)S
(have)168 2826 A
(8259A)210 3036 A
(interrrupt)420 3288 A
(controllers)462 3750 A
(and)126 4254 A
(the)126 4422 A
6075 V
(02528)210 1122 A
1482(*)S
(other)210 1566 A
(properties)420 1818 A
2280(of)S
(IBM)126 2406 A
(PC/XT/AT/386)504 2574 A
(types)210 3120 A
(machines)336 3372 A
3750(in)S
(general.)336 3876 A
4254(*/)S
6165 V
(02529)210 1122 A
(#define)294 1440 A
(_CHIP_INTEL)462 1776 A
2448(1)S
2784(/*)S
(CHIP)168 2910 A
(type)168 3120 A
(for)126 3330 A
(PC,)126 3498 A
(XT,)126 3666 A
(AT,)126 3834 A
(386)126 4002 A
(and)126 4170 A
(clones)252 4338 A
4632(*/)S
6255 V
(02530)210 1122 A
6345 V
(02531)210 1122 A
1440(/*)S
(Set)126 1566 A
(the)126 1734 A
(FP_FORMAT)378 1902 A
(type)168 2322 A
(based)210 2532 A
2784(on)S
(the)126 2910 A
(machine)294 3078 A
(selected,)378 3414 A
(either)252 3834 A
4128(hw)S
4254(or)S
4380(sw)S
4632(*/)S
6435 V
(02532)210 1122 A
(#define)294 1440 A
(_FP_NONE)336 1776 A
2448(0)S
2784(/*)S
2910(no)S
(floating)336 3036 A
(point)210 3414 A
(support)294 3666 A
4632(*/)S
6525 V
(02533)210 1122 A
(#define)294 1440 A
(_FP_IEEE)336 1776 A
2448(1)S
2784(/*)S
(conform)294 2910 A
(IEEE)168 3246 A
(floating)336 3456 A
(point)210 3834 A
(standard)336 4086 A
4632(*/)S
6615 V
(02534)210 1122 A
6705 V
(02535)210 1122 A
(#define)294 1440 A
(_MINIX_CHIP)462 1776 A
(_CHIP_INTEL)462 2658 A
6795 V
(02536)210 1122 A
6885 V
(02537)210 1122 A
(#define)294 1440 A
(_MINIX_FP_FORMAT)672 1776 A
(_FP_NONE)336 2574 A
6975 V
(02538)210 1122 A
7065 V
(02539)210 1122 A
(#ifndef)294 1440 A
(_MINIX_MACHINE)588 1776 A
8418 V
EP
%%Page: 29 29
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2159(File:)S
2392(include/minix/sys_config.h)S
12 B
4560(29)S
1755 V
7 LST
(02540)210 1122 A
(error)210 1440 A
("In)126 1692 A
(<minix/sys_config.h>)840 1860 A
(please)252 2742 A
(define)252 3036 A
(_MINIX_MACHINE")630 3330 A
1845 V
(02541)210 1122 A
(#endif)252 1440 A
1935 V
(02542)210 1122 A
2025 V
(02543)210 1122 A
(#ifndef)294 1440 A
(_MINIX_CHIP)462 1776 A
2115 V
(02544)210 1122 A
(error)210 1440 A
("In)126 1692 A
(<minix/sys_config.h>)840 1860 A
(please)252 2742 A
(define)252 3036 A
(_MINIX_MACHINE)588 3330 A
3960(to)S
(have)168 4086 A
4296(a)S
(legal)210 4380 A
(value")252 4632 A
2205 V
(02545)210 1122 A
(#endif)252 1440 A
2295 V
(02546)210 1122 A
2385 V
(02547)210 1122 A
(#if)126 1440 A
(\(_MINIX_MACHINE)630 1608 A
2280(==)S
2406(0\))S
2475 V
(02548)210 1122 A
(error)210 1440 A
("_MINIX_MACHINE)630 1692 A
(has)126 2364 A
(incorrect)378 2532 A
(value)210 2952 A
(\(0\)")168 3204 A
2565 V
(02549)210 1122 A
(#endif)252 1440 A
2655 V
(02550)210 1122 A
2745 V
(02551)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_MINIX_SYS_CONFIG_H)798 1860 A
2700(*/)S
2835 V
(02552)210 1122 A
2925 V
(02553)210 1122 A
3195 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3285 V
(include/minix/const.h)882 2676 A
3375 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3555 V
(02600)210 1122 A
1440(/*)S
(Copyright)378 1566 A
(\(C\))126 1986 A
(2001)168 2154 A
2364(by)S
(Prentice-Hall,)588 2490 A
(Inc.)168 3120 A
(See)126 3372 A
(the)126 3540 A
(copyright)378 3708 A
(notice)252 4128 A
4422(in)S
3645 V
(02601)210 1122 A
1482(*)S
(the)126 1566 A
(file)168 1734 A
(/usr/src/LICENSE.)714 1944 A
3735 V
(02602)210 1122 A
1482(*/)S
3825 V
(02603)210 1122 A
3915 V
(02604)210 1122 A
(#ifndef)294 1440 A
(CHIP)168 1776 A
4005 V
(02605)210 1122 A
(#error)252 1440 A
(CHIP)168 1734 A
1944(is)S
(not)126 2070 A
(defined)294 2238 A
4095 V
(02606)210 1122 A
(#endif)252 1440 A
4185 V
(02607)210 1122 A
4275 V
(02608)210 1122 A
(#define)294 1440 A
(EXTERN)252 1776 A
(extern)252 2364 A
2784(/*)S
(used)168 2910 A
3120(in)S
(*.h)126 3246 A
(files)210 3414 A
3666(*/)S
4365 V
(02609)210 1122 A
(#define)294 1440 A
(PRIVATE)294 1776 A
(static)252 2364 A
2784(/*)S
(PRIVATE)294 2910 A
3246(x)S
(limits)252 3330 A
(the)126 3624 A
(scope)210 3792 A
4044(of)S
4170(x)S
4254(*/)S
4455 V
(02610)210 1122 A
(#define)294 1440 A
(PUBLIC)252 1776 A
2784(/*)S
(PUBLIC)252 2910 A
3204(is)S
(the)126 3330 A
(opposite)336 3498 A
3876(of)S
(PRIVATE)294 4002 A
4338(*/)S
4545 V
(02611)210 1122 A
(#define)294 1440 A
(FORWARD)294 1776 A
(static)252 2364 A
2784(/*)S
(some)168 2910 A
(compilers)378 3120 A
(require)294 3540 A
(this)168 3876 A
4086(to)S
4212(be)S
('static'*/)420 4338 A
4635 V
(02612)210 1122 A
4725 V
(02613)210 1122 A
(#define)294 1440 A
(TRUE)168 1776 A
2574(1)S
2784(/*)S
(used)168 2910 A
(for)126 3120 A
(turning)294 3288 A
(integers)336 3624 A
(into)168 4002 A
(Booleans)336 4212 A
4590(*/)S
4815 V
(02614)210 1122 A
(#define)294 1440 A
(FALSE)210 1776 A
2574(0)S
2784(/*)S
(used)168 2910 A
(for)126 3120 A
(turning)294 3288 A
(integers)336 3624 A
(into)168 4002 A
(Booleans)336 4212 A
4590(*/)S
4905 V
(02615)210 1122 A
4995 V
(02616)210 1122 A
(#define)294 1440 A
1776(HZ)S
2532(60)S
2784(/*)S
(clock)210 2910 A
(freq)168 3162 A
(\(software)378 3372 A
(settable)336 3792 A
4170(on)S
(IBM-PC\))294 4296 A
4632(*/)S
5085 V
(02617)210 1122 A
5175 V
(02618)210 1122 A
(#define)294 1440 A
(SUPER_USER)420 1776 A
(\(uid_t\))294 2238 A
2574(0)S
2784(/*)S
(uid_t)210 2910 A
3162(of)S
(superuser)378 3288 A
3708(*/)S
5265 V
(02619)210 1122 A
5355 V
(02620)210 1122 A
1440(/*)S
(Devices.)336 1566 A
1944(*/)S
5445 V
(02621)210 1122 A
(#define)294 1440 A
(MAJOR)210 1776 A
2574(8)S
2784(/*)S
(major)210 2910 A
(device)252 3162 A
3456(=)S
(\(dev>>MAJOR\))504 3540 A
4086(&)S
(0377)168 4170 A
4380(*/)S
5535 V
(02622)210 1122 A
(#define)294 1440 A
(MINOR)210 1776 A
2574(0)S
2784(/*)S
(minor)210 2910 A
(device)252 3162 A
3456(=)S
(\(dev>>MINOR\))504 3540 A
4086(&)S
(0377)168 4170 A
4380(*/)S
5625 V
(02623)210 1122 A
5715 V
(02624)210 1122 A
(#define)294 1440 A
(NULL)168 1776 A
(\(\(void)252 2154 A
(*\)0\))168 2448 A
2784(/*)S
(null)168 2910 A
(pointer)294 3120 A
3456(*/)S
5805 V
(02625)210 1122 A
(#define)294 1440 A
(CPVEC_NR)336 1776 A
2532(16)S
2784(/*)S
(max)126 2910 A
3078(#)S
3162(of)S
(entries)294 3288 A
3624(in)S
3750(a)S
(SYS_VCOPY)378 3834 A
(request)294 4254 A
4590(*/)S
5895 V
(02626)210 1122 A
(#define)294 1440 A
(CPVVEC_NR)378 1776 A
2532(64)S
2784(/*)S
(max)126 2910 A
3078(#)S
3162(of)S
(entries)294 3288 A
3624(in)S
3750(a)S
(SYS_VCOPY)378 3834 A
(request)294 4254 A
4590(*/)S
5985 V
(02627)210 1122 A
(#define)294 1440 A
(NR_IOREQS)378 1776 A
(MIN\(NR_BUFS,)504 2448 A
(64\))126 2994 A
6075 V
(02628)210 1122 A
2784(/*)S
(maximum)294 2910 A
(number)252 3246 A
3540(of)S
(entries)294 3666 A
4002(in)S
4128(an)S
(iorequest)378 4254 A
4674(*/)S
6165 V
(02629)210 1122 A
6255 V
(02630)210 1122 A
1440(/*)S
(Message)294 1566 A
(passing)294 1902 A
(constants.)420 2238 A
2700(*/)S
6345 V
(02631)210 1122 A
(#define)294 1440 A
(MESS_SIZE)378 1776 A
(\(sizeof\(message\)\))714 2196 A
3120(/*)S
(might)210 3246 A
(need)168 3498 A
(usizeof)294 3708 A
(from)168 4044 A
4254(FS)S
(here)168 4380 A
4590(*/)S
6435 V
(02632)210 1122 A
(#define)294 1440 A
(NIL_MESS)336 1776 A
(\(\(message)378 2154 A
2574(*\))S
2700(0\))S
3120(/*)S
(null)168 3246 A
(pointer)294 3456 A
3792(*/)S
6525 V
(02633)210 1122 A
6615 V
(02634)210 1122 A
1440(/*)S
(Memory)252 1566 A
(related)294 1860 A
(constants.)420 2196 A
2658(*/)S
6705 V
(02635)210 1122 A
(#define)294 1440 A
(SEGMENT_TYPE)504 1776 A
(0xFF00)252 2364 A
2784(/*)S
(bit)126 2910 A
(mask)168 3078 A
3288(to)S
(get)126 3414 A
(segment)294 3582 A
(type)168 3918 A
4128(*/)S
6795 V
(02636)210 1122 A
(#define)294 1440 A
(SEGMENT_INDEX)546 1776 A
(0x00FF)252 2364 A
2784(/*)S
(bit)126 2910 A
(mask)168 3078 A
3288(to)S
(get)126 3414 A
(segment)294 3582 A
(index)210 3918 A
4170(*/)S
6885 V
(02637)210 1122 A
6975 V
(02638)210 1122 A
(#define)294 1440 A
(LOCAL_SEG)378 1776 A
(0x0000)252 2364 A
2784(/*)S
(flags)210 2910 A
(indicating)420 3162 A
(local)210 3624 A
(memory)252 3876 A
(segment)294 4170 A
4506(*/)S
7065 V
(02639)210 1122 A
(#define)294 1440 A
(NR_LOCAL_SEGS)546 1776 A
2574(3)S
2784(/*)S
2910(#)S
(local)210 2994 A
(segments)336 3246 A
(per)126 3624 A
(process)294 3792 A
(\(fixed\))294 4128 A
4464(*/)S
8418 V
EP
%%Page: 30 30
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(30)S
11 R
2281(File:)S
2514(include/minix/const.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(02640)210 1122 A
(#define)294 1440 A
1776(T)S
2574(0)S
2784(/*)S
(proc[i].mem_map[T])756 2910 A
3708(is)S
(for)126 3834 A
(text)168 4002 A
4212(*/)S
1845 V
(02641)210 1122 A
(#define)294 1440 A
1776(D)S
2574(1)S
2784(/*)S
(proc[i].mem_map[D])756 2910 A
3708(is)S
(for)126 3834 A
(data)168 4002 A
4212(*/)S
1935 V
(02642)210 1122 A
(#define)294 1440 A
1776(S)S
2574(2)S
2784(/*)S
(proc[i].mem_map[S])756 2910 A
3708(is)S
(for)126 3834 A
(stack)210 4002 A
4254(*/)S
2025 V
(02643)210 1122 A
2115 V
(02644)210 1122 A
(#define)294 1440 A
(REMOTE_SEG)420 1776 A
(0x0100)252 2364 A
2784(/*)S
(flags)210 2910 A
(indicating)420 3162 A
(remote)252 3624 A
(memory)252 3918 A
(segment)294 4212 A
4548(*/)S
2205 V
(02645)210 1122 A
(#define)294 1440 A
(NR_REMOTE_SEGS)588 1776 A
2574(3)S
2784(/*)S
2910(#)S
(remote)252 2994 A
(memory)252 3288 A
(regions)294 3582 A
(\(variable\))420 3918 A
4380(*/)S
2295 V
(02646)210 1122 A
2385 V
(02647)210 1122 A
(#define)294 1440 A
(BIOS_SEG)336 1776 A
(0x0200)252 2364 A
2784(/*)S
(flags)210 2910 A
(indicating)420 3162 A
(BIOS)168 3624 A
(memory)252 3834 A
(segment)294 4128 A
4464(*/)S
2475 V
(02648)210 1122 A
(#define)294 1440 A
(NR_BIOS_SEGS)504 1776 A
2574(3)S
2784(/*)S
2910(#)S
(BIOS)168 2994 A
(memory)252 3204 A
(regions)294 3498 A
(\(variable\))420 3834 A
4296(*/)S
2565 V
(02649)210 1122 A
2655 V
(02650)210 1122 A
(#define)294 1440 A
(PHYS_SEG)336 1776 A
(0x0400)252 2364 A
2784(/*)S
(flag)168 2910 A
(indicating)420 3120 A
(entire)252 3582 A
(physical)336 3876 A
(memory)252 4254 A
4548(*/)S
2745 V
(02651)210 1122 A
2835 V
(02652)210 1122 A
1440(/*)S
(Labels)252 1566 A
(used)168 1860 A
2070(to)S
(disable)294 2196 A
(code)168 2532 A
(sections)336 2742 A
(for)126 3120 A
(different)378 3288 A
(reasons.)336 3708 A
4086(*/)S
2925 V
(02653)210 1122 A
(#define)294 1440 A
(DEAD_CODE)378 1776 A
2574(0)S
2784(/*)S
(unused)252 2910 A
(code)168 3204 A
3414(in)S
(normal)252 3540 A
(configuration)546 3834 A
4422(*/)S
3015 V
(02654)210 1122 A
(#define)294 1440 A
(FUTURE_CODE)462 1776 A
2574(0)S
2784(/*)S
(new)126 2910 A
(code)168 3078 A
3288(to)S
3414(be)S
(activated)378 3540 A
3960(+)S
(tested)252 4044 A
(later)210 4338 A
4590(*/)S
3105 V
(02655)210 1122 A
(#define)294 1440 A
(TEMP_CODE)378 1776 A
2574(1)S
2784(/*)S
(active)252 2910 A
(code)168 3204 A
3414(to)S
3540(be)S
(removed)294 3666 A
(later)210 4002 A
4254(*/)S
3195 V
(02656)210 1122 A
3285 V
(02657)210 1122 A
1440(/*)S
(Process)294 1566 A
(name)168 1902 A
(length)252 2112 A
2406(in)S
(the)126 2532 A
2700(PM)S
(process)294 2826 A
(table,)252 3162 A
(including)378 3456 A
('\\0'.)210 3876 A
4128(*/)S
3375 V
(02658)210 1122 A
(#define)294 1440 A
(PROC_NAME_LEN)546 1776 A
2448(16)S
3465 V
(02659)210 1122 A
3555 V
(02660)210 1122 A
1440(/*)S
(Miscellaneous)546 1566 A
2154(*/)S
3645 V
(02661)210 1122 A
(#define)294 1440 A
(BYTE)168 1776 A
(0377)168 2448 A
2784(/*)S
(mask)168 2910 A
(for)126 3120 A
3288(8)S
(bits)168 3372 A
3582(*/)S
3735 V
(02662)210 1122 A
(#define)294 1440 A
(READING)294 1776 A
2574(0)S
2784(/*)S
(copy)168 2910 A
(data)168 3120 A
3330(to)S
(user)168 3456 A
3666(*/)S
3825 V
(02663)210 1122 A
(#define)294 1440 A
(WRITING)294 1776 A
2574(1)S
2784(/*)S
(copy)168 2910 A
(data)168 3120 A
(from)168 3330 A
(user)168 3540 A
3750(*/)S
3915 V
(02664)210 1122 A
(#define)294 1440 A
(NO_NUM)252 1776 A
(0x8000)252 2364 A
2784(/*)S
(used)168 2910 A
3120(as)S
(numerical)378 3246 A
(argument)336 3666 A
4044(to)S
(panic\(\))294 4170 A
4506(*/)S
4005 V
(02665)210 1122 A
(#define)294 1440 A
(NIL_PTR)294 1776 A
(\(char)210 2196 A
2448(*\))S
2574(0)S
2784(/*)S
(generally)378 2910 A
(useful)252 3330 A
(expression)420 3624 A
4086(*/)S
4095 V
(02666)210 1122 A
(#define)294 1440 A
(HAVE_SCATTERED_IO)714 1776 A
2574(1)S
2784(/*)S
(scattered)378 2910 A
(I/O)126 3330 A
3498(is)S
(now)126 3624 A
(standard)336 3792 A
4170(*/)S
4185 V
(02667)210 1122 A
4275 V
(02668)210 1122 A
1440(/*)S
(Macros.)294 1566 A
1902(*/)S
4365 V
(02669)210 1122 A
(#define)294 1440 A
(MAX\(a,)252 1776 A
2070(b\))S
(\(\(a\))168 2280 A
2490(>)S
(\(b\))126 2574 A
2742(?)S
(\(a\))126 2826 A
2994(:)S
(\(b\)\))168 3078 A
4455 V
(02670)210 1122 A
(#define)294 1440 A
(MIN\(a,)252 1776 A
2070(b\))S
(\(\(a\))168 2280 A
2490(<)S
(\(b\))126 2574 A
2742(?)S
(\(a\))126 2826 A
2994(:)S
(\(b\)\))168 3078 A
4545 V
(02671)210 1122 A
4635 V
(02672)210 1122 A
1440(/*)S
(Memory)252 1566 A
1860(is)S
(allocated)378 1986 A
2406(in)S
(clicks.)294 2532 A
2868(*/)S
4725 V
(02673)210 1122 A
(#if)126 1440 A
(\(CHIP)210 1608 A
1860(==)S
(INTEL\))252 1986 A
4815 V
(02674)210 1122 A
(#define)294 1440 A
(CLICK_SIZE)420 1776 A
(1024)168 2448 A
2784(/*)S
(unit)168 2910 A
3120(in)S
(which)210 3246 A
(memory)252 3498 A
3792(is)S
(allocated)378 3918 A
4338(*/)S
4905 V
(02675)210 1122 A
(#define)294 1440 A
(CLICK_SHIFT)462 1776 A
2532(10)S
2784(/*)S
(log2)168 2910 A
3120(of)S
(CLICK_SIZE)420 3246 A
3708(*/)S
4995 V
(02676)210 1122 A
(#endif)252 1440 A
5085 V
(02677)210 1122 A
5175 V
(02678)210 1122 A
(#if)126 1440 A
(\(CHIP)210 1608 A
1860(==)S
(SPARC\))252 1986 A
2280(||)S
(\(CHIP)210 2406 A
2658(==)S
(M68000\))294 2784 A
5265 V
(02679)210 1122 A
(#define)294 1440 A
(CLICK_SIZE)420 1776 A
(4096)168 2448 A
2784(/*)S
(unit)168 2910 A
3120(in)S
(which)210 3246 A
(memory)252 3498 A
3792(is)S
(allocated)378 3918 A
4338(*/)S
5355 V
(02680)210 1122 A
(#define)294 1440 A
(CLICK_SHIFT)462 1776 A
2532(12)S
2784(/*)S
(log2)168 2910 A
3120(of)S
(CLICK_SIZE)420 3246 A
3708(*/)S
5445 V
(02681)210 1122 A
(#endif)252 1440 A
5535 V
(02682)210 1122 A
5625 V
(02683)210 1122 A
1440(/*)S
(Click)210 1566 A
1818(to)S
(byte)168 1944 A
(conversions)462 2154 A
(\(and)168 2658 A
(vice)168 2868 A
(versa\).)294 3078 A
3414(*/)S
5715 V
(02684)210 1122 A
(#define)294 1440 A
(HCLICK_SHIFT)504 1776 A
2574(4)S
2784(/*)S
(log2)168 2910 A
3120(of)S
(HCLICK_SIZE)462 3246 A
3750(*/)S
5805 V
(02685)210 1122 A
(#define)294 1440 A
(HCLICK_SIZE)462 1776 A
2532(16)S
2784(/*)S
(hardware)336 2910 A
(segment)294 3288 A
(conversion)420 3624 A
(magic)210 4086 A
4338(*/)S
5895 V
(02686)210 1122 A
(#if)126 1440 A
(CLICK_SIZE)420 1608 A
2070(>=)S
(HCLICK_SIZE)462 2196 A
5985 V
(02687)210 1122 A
(#define)294 1440 A
(click_to_hclick\(n\))756 1776 A
(\(\(n\))168 2574 A
2784(<<)S
(\(CLICK_SHIFT)504 2910 A
3456(-)S
(HCLICK_SHIFT\)\))588 3540 A
6075 V
(02688)210 1122 A
(#else)210 1440 A
6165 V
(02689)210 1122 A
(#define)294 1440 A
(click_to_hclick\(n\))756 1776 A
(\(\(n\))168 2574 A
2784(>>)S
(\(HCLICK_SHIFT)546 2910 A
3498(-)S
(CLICK_SHIFT\)\))546 3582 A
6255 V
(02690)210 1122 A
(#endif)252 1440 A
6345 V
(02691)210 1122 A
(#define)294 1440 A
(hclick_to_physb\(n\))756 1776 A
(\(\(phys_bytes\))546 2574 A
(\(n\))126 3162 A
3330(<<)S
(HCLICK_SHIFT\))546 3456 A
6435 V
(02692)210 1122 A
(#define)294 1440 A
(physb_to_hclick\(n\))756 1776 A
(\(\(n\))168 2574 A
2784(>>)S
(HCLICK_SHIFT\))546 2910 A
6525 V
(02693)210 1122 A
6615 V
(02694)210 1122 A
(#define)294 1440 A
(ABS)126 1776 A
(-999)168 2448 A
2784(/*)S
(this)168 2910 A
(process)294 3120 A
(means)210 3456 A
(absolute)336 3708 A
(memory)252 4086 A
4380(*/)S
6705 V
(02695)210 1122 A
6795 V
(02696)210 1122 A
1440(/*)S
(Flag)168 1566 A
(bits)168 1776 A
(for)126 1986 A
(i_mode)252 2154 A
2448(in)S
(the)126 2574 A
(inode.)252 2742 A
3036(*/)S
6885 V
(02697)210 1122 A
(#define)294 1440 A
(I_TYPE)252 1776 A
(0170000)294 2448 A
2784(/*)S
(this)168 2910 A
(field)210 3120 A
(gives)210 3372 A
(inode)210 3624 A
(type)168 3876 A
4086(*/)S
6975 V
(02698)210 1122 A
(#define)294 1440 A
(I_REGULAR)378 1776 A
(0100000)294 2448 A
2784(/*)S
(regular)294 2910 A
(file,)210 3246 A
(not)126 3498 A
(dir)126 3666 A
3834(or)S
(special)294 3960 A
4296(*/)S
7065 V
(02699)210 1122 A
(#define)294 1440 A
(I_BLOCK_SPECIAL)630 1776 A
(0060000)294 2448 A
2784(/*)S
(block)210 2910 A
(special)294 3162 A
(file)168 3498 A
3708(*/)S
8418 V
EP
%%Page: 31 31
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2281(File:)S
2514(include/minix/const.h)S
12 B
4560(31)S
1755 V
7 LST
(02700)210 1122 A
(#define)294 1440 A
(I_DIRECTORY)462 1776 A
(0040000)294 2448 A
2784(/*)S
(file)168 2910 A
3120(is)S
3246(a)S
(directory)378 3330 A
3750(*/)S
1845 V
(02701)210 1122 A
(#define)294 1440 A
(I_CHAR_SPECIAL)588 1776 A
(0020000)294 2448 A
2784(/*)S
(character)378 2910 A
(special)294 3330 A
(file)168 3666 A
3876(*/)S
1935 V
(02702)210 1122 A
(#define)294 1440 A
(I_NAMED_PIPE)504 1776 A
(0010000)294 2448 A
2784(/*)S
(named)210 2910 A
(pipe)168 3162 A
(\(FIFO\))252 3372 A
3666(*/)S
2025 V
(02703)210 1122 A
(#define)294 1440 A
(I_SET_UID_BIT)546 1776 A
(0004000)294 2448 A
2784(/*)S
(set)126 2910 A
(effective)378 3078 A
(uid_t)210 3498 A
3750(on)S
(exec)168 3876 A
4086(*/)S
2115 V
(02704)210 1122 A
(#define)294 1440 A
(I_SET_GID_BIT)546 1776 A
(0002000)294 2448 A
2784(/*)S
(set)126 2910 A
(effective)378 3078 A
(gid_t)210 3498 A
3750(on)S
(exec)168 3876 A
4086(*/)S
2205 V
(02705)210 1122 A
(#define)294 1440 A
(ALL_MODES)378 1776 A
(0006777)294 2448 A
2784(/*)S
(all)126 2910 A
(bits)168 3078 A
(for)126 3288 A
(user,)210 3456 A
(group)210 3708 A
(and)126 3960 A
(others)252 4128 A
4422(*/)S
2295 V
(02706)210 1122 A
(#define)294 1440 A
(RWX_MODES)378 1776 A
(0000777)294 2448 A
2784(/*)S
(mode)168 2910 A
(bits)168 3120 A
(for)126 3330 A
(RWX)126 3498 A
(only)168 3666 A
3876(*/)S
2385 V
(02707)210 1122 A
(#define)294 1440 A
(R_BIT)210 1776 A
(0000004)294 2448 A
2784(/*)S
(Rwx)126 2910 A
(protection)420 3078 A
(bit)126 3540 A
3708(*/)S
2475 V
(02708)210 1122 A
(#define)294 1440 A
(W_BIT)210 1776 A
(0000002)294 2448 A
2784(/*)S
(rWx)126 2910 A
(protection)420 3078 A
(bit)126 3540 A
3708(*/)S
2565 V
(02709)210 1122 A
(#define)294 1440 A
(X_BIT)210 1776 A
(0000001)294 2448 A
2784(/*)S
(rwX)126 2910 A
(protection)420 3078 A
(bit)126 3540 A
3708(*/)S
2655 V
(02710)210 1122 A
(#define)294 1440 A
(I_NOT_ALLOC)462 1776 A
(0000000)294 2448 A
2784(/*)S
(this)168 2910 A
(inode)210 3120 A
3372(is)S
(free)168 3498 A
3708(*/)S
2745 V
(02711)210 1122 A
2835 V
(02712)210 1122 A
1440(/*)S
(Flag)168 1566 A
(used)168 1776 A
(only)168 1986 A
2196(in)S
(flags)210 2322 A
(argument)336 2574 A
2952(of)S
(dev_open.)378 3078 A
3498(*/)S
2925 V
(02713)210 1122 A
(#define)294 1440 A
(RO_BIT)252 1776 A
(0200000)294 2448 A
2784(/*)S
(Open)168 2910 A
(device)252 3120 A
(readonly;)378 3414 A
(fail)168 3834 A
4044(if)S
(writable.)378 4170 A
4590(*/)S
3015 V
(02714)210 1122 A
3105 V
(02715)210 1122 A
1440(/*)S
(Some)168 1566 A
(limits.)294 1776 A
2112(*/)S
3195 V
(02716)210 1122 A
(#define)294 1440 A
(MAX_BLOCK_NR)504 1776 A
(\(\(block_t\))420 2364 A
(077777777\))420 2826 A
3456(/*)S
(largest)294 3582 A
(block)210 3918 A
(number)252 4170 A
4464(*/)S
3285 V
(02717)210 1122 A
(#define)294 1440 A
(HIGHEST_ZONE)504 1776 A
(\(\(zone_t\))378 2406 A
(077777777\))420 2826 A
3456(/*)S
(largest)294 3582 A
(zone)168 3918 A
(number)252 4128 A
4422(*/)S
3375 V
(02718)210 1122 A
(#define)294 1440 A
(MAX_INODE_NR)504 1776 A
(\(\(ino_t\))336 2322 A
(037777777777\))546 2700 A
3456(/*)S
(largest)294 3582 A
(inode)210 3918 A
(number)252 4170 A
4464(*/)S
3465 V
(02719)210 1122 A
(#define)294 1440 A
(MAX_FILE_POS)504 1776 A
(\(\(off_t\))336 2322 A
(037777777777\))546 2700 A
3456(/*)S
(largest)294 3582 A
(legal)210 3918 A
(file)168 4170 A
(offset)252 4380 A
4674(*/)S
3555 V
(02720)210 1122 A
3645 V
(02721)210 1122 A
(#define)294 1440 A
(NO_BLOCK)336 1776 A
(\(\(block_t\))420 2700 A
3162(0\))S
3456(/*)S
(absence)294 3582 A
3918(of)S
4044(a)S
(block)210 4128 A
(number)252 4380 A
4674(*/)S
3735 V
(02722)210 1122 A
(#define)294 1440 A
(NO_ENTRY)336 1776 A
(\(\(ino_t\))336 2784 A
3162(0\))S
3456(/*)S
(absence)294 3582 A
3918(of)S
4044(a)S
(dir)126 4128 A
(entry)210 4296 A
4548(*/)S
3825 V
(02723)210 1122 A
(#define)294 1440 A
(NO_ZONE)294 1776 A
(\(\(zone_t\))378 2742 A
3162(0\))S
3456(/*)S
(absence)294 3582 A
3918(of)S
4044(a)S
(zone)168 4128 A
(number)252 4338 A
4632(*/)S
3915 V
(02724)210 1122 A
(#define)294 1440 A
(NO_DEV)252 1776 A
(\(\(dev_t\))336 2784 A
3162(0\))S
3456(/*)S
(absence)294 3582 A
3918(of)S
4044(a)S
(device)252 4128 A
(numb)168 4422 A
4632(*/)S
4095 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4185 V
(include/minix/type.h)840 2676 A
4275 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4455 V
(02800)210 1122 A
(#ifndef)294 1440 A
(_TYPE_H)294 1776 A
4545 V
(02801)210 1122 A
(#define)294 1440 A
(_TYPE_H)294 1776 A
4635 V
(02802)210 1122 A
4725 V
(02803)210 1122 A
(#ifndef)294 1440 A
(_MINIX_SYS_CONFIG_H)798 1776 A
4815 V
(02804)210 1122 A
(#include)336 1440 A
(<minix/sys_config.h>)840 1818 A
4905 V
(02805)210 1122 A
(#endif)252 1440 A
4995 V
(02806)210 1122 A
5085 V
(02807)210 1122 A
(#ifndef)294 1440 A
(_TYPES_H)336 1776 A
5175 V
(02808)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
5265 V
(02809)210 1122 A
(#endif)252 1440 A
5355 V
(02810)210 1122 A
5445 V
(02811)210 1122 A
1440(/*)S
(Type)168 1566 A
(definitions.)504 1776 A
2322(*/)S
5535 V
(02812)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(int)126 2154 A
(vir_clicks;)462 2322 A
3120(/*)S
(virtual)294 3288 A
(addr/length)462 3624 A
4128(in)S
(clicks)252 4254 A
4548(*/)S
5625 V
(02813)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(phys_bytes;)462 2364 A
3120(/*)S
(physical)336 3246 A
(addr/length)462 3624 A
4128(in)S
(bytes)210 4254 A
4506(*/)S
5715 V
(02814)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(int)126 2154 A
(phys_clicks;)504 2322 A
3120(/*)S
(physical)336 3246 A
(addr/length)462 3624 A
4128(in)S
(clicks)252 4254 A
4548(*/)S
5805 V
(02815)210 1122 A
5895 V
(02816)210 1122 A
(#if)126 1440 A
(\(_MINIX_CHIP)504 1608 A
2154(==)S
(_CHIP_INTEL\))504 2280 A
5985 V
(02817)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(int)126 2154 A
(vir_bytes;)420 2322 A
2784(/*)S
(virtual)294 2910 A
(addresses)378 3246 A
(and)126 3666 A
(lengths)294 3834 A
4170(in)S
(bytes)210 4296 A
4548(*/)S
6075 V
(02818)210 1122 A
(#endif)252 1440 A
6165 V
(02819)210 1122 A
6255 V
(02820)210 1122 A
(#if)126 1440 A
(\(_MINIX_CHIP)504 1608 A
2154(==)S
(_CHIP_M68000\))546 2280 A
6345 V
(02821)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(vir_bytes;/*)504 2364 A
(virtual)294 2910 A
(addresses)378 3246 A
(and)126 3666 A
(lengths)294 3834 A
4170(in)S
(bytes)210 4296 A
4548(*/)S
6435 V
(02822)210 1122 A
(#endif)252 1440 A
6525 V
(02823)210 1122 A
6615 V
(02824)210 1122 A
(#if)126 1440 A
(\(_MINIX_CHIP)504 1608 A
2154(==)S
(_CHIP_SPARC\))504 2280 A
6705 V
(02825)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(vir_bytes;/*)504 2364 A
(virtual)294 2910 A
(addresses)378 3246 A
(and)126 3666 A
(lengths)294 3834 A
4170(in)S
(bytes)210 4296 A
4548(*/)S
6795 V
(02826)210 1122 A
(#endif)252 1440 A
6885 V
(02827)210 1122 A
6975 V
(02828)210 1122 A
1440(/*)S
(Memory)252 1566 A
(map)126 1860 A
(for)126 2028 A
(local)210 2196 A
(text,)210 2448 A
(stack,)252 2700 A
(data)168 2994 A
(segments.)378 3204 A
3624(*/)S
7065 V
(02829)210 1122 A
(struct)252 1440 A
(mem_map)294 1734 A
2070({)S
8418 V
EP
%%Page: 32 32
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(32)S
11 R
2303(File:)S
2536(include/minix/type.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(02830)210 1122 A
(vir_clicks)420 1524 A
(mem_vir;)336 1986 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
3582(*/)S
1845 V
(02831)210 1122 A
(phys_clicks)462 1524 A
(mem_phys;)378 2028 A
2784(/*)S
(physical)336 2910 A
(address)294 3288 A
3624(*/)S
1935 V
(02832)210 1122 A
(vir_clicks)420 1524 A
(mem_len;)336 1986 A
2784(/*)S
(length)252 2910 A
3204(*/)S
2025 V
(02833)210 1122 A
1440(};)S
2115 V
(02834)210 1122 A
2205 V
(02835)210 1122 A
1440(/*)S
(Memory)252 1566 A
(map)126 1860 A
(for)126 2028 A
(remote)252 2196 A
(memory)252 2490 A
(areas,)252 2784 A
(e.g.,)210 3078 A
(for)126 3330 A
(the)126 3498 A
(RAM)126 3666 A
(disk.)210 3834 A
4086(*/)S
2295 V
(02836)210 1122 A
(struct)252 1440 A
(far_mem)294 1734 A
2070({)S
2385 V
(02837)210 1122 A
(int)126 1524 A
(in_use;)294 1692 A
2784(/*)S
(entry)210 2910 A
3162(in)S
(use,)168 3288 A
(unless)252 3498 A
(zero)168 3792 A
4002(*/)S
2475 V
(02838)210 1122 A
(phys_clicks)462 1524 A
(mem_phys;)378 2028 A
2784(/*)S
(physical)336 2910 A
(address)294 3288 A
3624(*/)S
2565 V
(02839)210 1122 A
(vir_clicks)420 1524 A
(mem_len;)336 1986 A
2784(/*)S
(length)252 2910 A
3204(*/)S
2655 V
(02840)210 1122 A
1440(};)S
2745 V
(02841)210 1122 A
2835 V
(02842)210 1122 A
1440(/*)S
(Structure)378 1566 A
(for)126 1986 A
(virtual)294 2154 A
(copying)294 2490 A
2826(by)S
(means)210 2952 A
3204(of)S
3330(a)S
(vector)252 3414 A
(with)168 3708 A
(requests.)378 3918 A
4338(*/)S
2925 V
(02843)210 1122 A
(struct)252 1440 A
(vir_addr)336 1734 A
2112({)S
3015 V
(02844)210 1122 A
(int)126 1524 A
(proc_nr;)336 1692 A
3105 V
(02845)210 1122 A
(int)126 1524 A
(segment;)336 1692 A
3195 V
(02846)210 1122 A
(vir_bytes)378 1524 A
(offset;)294 1944 A
3285 V
(02847)210 1122 A
1440(};)S
3375 V
(02848)210 1122 A
3465 V
(02849)210 1122 A
(#define)294 1440 A
(phys_cp_req)462 1776 A
(vir_cp_req)420 2280 A
3555 V
(02850)210 1122 A
(struct)252 1440 A
(vir_cp_req)420 1734 A
2196({)S
3645 V
(02851)210 1122 A
(struct)252 1524 A
(vir_addr)336 1818 A
(src;)168 2196 A
3735 V
(02852)210 1122 A
(struct)252 1524 A
(vir_addr)336 1818 A
(dst;)168 2196 A
3825 V
(02853)210 1122 A
(phys_bytes)420 1524 A
(count;)252 1986 A
3915 V
(02854)210 1122 A
1440(};)S
4005 V
(02855)210 1122 A
4095 V
(02856)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
2070({)S
4185 V
(02857)210 1122 A
(vir_bytes)378 1524 A
(iov_addr;)378 1944 A
2784(/*)S
(address)294 2910 A
3246(of)S
3372(an)S
(I/O)126 3498 A
(buffer)252 3666 A
3960(*/)S
4275 V
(02858)210 1122 A
(vir_bytes)378 1524 A
(iov_size;)378 1944 A
2784(/*)S
(sizeof)252 2910 A
3204(an)S
(I/O)126 3330 A
(buffer)252 3498 A
3792(*/)S
4365 V
(02859)210 1122 A
1440(})S
(iovec_t;)336 1524 A
4455 V
(02860)210 1122 A
4545 V
(02861)210 1122 A
1440(/*)S
1566(PM)S
(passes)252 1692 A
(the)126 1986 A
(address)294 2154 A
2490(of)S
2616(a)S
(structure)378 2700 A
3120(of)S
(this)168 3246 A
(type)168 3456 A
3666(to)S
(KERNEL)252 3792 A
(when)168 4086 A
4635 V
(02862)210 1122 A
1482(*)S
(sys_sendsig\(\))546 1566 A
2154(is)S
(invoked)294 2280 A
2616(as)S
(part)168 2742 A
2952(of)S
(the)126 3078 A
(signal)252 3246 A
(catching)336 3540 A
(mechanism.)420 3918 A
4725 V
(02863)210 1122 A
1482(*)S
(The)126 1566 A
(structure)378 1734 A
(contain)294 2154 A
(all)126 2490 A
(the)126 2658 A
(information)462 2826 A
(that)168 3330 A
(KERNEL)252 3540 A
(needs)210 3834 A
4086(to)S
(build)210 4212 A
4815 V
(02864)210 1122 A
1482(*)S
(the)126 1566 A
(signal)252 1734 A
(stack.)252 2028 A
4905 V
(02865)210 1122 A
1482(*/)S
4995 V
(02866)210 1122 A
(struct)252 1440 A
(sigmsg)252 1734 A
2028({)S
5085 V
(02867)210 1122 A
(int)126 1524 A
(sm_signo;)378 1692 A
2784(/*)S
(signal)252 2910 A
(number)252 3204 A
(being)210 3498 A
(caught)252 3750 A
4044(*/)S
5175 V
(02868)210 1122 A
(unsigned)336 1524 A
(long)168 1902 A
(sm_mask;)336 2112 A
2784(/*)S
(mask)168 2910 A
3120(to)S
(restore)294 3246 A
(when)168 3582 A
(handler)294 3792 A
(returns)294 4128 A
4464(*/)S
5265 V
(02869)210 1122 A
(vir_bytes)378 1524 A
(sm_sighandler;)588 1944 A
2784(/*)S
(address)294 2910 A
3246(of)S
(handler)294 3372 A
3708(*/)S
5355 V
(02870)210 1122 A
(vir_bytes)378 1524 A
(sm_sigreturn;)546 1944 A
2784(/*)S
(address)294 2910 A
3246(of)S
(_sigreturn)420 3372 A
3834(in)S
3960(C)S
(library)294 4044 A
4380(*/)S
5445 V
(02871)210 1122 A
(vir_bytes)378 1524 A
(sm_stkptr;)420 1944 A
2784(/*)S
(user)168 2910 A
(stack)210 3120 A
(pointer)294 3372 A
3708(*/)S
5535 V
(02872)210 1122 A
1440(};)S
5625 V
(02873)210 1122 A
5715 V
(02874)210 1122 A
1440(/*)S
(This)168 1566 A
1776(is)S
(used)168 1902 A
2112(to)S
(obtain)252 2238 A
(system)252 2532 A
(information)462 2826 A
(through)294 3330 A
(SYS_GETINFO.)504 3666 A
4212(*/)S
5805 V
(02875)210 1122 A
(struct)252 1440 A
(kinfo)210 1734 A
1986({)S
5895 V
(02876)210 1122 A
(phys_bytes)420 1524 A
(code_base;)420 1986 A
2784(/*)S
(base)168 2910 A
3120(of)S
(kernel)252 3246 A
(code)168 3540 A
3750(*/)S
5985 V
(02877)210 1122 A
(phys_bytes)420 1524 A
(code_size;)420 1986 A
6075 V
(02878)210 1122 A
(phys_bytes)420 1524 A
(data_base;)420 1986 A
2784(/*)S
(base)168 2910 A
3120(of)S
(kernel)252 3246 A
(data)168 3540 A
3750(*/)S
6165 V
(02879)210 1122 A
(phys_bytes)420 1524 A
(data_size;)420 1986 A
6255 V
(02880)210 1122 A
(vir_bytes)378 1524 A
(proc_addr;)420 1944 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
3582(of)S
(process)294 3708 A
(table)210 4044 A
4296(*/)S
6345 V
(02881)210 1122 A
(phys_bytes)420 1524 A
(kmem_base;)420 1986 A
2784(/*)S
(kernel)252 2910 A
(memory)252 3204 A
(layout)252 3498 A
(\(/dev/kmem\))462 3792 A
4296(*/)S
6435 V
(02882)210 1122 A
(phys_bytes)420 1524 A
(kmem_size;)420 1986 A
6525 V
(02883)210 1122 A
(phys_bytes)420 1524 A
(bootdev_base;)546 1986 A
2784(/*)S
(boot)168 2910 A
(device)252 3120 A
(from)168 3414 A
(boot)168 3624 A
(image)210 3834 A
(\(/dev/boot\))462 4086 A
4590(*/)S
6615 V
(02884)210 1122 A
(phys_bytes)420 1524 A
(bootdev_size;)546 1986 A
6705 V
(02885)210 1122 A
(phys_bytes)420 1524 A
(bootdev_mem;)504 1986 A
6795 V
(02886)210 1122 A
(phys_bytes)420 1524 A
(params_base;)504 1986 A
2784(/*)S
(parameters)420 2910 A
(passed)252 3372 A
3666(by)S
(boot)168 3792 A
(monitor)294 4002 A
4338(*/)S
6885 V
(02887)210 1122 A
(phys_bytes)420 1524 A
(params_size;)504 1986 A
6975 V
(02888)210 1122 A
(int)126 1524 A
(nr_procs;)378 1692 A
2784(/*)S
(number)252 2910 A
3204(of)S
(user)168 3330 A
(processes)378 3540 A
3960(*/)S
7065 V
(02889)210 1122 A
(int)126 1524 A
(nr_tasks;)378 1692 A
2784(/*)S
(number)252 2910 A
3204(of)S
(kernel)252 3330 A
(tasks)210 3624 A
3876(*/)S
8418 V
EP
%%Page: 33 33
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2303(File:)S
2536(include/minix/type.h)S
12 B
4560(33)S
1755 V
7 LST
(02890)210 1122 A
(char)168 1524 A
(release[6];)462 1734 A
2784(/*)S
(kernel)252 2910 A
(release)294 3204 A
(number)252 3540 A
3834(*/)S
1845 V
(02891)210 1122 A
(char)168 1524 A
(version[6];)462 1734 A
2784(/*)S
(kernel)252 2910 A
(version)294 3204 A
(number)252 3540 A
3834(*/)S
1935 V
(02892)210 1122 A
(int)126 1524 A
(relocking;)420 1692 A
2784(/*)S
(relocking)378 2910 A
(check)210 3330 A
(\(for)168 3582 A
(debugging\))420 3792 A
4254(*/)S
2025 V
(02893)210 1122 A
1440(};)S
2115 V
(02894)210 1122 A
2205 V
(02895)210 1122 A
(struct)252 1440 A
(machine)294 1734 A
2070({)S
2295 V
(02896)210 1122 A
(int)126 1524 A
(pc_at;)252 1692 A
2385 V
(02897)210 1122 A
(int)126 1524 A
(ps_mca;)294 1692 A
2475 V
(02898)210 1122 A
(int)126 1524 A
(processor;)420 1692 A
2565 V
(02899)210 1122 A
(int)126 1524 A
(protected;)420 1692 A
2655 V
(02900)210 1122 A
(int)126 1524 A
(vdu_ega;)336 1692 A
2745 V
(02901)210 1122 A
(int)126 1524 A
(vdu_vga;)336 1692 A
2835 V
(02902)210 1122 A
1440(};)S
2925 V
(02903)210 1122 A
3015 V
(02904)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_TYPE_H)294 1860 A
2196(*/)S
3195 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3285 V
(include/minix/ipc.h)798 2676 A
3375 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3555 V
(03000)210 1122 A
(#ifndef)294 1440 A
(_IPC_H)252 1776 A
3645 V
(03001)210 1122 A
(#define)294 1440 A
(_IPC_H)252 1776 A
3735 V
(03002)210 1122 A
3825 V
(03003)210 1122 A
(/*==========================================================================*)3234 1440 A
3915 V
(03004)210 1122 A
1482(*)S
(Types)210 1566 A
(relating)336 1818 A
2196(to)S
(messages.)378 2322 A
4632(*)S
4005 V
(03005)210 1122 A
(*==========================================================================*/)3234 1482 A
4095 V
(03006)210 1122 A
4185 V
(03007)210 1122 A
(#define)294 1440 A
1776(M1)S
2574(1)S
4275 V
(03008)210 1122 A
(#define)294 1440 A
1776(M3)S
2574(3)S
4365 V
(03009)210 1122 A
(#define)294 1440 A
1776(M4)S
2574(4)S
4455 V
(03010)210 1122 A
(#define)294 1440 A
(M3_STRING)378 1776 A
2532(14)S
4545 V
(03011)210 1122 A
4635 V
(03012)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
({int)168 2070 A
(m1i1,)210 2280 A
(m1i2,)210 2532 A
(m1i3;)210 2784 A
(char)168 3036 A
(*m1p1,)252 3246 A
(*m1p2,)252 3540 A
(*m1p3;})294 3834 A
(mess_1;)294 4170 A
4725 V
(03013)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
({int)168 2070 A
(m2i1,)210 2280 A
(m2i2,)210 2532 A
(m2i3;)210 2784 A
(long)168 3036 A
(m2l1,)210 3246 A
(m2l2;)210 3498 A
(char)168 3750 A
(*m2p1;})294 3960 A
(mess_2;)294 4296 A
4815 V
(03014)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
({int)168 2070 A
(m3i1,)210 2280 A
(m3i2;)210 2532 A
(char)168 2784 A
(*m3p1;)252 2994 A
(char)168 3288 A
(m3ca1[M3_STRING];})756 3498 A
(mess_3;)294 4296 A
4905 V
(03015)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
({long)210 2070 A
(m4l1,)210 2322 A
(m4l2,)210 2574 A
(m4l3,)210 2826 A
(m4l4,)210 3078 A
(m4l5;})252 3330 A
(mess_4;)294 3624 A
4995 V
(03016)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
({short)252 2070 A
(m5c1,)210 2364 A
(m5c2;)210 2616 A
(int)126 2868 A
(m5i1,)210 3036 A
(m5i2;)210 3288 A
(long)168 3540 A
(m5l1,)210 3750 A
(m5l2,)210 4002 A
(m5l3;}mess_5;)546 4254 A
5085 V
(03017)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
({int)168 2070 A
(m7i1,)210 2280 A
(m7i2,)210 2532 A
(m7i3,)210 2784 A
(m7i4;)210 3036 A
(char)168 3288 A
(*m7p1,)252 3498 A
(*m7p2;})294 3792 A
(mess_7;)294 4128 A
5175 V
(03018)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
({int)168 2070 A
(m8i1,)210 2280 A
(m8i2;)210 2532 A
(char)168 2784 A
(*m8p1,)252 2994 A
(*m8p2,)252 3288 A
(*m8p3,)252 3582 A
(*m8p4;})294 3876 A
(mess_8;)294 4212 A
5265 V
(03019)210 1122 A
5355 V
(03020)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
2070({)S
5445 V
(03021)210 1122 A
(int)126 1524 A
(m_source;)378 1692 A
2784(/*)S
(who)126 2910 A
(sent)168 3078 A
(the)126 3288 A
(message)294 3456 A
3792(*/)S
5535 V
(03022)210 1122 A
(int)126 1524 A
(m_type;)294 1692 A
2784(/*)S
(what)168 2910 A
(kind)168 3120 A
3330(of)S
(message)294 3456 A
3792(is)S
3918(it)S
4044(*/)S
5625 V
(03023)210 1122 A
(union)210 1524 A
1776({)S
5715 V
(03024)210 1122 A
(mess_1)252 1776 A
(m_m1;)210 2070 A
5805 V
(03025)210 1122 A
(mess_2)252 1776 A
(m_m2;)210 2070 A
5895 V
(03026)210 1122 A
(mess_3)252 1776 A
(m_m3;)210 2070 A
5985 V
(03027)210 1122 A
(mess_4)252 1776 A
(m_m4;)210 2070 A
6075 V
(03028)210 1122 A
(mess_5)252 1776 A
(m_m5;)210 2070 A
6165 V
(03029)210 1122 A
(mess_7)252 1776 A
(m_m7;)210 2070 A
6255 V
(03030)210 1122 A
(mess_8)252 1776 A
(m_m8;)210 2070 A
6345 V
(03031)210 1122 A
1524(})S
(m_u;)168 1608 A
6435 V
(03032)210 1122 A
1440(})S
(message;)336 1524 A
6525 V
(03033)210 1122 A
6615 V
(03034)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(defines)294 2154 A
(provide)294 2490 A
(names)210 2826 A
(for)126 3078 A
(useful)252 3246 A
(members.)336 3540 A
3918(*/)S
6705 V
(03035)210 1122 A
(#define)294 1440 A
(m1_i1)210 1776 A
(m_u.m_m1.m1i1)546 2070 A
6795 V
(03036)210 1122 A
(#define)294 1440 A
(m1_i2)210 1776 A
(m_u.m_m1.m1i2)546 2070 A
6885 V
(03037)210 1122 A
(#define)294 1440 A
(m1_i3)210 1776 A
(m_u.m_m1.m1i3)546 2070 A
6975 V
(03038)210 1122 A
(#define)294 1440 A
(m1_p1)210 1776 A
(m_u.m_m1.m1p1)546 2070 A
7065 V
(03039)210 1122 A
(#define)294 1440 A
(m1_p2)210 1776 A
(m_u.m_m1.m1p2)546 2070 A
8418 V
EP
%%Page: 34 34
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(34)S
11 R
2330(File:)S
2563(include/minix/ipc.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(03040)210 1122 A
(#define)294 1440 A
(m1_p3)210 1776 A
(m_u.m_m1.m1p3)546 2070 A
1845 V
(03041)210 1122 A
1935 V
(03042)210 1122 A
(#define)294 1440 A
(m2_i1)210 1776 A
(m_u.m_m2.m2i1)546 2070 A
2025 V
(03043)210 1122 A
(#define)294 1440 A
(m2_i2)210 1776 A
(m_u.m_m2.m2i2)546 2070 A
2115 V
(03044)210 1122 A
(#define)294 1440 A
(m2_i3)210 1776 A
(m_u.m_m2.m2i3)546 2070 A
2205 V
(03045)210 1122 A
(#define)294 1440 A
(m2_l1)210 1776 A
(m_u.m_m2.m2l1)546 2070 A
2295 V
(03046)210 1122 A
(#define)294 1440 A
(m2_l2)210 1776 A
(m_u.m_m2.m2l2)546 2070 A
2385 V
(03047)210 1122 A
(#define)294 1440 A
(m2_p1)210 1776 A
(m_u.m_m2.m2p1)546 2070 A
2475 V
(03048)210 1122 A
2565 V
(03049)210 1122 A
(#define)294 1440 A
(m3_i1)210 1776 A
(m_u.m_m3.m3i1)546 2070 A
2655 V
(03050)210 1122 A
(#define)294 1440 A
(m3_i2)210 1776 A
(m_u.m_m3.m3i2)546 2070 A
2745 V
(03051)210 1122 A
(#define)294 1440 A
(m3_p1)210 1776 A
(m_u.m_m3.m3p1)546 2070 A
2835 V
(03052)210 1122 A
(#define)294 1440 A
(m3_ca1)252 1776 A
(m_u.m_m3.m3ca1)588 2070 A
2925 V
(03053)210 1122 A
3015 V
(03054)210 1122 A
(#define)294 1440 A
(m4_l1)210 1776 A
(m_u.m_m4.m4l1)546 2070 A
3105 V
(03055)210 1122 A
(#define)294 1440 A
(m4_l2)210 1776 A
(m_u.m_m4.m4l2)546 2070 A
3195 V
(03056)210 1122 A
(#define)294 1440 A
(m4_l3)210 1776 A
(m_u.m_m4.m4l3)546 2070 A
3285 V
(03057)210 1122 A
(#define)294 1440 A
(m4_l4)210 1776 A
(m_u.m_m4.m4l4)546 2070 A
3375 V
(03058)210 1122 A
(#define)294 1440 A
(m4_l5)210 1776 A
(m_u.m_m4.m4l5)546 2070 A
3465 V
(03059)210 1122 A
3555 V
(03060)210 1122 A
(#define)294 1440 A
(m5_c1)210 1776 A
(m_u.m_m5.m5c1)546 2070 A
3645 V
(03061)210 1122 A
(#define)294 1440 A
(m5_c2)210 1776 A
(m_u.m_m5.m5c2)546 2070 A
3735 V
(03062)210 1122 A
(#define)294 1440 A
(m5_i1)210 1776 A
(m_u.m_m5.m5i1)546 2070 A
3825 V
(03063)210 1122 A
(#define)294 1440 A
(m5_i2)210 1776 A
(m_u.m_m5.m5i2)546 2070 A
3915 V
(03064)210 1122 A
(#define)294 1440 A
(m5_l1)210 1776 A
(m_u.m_m5.m5l1)546 2070 A
4005 V
(03065)210 1122 A
(#define)294 1440 A
(m5_l2)210 1776 A
(m_u.m_m5.m5l2)546 2070 A
4095 V
(03066)210 1122 A
(#define)294 1440 A
(m5_l3)210 1776 A
(m_u.m_m5.m5l3)546 2070 A
4185 V
(03067)210 1122 A
4275 V
(03068)210 1122 A
(#define)294 1440 A
(m7_i1)210 1776 A
(m_u.m_m7.m7i1)546 2070 A
4365 V
(03069)210 1122 A
(#define)294 1440 A
(m7_i2)210 1776 A
(m_u.m_m7.m7i2)546 2070 A
4455 V
(03070)210 1122 A
(#define)294 1440 A
(m7_i3)210 1776 A
(m_u.m_m7.m7i3)546 2070 A
4545 V
(03071)210 1122 A
(#define)294 1440 A
(m7_i4)210 1776 A
(m_u.m_m7.m7i4)546 2070 A
4635 V
(03072)210 1122 A
(#define)294 1440 A
(m7_p1)210 1776 A
(m_u.m_m7.m7p1)546 2070 A
4725 V
(03073)210 1122 A
(#define)294 1440 A
(m7_p2)210 1776 A
(m_u.m_m7.m7p2)546 2070 A
4815 V
(03074)210 1122 A
4905 V
(03075)210 1122 A
(#define)294 1440 A
(m8_i1)210 1776 A
(m_u.m_m8.m8i1)546 2070 A
4995 V
(03076)210 1122 A
(#define)294 1440 A
(m8_i2)210 1776 A
(m_u.m_m8.m8i2)546 2070 A
5085 V
(03077)210 1122 A
(#define)294 1440 A
(m8_p1)210 1776 A
(m_u.m_m8.m8p1)546 2070 A
5175 V
(03078)210 1122 A
(#define)294 1440 A
(m8_p2)210 1776 A
(m_u.m_m8.m8p2)546 2070 A
5265 V
(03079)210 1122 A
(#define)294 1440 A
(m8_p3)210 1776 A
(m_u.m_m8.m8p3)546 2070 A
5355 V
(03080)210 1122 A
(#define)294 1440 A
(m8_p4)210 1776 A
(m_u.m_m8.m8p4)546 2070 A
5445 V
(03081)210 1122 A
5535 V
(03082)210 1122 A
(/*==========================================================================*)3234 1440 A
5625 V
(03083)210 1122 A
1482(*)S
(Minix)210 1566 A
(run-time)336 1818 A
(system)252 2196 A
(\(IPC\).)252 2490 A
4632(*)S
5715 V
(03084)210 1122 A
(*==========================================================================*/)3234 1482 A
5805 V
(03085)210 1122 A
5895 V
(03086)210 1122 A
1440(/*)S
(Hide)168 1566 A
(names)210 1776 A
2028(to)S
(avoid)210 2154 A
(name)168 2406 A
(space)210 2616 A
(pollution.)420 2868 A
3330(*/)S
5985 V
(03087)210 1122 A
(#define)294 1440 A
(echo)168 1776 A
(_echo)210 2448 A
6075 V
(03088)210 1122 A
(#define)294 1440 A
(notify)252 1776 A
(_notify)294 2448 A
6165 V
(03089)210 1122 A
(#define)294 1440 A
(sendrec)294 1776 A
(_sendrec)336 2448 A
6255 V
(03090)210 1122 A
(#define)294 1440 A
(receive)294 1776 A
(_receive)336 2448 A
6345 V
(03091)210 1122 A
(#define)294 1440 A
(send)168 1776 A
(_send)210 2448 A
6435 V
(03092)210 1122 A
(#define)294 1440 A
(nb_receive)420 1776 A
(_nb_receive)462 2448 A
6525 V
(03093)210 1122 A
(#define)294 1440 A
(nb_send)294 1776 A
(_nb_send)336 2448 A
6615 V
(03094)210 1122 A
6705 V
(03095)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(echo,)210 2112 A
(\(message)336 2364 A
(*m_ptr\))294 2742 A
4464(\);)S
6795 V
(03096)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(notify,)294 2112 A
(\(int)168 2448 A
(dest\))210 2658 A
4464(\);)S
6885 V
(03097)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sendrec,)336 2112 A
(\(int)168 2490 A
(src_dest,)378 2700 A
(message)294 3120 A
(*m_ptr\))294 3456 A
4464(\);)S
6975 V
(03098)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(receive,)336 2112 A
(\(int)168 2490 A
(src,)168 2700 A
(message)294 2910 A
(*m_ptr\))294 3246 A
4464(\);)S
7065 V
(03099)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(send,)210 2112 A
(\(int)168 2364 A
(dest,)210 2574 A
(message)294 2826 A
(*m_ptr\))294 3162 A
4464(\);)S
8418 V
EP
%%Page: 35 35
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2330(File:)S
2563(include/minix/ipc.h)S
12 B
4560(35)S
1755 V
7 LST
(03100)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(nb_receive,)462 2112 A
(\(int)168 2616 A
(src,)168 2826 A
(message)294 3036 A
(*m_ptr\))294 3372 A
4464(\);)S
1845 V
(03101)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(nb_send,)336 2112 A
(\(int)168 2490 A
(dest,)210 2700 A
(message)294 2952 A
(*m_ptr\))294 3288 A
4464(\);)S
1935 V
(03102)210 1122 A
2025 V
(03103)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_IPC_H)252 1860 A
2154(*/)S
2295 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2385 V
(include/minix/syslib.h)924 2676 A
2475 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2655 V
(03200)210 1122 A
1440(/*)S
(Prototypes)420 1566 A
(for)126 2028 A
(system)252 2196 A
(library)294 2490 A
(functions.)420 2826 A
3288(*/)S
2745 V
(03201)210 1122 A
2835 V
(03202)210 1122 A
(#ifndef)294 1440 A
(_SYSLIB_H)378 1776 A
2925 V
(03203)210 1122 A
(#define)294 1440 A
(_SYSLIB_H)378 1776 A
3015 V
(03204)210 1122 A
3105 V
(03205)210 1122 A
(#ifndef)294 1440 A
(_TYPES_H)336 1776 A
3195 V
(03206)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
3285 V
(03207)210 1122 A
(#endif)252 1440 A
3375 V
(03208)210 1122 A
3465 V
(03209)210 1122 A
(#ifndef)294 1440 A
(_IPC_H)252 1776 A
3555 V
(03210)210 1122 A
(#include)336 1440 A
(<minix/ipc.h>)546 1818 A
3645 V
(03211)210 1122 A
(#endif)252 1440 A
3735 V
(03212)210 1122 A
3825 V
(03213)210 1122 A
(#ifndef)294 1440 A
(_DEVIO_H)336 1776 A
3915 V
(03214)210 1122 A
(#include)336 1440 A
(<minix/devio.h>)630 1818 A
4005 V
(03215)210 1122 A
(#endif)252 1440 A
4095 V
(03216)210 1122 A
4185 V
(03217)210 1122 A
1440(/*)S
(Forward)294 1566 A
(declaration)462 1902 A
2406(*/)S
4275 V
(03218)210 1122 A
(struct)252 1440 A
(reg86u;)294 1734 A
4365 V
(03219)210 1122 A
4455 V
(03220)210 1122 A
(#define)294 1440 A
(SYSTASK)294 1776 A
(SYSTEM)252 2112 A
4545 V
(03221)210 1122 A
4635 V
(03222)210 1122 A
(/*==========================================================================*)3234 1440 A
4725 V
(03223)210 1122 A
1482(*)S
(Minix)210 1566 A
(system)252 1818 A
(library.)336 2112 A
4632(*)S
4815 V
(03224)210 1122 A
(*==========================================================================*/)3234 1482 A
4905 V
(03225)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(_taskcall,)420 2112 A
(\(int)168 2574 A
(who,)168 2784 A
(int)126 2994 A
(syscallnr,)420 3162 A
(message)294 3624 A
(*msgptr\)\);)420 3960 A
4995 V
(03226)210 1122 A
5085 V
(03227)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sys_abort,)420 2112 A
(\(int)168 2574 A
(how,)168 2784 A
(...\)\);)252 2994 A
5175 V
(03228)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sys_exec,)378 2112 A
(\(int)168 2532 A
(proc,)210 2742 A
(char)168 2994 A
(*ptr,)210 3204 A
5265 V
(03229)210 1122 A
(char)168 2784 A
(*aout,)252 2994 A
(vir_bytes)378 3288 A
(initpc\)\);)378 3708 A
5355 V
(03230)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sys_fork,)378 2112 A
(\(int)168 2532 A
(parent,)294 2742 A
(int)126 3078 A
(child\)\);)336 3246 A
5445 V
(03231)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sys_newmap,)462 2112 A
(\(int)168 2616 A
(proc,)210 2826 A
(struct)252 3078 A
(mem_map)294 3372 A
(*ptr\)\);)294 3708 A
5535 V
(03232)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sys_exit,)378 2112 A
(\(int)168 2532 A
(proc\)\);)294 2742 A
5625 V
(03233)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sys_trace,)420 2112 A
(\(int)168 2574 A
(req,)168 2784 A
(int)126 2994 A
(proc,)210 3162 A
(long)168 3414 A
(addr,)210 3624 A
(long)168 3876 A
(*data_p\)\);)420 4086 A
5715 V
(03234)210 1122 A
5805 V
(03235)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sys_svrctl,)462 2112 A
(\(int)168 2616 A
(proc,)210 2826 A
(int)126 3078 A
(req,)168 3246 A
(int)126 3456 A
(priv,vir_bytes)588 3624 A
(argp\)\);)294 4254 A
5895 V
(03236)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sys_nice,)378 2112 A
(\(int)168 2532 A
(proc,)210 2742 A
(int)126 2994 A
(priority\)\);)462 3162 A
5985 V
(03237)210 1122 A
6075 V
(03238)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sys_int86,)420 2112 A
(\(struct)294 2574 A
(reg86u)252 2910 A
(*reg86p\)\);)420 3204 A
6165 V
(03239)210 1122 A
6255 V
(03240)210 1122 A
1440(/*)S
(Shorthands)420 1566 A
(for)126 2028 A
(sys_sdevio\(\))504 2196 A
(system)252 2742 A
(call.)210 3036 A
3288(*/)S
6345 V
(03241)210 1122 A
(#define)294 1440 A
(sys_insb\(port,)588 1776 A
(proc_nr,)336 2406 A
(buffer,)294 2784 A
(count\))252 3120 A
3414(\\)S
6435 V
(03242)210 1122 A
(sys_sdevio\(DIO_INPUT,)882 1776 A
(port,)210 2700 A
(DIO_BYTE,)378 2952 A
(proc_nr,)336 3372 A
(buffer,)294 3750 A
(count\))252 4086 A
6525 V
(03243)210 1122 A
(#define)294 1440 A
(sys_insw\(port,)588 1776 A
(proc_nr,)336 2406 A
(buffer,)294 2784 A
(count\))252 3120 A
3414(\\)S
6615 V
(03244)210 1122 A
(sys_sdevio\(DIO_INPUT,)882 1776 A
(port,)210 2700 A
(DIO_WORD,)378 2952 A
(proc_nr,)336 3372 A
(buffer,)294 3750 A
(count\))252 4086 A
6705 V
(03245)210 1122 A
(#define)294 1440 A
(sys_outsb\(port,)630 1776 A
(proc_nr,)336 2448 A
(buffer,)294 2826 A
(count\))252 3162 A
3456(\\)S
6795 V
(03246)210 1122 A
(sys_sdevio\(DIO_OUTPUT,)924 1776 A
(port,)210 2742 A
(DIO_BYTE,)378 2994 A
(proc_nr,)336 3414 A
(buffer,)294 3792 A
(count\))252 4128 A
6885 V
(03247)210 1122 A
(#define)294 1440 A
(sys_outsw\(port,)630 1776 A
(proc_nr,)336 2448 A
(buffer,)294 2826 A
(count\))252 3162 A
3456(\\)S
6975 V
(03248)210 1122 A
(sys_sdevio\(DIO_OUTPUT,)924 1776 A
(port,)210 2742 A
(DIO_WORD,)378 2994 A
(proc_nr,)336 3414 A
(buffer,)294 3792 A
(count\))252 4128 A
7065 V
(03249)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sys_sdevio,)462 2112 A
(\(int)168 2616 A
(req,)168 2826 A
(long)168 3036 A
(port,)210 3246 A
(int)126 3498 A
(type,)210 3666 A
(int)126 3918 A
(proc_nr,)336 4086 A
8418 V
EP
%%Page: 36 36
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(36)S
11 R
2269(File:)S
2502(include/minix/syslib.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(03250)210 1122 A
(void)168 1776 A
(*buffer,)336 1986 A
(int)126 2364 A
(count\)\);)336 2532 A
1845 V
(03251)210 1122 A
1935 V
(03252)210 1122 A
1440(/*)S
(Clock)210 1566 A
(functionality:)588 1818 A
(get)126 2448 A
(system)252 2616 A
(times)210 2910 A
3162(or)S
(\(un\)schedule)504 3288 A
3834(an)S
(alarm)210 3960 A
(call.)210 4212 A
4464(*/)S
2025 V
(03253)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sys_times,)420 2112 A
(\(int)168 2574 A
(proc_nr,)336 2784 A
(clock_t)294 3162 A
(*ptr\)\);)294 3498 A
2115 V
(03254)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_setalarm,)546 2070 A
(\(clock_t)336 2658 A
(exp_time,)378 3036 A
(int)126 3456 A
(abs_time\)\);)462 3624 A
2205 V
(03255)210 1122 A
2295 V
(03256)210 1122 A
1440(/*)S
(Shorthands)420 1566 A
(for)126 2028 A
(sys_irqctl\(\))504 2196 A
(system)252 2742 A
(call.)210 3036 A
3288(*/)S
2385 V
(03257)210 1122 A
(#define)294 1440 A
(sys_irqdisable\(hook_id\))966 1776 A
2784(\\)S
2475 V
(03258)210 1122 A
(sys_irqctl\(IRQ_DISABLE,)966 1608 A
2616(0,)S
2742(0,)S
(hook_id\))336 2868 A
2565 V
(03259)210 1122 A
(#define)294 1440 A
(sys_irqenable\(hook_id\))924 1776 A
2742(\\)S
2655 V
(03260)210 1122 A
(sys_irqctl\(IRQ_ENABLE,)924 1608 A
2574(0,)S
2700(0,)S
(hook_id\))336 2826 A
2745 V
(03261)210 1122 A
(#define)294 1440 A
(sys_irqsetpolicy\(irq_vec,)1050 1776 A
(policy,)294 2868 A
(hook_id\))336 3204 A
3582(\\)S
2835 V
(03262)210 1122 A
(sys_irqctl\(IRQ_SETPOLICY,)1050 1608 A
(irq_vec,)336 2700 A
(policy,)294 3078 A
(hook_id\))336 3414 A
2925 V
(03263)210 1122 A
(#define)294 1440 A
(sys_irqrmpolicy\(irq_vec,)1008 1776 A
(hook_id\))336 2826 A
3204(\\)S
3015 V
(03264)210 1122 A
(sys_irqctl\(IRQ_RMPOLICY,)1008 1608 A
(irq_vec,)336 2658 A
3036(0,)S
(hook_id\))336 3162 A
3105 V
(03265)210 1122 A
(_PROTOTYPE)420 1440 A
1902(\()S
(int)126 1986 A
(sys_irqctl,)462 2154 A
(\(int)168 2658 A
(request,)336 2868 A
(int)126 3246 A
(irq_vec,)336 3414 A
(int)126 3792 A
(policy,)294 3960 A
3195 V
(03266)210 1122 A
(int)126 1608 A
(*irq_hook_id\))546 1776 A
2364(\);)S
3285 V
(03267)210 1122 A
3375 V
(03268)210 1122 A
1440(/*)S
(Shorthands)420 1566 A
(for)126 2028 A
(sys_vircopy\(\))546 2196 A
(and)126 2784 A
(sys_physcopy\(\))588 2952 A
(system)252 3582 A
(calls.)252 3876 A
4170(*/)S
3465 V
(03269)210 1122 A
(#define)294 1440 A
(sys_biosin\(bios_vir,)840 1776 A
(dst_vir,)336 2658 A
(bytes\))252 3036 A
3330(\\)S
3555 V
(03270)210 1122 A
(sys_vircopy\(SELF,)714 1776 A
(BIOS_SEG,)378 2532 A
(bios_vir,)378 2952 A
(SELF,)210 3372 A
3624(D,)S
(dst_vir,)336 3750 A
(bytes\))252 4128 A
3645 V
(03271)210 1122 A
(#define)294 1440 A
(sys_biosout\(src_vir,)840 1776 A
(bios_vir,)378 2658 A
(bytes\))252 3078 A
3372(\\)S
3735 V
(03272)210 1122 A
(sys_vircopy\(SELF,)714 1776 A
2532(D,)S
(src_vir,)336 2658 A
(SELF,)210 3036 A
(BIOS_SEG,)378 3288 A
(bios_vir,)378 3708 A
(bytes\))252 4128 A
3825 V
(03273)210 1122 A
(#define)294 1440 A
(sys_datacopy\(src_proc,)924 1776 A
(src_vir,)336 2742 A
(dst_proc,)378 3120 A
(dst_vir,)336 3540 A
(bytes\))252 3918 A
4212(\\)S
3915 V
(03274)210 1122 A
(sys_vircopy\(src_proc,)882 1776 A
2700(D,)S
(src_vir,)336 2826 A
(dst_proc,)378 3204 A
3624(D,)S
(dst_vir,)336 3750 A
(bytes\))252 4128 A
4005 V
(03275)210 1122 A
(#define)294 1440 A
(sys_textcopy\(src_proc,)924 1776 A
(src_vir,)336 2742 A
(dst_proc,)378 3120 A
(dst_vir,)336 3540 A
(bytes\))252 3918 A
4212(\\)S
4095 V
(03276)210 1122 A
(sys_vircopy\(src_proc,)882 1776 A
2700(T,)S
(src_vir,)336 2826 A
(dst_proc,)378 3204 A
3624(T,)S
(dst_vir,)336 3750 A
(bytes\))252 4128 A
4185 V
(03277)210 1122 A
(#define)294 1440 A
(sys_stackcopy\(src_proc,)966 1776 A
(src_vir,)336 2784 A
(dst_proc,)378 3162 A
(dst_vir,)336 3582 A
(bytes\))252 3960 A
4254(\\)S
4275 V
(03278)210 1122 A
(sys_vircopy\(src_proc,)882 1776 A
2700(S,)S
(src_vir,)336 2826 A
(dst_proc,)378 3204 A
3624(S,)S
(dst_vir,)336 3750 A
(bytes\))252 4128 A
4365 V
(03279)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_vircopy,)504 2070 A
(\(int)168 2616 A
(src_proc,)378 2826 A
(int)126 3246 A
(src_seg,)336 3414 A
(vir_bytes)378 3792 A
(src_vir,)336 4212 A
4455 V
(03280)210 1122 A
(int)126 1776 A
(dst_proc,)378 1944 A
(int)126 2364 A
(dst_seg,)336 2532 A
(vir_bytes)378 2910 A
(dst_vir,)336 3330 A
(phys_bytes)420 3708 A
(bytes\)\);)336 4170 A
4545 V
(03281)210 1122 A
4635 V
(03282)210 1122 A
(#define)294 1440 A
(sys_abscopy\(src_phys,)882 1776 A
(dst_phys,)378 2700 A
(bytes\))252 3120 A
3414(\\)S
4725 V
(03283)210 1122 A
(sys_physcopy\(NONE,)756 1776 A
(PHYS_SEG,)378 2574 A
(src_phys,)378 2994 A
(NONE,)210 3414 A
(PHYS_SEG,)378 3666 A
(dst_phys,)378 4086 A
(bytes\))252 4506 A
4815 V
(03284)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_physcopy,)546 2070 A
(\(int)168 2658 A
(src_proc,)378 2868 A
(int)126 3288 A
(src_seg,)336 3456 A
(vir_bytes)378 3834 A
(src_vir,)336 4254 A
4905 V
(03285)210 1122 A
(int)126 1776 A
(dst_proc,)378 1944 A
(int)126 2364 A
(dst_seg,)336 2532 A
(vir_bytes)378 2910 A
(dst_vir,)336 3330 A
(phys_bytes)420 3708 A
(bytes\)\);)336 4170 A
4995 V
(03286)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_memset,)462 2070 A
(\(unsigned)378 2574 A
(long)168 2994 A
(pattern,)336 3204 A
5085 V
(03287)210 1122 A
(phys_bytes)420 2112 A
(base,)210 2574 A
(phys_bytes)420 2826 A
(bytes\)\);)336 3288 A
5175 V
(03288)210 1122 A
5265 V
(03289)210 1122 A
1440(/*)S
(Vectored)336 1566 A
(virtual)294 1944 A
2280(/)S
(physical)336 2364 A
(copy)168 2742 A
(calls.)252 2952 A
3246(*/)S
5355 V
(03290)210 1122 A
(#if)126 1440 A
(DEAD_CODE)378 1608 A
2448(/*)S
(library)294 2574 A
(part)168 2910 A
(not)126 3120 A
(yet)126 3288 A
(implemented)462 3456 A
3960(*/)S
5445 V
(03291)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_virvcopy,)546 2070 A
(\(phys_cp_req)504 2658 A
(*vec_ptr,int)504 3204 A
(vec_size,int)504 3750 A
(*nr_ok\)\);)378 4296 A
5535 V
(03292)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_physvcopy,)588 2070 A
(\(phys_cp_req)504 2700 A
(*vec_ptr,int)504 3246 A
(vec_size,int)504 3792 A
(*nr_ok\)\);)378 4338 A
5625 V
(03293)210 1122 A
(#endif)252 1440 A
5715 V
(03294)210 1122 A
5805 V
(03295)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_umap,)378 2070 A
(\(int)168 2490 A
(proc_nr,)336 2700 A
(int)126 3078 A
(seg,)168 3246 A
(vir_bytes)378 3456 A
(vir_addr,)378 3876 A
5895 V
(03296)210 1122 A
(vir_bytes)378 1818 A
(bytes,)252 2238 A
(phys_bytes)420 2532 A
(*phys_addr\)\);)546 2994 A
5985 V
(03297)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_segctl,)462 2070 A
(\(int)168 2574 A
(*index,)294 2784 A
(u16_t)210 3120 A
(*seg,)210 3372 A
(vir_bytes)378 3624 A
(*off,)210 4044 A
6075 V
(03298)210 1122 A
(phys_bytes)420 1776 A
(phys,)210 2238 A
(vir_bytes)378 2490 A
(size\)\);)294 2910 A
6165 V
(03299)210 1122 A
6255 V
(03300)210 1122 A
1440(/*)S
(Shorthands)420 1566 A
(for)126 2028 A
(sys_getinfo\(\))546 2196 A
(system)252 2784 A
(call.)210 3078 A
3330(*/)S
6345 V
(03301)210 1122 A
(#define)294 1440 A
(sys_getkmessages\(dst\))882 1776 A
(sys_getinfo\(GET_KMESSAGES,)1092 2784 A
(dst,)168 3918 A
(0,0,0\))252 4128 A
6435 V
(03302)210 1122 A
(#define)294 1440 A
(sys_getkinfo\(dst\))714 1776 A
(sys_getinfo\(GET_KINFO,)924 2784 A
(dst,)168 3750 A
(0,0,0\))252 3960 A
6525 V
(03303)210 1122 A
(#define)294 1440 A
(sys_getmachine\(dst\))798 1776 A
(sys_getinfo\(GET_MACHINE,)1008 2784 A
(dst,)168 3834 A
(0,0,0\))252 4044 A
6615 V
(03304)210 1122 A
(#define)294 1440 A
(sys_getproctab\(dst\))798 1776 A
(sys_getinfo\(GET_PROCTAB,)1008 2784 A
(dst,)168 3834 A
(0,0,0\))252 4044 A
6705 V
(03305)210 1122 A
(#define)294 1440 A
(sys_getprivtab\(dst\))798 1776 A
(sys_getinfo\(GET_PRIVTAB,)1008 2784 A
(dst,)168 3834 A
(0,0,0\))252 4044 A
6795 V
(03306)210 1122 A
(#define)294 1440 A
(sys_getproc\(dst,nr\))798 1776 A
(sys_getinfo\(GET_PROC,)882 2784 A
(dst,)168 3708 A
(0,0,)168 3918 A
(nr\))126 4128 A
6885 V
(03307)210 1122 A
(#define)294 1440 A
(sys_getrandomness\(dst\))924 1776 A
(sys_getinfo\(GET_RANDOMNESS,)1134 2784 A
(dst,)168 3960 A
(0,0,0\))252 4170 A
6975 V
(03308)210 1122 A
(#define)294 1440 A
(sys_getimage\(dst\))714 1776 A
(sys_getinfo\(GET_IMAGE,)924 2784 A
(dst,)168 3750 A
(0,0,0\))252 3960 A
7065 V
(03309)210 1122 A
(#define)294 1440 A
(sys_getirqhooks\(dst\))840 1776 A
(sys_getinfo\(GET_IRQHOOKS,)1050 2784 A
(dst,)168 3876 A
(0,0,0\))252 4086 A
8418 V
EP
%%Page: 37 37
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2269(File:)S
2502(include/minix/syslib.h)S
12 B
4560(37)S
1755 V
7 LST
(03310)210 1122 A
(#define)294 1440 A
(sys_getmonparams\(v,vl\))924 1776 A
(sys_getinfo\(GET_MONPARAMS,)1092 2784 A
(v,vl,)210 3918 A
(0,0\))168 4170 A
1845 V
(03311)210 1122 A
(#define)294 1440 A
(sys_getschedinfo\(v1,v2\))966 1776 A
(sys_getinfo\(GET_SCHEDINFO,)1092 2784 A
(v1,0,)210 3918 A
(v2,0\))210 4170 A
1935 V
(03312)210 1122 A
(#define)294 1440 A
(sys_getlocktimings\(dst\))966 1776 A
(sys_getinfo\(GET_LOCKTIMING,)1134 2784 A
(dst,)168 3960 A
(0,0,0\))252 4170 A
2025 V
(03313)210 1122 A
(#define)294 1440 A
(sys_getbiosbuffer\(virp,)966 1776 A
(sizep\))252 2784 A
(sys_getinfo\(GET_BIOSBUFFER,)1134 3078 A
(virp,)210 4254 A
4506(\\)S
2115 V
(03314)210 1122 A
(sizeof\(*virp\),)588 1776 A
(sizep,)252 2406 A
(sizeof\(*sizep\)\))630 2700 A
2205 V
(03315)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_getinfo,)504 2070 A
(\(int)168 2616 A
(request,)336 2826 A
(void)168 3204 A
(*val_ptr,)378 3414 A
(int)126 3834 A
(val_len,)336 4002 A
2295 V
(03316)210 1122 A
(void)168 2826 A
(*val_ptr2,)420 3036 A
(int)126 3498 A
(val_len2\))378 3666 A
4464(\);)S
2385 V
(03317)210 1122 A
2475 V
(03318)210 1122 A
1440(/*)S
(Signal)252 1566 A
(control.)336 1860 A
2238(*/)S
2565 V
(03319)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_kill,)378 2070 A
(\(int)168 2490 A
(proc,)210 2700 A
(int)126 2952 A
(sig\))168 3120 A
3330(\);)S
2655 V
(03320)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_sigsend,)504 2070 A
(\(int)168 2616 A
(proc_nr,)336 2826 A
(struct)252 3204 A
(sigmsg)252 3498 A
(*sig_ctxt\))420 3792 A
4254(\);)S
2745 V
(03321)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_sigreturn,)588 2070 A
(\(int)168 2700 A
(proc_nr,)336 2910 A
(struct)252 3288 A
(sigmsg)252 3582 A
(*sig_ctxt\))420 3876 A
4338(\);)S
2835 V
(03322)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_getksig,)504 2070 A
(\(int)168 2616 A
(*k_proc_nr,)462 2826 A
(sigset_t)336 3330 A
(*k_sig_map\))462 3708 A
4212(\);)S
2925 V
(03323)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_endksig,)504 2070 A
(\(int)168 2616 A
(proc_nr\))336 2826 A
3204(\);)S
3015 V
(03324)210 1122 A
3105 V
(03325)210 1122 A
1440(/*)S
(NOTE:)210 1566 A
(two)126 1818 A
(different)378 1986 A
(approaches)420 2406 A
(were)168 2868 A
(used)168 3078 A
3288(to)S
(distinguish)462 3414 A
(the)126 3918 A
(device)252 4086 A
(I/O)126 4380 A
3195 V
(03326)210 1122 A
1482(*)S
(types)210 1566 A
('byte',)294 1818 A
('word',)294 2154 A
('long':)294 2490 A
(the)126 2826 A
(latter)252 2994 A
(uses)168 3288 A
(#define)294 3498 A
(and)126 3834 A
(results)294 4002 A
4338(in)S
4464(a)S
3285 V
(03327)210 1122 A
1482(*)S
(smaller)294 1566 A
(implementation,)630 1902 A
(but)126 2574 A
(looses)252 2742 A
(the)126 3036 A
(static)252 3204 A
(type)168 3498 A
(checking.)378 3708 A
3375 V
(03328)210 1122 A
1482(*/)S
3465 V
(03329)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_voutb,)420 2070 A
(\(pvb_pair_t)462 2532 A
(*pvb_pairs,)462 3036 A
(int)126 3540 A
(nr_ports\))378 3708 A
4464(\);)S
3555 V
(03330)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_voutw,)420 2070 A
(\(pvw_pair_t)462 2532 A
(*pvw_pairs,)462 3036 A
(int)126 3540 A
(nr_ports\))378 3708 A
4464(\);)S
3645 V
(03331)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_voutl,)420 2070 A
(\(pvl_pair_t)462 2532 A
(*pvl_pairs,)462 3036 A
(int)126 3540 A
(nr_ports\))378 3708 A
4464(\);)S
3735 V
(03332)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_vinb,)378 2070 A
(\(pvb_pair_t)462 2490 A
(*pvb_pairs,)462 2994 A
(int)126 3498 A
(nr_ports\))378 3666 A
4464(\);)S
3825 V
(03333)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_vinw,)378 2070 A
(\(pvw_pair_t)462 2490 A
(*pvw_pairs,)462 2994 A
(int)126 3498 A
(nr_ports\))378 3666 A
4464(\);)S
3915 V
(03334)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_vinl,)378 2070 A
(\(pvl_pair_t)462 2490 A
(*pvl_pairs,)462 2994 A
(int)126 3498 A
(nr_ports\))378 3666 A
4464(\);)S
4005 V
(03335)210 1122 A
4095 V
(03336)210 1122 A
1440(/*)S
(Shorthands)420 1566 A
(for)126 2028 A
(sys_out\(\))378 2196 A
(system)252 2616 A
(call.)210 2910 A
3162(*/)S
4185 V
(03337)210 1122 A
(#define)294 1440 A
(sys_outb\(p,v\))546 1776 A
(sys_out\(\(p\),)504 2448 A
(\(unsigned)378 2994 A
(long\))210 3414 A
(\(v\),)168 3666 A
(DIO_BYTE\))378 3876 A
4275 V
(03338)210 1122 A
(#define)294 1440 A
(sys_outw\(p,v\))546 1776 A
(sys_out\(\(p\),)504 2448 A
(\(unsigned)378 2994 A
(long\))210 3414 A
(\(v\),)168 3666 A
(DIO_WORD\))378 3876 A
4365 V
(03339)210 1122 A
(#define)294 1440 A
(sys_outl\(p,v\))546 1776 A
(sys_out\(\(p\),)504 2448 A
(\(unsigned)378 2994 A
(long\))210 3414 A
(\(v\),)168 3666 A
(DIO_LONG\))378 3876 A
4455 V
(03340)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_out,)336 2070 A
(\(int)168 2448 A
(port,)210 2658 A
(unsigned)336 2910 A
(long)168 3288 A
(value,)252 3498 A
(int)126 3792 A
(type\))210 3960 A
4464(\);)S
4545 V
(03341)210 1122 A
4635 V
(03342)210 1122 A
1440(/*)S
(Shorthands)420 1566 A
(for)126 2028 A
(sys_in\(\))336 2196 A
(system)252 2574 A
(call.)210 2868 A
3120(*/)S
4725 V
(03343)210 1122 A
(#define)294 1440 A
(sys_inb\(p,v\))504 1776 A
(sys_in\(\(p\),)462 2448 A
(\(unsigned)378 2952 A
(long*\))252 3372 A
(\(v\),)168 3666 A
(DIO_BYTE\))378 3876 A
4815 V
(03344)210 1122 A
(#define)294 1440 A
(sys_inw\(p,v\))504 1776 A
(sys_in\(\(p\),)462 2448 A
(\(unsigned)378 2952 A
(long*\))252 3372 A
(\(v\),)168 3666 A
(DIO_WORD\))378 3876 A
4905 V
(03345)210 1122 A
(#define)294 1440 A
(sys_inl\(p,v\))504 1776 A
(sys_in\(\(p\),)462 2448 A
(\(unsigned)378 2952 A
(long*\))252 3372 A
(\(v\),)168 3666 A
(DIO_LONG\))378 3876 A
4995 V
(03346)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(sys_in,)294 2070 A
(\(int)168 2406 A
(port,)210 2616 A
(unsigned)336 2868 A
(long)168 3246 A
(*value,)294 3456 A
(int)126 3792 A
(type\))210 3960 A
4464(\);)S
5085 V
(03347)210 1122 A
5175 V
(03348)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_SYSLIB_H)378 1860 A
2280(*/)S
5265 V
(03349)210 1122 A
5445 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5535 V
(include/minix/sysutil.h)966 2676 A
5625 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5805 V
(03400)210 1122 A
(#ifndef)294 1440 A
(_EXTRALIB_H)462 1776 A
5895 V
(03401)210 1122 A
(#define)294 1440 A
(_EXTRALIB_H)462 1776 A
5985 V
(03402)210 1122 A
6075 V
(03403)210 1122 A
1440(/*)S
(Extra)210 1566 A
(system)252 1818 A
(library)294 2112 A
(definitions)462 2448 A
2952(to)S
(support)294 3078 A
(device)252 3414 A
(drivers)294 3708 A
(and)126 4044 A
(servers.)336 4212 A
6165 V
(03404)210 1122 A
1482(*)S
6255 V
(03405)210 1122 A
1482(*)S
(Created:)336 1566 A
6345 V
(03406)210 1122 A
1482(*)S
(Mar)126 1776 A
(15,)126 1944 A
(2004)168 2112 A
2322(by)S
(Jorrit)252 2448 A
2742(N.)S
(Herder)252 2868 A
6435 V
(03407)210 1122 A
1482(*)S
6525 V
(03408)210 1122 A
1482(*)S
(Changes:)336 1566 A
6615 V
(03409)210 1122 A
1482(*)S
(May)126 1776 A
(31,)126 1944 A
(2005:)210 2112 A
(added)210 2364 A
(printf,)294 2616 A
(kputc)210 2952 A
(\(relocated)420 3204 A
(from)168 3666 A
(syslib\))294 3876 A
6705 V
(03410)210 1122 A
1482(*)S
(May)126 1776 A
(31,)126 1944 A
(2005:)210 2112 A
(added)210 2364 A
(getuptime)378 2616 A
6795 V
(03411)210 1122 A
1482(*)S
(Mar)126 1776 A
(18,)126 1944 A
(2005:)210 2112 A
(added)210 2364 A
(tickdelay)378 2616 A
6885 V
(03412)210 1122 A
1482(*)S
(Oct)126 1776 A
(01,)126 1944 A
(2004:)210 2112 A
(added)210 2364 A
(env_parse,)420 2616 A
(env_prefix,)462 3078 A
(env_panic)378 3582 A
6975 V
(03413)210 1122 A
1482(*)S
(Jul)126 1776 A
(13,)126 1944 A
(2004:)210 2112 A
(added)210 2364 A
(fkey_ctl)336 2616 A
7065 V
(03414)210 1122 A
1482(*)S
(Apr)126 1776 A
(28,)126 1944 A
(2004:)210 2112 A
(added)210 2364 A
(report,)294 2616 A
(panic)210 2952 A
8418 V
EP
%%Page: 38 38
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(38)S
11 R
2254(File:)S
(include/minix/sysutil.h)1019 2487 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(03415)210 1122 A
1482(*)S
(Mar)126 1776 A
(31,)126 1944 A
(2004:)210 2112 A
(setup)210 2364 A
(like)168 2616 A
(other)210 2826 A
(libraries,)420 3078 A
(such)168 3540 A
3750(as)S
(syslib)252 3876 A
1845 V
(03416)210 1122 A
1482(*/)S
1935 V
(03417)210 1122 A
2025 V
(03418)210 1122 A
(/*==========================================================================*)3234 1440 A
2115 V
(03419)210 1122 A
1482(*)S
(Miscellaneous)546 1566 A
(helper)252 2154 A
(functions.)420 2448 A
2205 V
(03420)210 1122 A
(*==========================================================================*/)3234 1482 A
2295 V
(03421)210 1122 A
2385 V
(03422)210 1122 A
1440(/*)S
(Environment)462 1566 A
(parsing)294 2070 A
(return)252 2406 A
(values.)294 2700 A
3036(*/)S
2475 V
(03423)210 1122 A
(#define)294 1440 A
(EP_BUF_SIZE)462 1776 A
(128)126 2364 A
2784(/*)S
(local)210 2910 A
(buffer)252 3162 A
(for)126 3456 A
(env)126 3624 A
(value)210 3792 A
4044(*/)S
2565 V
(03424)210 1122 A
(#define)294 1440 A
(EP_UNSET)336 1776 A
2448(0)S
2784(/*)S
(variable)336 2910 A
(not)126 3288 A
(set)126 3456 A
3624(*/)S
2655 V
(03425)210 1122 A
(#define)294 1440 A
(EP_OFF)252 1776 A
2448(1)S
2784(/*)S
(var)126 2910 A
3078(=)S
(off)126 3162 A
3330(*/)S
2745 V
(03426)210 1122 A
(#define)294 1440 A
(EP_ON)210 1776 A
2448(2)S
2784(/*)S
(var)126 2910 A
3078(=)S
3162(on)S
(\(or)126 3288 A
(field)210 3456 A
(left)168 3708 A
(blank\))252 3918 A
4212(*/)S
2835 V
(03427)210 1122 A
(#define)294 1440 A
(EP_SET)252 1776 A
2448(3)S
2784(/*)S
(var)126 2910 A
3078(=)S
(1:2:3)210 3162 A
(\(nonblank)378 3414 A
(field\))252 3834 A
4128(*/)S
2925 V
(03428)210 1122 A
(#define)294 1440 A
(EP_EGETKENV)462 1776 A
2448(4)S
2784(/*)S
(sys_getkenv\(\))546 2910 A
(failed)252 3498 A
(...)126 3792 A
3960(*/)S
3015 V
(03429)210 1122 A
3105 V
(03430)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(env_setargs,)504 2154 A
(\(int)168 2700 A
(argc,)210 2910 A
(char)168 3162 A
(*argv[]\))336 3372 A
4464(\);)S
3195 V
(03431)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(env_get_param,)588 2112 A
(\(char)210 2742 A
(*key,)210 2994 A
(char)168 3246 A
(*value,)294 3456 A
(int)126 3792 A
(max_size\))378 3960 A
4464(\);)S
3285 V
(03432)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(env_prefix,)462 2112 A
(\(char)210 2616 A
(*env,)210 2868 A
(char)168 3120 A
(*prefix\))336 3330 A
4464(\);)S
3375 V
(03433)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(env_panic,)420 2154 A
(\(char)210 2616 A
(*key\))210 2868 A
4464(\);)S
3465 V
(03434)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(env_parse,)420 2112 A
(\(char)210 2574 A
(*env,)210 2826 A
(char)168 3078 A
(*fmt,)210 3288 A
(int)126 3540 A
(field,)252 3708 A
(long)168 4002 A
(*param,)294 4212 A
3555 V
(03435)210 1122 A
(long)168 2784 A
(min,)168 2994 A
(long)168 3204 A
(max\))168 3414 A
4464(\);)S
3645 V
(03436)210 1122 A
3735 V
(03437)210 1122 A
(#define)294 1440 A
(fkey_map\(fkeys,)630 1776 A
(sfkeys\))294 2448 A
(fkey_ctl\(FKEY_MAP,)756 2784 A
(\(fkeys\),)336 3582 A
(\(sfkeys\)\))378 3960 A
3825 V
(03438)210 1122 A
(#define)294 1440 A
(fkey_unmap\(fkeys,)714 1776 A
(sfkeys\))294 2532 A
(fkey_ctl\(FKEY_UNMAP,)840 2868 A
(\(fkeys\),)336 3750 A
(\(sfkeys\)\))378 4128 A
3915 V
(03439)210 1122 A
(#define)294 1440 A
(fkey_events\(fkeys,)756 1776 A
(sfkeys\))294 2574 A
(fkey_ctl\(FKEY_EVENTS,)882 2910 A
(\(fkeys\),)336 3834 A
(\(sfkeys\)\))378 4212 A
4005 V
(03440)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(fkey_ctl,)378 2112 A
(\(int)168 2532 A
(req,)168 2742 A
(int)126 2952 A
(*fkeys,)294 3120 A
(int)126 3456 A
(*sfkeys\))336 3624 A
4464(\);)S
4095 V
(03441)210 1122 A
4185 V
(03442)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(printf,)294 2112 A
(\(const)252 2448 A
(char)168 2742 A
(*fmt,)210 2952 A
(...\)\);)252 3204 A
4275 V
(03443)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(kputc,)252 2154 A
(\(int)168 2448 A
(c\)\);)168 2658 A
4365 V
(03444)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(report,)294 2154 A
(\(char)210 2490 A
(*who,)210 2742 A
(char)168 2994 A
(*mess,)252 3204 A
(int)126 3498 A
(num\)\);)252 3666 A
4455 V
(03445)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(panic,)252 2154 A
(\(char)210 2448 A
(*who,)210 2700 A
(char)168 2952 A
(*mess,)252 3162 A
(int)126 3456 A
(num\)\);)252 3624 A
4545 V
(03446)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(getuptime,)420 2112 A
(\(clock_t)336 2574 A
(*ticks\)\);)378 2952 A
4635 V
(03447)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(tickdelay,)420 2112 A
(\(clock_t)336 2574 A
(ticks\)\);)336 2952 A
4725 V
(03448)210 1122 A
4815 V
(03449)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_EXTRALIB_H)462 1860 A
2364(*/)S
4905 V
(03450)210 1122 A
5445 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5535 V
(include/minix/callnr.h)924 2676 A
5625 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5805 V
(03500)210 1122 A
(#define)294 1440 A
(NCALLS)252 1776 A
2532(91)S
2784(/*)S
(number)252 2910 A
3204(of)S
(system)252 3330 A
(calls)210 3624 A
(allowed)294 3876 A
4212(*/)S
5895 V
(03501)210 1122 A
5985 V
(03502)210 1122 A
(#define)294 1440 A
(EXIT)168 1776 A
2574(1)S
6075 V
(03503)210 1122 A
(#define)294 1440 A
(FORK)168 1776 A
2574(2)S
6165 V
(03504)210 1122 A
(#define)294 1440 A
(READ)168 1776 A
2574(3)S
6255 V
(03505)210 1122 A
(#define)294 1440 A
(WRITE)210 1776 A
2574(4)S
6345 V
(03506)210 1122 A
(#define)294 1440 A
(OPEN)168 1776 A
2574(5)S
6435 V
(03507)210 1122 A
(#define)294 1440 A
(CLOSE)210 1776 A
2574(6)S
6525 V
(03508)210 1122 A
(#define)294 1440 A
(WAIT)168 1776 A
2574(7)S
6615 V
(03509)210 1122 A
(#define)294 1440 A
(CREAT)210 1776 A
2574(8)S
6705 V
(03510)210 1122 A
(#define)294 1440 A
(LINK)168 1776 A
2574(9)S
6795 V
(03511)210 1122 A
(#define)294 1440 A
(UNLINK)252 1776 A
2532(10)S
6885 V
(03512)210 1122 A
(#define)294 1440 A
(WAITPID)294 1776 A
2532(11)S
6975 V
(03513)210 1122 A
(#define)294 1440 A
(CHDIR)210 1776 A
2532(12)S
7065 V
(03514)210 1122 A
(#define)294 1440 A
(TIME)168 1776 A
2532(13)S
8418 V
EP
%%Page: 39 39
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2271(File:)S
2504(include/minix/callnr.h)S
12 B
4560(39)S
1755 V
7 LST
(03515)210 1122 A
(#define)294 1440 A
(MKNOD)210 1776 A
2532(14)S
1845 V
(03516)210 1122 A
(#define)294 1440 A
(CHMOD)210 1776 A
2532(15)S
1935 V
(03517)210 1122 A
(#define)294 1440 A
(CHOWN)210 1776 A
2532(16)S
2025 V
(03518)210 1122 A
(#define)294 1440 A
(BRK)126 1776 A
2532(17)S
2115 V
(03519)210 1122 A
(#define)294 1440 A
(STAT)168 1776 A
2532(18)S
2205 V
(03520)210 1122 A
(#define)294 1440 A
(LSEEK)210 1776 A
2532(19)S
2295 V
(03521)210 1122 A
(#define)294 1440 A
(GETPID)252 1776 A
2532(20)S
2385 V
(03522)210 1122 A
(#define)294 1440 A
(MOUNT)210 1776 A
2532(21)S
2475 V
(03523)210 1122 A
(#define)294 1440 A
(UMOUNT)252 1776 A
2532(22)S
2565 V
(03524)210 1122 A
(#define)294 1440 A
(SETUID)252 1776 A
2532(23)S
2655 V
(03525)210 1122 A
(#define)294 1440 A
(GETUID)252 1776 A
2532(24)S
2745 V
(03526)210 1122 A
(#define)294 1440 A
(STIME)210 1776 A
2532(25)S
2835 V
(03527)210 1122 A
(#define)294 1440 A
(PTRACE)252 1776 A
2532(26)S
2925 V
(03528)210 1122 A
(#define)294 1440 A
(ALARM)210 1776 A
2532(27)S
3015 V
(03529)210 1122 A
(#define)294 1440 A
(FSTAT)210 1776 A
2532(28)S
3105 V
(03530)210 1122 A
(#define)294 1440 A
(PAUSE)210 1776 A
2532(29)S
3195 V
(03531)210 1122 A
(#define)294 1440 A
(UTIME)210 1776 A
2532(30)S
3285 V
(03532)210 1122 A
(#define)294 1440 A
(ACCESS)252 1776 A
2532(33)S
3375 V
(03533)210 1122 A
(#define)294 1440 A
(SYNC)168 1776 A
2532(36)S
3465 V
(03534)210 1122 A
(#define)294 1440 A
(KILL)168 1776 A
2532(37)S
3555 V
(03535)210 1122 A
(#define)294 1440 A
(RENAME)252 1776 A
2532(38)S
3645 V
(03536)210 1122 A
(#define)294 1440 A
(MKDIR)210 1776 A
2532(39)S
3735 V
(03537)210 1122 A
(#define)294 1440 A
(RMDIR)210 1776 A
2532(40)S
3825 V
(03538)210 1122 A
(#define)294 1440 A
(DUP)126 1776 A
2532(41)S
3915 V
(03539)210 1122 A
(#define)294 1440 A
(PIPE)168 1776 A
2532(42)S
4005 V
(03540)210 1122 A
(#define)294 1440 A
(TIMES)210 1776 A
2532(43)S
4095 V
(03541)210 1122 A
(#define)294 1440 A
(SETGID)252 1776 A
2532(46)S
4185 V
(03542)210 1122 A
(#define)294 1440 A
(GETGID)252 1776 A
2532(47)S
4275 V
(03543)210 1122 A
(#define)294 1440 A
(SIGNAL)252 1776 A
2532(48)S
4365 V
(03544)210 1122 A
(#define)294 1440 A
(IOCTL)210 1776 A
2532(54)S
4455 V
(03545)210 1122 A
(#define)294 1440 A
(FCNTL)210 1776 A
2532(55)S
4545 V
(03546)210 1122 A
(#define)294 1440 A
(EXEC)168 1776 A
2532(59)S
4635 V
(03547)210 1122 A
(#define)294 1440 A
(UMASK)210 1776 A
2532(60)S
4725 V
(03548)210 1122 A
(#define)294 1440 A
(CHROOT)252 1776 A
2532(61)S
4815 V
(03549)210 1122 A
(#define)294 1440 A
(SETSID)252 1776 A
2532(62)S
4905 V
(03550)210 1122 A
(#define)294 1440 A
(GETPGRP)294 1776 A
2532(63)S
4995 V
(03551)210 1122 A
5085 V
(03552)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(are)126 2154 A
(not)126 2322 A
(system)252 2490 A
(calls,)252 2784 A
(but)126 3078 A
(are)126 3246 A
(processed)378 3414 A
(like)168 3834 A
(them.)210 4044 A
4296(*/)S
5175 V
(03553)210 1122 A
(#define)294 1440 A
(UNPAUSE)294 1776 A
2532(65)S
2784(/*)S
2910(to)S
3036(MM)S
3162(or)S
(FS:)126 3288 A
(check)210 3456 A
(for)126 3708 A
(EINTR)210 3876 A
4128(*/)S
5265 V
(03554)210 1122 A
(#define)294 1440 A
(REVIVE)252 1776 A
2532(67)S
2784(/*)S
2910(to)S
(FS:)126 3036 A
(revive)252 3204 A
3498(a)S
(sleeping)336 3582 A
(process)294 3960 A
4296(*/)S
5355 V
(03555)210 1122 A
(#define)294 1440 A
(TASK_REPLY)420 1776 A
2532(68)S
2784(/*)S
2910(to)S
(FS:)126 3036 A
(reply)210 3204 A
(code)168 3456 A
(from)168 3666 A
(tty)126 3876 A
(task)168 4044 A
4254(*/)S
5445 V
(03556)210 1122 A
5535 V
(03557)210 1122 A
1440(/*)S
(Posix)210 1566 A
(signal)252 1818 A
(handling.)378 2112 A
2532(*/)S
5625 V
(03558)210 1122 A
(#define)294 1440 A
(SIGACTION)378 1776 A
2532(71)S
5715 V
(03559)210 1122 A
(#define)294 1440 A
(SIGSUSPEND)420 1776 A
2532(72)S
5805 V
(03560)210 1122 A
(#define)294 1440 A
(SIGPENDING)420 1776 A
2532(73)S
5895 V
(03561)210 1122 A
(#define)294 1440 A
(SIGPROCMASK)462 1776 A
2532(74)S
5985 V
(03562)210 1122 A
(#define)294 1440 A
(SIGRETURN)378 1776 A
2532(75)S
6075 V
(03563)210 1122 A
6165 V
(03564)210 1122 A
(#define)294 1440 A
(REBOOT)252 1776 A
2532(76)S
2784(/*)S
2910(to)S
3036(PM)S
3162(*/)S
6255 V
(03565)210 1122 A
6345 V
(03566)210 1122 A
1440(/*)S
(MINIX)210 1566 A
(specific)336 1818 A
(calls,)252 2196 A
(e.g.,)210 2490 A
2742(to)S
(support)294 2868 A
(system)252 3204 A
(services.)378 3498 A
3918(*/)S
6435 V
(03567)210 1122 A
(#define)294 1440 A
(SVRCTL)252 1776 A
2532(77)S
6525 V
(03568)210 1122 A
2784(/*)S
(unused)252 2910 A
3204(*/)S
6615 V
(03569)210 1122 A
(#define)294 1440 A
(GETSYSINFO)420 1776 A
2532(79)S
2784(/*)S
2910(to)S
3036(PM)S
3162(or)S
3288(FS)S
3414(*/)S
6705 V
(03570)210 1122 A
(#define)294 1440 A
(GETPROCNR)378 1776 A
2532(80)S
2784(/*)S
2910(to)S
3036(PM)S
3162(*/)S
6795 V
(03571)210 1122 A
(#define)294 1440 A
(DEVCTL)252 1776 A
2532(81)S
2784(/*)S
2910(to)S
3036(FS)S
3162(*/)S
6885 V
(03572)210 1122 A
(#define)294 1440 A
(FSTATFS)294 1776 A
2532(82)S
2784(/*)S
2910(to)S
3036(FS)S
3162(*/)S
6975 V
(03573)210 1122 A
(#define)294 1440 A
(ALLOCMEM)336 1776 A
2532(83)S
2784(/*)S
2910(to)S
3036(PM)S
3162(*/)S
7065 V
(03574)210 1122 A
(#define)294 1440 A
(FREEMEM)294 1776 A
2532(84)S
2784(/*)S
2910(to)S
3036(PM)S
3162(*/)S
8418 V
EP
%%Page: 40 40
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(40)S
11 R
2271(File:)S
2504(include/minix/callnr.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(03575)210 1122 A
(#define)294 1440 A
(SELECT)252 1776 A
2532(85)S
2784(/*)S
2910(to)S
3036(FS)S
3162(*/)S
1845 V
(03576)210 1122 A
(#define)294 1440 A
(FCHDIR)252 1776 A
2532(86)S
2784(/*)S
2910(to)S
3036(FS)S
3162(*/)S
1935 V
(03577)210 1122 A
(#define)294 1440 A
(FSYNC)210 1776 A
2532(87)S
2784(/*)S
2910(to)S
3036(FS)S
3162(*/)S
2025 V
(03578)210 1122 A
(#define)294 1440 A
(GETPRIORITY)462 1776 A
2532(88)S
2784(/*)S
2910(to)S
3036(PM)S
3162(*/)S
2115 V
(03579)210 1122 A
(#define)294 1440 A
(SETPRIORITY)462 1776 A
2532(89)S
2784(/*)S
2910(to)S
3036(PM)S
3162(*/)S
2205 V
(03580)210 1122 A
(#define)294 1440 A
(GETTIMEOFDAY)504 1776 A
2532(90)S
2784(/*)S
2910(to)S
3036(PM)S
3162(*/)S
2745 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2835 V
(include/minix/com.h)798 2676 A
2925 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3105 V
(03600)210 1122 A
(#ifndef)294 1440 A
(_MINIX_COM_H)504 1776 A
3195 V
(03601)210 1122 A
(#define)294 1440 A
(_MINIX_COM_H)504 1776 A
3285 V
(03602)210 1122 A
3375 V
(03603)210 1122 A
(/*===========================================================================*)3276 1440 A
3465 V
(03604)210 1122 A
1482(*)S
(Magic)210 2784 A
(process)294 3036 A
(numbers)294 3372 A
4674(*)S
3555 V
(03605)210 1122 A
(*===========================================================================*/)3276 1482 A
3645 V
(03606)210 1122 A
3735 V
(03607)210 1122 A
(#define)294 1440 A
(ANY)126 1776 A
(0x7ace)252 2448 A
2784(/*)S
(used)168 2910 A
3120(to)S
(indicate)336 3246 A
('any)168 3624 A
(process')336 3834 A
4212(*/)S
3825 V
(03608)210 1122 A
(#define)294 1440 A
(NONE)168 1776 A
(0x6ace)252 2448 A
2784(/*)S
(used)168 2910 A
3120(to)S
(indicate)336 3246 A
('no)126 3624 A
(process)294 3792 A
4128(at)S
(all')168 4254 A
4464(*/)S
3915 V
(03609)210 1122 A
(#define)294 1440 A
(SELF)168 1776 A
(0x8ace)252 2448 A
2784(/*)S
(used)168 2910 A
3120(to)S
(indicate)336 3246 A
('own)168 3624 A
(process')336 3834 A
4212(*/)S
4005 V
(03610)210 1122 A
4095 V
(03611)210 1122 A
(/*===========================================================================*)3276 1440 A
4185 V
(03612)210 1122 A
1482(*)S
(Process)294 2112 A
(numbers)294 2448 A
2784(of)S
(processes)378 2910 A
3330(in)S
(the)126 3456 A
(system)252 3624 A
(image)210 3918 A
4674(*)S
4275 V
(03613)210 1122 A
(*===========================================================================*/)3276 1482 A
4365 V
(03614)210 1122 A
4455 V
(03615)210 1122 A
1440(/*)S
(The)126 1566 A
(values)252 1734 A
2028(of)S
(several)294 2154 A
(task)168 2490 A
(numbers)294 2700 A
(depend)252 3036 A
3330(on)S
(whether)294 3456 A
(they)168 3792 A
4002(or)S
(other)210 4128 A
(tasks)210 4380 A
4545 V
(03616)210 1122 A
1482(*)S
(are)126 1566 A
(enabled.)336 1734 A
(They)168 2112 A
(are)126 2322 A
(defined)294 2490 A
2826(as)S
(\(PREVIOUS_TASK)588 2952 A
3582(-)S
(ENABLE_TASK\))504 3666 A
4212(in)S
(general.)336 4338 A
4635 V
(03617)210 1122 A
1482(*)S
(ENABLE_TASK)462 1566 A
2070(is)S
(either)252 2196 A
2490(0)S
2574(or)S
2700(1,)S
2826(so)S
2952(a)S
(task)168 3036 A
(either)252 3246 A
(gets)168 3540 A
3750(a)S
(new)126 3834 A
(number,)294 4002 A
4338(or)S
(gets)168 4464 A
4725 V
(03618)210 1122 A
1482(*)S
(the)126 1566 A
(same)168 1734 A
(number)252 1944 A
2238(as)S
(the)126 2364 A
(previous)336 2532 A
(task)168 2910 A
(and)126 3120 A
3288(is)S
(further)294 3414 A
(unused.)294 3750 A
(Note)168 4086 A
(that)168 4296 A
(the)126 4506 A
4815 V
(03619)210 1122 A
1482(*)S
(order)210 1566 A
(should)252 1818 A
(correspond)420 2112 A
2574(to)S
(the)126 2700 A
(order)210 2868 A
3120(in)S
(the)126 3246 A
(task)168 3414 A
(table)210 3624 A
(defined)294 3876 A
4212(in)S
(table.c.)336 4338 A
4905 V
(03620)210 1122 A
1482(*/)S
4995 V
(03621)210 1122 A
5085 V
(03622)210 1122 A
1440(/*)S
(Kernel)252 1566 A
(tasks.)252 1860 A
(These)210 2154 A
(all)126 2406 A
(run)126 2574 A
2742(in)S
(the)126 2868 A
(same)168 3036 A
(address)294 3246 A
(space.)252 3582 A
3876(*/)S
5175 V
(03623)210 1122 A
(#define)294 1440 A
(IDLE)168 1776 A
2490(-4)S
2784(/*)S
(runs)168 2910 A
(when)168 3120 A
3330(no)S
(one)126 3456 A
(else)168 3624 A
(can)126 3834 A
(run)126 4002 A
4170(*/)S
5265 V
(03624)210 1122 A
(#define)294 1440 A
(CLOCK)210 1776 A
2490(-3)S
2784(/*)S
(alarms)252 2910 A
(and)126 3204 A
(other)210 3372 A
(clock)210 3624 A
(functions)378 3876 A
4296(*/)S
5355 V
(03625)210 1122 A
(#define)294 1440 A
(SYSTEM)252 1776 A
2490(-2)S
2784(/*)S
(request)294 2910 A
(system)252 3246 A
(functionality)546 3540 A
4128(*/)S
5445 V
(03626)210 1122 A
(#define)294 1440 A
(KERNEL)252 1776 A
2490(-1)S
2784(/*)S
(pseudo-process)588 2910 A
(for)126 3540 A
(IPC)126 3708 A
(and)126 3876 A
(scheduling)420 4044 A
4506(*/)S
5535 V
(03627)210 1122 A
(#define)294 1440 A
(HARDWARE)336 1776 A
(KERNEL)252 2322 A
2784(/*)S
(for)126 2910 A
(hardware)336 3078 A
(interrupt)378 3456 A
(handlers)336 3876 A
4254(*/)S
5625 V
(03628)210 1122 A
5715 V
(03629)210 1122 A
1440(/*)S
(Number)252 1566 A
1860(of)S
(tasks.)252 1986 A
(Note)168 2280 A
(that)168 2490 A
(NR_PROCS)336 2700 A
3078(is)S
(defined)294 3204 A
3540(in)S
(<minix/config.h>.)714 3666 A
4422(*/)S
5805 V
(03630)210 1122 A
(#define)294 1440 A
(NR_TASKS)336 1776 A
2532(4)S
5895 V
(03631)210 1122 A
5985 V
(03632)210 1122 A
1440(/*)S
(User-space)420 1566 A
(processes,)420 2028 A
(that)168 2490 A
(is,)126 2700 A
(device)252 2868 A
(drivers,)336 3162 A
(servers,)336 3540 A
(and)126 3918 A
(INIT.)210 4086 A
4338(*/)S
6075 V
(03633)210 1122 A
(#define)294 1440 A
(PM_PROC_NR)420 1776 A
2532(0)S
2784(/*)S
(process)294 2910 A
(manager)294 3246 A
3582(*/)S
6165 V
(03634)210 1122 A
(#define)294 1440 A
(FS_PROC_NR)420 1776 A
2532(1)S
2784(/*)S
(file)168 2910 A
(system)252 3120 A
3414(*/)S
6255 V
(03635)210 1122 A
(#define)294 1440 A
(RS_PROC_NR)420 1776 A
2532(2)S
2784(/*)S
(reincarnation)546 2910 A
(server)252 3498 A
3792(*/)S
6345 V
(03636)210 1122 A
(#define)294 1440 A
(MEM_PROC_NR)462 1776 A
2532(3)S
2784(/*)S
(memory)252 2910 A
(driver)252 3204 A
(\(RAM)168 3498 A
(disk,)210 3708 A
(null,)210 3960 A
(etc.\))210 4212 A
4464(*/)S
6435 V
(03637)210 1122 A
(#define)294 1440 A
(LOG_PROC_NR)462 1776 A
2532(4)S
2784(/*)S
(log)126 2910 A
(device)252 3078 A
(driver)252 3372 A
3666(*/)S
6525 V
(03638)210 1122 A
(#define)294 1440 A
(TTY_PROC_NR)462 1776 A
2532(5)S
2784(/*)S
(terminal)336 2910 A
(\(TTY\))210 3288 A
(driver)252 3540 A
3834(*/)S
6615 V
(03639)210 1122 A
(#define)294 1440 A
(DRVR_PROC_NR)504 1776 A
2532(6)S
2784(/*)S
(device)252 2910 A
(driver)252 3204 A
(for)126 3498 A
(boot)168 3666 A
(medium)252 3876 A
4170(*/)S
6705 V
(03640)210 1122 A
(#define)294 1440 A
(INIT_PROC_NR)504 1776 A
2532(7)S
2784(/*)S
(init)168 2910 A
3120(--)S
(goes)168 3246 A
(multiuser)378 3456 A
3876(*/)S
6795 V
(03641)210 1122 A
6885 V
(03642)210 1122 A
1440(/*)S
(Number)252 1566 A
1860(of)S
(processes)378 1986 A
(contained)378 2406 A
2826(in)S
(the)126 2952 A
(system)252 3120 A
(image.)252 3414 A
3708(*/)S
6975 V
(03643)210 1122 A
(#define)294 1440 A
(NR_BOOT_PROCS)546 1776 A
(\(NR_TASKS)378 2448 A
2868(+)S
(INIT_PROC_NR)504 2952 A
3498(+)S
3582(1\))S
7065 V
(03644)210 1122 A
8418 V
EP
%%Page: 41 41
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2303(File:)S
2536(include/minix/com.h)S
12 B
4560(41)S
1755 V
7 LST
(03645)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(03646)210 1122 A
1482(*)S
(Kernel)252 2574 A
(notification)504 2868 A
(types)210 3414 A
4674(*)S
1935 V
(03647)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(03648)210 1122 A
2115 V
(03649)210 1122 A
1440(/*)S
(Kernel)252 1566 A
(notification)504 1860 A
(types.)252 2406 A
2700(In)S
(principle,)420 2826 A
(these)210 3288 A
(can)126 3540 A
3708(be)S
(sent)168 3834 A
4044(to)S
(any)126 4170 A
(process,)336 4338 A
2205 V
(03650)210 1122 A
1482(*)S
1566(so)S
(make)168 1692 A
(sure)168 1902 A
(that)168 2112 A
(these)210 2322 A
(types)210 2574 A
2826(do)S
(not)126 2952 A
(interfere)378 3120 A
(with)168 3540 A
(other)210 3750 A
(message)294 4002 A
(types.)252 4338 A
2295 V
(03651)210 1122 A
1482(*)S
(Notifications)546 1566 A
(are)126 2154 A
(prioritized)462 2322 A
(because)294 2826 A
3162(of)S
(the)126 3288 A
(way)126 3456 A
(they)168 3624 A
(are)126 3834 A
(unhold\(\))336 4002 A
(and)126 4380 A
2385 V
(03652)210 1122 A
1482(*)S
(blocking)336 1566 A
(notifications)546 1944 A
(are)126 2532 A
(delivered.)420 2700 A
(The)126 3162 A
(lowest)252 3330 A
(numbers)294 3624 A
3960(go)S
(first.)252 4086 A
(The)126 4380 A
2475 V
(03653)210 1122 A
1482(*)S
(offset)252 1566 A
(are)126 1860 A
(used)168 2028 A
(for)126 2238 A
(the)126 2406 A
(per-process)462 2574 A
(notification)504 3078 A
(bit)126 3624 A
(maps.)210 3792 A
2565 V
(03654)210 1122 A
1482(*/)S
2655 V
(03655)210 1122 A
(#define)294 1440 A
(NOTIFY_MESSAGE)588 1776 A
(0x1000)252 2868 A
2745 V
(03656)210 1122 A
(#define)294 1440 A
(NOTIFY_FROM\(p_nr\))714 1776 A
(\(NOTIFY_MESSAGE)630 2826 A
3498(|)S
(\(\(p_nr\))294 3582 A
3918(+)S
(NR_TASKS\)\))420 4002 A
2835 V
(03657)210 1122 A
1440(#)S
(define)252 1566 A
(SYN_ALARM)378 1860 A
(NOTIFY_FROM\(CLOCK\))756 2448 A
3456(/*)S
(synchronous)462 3582 A
(alarm)210 4086 A
4338(*/)S
2925 V
(03658)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_SIG)294 1860 A
(NOTIFY_FROM\(SYSTEM\))798 2448 A
3456(/*)S
(system)252 3582 A
(signal)252 3876 A
4170(*/)S
3015 V
(03659)210 1122 A
1440(#)S
(define)252 1566 A
(HARD_INT)336 1860 A
(NOTIFY_FROM\(HARDWARE\))882 2448 A
3456(/*)S
(hardware)336 3582 A
(interrupt)378 3960 A
4380(*/)S
3105 V
(03660)210 1122 A
1440(#)S
(define)252 1566 A
(NEW_KSIG)336 1860 A
(NOTIFY_FROM\(HARDWARE\))882 2448 A
3456(/*)S
(new)126 3582 A
(kernel)252 3750 A
(signal)252 4044 A
4338(*/)S
3195 V
(03661)210 1122 A
1440(#)S
(define)252 1566 A
(FKEY_PRESSED)504 1860 A
(NOTIFY_FROM\(TTY_PROC_NR\)/*)1092 2448 A
(function)336 3582 A
(key)126 3960 A
(press)210 4128 A
4380(*/)S
3285 V
(03662)210 1122 A
3375 V
(03663)210 1122 A
1440(/*)S
(Shorthands)420 1566 A
(for)126 2028 A
(message)294 2196 A
(parameters)420 2532 A
(passed)252 2994 A
(with)168 3288 A
(notifications.)588 3498 A
4128(*/)S
3465 V
(03664)210 1122 A
(#define)294 1440 A
(NOTIFY_SOURCE)546 1776 A
(m_source)336 2784 A
3555 V
(03665)210 1122 A
(#define)294 1440 A
(NOTIFY_TYPE)462 1776 A
(m_type)252 2784 A
3645 V
(03666)210 1122 A
(#define)294 1440 A
(NOTIFY_ARG)420 1776 A
(m2_l1)210 2784 A
3735 V
(03667)210 1122 A
(#define)294 1440 A
(NOTIFY_TIMESTAMP)672 1776 A
(m2_l2)210 2784 A
3825 V
(03668)210 1122 A
(#define)294 1440 A
(NOTIFY_FLAGS)504 1776 A
(m2_i1)210 2784 A
3915 V
(03669)210 1122 A
4005 V
(03670)210 1122 A
(/*===========================================================================*)3276 1440 A
4095 V
(03671)210 1122 A
1482(*)S
(Messages)336 2196 A
(for)126 2574 A
(BLOCK)210 2742 A
(and)126 2994 A
(CHARACTER)378 3162 A
(device)252 3582 A
(drivers)294 3876 A
4674(*)S
4185 V
(03672)210 1122 A
(*===========================================================================*/)3276 1482 A
4275 V
(03673)210 1122 A
4365 V
(03674)210 1122 A
1440(/*)S
(Message)294 1566 A
(types)210 1902 A
(for)126 2154 A
(device)252 2322 A
(drivers.)336 2616 A
2994(*/)S
4455 V
(03675)210 1122 A
(#define)294 1440 A
(DEV_RQ_BASE)462 1776 A
(0x400)210 2364 A
2784(/*)S
(base)168 2910 A
(for)126 3120 A
(device)252 3288 A
(request)294 3582 A
(types)210 3918 A
4170(*/)S
4545 V
(03676)210 1122 A
(#define)294 1440 A
(DEV_RS_BASE)462 1776 A
(0x500)210 2364 A
2784(/*)S
(base)168 2910 A
(for)126 3120 A
(device)252 3288 A
(response)336 3582 A
(types)210 3960 A
4212(*/)S
4635 V
(03677)210 1122 A
4725 V
(03678)210 1122 A
(#define)294 1440 A
(CANCEL)252 1776 A
(\(DEV_RQ_BASE)504 2448 A
2994(+)S
3120(0\))S
3246(/*)S
(general)294 3372 A
(req)126 3708 A
3876(to)S
(force)210 4002 A
4254(a)S
(task)168 4338 A
4548(to)S
(cancel)252 4674 A
4968(*/)S
4815 V
(03679)210 1122 A
(#define)294 1440 A
(DEV_READ)336 1776 A
(\(DEV_RQ_BASE)504 2448 A
2994(+)S
3120(3\))S
3246(/*)S
(read)168 3372 A
(from)168 3582 A
(minor)210 3792 A
(device)252 4044 A
4338(*/)S
4905 V
(03680)210 1122 A
(#define)294 1440 A
(DEV_WRITE)378 1776 A
(\(DEV_RQ_BASE)504 2448 A
2994(+)S
3120(4\))S
3246(/*)S
(write)210 3372 A
3624(to)S
(minor)210 3750 A
(device)252 4002 A
4296(*/)S
4995 V
(03681)210 1122 A
(#define)294 1440 A
(DEV_IOCTL)378 1776 A
(\(DEV_RQ_BASE)504 2448 A
2994(+)S
3120(5\))S
3246(/*)S
(I/O)126 3372 A
(control)294 3540 A
(code)168 3876 A
4086(*/)S
5085 V
(03682)210 1122 A
(#define)294 1440 A
(DEV_OPEN)336 1776 A
(\(DEV_RQ_BASE)504 2448 A
2994(+)S
3120(6\))S
3246(/*)S
(open)168 3372 A
3582(a)S
(minor)210 3666 A
(device)252 3918 A
4212(*/)S
5175 V
(03683)210 1122 A
(#define)294 1440 A
(DEV_CLOSE)378 1776 A
(\(DEV_RQ_BASE)504 2448 A
2994(+)S
3120(7\))S
3246(/*)S
(close)210 3372 A
3624(a)S
(minor)210 3708 A
(device)252 3960 A
4254(*/)S
5265 V
(03684)210 1122 A
(#define)294 1440 A
(DEV_SCATTER)462 1776 A
(\(DEV_RQ_BASE)504 2448 A
2994(+)S
3120(8\))S
3246(/*)S
(write)210 3372 A
(from)168 3624 A
3834(a)S
(vector)252 3918 A
4212(*/)S
5355 V
(03685)210 1122 A
(#define)294 1440 A
(DEV_GATHER)420 1776 A
(\(DEV_RQ_BASE)504 2448 A
2994(+)S
3120(9\))S
3246(/*)S
(read)168 3372 A
(into)168 3582 A
3792(a)S
(vector)252 3876 A
4170(*/)S
5445 V
(03686)210 1122 A
(#define)294 1440 A
(TTY_SETPGRP)462 1776 A
(\(DEV_RQ_BASE)504 2448 A
2994(+)S
(10\))126 3078 A
3246(/*)S
(set)126 3372 A
(process)294 3540 A
(group)210 3876 A
4128(*/)S
5535 V
(03687)210 1122 A
(#define)294 1440 A
(TTY_EXIT)336 1776 A
(\(DEV_RQ_BASE)504 2448 A
2994(+)S
(11\))126 3078 A
3246(/*)S
(process)294 3372 A
(group)210 3708 A
(leader)252 3960 A
(exited)252 4254 A
4548(*/)S
5625 V
(03688)210 1122 A
(#define)294 1440 A
(DEV_SELECT)420 1776 A
(\(DEV_RQ_BASE)504 2448 A
2994(+)S
(12\))126 3078 A
3246(/*)S
(request)294 3372 A
(select\(\))336 3708 A
(attention)378 4086 A
4506(*/)S
5715 V
(03689)210 1122 A
(#define)294 1440 A
(DEV_STATUS)420 1776 A
(\(DEV_RQ_BASE)504 2448 A
2994(+)S
(13\))126 3078 A
3246(/*)S
(request)294 3372 A
(driver)252 3708 A
(status)252 4002 A
4296(*/)S
5805 V
(03690)210 1122 A
5895 V
(03691)210 1122 A
(#define)294 1440 A
(DEV_REPLY)378 1776 A
(\(DEV_RS_BASE)504 2448 A
2994(+)S
3078(0\))S
3204(/*)S
(general)294 3330 A
(task)168 3666 A
(reply)210 3876 A
4128(*/)S
5985 V
(03692)210 1122 A
(#define)294 1440 A
(DEV_CLONED)420 1776 A
(\(DEV_RS_BASE)504 2448 A
2994(+)S
3078(1\))S
3204(/*)S
(return)252 3330 A
(cloned)252 3624 A
(minor)210 3918 A
4170(*/)S
6075 V
(03693)210 1122 A
(#define)294 1440 A
(DEV_REVIVE)420 1776 A
(\(DEV_RS_BASE)504 2448 A
2994(+)S
3078(2\))S
3204(/*)S
(driver)252 3330 A
(revives)294 3624 A
(process)294 3960 A
4296(*/)S
6165 V
(03694)210 1122 A
(#define)294 1440 A
(DEV_IO_READY)504 1776 A
(\(DEV_RS_BASE)504 2448 A
2994(+)S
3078(3\))S
3204(/*)S
(selected)336 3330 A
(device)252 3708 A
(ready)210 4002 A
4254(*/)S
6255 V
(03695)210 1122 A
(#define)294 1440 A
(DEV_NO_STATUS)546 1776 A
(\(DEV_RS_BASE)504 2448 A
2994(+)S
3078(4\))S
3204(/*)S
(empty)210 3330 A
(status)252 3582 A
(reply)210 3876 A
4128(*/)S
6345 V
(03696)210 1122 A
6435 V
(03697)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(messages)336 2238 A
2616(to)S
(block)210 2742 A
(and)126 2994 A
(character)378 3162 A
(device)252 3582 A
(drivers.)336 3876 A
4254(*/)S
6525 V
(03698)210 1122 A
(#define)294 1440 A
(DEVICE)252 1776 A
(m2_i1)210 2448 A
2784(/*)S
(major-minor)462 2910 A
(device)252 3414 A
3708(*/)S
6615 V
(03699)210 1122 A
(#define)294 1440 A
(PROC_NR)294 1776 A
(m2_i2)210 2448 A
2784(/*)S
(which)210 2910 A
(\(proc\))252 3162 A
(wants)210 3456 A
(I/O?)168 3708 A
3918(*/)S
6705 V
(03700)210 1122 A
(#define)294 1440 A
(COUNT)210 1776 A
(m2_i3)210 2448 A
2784(/*)S
(how)126 2910 A
(many)168 3078 A
(bytes)210 3288 A
3540(to)S
(transfer)336 3666 A
4044(*/)S
6795 V
(03701)210 1122 A
(#define)294 1440 A
(REQUEST)294 1776 A
(m2_i3)210 2448 A
2784(/*)S
(ioctl)210 2910 A
(request)294 3162 A
(code)168 3498 A
3708(*/)S
6885 V
(03702)210 1122 A
(#define)294 1440 A
(POSITION)336 1776 A
(m2_l1)210 2448 A
2784(/*)S
(file)168 2910 A
(offset)252 3120 A
3414(*/)S
6975 V
(03703)210 1122 A
(#define)294 1440 A
(ADDRESS)294 1776 A
(m2_p1)210 2448 A
2784(/*)S
(core)168 2910 A
(buffer)252 3120 A
(address)294 3414 A
3750(*/)S
7065 V
(03704)210 1122 A
8418 V
EP
%%Page: 42 42
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(42)S
11 R
2303(File:)S
2536(include/minix/com.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(03705)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(DEV_SELECT)420 2238 A
(messages)336 2700 A
3078(to)S
(device)252 3204 A
(drivers.)336 3498 A
3876(*/)S
1845 V
(03706)210 1122 A
(#define)294 1440 A
(DEV_MINOR)378 1776 A
(m2_i1)210 2448 A
2784(/*)S
(minor)210 2910 A
(device)252 3162 A
3456(*/)S
1935 V
(03707)210 1122 A
(#define)294 1440 A
(DEV_SEL_OPS)462 1776 A
(m2_i2)210 2448 A
2784(/*)S
(which)210 2910 A
(select)252 3162 A
(operations)420 3456 A
(are)126 3918 A
(requested)378 4086 A
4506(*/)S
2025 V
(03708)210 1122 A
(#define)294 1440 A
(DEV_SEL_WATCH)546 1776 A
(m2_i3)210 2448 A
2784(/*)S
(request)294 2910 A
(notify)252 3246 A
3540(if)S
3666(no)S
(operations)420 3792 A
(are)126 4254 A
(ready)210 4422 A
4674(*/)S
2115 V
(03709)210 1122 A
2205 V
(03710)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(used)168 2070 A
2280(in)S
(reply)210 2406 A
(messages)336 2658 A
(from)168 3036 A
(tasks.)252 3246 A
3540(*/)S
2295 V
(03711)210 1122 A
(#define)294 1440 A
(REP_PROC_NR)462 1776 A
(m2_i1)210 2448 A
2784(/*)S
2910(#)S
2994(of)S
(proc)168 3120 A
3330(on)S
(whose)210 3456 A
(behalf)252 3708 A
(I/O)126 4002 A
(was)126 4170 A
(done)168 4338 A
4548(*/)S
2385 V
(03712)210 1122 A
(#define)294 1440 A
(REP_STATUS)420 1776 A
(m2_i2)210 2448 A
2784(/*)S
(bytes)210 2910 A
(transferred)462 3162 A
3666(or)S
(error)210 3792 A
(number)252 4044 A
4338(*/)S
2475 V
(03713)210 1122 A
1440(#)S
(define)252 1566 A
(SUSPEND)294 1860 A
(-998)168 2490 A
2784(/*)S
(status)252 2910 A
3204(to)S
(suspend)294 3330 A
(caller,)294 3666 A
(reply)210 4002 A
(later)210 4254 A
4506(*/)S
2565 V
(03714)210 1122 A
2655 V
(03715)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(messages)336 2238 A
2616(to)S
(TTY)126 2742 A
(driver.)294 2910 A
3246(*/)S
2745 V
(03716)210 1122 A
(#define)294 1440 A
(TTY_LINE)336 1776 A
(DEVICE)252 2448 A
2784(/*)S
(message)294 2910 A
(parameter:)420 3246 A
(terminal)336 3708 A
(line)168 4086 A
4296(*/)S
2835 V
(03717)210 1122 A
(#define)294 1440 A
(TTY_REQUEST)462 1776 A
(COUNT)210 2448 A
2784(/*)S
(message)294 2910 A
(parameter:)420 3246 A
(ioctl)210 3708 A
(request)294 3960 A
(code)168 4296 A
4506(*/)S
2925 V
(03718)210 1122 A
(#define)294 1440 A
(TTY_SPEK)336 1776 A
(POSITION/*)420 2448 A
(message)294 2910 A
(parameter:)420 3246 A
(ioctl)210 3708 A
(speed,)252 3960 A
(erasing)294 4254 A
4590(*/)S
3015 V
(03719)210 1122 A
(#define)294 1440 A
(TTY_FLAGS)378 1776 A
(m2_l2)210 2448 A
2784(/*)S
(message)294 2910 A
(parameter:)420 3246 A
(ioctl)210 3708 A
(tty)126 3960 A
(mode)168 4128 A
4338(*/)S
3105 V
(03720)210 1122 A
(#define)294 1440 A
(TTY_PGRP)336 1776 A
(m2_i3)210 2448 A
2784(/*)S
(message)294 2910 A
(parameter:)420 3246 A
(process)294 3708 A
(group)210 4044 A
4296(*/)S
3195 V
(03721)210 1122 A
3285 V
(03722)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(the)126 2238 A
(QIC)126 2406 A
2574(02)S
(status)252 2700 A
(reply)210 2994 A
(from)168 3246 A
(tape)168 3456 A
(driver)252 3666 A
3960(*/)S
3375 V
(03723)210 1122 A
(#define)294 1440 A
(TAPE_STAT0)420 1776 A
(m2_l1)210 2448 A
3465 V
(03724)210 1122 A
(#define)294 1440 A
(TAPE_STAT1)420 1776 A
(m2_l2)210 2448 A
3555 V
(03725)210 1122 A
3645 V
(03726)210 1122 A
(/*===========================================================================*)3276 1440 A
3735 V
(03727)210 1122 A
1482(*)S
(Messages)336 2574 A
(for)126 2952 A
(networking)420 3120 A
(layer)210 3582 A
4674(*)S
3825 V
(03728)210 1122 A
(*===========================================================================*/)3276 1482 A
3915 V
(03729)210 1122 A
4005 V
(03730)210 1122 A
1440(/*)S
(Message)294 1566 A
(types)210 1902 A
(for)126 2154 A
(network)294 2322 A
(layer)210 2658 A
(requests.)378 2910 A
(This)168 3330 A
(layer)210 3540 A
(acts)168 3792 A
(like)168 4002 A
4212(a)S
(driver.)294 4296 A
4632(*/)S
4095 V
(03731)210 1122 A
(#define)294 1440 A
(NW_OPEN)294 1776 A
(DEV_OPEN)336 2448 A
4185 V
(03732)210 1122 A
(#define)294 1440 A
(NW_CLOSE)336 1776 A
(DEV_CLOSE)378 2448 A
4275 V
(03733)210 1122 A
(#define)294 1440 A
(NW_READ)294 1776 A
(DEV_READ)336 2448 A
4365 V
(03734)210 1122 A
(#define)294 1440 A
(NW_WRITE)336 1776 A
(DEV_WRITE)378 2448 A
4455 V
(03735)210 1122 A
(#define)294 1440 A
(NW_IOCTL)336 1776 A
(DEV_IOCTL)378 2448 A
4545 V
(03736)210 1122 A
(#define)294 1440 A
(NW_CANCEL)378 1776 A
(CANCEL)252 2448 A
4635 V
(03737)210 1122 A
4725 V
(03738)210 1122 A
1440(/*)S
(Base)168 1566 A
(type)168 1776 A
(for)126 1986 A
(data)168 2154 A
(link)168 2364 A
(layer)210 2574 A
(requests)336 2826 A
(and)126 3204 A
(responses.)420 3372 A
3834(*/)S
4815 V
(03739)210 1122 A
(#define)294 1440 A
(DL_RQ_BASE)420 1776 A
(0x800)210 2448 A
4905 V
(03740)210 1122 A
(#define)294 1440 A
(DL_RS_BASE)420 1776 A
(0x900)210 2448 A
4995 V
(03741)210 1122 A
5085 V
(03742)210 1122 A
1440(/*)S
(Message)294 1566 A
(types)210 1902 A
(for)126 2154 A
(data)168 2322 A
(link)168 2532 A
(layer)210 2742 A
(requests.)378 2994 A
3414(*/)S
5175 V
(03743)210 1122 A
(#define)294 1440 A
(DL_WRITE)336 1776 A
(\(DL_RQ_BASE)462 2448 A
2952(+)S
3036(3\))S
5265 V
(03744)210 1122 A
(#define)294 1440 A
(DL_WRITEV)378 1776 A
(\(DL_RQ_BASE)462 2448 A
2952(+)S
3036(4\))S
5355 V
(03745)210 1122 A
(#define)294 1440 A
(DL_READ)294 1776 A
(\(DL_RQ_BASE)462 2448 A
2952(+)S
3036(5\))S
5445 V
(03746)210 1122 A
(#define)294 1440 A
(DL_READV)336 1776 A
(\(DL_RQ_BASE)462 2448 A
2952(+)S
3036(6\))S
5535 V
(03747)210 1122 A
(#define)294 1440 A
(DL_INIT)294 1776 A
(\(DL_RQ_BASE)462 2448 A
2952(+)S
3036(7\))S
5625 V
(03748)210 1122 A
(#define)294 1440 A
(DL_STOP)294 1776 A
(\(DL_RQ_BASE)462 2448 A
2952(+)S
3036(8\))S
5715 V
(03749)210 1122 A
(#define)294 1440 A
(DL_GETSTAT)420 1776 A
(\(DL_RQ_BASE)462 2448 A
2952(+)S
3036(9\))S
5805 V
(03750)210 1122 A
5895 V
(03751)210 1122 A
1440(/*)S
(Message)294 1566 A
(type)168 1902 A
(for)126 2112 A
(data)168 2280 A
(link)168 2490 A
(layer)210 2700 A
(replies.)336 2952 A
3330(*/)S
5985 V
(03752)210 1122 A
(#define)294 1440 A
(DL_INIT_REPLY)546 1776 A
(\(DL_RS_BASE)462 2448 A
2952(+)S
(20\))126 3036 A
6075 V
(03753)210 1122 A
(#define)294 1440 A
(DL_TASK_REPLY)546 1776 A
(\(DL_RS_BASE)462 2448 A
2952(+)S
(21\))126 3036 A
6165 V
(03754)210 1122 A
6255 V
(03755)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(data)168 2238 A
(link)168 2448 A
(layer)210 2658 A
(messages.)378 2910 A
3330(*/)S
6345 V
(03756)210 1122 A
(#define)294 1440 A
(DL_PORT)294 1776 A
(m2_i1)210 2448 A
6435 V
(03757)210 1122 A
(#define)294 1440 A
(DL_PROC)294 1776 A
(m2_i2)210 2448 A
6525 V
(03758)210 1122 A
(#define)294 1440 A
(DL_COUNT)336 1776 A
(m2_i3)210 2448 A
6615 V
(03759)210 1122 A
(#define)294 1440 A
(DL_MODE)294 1776 A
(m2_l1)210 2448 A
6705 V
(03760)210 1122 A
(#define)294 1440 A
(DL_CLCK)294 1776 A
(m2_l2)210 2448 A
6795 V
(03761)210 1122 A
(#define)294 1440 A
(DL_ADDR)294 1776 A
(m2_p1)210 2448 A
6885 V
(03762)210 1122 A
(#define)294 1440 A
(DL_STAT)294 1776 A
(m2_l1)210 2448 A
6975 V
(03763)210 1122 A
7065 V
(03764)210 1122 A
1440(/*)S
(Bits)168 1566 A
1776(in)S
('DL_STAT')378 1902 A
(field)210 2322 A
2574(of)S
2700(DL)S
(replies.)336 2826 A
3204(*/)S
8418 V
EP
%%Page: 43 43
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2303(File:)S
2536(include/minix/com.h)S
12 B
4560(43)S
1755 V
7 LST
(03765)210 1122 A
1440(#)S
(define)252 1566 A
(DL_PACK_SEND)504 1860 A
(0x01)168 2784 A
1845 V
(03766)210 1122 A
1440(#)S
(define)252 1566 A
(DL_PACK_RECV)504 1860 A
(0x02)168 2784 A
1935 V
(03767)210 1122 A
1440(#)S
(define)252 1566 A
(DL_READ_IP)420 1860 A
(0x04)168 2784 A
2025 V
(03768)210 1122 A
2115 V
(03769)210 1122 A
1440(/*)S
(Bits)168 1566 A
1776(in)S
('DL_MODE')378 1902 A
(field)210 2322 A
2574(of)S
2700(DL)S
(requests.)378 2826 A
3246(*/)S
2205 V
(03770)210 1122 A
1440(#)S
(define)252 1566 A
(DL_NOMODE)378 1860 A
(0x0)126 2784 A
2295 V
(03771)210 1122 A
1440(#)S
(define)252 1566 A
(DL_PROMISC_REQ)588 1860 A
(0x2)126 2784 A
2385 V
(03772)210 1122 A
1440(#)S
(define)252 1566 A
(DL_MULTI_REQ)504 1860 A
(0x4)126 2784 A
2475 V
(03773)210 1122 A
1440(#)S
(define)252 1566 A
(DL_BROAD_REQ)504 1860 A
(0x8)126 2784 A
2565 V
(03774)210 1122 A
2655 V
(03775)210 1122 A
(/*===========================================================================*)3276 1440 A
2745 V
(03776)210 1122 A
1482(*)S
(SYSTASK)294 2280 A
(request)294 2616 A
(types)210 2952 A
(and)126 3204 A
(field)210 3372 A
(names)210 3624 A
4674(*)S
2835 V
(03777)210 1122 A
(*===========================================================================*/)3276 1482 A
2925 V
(03778)210 1122 A
3015 V
(03779)210 1122 A
1440(/*)S
(System)252 1566 A
(library)294 1860 A
(calls)210 2196 A
(are)126 2448 A
(dispatched)420 2616 A
(via)126 3078 A
3246(a)S
(call)168 3330 A
(vector,)294 3540 A
3876(so)S
4002(be)S
(careful)294 4128 A
(when)168 4464 A
3105 V
(03780)210 1122 A
1482(*)S
(modifying)378 1566 A
(the)126 1986 A
(system)252 2154 A
(call)168 2448 A
(numbers.)336 2658 A
(The)126 3036 A
(numbers)294 3204 A
(here)168 3540 A
(determine)378 3750 A
(which)210 4170 A
(call)168 4422 A
3195 V
(03781)210 1122 A
1482(*)S
1566(is)S
(made)168 1692 A
(from)168 1902 A
(the)126 2112 A
(call)168 2280 A
(vector.)294 2490 A
3285 V
(03782)210 1122 A
1482(*/)S
3375 V
(03783)210 1122 A
(#define)294 1440 A
(KERNEL_CALL)462 1776 A
(0x600)210 2448 A
2784(/*)S
(base)168 2910 A
(for)126 3120 A
(kernel)252 3288 A
(calls)210 3582 A
3834(to)S
(SYSTEM)252 3960 A
4254(*/)S
3465 V
(03784)210 1122 A
3555 V
(03785)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_FORK)336 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
3120(0\))S
3456(/*)S
(sys_fork\(\))420 3582 A
4044(*/)S
3645 V
(03786)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_EXEC)336 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
3120(1\))S
3456(/*)S
(sys_exec\(\))420 3582 A
4044(*/)S
3735 V
(03787)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_EXIT)336 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
3120(2\))S
3456(/*)S
(sys_exit\(\))420 3582 A
4044(*/)S
3825 V
(03788)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_NICE)336 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
3120(3\))S
3456(/*)S
(sys_nice\(\))420 3582 A
4044(*/)S
3915 V
(03789)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_PRIVCTL)462 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
3120(4\))S
3456(/*)S
(sys_privctl\(\))546 3582 A
4170(*/)S
4005 V
(03790)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_TRACE)378 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
3120(5\))S
3456(/*)S
(sys_trace\(\))462 3582 A
4086(*/)S
4095 V
(03791)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_KILL)336 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
3120(6\))S
3456(/*)S
(sys_kill\(\))420 3582 A
4044(*/)S
4185 V
(03792)210 1122 A
4275 V
(03793)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_GETKSIG)462 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
3120(7\))S
3456(/*)S
(sys_getsig\(\))504 3582 A
4128(*/)S
4365 V
(03794)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_ENDKSIG)462 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
3120(8\))S
3456(/*)S
(sys_endsig\(\))504 3582 A
4128(*/)S
4455 V
(03795)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_SIGSEND)462 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
3120(9\))S
3456(/*)S
(sys_sigsend\(\))546 3582 A
4170(*/)S
4545 V
(03796)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_SIGRETURN)546 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(10\))126 3120 A
3456(/*)S
(sys_sigreturn\(\))630 3582 A
4254(*/)S
4635 V
(03797)210 1122 A
4725 V
(03798)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_NEWMAP)420 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(11\))126 3120 A
3456(/*)S
(sys_newmap\(\))504 3582 A
4128(*/)S
4815 V
(03799)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_SEGCTL)420 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(12\))126 3120 A
3456(/*)S
(sys_segctl\(\))504 3582 A
4128(*/)S
4905 V
(03800)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_MEMSET)420 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(13\))126 3120 A
3456(/*)S
(sys_memset\(\))504 3582 A
4128(*/)S
4995 V
(03801)210 1122 A
5085 V
(03802)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_UMAP)336 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(14\))126 3120 A
3456(/*)S
(sys_umap\(\))420 3582 A
4044(*/)S
5175 V
(03803)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_VIRCOPY)462 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(15\))126 3120 A
3456(/*)S
(sys_vircopy\(\))546 3582 A
4170(*/)S
5265 V
(03804)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_PHYSCOPY)504 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(16\))126 3120 A
3456(/*)S
(sys_physcopy\(\))588 3582 A
4212(*/)S
5355 V
(03805)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_VIRVCOPY)504 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(17\))126 3120 A
3456(/*)S
(sys_virvcopy\(\))588 3582 A
4212(*/)S
5445 V
(03806)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_PHYSVCOPY)546 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(18\))126 3120 A
3456(/*)S
(sys_physvcopy\(\))630 3582 A
4254(*/)S
5535 V
(03807)210 1122 A
5625 V
(03808)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_IRQCTL)420 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(19\))126 3120 A
3456(/*)S
(sys_irqctl\(\))504 3582 A
4128(*/)S
5715 V
(03809)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_INT86)378 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(20\))126 3120 A
3456(/*)S
(sys_int86\(\))462 3582 A
4086(*/)S
5805 V
(03810)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_DEVIO)378 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(21\))126 3120 A
3456(/*)S
(sys_devio\(\))462 3582 A
4086(*/)S
5895 V
(03811)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_SDEVIO)420 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(22\))126 3120 A
3456(/*)S
(sys_sdevio\(\))504 3582 A
4128(*/)S
5985 V
(03812)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_VDEVIO)420 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(23\))126 3120 A
3456(/*)S
(sys_vdevio\(\))504 3582 A
4128(*/)S
6075 V
(03813)210 1122 A
6165 V
(03814)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_SETALARM)504 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(24\))126 3120 A
3456(/*)S
(sys_setalarm\(\))588 3582 A
4212(*/)S
6255 V
(03815)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_TIMES)378 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(25\))126 3120 A
3456(/*)S
(sys_times\(\))462 3582 A
4086(*/)S
6345 V
(03816)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_GETINFO)462 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(26\))126 3120 A
3456(/*)S
(sys_getinfo\(\))546 3582 A
4170(*/)S
6435 V
(03817)210 1122 A
1440(#)S
(define)252 1566 A
(SYS_ABORT)378 1860 A
(\(KERNEL_CALL)504 2490 A
3036(+)S
(27\))126 3120 A
3456(/*)S
(sys_abort\(\))462 3582 A
4086(*/)S
6525 V
(03818)210 1122 A
6615 V
(03819)210 1122 A
(#define)294 1440 A
(NR_SYS_CALLS)504 1776 A
2448(28)S
2784(/*)S
(number)252 2910 A
3204(of)S
(system)252 3330 A
(calls)210 3624 A
3876(*/)S
6705 V
(03820)210 1122 A
6795 V
(03821)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SYS_MEMSET,)462 2238 A
(SYS_SEGCTL.)462 2742 A
3246(*/)S
6885 V
(03822)210 1122 A
(#define)294 1440 A
(MEM_PTR)294 1776 A
(m2_p1)210 2448 A
2784(/*)S
(base)168 2910 A
3120(*/)S
6975 V
(03823)210 1122 A
(#define)294 1440 A
(MEM_COUNT)378 1776 A
(m2_l1)210 2448 A
2784(/*)S
(count)210 2910 A
3162(*/)S
7065 V
(03824)210 1122 A
(#define)294 1440 A
(MEM_PATTERN)462 1776 A
(m2_l2)210 2448 A
2784(/*)S
(pattern)294 2910 A
3246(to)S
(write)210 3372 A
3624(*/)S
8418 V
EP
%%Page: 44 44
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(44)S
11 R
2303(File:)S
2536(include/minix/com.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(03825)210 1122 A
(#define)294 1440 A
(MEM_CHUNK_BASE)588 1776 A
(m4_l1)210 2448 A
2784(/*)S
(physical)336 2910 A
(base)168 3288 A
(address)294 3498 A
3834(*/)S
1845 V
(03826)210 1122 A
(#define)294 1440 A
(MEM_CHUNK_SIZE)588 1776 A
(m4_l2)210 2448 A
2784(/*)S
(size)168 2910 A
3120(of)S
(mem)126 3246 A
(chunk)210 3414 A
3666(*/)S
1935 V
(03827)210 1122 A
(#define)294 1440 A
(MEM_TOT_SIZE)504 1776 A
(m4_l3)210 2448 A
2784(/*)S
(total)210 2910 A
(memory)252 3162 A
(size)168 3456 A
3666(*/)S
2025 V
(03828)210 1122 A
(#define)294 1440 A
(MEM_CHUNK_TAG)546 1776 A
(m4_l4)210 2448 A
2784(/*)S
(tag)126 2910 A
3078(to)S
(identify)336 3204 A
(chunk)210 3582 A
3834(of)S
(mem)126 3960 A
4128(*/)S
2115 V
(03829)210 1122 A
2205 V
(03830)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SYS_DEVIO,)420 2238 A
(SYS_VDEVIO,)462 2700 A
(SYS_SDEVIO.)462 3204 A
3708(*/)S
2295 V
(03831)210 1122 A
(#define)294 1440 A
(DIO_REQUEST)462 1776 A
(m2_i3)210 2448 A
2784(/*)S
(device)252 2910 A
3204(in)S
3330(or)S
(output)252 3456 A
3750(*/)S
2385 V
(03832)210 1122 A
1440(#)S
(define)252 1608 A
(DIO_INPUT)378 1902 A
2616(0)S
2784(/*)S
(input)210 2910 A
3162(*/)S
2475 V
(03833)210 1122 A
1440(#)S
(define)252 1608 A
(DIO_OUTPUT)420 1902 A
2616(1)S
2784(/*)S
(output)252 2910 A
3204(*/)S
2565 V
(03834)210 1122 A
(#define)294 1440 A
(DIO_TYPE)336 1776 A
(m2_i1)210 2448 A
2784(/*)S
(flag)168 2910 A
(indicating)420 3120 A
(byte,)210 3582 A
(word,)210 3834 A
4086(or)S
(long)168 4212 A
4422(*/)S
2655 V
(03835)210 1122 A
1440(#)S
(define)252 1608 A
(DIO_BYTE)336 1902 A
('b')126 2532 A
2784(/*)S
(byte)168 2910 A
(type)168 3120 A
(values)252 3330 A
3624(*/)S
2745 V
(03836)210 1122 A
1440(#)S
(define)252 1608 A
(DIO_WORD)336 1902 A
('w')126 2532 A
2784(/*)S
(word)168 2910 A
(type)168 3120 A
(values)252 3330 A
3624(*/)S
2835 V
(03837)210 1122 A
1440(#)S
(define)252 1608 A
(DIO_LONG)336 1902 A
('l')126 2532 A
2784(/*)S
(long)168 2910 A
(type)168 3120 A
(values)252 3330 A
3624(*/)S
2925 V
(03838)210 1122 A
(#define)294 1440 A
(DIO_PORT)336 1776 A
(m2_l1)210 2448 A
2784(/*)S
(single)252 2910 A
(port)168 3204 A
(address)294 3414 A
3750(*/)S
3015 V
(03839)210 1122 A
(#define)294 1440 A
(DIO_VALUE)378 1776 A
(m2_l2)210 2448 A
2784(/*)S
(single)252 2910 A
(I/O)126 3204 A
(value)210 3372 A
3624(*/)S
3105 V
(03840)210 1122 A
(#define)294 1440 A
(DIO_VEC_ADDR)504 1776 A
(m2_p1)210 2448 A
2784(/*)S
(address)294 2910 A
3246(of)S
(buffer)252 3372 A
3666(or)S
(\(p,v\)-pairs)462 3792 A
4296(*/)S
3195 V
(03841)210 1122 A
(#define)294 1440 A
(DIO_VEC_SIZE)504 1776 A
(m2_l2)210 2448 A
2784(/*)S
(number)252 2910 A
3204(of)S
(elements)336 3330 A
3708(in)S
(vector)252 3834 A
4128(*/)S
3285 V
(03842)210 1122 A
(#define)294 1440 A
(DIO_VEC_PROC)504 1776 A
(m2_i2)210 2448 A
2784(/*)S
(number)252 2910 A
3204(of)S
(process)294 3330 A
(where)210 3666 A
(vector)252 3918 A
4212(is)S
4338(*/)S
3375 V
(03843)210 1122 A
3465 V
(03844)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SYS_SIGNARLM,)546 2238 A
(SYS_FLAGARLM,)546 2826 A
(SYS_SYNCALRM.)546 3414 A
4002(*/)S
3555 V
(03845)210 1122 A
(#define)294 1440 A
(ALRM_EXP_TIME)546 1776 A
(m2_l1)210 2448 A
2784(/*)S
(expire)252 2910 A
(time)168 3204 A
(for)126 3414 A
(the)126 3582 A
(alarm)210 3750 A
(call)168 4002 A
4212(*/)S
3645 V
(03846)210 1122 A
(#define)294 1440 A
(ALRM_ABS_TIME)546 1776 A
(m2_i2)210 2448 A
2784(/*)S
(set)126 2910 A
3078(to)S
3204(1)S
3288(to)S
(use)126 3414 A
(absolute)336 3582 A
(alarm)210 3960 A
(time)168 4212 A
4422(*/)S
3735 V
(03847)210 1122 A
(#define)294 1440 A
(ALRM_TIME_LEFT)588 1776 A
(m2_l1)210 2448 A
2784(/*)S
(how)126 2910 A
(many)168 3078 A
(ticks)210 3288 A
(were)168 3540 A
(remaining)378 3750 A
4170(*/)S
3825 V
(03848)210 1122 A
(#define)294 1440 A
(ALRM_PROC_NR)504 1776 A
(m2_i1)210 2448 A
2784(/*)S
(which)210 2910 A
(process)294 3162 A
(wants)210 3498 A
(the)126 3750 A
(alarm?)252 3918 A
4212(*/)S
3915 V
(03849)210 1122 A
(#define)294 1440 A
(ALRM_FLAG_PTR)546 1776 A
(m2_p1)210 2448 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
3582(of)S
(timeout)294 3708 A
(flag)168 4044 A
4254(*/)S
4005 V
(03850)210 1122 A
4095 V
(03851)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SYS_IRQCTL.)462 2238 A
2742(*/)S
4185 V
(03852)210 1122 A
(#define)294 1440 A
(IRQ_REQUEST)462 1776 A
(m5_c1)210 2448 A
2784(/*)S
(what)168 2910 A
3120(to)S
(do?)126 3246 A
3414(*/)S
4275 V
(03853)210 1122 A
1440(#)S
(define)252 1566 A
(IRQ_SETPOLICY)546 1860 A
2616(1)S
2784(/*)S
(manage)252 2910 A
3204(a)S
(slot)168 3288 A
3498(of)S
(the)126 3624 A
(IRQ)126 3792 A
(table)210 3960 A
4212(*/)S
4365 V
(03854)210 1122 A
1440(#)S
(define)252 1566 A
(IRQ_RMPOLICY)504 1860 A
2616(2)S
2784(/*)S
(remove)252 2910 A
3204(a)S
(slot)168 3288 A
3498(of)S
(the)126 3624 A
(IRQ)126 3792 A
(table)210 3960 A
4212(*/)S
4455 V
(03855)210 1122 A
1440(#)S
(define)252 1566 A
(IRQ_ENABLE)420 1860 A
2616(3)S
2784(/*)S
(enable)252 2910 A
(interrupts)420 3204 A
3666(*/)S
4545 V
(03856)210 1122 A
1440(#)S
(define)252 1566 A
(IRQ_DISABLE)462 1860 A
2616(4)S
2784(/*)S
(disable)294 2910 A
(interrupts)420 3246 A
3708(*/)S
4635 V
(03857)210 1122 A
(#define)294 1440 A
(IRQ_VECTOR)420 1776 A
(m5_c2)210 2448 A
2784(/*)S
(irq)126 2910 A
(vector)252 3078 A
3372(*/)S
4725 V
(03858)210 1122 A
(#define)294 1440 A
(IRQ_POLICY)420 1776 A
(m5_i1)210 2448 A
2784(/*)S
(options)294 2910 A
(for)126 3246 A
(IRQCTL)252 3414 A
(request)294 3708 A
4044(*/)S
4815 V
(03859)210 1122 A
1440(#)S
(define)252 1566 A
(IRQ_REENABLE)504 1860 A
(0x001)210 2448 A
2784(/*)S
(reenable)336 2910 A
(IRQ)126 3288 A
(line)168 3456 A
(after)210 3666 A
(interrupt)378 3918 A
4338(*/)S
4905 V
(03860)210 1122 A
1440(#)S
(define)252 1566 A
(IRQ_BYTE)336 1860 A
(0x100)210 2448 A
2784(/*)S
(byte)168 2910 A
(values)252 3120 A
3414(*/)S
4995 V
(03861)210 1122 A
1440(#)S
(define)252 1566 A
(IRQ_WORD)336 1860 A
(0x200)210 2448 A
2784(/*)S
(word)168 2910 A
(values)252 3120 A
3414(*/)S
5085 V
(03862)210 1122 A
1440(#)S
(define)252 1566 A
(IRQ_LONG)336 1860 A
(0x400)210 2448 A
2784(/*)S
(long)168 2910 A
(values)252 3120 A
3414(*/)S
5175 V
(03863)210 1122 A
(#define)294 1440 A
(IRQ_PROC_NR)462 1776 A
(m5_i2)210 2448 A
2784(/*)S
(process)294 2910 A
(number,)294 3246 A
(SELF,)210 3582 A
(NONE)168 3834 A
4044(*/)S
5265 V
(03864)210 1122 A
(#define)294 1440 A
(IRQ_HOOK_ID)462 1776 A
(m5_l3)210 2448 A
2784(/*)S
2910(id)S
3036(of)S
(irq)126 3162 A
(hook)168 3330 A
3540(at)S
(kernel)252 3666 A
3960(*/)S
5355 V
(03865)210 1122 A
5445 V
(03866)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SYS_SEGCTL.)462 2238 A
2742(*/)S
5535 V
(03867)210 1122 A
(#define)294 1440 A
(SEG_SELECT)420 1776 A
(m4_l1)210 2448 A
2784(/*)S
(segment)294 2910 A
(selector)336 3246 A
(returned)336 3624 A
4002(*/)S
5625 V
(03868)210 1122 A
(#define)294 1440 A
(SEG_OFFSET)420 1776 A
(m4_l2)210 2448 A
2784(/*)S
(offset)252 2910 A
3204(in)S
(segment)294 3330 A
(returned)336 3666 A
4044(*/)S
5715 V
(03869)210 1122 A
(#define)294 1440 A
(SEG_PHYS)336 1776 A
(m4_l3)210 2448 A
2784(/*)S
(physical)336 2910 A
(address)294 3288 A
3624(of)S
(segment)294 3750 A
4086(*/)S
5805 V
(03870)210 1122 A
(#define)294 1440 A
(SEG_SIZE)336 1776 A
(m4_l4)210 2448 A
2784(/*)S
(segment)294 2910 A
(size)168 3246 A
3456(*/)S
5895 V
(03871)210 1122 A
(#define)294 1440 A
(SEG_INDEX)378 1776 A
(m4_l5)210 2448 A
2784(/*)S
(segment)294 2910 A
(index)210 3246 A
3498(in)S
(remote)252 3624 A
(map)126 3918 A
4086(*/)S
5985 V
(03872)210 1122 A
6075 V
(03873)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SYS_VIDCOPY.)504 2238 A
2784(*/)S
6165 V
(03874)210 1122 A
(#define)294 1440 A
(VID_REQUEST)462 1776 A
(m4_l1)210 2448 A
2784(/*)S
(what)168 2910 A
3120(to)S
(do?)126 3246 A
3414(*/)S
6255 V
(03875)210 1122 A
1440(#)S
(define)252 1566 A
(VID_VID_COPY)504 1860 A
2574(1)S
2784(/*)S
(request)294 2910 A
(vid_vid_copy\(\))588 3246 A
3876(*/)S
6345 V
(03876)210 1122 A
1440(#)S
(define)252 1566 A
(MEM_VID_COPY)504 1860 A
2574(2)S
2784(/*)S
(request)294 2910 A
(mem_vid_copy\(\))588 3246 A
3876(*/)S
6435 V
(03877)210 1122 A
(#define)294 1440 A
(VID_SRC_ADDR)504 1776 A
(m4_l2)210 2448 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
3582(in)S
(memory)252 3708 A
4002(*/)S
6525 V
(03878)210 1122 A
(#define)294 1440 A
(VID_SRC_OFFSET)588 1776 A
(m4_l3)210 2448 A
2784(/*)S
(offset)252 2910 A
3204(in)S
(video)210 3330 A
(memory)252 3582 A
3876(*/)S
6615 V
(03879)210 1122 A
(#define)294 1440 A
(VID_DST_OFFSET)588 1776 A
(m4_l4)210 2448 A
2784(/*)S
(offset)252 2910 A
3204(in)S
(video)210 3330 A
(memory)252 3582 A
3876(*/)S
6705 V
(03880)210 1122 A
(#define)294 1440 A
(VID_CP_COUNT)504 1776 A
(m4_l5)210 2448 A
2784(/*)S
(number)252 2910 A
3204(of)S
(words)210 3330 A
3582(to)S
3708(be)S
(copied)252 3834 A
4128(*/)S
6795 V
(03881)210 1122 A
6885 V
(03882)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SYS_ABORT.)420 2238 A
2700(*/)S
6975 V
(03883)210 1122 A
(#define)294 1440 A
(ABRT_HOW)336 1776 A
(m1_i1)210 2448 A
2784(/*)S
(RBT_REBOOT,)462 2910 A
(RBT_HALT,)378 3414 A
(etc.)168 3834 A
4044(*/)S
7065 V
(03884)210 1122 A
(#define)294 1440 A
(ABRT_MON_PROC)546 1776 A
(m1_i2)210 2448 A
2784(/*)S
(process)294 2910 A
(where)210 3246 A
(monitor)294 3498 A
(params)252 3834 A
(are)126 4128 A
4296(*/)S
8418 V
EP
%%Page: 45 45
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2303(File:)S
2536(include/minix/com.h)S
12 B
4560(45)S
1755 V
7 LST
(03885)210 1122 A
(#define)294 1440 A
(ABRT_MON_LEN)504 1776 A
(m1_i3)210 2448 A
2784(/*)S
(length)252 2910 A
3204(of)S
(monitor)294 3330 A
(params)252 3666 A
3960(*/)S
1845 V
(03886)210 1122 A
(#define)294 1440 A
(ABRT_MON_ADDR)546 1776 A
(m1_p1)210 2448 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
3582(of)S
(monitor)294 3708 A
(params)252 4044 A
4338(*/)S
1935 V
(03887)210 1122 A
2025 V
(03888)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(_UMAP,)252 2238 A
(_VIRCOPY,)378 2532 A
(_PHYSCOPY.)420 2952 A
3414(*/)S
2115 V
(03889)210 1122 A
(#define)294 1440 A
(CP_SRC_SPACE)504 1776 A
(m5_c1)210 2448 A
2784(/*)S
2910(T)S
2994(or)S
3120(D)S
(space)210 3204 A
(\(stack)252 3456 A
3750(is)S
(also)168 3876 A
4086(D\))S
4212(*/)S
2205 V
(03890)210 1122 A
(#define)294 1440 A
(CP_SRC_PROC_NR)588 1776 A
(m5_i1)210 2448 A
2784(/*)S
(process)294 2910 A
3246(to)S
(copy)168 3372 A
(from)168 3582 A
3792(*/)S
2295 V
(03891)210 1122 A
(#define)294 1440 A
(CP_SRC_ADDR)462 1776 A
(m5_l1)210 2448 A
2784(/*)S
(address)294 2910 A
(where)210 3246 A
(data)168 3498 A
(come)168 3708 A
(from)168 3918 A
4128(*/)S
2385 V
(03892)210 1122 A
(#define)294 1440 A
(CP_DST_SPACE)504 1776 A
(m5_c2)210 2448 A
2784(/*)S
2910(T)S
2994(or)S
3120(D)S
(space)210 3204 A
(\(stack)252 3456 A
3750(is)S
(also)168 3876 A
4086(D\))S
4212(*/)S
2475 V
(03893)210 1122 A
(#define)294 1440 A
(CP_DST_PROC_NR)588 1776 A
(m5_i2)210 2448 A
2784(/*)S
(process)294 2910 A
3246(to)S
(copy)168 3372 A
3582(to)S
3708(*/)S
2565 V
(03894)210 1122 A
(#define)294 1440 A
(CP_DST_ADDR)462 1776 A
(m5_l2)210 2448 A
2784(/*)S
(address)294 2910 A
(where)210 3246 A
(data)168 3498 A
3708(go)S
3834(to)S
3960(*/)S
2655 V
(03895)210 1122 A
(#define)294 1440 A
(CP_NR_BYTES)462 1776 A
(m5_l3)210 2448 A
2784(/*)S
(number)252 2910 A
3204(of)S
(bytes)210 3330 A
3582(to)S
(copy)168 3708 A
3918(*/)S
2745 V
(03896)210 1122 A
2835 V
(03897)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SYS_VCOPY)378 2238 A
(and)126 2658 A
(SYS_VVIRCOPY.)546 2826 A
3414(*/)S
2925 V
(03898)210 1122 A
(#define)294 1440 A
(VCP_NR_OK)378 1776 A
(m1_i2)210 2448 A
2784(/*)S
(number)252 2910 A
3204(of)S
(successfull)462 3330 A
(copies)252 3834 A
4128(*/)S
3015 V
(03899)210 1122 A
(#define)294 1440 A
(VCP_VEC_SIZE)504 1776 A
(m1_i3)210 2448 A
2784(/*)S
(size)168 2910 A
3120(of)S
(copy)168 3246 A
(vector)252 3456 A
3750(*/)S
3105 V
(03900)210 1122 A
(#define)294 1440 A
(VCP_VEC_ADDR)504 1776 A
(m1_p1)210 2448 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(copy)168 3372 A
(vector)252 3582 A
3876(*/)S
3195 V
(03901)210 1122 A
3285 V
(03902)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SYS_GETINFO.)504 2238 A
2784(*/)S
3375 V
(03903)210 1122 A
(#define)294 1440 A
(I_REQUEST)378 1776 A
(m7_i3)210 2406 A
2784(/*)S
(what)168 2910 A
(info)168 3120 A
3330(to)S
(get)126 3456 A
3624(*/)S
3465 V
(03904)210 1122 A
1440(#)S
(define)252 1608 A
(GET_KINFO)378 1902 A
2574(0)S
2784(/*)S
(get)126 2910 A
(kernel)252 3078 A
(information)462 3372 A
(structure)378 3876 A
4296(*/)S
3555 V
(03905)210 1122 A
1440(#)S
(define)252 1608 A
(GET_IMAGE)378 1902 A
2574(1)S
2784(/*)S
(get)126 2910 A
(system)252 3078 A
(image)210 3372 A
(table)210 3624 A
3876(*/)S
3645 V
(03906)210 1122 A
1440(#)S
(define)252 1608 A
(GET_PROCTAB)462 1902 A
2574(2)S
2784(/*)S
(get)126 2910 A
(kernel)252 3078 A
(process)294 3372 A
(table)210 3708 A
3960(*/)S
3735 V
(03907)210 1122 A
1440(#)S
(define)252 1608 A
(GET_RANDOMNESS)588 1902 A
2574(3)S
2784(/*)S
(get)126 2910 A
(randomness)420 3078 A
(buffer)252 3540 A
3834(*/)S
3825 V
(03908)210 1122 A
1440(#)S
(define)252 1608 A
(GET_MONPARAMS)546 1902 A
2574(4)S
2784(/*)S
(get)126 2910 A
(monitor)294 3078 A
(parameters)420 3414 A
3876(*/)S
3915 V
(03909)210 1122 A
1440(#)S
(define)252 1608 A
(GET_KENV)336 1902 A
2574(5)S
2784(/*)S
(get)126 2910 A
(kernel)252 3078 A
(environment)462 3372 A
(string)252 3876 A
4170(*/)S
4005 V
(03910)210 1122 A
1440(#)S
(define)252 1608 A
(GET_IRQHOOKS)504 1902 A
2574(6)S
2784(/*)S
(get)126 2910 A
(the)126 3078 A
(IRQ)126 3246 A
(table)210 3414 A
3666(*/)S
4095 V
(03911)210 1122 A
1440(#)S
(define)252 1608 A
(GET_KMESSAGES)546 1902 A
2574(7)S
2784(/*)S
(get)126 2910 A
(kernel)252 3078 A
(messages)336 3372 A
3750(*/)S
4185 V
(03912)210 1122 A
1440(#)S
(define)252 1608 A
(GET_PRIVTAB)462 1902 A
2574(8)S
2784(/*)S
(get)126 2910 A
(kernel)252 3078 A
(privileges)420 3372 A
(table)210 3834 A
4086(*/)S
4275 V
(03913)210 1122 A
1440(#)S
(define)252 1608 A
(GET_KADDRESSES)588 1902 A
2574(9)S
2784(/*)S
(get)126 2910 A
(various)294 3078 A
(kernel)252 3414 A
(addresses)378 3708 A
4128(*/)S
4365 V
(03914)210 1122 A
1440(#)S
(define)252 1608 A
(GET_SCHEDINFO)546 1902 A
2532(10)S
2784(/*)S
(get)126 2910 A
(scheduling)420 3078 A
(queues)252 3540 A
3834(*/)S
4455 V
(03915)210 1122 A
1440(#)S
(define)252 1608 A
(GET_PROC)336 1902 A
2532(11)S
2784(/*)S
(get)126 2910 A
(process)294 3078 A
(slot)168 3414 A
3624(if)S
(given)210 3750 A
(process)294 4002 A
4338(*/)S
4545 V
(03916)210 1122 A
1440(#)S
(define)252 1608 A
(GET_MACHINE)462 1902 A
2532(12)S
2784(/*)S
(get)126 2910 A
(machine)294 3078 A
(information)462 3414 A
3918(*/)S
4635 V
(03917)210 1122 A
1440(#)S
(define)252 1608 A
(GET_LOCKTIMING)588 1902 A
2532(13)S
2784(/*)S
(get)126 2910 A
(lock\(\)/unlock\(\))630 3078 A
(latency)294 3750 A
(timing)252 4086 A
4380(*/)S
4725 V
(03918)210 1122 A
1440(#)S
(define)252 1608 A
(GET_BIOSBUFFER)588 1902 A
2532(14)S
2784(/*)S
(get)126 2910 A
3078(a)S
(buffer)252 3162 A
(for)126 3456 A
(BIOS)168 3624 A
(calls)210 3834 A
4086(*/)S
4815 V
(03919)210 1122 A
(#define)294 1440 A
(I_PROC_NR)378 1776 A
(m7_i4)210 2406 A
2784(/*)S
(calling)294 2910 A
(process)294 3246 A
3582(*/)S
4905 V
(03920)210 1122 A
(#define)294 1440 A
(I_VAL_PTR)378 1776 A
(m7_p1)210 2406 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
3582(at)S
(caller)252 3708 A
4002(*/)S
4995 V
(03921)210 1122 A
(#define)294 1440 A
(I_VAL_LEN)378 1776 A
(m7_i1)210 2406 A
2784(/*)S
(max)126 2910 A
(length)252 3078 A
3372(of)S
(value)210 3498 A
3750(*/)S
5085 V
(03922)210 1122 A
(#define)294 1440 A
(I_VAL_PTR2)420 1776 A
(m7_p2)210 2406 A
2784(/*)S
(second)252 2910 A
(virtual)294 3204 A
(address)294 3540 A
3876(*/)S
5175 V
(03923)210 1122 A
(#define)294 1440 A
(I_VAL_LEN2)420 1776 A
(m7_i2)210 2406 A
2784(/*)S
(second)252 2910 A
(length,)294 3204 A
3540(or)S
(proc)168 3666 A
3876(nr)S
4002(*/)S
5265 V
(03924)210 1122 A
5355 V
(03925)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SYS_TIMES.)420 2238 A
2700(*/)S
5445 V
(03926)210 1122 A
(#define)294 1440 A
(T_PROC_NR)378 1776 A
(m4_l1)210 2406 A
2784(/*)S
(process)294 2910 A
3246(to)S
(request)294 3372 A
(time)168 3708 A
(info)168 3918 A
(for)126 4128 A
4296(*/)S
5535 V
(03927)210 1122 A
(#define)294 1440 A
(T_USER_TIME)462 1776 A
(m4_l1)210 2406 A
2784(/*)S
(user)168 2910 A
(time)168 3120 A
(consumed)336 3330 A
3708(by)S
(process)294 3834 A
4170(*/)S
5625 V
(03928)210 1122 A
(#define)294 1440 A
(T_SYSTEM_TIME)546 1776 A
(m4_l2)210 2406 A
2784(/*)S
(system)252 2910 A
(time)168 3204 A
(consumed)336 3414 A
3792(by)S
(process)294 3918 A
4254(*/)S
5715 V
(03929)210 1122 A
(#define)294 1440 A
(T_CHILD_UTIME)546 1776 A
(m4_l3)210 2406 A
2784(/*)S
(user)168 2910 A
(time)168 3120 A
(consumed)336 3330 A
3708(by)S
(process')336 3834 A
(children)336 4212 A
4590(*/)S
5805 V
(03930)210 1122 A
(#define)294 1440 A
(T_CHILD_STIME)546 1776 A
(m4_l4)210 2406 A
2784(/*)S
(sys)126 2910 A
(time)168 3078 A
(consumed)336 3288 A
3666(by)S
(process')336 3792 A
(children)336 4170 A
4548(*/)S
5895 V
(03931)210 1122 A
(#define)294 1440 A
(T_BOOT_TICKS)504 1776 A
(m4_l5)210 2406 A
2784(/*)S
(number)252 2910 A
3204(of)S
(clock)210 3330 A
(ticks)210 3582 A
(since)210 3834 A
(boot)168 4086 A
(time)168 4296 A
4506(*/)S
5985 V
(03932)210 1122 A
6075 V
(03933)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SYS_TRACE,)420 2238 A
(SYS_SVRCTL.)462 2700 A
3204(*/)S
6165 V
(03934)210 1122 A
(#define)294 1440 A
(CTL_PROC_NR)462 1776 A
(m2_i1)210 2406 A
2784(/*)S
(process)294 2910 A
(number)252 3246 A
3540(of)S
(the)126 3666 A
(caller)252 3834 A
4128(*/)S
6255 V
(03935)210 1122 A
(#define)294 1440 A
(CTL_REQUEST)462 1776 A
(m2_i2)210 2406 A
2784(/*)S
(server)252 2910 A
(control)294 3204 A
(request)294 3540 A
3876(*/)S
6345 V
(03936)210 1122 A
(#define)294 1440 A
(CTL_MM_PRIV)462 1776 A
(m2_i3)210 2406 A
2784(/*)S
(privilege)378 2910 A
3330(as)S
(seen)168 3456 A
3666(by)S
3792(PM)S
3918(*/)S
6435 V
(03937)210 1122 A
(#define)294 1440 A
(CTL_ARG_PTR)462 1776 A
(m2_p1)210 2406 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(argument)336 3372 A
3750(*/)S
6525 V
(03938)210 1122 A
(#define)294 1440 A
(CTL_ADDRESS)462 1776 A
(m2_l1)210 2406 A
2784(/*)S
(address)294 2910 A
3246(at)S
(traced)252 3372 A
(process')336 3666 A
(space)210 4044 A
4296(*/)S
6615 V
(03939)210 1122 A
(#define)294 1440 A
(CTL_DATA)336 1776 A
(m2_l2)210 2406 A
2784(/*)S
(data)168 2910 A
(field)210 3120 A
(for)126 3372 A
(tracing)294 3540 A
3876(*/)S
6705 V
(03940)210 1122 A
6795 V
(03941)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SYS_KILL,)378 2238 A
(SYS_SIGCTL)420 2658 A
3120(*/)S
6885 V
(03942)210 1122 A
(#define)294 1440 A
(SIG_REQUEST)462 1776 A
(m2_l2)210 2406 A
2784(/*)S
2910(PM)S
(signal)252 3036 A
(control)294 3330 A
(request)294 3666 A
4002(*/)S
6975 V
(03943)210 1122 A
(#define)294 1440 A
(S_GETSIG)336 1776 A
2574(0)S
2784(/*)S
(get)126 2910 A
(pending)294 3078 A
(kernel)252 3414 A
(signal)252 3708 A
4002(*/)S
7065 V
(03944)210 1122 A
(#define)294 1440 A
(S_ENDSIG)336 1776 A
2574(1)S
2784(/*)S
(finish)252 2910 A
3204(a)S
(kernel)252 3288 A
(signal)252 3582 A
3876(*/)S
8418 V
EP
%%Page: 46 46
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(46)S
11 R
2303(File:)S
2536(include/minix/com.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(03945)210 1122 A
(#define)294 1440 A
(S_SENDSIG)378 1776 A
2574(2)S
2784(/*)S
(POSIX)210 2910 A
(style)210 3162 A
(signal)252 3414 A
(handling)336 3708 A
4086(*/)S
1845 V
(03946)210 1122 A
(#define)294 1440 A
(S_SIGRETURN)462 1776 A
2574(3)S
2784(/*)S
(return)252 2910 A
(from)168 3204 A
(POSIX)210 3414 A
(handling)336 3666 A
4044(*/)S
1935 V
(03947)210 1122 A
(#define)294 1440 A
(S_KILL)252 1776 A
2574(4)S
2784(/*)S
(servers)294 2910 A
(kills)210 3246 A
(process)294 3498 A
(with)168 3834 A
(signal)252 4044 A
4338(*/)S
2025 V
(03948)210 1122 A
(#define)294 1440 A
(SIG_PROC)336 1776 A
(m2_i1)210 2406 A
2784(/*)S
(process)294 2910 A
(number)252 3246 A
(for)126 3540 A
(inform)252 3708 A
4002(*/)S
2115 V
(03949)210 1122 A
(#define)294 1440 A
(SIG_NUMBER)420 1776 A
(m2_i2)210 2406 A
2784(/*)S
(signal)252 2910 A
(number)252 3204 A
3498(to)S
(send)168 3624 A
3834(*/)S
2205 V
(03950)210 1122 A
(#define)294 1440 A
(SIG_FLAGS)378 1776 A
(m2_i3)210 2406 A
2784(/*)S
(signal)252 2910 A
(flags)210 3204 A
(field)210 3456 A
3708(*/)S
2295 V
(03951)210 1122 A
(#define)294 1440 A
(SIG_MAP)294 1776 A
(m2_l1)210 2406 A
2784(/*)S
(used)168 2910 A
3120(by)S
(kernel)252 3246 A
3540(to)S
(pass)168 3666 A
(signal)252 3876 A
(bit)126 4170 A
(map)126 4338 A
4506(*/)S
2385 V
(03952)210 1122 A
(#define)294 1440 A
(SIG_CTXT_PTR)504 1776 A
(m2_p1)210 2406 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(info)168 3372 A
3582(to)S
(restore)294 3708 A
(signal)252 4044 A
(context)294 4338 A
4674(*/)S
2475 V
(03953)210 1122 A
2565 V
(03954)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SYS_FORK,)378 2238 A
(_EXEC,)252 2658 A
(_EXIT,)252 2952 A
(_NEWMAP.)336 3246 A
3624(*/)S
2655 V
(03955)210 1122 A
(#define)294 1440 A
(PR_PROC_NR)420 1776 A
(m1_i1)210 2406 A
2784(/*)S
(indicates)378 2910 A
3330(a)S
(\(child\))294 3414 A
(process)294 3750 A
4086(*/)S
2745 V
(03956)210 1122 A
(#define)294 1440 A
(PR_PRIORITY)462 1776 A
(m1_i2)210 2406 A
2784(/*)S
(process)294 2910 A
(priority)336 3246 A
3624(*/)S
2835 V
(03957)210 1122 A
(#define)294 1440 A
(PR_PPROC_NR)462 1776 A
(m1_i2)210 2406 A
2784(/*)S
(indicates)378 2910 A
3330(a)S
(\(parent\))336 3414 A
(process)294 3792 A
4128(*/)S
2925 V
(03958)210 1122 A
(#define)294 1440 A
(PR_PID)252 1776 A
(m1_i3)210 2406 A
2784(/*)S
(process)294 2910 A
3246(id)S
3372(at)S
(process)294 3498 A
(manager)294 3834 A
4170(*/)S
3015 V
(03959)210 1122 A
(#define)294 1440 A
(PR_STACK_PTR)504 1776 A
(m1_p1)210 2406 A
2784(/*)S
(used)168 2910 A
(for)126 3120 A
(stack)210 3288 A
(ptr)126 3540 A
3708(in)S
(sys_exec,)378 3834 A
(sys_getsp)378 4254 A
4674(*/)S
3105 V
(03960)210 1122 A
(#define)294 1440 A
(PR_TRACING)420 1776 A
(m1_i3)210 2406 A
2784(/*)S
(flag)168 2910 A
3120(to)S
(indicate)336 3246 A
(tracing)294 3624 A
3960(is)S
(on/)126 4086 A
(off)126 4254 A
4422(*/)S
3195 V
(03961)210 1122 A
(#define)294 1440 A
(PR_NAME_PTR)462 1776 A
(m1_p2)210 2406 A
2784(/*)S
(tells)210 2910 A
(where)210 3162 A
(program)294 3414 A
(name)168 3750 A
3960(is)S
(for)126 4086 A
(dmp)126 4254 A
4422(*/)S
3285 V
(03962)210 1122 A
(#define)294 1440 A
(PR_IP_PTR)378 1776 A
(m1_p3)210 2406 A
2784(/*)S
(initial)294 2910 A
(value)210 3246 A
(for)126 3498 A
3666(ip)S
(after)210 3792 A
(exec)168 4044 A
4254(*/)S
3375 V
(03963)210 1122 A
(#define)294 1440 A
(PR_MEM_PTR)420 1776 A
(m1_p1)210 2406 A
2784(/*)S
(tells)210 2910 A
(where)210 3162 A
(memory)252 3414 A
(map)126 3708 A
3876(is)S
(for)126 4002 A
(sys_newmap)420 4170 A
4632(*/)S
3465 V
(03964)210 1122 A
3555 V
(03965)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SYS_INT86)378 2238 A
2658(*/)S
3645 V
(03966)210 1122 A
(#define)294 1440 A
(INT86_REG86)462 1776 A
(m1_p1)210 2406 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(registers)378 3372 A
3792(*/)S
3735 V
(03967)210 1122 A
3825 V
(03968)210 1122 A
1440(/*)S
(Field)210 1566 A
(names)210 1818 A
(for)126 2070 A
(SELECT)252 2238 A
(\(FS\).)210 2532 A
2784(*/)S
3915 V
(03969)210 1122 A
(#define)294 1440 A
(SEL_NFDS)336 1776 A
(m8_i1)210 2406 A
4005 V
(03970)210 1122 A
(#define)294 1440 A
(SEL_READFDS)462 1776 A
(m8_p1)210 2406 A
4095 V
(03971)210 1122 A
(#define)294 1440 A
(SEL_WRITEFDS)504 1776 A
(m8_p2)210 2406 A
4185 V
(03972)210 1122 A
(#define)294 1440 A
(SEL_ERRORFDS)504 1776 A
(m8_p3)210 2406 A
4275 V
(03973)210 1122 A
(#define)294 1440 A
(SEL_TIMEOUT)462 1776 A
(m8_p4)210 2406 A
4365 V
(03974)210 1122 A
4455 V
(03975)210 1122 A
(/*===========================================================================*)3276 1440 A
4545 V
(03976)210 1122 A
1482(*)S
(Messages)336 2196 A
(for)126 2574 A
(system)252 2742 A
(management)420 3036 A
(server)252 3498 A
4674(*)S
4635 V
(03977)210 1122 A
(*===========================================================================*/)3276 1482 A
4725 V
(03978)210 1122 A
4815 V
(03979)210 1122 A
(#define)294 1440 A
(SRV_RQ_BASE)462 1776 A
(0x700)210 2784 A
4905 V
(03980)210 1122 A
4995 V
(03981)210 1122 A
(#define)294 1440 A
(SRV_UP)252 1776 A
(\(SRV_RQ_BASE)504 2448 A
2994(+)S
3078(0\))S
3456(/*)S
(start)210 3582 A
(system)252 3834 A
(service)294 4128 A
4464(*/)S
5085 V
(03982)210 1122 A
(#define)294 1440 A
(SRV_DOWN)336 1776 A
(\(SRV_RQ_BASE)504 2448 A
2994(+)S
3078(1\))S
3456(/*)S
(stop)168 3582 A
(system)252 3792 A
(service)294 4086 A
4422(*/)S
5175 V
(03983)210 1122 A
(#define)294 1440 A
(SRV_STATUS)420 1776 A
(\(SRV_RQ_BASE)504 2448 A
2994(+)S
3078(2\))S
3456(/*)S
(get)126 3582 A
(service)294 3750 A
(status)252 4086 A
4380(*/)S
5265 V
(03984)210 1122 A
5355 V
(03985)210 1122 A
1440(#)S
(define)252 1566 A
(SRV_PATH_ADDR)546 1860 A
(m1_p1)210 2784 A
3456(/*)S
(path)168 3582 A
3792(of)S
(binary)252 3918 A
4212(*/)S
5445 V
(03986)210 1122 A
1440(#)S
(define)252 1566 A
(SRV_PATH_LEN)504 1860 A
(m1_i1)210 2784 A
3456(/*)S
(length)252 3582 A
3876(of)S
(binary)252 4002 A
4296(*/)S
5535 V
(03987)210 1122 A
1440(#)S
(define)252 1566 A
(SRV_ARGS_ADDR)546 1860 A
(m1_p2)210 2784 A
3456(/*)S
(arguments)378 3582 A
4002(to)S
4128(be)S
(passed)252 4254 A
4548(*/)S
5625 V
(03988)210 1122 A
1440(#)S
(define)252 1566 A
(SRV_ARGS_LEN)504 1860 A
(m1_i2)210 2784 A
3456(/*)S
(length)252 3582 A
3876(of)S
(arguments)378 4002 A
4422(*/)S
5715 V
(03989)210 1122 A
1440(#)S
(define)252 1566 A
(SRV_DEV_MAJOR)546 1860 A
(m1_i3)210 2784 A
3456(/*)S
(major)210 3582 A
(device)252 3834 A
(number)252 4128 A
4422(*/)S
5805 V
(03990)210 1122 A
1440(#)S
(define)252 1566 A
(SRV_PRIV_ADDR)546 1860 A
(m1_p3)210 2784 A
3456(/*)S
(privileges)420 3582 A
(string)252 4044 A
4338(*/)S
5895 V
(03991)210 1122 A
1440(#)S
(define)252 1566 A
(SRV_PRIV_LEN)504 1860 A
(m1_i3)210 2784 A
3456(/*)S
(length)252 3582 A
3876(of)S
(privileges)420 4002 A
4464(*/)S
5985 V
(03992)210 1122 A
6075 V
(03993)210 1122 A
(/*===========================================================================*)3276 1440 A
6165 V
(03994)210 1122 A
1482(*)S
(Miscellaneous)546 2196 A
(messages)336 2784 A
(used)168 3162 A
3372(by)S
(TTY)126 3498 A
4674(*)S
6255 V
(03995)210 1122 A
(*===========================================================================*/)3276 1482 A
6345 V
(03996)210 1122 A
6435 V
(03997)210 1122 A
1440(/*)S
(Miscellaneous)546 1566 A
(request)294 2154 A
(types)210 2490 A
(and)126 2742 A
(field)210 2910 A
(names,)252 3162 A
(e.g.)168 3456 A
(used)168 3666 A
3876(by)S
4002(IS)S
(server.)294 4128 A
4464(*/)S
6525 V
(03998)210 1122 A
(#define)294 1440 A
(PANIC_DUMPS)462 1776 A
2784(97)S
3120(/*)S
(debug)210 3246 A
(dumps)210 3498 A
3750(at)S
(the)126 3876 A
(TTY)126 4044 A
4212(on)S
(RBT_PANIC)378 4338 A
4758(*/)S
6615 V
(03999)210 1122 A
(#define)294 1440 A
(FKEY_CONTROL)504 1776 A
2784(98)S
3120(/*)S
(control)294 3246 A
3582(a)S
(function)336 3666 A
(key)126 4044 A
4212(at)S
(the)126 4338 A
(TTY)126 4506 A
4674(*/)S
6705 V
(04000)210 1122 A
1440(#)S
(define)252 1566 A
(FKEY_REQUEST)504 1860 A
(m2_i1)210 2658 A
3120(/*)S
(request)294 3246 A
3582(to)S
(perform)294 3708 A
4044(at)S
(TTY)126 4170 A
4338(*/)S
6795 V
(04001)210 1122 A
1440(#)S
(define)252 1566 A
(FKEY_MAP)336 1986 A
2784(10)S
3120(/*)S
(observe)294 3246 A
(function)336 3582 A
(key)126 3960 A
4128(*/)S
6885 V
(04002)210 1122 A
1440(#)S
(define)252 1566 A
(FKEY_UNMAP)420 1986 A
2784(11)S
3120(/*)S
(stop)168 3246 A
(observing)378 3456 A
(function)336 3876 A
(key)126 4254 A
4422(*/)S
6975 V
(04003)210 1122 A
1440(#)S
(define)252 1566 A
(FKEY_EVENTS)462 1986 A
2784(12)S
3120(/*)S
(request)294 3246 A
(open)168 3582 A
(key)126 3792 A
(presses)294 3960 A
4296(*/)S
7065 V
(04004)210 1122 A
1440(#)S
(define)252 1566 A
(FKEY_FKEYS)420 1860 A
(m2_l1)210 2700 A
3120(/*)S
(F1-F12)252 3246 A
(keys)168 3540 A
(pressed)294 3750 A
4086(*/)S
8418 V
EP
%%Page: 47 47
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2303(File:)S
2536(include/minix/com.h)S
12 B
4560(47)S
1755 V
7 LST
(04005)210 1122 A
1440(#)S
(define)252 1566 A
(FKEY_SFKEYS)462 1860 A
(m2_l2)210 2700 A
3120(/*)S
(Shift-F1-F12)504 3246 A
(keys)168 3792 A
(pressed)294 4002 A
4338(*/)S
1845 V
(04006)210 1122 A
(#define)294 1440 A
(DIAGNOSTICS)462 1776 A
(100)126 2448 A
2784(/*)S
(output)252 2910 A
3204(a)S
(string)252 3288 A
(without)294 3582 A
3918(FS)S
4044(in)S
(between)294 4170 A
4506(*/)S
1935 V
(04007)210 1122 A
1440(#)S
(define)252 1566 A
(DIAG_PRINT_BUF)588 1860 A
(m1_p1)210 2700 A
2025 V
(04008)210 1122 A
1440(#)S
(define)252 1566 A
(DIAG_BUF_COUNT)588 1860 A
(m1_i1)210 2700 A
2115 V
(04009)210 1122 A
1440(#)S
(define)252 1566 A
(DIAG_PROC_NR)504 1860 A
(m1_i2)210 2700 A
2205 V
(04010)210 1122 A
2295 V
(04011)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_MINIX_COM_H)504 1860 A
2406(*/)S
2745 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2835 V
(include/minix/devio.h)882 2676 A
2925 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3105 V
(04100)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(provides)336 1986 A
(basic)210 2364 A
(types)210 2616 A
(and)126 2868 A
(some)168 3036 A
(constants)378 3246 A
(for)126 3666 A
(the)126 3834 A
3195 V
(04101)210 1122 A
1482(*)S
(SYS_DEVIO)378 1566 A
(and)126 1986 A
(SYS_VDEVIO)420 2154 A
(system)252 2616 A
(calls,)252 2910 A
(which)210 3204 A
(allow)210 3456 A
(user-level)420 3708 A
3285 V
(04102)210 1122 A
1482(*)S
(processes)378 1566 A
1986(to)S
(perform)294 2112 A
(device)252 2448 A
(I/O.)168 2742 A
3375 V
(04103)210 1122 A
1482(*)S
3465 V
(04104)210 1122 A
1482(*)S
(Created:)336 1566 A
3555 V
(04105)210 1122 A
1482(*)S
(Apr)126 1776 A
(08,)126 1944 A
(2004)168 2112 A
2322(by)S
(Jorrit)252 2448 A
2742(N.)S
(Herder)252 2868 A
3645 V
(04106)210 1122 A
1482(*/)S
3735 V
(04107)210 1122 A
3825 V
(04108)210 1122 A
(#ifndef)294 1440 A
(_DEVIO_H)336 1776 A
3915 V
(04109)210 1122 A
(#define)294 1440 A
(_DEVIO_H)336 1776 A
4005 V
(04110)210 1122 A
4095 V
(04111)210 1122 A
(#include)336 1440 A
(<minix/sys_config.h>)840 1818 A
2868(/*)S
(needed)252 2994 A
3288(to)S
(include)294 3414 A
(<minix/type.h>)588 3750 A
4380(*/)S
4185 V
(04112)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
2700(/*)S
(u8_t,)210 2826 A
(u16_t,)252 3078 A
(u32_t)210 3372 A
(needed)252 3624 A
3918(*/)S
4275 V
(04113)210 1122 A
4365 V
(04114)210 1122 A
(typedef)294 1440 A
(u16_t)210 1776 A
(port_t;)294 2028 A
4455 V
(04115)210 1122 A
(typedef)294 1440 A
(U16_t)210 1776 A
(Port_t;)294 2028 A
4545 V
(04116)210 1122 A
4635 V
(04117)210 1122 A
1440(/*)S
1566(We)S
(have)168 1692 A
(different)378 1902 A
(granularities)546 2322 A
2910(of)S
(port)168 3036 A
(I/O:)168 3246 A
3456(8,)S
(16,)126 3582 A
3750(32)S
(bits.)210 3876 A
4725 V
(04118)210 1122 A
1482(*)S
(Also)168 1566 A
(see)126 1776 A
(<ibm/portio.h>,)630 1944 A
(which)210 2616 A
(has)126 2868 A
(functions)378 3036 A
(for)126 3456 A
(bytes,)252 3624 A
(words,)252 3918 A
4815 V
(04119)210 1122 A
1482(*)S
(and)126 1566 A
(longs.)252 1734 A
(Hence,)252 2028 A
2322(we)S
(need)168 2448 A
(different)378 2658 A
(\(port,value\)-pair)714 3078 A
(types.)252 3834 A
4905 V
(04120)210 1122 A
1482(*/)S
4995 V
(04121)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
2070({)S
(u16_t)210 2154 A
(port;)210 2406 A
(u8_t)168 2700 A
(value;)252 2910 A
3204(})S
(pvb_pair_t;)462 3288 A
5085 V
(04122)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
2070({)S
(u16_t)210 2154 A
(port;)210 2406 A
(u16_t)210 2658 A
(value;)252 2910 A
3204(})S
(pvw_pair_t;)462 3288 A
5175 V
(04123)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
2070({)S
(u16_t)210 2154 A
(port;)210 2406 A
(u32_t)210 2658 A
(value;)252 2910 A
3204(})S
(pvl_pair_t;)462 3288 A
5265 V
(04124)210 1122 A
5355 V
(04125)210 1122 A
1440(/*)S
(Macro)210 1566 A
(shorthand)378 1818 A
2238(to)S
(set)126 2364 A
(\(port,value\)-pair.)756 2532 A
3330(*/)S
5445 V
(04126)210 1122 A
(#define)294 1440 A
(pv_set\(pv,)420 1776 A
2238(p,)S
2364(v\))S
(\(\(pv\).port)420 2490 A
2952(=)S
(\(p\),)168 3036 A
(\(pv\).value)420 3246 A
3708(=)S
(\(v\)\))168 3792 A
5535 V
(04127)210 1122 A
(#define)294 1440 A
(pv_ptr_set\(pv_ptr,)756 1776 A
2574(p,)S
2700(v\))S
(\(\(pv_ptr\)->port)630 2826 A
3498(=)S
(\(p\),)168 3582 A
(\(pv_ptr\)->value)630 3792 A
4464(=)S
(\(v\)\))168 4548 A
5625 V
(04128)210 1122 A
5715 V
(04129)210 1122 A
(#endif)252 1440 A
1776(/*)S
(_DEVIO_H)336 1902 A
2280(*/)S
5895 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5985 V
(include/minix/dmap.h)840 2676 A
6075 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6255 V
(04200)210 1122 A
(#ifndef)294 1440 A
(_DMAP_H)294 1776 A
6345 V
(04201)210 1122 A
(#define)294 1440 A
(_DMAP_H)294 1776 A
6435 V
(04202)210 1122 A
6525 V
(04203)210 1122 A
(#include)336 1440 A
(<minix/sys_config.h>)840 1818 A
6615 V
(04204)210 1122 A
(#include)336 1440 A
(<minix/ipc.h>)546 1818 A
6705 V
(04205)210 1122 A
8418 V
EP
%%Page: 48 48
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(48)S
11 R
2275(File:)S
2508(include/minix/dmap.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(04206)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(04207)210 1122 A
1482(*)S
(Device)252 2490 A
(<->)126 2784 A
(Driver)252 2952 A
(Table)210 3246 A
4674(*)S
1935 V
(04208)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(04209)210 1122 A
2115 V
(04210)210 1122 A
1440(/*)S
(Device)252 1566 A
(table.)252 1860 A
(This)168 2196 A
(table)210 2406 A
2658(is)S
(indexed)294 2784 A
3120(by)S
(major)210 3246 A
(device)252 3498 A
(number.)294 3792 A
4170(It)S
(provides)336 4296 A
2205 V
(04211)210 1122 A
1482(*)S
(the)126 1566 A
(link)168 1734 A
(between)294 1944 A
(major)210 2280 A
(device)252 2532 A
(numbers)294 2826 A
(and)126 3162 A
(the)126 3330 A
(routines)336 3498 A
(that)168 3876 A
(process)294 4086 A
(them.)210 4422 A
2295 V
(04212)210 1122 A
1482(*)S
(The)126 1566 A
(table)210 1734 A
(can)126 1986 A
2154(be)S
(update)252 2280 A
(dynamically.)504 2574 A
(The)126 3120 A
(field)210 3288 A
('dmap_flags')504 3540 A
(describe)336 4086 A
4464(an)S
2385 V
(04213)210 1122 A
1482(*)S
(entry's)294 1566 A
(current)294 1902 A
(status)252 2238 A
(and)126 2532 A
(determines)420 2700 A
(what)168 3162 A
(control)294 3372 A
(options)294 3708 A
(are)126 4044 A
(possible.)378 4212 A
2475 V
(04214)210 1122 A
1482(*/)S
2565 V
(04215)210 1122 A
(#define)294 1440 A
(DMAP_MUTABLE)504 1776 A
(0x01)168 2784 A
3120(/*)S
(mapping)294 3246 A
(can)126 3582 A
3750(be)S
(overtaken)378 3876 A
4296(*/)S
2655 V
(04216)210 1122 A
(#define)294 1440 A
(DMAP_BUSY)378 1776 A
(0x02)168 2784 A
3120(/*)S
(driver)252 3246 A
(busy)168 3540 A
(with)168 3750 A
(request)294 3960 A
4296(*/)S
2745 V
(04217)210 1122 A
2835 V
(04218)210 1122 A
(enum)168 1440 A
(dev_style)378 1650 A
2070({)S
(STYLE_DEV,)420 2154 A
(STYLE_NDEV,)462 2616 A
(STYLE_TTY,)420 3120 A
(STYLE_CLONE)462 3582 A
4086(};)S
2925 V
(04219)210 1122 A
3015 V
(04220)210 1122 A
(extern)252 1440 A
(struct)252 1734 A
(dmap)168 2028 A
2238({)S
3105 V
(04221)210 1122 A
(int)126 1524 A
(_PROTOTYPE)420 1692 A
(\(\(*dmap_opcl\),)588 2154 A
(\(int,)210 2784 A
(Dev_t,)252 3036 A
(int,)168 3330 A
(int\))168 3540 A
3750(\);)S
3195 V
(04222)210 1122 A
(void)168 1524 A
(_PROTOTYPE)420 1734 A
(\(\(*dmap_io\),)504 2196 A
(\(int,)210 2742 A
(message)294 2994 A
3330(*\))S
3456(\);)S
3285 V
(04223)210 1122 A
(int)126 1524 A
(dmap_driver;)504 1692 A
3375 V
(04224)210 1122 A
(int)126 1524 A
(dmap_flags;)462 1692 A
3465 V
(04225)210 1122 A
1440(})S
(dmap[];)294 1524 A
3555 V
(04226)210 1122 A
3645 V
(04227)210 1122 A
(/*===========================================================================*)3276 1440 A
3735 V
(04228)210 1122 A
1482(*)S
(Major)210 2490 A
(and)126 2742 A
(minor)210 2910 A
(device)252 3162 A
(numbers)294 3456 A
4674(*)S
3825 V
(04229)210 1122 A
(*===========================================================================*/)3276 1482 A
3915 V
(04230)210 1122 A
4005 V
(04231)210 1122 A
1440(/*)S
(Total)210 1566 A
(number)252 1818 A
2112(of)S
(different)378 2238 A
(devices.)336 2658 A
3036(*/)S
4095 V
(04232)210 1122 A
(#define)294 1440 A
(NR_DEVICES)420 1776 A
2868(32)S
3792(/*)S
(number)252 3918 A
4212(of)S
(\(major\))294 4338 A
(devices)294 4674 A
5010(*/)S
4185 V
(04233)210 1122 A
4275 V
(04234)210 1122 A
1440(/*)S
(Major)210 1566 A
(and)126 1818 A
(minor)210 1986 A
(device)252 2238 A
(numbers)294 2532 A
(for)126 2868 A
(MEMORY)252 3036 A
(driver.)294 3330 A
3666(*/)S
4365 V
(04235)210 1122 A
(#define)294 1440 A
(MEMORY_MAJOR)504 1776 A
2910(1)S
3120(/*)S
(major)210 3246 A
(device)252 3498 A
(for)126 3792 A
(memory)252 3960 A
(devices)294 4254 A
4590(*/)S
4455 V
(04236)210 1122 A
1440(#)S
(define)252 1566 A
(RAM_DEV)294 1860 A
2910(0)S
3120(/*)S
(minor)210 3246 A
(device)252 3498 A
(for)126 3792 A
(/dev/ram)336 3960 A
4338(*/)S
4545 V
(04237)210 1122 A
1440(#)S
(define)252 1566 A
(MEM_DEV)294 1860 A
2910(1)S
3120(/*)S
(minor)210 3246 A
(device)252 3498 A
(for)126 3792 A
(/dev/mem)336 3960 A
4338(*/)S
4635 V
(04238)210 1122 A
1440(#)S
(define)252 1566 A
(KMEM_DEV)336 1860 A
2910(2)S
3120(/*)S
(minor)210 3246 A
(device)252 3498 A
(for)126 3792 A
(/dev/kmem)378 3960 A
4380(*/)S
4725 V
(04239)210 1122 A
1440(#)S
(define)252 1566 A
(NULL_DEV)336 1860 A
2910(3)S
3120(/*)S
(minor)210 3246 A
(device)252 3498 A
(for)126 3792 A
(/dev/null)378 3960 A
4380(*/)S
4815 V
(04240)210 1122 A
1440(#)S
(define)252 1566 A
(BOOT_DEV)336 1860 A
2910(4)S
3120(/*)S
(minor)210 3246 A
(device)252 3498 A
(for)126 3792 A
(/dev/boot)378 3960 A
4380(*/)S
4905 V
(04241)210 1122 A
1440(#)S
(define)252 1566 A
(ZERO_DEV)336 1860 A
2910(5)S
3120(/*)S
(minor)210 3246 A
(device)252 3498 A
(for)126 3792 A
(/dev/zero)378 3960 A
4380(*/)S
4995 V
(04242)210 1122 A
5085 V
(04243)210 1122 A
(#define)294 1440 A
(CTRLR\(n\))336 1776 A
(\(\(n\)==0)294 2154 A
2490(?)S
2574(3)S
2658(:)S
2742(\(8)S
2868(+)S
(2*\(\(n\)-1\)\)\))462 2952 A
3456(/*)S
(magic)210 3582 A
(formula)294 3834 A
4170(*/)S
5175 V
(04244)210 1122 A
5265 V
(04245)210 1122 A
1440(/*)S
(Full)168 1566 A
(device)252 1776 A
(numbers)294 2070 A
(that)168 2406 A
(are)126 2616 A
(special)294 2784 A
3120(to)S
(the)126 3246 A
(boot)168 3414 A
(monitor)294 3624 A
(and)126 3960 A
(FS.)126 4128 A
4296(*/)S
5355 V
(04246)210 1122 A
1440(#)S
(define)252 1566 A
(DEV_RAM)294 1860 A
(0x0100)252 2700 A
3120(/*)S
(device)252 3246 A
(number)252 3540 A
3834(of)S
(/dev/ram)336 3960 A
4338(*/)S
5445 V
(04247)210 1122 A
1440(#)S
(define)252 1566 A
(DEV_BOOT)336 1860 A
(0x0104)252 2700 A
3120(/*)S
(device)252 3246 A
(number)252 3540 A
3834(of)S
(/dev/boot)378 3960 A
4380(*/)S
5535 V
(04248)210 1122 A
5625 V
(04249)210 1122 A
(#define)294 1440 A
(FLOPPY_MAJOR)504 1776 A
2910(2)S
3120(/*)S
(major)210 3246 A
(device)252 3498 A
(for)126 3792 A
(floppy)252 3960 A
(disks)210 4254 A
4506(*/)S
5715 V
(04250)210 1122 A
(#define)294 1440 A
(TTY_MAJOR)378 1776 A
2910(4)S
3120(/*)S
(major)210 3246 A
(device)252 3498 A
(for)126 3792 A
(ttys)168 3960 A
4170(*/)S
5805 V
(04251)210 1122 A
(#define)294 1440 A
(CTTY_MAJOR)420 1776 A
2910(5)S
3120(/*)S
(major)210 3246 A
(device)252 3498 A
(for)126 3792 A
(/dev/tty)336 3960 A
4338(*/)S
5895 V
(04252)210 1122 A
5985 V
(04253)210 1122 A
(#define)294 1440 A
(INET_MAJOR)420 1776 A
2910(7)S
3120(/*)S
(major)210 3246 A
(device)252 3498 A
(for)126 3792 A
(inet)168 3960 A
4170(*/)S
6075 V
(04254)210 1122 A
6165 V
(04255)210 1122 A
(#define)294 1440 A
(LOG_MAJOR)378 1776 A
2868(15)S
3120(/*)S
(major)210 3246 A
(device)252 3498 A
(for)126 3792 A
(log)126 3960 A
(driver)252 4128 A
4422(*/)S
6255 V
(04256)210 1122 A
1440(#)S
(define)252 1566 A
(IS_KLOG_DEV)462 1860 A
2910(0)S
3120(/*)S
(minor)210 3246 A
(device)252 3498 A
(for)126 3792 A
(/dev/klog)378 3960 A
4380(*/)S
6345 V
(04257)210 1122 A
6435 V
(04258)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_DMAP_H)294 1860 A
2196(*/)S
8418 V
EP
%%Page: 49 49
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2309(File:)S
2542(include/ibm/portio.h)S
12 B
4560(49)S
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(include/ibm/portio.h)840 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(04300)210 1122 A
1440(/*)S
2295 V
(04301)210 1122 A
(ibm/portio.h)504 1440 A
2385 V
(04302)210 1122 A
2475 V
(04303)210 1122 A
(Created:)336 1440 A
(Jan)126 2112 A
(15,)126 2280 A
(1992)168 2448 A
2658(by)S
(Philip)252 2784 A
(Homburg)294 3078 A
2565 V
(04304)210 1122 A
1440(*/)S
2655 V
(04305)210 1122 A
2745 V
(04306)210 1122 A
(#ifndef)294 1440 A
(_PORTIO_H_)420 1776 A
2835 V
(04307)210 1122 A
(#define)294 1440 A
(_PORTIO_H_)420 1776 A
2925 V
(04308)210 1122 A
3015 V
(04309)210 1122 A
(#ifndef)294 1440 A
(_TYPES_H)336 1776 A
3105 V
(04310)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
3195 V
(04311)210 1122 A
(#endif)252 1440 A
3285 V
(04312)210 1122 A
3375 V
(04313)210 1122 A
(unsigned)336 1440 A
(inb\(U16_t)378 1818 A
(_port\);)294 2238 A
3465 V
(04314)210 1122 A
(unsigned)336 1440 A
(inw\(U16_t)378 1818 A
(_port\);)294 2238 A
3555 V
(04315)210 1122 A
(unsigned)336 1440 A
(inl\(U32_t)378 1818 A
(_port\);)294 2238 A
3645 V
(04316)210 1122 A
(void)168 1440 A
(outb\(U16_t)420 1650 A
(_port,)252 2112 A
(U8_t)168 2406 A
(_value\);)336 2616 A
3735 V
(04317)210 1122 A
(void)168 1440 A
(outw\(U16_t)420 1650 A
(_port,)252 2112 A
(U16_t)210 2406 A
(_value\);)336 2658 A
3825 V
(04318)210 1122 A
(void)168 1440 A
(outl\(U16_t)420 1650 A
(_port,)252 2112 A
(U32_t)210 2406 A
(_value\);)336 2658 A
3915 V
(04319)210 1122 A
(void)168 1440 A
(insb\(U16_t)420 1650 A
(_port,)252 2112 A
(void)168 2406 A
(*_buf,)252 2616 A
(size_t)252 2910 A
(_count\);)336 3204 A
4005 V
(04320)210 1122 A
(void)168 1440 A
(insw\(U16_t)420 1650 A
(_port,)252 2112 A
(void)168 2406 A
(*_buf,)252 2616 A
(size_t)252 2910 A
(_count\);)336 3204 A
4095 V
(04321)210 1122 A
(void)168 1440 A
(insl\(U16_t)420 1650 A
(_port,)252 2112 A
(void)168 2406 A
(*_buf,)252 2616 A
(size_t)252 2910 A
(_count\);)336 3204 A
4185 V
(04322)210 1122 A
(void)168 1440 A
(outsb\(U16_t)462 1650 A
(_port,)252 2154 A
(void)168 2448 A
(*_buf,)252 2658 A
(size_t)252 2952 A
(_count\);)336 3246 A
4275 V
(04323)210 1122 A
(void)168 1440 A
(outsw\(U16_t)462 1650 A
(_port,)252 2154 A
(void)168 2448 A
(*_buf,)252 2658 A
(size_t)252 2952 A
(_count\);)336 3246 A
4365 V
(04324)210 1122 A
(void)168 1440 A
(outsl\(U16_t)462 1650 A
(_port,)252 2154 A
(void)168 2448 A
(*_buf,)252 2658 A
(size_t)252 2952 A
(_count\);)336 3246 A
4455 V
(04325)210 1122 A
(void)168 1440 A
(intr_disable\(void\);)798 1650 A
4545 V
(04326)210 1122 A
(void)168 1440 A
(intr_enable\(void\);)756 1650 A
4635 V
(04327)210 1122 A
4725 V
(04328)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_PORTIO_H_)420 1860 A
2322(*/)S
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(include/ibm/interrupt.h)966 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(04400)210 1122 A
1440(/*)S
(Interrupt)378 1566 A
(numbers)294 1986 A
(and)126 2322 A
(hardware)336 2490 A
(vectors.)336 2868 A
3246(*/)S
5445 V
(04401)210 1122 A
5535 V
(04402)210 1122 A
(#ifndef)294 1440 A
(_INTERRUPT_H)504 1776 A
5625 V
(04403)210 1122 A
(#define)294 1440 A
(_INTERRUPT_H)504 1776 A
5715 V
(04404)210 1122 A
5805 V
(04405)210 1122 A
(#if)126 1440 A
(\(CHIP)210 1608 A
1860(==)S
(INTEL\))252 1986 A
5895 V
(04406)210 1122 A
5985 V
(04407)210 1122 A
1440(/*)S
(8259A)210 1566 A
(interrupt)378 1818 A
(controller)420 2238 A
(ports.)252 2700 A
2994(*/)S
6075 V
(04408)210 1122 A
(#define)294 1440 A
(INT_CTL)294 1776 A
(0x20)168 2448 A
2784(/*)S
(I/O)126 2910 A
(port)168 3078 A
(for)126 3288 A
(interrupt)378 3456 A
(controller)420 3876 A
4338(*/)S
6165 V
(04409)210 1122 A
(#define)294 1440 A
(INT_CTLMASK)462 1776 A
(0x21)168 2448 A
2784(/*)S
(setting)294 2910 A
(bits)168 3246 A
3456(in)S
(this)168 3582 A
(port)168 3792 A
(disables)336 4002 A
(ints)168 4380 A
4590(*/)S
6255 V
(04410)210 1122 A
(#define)294 1440 A
(INT2_CTL)336 1776 A
(0xA0)168 2448 A
2784(/*)S
(I/O)126 2910 A
(port)168 3078 A
(for)126 3288 A
(second)252 3456 A
(interrupt)378 3750 A
(controller)420 4170 A
4632(*/)S
6345 V
(04411)210 1122 A
(#define)294 1440 A
(INT2_CTLMASK)504 1776 A
(0xA1)168 2448 A
2784(/*)S
(setting)294 2910 A
(bits)168 3246 A
3456(in)S
(this)168 3582 A
(port)168 3792 A
(disables)336 4002 A
(ints)168 4380 A
4590(*/)S
6435 V
(04412)210 1122 A
6525 V
(04413)210 1122 A
1440(/*)S
(Magic)210 1566 A
(numbers)294 1818 A
(for)126 2154 A
(interrupt)378 2322 A
(controller.)462 2742 A
3246(*/)S
6615 V
(04414)210 1122 A
(#define)294 1440 A
(END_OF_INT)420 1776 A
(0x20)168 2448 A
2784(/*)S
(code)168 2910 A
(used)168 3120 A
3330(to)S
(re-enable)378 3456 A
(after)210 3876 A
4128(an)S
(interrupt)378 4254 A
4674(*/)S
6705 V
(04415)210 1122 A
6795 V
(04416)210 1122 A
1440(/*)S
(Interrupt)378 1566 A
(vectors)294 1986 A
(defined/reserved)672 2322 A
3036(by)S
(processor.)420 3162 A
3624(*/)S
6885 V
(04417)210 1122 A
(#define)294 1440 A
(DIVIDE_VECTOR)546 1776 A
2574(0)S
2784(/*)S
(divide)252 2910 A
(error)210 3204 A
3456(*/)S
6975 V
(04418)210 1122 A
(#define)294 1440 A
(DEBUG_VECTOR)504 1776 A
2574(1)S
2784(/*)S
(single)252 2910 A
(step)168 3204 A
(\(trace\))294 3414 A
3750(*/)S
7065 V
(04419)210 1122 A
(#define)294 1440 A
(NMI_VECTOR)420 1776 A
2574(2)S
2784(/*)S
(non-maskable)504 2910 A
(interrupt)378 3456 A
3876(*/)S
8418 V
EP
%%Page: 50 50
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(50)S
11 R
2250(File:)S
2483(include/ibm/interrupt.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(04420)210 1122 A
(#define)294 1440 A
(BREAKPOINT_VECTOR)714 1776 A
2574(3)S
2784(/*)S
(software)336 2910 A
(breakpoint)420 3288 A
3750(*/)S
1845 V
(04421)210 1122 A
(#define)294 1440 A
(OVERFLOW_VECTOR)630 1776 A
2574(4)S
2784(/*)S
(from)168 2910 A
(INTO)168 3120 A
3330(*/)S
1935 V
(04422)210 1122 A
2025 V
(04423)210 1122 A
1440(/*)S
(Fixed)210 1566 A
(system)252 1818 A
(call)168 2112 A
(vector.)294 2322 A
2658(*/)S
2115 V
(04424)210 1122 A
(#define)294 1440 A
(SYS_VECTOR)420 1776 A
2532(32)S
2784(/*)S
(system)252 2910 A
(calls)210 3204 A
(are)126 3456 A
(made)168 3624 A
(with)168 3834 A
(int)126 4044 A
(SYSVEC)252 4212 A
4506(*/)S
2205 V
(04425)210 1122 A
(#define)294 1440 A
(SYS386_VECTOR)546 1776 A
2532(33)S
2784(/*)S
(except)252 2910 A
(386)126 3204 A
(system)252 3372 A
(calls)210 3666 A
(use)126 3918 A
(this)168 4086 A
4296(*/)S
2295 V
(04426)210 1122 A
(#define)294 1440 A
(LEVEL0_VECTOR)546 1776 A
2532(34)S
2784(/*)S
(for)126 2910 A
(execution)378 3078 A
3498(of)S
3624(a)S
(function)336 3708 A
4086(at)S
(level)210 4212 A
4464(0)S
4548(*/)S
2385 V
(04427)210 1122 A
2475 V
(04428)210 1122 A
1440(/*)S
(Suitable)336 1566 A
(irq)126 1944 A
(bases)210 2112 A
(for)126 2364 A
(hardware)336 2532 A
(interrupts.)462 2910 A
(Reprogram)378 3456 A
(the)126 3876 A
(8259\(s\))294 4044 A
(from)168 4380 A
2565 V
(04429)210 1122 A
1482(*)S
(the)126 1566 A
1734(PC)S
(BIOS)168 1860 A
(defaults)336 2070 A
(since)210 2448 A
(the)126 2700 A
(BIOS)168 2868 A
(doesn't)294 3078 A
(respect)294 3414 A
(all)126 3750 A
(the)126 3918 A
(processor's)462 4086 A
2655 V
(04430)210 1122 A
1482(*)S
(reserved)336 1566 A
(vectors)294 1944 A
2280(\(0)S
2406(to)S
(31\).)168 2532 A
2745 V
(04431)210 1122 A
1482(*/)S
2835 V
(04432)210 1122 A
(#define)294 1440 A
(BIOS_IRQ0_VEC)546 1776 A
(0x08)168 2448 A
2784(/*)S
(base)168 2910 A
3120(of)S
(IRQ0-7)252 3246 A
(vectors)294 3540 A
(used)168 3876 A
4086(by)S
(BIOS)168 4212 A
4422(*/)S
2925 V
(04433)210 1122 A
(#define)294 1440 A
(BIOS_IRQ8_VEC)546 1776 A
(0x70)168 2448 A
2784(/*)S
(base)168 2910 A
3120(of)S
(IRQ8-15)294 3246 A
(vectors)294 3582 A
(used)168 3918 A
4128(by)S
(BIOS)168 4254 A
4464(*/)S
3015 V
(04434)210 1122 A
(#define)294 1440 A
(IRQ0_VECTOR)462 1776 A
(0x50)168 2448 A
2784(/*)S
(nice)168 2910 A
(vectors)294 3120 A
3456(to)S
(relocate)336 3582 A
(IRQ0-7)252 3960 A
4254(to)S
4380(*/)S
3105 V
(04435)210 1122 A
(#define)294 1440 A
(IRQ8_VECTOR)462 1776 A
(0x70)168 2448 A
2784(/*)S
2910(no)S
(need)168 3036 A
3246(to)S
(move)168 3372 A
(IRQ8-15)294 3582 A
3918(*/)S
3195 V
(04436)210 1122 A
3285 V
(04437)210 1122 A
1440(/*)S
(Hardware)336 1566 A
(interrupt)378 1944 A
(numbers.)336 2364 A
2742(*/)S
3375 V
(04438)210 1122 A
(#define)294 1440 A
(NR_IRQ_VECTORS)588 1776 A
2532(16)S
3465 V
(04439)210 1122 A
(#define)294 1440 A
(CLOCK_IRQ)378 1776 A
2574(0)S
3555 V
(04440)210 1122 A
(#define)294 1440 A
(KEYBOARD_IRQ)504 1776 A
2574(1)S
3645 V
(04441)210 1122 A
(#define)294 1440 A
(CASCADE_IRQ)462 1776 A
2574(2)S
2784(/*)S
(cascade)294 2910 A
(enable)252 3246 A
(for)126 3540 A
(2nd)126 3708 A
3876(AT)S
(controller)420 4002 A
4464(*/)S
3735 V
(04442)210 1122 A
(#define)294 1440 A
(ETHER_IRQ)378 1776 A
2574(3)S
2784(/*)S
(default)294 2910 A
(ethernet)336 3246 A
(interrupt)378 3624 A
(vector)252 4044 A
4338(*/)S
3825 V
(04443)210 1122 A
(#define)294 1440 A
(SECONDARY_IRQ)546 1776 A
2574(3)S
2784(/*)S
(RS232)210 2910 A
(interrupt)378 3162 A
(vector)252 3582 A
(for)126 3876 A
(port)168 4044 A
4254(2)S
4338(*/)S
3915 V
(04444)210 1122 A
(#define)294 1440 A
(RS232_IRQ)378 1776 A
2574(4)S
2784(/*)S
(RS232)210 2910 A
(interrupt)378 3162 A
(vector)252 3582 A
(for)126 3876 A
(port)168 4044 A
4254(1)S
4338(*/)S
4005 V
(04445)210 1122 A
(#define)294 1440 A
(XT_WINI_IRQ)462 1776 A
2574(5)S
2784(/*)S
2910(xt)S
(winchester)420 3036 A
3498(*/)S
4095 V
(04446)210 1122 A
(#define)294 1440 A
(FLOPPY_IRQ)420 1776 A
2574(6)S
2784(/*)S
(floppy)252 2910 A
(disk)168 3204 A
3414(*/)S
4185 V
(04447)210 1122 A
(#define)294 1440 A
(PRINTER_IRQ)462 1776 A
2574(7)S
4275 V
(04448)210 1122 A
(#define)294 1440 A
(AT_WINI_0_IRQ)546 1776 A
2532(14)S
2784(/*)S
2910(at)S
(winchester)420 3036 A
(controller)420 3498 A
3960(0)S
4044(*/)S
4365 V
(04449)210 1122 A
(#define)294 1440 A
(AT_WINI_1_IRQ)546 1776 A
2532(15)S
2784(/*)S
2910(at)S
(winchester)420 3036 A
(controller)420 3498 A
3960(1)S
4044(*/)S
4455 V
(04450)210 1122 A
4545 V
(04451)210 1122 A
1440(/*)S
(Interrupt)378 1566 A
(number)252 1986 A
2280(to)S
(hardware)336 2406 A
(vector.)294 2784 A
3120(*/)S
4635 V
(04452)210 1122 A
(#define)294 1440 A
(BIOS_VECTOR\(irq\))672 1776 A
2784(\\)S
4725 V
(04453)210 1122 A
(\(\(\(irq\))294 1776 A
2112(<)S
2196(8)S
2280(?)S
(BIOS_IRQ0_VEC)546 2364 A
2952(:)S
(BIOS_IRQ8_VEC\))588 3036 A
3666(+)S
(\(\(irq\))252 3750 A
4044(&)S
(0x07\)\))252 4128 A
4815 V
(04454)210 1122 A
(#define)294 1440 A
(VECTOR\(irq\))462 1776 A
2448(\\)S
4905 V
(04455)210 1122 A
(\(\(\(irq\))294 1776 A
2112(<)S
2196(8)S
2280(?)S
(IRQ0_VECTOR)462 2364 A
2868(:)S
(IRQ8_VECTOR\))504 2952 A
3498(+)S
(\(\(irq\))252 3582 A
3876(&)S
(0x07\)\))252 3960 A
4995 V
(04456)210 1122 A
5085 V
(04457)210 1122 A
(#endif)252 1440 A
1734(/*)S
(\(CHIP)210 1860 A
2112(==)S
(INTEL\))252 2238 A
2532(*/)S
5175 V
(04458)210 1122 A
5265 V
(04459)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_INTERRUPT_H)504 1860 A
2406(*/)S
5445 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5535 V
(include/ibm/ports.h)798 2676 A
5625 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5805 V
(04500)210 1122 A
1440(/*)S
(Addresses)378 1566 A
(and)126 1986 A
(magic)210 2154 A
(numbers)294 2406 A
(for)126 2742 A
(miscellaneous)546 2910 A
(ports.)252 3498 A
3792(*/)S
5895 V
(04501)210 1122 A
5985 V
(04502)210 1122 A
(#ifndef)294 1440 A
(_PORTS_H)336 1776 A
6075 V
(04503)210 1122 A
(#define)294 1440 A
(_PORTS_H)336 1776 A
6165 V
(04504)210 1122 A
6255 V
(04505)210 1122 A
(#if)126 1440 A
(\(CHIP)210 1608 A
1860(==)S
(INTEL\))252 1986 A
6345 V
(04506)210 1122 A
6435 V
(04507)210 1122 A
1440(/*)S
(Miscellaneous)546 1566 A
(ports.)252 2154 A
2448(*/)S
6525 V
(04508)210 1122 A
(#define)294 1440 A
(PCR)126 1776 A
(0x65)168 2448 A
2784(/*)S
(Planar)252 2910 A
(Control)294 3204 A
(Register)336 3540 A
3918(*/)S
6615 V
(04509)210 1122 A
(#define)294 1440 A
(PORT_B)252 1776 A
(0x61)168 2448 A
2784(/*)S
(I/O)126 2910 A
(port)168 3078 A
(for)126 3288 A
(8255)168 3456 A
(port)168 3666 A
3876(B)S
(\(kbd,)210 3960 A
(beeper...\))420 4212 A
4674(*/)S
6705 V
(04510)210 1122 A
(#define)294 1440 A
(TIMER0)252 1776 A
(0x40)168 2448 A
2784(/*)S
(I/O)126 2910 A
(port)168 3078 A
(for)126 3288 A
(timer)210 3456 A
(channel)294 3708 A
4044(0)S
4128(*/)S
6795 V
(04511)210 1122 A
(#define)294 1440 A
(TIMER2)252 1776 A
(0x42)168 2448 A
2784(/*)S
(I/O)126 2910 A
(port)168 3078 A
(for)126 3288 A
(timer)210 3456 A
(channel)294 3708 A
4044(2)S
4128(*/)S
6885 V
(04512)210 1122 A
(#define)294 1440 A
(TIMER_MODE)420 1776 A
(0x43)168 2448 A
2784(/*)S
(I/O)126 2910 A
(port)168 3078 A
(for)126 3288 A
(timer)210 3456 A
(mode)168 3708 A
(control)294 3918 A
4254(*/)S
6975 V
(04513)210 1122 A
7065 V
(04514)210 1122 A
(#endif)252 1440 A
1734(/*)S
(\(CHIP)210 1860 A
2112(==)S
(INTEL\))252 2238 A
2532(*/)S
8418 V
EP
%%Page: 51 51
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2331(File:)S
2564(include/ibm/ports.h)S
12 B
4560(51)S
1755 V
7 LST
(04515)210 1122 A
1845 V
(04516)210 1122 A
(#endif)252 1440 A
1734(/*)S
(_PORTS_H)336 1860 A
2238(*/)S
2295 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2385 V
(kernel/kernel.h)630 2676 A
2475 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2655 V
(04600)210 1122 A
(#ifndef)294 1440 A
(KERNEL_H)336 1776 A
2745 V
(04601)210 1122 A
(#define)294 1440 A
(KERNEL_H)336 1776 A
2835 V
(04602)210 1122 A
2925 V
(04603)210 1122 A
1440(/*)S
(This)168 1566 A
1776(is)S
(the)126 1902 A
(master)252 2070 A
(header)252 2364 A
(for)126 2658 A
(the)126 2826 A
(kernel.)294 2994 A
3372(It)S
(includes)336 3498 A
(some)168 3876 A
(other)210 4086 A
(files)210 4338 A
3015 V
(04604)210 1122 A
1482(*)S
(and)126 1566 A
(defines)294 1734 A
(the)126 2070 A
(principal)378 2238 A
(constants.)420 2658 A
3105 V
(04605)210 1122 A
1482(*/)S
3195 V
(04606)210 1122 A
(#define)294 1440 A
(_POSIX_SOURCE)546 1776 A
2574(1)S
2784(/*)S
(tell)168 2910 A
(headers)294 3120 A
3456(to)S
(include)294 3582 A
(POSIX)210 3918 A
(stuff)210 4170 A
4422(*/)S
3285 V
(04607)210 1122 A
(#define)294 1440 A
(_MINIX)252 1776 A
2574(1)S
2784(/*)S
(tell)168 2910 A
(headers)294 3120 A
3456(to)S
(include)294 3582 A
(MINIX)210 3918 A
(stuff)210 4170 A
4422(*/)S
3375 V
(04608)210 1122 A
(#define)294 1440 A
(_SYSTEM)294 1776 A
2574(1)S
2784(/*)S
(tell)168 2910 A
(headers)294 3120 A
(that)168 3456 A
(this)168 3666 A
3876(is)S
(the)126 4002 A
(kernel)252 4170 A
4464(*/)S
3465 V
(04609)210 1122 A
3555 V
(04610)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(are)126 2154 A
2322(so)S
(basic,)252 2448 A
(all)126 2742 A
(the)126 2910 A
(*.c)126 3078 A
(files)210 3246 A
(get)126 3498 A
(them)168 3666 A
(automatically.)588 3876 A
4506(*/)S
3645 V
(04611)210 1122 A
(#include)336 1440 A
(<minix/config.h>)672 1818 A
2784(/*)S
(global)252 2910 A
(configuration,)588 3204 A
(MUST)168 3834 A
4044(be)S
(first)210 4170 A
4422(*/)S
3735 V
(04612)210 1122 A
(#include)336 1440 A
(<ansi.h>)336 1818 A
2784(/*)S
2910(C)S
(style:)252 2994 A
(ANSI)168 3288 A
3498(or)S
(K&R,)168 3624 A
(MUST)168 3834 A
4044(be)S
(second)252 4170 A
4464(*/)S
3825 V
(04613)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
2784(/*)S
(general)294 2910 A
(system)252 3246 A
(types)210 3540 A
3792(*/)S
3915 V
(04614)210 1122 A
(#include)336 1440 A
(<minix/const.h>)630 1818 A
2784(/*)S
(MINIX)210 2910 A
(specific)336 3162 A
(constants)378 3540 A
3960(*/)S
4005 V
(04615)210 1122 A
(#include)336 1440 A
(<minix/type.h>)588 1818 A
2784(/*)S
(MINIX)210 2910 A
(specific)336 3162 A
(types,)252 3540 A
(e.g.)168 3834 A
(message)294 4044 A
4380(*/)S
4095 V
(04616)210 1122 A
(#include)336 1440 A
(<minix/ipc.h>)546 1818 A
2784(/*)S
(MINIX)210 2910 A
(run-time)336 3162 A
(system)252 3540 A
3834(*/)S
4185 V
(04617)210 1122 A
(#include)336 1440 A
(<timers.h>)420 1818 A
2784(/*)S
(watchdog)336 2910 A
(timer)210 3288 A
(management)420 3540 A
4002(*/)S
4275 V
(04618)210 1122 A
(#include)336 1440 A
(<errno.h>)378 1818 A
2784(/*)S
(return)252 2910 A
(codes)210 3204 A
(and)126 3456 A
(error)210 3624 A
(numbers)294 3876 A
4212(*/)S
4365 V
(04619)210 1122 A
(#include)336 1440 A
(<ibm/portio.h>)588 1818 A
2784(/*)S
(device)252 2910 A
(I/O)126 3204 A
(and)126 3372 A
(toggle)252 3540 A
(interrupts)420 3834 A
4296(*/)S
4455 V
(04620)210 1122 A
4545 V
(04621)210 1122 A
1440(/*)S
(Important)378 1566 A
(kernel)252 1986 A
(header)252 2280 A
(files.)252 2574 A
2868(*/)S
4635 V
(04622)210 1122 A
(#include)336 1440 A
("config.h")420 1818 A
2784(/*)S
(configuration,)588 2910 A
(MUST)168 3540 A
3750(be)S
(first)210 3876 A
4128(*/)S
4725 V
(04623)210 1122 A
(#include)336 1440 A
("const.h")378 1818 A
2784(/*)S
(constants,)420 2910 A
(MUST)168 3372 A
3582(be)S
(second)252 3708 A
4002(*/)S
4815 V
(04624)210 1122 A
(#include)336 1440 A
("type.h")336 1818 A
2784(/*)S
(type)168 2910 A
(definitions,)504 3120 A
(MUST)168 3666 A
3876(be)S
(third)210 4002 A
4254(*/)S
4905 V
(04625)210 1122 A
(#include)336 1440 A
("proto.h")378 1818 A
2784(/*)S
(function)336 2910 A
(prototypes)420 3288 A
3750(*/)S
4995 V
(04626)210 1122 A
(#include)336 1440 A
("glo.h")294 1818 A
2784(/*)S
(global)252 2910 A
(variables)378 3204 A
3624(*/)S
5085 V
(04627)210 1122 A
(#include)336 1440 A
("ipc.h")294 1818 A
2784(/*)S
(IPC)126 2910 A
(constants)378 3078 A
3498(*/)S
5175 V
(04628)210 1122 A
1440(/*)S
(#include)336 1566 A
("debug.h")378 1944 A
2364(*/)S
2784(/*)S
(debugging,)420 2910 A
(MUST)168 3372 A
3582(be)S
(last)168 3708 A
(kernel)252 3918 A
(header)252 4212 A
4506(*/)S
5265 V
(04629)210 1122 A
5355 V
(04630)210 1122 A
(#endif)252 1440 A
1734(/*)S
(KERNEL_H)336 1860 A
2238(*/)S
5445 V
(04631)210 1122 A
5895 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5985 V
(kernel/config.h)630 2676 A
6075 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6255 V
(04700)210 1122 A
(#ifndef)294 1440 A
(CONFIG_H)336 1776 A
6345 V
(04701)210 1122 A
(#define)294 1440 A
(CONFIG_H)336 1776 A
6435 V
(04702)210 1122 A
6525 V
(04703)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(defines)294 1986 A
(the)126 2322 A
(kernel)252 2490 A
(configuration.)588 2784 A
3414(It)S
(allows)252 3540 A
3834(to)S
(set)126 3960 A
(sizes)210 4128 A
4380(of)S
(some)168 4506 A
6615 V
(04704)210 1122 A
1482(*)S
(kernel)252 1566 A
(buffers)294 1860 A
(and)126 2196 A
2364(to)S
(enable)252 2490 A
2784(or)S
(disable)294 2910 A
(debugging)378 3246 A
(code,)210 3666 A
(timing)252 3918 A
(features,)378 4212 A
6705 V
(04705)210 1122 A
1482(*)S
(and)126 1566 A
(individual)420 1734 A
(kernel)252 2196 A
(calls.)252 2490 A
6795 V
(04706)210 1122 A
1482(*)S
6885 V
(04707)210 1122 A
1482(*)S
(Changes:)336 1566 A
6975 V
(04708)210 1122 A
1482(*)S
(Jul)126 1650 A
(11,)126 1818 A
(2005)168 1986 A
(Created.)336 2448 A
(\(Jorrit)294 2868 A
3204(N.)S
(Herder\))294 3330 A
7065 V
(04709)210 1122 A
1482(*/)S
8418 V
EP
%%Page: 52 52
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(52)S
11 R
2426(File:)S
2659(kernel/config.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(04710)210 1122 A
1845 V
(04711)210 1122 A
1440(/*)S
1566(In)S
(embedded)336 1692 A
(and)126 2070 A
(sensor)252 2238 A
(applications,)546 2532 A
(not)126 3120 A
(all)126 3288 A
(the)126 3456 A
(kernel)252 3624 A
(calls)210 3918 A
(may)126 4170 A
4338(be)S
1935 V
(04712)210 1122 A
1482(*)S
(needed.)294 1566 A
1902(In)S
(this)168 2028 A
(section)294 2238 A
(you)126 2574 A
(can)126 2742 A
(specify)294 2910 A
(which)210 3246 A
(kernel)252 3498 A
(calls)210 3792 A
(are)126 4044 A
(needed)252 4212 A
2025 V
(04713)210 1122 A
1482(*)S
(and)126 1566 A
(which)210 1734 A
(are)126 1986 A
(not.)168 2154 A
(The)126 2364 A
(code)168 2532 A
(for)126 2742 A
(unneeded)336 2910 A
(kernel)252 3288 A
(calls)210 3582 A
3834(is)S
(not)126 3960 A
(included)336 4128 A
4506(in)S
2115 V
(04714)210 1122 A
1482(*)S
(the)126 1566 A
(system)252 1734 A
(binary,)294 2028 A
(making)252 2364 A
2658(it)S
(smaller.)336 2784 A
3162(If)S
(you)126 3288 A
(are)126 3456 A
(not)126 3624 A
(sure,)210 3792 A
4044(it)S
4170(is)S
(best)168 4296 A
2205 V
(04715)210 1122 A
1482(*)S
1566(to)S
(keep)168 1692 A
(all)126 1902 A
(kernel)252 2070 A
(calls)210 2364 A
(enabled.)336 2616 A
2295 V
(04716)210 1122 A
1482(*/)S
2385 V
(04717)210 1122 A
(#define)294 1440 A
(USE_FORK)336 1776 A
2574(1)S
2784(/*)S
(fork)168 2910 A
3120(a)S
(new)126 3204 A
(process)294 3372 A
3708(*/)S
2475 V
(04718)210 1122 A
(#define)294 1440 A
(USE_NEWMAP)420 1776 A
2574(1)S
2784(/*)S
(set)126 2910 A
3078(a)S
(new)126 3162 A
(memory)252 3330 A
(map)126 3624 A
3792(*/)S
2565 V
(04719)210 1122 A
(#define)294 1440 A
(USE_EXEC)336 1776 A
2574(1)S
2784(/*)S
(update)252 2910 A
(process)294 3204 A
(after)210 3540 A
(execute)294 3792 A
4128(*/)S
2655 V
(04720)210 1122 A
(#define)294 1440 A
(USE_EXIT)336 1776 A
2574(1)S
2784(/*)S
(clean)210 2910 A
3162(up)S
(after)210 3288 A
(process)294 3540 A
(exit)168 3876 A
4086(*/)S
2745 V
(04721)210 1122 A
(#define)294 1440 A
(USE_TRACE)378 1776 A
2574(1)S
2784(/*)S
(process)294 2910 A
(information)462 3246 A
(and)126 3750 A
(tracing)294 3918 A
4254(*/)S
2835 V
(04722)210 1122 A
(#define)294 1440 A
(USE_GETKSIG)462 1776 A
2574(1)S
2784(/*)S
(retrieve)336 2910 A
(pending)294 3288 A
(kernel)252 3624 A
(signals)294 3918 A
4254(*/)S
2925 V
(04723)210 1122 A
(#define)294 1440 A
(USE_ENDKSIG)462 1776 A
2574(1)S
2784(/*)S
(finish)252 2910 A
(pending)294 3204 A
(kernel)252 3540 A
(signals)294 3834 A
4170(*/)S
3015 V
(04724)210 1122 A
(#define)294 1440 A
(USE_KILL)336 1776 A
2574(1)S
2784(/*)S
(send)168 2910 A
3120(a)S
(signal)252 3204 A
3498(to)S
3624(a)S
(process)294 3708 A
4044(*/)S
3105 V
(04725)210 1122 A
(#define)294 1440 A
(USE_SIGSEND)462 1776 A
2574(1)S
2784(/*)S
(send)168 2910 A
(POSIX-style)462 3120 A
(signal)252 3624 A
3918(*/)S
3195 V
(04726)210 1122 A
(#define)294 1440 A
(USE_SIGRETURN)546 1776 A
2574(1)S
2784(/*)S
(sys_sigreturn\(proc_nr,)924 2910 A
(ctxt_ptr,)378 3876 A
(flags\))252 4296 A
4590(*/)S
3285 V
(04727)210 1122 A
(#define)294 1440 A
(USE_ABORT)378 1776 A
2574(1)S
2784(/*)S
(shut)168 2910 A
(down)168 3120 A
(MINIX)210 3330 A
3582(*/)S
3375 V
(04728)210 1122 A
(#define)294 1440 A
(USE_GETINFO)462 1776 A
2574(1)S
2784(/*)S
(retrieve)336 2910 A
3288(a)S
(copy)168 3372 A
3582(of)S
(kernel)252 3708 A
(data)168 4002 A
4212(*/)S
3465 V
(04729)210 1122 A
(#define)294 1440 A
(USE_TIMES)378 1776 A
2574(1)S
2784(/*)S
(get)126 2910 A
(process)294 3078 A
(and)126 3414 A
(system)252 3582 A
(time)168 3876 A
(info)168 4086 A
4296(*/)S
3555 V
(04730)210 1122 A
(#define)294 1440 A
(USE_SETALARM)504 1776 A
2574(1)S
2784(/*)S
(schedule)336 2910 A
3288(a)S
(synchronous)462 3372 A
(alarm)210 3876 A
4128(*/)S
3645 V
(04731)210 1122 A
(#define)294 1440 A
(USE_DEVIO)378 1776 A
2574(1)S
2784(/*)S
(read)168 2910 A
3120(or)S
(write)210 3246 A
3498(a)S
(single)252 3582 A
(I/O)126 3876 A
(port)168 4044 A
4254(*/)S
3735 V
(04732)210 1122 A
(#define)294 1440 A
(USE_VDEVIO)420 1776 A
2574(1)S
2784(/*)S
(process)294 2910 A
(vector)252 3246 A
(with)168 3540 A
(I/O)126 3750 A
(requests)336 3918 A
4296(*/)S
3825 V
(04733)210 1122 A
(#define)294 1440 A
(USE_SDEVIO)420 1776 A
2574(1)S
2784(/*)S
(perform)294 2910 A
(I/O)126 3246 A
(request)294 3414 A
3750(on)S
3876(a)S
(buffer)252 3960 A
4254(*/)S
3915 V
(04734)210 1122 A
(#define)294 1440 A
(USE_IRQCTL)420 1776 A
2574(1)S
2784(/*)S
(set)126 2910 A
3078(an)S
(interrupt)378 3204 A
(policy)252 3624 A
3918(*/)S
4005 V
(04735)210 1122 A
(#define)294 1440 A
(USE_SEGCTL)420 1776 A
2574(1)S
2784(/*)S
(set)126 2910 A
3078(up)S
3204(a)S
(remote)252 3288 A
(segment)294 3582 A
3918(*/)S
4095 V
(04736)210 1122 A
(#define)294 1440 A
(USE_PRIVCTL)462 1776 A
2574(1)S
2784(/*)S
(system)252 2910 A
(privileges)420 3204 A
(control)294 3666 A
4002(*/)S
4185 V
(04737)210 1122 A
(#define)294 1440 A
(USE_NICE)336 1776 A
2574(1)S
2784(/*)S
(change)252 2910 A
(scheduling)420 3204 A
(priority)336 3666 A
4044(*/)S
4275 V
(04738)210 1122 A
(#define)294 1440 A
(USE_UMAP)336 1776 A
2574(1)S
2784(/*)S
(map)126 2910 A
(virtual)294 3078 A
3414(to)S
(physical)336 3540 A
(address)294 3918 A
4254(*/)S
4365 V
(04739)210 1122 A
(#define)294 1440 A
(USE_VIRCOPY)462 1776 A
2574(1)S
2784(/*)S
(copy)168 2910 A
(using)210 3120 A
(virtual)294 3372 A
(addressing)420 3708 A
4170(*/)S
4455 V
(04740)210 1122 A
(#define)294 1440 A
(USE_VIRVCOPY)504 1776 A
2574(1)S
2784(/*)S
(vector)252 2910 A
(with)168 3204 A
(virtual)294 3414 A
(copy)168 3750 A
(requests)336 3960 A
4338(*/)S
4545 V
(04741)210 1122 A
(#define)294 1440 A
(USE_PHYSCOPY)504 1776 A
2574(1)S
2784(/*)S
(copy)168 2910 A
(using)210 3120 A
(physical)336 3372 A
(addressing)420 3750 A
4212(*/)S
4635 V
(04742)210 1122 A
(#define)294 1440 A
(USE_PHYSVCOPY)546 1776 A
2574(1)S
2784(/*)S
(vector)252 2910 A
(with)168 3204 A
(physical)336 3414 A
(copy)168 3792 A
(requests)336 4002 A
4380(*/)S
4725 V
(04743)210 1122 A
(#define)294 1440 A
(USE_MEMSET)420 1776 A
2574(1)S
2784(/*)S
(write)210 2910 A
(char)168 3162 A
3372(to)S
3498(a)S
(given)210 3582 A
(memory)252 3834 A
(area)168 4128 A
4338(*/)S
4815 V
(04744)210 1122 A
4905 V
(04745)210 1122 A
1440(/*)S
(Length)252 1566 A
1860(of)S
(program)294 1986 A
(names)210 2322 A
(stored)252 2574 A
2868(in)S
(the)126 2994 A
(process)294 3162 A
(table.)252 3498 A
(This)168 3792 A
4002(is)S
(only)168 4128 A
(used)168 4338 A
4995 V
(04746)210 1122 A
1482(*)S
(for)126 1566 A
(the)126 1734 A
(debugging)378 1902 A
(dumps)210 2322 A
(that)168 2574 A
(can)126 2784 A
2952(be)S
(generated)378 3078 A
(with)168 3498 A
(the)126 3708 A
3876(IS)S
(server.)294 4002 A
(The)126 4338 A
4506(PM)S
5085 V
(04747)210 1122 A
1482(*)S
(server)252 1566 A
(keeps)210 1860 A
(its)126 2112 A
(own)126 2280 A
(copy)168 2448 A
2658(of)S
(the)126 2784 A
(program)294 2952 A
(name.)210 3288 A
5175 V
(04748)210 1122 A
1482(*/)S
5265 V
(04749)210 1122 A
(#define)294 1440 A
(P_NAME_LEN)420 1776 A
2574(8)S
5355 V
(04750)210 1122 A
5445 V
(04751)210 1122 A
1440(/*)S
(Kernel)252 1566 A
(diagnostics)462 1860 A
(are)126 2364 A
(written)294 2532 A
2868(to)S
2994(a)S
(circular)336 3078 A
(buffer.)294 3456 A
(After)210 3792 A
(each)168 4044 A
(message,)336 4254 A
5535 V
(04752)210 1122 A
1482(*)S
1566(a)S
(system)252 1650 A
(server)252 1944 A
2238(is)S
(notified)336 2364 A
(and)126 2742 A
2910(a)S
(copy)168 2994 A
3204(of)S
(the)126 3330 A
(buffer)252 3498 A
(can)126 3792 A
3960(be)S
(retrieved)378 4086 A
4506(to)S
5625 V
(04753)210 1122 A
1482(*)S
(display)294 1566 A
(the)126 1902 A
(message.)336 2070 A
(The)126 2448 A
(buffers)294 2616 A
(size)168 2952 A
(can)126 3162 A
(safely)252 3330 A
3624(be)S
(reduced.)336 3750 A
5715 V
(04754)210 1122 A
1482(*/)S
5805 V
(04755)210 1122 A
(#define)294 1440 A
(KMESS_BUF_SIZE)588 1776 A
(256)126 2490 A
5895 V
(04756)210 1122 A
5985 V
(04757)210 1122 A
1440(/*)S
(Buffer)252 1566 A
1860(to)S
(gather)252 1986 A
(randomness.)462 2280 A
(This)168 2784 A
2994(is)S
(used)168 3120 A
3330(to)S
(generate)336 3456 A
3834(a)S
(random)252 3918 A
(stream)252 4212 A
4506(by)S
6075 V
(04758)210 1122 A
1482(*)S
(the)126 1566 A
(MEMORY)252 1734 A
(driver)252 2028 A
(when)168 2322 A
(reading)294 2532 A
(from)168 2868 A
(/dev/random.)504 3078 A
6165 V
(04759)210 1122 A
1482(*/)S
6255 V
(04760)210 1122 A
(#define)294 1440 A
(RANDOM_ELEMENTS)630 1776 A
2532(32)S
6345 V
(04761)210 1122 A
6435 V
(04762)210 1122 A
1440(/*)S
(This)168 1566 A
(section)294 1776 A
(contains)336 2112 A
(defines)294 2490 A
(for)126 2826 A
(valuable)336 2994 A
(system)252 3372 A
(resources)378 3666 A
(that)168 4086 A
(are)126 4296 A
(used)168 4464 A
6525 V
(04763)210 1122 A
1482(*)S
1566(by)S
(device)252 1692 A
(drivers.)336 1986 A
(The)126 2364 A
(number)252 2532 A
2826(of)S
(elements)336 2952 A
3330(of)S
(the)126 3456 A
(vectors)294 3624 A
3960(is)S
(determined)420 4086 A
4548(by)S
6615 V
(04764)210 1122 A
1482(*)S
(the)126 1566 A
(maximum)294 1734 A
(needed)252 2070 A
2364(by)S
(any)126 2490 A
(given)210 2658 A
(driver.)294 2910 A
(The)126 3246 A
(number)252 3414 A
3708(of)S
(interrupt)378 3834 A
(hooks)210 4254 A
(may)126 4506 A
6705 V
(04765)210 1122 A
1482(*)S
1566(be)S
(incremented)462 1692 A
2196(on)S
(systems)294 2322 A
(with)168 2658 A
(many)168 2868 A
(device)252 3078 A
(drivers.)336 3372 A
6795 V
(04766)210 1122 A
1482(*/)S
6885 V
(04767)210 1122 A
(#define)294 1440 A
(NR_IRQ_HOOKS)504 1776 A
2532(16)S
3120(/*)S
(number)252 3246 A
3540(of)S
(interrupt)378 3666 A
(hooks)210 4086 A
4338(*/)S
6975 V
(04768)210 1122 A
(#define)294 1440 A
(VDEVIO_BUF_SIZE)630 1776 A
2532(64)S
3120(/*)S
(max)126 3246 A
(elements)336 3414 A
(per)126 3792 A
(VDEVIO)252 3960 A
(request)294 4254 A
4590(*/)S
7065 V
(04769)210 1122 A
(#define)294 1440 A
(VCOPY_VEC_SIZE)588 1776 A
2532(16)S
3120(/*)S
(max)126 3246 A
(elements)336 3414 A
(per)126 3792 A
(VCOPY)210 3960 A
(request)294 4212 A
4548(*/)S
8418 V
EP
%%Page: 53 53
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2426(File:)S
2659(kernel/config.h)S
12 B
4560(53)S
1755 V
7 LST
(04770)210 1122 A
1845 V
(04771)210 1122 A
1440(/*)S
(How)126 1566 A
(many)168 1734 A
(bytes)210 1944 A
(for)126 2196 A
(the)126 2364 A
(kernel)252 2532 A
(stack.)252 2826 A
(Space)210 3120 A
(allocated)378 3372 A
3792(in)S
(mpx.s.)252 3918 A
4212(*/)S
1935 V
(04772)210 1122 A
(#define)294 1440 A
(K_STACK_BYTES)546 1776 A
(1024)168 2448 A
2025 V
(04773)210 1122 A
2115 V
(04774)210 1122 A
1440(/*)S
(This)168 1566 A
(section)294 1776 A
(allows)252 2112 A
2406(to)S
(enable)252 2532 A
(kernel)252 2826 A
(debugging)378 3120 A
(and)126 3540 A
(timing)252 3708 A
(functionality.)588 4002 A
2205 V
(04775)210 1122 A
1482(*)S
(For)126 1566 A
(normal)252 1734 A
(operation)378 2028 A
(all)126 2448 A
(options)294 2616 A
(should)252 2952 A
3246(be)S
(disabled.)378 3372 A
2295 V
(04776)210 1122 A
1482(*/)S
2385 V
(04777)210 1122 A
(#define)294 1440 A
(DEBUG_SCHED_CHECK)714 1776 A
2574(0)S
2784(/*)S
(sanity)252 2910 A
(check)210 3204 A
3456(of)S
(scheduling)420 3582 A
(queues)252 4044 A
4338(*/)S
2475 V
(04778)210 1122 A
(#define)294 1440 A
(DEBUG_LOCK_CHECK)672 1776 A
2574(0)S
2784(/*)S
(kernel)252 2910 A
(lock\(\))252 3204 A
(sanity)252 3498 A
(check)210 3792 A
4044(*/)S
2565 V
(04779)210 1122 A
(#define)294 1440 A
(DEBUG_TIME_LOCKS)672 1776 A
2574(0)S
2784(/*)S
(measure)294 2910 A
(time)168 3246 A
(spent)210 3456 A
3708(in)S
(locks)210 3834 A
4086(*/)S
2655 V
(04780)210 1122 A
2745 V
(04781)210 1122 A
(#endif)252 1440 A
1734(/*)S
(CONFIG_H)336 1860 A
2238(*/)S
2835 V
(04782)210 1122 A
3195 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3285 V
(kernel/const.h)588 2676 A
3375 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3555 V
(04800)210 1122 A
1440(/*)S
(General)294 1566 A
(macros)252 1902 A
(and)126 2196 A
(constants)378 2364 A
(used)168 2784 A
2994(by)S
(the)126 3120 A
(kernel.)294 3288 A
3624(*/)S
3645 V
(04801)210 1122 A
(#ifndef)294 1440 A
(CONST_H)294 1776 A
3735 V
(04802)210 1122 A
(#define)294 1440 A
(CONST_H)294 1776 A
3825 V
(04803)210 1122 A
3915 V
(04804)210 1122 A
(#include)336 1440 A
(<ibm/interrupt.h>)714 1818 A
2784(/*)S
(interrupt)378 2910 A
(numbers)294 3330 A
(and)126 3666 A
(hardware)336 3834 A
(vectors)294 4212 A
4548(*/)S
4005 V
(04805)210 1122 A
(#include)336 1440 A
(<ibm/ports.h>)546 1818 A
2784(/*)S
(port)168 2910 A
(addresses)378 3120 A
(and)126 3540 A
(magic)210 3708 A
(numbers)294 3960 A
4296(*/)S
4095 V
(04806)210 1122 A
(#include)336 1440 A
(<ibm/bios.h>)504 1818 A
2784(/*)S
(BIOS)168 2910 A
(addresses,)420 3120 A
(sizes)210 3582 A
(and)126 3834 A
(magic)210 4002 A
(numbers)294 4254 A
4590(*/)S
4185 V
(04807)210 1122 A
(#include)336 1440 A
(<ibm/cpu.h>)462 1818 A
2784(/*)S
(BIOS)168 2910 A
(addresses,)420 3120 A
(sizes)210 3582 A
(and)126 3834 A
(magic)210 4002 A
(numbers)294 4254 A
4590(*/)S
4275 V
(04808)210 1122 A
(#include)336 1440 A
(<minix/config.h>)672 1818 A
4365 V
(04809)210 1122 A
(#include)336 1440 A
("config.h")420 1818 A
4455 V
(04810)210 1122 A
4545 V
(04811)210 1122 A
1440(/*)S
1566(To)S
(translate)378 1692 A
2112(an)S
(address)294 2238 A
2574(in)S
(kernel)252 2700 A
(space)210 2994 A
3246(to)S
3372(a)S
(physical)336 3456 A
(address.)336 3834 A
(This)168 4254 A
4464(is)S
4635 V
(04812)210 1122 A
1482(*)S
(the)126 1566 A
(same)168 1734 A
1944(as)S
(umap_local\(proc_ptr,)840 2070 A
2952(D,)S
(vir,)168 3078 A
(sizeof\(*vir\)\),)588 3288 A
(but)126 3918 A
(less)168 4086 A
(costly.)294 4296 A
4725 V
(04813)210 1122 A
1482(*/)S
4815 V
(04814)210 1122 A
(#define)294 1440 A
(vir2phys\(vir\))546 1776 A
(\(kinfo.data_base)672 2448 A
3162(+)S
(\(vir_bytes\))462 3246 A
(\(vir\)\))252 3750 A
4905 V
(04815)210 1122 A
4995 V
(04816)210 1122 A
1440(/*)S
(Map)126 1566 A
1734(a)S
(process)294 1818 A
(number)252 2154 A
2448(to)S
2574(a)S
(privilege)378 2658 A
(structure)378 3078 A
(id.)126 3498 A
3666(*/)S
5085 V
(04817)210 1122 A
(#define)294 1440 A
(s_nr_to_id\(n\))546 1776 A
(\(NR_TASKS)378 2448 A
2868(+)S
(\(n\))126 2952 A
3120(+)S
3204(1\))S
5175 V
(04818)210 1122 A
5265 V
(04819)210 1122 A
1440(/*)S
(Translate)378 1566 A
1986(a)S
(pointer)294 2070 A
2406(to)S
2532(a)S
(field)210 2616 A
2868(in)S
2994(a)S
(structure)378 3078 A
3498(to)S
3624(a)S
(pointer)294 3708 A
4044(to)S
(the)126 4170 A
(structure)378 4338 A
5355 V
(04820)210 1122 A
1482(*)S
(itself.)294 1566 A
1902(So)S
2028(it)S
(translates)420 2154 A
('&struct_ptr->field')840 2616 A
(back)168 3498 A
3708(to)S
('struct_ptr'.)546 3834 A
5445 V
(04821)210 1122 A
1482(*/)S
5535 V
(04822)210 1122 A
(#define)294 1440 A
(structof\(type,)588 1776 A
(field,)252 2406 A
(ptr\))168 2700 A
2910(\\)S
5625 V
(04823)210 1122 A
(\(\(type)252 1776 A
2070(*\))S
(\(\(\(char)294 2196 A
2532(*\))S
(\(ptr\)\))252 2658 A
2952(-)S
(offsetof\(type,)588 3036 A
(field\)\)\))336 3666 A
5715 V
(04824)210 1122 A
5805 V
(04825)210 1122 A
1440(/*)S
(Constants)378 1566 A
(used)168 1986 A
2196(in)S
(virtual_copy\(\).)630 2322 A
(Values)252 2994 A
(must)168 3288 A
3498(be)S
3624(0)S
(and)126 3708 A
3876(1,)S
(respectively.)546 4002 A
4590(*/)S
5895 V
(04826)210 1122 A
(#define)294 1440 A
(_SRC_)210 1776 A
2112(0)S
5985 V
(04827)210 1122 A
(#define)294 1440 A
(_DST_)210 1776 A
2112(1)S
6075 V
(04828)210 1122 A
6165 V
(04829)210 1122 A
1440(/*)S
(Number)252 1566 A
1860(of)S
(random)252 1986 A
(sources)294 2280 A
2616(*/)S
6255 V
(04830)210 1122 A
(#define)294 1440 A
(RANDOM_SOURCES)588 1776 A
2448(16)S
6345 V
(04831)210 1122 A
6435 V
(04832)210 1122 A
1440(/*)S
(Constants)378 1566 A
(and)126 1986 A
(macros)252 2154 A
(for)126 2448 A
(bit)126 2616 A
(map)126 2784 A
(manipulation.)546 2952 A
3540(*/)S
6525 V
(04833)210 1122 A
(#define)294 1440 A
(BITCHUNK_BITS)546 1776 A
(\(sizeof\(bitchunk_t\))798 2448 A
3288(*)S
(CHAR_BIT\))378 3372 A
6615 V
(04834)210 1122 A
(#define)294 1440 A
(BITMAP_CHUNKS\(nr_bits\))924 1776 A
(\(\(\(nr_bits\)+BITCHUNK_BITS-1\)/BITCHUNK_BITS\))1806 2742 A
6705 V
(04835)210 1122 A
(#define)294 1440 A
(MAP_CHUNK\(map,bit\))756 1776 A
(\(map\)[\(\(bit\)/BITCHUNK_BITS\)])1176 2574 A
6795 V
(04836)210 1122 A
(#define)294 1440 A
(CHUNK_OFFSET\(bit\))714 1776 A
(\(\(bit\)%BITCHUNK_BITS\)\))924 2532 A
6885 V
(04837)210 1122 A
(#define)294 1440 A
(GET_BIT\(map,bit\))672 1776 A
2490(\()S
(MAP_CHUNK\(map,bit\))756 2574 A
3372(&)S
3456(\(1)S
3582(<<)S
(CHUNK_OFFSET\(bit\))714 3708 A
4464(\))S
6975 V
(04838)210 1122 A
(#define)294 1440 A
(SET_BIT\(map,bit\))672 1776 A
2490(\()S
(MAP_CHUNK\(map,bit\))756 2574 A
3372(|=)S
3498(\(1)S
3624(<<)S
(CHUNK_OFFSET\(bit\))714 3750 A
4506(\))S
7065 V
(04839)210 1122 A
(#define)294 1440 A
(UNSET_BIT\(map,bit\))756 1776 A
2574(\()S
(MAP_CHUNK\(map,bit\))756 2658 A
3456(&=)S
(\304\(1)126 3582 A
3750(<<)S
(CHUNK_OFFSET\(bit\))714 3876 A
4632(\))S
8418 V
EP
%%Page: 54 54
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(54)S
11 R
2450(File:)S
2683(kernel/const.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(04840)210 1122 A
1845 V
(04841)210 1122 A
(#define)294 1440 A
(get_sys_bit\(map,bit\))840 1776 A
2658(\\)S
1935 V
(04842)210 1122 A
1776(\()S
(MAP_CHUNK\(map.chunk,bit\))1008 1860 A
2910(&)S
2994(\(1)S
3120(<<)S
(CHUNK_OFFSET\(bit\))714 3246 A
4002(\))S
2025 V
(04843)210 1122 A
(#define)294 1440 A
(set_sys_bit\(map,bit\))840 1776 A
2658(\\)S
2115 V
(04844)210 1122 A
1776(\()S
(MAP_CHUNK\(map.chunk,bit\))1008 1860 A
2910(|=)S
3036(\(1)S
3162(<<)S
(CHUNK_OFFSET\(bit\))714 3288 A
4044(\))S
2205 V
(04845)210 1122 A
(#define)294 1440 A
(unset_sys_bit\(map,bit\))924 1776 A
2742(\\)S
2295 V
(04846)210 1122 A
1776(\()S
(MAP_CHUNK\(map.chunk,bit\))1008 1860 A
2910(&=)S
(\304\(1)126 3036 A
3204(<<)S
(CHUNK_OFFSET\(bit\))714 3330 A
4086(\))S
2385 V
(04847)210 1122 A
(#define)294 1440 A
(NR_SYS_CHUNKS)546 1776 A
(BITMAP_CHUNKS\(NR_SYS_PROCS\))1134 2448 A
2475 V
(04848)210 1122 A
2565 V
(04849)210 1122 A
1440(/*)S
(Program)294 1566 A
(stack)210 1902 A
(words)210 2154 A
(and)126 2406 A
(masks.)252 2574 A
2868(*/)S
2655 V
(04850)210 1122 A
(#define)294 1440 A
(INIT_PSW)336 1776 A
(0x0200)252 2364 A
2784(/*)S
(initial)294 2910 A
(psw)126 3246 A
3414(*/)S
2745 V
(04851)210 1122 A
(#define)294 1440 A
(INIT_TASK_PSW)546 1776 A
(0x1200)252 2364 A
2784(/*)S
(initial)294 2910 A
(psw)126 3246 A
(for)126 3414 A
(tasks)210 3582 A
(\(with)210 3834 A
(IOPL)168 4086 A
4296(1\))S
4422(*/)S
2835 V
(04852)210 1122 A
(#define)294 1440 A
(TRACEBIT)336 1776 A
(0x0100)252 2364 A
2784(/*)S
2910(OR)S
(this)168 3036 A
(with)168 3246 A
(psw)126 3456 A
3624(in)S
(proc[])252 3750 A
(for)126 4044 A
(tracing)294 4212 A
4548(*/)S
2925 V
(04853)210 1122 A
(#define)294 1440 A
(SETPSW\(rp,)420 1776 A
(new\))168 2238 A
2784(/*)S
(permits)294 2910 A
(only)168 3246 A
(certain)294 3456 A
(bits)168 3792 A
4002(to)S
4128(be)S
(set)126 4254 A
4422(*/)S
4548(\\)S
3015 V
(04854)210 1122 A
(\(\(rp\)->p_reg.psw)672 1776 A
2490(=)S
(\(rp\)->p_reg.psw)630 2574 A
3246(&)S
(\3040xCD5)252 3330 A
3624(|)S
(\(new\))210 3708 A
3960(&)S
(0xCD5\))252 4044 A
3105 V
(04855)210 1122 A
(#define)294 1440 A
(IF_MASK)294 1776 A
(0x00000200)420 2112 A
3195 V
(04856)210 1122 A
(#define)294 1440 A
(IOPL_MASK)378 1776 A
(0x003000)336 2196 A
3285 V
(04857)210 1122 A
3375 V
(04858)210 1122 A
1440(/*)S
(Disable/)336 1566 A
(enable)252 1944 A
(hardware)336 2238 A
(interrupts.)462 2616 A
(The)126 3120 A
(parameters)420 3288 A
3750(of)S
(lock\(\))252 3876 A
(and)126 4170 A
(unlock\(\))336 4338 A
3465 V
(04859)210 1122 A
1482(*)S
(are)126 1566 A
(used)168 1734 A
(when)168 1944 A
(debugging)378 2154 A
2574(is)S
(enabled.)336 2700 A
(See)126 3078 A
(debug.h)294 3246 A
(for)126 3582 A
(more)168 3750 A
(information.)504 3960 A
3555 V
(04860)210 1122 A
1482(*/)S
3645 V
(04861)210 1122 A
(#define)294 1440 A
(lock\(c,)294 1776 A
2112(v\))S
(intr_disable\(\);)630 2448 A
3735 V
(04862)210 1122 A
(#define)294 1440 A
(unlock\(c\))378 1776 A
(intr_enable\(\);)588 2448 A
3825 V
(04863)210 1122 A
3915 V
(04864)210 1122 A
1440(/*)S
(Sizes)210 1566 A
1818(of)S
(memory)252 1944 A
(tables.)294 2238 A
(The)126 2574 A
(boot)168 2742 A
(monitor)294 2952 A
(distinguishes)546 3288 A
(three)210 3876 A
(memory)252 4128 A
(areas,)252 4422 A
4005 V
(04865)210 1122 A
1482(*)S
(namely)252 1566 A
(low)126 1860 A
(mem)126 2028 A
(below)210 2196 A
(1M,)126 2448 A
(1M-16M,)294 2616 A
(and)126 2952 A
(mem)126 3120 A
(after)210 3288 A
(16M.)168 3540 A
(More)168 3750 A
(chunks)252 3960 A
(are)126 4254 A
(needed)252 4422 A
4095 V
(04866)210 1122 A
1482(*)S
(for)126 1566 A
(DOS)126 1734 A
(MINIX.)252 1902 A
4185 V
(04867)210 1122 A
1482(*/)S
4275 V
(04868)210 1122 A
(#define)294 1440 A
(NR_MEMS)294 1776 A
2574(8)S
4365 V
(04869)210 1122 A
4455 V
(04870)210 1122 A
(#endif)252 1440 A
1734(/*)S
(CONST_H)294 1860 A
2196(*/)S
4545 V
(04871)210 1122 A
4635 V
(04872)210 1122 A
4725 V
(04873)210 1122 A
4815 V
(04874)210 1122 A
4905 V
(04875)210 1122 A
5445 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5535 V
(kernel/type.h)546 2676 A
5625 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5805 V
(04900)210 1122 A
(#ifndef)294 1440 A
(TYPE_H)252 1776 A
5895 V
(04901)210 1122 A
(#define)294 1440 A
(TYPE_H)252 1776 A
5985 V
(04902)210 1122 A
6075 V
(04903)210 1122 A
(typedef)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(task_t,)294 2490 A
(\(void\))252 2826 A
3120(\);)S
6165 V
(04904)210 1122 A
6255 V
(04905)210 1122 A
1440(/*)S
(Process)294 1566 A
(table)210 1902 A
(and)126 2154 A
(system)252 2322 A
(property)336 2616 A
(related)294 2994 A
(types.)252 3330 A
3624(*/)S
6345 V
(04906)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(proc_nr_t;)420 1944 A
3120(/*)S
(process)294 3246 A
(table)210 3582 A
(entry)210 3834 A
(number)252 4086 A
4380(*/)S
6435 V
(04907)210 1122 A
(typedef)294 1440 A
(short)210 1776 A
(sys_id_t;)378 2028 A
3120(/*)S
(system)252 3246 A
(process)294 3540 A
(index)210 3876 A
4128(*/)S
6525 V
(04908)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
2070({)S
3120(/*)S
(bitmap)252 3246 A
(for)126 3540 A
(system)252 3708 A
(indexes)294 4002 A
4338(*/)S
6615 V
(04909)210 1122 A
(bitchunk_t)420 1524 A
(chunk[BITMAP_CHUNKS\(NR_SYS_PROCS\)];)1470 1986 A
6705 V
(04910)210 1122 A
1440(})S
(sys_map_t;)420 1524 A
6795 V
(04911)210 1122 A
6885 V
(04912)210 1122 A
(struct)252 1440 A
(boot_image)420 1734 A
2196({)S
6975 V
(04913)210 1122 A
(proc_nr_t)378 1524 A
(proc_nr;)336 1944 A
3120(/*)S
(process)294 3246 A
(number)252 3582 A
3876(to)S
(use)126 4002 A
4170(*/)S
7065 V
(04914)210 1122 A
(task_t)252 1524 A
(*initial_pc;)504 1818 A
3120(/*)S
(start)210 3246 A
(function)336 3498 A
(for)126 3876 A
(tasks)210 4044 A
4296(*/)S
8418 V
EP
%%Page: 55 55
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2472(File:)S
(kernel/type.h)583 2705 A
12 B
4560(55)S
1755 V
7 LST
(04915)210 1122 A
(int)126 1524 A
(flags;)252 1692 A
3120(/*)S
(process)294 3246 A
(flags)210 3582 A
3834(*/)S
1845 V
(04916)210 1122 A
(unsigned)336 1524 A
(char)168 1902 A
(quantum;)336 2112 A
3120(/*)S
(quantum)294 3246 A
(\(tick)210 3582 A
(count\))252 3834 A
4128(*/)S
1935 V
(04917)210 1122 A
(int)126 1524 A
(priority;)378 1692 A
3120(/*)S
(scheduling)420 3246 A
(priority)336 3708 A
4086(*/)S
2025 V
(04918)210 1122 A
(int)126 1524 A
(stksize;)336 1692 A
3120(/*)S
(stack)210 3246 A
(size)168 3498 A
(for)126 3708 A
(tasks)210 3876 A
4128(*/)S
2115 V
(04919)210 1122 A
(short)210 1524 A
(trap_mask;)420 1776 A
3120(/*)S
(allowed)294 3246 A
(system)252 3582 A
(call)168 3876 A
(traps)210 4086 A
4338(*/)S
2205 V
(04920)210 1122 A
(bitchunk_t)420 1524 A
(ipc_to;)294 1986 A
3120(/*)S
(send)168 3246 A
(mask)168 3456 A
(protection)420 3666 A
4128(*/)S
2295 V
(04921)210 1122 A
(long)168 1524 A
(call_mask;)420 1734 A
3120(/*)S
(system)252 3246 A
(call)168 3540 A
(protection)420 3750 A
4212(*/)S
2385 V
(04922)210 1122 A
(char)168 1524 A
(proc_name[P_NAME_LEN];)924 1734 A
3120(/*)S
(name)168 3246 A
3456(in)S
(process)294 3582 A
(table)210 3918 A
4170(*/)S
2475 V
(04923)210 1122 A
1440(};)S
2565 V
(04924)210 1122 A
2655 V
(04925)210 1122 A
(struct)252 1440 A
(memory)252 1734 A
2028({)S
2745 V
(04926)210 1122 A
(phys_clicks)462 1524 A
(base;)210 2028 A
3120(/*)S
(start)210 3246 A
(address)294 3498 A
3834(of)S
(chunk)210 3960 A
4212(*/)S
2835 V
(04927)210 1122 A
(phys_clicks)462 1524 A
(size;)210 2028 A
3120(/*)S
(size)168 3246 A
3456(of)S
(memory)252 3582 A
(chunk)210 3876 A
4128(*/)S
2925 V
(04928)210 1122 A
1440(};)S
3015 V
(04929)210 1122 A
3105 V
(04930)210 1122 A
1440(/*)S
(The)126 1566 A
(kernel)252 1734 A
(outputs)294 2028 A
(diagnostic)420 2364 A
(messages)336 2826 A
3204(in)S
3330(a)S
(circular)336 3414 A
(buffer.)294 3792 A
4128(*/)S
3195 V
(04931)210 1122 A
(struct)252 1440 A
(kmessages)378 1734 A
2154({)S
3285 V
(04932)210 1122 A
(int)126 1524 A
(km_next;)336 1692 A
3120(/*)S
(next)168 3246 A
(index)210 3456 A
3708(to)S
(write)210 3834 A
4086(*/)S
3375 V
(04933)210 1122 A
(int)126 1524 A
(km_size;)336 1692 A
3120(/*)S
(current)294 3246 A
(size)168 3582 A
3792(in)S
(buffer)252 3918 A
4212(*/)S
3465 V
(04934)210 1122 A
(char)168 1524 A
(km_buf[KMESS_BUF_SIZE];)966 1734 A
3120(/*)S
(buffer)252 3246 A
(for)126 3540 A
(messages)336 3708 A
4086(*/)S
3555 V
(04935)210 1122 A
1440(};)S
3645 V
(04936)210 1122 A
3735 V
(04937)210 1122 A
(struct)252 1440 A
(randomness)420 1734 A
2196({)S
3825 V
(04938)210 1122 A
(struct)252 1524 A
1818({)S
3915 V
(04939)210 1122 A
(int)126 1776 A
(r_next;)294 1944 A
3456(/*)S
(next)168 3582 A
(index)210 3792 A
4044(to)S
(write)210 4170 A
4422(*/)S
4005 V
(04940)210 1122 A
(int)126 1776 A
(r_size;)294 1944 A
3456(/*)S
(number)252 3582 A
3876(of)S
(random)252 4002 A
(elements)336 4296 A
4674(*/)S
4095 V
(04941)210 1122 A
(unsigned)336 1776 A
(short)210 2154 A
(r_buf[RANDOM_ELEMENTS];)966 2406 A
3414(/*)S
(buffer)252 3540 A
(for)126 3834 A
(random)252 4002 A
(info)168 4296 A
4506(*/)S
4185 V
(04942)210 1122 A
1524(})S
(bin[RANDOM_SOURCES];)840 1608 A
4275 V
(04943)210 1122 A
1440(};)S
4365 V
(04944)210 1122 A
4455 V
(04945)210 1122 A
(#if)126 1440 A
(\(CHIP)210 1608 A
1860(==)S
(INTEL\))252 1986 A
4545 V
(04946)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(reg_t;)252 2154 A
2784(/*)S
(machine)294 2910 A
(register)336 3246 A
3624(*/)S
4635 V
(04947)210 1122 A
4725 V
(04948)210 1122 A
1440(/*)S
(The)126 1566 A
(stack)210 1734 A
(frame)210 1986 A
(layout)252 2238 A
2532(is)S
(determined)420 2658 A
3120(by)S
(the)126 3246 A
(software,)378 3414 A
(but)126 3834 A
(for)126 4002 A
(efficiency)420 4170 A
4815 V
(04949)210 1122 A
1482(*)S
1566(it)S
1692(is)S
(laid)168 1818 A
(out)126 2028 A
2196(so)S
(the)126 2322 A
(assembly)336 2490 A
(code)168 2868 A
3078(to)S
(use)126 3204 A
3372(it)S
3498(is)S
3624(as)S
(simple)252 3750 A
4044(as)S
(possible.)378 4170 A
4905 V
(04950)210 1122 A
1482(*)S
(80286)210 1566 A
(protected)378 1818 A
(mode)168 2238 A
(and)126 2448 A
(all)126 2616 A
(real)168 2784 A
(modes)210 2994 A
(use)126 3246 A
(the)126 3414 A
(same)168 3582 A
(frame,)252 3792 A
(built)210 4086 A
(with)168 4338 A
4995 V
(04951)210 1122 A
1482(*)S
(16-bit)252 1566 A
(registers.)420 1860 A
(Real)168 2364 A
(mode)168 2574 A
(lacks)210 2784 A
3036(an)S
(automatic)378 3162 A
(stack)210 3582 A
(switch,)294 3834 A
4170(so)S
(little)252 4296 A
5085 V
(04952)210 1122 A
1482(*)S
1566(is)S
(lost)168 1692 A
1902(by)S
(using)210 2028 A
(the)126 2280 A
(286)126 2448 A
(frame)210 2616 A
(for)126 2868 A
(it.)126 3036 A
(The)126 3246 A
(386)126 3414 A
(frame)210 3582 A
(differs)294 3834 A
(only)168 4170 A
4380(in)S
5175 V
(04953)210 1122 A
1482(*)S
(having)252 1566 A
(32-bit)252 1860 A
(registers)378 2154 A
(and)126 2574 A
(more)168 2742 A
(segment)294 2952 A
(registers.)420 3288 A
(The)126 3792 A
(same)168 3960 A
(names)210 4170 A
(are)126 4422 A
5265 V
(04954)210 1122 A
1482(*)S
(used)168 1566 A
(for)126 1776 A
(the)126 1944 A
(larger)252 2112 A
(registers)378 2406 A
2826(to)S
(avoid)210 2952 A
(differences)462 3204 A
3708(in)S
(the)126 3834 A
(code.)210 4002 A
5355 V
(04955)210 1122 A
1482(*/)S
5445 V
(04956)210 1122 A
(struct)252 1440 A
(stackframe_s)504 1734 A
2280({)S
2784(/*)S
(proc_ptr)336 2910 A
(points)252 3288 A
(here)168 3582 A
3792(*/)S
5535 V
(04957)210 1122 A
(#if)126 1440 A
(_WORD_SIZE)420 1608 A
2070(==)S
2196(4)S
5625 V
(04958)210 1122 A
(u16_t)210 1524 A
(gs;)126 1776 A
2784(/*)S
(last)168 2910 A
(item)168 3120 A
(pushed)252 3330 A
3624(by)S
(save)168 3750 A
3960(*/)S
5715 V
(04959)210 1122 A
(u16_t)210 1524 A
(fs;)126 1776 A
2784(/*)S
2952(\303)S
3036(*/)S
5805 V
(04960)210 1122 A
(#endif)252 1440 A
5895 V
(04961)210 1122 A
(u16_t)210 1524 A
(es;)126 1776 A
2784(/*)S
2952(|)S
3036(*/)S
5985 V
(04962)210 1122 A
(u16_t)210 1524 A
(ds;)126 1776 A
2784(/*)S
2952(|)S
3036(*/)S
6075 V
(04963)210 1122 A
(reg_t)210 1524 A
(di;)126 1776 A
2784(/*)S
2910(di)S
(through)294 3036 A
3372(cx)S
(are)126 3498 A
(not)126 3666 A
(accessed)336 3834 A
4212(in)S
4338(C)S
4422(*/)S
6165 V
(04964)210 1122 A
(reg_t)210 1524 A
(si;)126 1776 A
2784(/*)S
(order)210 2910 A
3162(is)S
3288(to)S
(match)210 3414 A
(pusha/popa)420 3666 A
4128(*/)S
6255 V
(04965)210 1122 A
(reg_t)210 1524 A
(fp;)126 1776 A
2784(/*)S
2910(bp)S
3036(*/)S
6345 V
(04966)210 1122 A
(reg_t)210 1524 A
(st;)126 1776 A
2784(/*)S
(hole)168 2910 A
(for)126 3120 A
(another)294 3288 A
(copy)168 3624 A
3834(of)S
3960(sp)S
4086(*/)S
6435 V
(04967)210 1122 A
(reg_t)210 1524 A
(bx;)126 1776 A
2784(/*)S
2952(|)S
3036(*/)S
6525 V
(04968)210 1122 A
(reg_t)210 1524 A
(dx;)126 1776 A
2784(/*)S
2952(|)S
3036(*/)S
6615 V
(04969)210 1122 A
(reg_t)210 1524 A
(cx;)126 1776 A
2784(/*)S
2952(|)S
3036(*/)S
6705 V
(04970)210 1122 A
(reg_t)210 1524 A
(retreg;)294 1776 A
2784(/*)S
2910(ax)S
(and)126 3036 A
(above)210 3204 A
(are)126 3456 A
(all)126 3624 A
(pushed)252 3792 A
4086(by)S
(save)168 4212 A
4422(*/)S
6795 V
(04971)210 1122 A
(reg_t)210 1524 A
(retadr;)294 1776 A
2784(/*)S
(return)252 2910 A
(address)294 3204 A
(for)126 3540 A
(assembly)336 3708 A
(code)168 4086 A
(save\(\))252 4296 A
4590(*/)S
6885 V
(04972)210 1122 A
(reg_t)210 1524 A
(pc;)126 1776 A
2784(/*)S
2952(\303)S
(last)168 3078 A
(item)168 3288 A
(pushed)252 3498 A
3792(by)S
(interrupt)378 3918 A
4338(*/)S
6975 V
(04973)210 1122 A
(reg_t)210 1524 A
(cs;)126 1776 A
2784(/*)S
2952(|)S
3036(*/)S
7065 V
(04974)210 1122 A
(reg_t)210 1524 A
(psw;)168 1776 A
2784(/*)S
2952(|)S
3036(*/)S
8418 V
EP
%%Page: 56 56
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(56)S
11 R
2472(File:)S
(kernel/type.h)583 2705 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(04975)210 1122 A
(reg_t)210 1524 A
(sp;)126 1776 A
2784(/*)S
2952(|)S
3036(*/)S
1845 V
(04976)210 1122 A
(reg_t)210 1524 A
(ss;)126 1776 A
2784(/*)S
(these)210 2910 A
(are)126 3162 A
(pushed)252 3330 A
3624(by)S
(CPU)126 3750 A
(during)252 3918 A
(interrupt)378 4212 A
4632(*/)S
1935 V
(04977)210 1122 A
1440(};)S
2025 V
(04978)210 1122 A
2115 V
(04979)210 1122 A
(struct)252 1440 A
(segdesc_s)378 1734 A
2154({)S
2784(/*)S
(segment)294 2910 A
(descriptor)420 3246 A
(for)126 3708 A
(protected)378 3876 A
(mode)168 4296 A
4506(*/)S
2205 V
(04980)210 1122 A
(u16_t)210 1524 A
(limit_low;)420 1776 A
2295 V
(04981)210 1122 A
(u16_t)210 1524 A
(base_low;)378 1776 A
2385 V
(04982)210 1122 A
(u8_t)168 1524 A
(base_middle;)504 1734 A
2475 V
(04983)210 1122 A
(u8_t)168 1524 A
(access;)294 1734 A
2784(/*)S
(|P|DL|1|X|E|R|A|)672 2910 A
3624(*/)S
2565 V
(04984)210 1122 A
(u8_t)168 1524 A
(granularity;)504 1734 A
2784(/*)S
(|G|X|0|A|LIMT|)588 2910 A
3540(*/)S
2655 V
(04985)210 1122 A
(u8_t)168 1524 A
(base_high;)420 1734 A
2745 V
(04986)210 1122 A
1440(};)S
2835 V
(04987)210 1122 A
2925 V
(04988)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(irq_policy_t;)546 2364 A
3015 V
(04989)210 1122 A
(typedef)294 1440 A
(unsigned)336 1776 A
(long)168 2154 A
(irq_id_t;)378 2364 A
3105 V
(04990)210 1122 A
3195 V
(04991)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
(irq_hook)336 2070 A
2448({)S
3285 V
(04992)210 1122 A
(struct)252 1524 A
(irq_hook)336 1818 A
(*next;)252 2196 A
3120(/*)S
(next)168 3246 A
(hook)168 3456 A
3666(in)S
(chain)210 3792 A
4044(*/)S
3375 V
(04993)210 1122 A
(int)126 1524 A
(\(*handler\)\(struct)714 1692 A
(irq_hook)336 2448 A
(*\);)126 2826 A
3120(/*)S
(interrupt)378 3246 A
(handler)294 3666 A
4002(*/)S
3465 V
(04994)210 1122 A
(int)126 1524 A
(irq;)168 1692 A
3120(/*)S
(IRQ)126 3246 A
(vector)252 3414 A
(number)252 3708 A
4002(*/)S
3555 V
(04995)210 1122 A
(int)126 1524 A
(id;)126 1692 A
3120(/*)S
3246(id)S
3372(of)S
(this)168 3498 A
(hook)168 3708 A
3918(*/)S
3645 V
(04996)210 1122 A
(int)126 1524 A
(proc_nr;)336 1692 A
3120(/*)S
(NONE)168 3246 A
3456(if)S
(not)126 3582 A
3750(in)S
(use)126 3876 A
4044(*/)S
3735 V
(04997)210 1122 A
(irq_id_t)336 1524 A
(notify_id;)420 1902 A
3120(/*)S
3246(id)S
3372(to)S
(return)252 3498 A
3792(on)S
(interrupt)378 3918 A
4338(*/)S
3825 V
(04998)210 1122 A
(irq_policy_t)504 1524 A
(policy;)294 2070 A
3120(/*)S
(bit)126 3246 A
(mask)168 3414 A
(for)126 3624 A
(policy)252 3792 A
4086(*/)S
3915 V
(04999)210 1122 A
1440(})S
(irq_hook_t;)462 1524 A
4005 V
(05000)210 1122 A
4095 V
(05001)210 1122 A
(typedef)294 1440 A
(int)126 1776 A
(\(*irq_handler_t\)\(struct)966 1944 A
(irq_hook)336 2952 A
(*\);)126 3330 A
4185 V
(05002)210 1122 A
4275 V
(05003)210 1122 A
(#endif)252 1440 A
1734(/*)S
(\(CHIP)210 1860 A
2112(==)S
(INTEL\))252 2238 A
2532(*/)S
4365 V
(05004)210 1122 A
4455 V
(05005)210 1122 A
(#if)126 1440 A
(\(CHIP)210 1608 A
1860(==)S
(M68000\))294 1986 A
4545 V
(05006)210 1122 A
1440(/*)S
(M68000)252 1566 A
(specific)336 1860 A
(types)210 2238 A
2490(go)S
(here.)210 2616 A
2868(*/)S
4635 V
(05007)210 1122 A
(#endif)252 1440 A
1734(/*)S
(\(CHIP)210 1860 A
2112(==)S
(M68000\))294 2238 A
2574(*/)S
4725 V
(05008)210 1122 A
4815 V
(05009)210 1122 A
(#endif)252 1440 A
1734(/*)S
(TYPE_H)252 1860 A
2154(*/)S
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(kernel/proto.h)588 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(05100)210 1122 A
1440(/*)S
(Function)336 1566 A
(prototypes.)462 1944 A
2448(*/)S
5445 V
(05101)210 1122 A
5535 V
(05102)210 1122 A
(#ifndef)294 1440 A
(PROTO_H)294 1776 A
5625 V
(05103)210 1122 A
(#define)294 1440 A
(PROTO_H)294 1776 A
5715 V
(05104)210 1122 A
5805 V
(05105)210 1122 A
1440(/*)S
(Struct)252 1566 A
(declarations.)546 1860 A
2448(*/)S
5895 V
(05106)210 1122 A
(struct)252 1440 A
(proc;)210 1734 A
5985 V
(05107)210 1122 A
(struct)252 1440 A
(timer;)252 1734 A
6075 V
(05108)210 1122 A
6165 V
(05109)210 1122 A
1440(/*)S
(clock.c)294 1566 A
1902(*/)S
6255 V
(05110)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(clock_task,)462 2154 A
(\(void\))252 2658 A
4464(\);)S
6345 V
(05111)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(clock_stop,)462 2154 A
(\(void\))252 2658 A
4464(\);)S
6435 V
(05112)210 1122 A
(_PROTOTYPE\()462 1440 A
(clock_t)294 1944 A
(get_uptime,)462 2280 A
(\(void\))252 2784 A
4464(\);)S
6525 V
(05113)210 1122 A
(_PROTOTYPE\()462 1440 A
(unsigned)336 1944 A
(long)168 2322 A
(read_clock,)462 2532 A
(\(void\))252 3036 A
4464(\);)S
6615 V
(05114)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(set_timer,)420 2154 A
(\(struct)294 2616 A
(timer)210 2952 A
(*tp,)168 3204 A
(clock_t)294 3414 A
3750(t,)S
(tmr_func_t)420 3876 A
4338(f\))S
4464(\);)S
6705 V
(05115)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(reset_timer,)504 2154 A
(\(struct)294 2700 A
(timer)210 3036 A
(*tp\))168 3288 A
4464(\);)S
6795 V
(05116)210 1122 A
6885 V
(05117)210 1122 A
1440(/*)S
(main.c)252 1566 A
1860(*/)S
6975 V
(05118)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(main,)210 2154 A
(\(void\))252 2406 A
4464(\);)S
7065 V
(05119)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(prepare_shutdown,)714 2154 A
(\(int)168 2910 A
(how\))168 3120 A
4464(\);)S
8418 V
EP
%%Page: 57 57
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2451(File:)S
2684(kernel/proto.h)S
12 B
4560(57)S
1755 V
7 LST
(05120)210 1122 A
1845 V
(05121)210 1122 A
1440(/*)S
(utility.c)378 1566 A
1986(*/)S
1935 V
(05122)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(kprintf,)336 2154 A
(\(const)252 2532 A
(char)168 2826 A
(*fmt,)210 3036 A
(...\))168 3288 A
4464(\);)S
2025 V
(05123)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(panic,)252 2154 A
(\(_CONST)294 2448 A
(char)168 2784 A
(*s,)126 2994 A
(int)126 3162 A
3330(n\))S
4464(\);)S
2115 V
(05124)210 1122 A
2205 V
(05125)210 1122 A
1440(/*)S
(proc.c)252 1566 A
1860(*/)S
2295 V
(05126)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(sys_call,)378 2112 A
(\(int)168 2532 A
(function,)378 2742 A
(int)126 3162 A
(src_dest,)378 3330 A
(message)294 3750 A
(*m_ptr\))294 4086 A
4464(\);)S
2385 V
(05127)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(lock_notify,)504 2112 A
(\(int)168 2658 A
(src,)168 2868 A
(int)126 3078 A
(dst\))168 3246 A
4464(\);)S
2475 V
(05128)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(lock_send,)420 2112 A
(\(int)168 2574 A
(dst,)168 2784 A
(message)294 2994 A
(*m_ptr\))294 3330 A
4464(\);)S
2565 V
(05129)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(lock_enqueue,)546 2154 A
(\(struct)294 2742 A
(proc)168 3078 A
(*rp\))168 3288 A
4464(\);)S
2655 V
(05130)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(lock_dequeue,)546 2154 A
(\(struct)294 2742 A
(proc)168 3078 A
(*rp\))168 3288 A
4464(\);)S
2745 V
(05131)210 1122 A
2835 V
(05132)210 1122 A
1440(/*)S
(start.c)294 1566 A
1902(*/)S
2925 V
(05133)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(cstart,)294 2154 A
(\(U16_t)252 2490 A
(cs,)126 2784 A
(U16_t)210 2952 A
(ds,)126 3204 A
(U16_t)210 3372 A
(mds,)168 3624 A
3015 V
(05134)210 1122 A
(U16_t)210 2784 A
(parmoff,)336 3036 A
(U16_t)210 3414 A
(parmsize\))378 3666 A
4464(\);)S
3105 V
(05135)210 1122 A
3195 V
(05136)210 1122 A
1440(/*)S
(system.c)336 1566 A
1944(*/)S
3285 V
(05137)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(get_priv,)378 2112 A
(\(register)378 2532 A
(struct)252 2952 A
(proc)168 3246 A
(*rc,)168 3456 A
(int)126 3666 A
(proc_type\))420 3834 A
4464(\);)S
3375 V
(05138)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(send_sig,)378 2154 A
(\(int)168 2574 A
(proc_nr,)336 2784 A
(int)126 3162 A
(sig_nr\))294 3330 A
4464(\);)S
3465 V
(05139)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(cause_sig,)420 2154 A
(\(int)168 2616 A
(proc_nr,)336 2826 A
(int)126 3204 A
(sig_nr\))294 3372 A
4464(\);)S
3555 V
(05140)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(sys_task,)378 2154 A
(\(void\))252 2574 A
4464(\);)S
3645 V
(05141)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(get_randomness,)630 2154 A
(\(int)168 2826 A
(source\))294 3036 A
4464(\);)S
3735 V
(05142)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(virtual_copy,)546 2112 A
(\(struct)294 2700 A
(vir_addr)336 3036 A
(*src,)210 3414 A
(struct)252 3666 A
(vir_addr)336 3960 A
(*dst,)210 4338 A
3825 V
(05143)210 1122 A
(vir_bytes)378 2784 A
(bytes\))252 3204 A
4464(\);)S
3915 V
(05144)210 1122 A
(#define)294 1440 A
(numap_local\(proc_nr,)840 1776 A
(vir_addr,)378 2658 A
(bytes\))252 3078 A
3372(\\)S
4005 V
(05145)210 1122 A
(umap_local\(proc_addr\(proc_nr\),)1260 1776 A
3078(D,)S
(\(vir_addr\),)462 3204 A
(\(bytes\)\))336 3708 A
4095 V
(05146)210 1122 A
(_PROTOTYPE\()462 1440 A
(phys_bytes)420 1944 A
(umap_local,)462 2406 A
(\(struct)294 2910 A
(proc)168 3246 A
(*rp,)168 3456 A
(int)126 3666 A
(seg,)168 3834 A
4185 V
(05147)210 1122 A
(vir_bytes)378 2112 A
(vir_addr,)378 2532 A
(vir_bytes)378 2952 A
(bytes\))252 3372 A
4464(\);)S
4275 V
(05148)210 1122 A
(_PROTOTYPE\()462 1440 A
(phys_bytes)420 1944 A
(umap_remote,)504 2406 A
(\(struct)294 2952 A
(proc)168 3288 A
(*rp,)168 3498 A
(int)126 3708 A
(seg,)168 3876 A
4365 V
(05149)210 1122 A
(vir_bytes)378 2112 A
(vir_addr,)378 2532 A
(vir_bytes)378 2952 A
(bytes\))252 3372 A
4464(\);)S
4455 V
(05150)210 1122 A
(_PROTOTYPE\()462 1440 A
(phys_bytes)420 1944 A
(umap_bios,)420 2406 A
(\(struct)294 2868 A
(proc)168 3204 A
(*rp,)168 3414 A
(vir_bytes)378 3624 A
(vir_addr,)378 4044 A
4545 V
(05151)210 1122 A
(vir_bytes)378 2112 A
(bytes\))252 2532 A
4464(\);)S
4635 V
(05152)210 1122 A
4725 V
(05153)210 1122 A
1440(/*)S
(exception.c)462 1566 A
2070(*/)S
4815 V
(05154)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(exception,)420 2154 A
(\(unsigned)378 2616 A
(vec_nr\))294 3036 A
4464(\);)S
4905 V
(05155)210 1122 A
4995 V
(05156)210 1122 A
1440(/*)S
(i8259.c)294 1566 A
1902(*/)S
5085 V
(05157)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(intr_init,)420 2154 A
(\(int)168 2616 A
(mine\))210 2826 A
4464(\);)S
5175 V
(05158)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(intr_handle,)504 2154 A
(\(irq_hook_t)462 2700 A
(*hook\))252 3204 A
4464(\);)S
5265 V
(05159)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(put_irq_handler,)672 2154 A
(\(irq_hook_t)462 2868 A
(*hook,)252 3372 A
(int)126 3666 A
(irq,)168 3834 A
5355 V
(05160)210 1122 A
(irq_handler_t)546 3456 A
(handler\))336 4044 A
4464(\);)S
5445 V
(05161)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(rm_irq_handler,)630 2154 A
(\(irq_hook_t)462 2826 A
(*hook\))252 3330 A
4464(\);)S
5535 V
(05162)210 1122 A
5625 V
(05163)210 1122 A
1440(/*)S
(klib*.s)294 1566 A
1902(*/)S
5715 V
(05164)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(int86,)252 2154 A
(\(void\))252 2448 A
4464(\);)S
5805 V
(05165)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(cp_mess,)336 2154 A
(\(int)168 2532 A
(src,phys_clicks)630 2742 A
(src_clicks,vir_bytes)840 3414 A
(src_offset,)462 4296 A
5895 V
(05166)210 1122 A
(phys_clicks)462 2112 A
(dst_clicks,)462 2616 A
(vir_bytes)378 3120 A
(dst_offset\))462 3540 A
4464(\);)S
5985 V
(05167)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(enable_irq,)462 2154 A
(\(irq_hook_t)462 2658 A
(*hook\))252 3162 A
4464(\);)S
6075 V
(05168)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(disable_irq,)504 2112 A
(\(irq_hook_t)462 2658 A
(*hook\))252 3162 A
4464(\);)S
6165 V
(05169)210 1122 A
(_PROTOTYPE\()462 1440 A
(u16_t)210 1944 A
(mem_rdw,)336 2196 A
(\(U16_t)252 2574 A
(segm,)210 2868 A
(vir_bytes)378 3120 A
(offset\))294 3540 A
4464(\);)S
6255 V
(05170)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(phys_copy,)420 2154 A
(\(phys_bytes)462 2616 A
(source,)294 3120 A
(phys_bytes)420 3456 A
(dest,)210 3918 A
6345 V
(05171)210 1122 A
(phys_bytes)420 2112 A
(count\))252 2574 A
4464(\);)S
6435 V
(05172)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(phys_memset,)504 2154 A
(\(phys_bytes)462 2700 A
(source,)294 3204 A
(unsigned)336 3540 A
(long)168 3918 A
(pattern,)336 4128 A
6525 V
(05173)210 1122 A
(phys_bytes)420 2112 A
(count\))252 2574 A
4464(\);)S
6615 V
(05174)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(phys_insb,)420 2154 A
(\(U16_t)252 2616 A
(port,)210 2910 A
(phys_bytes)420 3162 A
(buf,)168 3624 A
(size_t)252 3834 A
(count\))252 4128 A
4464(\);)S
6705 V
(05175)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(phys_insw,)420 2154 A
(\(U16_t)252 2616 A
(port,)210 2910 A
(phys_bytes)420 3162 A
(buf,)168 3624 A
(size_t)252 3834 A
(count\))252 4128 A
4464(\);)S
6795 V
(05176)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(phys_outsb,)462 2154 A
(\(U16_t)252 2658 A
(port,)210 2952 A
(phys_bytes)420 3204 A
(buf,)168 3666 A
(size_t)252 3876 A
(count\))252 4170 A
4464(\);)S
6885 V
(05177)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(phys_outsw,)462 2154 A
(\(U16_t)252 2658 A
(port,)210 2952 A
(phys_bytes)420 3204 A
(buf,)168 3666 A
(size_t)252 3876 A
(count\))252 4170 A
4464(\);)S
6975 V
(05178)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(reset,)252 2154 A
(\(void\))252 2448 A
4464(\);)S
7065 V
(05179)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(level0,)294 2154 A
(\(void)210 2490 A
(\(*func\)\(void\)\))588 2742 A
4464(\);)S
8418 V
EP
%%Page: 58 58
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(58)S
11 R
2451(File:)S
2684(kernel/proto.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(05180)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(monitor,)336 2154 A
(\(void\))252 2532 A
4464(\);)S
1845 V
(05181)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(read_tsc,)378 2154 A
(\(unsigned)378 2574 A
(long)168 2994 A
(*high,)252 3204 A
(unsigned)336 3498 A
(long)168 3876 A
(*low\))210 4086 A
4464(\);)S
1935 V
(05182)210 1122 A
(_PROTOTYPE\()462 1440 A
(unsigned)336 1944 A
(long)168 2322 A
(read_cpu_flags,)630 2532 A
(\(void\))252 3204 A
4464(\);)S
2025 V
(05183)210 1122 A
2115 V
(05184)210 1122 A
1440(/*)S
(mpx*.s)252 1566 A
1860(*/)S
2205 V
(05185)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(idle_task,)420 2154 A
(\(void\))252 2616 A
4464(\);)S
2295 V
(05186)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(restart,)336 2154 A
(\(void\))252 2532 A
4464(\);)S
2385 V
(05187)210 1122 A
2475 V
(05188)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(are)126 2154 A
(never)210 2322 A
(called)252 2574 A
(from)168 2868 A
3078(C)S
(\(pure)210 3162 A
(asm)126 3414 A
(procs\).)294 3582 A
3918(*/)S
2565 V
(05189)210 1122 A
2655 V
(05190)210 1122 A
1440(/*)S
(Exception)378 1566 A
(handlers)336 1986 A
(\(real)210 2364 A
2616(or)S
(protected)378 2742 A
(mode\),)252 3162 A
3456(in)S
(numerical)378 3582 A
(order.)252 4002 A
4296(*/)S
2745 V
(05191)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 1650 A
(int00,)252 2154 A
(\(void\))252 2448 A
2742(\),)S
(_PROTOTYPE\()462 2868 A
(divide_error,)546 3372 A
(\(void\))252 3960 A
4254(\);)S
2835 V
(05192)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 1650 A
(int01,)252 2154 A
(\(void\))252 2448 A
2742(\),)S
(_PROTOTYPE\()462 2868 A
(single_step_exception,)924 3372 A
(\(void\))252 4338 A
4632(\);)S
2925 V
(05193)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 1650 A
(int02,)252 2154 A
(\(void\))252 2448 A
2742(\),)S
(_PROTOTYPE\()462 2868 A
(nmi,)168 3372 A
(\(void\))252 3582 A
3876(\);)S
3015 V
(05194)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 1650 A
(int03,)252 2154 A
(\(void\))252 2448 A
2742(\),)S
(_PROTOTYPE\()462 2868 A
(breakpoint_exception,)882 3372 A
(\(void\))252 4296 A
4590(\);)S
3105 V
(05195)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 1650 A
(int04,)252 2154 A
(\(void\))252 2448 A
2742(\),)S
(_PROTOTYPE\()462 2868 A
(overflow,)378 3372 A
(\(void\))252 3792 A
4086(\);)S
3195 V
(05196)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 1650 A
(int05,)252 2154 A
(\(void\))252 2448 A
2742(\),)S
(_PROTOTYPE\()462 2868 A
(bounds_check,)546 3372 A
(\(void\))252 3960 A
4254(\);)S
3285 V
(05197)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 1650 A
(int06,)252 2154 A
(\(void\))252 2448 A
2742(\),)S
(_PROTOTYPE\()462 2868 A
(inval_opcode,)546 3372 A
(\(void\))252 3960 A
4254(\);)S
3375 V
(05198)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 1650 A
(int07,)252 2154 A
(\(void\))252 2448 A
2742(\),)S
(_PROTOTYPE\()462 2868 A
(copr_not_available,)798 3372 A
(\(void\))252 4212 A
4506(\);)S
3465 V
(05199)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 2868 A
(double_fault,)546 3372 A
(\(void\))252 3960 A
4254(\);)S
3555 V
(05200)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 2868 A
(copr_seg_overrun,)714 3372 A
(\(void\))252 4128 A
4422(\);)S
3645 V
(05201)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 2868 A
(inval_tss,)420 3372 A
(\(void\))252 3834 A
4128(\);)S
3735 V
(05202)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 2868 A
(segment_not_present,)840 3372 A
(\(void\))252 4254 A
4548(\);)S
3825 V
(05203)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 2868 A
(stack_exception,)672 3372 A
(\(void\))252 4086 A
4380(\);)S
3915 V
(05204)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 2868 A
(general_protection,)798 3372 A
(\(void\))252 4212 A
4506(\);)S
4005 V
(05205)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 2868 A
(page_fault,)462 3372 A
(\(void\))252 3876 A
4170(\);)S
4095 V
(05206)210 1122 A
(void)168 1440 A
(_PROTOTYPE\()462 2868 A
(copr_error,)462 3372 A
(\(void\))252 3876 A
4170(\);)S
4185 V
(05207)210 1122 A
4275 V
(05208)210 1122 A
1440(/*)S
(Hardware)336 1566 A
(interrupt)378 1944 A
(handlers.)378 2364 A
2784(*/)S
4365 V
(05209)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint00,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
4455 V
(05210)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint01,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
4545 V
(05211)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint02,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
4635 V
(05212)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint03,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
4725 V
(05213)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint04,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
4815 V
(05214)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint05,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
4905 V
(05215)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint06,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
4995 V
(05216)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint07,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
5085 V
(05217)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint08,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
5175 V
(05218)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint09,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
5265 V
(05219)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint10,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
5355 V
(05220)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint11,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
5445 V
(05221)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint12,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
5535 V
(05222)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint13,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
5625 V
(05223)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint14,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
5715 V
(05224)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(hwint15,)336 2154 A
(\(void\))252 2532 A
2826(\);)S
5805 V
(05225)210 1122 A
5895 V
(05226)210 1122 A
1440(/*)S
(Software)336 1566 A
(interrupt)378 1944 A
(handlers,)378 2364 A
2784(in)S
(numerical)378 2910 A
(order.)252 3330 A
3624(*/)S
5985 V
(05227)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(trp,)168 2154 A
(\(void\))252 2364 A
2658(\);)S
6075 V
(05228)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(s_call,)294 2154 A
(\(void\))252 2490 A
2784(\),)S
(_PROTOTYPE\()462 2910 A
(p_s_call,)378 3414 A
(\(void\))252 3834 A
4128(\);)S
6165 V
(05229)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(level0_call,)504 2154 A
(\(void\))252 2700 A
2994(\);)S
6255 V
(05230)210 1122 A
6345 V
(05231)210 1122 A
1440(/*)S
(protect.c)378 1566 A
1986(*/)S
6435 V
(05232)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(prot_init,)420 2154 A
(\(void\))252 2616 A
4464(\);)S
6525 V
(05233)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(init_codeseg,)546 2154 A
(\(struct)294 2742 A
(segdesc_s)378 3078 A
(*segdp,)294 3498 A
(phys_bytes)420 3834 A
(base,)210 4296 A
6615 V
(05234)210 1122 A
(vir_bytes)378 2112 A
(size,)210 2532 A
(int)126 2784 A
(privilege\))420 2952 A
4464(\);)S
6705 V
(05235)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(init_dataseg,)546 2154 A
(\(struct)294 2742 A
(segdesc_s)378 3078 A
(*segdp,)294 3498 A
(phys_bytes)420 3834 A
(base,)210 4296 A
6795 V
(05236)210 1122 A
(vir_bytes)378 2112 A
(size,)210 2532 A
(int)126 2784 A
(privilege\))420 2952 A
4464(\);)S
6885 V
(05237)210 1122 A
(_PROTOTYPE\()462 1440 A
(phys_bytes)420 1944 A
(seg2phys,)378 2406 A
(\(U16_t)252 2826 A
(seg\))168 3120 A
4464(\);)S
6975 V
(05238)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(phys2seg,)378 2154 A
(\(u16_t)252 2574 A
(*seg,)210 2868 A
(vir_bytes)378 3120 A
(*off,)210 3540 A
(phys_bytes)420 3792 A
(phys\)\);)294 4254 A
7065 V
(05239)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(enable_iop,)462 2154 A
(\(struct)294 2658 A
(proc)168 2994 A
(*pp\))168 3204 A
4464(\);)S
8418 V
EP
%%Page: 59 59
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2451(File:)S
2684(kernel/proto.h)S
12 B
4560(59)S
1755 V
7 LST
(05240)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(alloc_segments,)630 2154 A
(\(struct)294 2826 A
(proc)168 3162 A
(*rp\))168 3372 A
4464(\);)S
1845 V
(05241)210 1122 A
1935 V
(05242)210 1122 A
(#endif)252 1440 A
1734(/*)S
(PROTO_H)294 1860 A
2196(*/)S
2025 V
(05243)210 1122 A
2115 V
(05244)210 1122 A
2295 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2385 V
(kernel/glo.h)504 2676 A
2475 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2655 V
(05300)210 1122 A
(#ifndef)294 1440 A
(GLO_H)210 1776 A
2745 V
(05301)210 1122 A
(#define)294 1440 A
(GLO_H)210 1776 A
2835 V
(05302)210 1122 A
2925 V
(05303)210 1122 A
1440(/*)S
(Global)252 1566 A
(variables)378 1860 A
(used)168 2280 A
2490(in)S
(the)126 2616 A
(kernel.)294 2784 A
(This)168 3120 A
(file)168 3330 A
(contains)336 3540 A
(the)126 3918 A
(declarations;)546 4086 A
3015 V
(05304)210 1122 A
1482(*)S
(storage)294 1566 A
(space)210 1902 A
(for)126 2154 A
(the)126 2322 A
(variables)378 2490 A
2910(is)S
(allocated)378 3036 A
3456(in)S
(table.c,)336 3582 A
(because)294 3960 A
(EXTERN)252 4296 A
4590(is)S
3105 V
(05305)210 1122 A
1482(*)S
(defined)294 1566 A
1902(as)S
(extern)252 2028 A
(unless)252 2322 A
(the)126 2616 A
(_TABLE)252 2784 A
(definition)420 3078 A
3540(is)S
(seen.)210 3666 A
3918(We)S
(rely)168 4044 A
4254(on)S
(the)126 4380 A
3195 V
(05306)210 1122 A
1482(*)S
(compiler's)420 1566 A
(default)294 2028 A
(initialization)588 2364 A
(\(0\))126 2994 A
(for)126 3162 A
(several)294 3330 A
(global)252 3666 A
(variables.)420 3960 A
3285 V
(05307)210 1122 A
1482(*/)S
3375 V
(05308)210 1122 A
(#ifdef)252 1440 A
(_TABLE)252 1734 A
3465 V
(05309)210 1122 A
(#undef)252 1440 A
(EXTERN)252 1734 A
3555 V
(05310)210 1122 A
(#define)294 1440 A
(EXTERN)252 1776 A
3645 V
(05311)210 1122 A
(#endif)252 1440 A
3735 V
(05312)210 1122 A
3825 V
(05313)210 1122 A
(#include)336 1440 A
(<minix/config.h>)672 1818 A
3915 V
(05314)210 1122 A
(#include)336 1440 A
("config.h")420 1818 A
4005 V
(05315)210 1122 A
4095 V
(05316)210 1122 A
1440(/*)S
(Variables)378 1566 A
(relating)336 1986 A
2364(to)S
(shutting)336 2490 A
(down)168 2868 A
(MINIX.)252 3078 A
3372(*/)S
4185 V
(05317)210 1122 A
(EXTERN)252 1440 A
(char)168 1734 A
(kernel_exception;)714 1944 A
3120(/*)S
(TRUE)168 3246 A
(after)210 3456 A
(system)252 3708 A
(exceptions)420 4002 A
4464(*/)S
4275 V
(05318)210 1122 A
(EXTERN)252 1440 A
(char)168 1734 A
(shutdown_started;)714 1944 A
3120(/*)S
(TRUE)168 3246 A
(after)210 3456 A
(shutdowns)378 3708 A
4128(/)S
(reboots)294 4212 A
4548(*/)S
4365 V
(05319)210 1122 A
4455 V
(05320)210 1122 A
1440(/*)S
(Kernel)252 1566 A
(information)462 1860 A
(structures.)462 2364 A
(This)168 2868 A
(groups)252 3078 A
(vital)210 3372 A
(kernel)252 3624 A
(information.)504 3918 A
4464(*/)S
4545 V
(05321)210 1122 A
(EXTERN)252 1440 A
(phys_bytes)420 1734 A
(aout;)210 2196 A
3120(/*)S
(address)294 3246 A
3582(of)S
(a.out)210 3708 A
(headers)294 3960 A
4296(*/)S
4635 V
(05322)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(kinfo)210 2028 A
(kinfo;)252 2280 A
3120(/*)S
(kernel)252 3246 A
(information)462 3540 A
(for)126 4044 A
(users)210 4212 A
4464(*/)S
4725 V
(05323)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(machine)294 2028 A
(machine;)336 2364 A
3120(/*)S
(machine)294 3246 A
(information)462 3582 A
(for)126 4086 A
(users)210 4254 A
4506(*/)S
4815 V
(05324)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(kmessages)378 2028 A
(kmess;)252 2448 A
3120(/*)S
(diagnostic)420 3246 A
(messages)336 3708 A
4086(in)S
(kernel)252 4212 A
4506(*/)S
4905 V
(05325)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(randomness)420 2028 A
(krandom;)336 2490 A
3120(/*)S
(gather)252 3246 A
(kernel)252 3540 A
(random)252 3834 A
(information)462 4128 A
4632(*/)S
4995 V
(05326)210 1122 A
5085 V
(05327)210 1122 A
1440(/*)S
(Process)294 1566 A
(scheduling)420 1902 A
(information)462 2364 A
(and)126 2868 A
(the)126 3036 A
(kernel)252 3204 A
(reentry)294 3498 A
(count.)252 3834 A
4128(*/)S
5175 V
(05328)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(proc)168 2028 A
(*prev_ptr;)420 2238 A
2784(/*)S
(previously)420 2910 A
(running)294 3372 A
(process)294 3708 A
4044(*/)S
5265 V
(05329)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(proc)168 2028 A
(*proc_ptr;)420 2238 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(currently)378 3372 A
(running)294 3792 A
(process)294 4128 A
4464(*/)S
5355 V
(05330)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(proc)168 2028 A
(*next_ptr;)420 2238 A
2784(/*)S
(next)168 2910 A
(process)294 3120 A
3456(to)S
(run)126 3582 A
(after)210 3750 A
(restart\(\))378 4002 A
4422(*/)S
5445 V
(05331)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(proc)168 2028 A
(*bill_ptr;)420 2238 A
2784(/*)S
(process)294 2910 A
3246(to)S
(bill)168 3372 A
(for)126 3582 A
(clock)210 3750 A
(ticks)210 4002 A
4254(*/)S
5535 V
(05332)210 1122 A
(EXTERN)252 1440 A
(char)168 1734 A
(k_reenter;)420 1944 A
2784(/*)S
(kernel)252 2910 A
(reentry)294 3204 A
(count)210 3540 A
(\(entry)252 3792 A
(count)210 4086 A
(less)168 4338 A
4548(1\))S
4674(*/)S
5625 V
(05333)210 1122 A
(EXTERN)252 1440 A
(unsigned)336 1734 A
(lost_ticks;)462 2112 A
2784(/*)S
(clock)210 2910 A
(ticks)210 3162 A
(counted)294 3414 A
(outside)294 3750 A
(clock)210 4086 A
(task)168 4338 A
4548(*/)S
5715 V
(05334)210 1122 A
5805 V
(05335)210 1122 A
1440(/*)S
(Interrupt)378 1566 A
(related)294 1986 A
(variables.)420 2322 A
2784(*/)S
5895 V
(05336)210 1122 A
(EXTERN)252 1440 A
(irq_hook_t)420 1734 A
(irq_hooks[NR_IRQ_HOOKS];)1008 2196 A
3456(/*)S
(hooks)210 3582 A
(for)126 3834 A
(general)294 4002 A
(use)126 4338 A
4506(*/)S
5985 V
(05337)210 1122 A
(EXTERN)252 1440 A
(irq_hook_t)420 1734 A
(*irq_handlers[NR_IRQ_VECTORS];/*)1344 2196 A
(list)168 3582 A
3792(of)S
(IRQ)126 3918 A
(handlers)336 4086 A
4464(*/)S
6075 V
(05338)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(irq_actids[NR_IRQ_VECTORS];)1134 1902 A
3456(/*)S
(IRQ)126 3582 A
3750(ID)S
(bits)168 3876 A
(active)252 4086 A
4380(*/)S
6165 V
(05339)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(irq_use;)336 1902 A
3456(/*)S
(map)126 3582 A
3750(of)S
(all)126 3876 A
(in-use)252 4044 A
(irq's)210 4338 A
4590(*/)S
6255 V
(05340)210 1122 A
6345 V
(05341)210 1122 A
1440(/*)S
(Miscellaneous.)588 1566 A
2196(*/)S
6435 V
(05342)210 1122 A
(EXTERN)252 1440 A
(reg_t)210 1734 A
(mon_ss,)294 1986 A
(mon_sp;)294 2322 A
3120(/*)S
(boot)168 3246 A
(monitor)294 3456 A
(stack)210 3792 A
4044(*/)S
6525 V
(05343)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(mon_return;)462 1902 A
3120(/*)S
(true)168 3246 A
3456(if)S
3582(we)S
(can)126 3708 A
(return)252 3876 A
4170(to)S
(monitor)294 4296 A
4632(*/)S
6615 V
(05344)210 1122 A
6705 V
(05345)210 1122 A
1440(/*)S
(Variables)378 1566 A
(that)168 1986 A
(are)126 2196 A
(initialized)462 2364 A
(elsewhere)378 2868 A
(are)126 3288 A
(just)168 3456 A
(extern)252 3666 A
(here.)210 3960 A
4212(*/)S
6795 V
(05346)210 1122 A
(extern)252 1440 A
(struct)252 1734 A
(boot_image)420 2028 A
(image[];)336 2490 A
3120(/*)S
(system)252 3246 A
(image)210 3540 A
(processes)378 3792 A
4212(*/)S
6885 V
(05347)210 1122 A
(extern)252 1440 A
(char)168 1734 A
(*t_stack[];)462 1944 A
3120(/*)S
(task)168 3246 A
(stack)210 3456 A
(space)210 3708 A
3960(*/)S
6975 V
(05348)210 1122 A
(extern)252 1440 A
(struct)252 1734 A
(segdesc_s)378 2028 A
(gdt[];)252 2448 A
3120(/*)S
(global)252 3246 A
(descriptor)420 3540 A
(table)210 4002 A
4254(*/)S
7065 V
(05349)210 1122 A
8418 V
EP
%%Page: 60 60
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(60)S
11 R
2497(File:)S
2730(kernel/glo.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(05350)210 1122 A
(EXTERN)252 1440 A
(_PROTOTYPE\()462 1734 A
(void)168 2238 A
(\(*level0_func\),)630 2448 A
(\(void\))252 3120 A
3414(\);)S
1845 V
(05351)210 1122 A
1935 V
(05352)210 1122 A
(#endif)252 1440 A
1734(/*)S
(GLO_H)210 1860 A
2112(*/)S
2025 V
(05353)210 1122 A
2115 V
(05354)210 1122 A
2205 V
(05355)210 1122 A
2295 V
(05356)210 1122 A
2385 V
(05357)210 1122 A
2745 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2835 V
(kernel/ipc.h)504 2676 A
2925 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3105 V
(05400)210 1122 A
(#ifndef)294 1440 A
(IPC_H)210 1776 A
3195 V
(05401)210 1122 A
(#define)294 1440 A
(IPC_H)210 1776 A
3285 V
(05402)210 1122 A
3375 V
(05403)210 1122 A
1440(/*)S
(This)168 1566 A
(header)252 1776 A
(file)168 2070 A
(defines)294 2280 A
(constants)378 2616 A
(for)126 3036 A
(MINIX)210 3204 A
(inter-process)546 3456 A
(communication.)588 4044 A
3465 V
(05404)210 1122 A
1482(*)S
(These)210 1566 A
(definitions)462 1818 A
(are)126 2322 A
(used)168 2490 A
2700(in)S
(the)126 2826 A
(file)168 2994 A
(proc.c.)294 3204 A
3555 V
(05405)210 1122 A
1482(*/)S
3645 V
(05406)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
3735 V
(05407)210 1122 A
3825 V
(05408)210 1122 A
1440(/*)S
(Masks)210 1566 A
(and)126 1818 A
(flags)210 1986 A
(for)126 2238 A
(system)252 2406 A
(calls.)252 2700 A
2994(*/)S
3915 V
(05409)210 1122 A
(#define)294 1440 A
(SYSCALL_FUNC)504 1776 A
(0x0F)168 2448 A
2784(/*)S
(mask)168 2910 A
(for)126 3120 A
(system)252 3288 A
(call)168 3582 A
(function)336 3792 A
4170(*/)S
4005 V
(05410)210 1122 A
(#define)294 1440 A
(SYSCALL_FLAGS)546 1776 A
(0xF0)168 2448 A
2784(/*)S
(mask)168 2910 A
(for)126 3120 A
(system)252 3288 A
(call)168 3582 A
(flags)210 3792 A
4044(*/)S
4095 V
(05411)210 1122 A
(#define)294 1440 A
(NON_BLOCKING)504 1776 A
(0x10)168 2448 A
2784(/*)S
(prevent)294 2910 A
(blocking,)378 3246 A
(return)252 3666 A
(error)210 3960 A
4212(*/)S
4185 V
(05412)210 1122 A
4275 V
(05413)210 1122 A
1440(/*)S
(System)252 1566 A
(call)168 1860 A
(numbers)294 2070 A
(that)168 2406 A
(are)126 2616 A
(passed)252 2784 A
(when)168 3078 A
(trapping)336 3288 A
3666(to)S
(the)126 3792 A
(kernel.)294 3960 A
(The)126 4296 A
4365 V
(05414)210 1122 A
1482(*)S
(numbers)294 1566 A
(are)126 1902 A
(carefully)378 2070 A
(defined)294 2490 A
2826(so)S
(that)168 2952 A
3162(it)S
(can)126 3288 A
(easily)252 3456 A
3750(be)S
(seen)168 3876 A
(\(based)252 4086 A
4380(on)S
4455 V
(05415)210 1122 A
1482(*)S
(the)126 1566 A
(bits)168 1734 A
(that)168 1944 A
(are)126 2154 A
(on\))126 2322 A
(which)210 2490 A
(checks)252 2742 A
(should)252 3036 A
3330(be)S
(done)168 3456 A
3666(in)S
(sys_call\(\).)462 3792 A
4545 V
(05416)210 1122 A
1482(*/)S
4635 V
(05417)210 1122 A
(#define)294 1440 A
(SEND)168 1776 A
2574(1)S
2784(/*)S
2910(0)S
2994(0)S
3078(0)S
3162(1)S
3246(:)S
(blocking)336 3330 A
(send)168 3708 A
3918(*/)S
4725 V
(05418)210 1122 A
(#define)294 1440 A
(RECEIVE)294 1776 A
2574(2)S
2784(/*)S
2910(0)S
2994(0)S
3078(1)S
3162(0)S
3246(:)S
(blocking)336 3330 A
(receive)294 3708 A
4044(*/)S
4815 V
(05419)210 1122 A
(#define)294 1440 A
(SENDREC)294 1776 A
2574(3)S
2784(/*)S
2910(0)S
2994(0)S
3078(1)S
3162(1)S
3246(:)S
(SEND)168 3330 A
3540(+)S
(RECEIVE)294 3624 A
3960(*/)S
4905 V
(05420)210 1122 A
(#define)294 1440 A
(NOTIFY)252 1776 A
2574(4)S
2784(/*)S
2910(0)S
2994(1)S
3078(0)S
3162(0)S
3246(:)S
(nonblocking)462 3330 A
(notify)252 3834 A
4128(*/)S
4995 V
(05421)210 1122 A
(#define)294 1440 A
(ECHO)168 1776 A
2574(8)S
2784(/*)S
2910(1)S
2994(0)S
3078(0)S
3162(0)S
3246(:)S
(echo)168 3330 A
3540(a)S
(message)294 3624 A
3960(*/)S
5085 V
(05422)210 1122 A
5175 V
(05423)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(bit)126 2154 A
(masks)210 2322 A
(determine)378 2574 A
(what)168 2994 A
(checks)252 3204 A
(that)168 3498 A
(should)252 3708 A
4002(be)S
(done.)210 4128 A
4380(*/)S
5265 V
(05424)210 1122 A
(#define)294 1440 A
(CHECK_PTR)378 1776 A
(0x0B)168 2448 A
2784(/*)S
2910(1)S
2994(0)S
3078(1)S
3162(1)S
3246(:)S
(validate)336 3330 A
(message)294 3708 A
(buffer)252 4044 A
4338(*/)S
5355 V
(05425)210 1122 A
(#define)294 1440 A
(CHECK_DST)378 1776 A
(0x05)168 2448 A
2784(/*)S
2910(0)S
2994(1)S
3078(0)S
3162(1)S
3246(:)S
(validate)336 3330 A
(message)294 3708 A
(destination)462 4044 A
4548(*/)S
5445 V
(05426)210 1122 A
(#define)294 1440 A
(CHECK_SRC)378 1776 A
(0x02)168 2448 A
2784(/*)S
2910(0)S
2994(0)S
3078(1)S
3162(0)S
3246(:)S
(validate)336 3330 A
(message)294 3708 A
(source)252 4044 A
4338(*/)S
5535 V
(05427)210 1122 A
5625 V
(05428)210 1122 A
(#endif)252 1440 A
1734(/*)S
(IPC_H)210 1860 A
2112(*/)S
5895 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5985 V
(kernel/proc.h)546 2676 A
6075 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6255 V
(05500)210 1122 A
(#ifndef)294 1440 A
(PROC_H)252 1776 A
6345 V
(05501)210 1122 A
(#define)294 1440 A
(PROC_H)252 1776 A
6435 V
(05502)210 1122 A
6525 V
(05503)210 1122 A
1440(/*)S
(Here)168 1566 A
1776(is)S
(the)126 1902 A
(declaration)462 2070 A
2574(of)S
(the)126 2700 A
(process)294 2868 A
(table.)252 3204 A
3540(It)S
(contains)336 3666 A
(all)126 4044 A
(process)294 4212 A
6615 V
(05504)210 1122 A
1482(*)S
(data,)210 1566 A
(including)378 1818 A
(registers,)420 2238 A
(flags,)252 2700 A
(scheduling)420 2994 A
(priority,)378 3456 A
(memory)252 3876 A
(map,)168 4170 A
6705 V
(05505)210 1122 A
1482(*)S
(accounting,)462 1566 A
(message)294 2070 A
(passing)294 2406 A
(\(IPC\))210 2742 A
(information,)504 2994 A
(and)126 3540 A
3708(so)S
(on.)126 3834 A
6795 V
(05506)210 1122 A
1482(*)S
6885 V
(05507)210 1122 A
1482(*)S
(Many)168 1566 A
(assembly)336 1776 A
(code)168 2154 A
(routines)336 2364 A
(reference)378 2742 A
(fields)252 3162 A
3456(in)S
(it.)126 3582 A
(The)126 3792 A
(offsets)294 3960 A
4296(to)S
(these)210 4422 A
6975 V
(05508)210 1122 A
1482(*)S
(fields)252 1566 A
(are)126 1860 A
(defined)294 2028 A
2364(in)S
(the)126 2490 A
(assembler)378 2658 A
(include)294 3078 A
(file)168 3414 A
(sconst.h.)378 3624 A
(When)168 4086 A
(changing)336 4296 A
7065 V
(05509)210 1122 A
1482(*)S
(struct)252 1566 A
(proc,)210 1860 A
2112(be)S
(sure)168 2238 A
2448(to)S
(change)252 2574 A
(sconst.h)336 2868 A
3246(to)S
(match.)252 3372 A
8418 V
EP
%%Page: 61 61
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2469(File:)S
2702(kernel/proc.h)S
12 B
4560(61)S
1755 V
7 LST
(05510)210 1122 A
1482(*/)S
1845 V
(05511)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
1935 V
(05512)210 1122 A
(#include)336 1440 A
("protect.h")462 1818 A
2025 V
(05513)210 1122 A
(#include)336 1440 A
("const.h")378 1818 A
2115 V
(05514)210 1122 A
(#include)336 1440 A
("priv.h")336 1818 A
2205 V
(05515)210 1122 A
2295 V
(05516)210 1122 A
(struct)252 1440 A
(proc)168 1734 A
1944({)S
2385 V
(05517)210 1122 A
(struct)252 1524 A
(stackframe_s)504 1818 A
(p_reg;)252 2364 A
2784(/*)S
(process')336 2910 A
(registers)378 3288 A
(saved)210 3708 A
3960(in)S
(stack)210 4086 A
(frame)210 4338 A
4590(*/)S
2475 V
(05518)210 1122 A
(reg_t)210 1524 A
(p_ldt_sel;)420 1776 A
2784(/*)S
(selector)336 2910 A
3288(in)S
(gdt)126 3414 A
(with)168 3582 A
(ldt)126 3792 A
(base)168 3960 A
(and)126 4170 A
(limit)210 4338 A
4590(*/)S
2565 V
(05519)210 1122 A
(struct)252 1524 A
(segdesc_s)378 1818 A
(p_ldt[2+NR_REMOTE_SEGS];)1008 2238 A
3288(/*)S
(CS,)126 3414 A
3582(DS)S
(and)126 3708 A
(remote)252 3876 A
(segments)336 4170 A
4548(*/)S
2655 V
(05520)210 1122 A
2745 V
(05521)210 1122 A
(proc_nr_t)378 1524 A
(p_nr;)210 1944 A
2784(/*)S
(number)252 2910 A
3204(of)S
(this)168 3330 A
(process)294 3540 A
(\(for)168 3876 A
(fast)168 4086 A
(access\))294 4296 A
4632(*/)S
2835 V
(05522)210 1122 A
(struct)252 1524 A
(priv)168 1818 A
(*p_priv;)336 2028 A
2784(/*)S
(system)252 2910 A
(privileges)420 3204 A
(structure)378 3666 A
4086(*/)S
2925 V
(05523)210 1122 A
(char)168 1524 A
(p_rts_flags;)504 1734 A
2784(/*)S
(SENDING,)336 2910 A
(RECEIVING,)420 3288 A
(etc.)168 3750 A
3960(*/)S
3015 V
(05524)210 1122 A
3105 V
(05525)210 1122 A
(char)168 1524 A
(p_priority;)462 1734 A
2784(/*)S
(current)294 2910 A
(scheduling)420 3246 A
(priority)336 3708 A
4086(*/)S
3195 V
(05526)210 1122 A
(char)168 1524 A
(p_max_priority;)630 1734 A
2784(/*)S
(maximum)294 2910 A
(scheduling)420 3246 A
(priority)336 3708 A
4086(*/)S
3285 V
(05527)210 1122 A
(char)168 1524 A
(p_ticks_left;)546 1734 A
2784(/*)S
(number)252 2910 A
3204(of)S
(scheduling)420 3330 A
(ticks)210 3792 A
(left)168 4044 A
4254(*/)S
3375 V
(05528)210 1122 A
(char)168 1524 A
(p_quantum_size;)630 1734 A
2784(/*)S
(quantum)294 2910 A
(size)168 3246 A
3456(in)S
(ticks)210 3582 A
3834(*/)S
3465 V
(05529)210 1122 A
3555 V
(05530)210 1122 A
(struct)252 1524 A
(mem_map)294 1818 A
(p_memmap[NR_LOCAL_SEGS];)1008 2154 A
3288(/*)S
(memory)252 3414 A
(map)126 3708 A
(\(T,)126 3876 A
4044(D,)S
4170(S\))S
4296(*/)S
3645 V
(05531)210 1122 A
3735 V
(05532)210 1122 A
(clock_t)294 1524 A
(p_user_time;)504 1860 A
2784(/*)S
(user)168 2910 A
(time)168 3120 A
3330(in)S
(ticks)210 3456 A
3708(*/)S
3825 V
(05533)210 1122 A
(clock_t)294 1524 A
(p_sys_time;)462 1860 A
2784(/*)S
(sys)126 2910 A
(time)168 3078 A
3288(in)S
(ticks)210 3414 A
3666(*/)S
3915 V
(05534)210 1122 A
4005 V
(05535)210 1122 A
(struct)252 1524 A
(proc)168 1818 A
(*p_nextready;)546 2028 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(next)168 3372 A
(ready)210 3582 A
(process)294 3834 A
4170(*/)S
4095 V
(05536)210 1122 A
(struct)252 1524 A
(proc)168 1818 A
(*p_caller_q;)504 2028 A
2784(/*)S
(head)168 2910 A
3120(of)S
(list)168 3246 A
3456(of)S
(procs)210 3582 A
(wishing)294 3834 A
4170(to)S
(send)168 4296 A
4506(*/)S
4185 V
(05537)210 1122 A
(struct)252 1524 A
(proc)168 1818 A
(*p_q_link;)420 2028 A
2784(/*)S
(link)168 2910 A
3120(to)S
(next)168 3246 A
(proc)168 3456 A
(wishing)294 3666 A
4002(to)S
(send)168 4128 A
4338(*/)S
4275 V
(05538)210 1122 A
(message)294 1524 A
(*p_messbuf;)462 1860 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(passed)252 3372 A
(message)294 3666 A
(buffer)252 4002 A
4296(*/)S
4365 V
(05539)210 1122 A
(proc_nr_t)378 1524 A
(p_getfrom;)420 1944 A
2784(/*)S
(from)168 2910 A
(whom)168 3120 A
(does)168 3330 A
(process)294 3540 A
(want)168 3876 A
4086(to)S
(receive?)336 4212 A
4590(*/)S
4455 V
(05540)210 1122 A
(proc_nr_t)378 1524 A
(p_sendto;)378 1944 A
2784(/*)S
2910(to)S
(whom)168 3036 A
(does)168 3246 A
(process)294 3456 A
(want)168 3792 A
4002(to)S
(send?)210 4128 A
4380(*/)S
4545 V
(05541)210 1122 A
4635 V
(05542)210 1122 A
(sigset_t)336 1524 A
(p_pending;)420 1902 A
2784(/*)S
(bit)126 2910 A
(map)126 3078 A
(for)126 3246 A
(pending)294 3414 A
(kernel)252 3750 A
(signals)294 4044 A
4380(*/)S
4725 V
(05543)210 1122 A
4815 V
(05544)210 1122 A
(char)168 1524 A
(p_name[P_NAME_LEN];)798 1734 A
2784(/*)S
(name)168 2910 A
3120(of)S
(the)126 3246 A
(process,)336 3414 A
(including)378 3792 A
4212(\\0)S
4338(*/)S
4905 V
(05545)210 1122 A
1440(};)S
4995 V
(05546)210 1122 A
5085 V
(05547)210 1122 A
1440(/*)S
(Bits)168 1566 A
(for)126 1776 A
(the)126 1944 A
(runtime)294 2112 A
(flags.)252 2448 A
2742(A)S
(process)294 2826 A
3162(is)S
(runnable)336 3288 A
(iff)126 3666 A
(p_rts_flags)462 3834 A
4338(==)S
4464(0.)S
4590(*/)S
5175 V
(05548)210 1122 A
(#define)294 1440 A
(SLOT_FREE)378 1776 A
(0x01)168 2448 A
2784(/*)S
(process)294 2910 A
(slot)168 3246 A
3456(is)S
(free)168 3582 A
3792(*/)S
5265 V
(05549)210 1122 A
(#define)294 1440 A
(NO_MAP)252 1776 A
(0x02)168 2448 A
2784(/*)S
(keeps)210 2910 A
(unmapped)336 3162 A
(forked)252 3540 A
(child)210 3834 A
(from)168 4086 A
(running)294 4296 A
4632(*/)S
5355 V
(05550)210 1122 A
(#define)294 1440 A
(SENDING)294 1776 A
(0x04)168 2448 A
2784(/*)S
(process)294 2910 A
(blocked)294 3246 A
(trying)252 3582 A
3876(to)S
(SEND)168 4002 A
4212(*/)S
5445 V
(05551)210 1122 A
(#define)294 1440 A
(RECEIVING)378 1776 A
(0x08)168 2448 A
2784(/*)S
(process)294 2910 A
(blocked)294 3246 A
(trying)252 3582 A
3876(to)S
(RECEIVE)294 4002 A
4338(*/)S
5535 V
(05552)210 1122 A
(#define)294 1440 A
(SIGNALED)336 1776 A
(0x10)168 2448 A
2784(/*)S
(set)126 2910 A
(when)168 3078 A
(new)126 3288 A
(kernel)252 3456 A
(signal)252 3750 A
(arrives)294 4044 A
4380(*/)S
5625 V
(05553)210 1122 A
(#define)294 1440 A
(SIG_PENDING)462 1776 A
(0x20)168 2448 A
2784(/*)S
(unready)294 2910 A
(while)210 3246 A
(signal)252 3498 A
(being)210 3792 A
(processed)378 4044 A
4464(*/)S
5715 V
(05554)210 1122 A
(#define)294 1440 A
(P_STOP)252 1776 A
(0x40)168 2448 A
2784(/*)S
(set)126 2910 A
(when)168 3078 A
(process)294 3288 A
3624(is)S
(being)210 3750 A
(traced)252 4002 A
4296(*/)S
5805 V
(05555)210 1122 A
(#define)294 1440 A
(NO_PRIV)294 1776 A
(0x80)168 2448 A
2784(/*)S
(keep)168 2910 A
(forked)252 3120 A
(system)252 3414 A
(process)294 3708 A
(from)168 4044 A
(running)294 4254 A
4590(*/)S
5895 V
(05556)210 1122 A
5985 V
(05557)210 1122 A
1440(/*)S
(Scheduling)420 1566 A
(priorities)420 2028 A
(for)126 2490 A
(p_priority.)462 2658 A
(Values)252 3162 A
(must)168 3456 A
(start)210 3666 A
3918(at)S
(zero)168 4044 A
(\(highest)336 4254 A
6075 V
(05558)210 1122 A
1482(*)S
(priority\))378 1566 A
(and)126 1986 A
(increment.)420 2154 A
(Priorities)420 2658 A
3120(of)S
(the)126 3246 A
(processes)378 3414 A
3834(in)S
(the)126 3960 A
(boot)168 4128 A
(image)210 4338 A
6165 V
(05559)210 1122 A
1482(*)S
(can)126 1566 A
1734(be)S
(set)126 1860 A
2028(in)S
(table.c.)336 2154 A
(IDLE)168 2532 A
(must)168 2742 A
(have)168 2952 A
3162(a)S
(queue)210 3246 A
(for)126 3498 A
(itself,)294 3666 A
4002(to)S
(prevent)294 4128 A
(low)126 4464 A
6255 V
(05560)210 1122 A
1482(*)S
(priority)336 1566 A
(user)168 1944 A
(processes)378 2154 A
2574(to)S
(run)126 2700 A
(round-robin)462 2868 A
(with)168 3372 A
(IDLE.)210 3582 A
6345 V
(05561)210 1122 A
1482(*/)S
6435 V
(05562)210 1122 A
(#define)294 1440 A
(NR_SCHED_QUEUES)630 1776 A
2532(16)S
2784(/*)S
(MUST)168 2910 A
(equal)210 3120 A
(minimum)294 3372 A
(priority)336 3708 A
4086(+)S
4170(1)S
4254(*/)S
6525 V
(05563)210 1122 A
(#define)294 1440 A
(TASK_Q)252 1776 A
2574(0)S
2784(/*)S
(highest,)336 2910 A
(used)168 3288 A
(for)126 3498 A
(kernel)252 3666 A
(tasks)210 3960 A
4212(*/)S
6615 V
(05564)210 1122 A
(#define)294 1440 A
(MAX_USER_Q)420 1776 A
2574(0)S
2784(/*)S
(highest)294 2910 A
(priority)336 3246 A
(for)126 3624 A
(user)168 3792 A
(processes)378 4002 A
4422(*/)S
6705 V
(05565)210 1122 A
(#define)294 1440 A
(USER_Q)252 1776 A
2574(7)S
2784(/*)S
(default)294 2910 A
(\(should)294 3246 A
(correspond)420 3582 A
4044(to)S
(nice)168 4170 A
4380(0\))S
4506(*/)S
6795 V
(05566)210 1122 A
(#define)294 1440 A
(MIN_USER_Q)420 1776 A
2532(14)S
2784(/*)S
(minimum)294 2910 A
(priority)336 3246 A
(for)126 3624 A
(user)168 3792 A
(processes)378 4002 A
4422(*/)S
6885 V
(05567)210 1122 A
(#define)294 1440 A
(IDLE_Q)252 1776 A
2532(15)S
2784(/*)S
(lowest,)294 2910 A
(only)168 3246 A
(IDLE)168 3456 A
(process)294 3666 A
(goes)168 4002 A
(here)168 4212 A
4422(*/)S
6975 V
(05568)210 1122 A
7065 V
(05569)210 1122 A
1440(/*)S
(Magic)210 1566 A
(process)294 1818 A
(table)210 2154 A
(addresses.)420 2406 A
2868(*/)S
8418 V
EP
%%Page: 62 62
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(62)S
11 R
2469(File:)S
2702(kernel/proc.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(05570)210 1122 A
(#define)294 1440 A
(BEG_PROC_ADDR)546 1776 A
(\(&proc[0]\))420 2364 A
1845 V
(05571)210 1122 A
(#define)294 1440 A
(BEG_USER_ADDR)546 1776 A
(\(&proc[NR_TASKS]\))714 2364 A
1935 V
(05572)210 1122 A
(#define)294 1440 A
(END_PROC_ADDR)546 1776 A
(\(&proc[NR_TASKS)630 2364 A
3036(+)S
(NR_PROCS]\))420 3120 A
2025 V
(05573)210 1122 A
2115 V
(05574)210 1122 A
(#define)294 1440 A
(NIL_PROC)336 1776 A
(\(\(struct)336 2532 A
(proc)168 2910 A
3120(*\))S
3246(0\))S
2205 V
(05575)210 1122 A
(#define)294 1440 A
(NIL_SYS_PROC)504 1776 A
(\(\(struct)336 2532 A
(proc)168 2910 A
3120(*\))S
3246(1\))S
2295 V
(05576)210 1122 A
(#define)294 1440 A
(cproc_addr\(n\))546 1776 A
(\(&\(proc)294 2532 A
2868(+)S
(NR_TASKS\)[\(n\)]\))630 2952 A
2385 V
(05577)210 1122 A
(#define)294 1440 A
(proc_addr\(n\))504 1776 A
(\(pproc_addr)462 2532 A
3036(+)S
(NR_TASKS\)[\(n\)])588 3120 A
2475 V
(05578)210 1122 A
(#define)294 1440 A
(proc_nr\(p\))420 1776 A
(\(\(p\)->p_nr\))462 2532 A
2565 V
(05579)210 1122 A
2655 V
(05580)210 1122 A
(#define)294 1440 A
(isokprocn\(n\))504 1776 A
(\(\(unsigned\))462 2532 A
(\(\(n\))168 3036 A
3246(+)S
(NR_TASKS\))378 3330 A
3750(<)S
(NR_PROCS)336 3834 A
4212(+)S
(NR_TASKS\))378 4296 A
2745 V
(05581)210 1122 A
(#define)294 1440 A
(isemptyn\(n\))462 1776 A
(isemptyp\(proc_addr\(n\)\))924 2532 A
2835 V
(05582)210 1122 A
(#define)294 1440 A
(isemptyp\(p\))462 1776 A
(\(\(p\)->p_rts_flags)714 2532 A
3288(==)S
(SLOT_FREE\))420 3414 A
2925 V
(05583)210 1122 A
(#define)294 1440 A
(iskernelp\(p\))504 1776 A
(iskerneln\(\(p\)->p_nr\))840 2532 A
3015 V
(05584)210 1122 A
(#define)294 1440 A
(iskerneln\(n\))504 1776 A
(\(\(n\))168 2532 A
2742(<)S
2826(0\))S
3105 V
(05585)210 1122 A
(#define)294 1440 A
(isuserp\(p\))420 1776 A
(isusern\(\(p\)->p_nr\))756 2532 A
3195 V
(05586)210 1122 A
(#define)294 1440 A
(isusern\(n\))420 1776 A
(\(\(n\))168 2532 A
2742(>=)S
2868(0\))S
3285 V
(05587)210 1122 A
3375 V
(05588)210 1122 A
1440(/*)S
(The)126 1566 A
(process)294 1734 A
(table)210 2070 A
(and)126 2322 A
(pointers)336 2490 A
2868(to)S
(process)294 2994 A
(table)210 3330 A
(slots.)252 3582 A
(The)126 3876 A
(pointers)336 4044 A
(allow)210 4422 A
3465 V
(05589)210 1122 A
1482(*)S
(faster)252 1566 A
(access)252 1860 A
(because)294 2154 A
(now)126 2490 A
2658(a)S
(process)294 2742 A
(entry)210 3078 A
(can)126 3330 A
3498(be)S
(found)210 3624 A
3876(by)S
(indexing)336 4002 A
(the)126 4380 A
3555 V
(05590)210 1122 A
1482(*)S
(pproc_addr)420 1566 A
(array,)252 2028 A
(while)210 2322 A
(accessing)378 2574 A
2994(an)S
(element)294 3120 A
3456(i)S
(requires)336 3540 A
3918(a)S
(multiplication)588 4002 A
3645 V
(05591)210 1122 A
1482(*)S
(with)168 1566 A
(sizeof\(struct)546 1776 A
(proc\))210 2364 A
2616(to)S
(determine)378 2742 A
(the)126 3162 A
(address.)336 3330 A
3735 V
(05592)210 1122 A
1482(*/)S
3825 V
(05593)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(proc)168 2028 A
(proc[NR_TASKS)546 2238 A
2826(+)S
(NR_PROCS];)420 2910 A
3456(/*)S
(process)294 3582 A
(table)210 3918 A
4170(*/)S
3915 V
(05594)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(proc)168 2028 A
(*pproc_addr[NR_TASKS)840 2238 A
3120(+)S
(NR_PROCS];)420 3204 A
4005 V
(05595)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(proc)168 2028 A
(*rdy_head[NR_SCHED_QUEUES];)1134 2238 A
3414(/*)S
(ptrs)168 3540 A
3750(to)S
(ready)210 3876 A
(list)168 4128 A
(headers)294 4338 A
4674(*/)S
4095 V
(05596)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(proc)168 2028 A
(*rdy_tail[NR_SCHED_QUEUES];)1134 2238 A
3414(/*)S
(ptrs)168 3540 A
3750(to)S
(ready)210 3876 A
(list)168 4128 A
(tails)210 4338 A
4590(*/)S
4185 V
(05597)210 1122 A
4275 V
(05598)210 1122 A
(#endif)252 1440 A
1734(/*)S
(PROC_H)252 1860 A
2154(*/)S
4545 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4635 V
(kernel/sconst.h)630 2676 A
4725 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4905 V
(05600)210 1122 A
1440(!)S
(Miscellaneous)546 1524 A
(constants)378 2112 A
(used)168 2532 A
2742(in)S
(assembler)378 2868 A
(code.)210 3288 A
4995 V
(05601)210 1122 A
1440(W)S
2112(=)S
(_WORD_SIZE)420 2448 A
3120(!)S
(Machine)294 3204 A
(word)168 3540 A
(size.)210 3750 A
5085 V
(05602)210 1122 A
5175 V
(05603)210 1122 A
1440(!)S
(Offsets)294 1524 A
1860(in)S
(struct)252 1986 A
(proc.)210 2280 A
(They)168 2532 A
(MUST)168 2742 A
(match)210 2952 A
(proc.h.)294 3204 A
5265 V
(05604)210 1122 A
(P_STACKBASE)462 1440 A
2112(=)S
2448(0)S
5355 V
(05605)210 1122 A
(GSREG)210 1440 A
2112(=)S
(P_STACKBASE)462 2448 A
5445 V
(05606)210 1122 A
(FSREG)210 1440 A
2112(=)S
(GSREG)210 2448 A
2700(+)S
2784(2)S
3120(!)S
(386)126 3204 A
(introduces)420 3372 A
3834(FS)S
(and)126 3960 A
4128(GS)S
(segments)336 4254 A
5535 V
(05607)210 1122 A
(ESREG)210 1440 A
2112(=)S
(FSREG)210 2448 A
2700(+)S
2784(2)S
5625 V
(05608)210 1122 A
(DSREG)210 1440 A
2112(=)S
(ESREG)210 2448 A
2700(+)S
2784(2)S
5715 V
(05609)210 1122 A
(DIREG)210 1440 A
2112(=)S
(DSREG)210 2448 A
2700(+)S
2784(2)S
5805 V
(05610)210 1122 A
(SIREG)210 1440 A
2112(=)S
(DIREG)210 2448 A
2700(+)S
2784(W)S
5895 V
(05611)210 1122 A
(BPREG)210 1440 A
2112(=)S
(SIREG)210 2448 A
2700(+)S
2784(W)S
5985 V
(05612)210 1122 A
(STREG)210 1440 A
2112(=)S
(BPREG)210 2448 A
2700(+)S
2784(W)S
3120(!)S
(hole)168 3204 A
(for)126 3414 A
(another)294 3582 A
3918(SP)S
6075 V
(05613)210 1122 A
(BXREG)210 1440 A
2112(=)S
(STREG)210 2448 A
2700(+)S
2784(W)S
6165 V
(05614)210 1122 A
(DXREG)210 1440 A
2112(=)S
(BXREG)210 2448 A
2700(+)S
2784(W)S
6255 V
(05615)210 1122 A
(CXREG)210 1440 A
2112(=)S
(DXREG)210 2448 A
2700(+)S
2784(W)S
6345 V
(05616)210 1122 A
(AXREG)210 1440 A
2112(=)S
(CXREG)210 2448 A
2700(+)S
2784(W)S
6435 V
(05617)210 1122 A
(RETADR)252 1440 A
2112(=)S
(AXREG)210 2448 A
2700(+)S
2784(W)S
3120(!)S
(return)252 3204 A
(address)294 3498 A
(for)126 3834 A
(save\(\))252 4002 A
(call)168 4296 A
6525 V
(05618)210 1122 A
(PCREG)210 1440 A
2112(=)S
(RETADR)252 2448 A
2742(+)S
2826(W)S
6615 V
(05619)210 1122 A
(CSREG)210 1440 A
2112(=)S
(PCREG)210 2448 A
2700(+)S
2784(W)S
6705 V
(05620)210 1122 A
(PSWREG)252 1440 A
2112(=)S
(CSREG)210 2448 A
2700(+)S
2784(W)S
6795 V
(05621)210 1122 A
(SPREG)210 1440 A
2112(=)S
(PSWREG)252 2448 A
2742(+)S
2826(W)S
6885 V
(05622)210 1122 A
(SSREG)210 1440 A
2112(=)S
(SPREG)210 2448 A
2700(+)S
2784(W)S
6975 V
(05623)210 1122 A
(P_STACKTOP)420 1440 A
2112(=)S
(SSREG)210 2448 A
2700(+)S
2784(W)S
7065 V
(05624)210 1122 A
(P_LDT_SEL)378 1440 A
2112(=)S
(P_STACKTOP)420 2448 A
8418 V
EP
%%Page: 63 63
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2429(File:)S
2662(kernel/sconst.h)S
12 B
4560(63)S
1755 V
7 LST
(05625)210 1122 A
(P_LDT)210 1440 A
2112(=)S
(P_LDT_SEL)378 2448 A
2868(+)S
2952(W)S
1845 V
(05626)210 1122 A
1935 V
(05627)210 1122 A
(Msize)210 1440 A
2112(=)S
2448(9)S
3120(!)S
(size)168 3204 A
3414(of)S
3540(a)S
(message)294 3624 A
3960(in)S
(32-bit)252 4086 A
(words)210 4380 A
2295 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2385 V
(kernel/priv.h)546 2676 A
2475 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2655 V
(05700)210 1122 A
(#ifndef)294 1440 A
(PRIV_H)252 1776 A
2745 V
(05701)210 1122 A
(#define)294 1440 A
(PRIV_H)252 1776 A
2835 V
(05702)210 1122 A
2925 V
(05703)210 1122 A
1440(/*)S
(Declaration)462 1566 A
2070(of)S
(the)126 2196 A
(system)252 2364 A
(privileges)420 2658 A
(structure.)420 3120 A
3582(It)S
(defines)294 3708 A
(flags,)252 4044 A
(system)252 4338 A
3015 V
(05704)210 1122 A
1482(*)S
(call)168 1566 A
(masks,)252 1776 A
2070(an)S
(synchronous)462 2196 A
(alarm)210 2700 A
(timer,)252 2952 A
(I/O)126 3246 A
(privileges,)462 3414 A
(pending)294 3918 A
(hardware)336 4254 A
3105 V
(05705)210 1122 A
1482(*)S
(interrupts)420 1566 A
(and)126 2028 A
(notifications,)588 2196 A
(and)126 2826 A
2994(so)S
(on.)126 3120 A
3195 V
(05706)210 1122 A
1482(*)S
(System)252 1566 A
(processes)378 1860 A
(each)168 2280 A
(get)126 2490 A
(their)210 2658 A
(own)126 2910 A
(structure)378 3078 A
(with)168 3498 A
(properties,)462 3708 A
(whereas)294 4212 A
(all)126 4548 A
3285 V
(05707)210 1122 A
1482(*)S
(user)168 1566 A
(processes)378 1776 A
(share)210 2196 A
(one)126 2448 A
(structure.)420 2616 A
(This)168 3078 A
(setup)210 3288 A
(provides)336 3540 A
3918(a)S
(clear)210 4002 A
(separation)420 4254 A
3375 V
(05708)210 1122 A
1482(*)S
(between)294 1566 A
(common)252 1902 A
(and)126 2196 A
(privileged)420 2364 A
(process)294 2826 A
(fields)252 3162 A
(and)126 3456 A
3624(is)S
(very)168 3750 A
(space)210 3960 A
(efficient.)420 4212 A
3465 V
(05709)210 1122 A
1482(*)S
3555 V
(05710)210 1122 A
1482(*)S
(Changes:)336 1566 A
3645 V
(05711)210 1122 A
1482(*)S
(Jul)126 1650 A
(01,)126 1818 A
(2005)168 1986 A
(Created.)336 2448 A
(\(Jorrit)294 2868 A
3204(N.)S
(Herder\))294 3330 A
3735 V
(05712)210 1122 A
1482(*/)S
3825 V
(05713)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
3915 V
(05714)210 1122 A
(#include)336 1440 A
("protect.h")462 1818 A
4005 V
(05715)210 1122 A
(#include)336 1440 A
("const.h")378 1818 A
4095 V
(05716)210 1122 A
(#include)336 1440 A
("type.h")336 1818 A
4185 V
(05717)210 1122 A
4275 V
(05718)210 1122 A
(struct)252 1440 A
(priv)168 1734 A
1944({)S
4365 V
(05719)210 1122 A
(proc_nr_t)378 1524 A
(s_proc_nr;)420 1944 A
2784(/*)S
(number)252 2910 A
3204(of)S
(associated)420 3330 A
(process)294 3792 A
4128(*/)S
4455 V
(05720)210 1122 A
(sys_id_t)336 1524 A
(s_id;)210 1902 A
2784(/*)S
(index)210 2910 A
3162(of)S
(this)168 3288 A
(system)252 3498 A
(structure)378 3792 A
4212(*/)S
4545 V
(05721)210 1122 A
(short)210 1524 A
(s_flags;)336 1776 A
2784(/*)S
(PREEMTIBLE,)462 2910 A
(BILLABLE,)378 3414 A
(etc.)168 3834 A
4044(*/)S
4635 V
(05722)210 1122 A
4725 V
(05723)210 1122 A
(short)210 1524 A
(s_trap_mask;)504 1776 A
2784(/*)S
(allowed)294 2910 A
(system)252 3246 A
(call)168 3540 A
(traps)210 3750 A
4002(*/)S
4815 V
(05724)210 1122 A
(sys_map_t)378 1524 A
(s_ipc_from;)462 1944 A
2784(/*)S
(allowed)294 2910 A
(callers)294 3246 A
3582(to)S
(receive)294 3708 A
(from)168 4044 A
4254(*/)S
4905 V
(05725)210 1122 A
(sys_map_t)378 1524 A
(s_ipc_to;)378 1944 A
2784(/*)S
(allowed)294 2910 A
(destination)462 3246 A
(processes)378 3750 A
4170(*/)S
4995 V
(05726)210 1122 A
(long)168 1524 A
(s_call_mask;)504 1734 A
2784(/*)S
(allowed)294 2910 A
(kernel)252 3246 A
(calls)210 3540 A
3792(*/)S
5085 V
(05727)210 1122 A
5175 V
(05728)210 1122 A
(sys_map_t)378 1524 A
(s_notify_pending;)714 1944 A
2784(/*)S
(bit)126 2910 A
(map)126 3078 A
(with)168 3246 A
(pending)294 3456 A
(notifications)546 3792 A
4380(*/)S
5265 V
(05729)210 1122 A
(irq_id_t)336 1524 A
(s_int_pending;)588 1902 A
2784(/*)S
(pending)294 2910 A
(hardware)336 3246 A
(interrupts)420 3624 A
4086(*/)S
5355 V
(05730)210 1122 A
(sigset_t)336 1524 A
(s_sig_pending;)588 1902 A
2784(/*)S
(pending)294 2910 A
(signals)294 3246 A
3582(*/)S
5445 V
(05731)210 1122 A
5535 V
(05732)210 1122 A
(timer_t)294 1524 A
(s_alarm_timer;)588 1860 A
2784(/*)S
(synchronous)462 2910 A
(alarm)210 3414 A
(timer)210 3666 A
3918(*/)S
5625 V
(05733)210 1122 A
(struct)252 1524 A
(far_mem)294 1818 A
(s_farmem[NR_REMOTE_SEGS];)1050 2154 A
3288(/*)S
(remote)252 3414 A
(memory)252 3708 A
(map)126 4002 A
4170(*/)S
5715 V
(05734)210 1122 A
(reg_t)210 1524 A
(*s_stack_guard;)630 1776 A
2784(/*)S
(stack)210 2910 A
(guard)210 3162 A
(word)168 3414 A
(for)126 3624 A
(kernel)252 3792 A
(tasks)210 4086 A
4338(*/)S
5805 V
(05735)210 1122 A
1440(};)S
5895 V
(05736)210 1122 A
5985 V
(05737)210 1122 A
1440(/*)S
(Guard)210 1566 A
(word)168 1818 A
(for)126 2028 A
(task)168 2196 A
(stacks.)294 2406 A
2742(*/)S
6075 V
(05738)210 1122 A
(#define)294 1440 A
(STACK_GUARD)462 1776 A
(\(\(reg_t\))336 2448 A
(\(sizeof\(reg_t\))588 2826 A
3456(==)S
3582(2)S
3666(?)S
(0xBEEF)252 3750 A
4044(:)S
(0xDEADBEEF\)\))504 4128 A
6165 V
(05739)210 1122 A
6255 V
(05740)210 1122 A
1440(/*)S
(Bits)168 1566 A
(for)126 1776 A
(the)126 1944 A
(system)252 2112 A
(property)336 2406 A
(flags.)252 2784 A
3078(*/)S
6345 V
(05741)210 1122 A
(#define)294 1440 A
(PREEMPTIBLE)462 1776 A
(0x01)168 2448 A
2784(/*)S
(kernel)252 2910 A
(tasks)210 3204 A
(are)126 3456 A
(not)126 3624 A
(preemptible)462 3792 A
4296(*/)S
6435 V
(05742)210 1122 A
(#define)294 1440 A
(BILLABLE)336 1776 A
(0x04)168 2448 A
2784(/*)S
(some)168 2910 A
(processes)378 3120 A
(are)126 3540 A
(not)126 3708 A
(billable)336 3876 A
4254(*/)S
6525 V
(05743)210 1122 A
(#define)294 1440 A
(SYS_PROC)336 1776 A
(0x10)168 2448 A
2784(/*)S
(system)252 2910 A
(processes)378 3204 A
(are)126 3624 A
(privileged)420 3792 A
4254(*/)S
6615 V
(05744)210 1122 A
(#define)294 1440 A
(SENDREC_BUSY)504 1776 A
(0x20)168 2448 A
2784(/*)S
(sendrec\(\))378 2910 A
3330(in)S
(progress)336 3456 A
3834(*/)S
6705 V
(05745)210 1122 A
6795 V
(05746)210 1122 A
1440(/*)S
(Magic)210 1566 A
(system)252 1818 A
(structure)378 2112 A
(table)210 2532 A
(addresses.)420 2784 A
3246(*/)S
6885 V
(05747)210 1122 A
(#define)294 1440 A
(BEG_PRIV_ADDR)546 1776 A
(\(&priv[0]\))420 2364 A
6975 V
(05748)210 1122 A
(#define)294 1440 A
(END_PRIV_ADDR)546 1776 A
(\(&priv[NR_SYS_PROCS]\))882 2364 A
7065 V
(05749)210 1122 A
8418 V
EP
%%Page: 64 64
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(64)S
11 R
2478(File:)S
2711(kernel/priv.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(05750)210 1122 A
(#define)294 1440 A
(priv_addr\(i\))504 1776 A
(\(ppriv_addr\)[\(i\)])714 2532 A
1845 V
(05751)210 1122 A
(#define)294 1440 A
(priv_id\(rp\))462 1776 A
(\(\(rp\)->p_priv->s_id\))840 2532 A
1935 V
(05752)210 1122 A
(#define)294 1440 A
(priv\(rp\))336 1776 A
(\(\(rp\)->p_priv\))588 2532 A
2025 V
(05753)210 1122 A
2115 V
(05754)210 1122 A
(#define)294 1440 A
(id_to_nr\(id\))504 1776 A
(priv_addr\(id\)->s_proc_nr)1008 2448 A
2205 V
(05755)210 1122 A
(#define)294 1440 A
(nr_to_id\(nr\))504 1776 A
(priv\(proc_addr\(nr\)\)->s_id)1050 2448 A
2295 V
(05756)210 1122 A
2385 V
(05757)210 1122 A
1440(/*)S
(The)126 1566 A
(system)252 1734 A
(structures)420 2028 A
(table)210 2490 A
(and)126 2742 A
(pointers)336 2910 A
3288(to)S
(individual)420 3414 A
(table)210 3876 A
(slots.)252 4128 A
(The)126 4422 A
2475 V
(05758)210 1122 A
1482(*)S
(pointers)336 1566 A
(allow)210 1944 A
(faster)252 2196 A
(access)252 2490 A
(because)294 2784 A
(now)126 3120 A
3288(a)S
(process)294 3372 A
(entry)210 3708 A
(can)126 3960 A
4128(be)S
(found)210 4254 A
4506(by)S
2565 V
(05759)210 1122 A
1482(*)S
(indexing)336 1566 A
(the)126 1944 A
(psys_addr)378 2112 A
(array,)252 2532 A
(while)210 2826 A
(accessing)378 3078 A
3498(an)S
(element)294 3624 A
3960(i)S
(requires)336 4044 A
4422(a)S
2655 V
(05760)210 1122 A
1482(*)S
(multiplication)588 1566 A
(with)168 2196 A
(sizeof\(struct)546 2406 A
(sys\))168 2994 A
3204(to)S
(determine)378 3330 A
(the)126 3750 A
(address.)336 3918 A
2745 V
(05761)210 1122 A
1482(*/)S
2835 V
(05762)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(priv)168 2028 A
(priv[NR_SYS_PROCS];)798 2238 A
3456(/*)S
(system)252 3582 A
(properties)420 3876 A
(table)210 4338 A
4590(*/)S
2925 V
(05763)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(priv)168 2028 A
(*ppriv_addr[NR_SYS_PROCS];)1092 2238 A
3456(/*)S
(direct)252 3582 A
(slot)168 3876 A
(pointers)336 4086 A
4464(*/)S
3015 V
(05764)210 1122 A
3105 V
(05765)210 1122 A
1440(/*)S
(Unprivileged)504 1566 A
(user)168 2112 A
(processes)378 2322 A
(all)126 2742 A
(share)210 2910 A
(the)126 3162 A
(same)168 3330 A
(privilege)378 3540 A
(structure.)420 3960 A
3195 V
(05766)210 1122 A
1482(*)S
(This)168 1566 A
1776(id)S
(must)168 1902 A
2112(be)S
(fixed)210 2238 A
(because)294 2490 A
2826(it)S
2952(is)S
(used)168 3078 A
3288(to)S
(check)210 3414 A
(send)168 3666 A
(mask)168 3876 A
(entries.)336 4086 A
3285 V
(05767)210 1122 A
1482(*/)S
3375 V
(05768)210 1122 A
(#define)294 1440 A
(USER_PRIV_ID)504 1776 A
2448(0)S
3465 V
(05769)210 1122 A
3555 V
(05770)210 1122 A
1440(/*)S
(Make)168 1566 A
(sure)168 1776 A
(the)126 1986 A
(system)252 2154 A
(can)126 2448 A
(boot.)210 2616 A
(The)126 2868 A
(following)378 3036 A
(sanity)252 3456 A
(check)210 3750 A
(verifies)336 4002 A
(that)168 4380 A
3645 V
(05771)210 1122 A
1482(*)S
(the)126 1566 A
(system)252 1734 A
(privileges)420 2028 A
(table)210 2490 A
2742(is)S
(large)210 2868 A
(enough)252 3120 A
(for)126 3414 A
(the)126 3582 A
(number)252 3750 A
4044(of)S
(processes)378 4170 A
3735 V
(05772)210 1122 A
1482(*)S
1566(in)S
(the)126 1692 A
(boot)168 1860 A
(image.)252 2070 A
3825 V
(05773)210 1122 A
1482(*/)S
3915 V
(05774)210 1122 A
(#if)126 1440 A
(\(NR_BOOT_PROCS)588 1608 A
2238(>)S
(NR_SYS_PROCS\))546 2322 A
4005 V
(05775)210 1122 A
(#error)252 1440 A
(NR_SYS_PROCS)504 1734 A
(must)168 2280 A
2490(be)S
(larger)252 2616 A
(than)168 2910 A
(NR_BOOT_PROCS)546 3120 A
4095 V
(05776)210 1122 A
(#endif)252 1440 A
4185 V
(05777)210 1122 A
4275 V
(05778)210 1122 A
(#endif)252 1440 A
1734(/*)S
(PRIV_H)252 1860 A
2154(*/)S
4545 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4635 V
(kernel/protect.h)672 2676 A
4725 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4905 V
(05800)210 1122 A
1440(/*)S
(Constants)378 1566 A
(for)126 1986 A
(protected)378 2154 A
(mode.)210 2574 A
2826(*/)S
4995 V
(05801)210 1122 A
5085 V
(05802)210 1122 A
1440(/*)S
(Table)210 1566 A
(sizes.)252 1818 A
2112(*/)S
5175 V
(05803)210 1122 A
(#define)294 1440 A
(GDT_SIZE)336 1776 A
(\(FIRST_LDT_INDEX)672 2154 A
2868(+)S
(NR_TASKS)336 2952 A
3330(+)S
(NR_PROCS\))378 3414 A
5265 V
(05804)210 1122 A
3120(/*)S
(spec.)210 3246 A
(and)126 3498 A
(LDT's)210 3666 A
3918(*/)S
5355 V
(05805)210 1122 A
(#define)294 1440 A
(IDT_SIZE)336 1776 A
(\(IRQ8_VECTOR)504 2154 A
2700(+)S
2784(8\))S
3120(/*)S
(only)168 3246 A
3456(up)S
3582(to)S
(the)126 3708 A
(highest)294 3876 A
(vector)252 4212 A
4506(*/)S
5445 V
(05806)210 1122 A
(#define)294 1440 A
(LDT_SIZE)336 1776 A
2154(\(2)S
2280(+)S
(NR_REMOTE_SEGS\))630 2364 A
3120(/*)S
(CS,)126 3246 A
3414(DS)S
(and)126 3540 A
(remote)252 3708 A
(segments)336 4002 A
4380(*/)S
5535 V
(05807)210 1122 A
5625 V
(05808)210 1122 A
1440(/*)S
(Fixed)210 1566 A
(global)252 1818 A
(descriptors.)504 2112 A
2700(1)S
2784(to)S
2910(7)S
(are)126 2994 A
(prescribed)420 3162 A
3624(by)S
(the)126 3750 A
(BIOS.)210 3918 A
4170(*/)S
5715 V
(05809)210 1122 A
(#define)294 1440 A
(GDT_INDEX)378 1776 A
2658(1)S
2784(/*)S
(GDT)126 2910 A
(descriptor)420 3078 A
3540(*/)S
5805 V
(05810)210 1122 A
(#define)294 1440 A
(IDT_INDEX)378 1776 A
2658(2)S
2784(/*)S
(IDT)126 2910 A
(descriptor)420 3078 A
3540(*/)S
5895 V
(05811)210 1122 A
(#define)294 1440 A
(DS_INDEX)336 1776 A
2658(3)S
2784(/*)S
(kernel)252 2910 A
3204(DS)S
3330(*/)S
5985 V
(05812)210 1122 A
(#define)294 1440 A
(ES_INDEX)336 1776 A
2658(4)S
2784(/*)S
(kernel)252 2910 A
3204(ES)S
(\(386:)210 3330 A
(flag)168 3582 A
3792(4)S
3876(Gb)S
4002(at)S
(startup\))336 4128 A
4506(*/)S
6075 V
(05813)210 1122 A
(#define)294 1440 A
(SS_INDEX)336 1776 A
2658(5)S
2784(/*)S
(kernel)252 2910 A
3204(SS)S
(\(386:)210 3330 A
(monitor)294 3582 A
3918(SS)S
4044(at)S
(startup\))336 4170 A
4548(*/)S
6165 V
(05814)210 1122 A
(#define)294 1440 A
(CS_INDEX)336 1776 A
2658(6)S
2784(/*)S
(kernel)252 2910 A
3204(CS)S
3330(*/)S
6255 V
(05815)210 1122 A
(#define)294 1440 A
(MON_CS_INDEX)504 1776 A
2658(7)S
2784(/*)S
(temp)168 2910 A
(for)126 3120 A
(BIOS)168 3288 A
(\(386:)210 3498 A
(monitor)294 3750 A
4086(CS)S
4212(at)S
(startup\))336 4338 A
4716(*/)S
6345 V
(05816)210 1122 A
(#define)294 1440 A
(TSS_INDEX)378 1776 A
2658(8)S
2784(/*)S
(kernel)252 2910 A
(TSS)126 3204 A
3372(*/)S
6435 V
(05817)210 1122 A
(#define)294 1440 A
(DS_286_INDEX)504 1776 A
2658(9)S
2784(/*)S
(scratch)294 2910 A
(16-bit)252 3246 A
(source)252 3540 A
(segment)294 3834 A
4170(*/)S
6525 V
(05818)210 1122 A
(#define)294 1440 A
(ES_286_INDEX)504 1776 A
2616(10)S
2784(/*)S
(scratch)294 2910 A
(16-bit)252 3246 A
(destination)462 3540 A
(segment)294 4044 A
4380(*/)S
6615 V
(05819)210 1122 A
(#define)294 1440 A
(A_INDEX)294 1776 A
2616(11)S
2784(/*)S
(64K)126 2910 A
(memory)252 3078 A
(segment)294 3372 A
3708(at)S
(A0000)210 3834 A
4086(*/)S
6705 V
(05820)210 1122 A
(#define)294 1440 A
(B_INDEX)294 1776 A
2616(12)S
2784(/*)S
(64K)126 2910 A
(memory)252 3078 A
(segment)294 3372 A
3708(at)S
(B0000)210 3834 A
4086(*/)S
6795 V
(05821)210 1122 A
(#define)294 1440 A
(C_INDEX)294 1776 A
2616(13)S
2784(/*)S
(64K)126 2910 A
(memory)252 3078 A
(segment)294 3372 A
3708(at)S
(C0000)210 3834 A
4086(*/)S
6885 V
(05822)210 1122 A
(#define)294 1440 A
(D_INDEX)294 1776 A
2616(14)S
2784(/*)S
(64K)126 2910 A
(memory)252 3078 A
(segment)294 3372 A
3708(at)S
(D0000)210 3834 A
4086(*/)S
6975 V
(05823)210 1122 A
(#define)294 1440 A
(FIRST_LDT_INDEX)630 1776 A
2616(15)S
2784(/*)S
(rest)168 2910 A
3120(of)S
(descriptors)462 3246 A
(are)126 3750 A
(LDT's)210 3918 A
4170(*/)S
7065 V
(05824)210 1122 A
8418 V
EP
%%Page: 65 65
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2413(File:)S
2646(kernel/protect.h)S
12 B
4560(65)S
1755 V
7 LST
(05825)210 1122 A
(#define)294 1440 A
(GDT_SELECTOR)504 1776 A
(0x08)168 2532 A
2784(/*)S
(\(GDT_INDEX)420 2910 A
3372(*)S
(DESC_SIZE\))420 3456 A
(bad)126 3918 A
(for)126 4086 A
(asld)168 4254 A
4464(*/)S
1845 V
(05826)210 1122 A
(#define)294 1440 A
(IDT_SELECTOR)504 1776 A
(0x10)168 2532 A
2784(/*)S
(\(IDT_INDEX)420 2910 A
3372(*)S
(DESC_SIZE\))420 3456 A
3918(*/)S
1935 V
(05827)210 1122 A
(#define)294 1440 A
(DS_SELECTOR)462 1776 A
(0x18)168 2532 A
2784(/*)S
(\(DS_INDEX)378 2910 A
3330(*)S
(DESC_SIZE\))420 3414 A
3876(*/)S
2025 V
(05828)210 1122 A
(#define)294 1440 A
(ES_SELECTOR)462 1776 A
(0x20)168 2532 A
2784(/*)S
(\(ES_INDEX)378 2910 A
3330(*)S
(DESC_SIZE\))420 3414 A
3876(*/)S
2115 V
(05829)210 1122 A
(#define)294 1440 A
(FLAT_DS_SELECTOR)672 1776 A
(0x21)168 2532 A
2784(/*)S
(less)168 2910 A
(privileged)420 3120 A
3582(ES)S
3708(*/)S
2205 V
(05830)210 1122 A
(#define)294 1440 A
(SS_SELECTOR)462 1776 A
(0x28)168 2532 A
2784(/*)S
(\(SS_INDEX)378 2910 A
3330(*)S
(DESC_SIZE\))420 3414 A
3876(*/)S
2295 V
(05831)210 1122 A
(#define)294 1440 A
(CS_SELECTOR)462 1776 A
(0x30)168 2532 A
2784(/*)S
(\(CS_INDEX)378 2910 A
3330(*)S
(DESC_SIZE\))420 3414 A
3876(*/)S
2385 V
(05832)210 1122 A
(#define)294 1440 A
(MON_CS_SELECTOR)630 1776 A
(0x38)168 2532 A
2784(/*)S
(\(MON_CS_INDEX)546 2910 A
3498(*)S
(DESC_SIZE\))420 3582 A
4044(*/)S
2475 V
(05833)210 1122 A
(#define)294 1440 A
(TSS_SELECTOR)504 1776 A
(0x40)168 2532 A
2784(/*)S
(\(TSS_INDEX)420 2910 A
3372(*)S
(DESC_SIZE\))420 3456 A
3918(*/)S
2565 V
(05834)210 1122 A
(#define)294 1440 A
(DS_286_SELECTOR)630 1776 A
(0x49)168 2532 A
2784(/*)S
(\(DS_286_INDEX*DESC_SIZE+TASK_PRIVILEGE\))1638 2910 A
4590(*/)S
2655 V
(05835)210 1122 A
(#define)294 1440 A
(ES_286_SELECTOR)630 1776 A
(0x51)168 2532 A
2784(/*)S
(\(ES_286_INDEX*DESC_SIZE+TASK_PRIVILEGE\))1638 2910 A
4590(*/)S
2745 V
(05836)210 1122 A
2835 V
(05837)210 1122 A
1440(/*)S
(Fixed)210 1566 A
(local)210 1818 A
(descriptors.)504 2070 A
2616(*/)S
2925 V
(05838)210 1122 A
(#define)294 1440 A
(CS_LDT_INDEX)504 1776 A
2658(0)S
2784(/*)S
(process)294 2910 A
3246(CS)S
3372(*/)S
3015 V
(05839)210 1122 A
(#define)294 1440 A
(DS_LDT_INDEX)504 1776 A
2658(1)S
2784(/*)S
(process)294 2910 A
(DS=ES=FS=GS=SS)588 3246 A
3876(*/)S
3105 V
(05840)210 1122 A
(#define)294 1440 A
(EXTRA_LDT_INDEX)630 1776 A
2658(2)S
2784(/*)S
(first)210 2910 A
3162(of)S
(the)126 3288 A
(extra)210 3456 A
(LDT)126 3708 A
(entries)294 3876 A
4212(*/)S
3195 V
(05841)210 1122 A
3285 V
(05842)210 1122 A
1440(/*)S
(Privileges.)462 1566 A
2070(*/)S
3375 V
(05843)210 1122 A
(#define)294 1440 A
(INTR_PRIVILEGE)588 1776 A
2658(0)S
2784(/*)S
(kernel)252 2910 A
(and)126 3204 A
(interrupt)378 3372 A
(handlers)336 3792 A
4170(*/)S
3465 V
(05844)210 1122 A
(#define)294 1440 A
(TASK_PRIVILEGE)588 1776 A
2658(1)S
2784(/*)S
(kernel)252 2910 A
(tasks)210 3204 A
3456(*/)S
3555 V
(05845)210 1122 A
(#define)294 1440 A
(USER_PRIVILEGE)588 1776 A
2658(3)S
2784(/*)S
(servers)294 2910 A
(and)126 3246 A
(user)168 3414 A
(processes)378 3624 A
4044(*/)S
3645 V
(05846)210 1122 A
3735 V
(05847)210 1122 A
1440(/*)S
(286)126 1566 A
(hardware)336 1734 A
(constants.)420 2112 A
2574(*/)S
3825 V
(05848)210 1122 A
3915 V
(05849)210 1122 A
1440(/*)S
(Exception)378 1566 A
(vector)252 1986 A
(numbers.)336 2280 A
2658(*/)S
4005 V
(05850)210 1122 A
(#define)294 1440 A
(BOUNDS_VECTOR)546 1776 A
2658(5)S
2784(/*)S
(bounds)252 2910 A
(check)210 3204 A
(failed)252 3456 A
3750(*/)S
4095 V
(05851)210 1122 A
(#define)294 1440 A
(INVAL_OP_VECTOR)630 1776 A
2658(6)S
2784(/*)S
(invalid)294 2910 A
(opcode)252 3246 A
3540(*/)S
4185 V
(05852)210 1122 A
(#define)294 1440 A
(COPROC_NOT_VECTOR)714 1776 A
2658(7)S
2784(/*)S
(coprocessor)462 2910 A
(not)126 3414 A
(available)378 3582 A
4002(*/)S
4275 V
(05853)210 1122 A
(#define)294 1440 A
(DOUBLE_FAULT_VECTOR)798 1776 A
2658(8)S
4365 V
(05854)210 1122 A
(#define)294 1440 A
(COPROC_SEG_VECTOR)714 1776 A
2658(9)S
2784(/*)S
(coprocessor)462 2910 A
(segment)294 3414 A
(overrun)294 3750 A
4086(*/)S
4455 V
(05855)210 1122 A
(#define)294 1440 A
(INVAL_TSS_VECTOR)672 1776 A
2616(10)S
2784(/*)S
(invalid)294 2910 A
(TSS)126 3246 A
3414(*/)S
4545 V
(05856)210 1122 A
(#define)294 1440 A
(SEG_NOT_VECTOR)588 1776 A
2616(11)S
2784(/*)S
(segment)294 2910 A
(not)126 3246 A
(present)294 3414 A
3750(*/)S
4635 V
(05857)210 1122 A
(#define)294 1440 A
(STACK_FAULT_VECTOR)756 1776 A
2616(12)S
2784(/*)S
(stack)210 2910 A
(exception)378 3162 A
3582(*/)S
4725 V
(05858)210 1122 A
(#define)294 1440 A
(PROTECTION_VECTOR)714 1776 A
2616(13)S
2784(/*)S
(general)294 2910 A
(protection)420 3246 A
3708(*/)S
4815 V
(05859)210 1122 A
4905 V
(05860)210 1122 A
1440(/*)S
(Selector)336 1566 A
(bits.)210 1944 A
2196(*/)S
4995 V
(05861)210 1122 A
(#define)294 1440 A
1776(TI)S
(0x04)168 2532 A
2784(/*)S
(table)210 2910 A
(indicator)378 3162 A
3582(*/)S
5085 V
(05862)210 1122 A
(#define)294 1440 A
(RPL)126 1776 A
(0x03)168 2532 A
2784(/*)S
(requester)378 2910 A
(privilege)378 3330 A
(level)210 3750 A
4002(*/)S
5175 V
(05863)210 1122 A
5265 V
(05864)210 1122 A
1440(/*)S
(Descriptor)420 1566 A
(structure)378 2028 A
(offsets.)336 2448 A
2826(*/)S
5355 V
(05865)210 1122 A
(#define)294 1440 A
(DESC_BASE)378 1776 A
2658(2)S
2784(/*)S
2910(to)S
(base_low)336 3036 A
3414(*/)S
5445 V
(05866)210 1122 A
(#define)294 1440 A
(DESC_BASE_MIDDLE)672 1776 A
2658(4)S
2784(/*)S
2910(to)S
(base_middle)462 3036 A
3540(*/)S
5535 V
(05867)210 1122 A
(#define)294 1440 A
(DESC_ACCESS)462 1776 A
2658(5)S
2784(/*)S
2910(to)S
(access)252 3036 A
(byte)168 3330 A
3540(*/)S
5625 V
(05868)210 1122 A
(#define)294 1440 A
(DESC_SIZE)378 1776 A
2658(8)S
2784(/*)S
(sizeof)252 2910 A
(\(struct)294 3204 A
(segdesc_s\))420 3540 A
4002(*/)S
5715 V
(05869)210 1122 A
5805 V
(05870)210 1122 A
1440(/*)S
(Base)168 1566 A
(and)126 1776 A
(limit)210 1944 A
(sizes)210 2196 A
(and)126 2448 A
(shifts.)294 2616 A
2952(*/)S
5895 V
(05871)210 1122 A
(#define)294 1440 A
(BASE_MIDDLE_SHIFT)714 1776 A
2616(16)S
2784(/*)S
(shift)210 2910 A
(for)126 3162 A
(base)168 3330 A
(-->)126 3540 A
(base_middle)462 3708 A
4212(*/)S
5985 V
(05872)210 1122 A
6075 V
(05873)210 1122 A
1440(/*)S
(Access-byte)462 1566 A
(and)126 2070 A
(type-byte)378 2238 A
(bits.)210 2658 A
2910(*/)S
6165 V
(05874)210 1122 A
(#define)294 1440 A
(PRESENT)294 1776 A
(0x80)168 2532 A
2784(/*)S
(set)126 2910 A
(for)126 3078 A
(descriptor)420 3246 A
(present)294 3708 A
4044(*/)S
6255 V
(05875)210 1122 A
(#define)294 1440 A
(DPL)126 1776 A
(0x60)168 2532 A
2784(/*)S
(descriptor)420 2910 A
(privilege)378 3372 A
(level)210 3792 A
(mask)168 4044 A
4254(*/)S
6345 V
(05876)210 1122 A
(#define)294 1440 A
(DPL_SHIFT)378 1776 A
2658(5)S
6435 V
(05877)210 1122 A
(#define)294 1440 A
(SEGMENT)294 1776 A
(0x10)168 2532 A
2784(/*)S
(set)126 2910 A
(for)126 3078 A
(segment-type)504 3246 A
(descriptors)462 3792 A
4296(*/)S
6525 V
(05878)210 1122 A
6615 V
(05879)210 1122 A
1440(/*)S
(Access-byte)462 1566 A
(bits.)210 2070 A
2322(*/)S
6705 V
(05880)210 1122 A
(#define)294 1440 A
(EXECUTABLE)420 1776 A
(0x08)168 2532 A
2784(/*)S
(set)126 2910 A
(for)126 3078 A
(executable)420 3246 A
(segment)294 3708 A
4044(*/)S
6795 V
(05881)210 1122 A
(#define)294 1440 A
(CONFORMING)420 1776 A
(0x04)168 2532 A
2784(/*)S
(set)126 2910 A
(for)126 3078 A
(conforming)420 3246 A
(segment)294 3708 A
4044(if)S
(executable)420 4170 A
4632(*/)S
6885 V
(05882)210 1122 A
(#define)294 1440 A
(EXPAND_DOWN)462 1776 A
(0x04)168 2532 A
2784(/*)S
(set)126 2910 A
(for)126 3078 A
(expand-down)462 3246 A
(segment)294 3750 A
4086(if)S
(!executable*/)546 4212 A
6975 V
(05883)210 1122 A
(#define)294 1440 A
(READABLE)336 1776 A
(0x02)168 2532 A
2784(/*)S
(set)126 2910 A
(for)126 3078 A
(readable)336 3246 A
(segment)294 3624 A
3960(if)S
(executable)420 4086 A
4548(*/)S
7065 V
(05884)210 1122 A
(#define)294 1440 A
(WRITEABLE)378 1776 A
(0x02)168 2532 A
2784(/*)S
(set)126 2910 A
(for)126 3078 A
(writeable)378 3246 A
(segment)294 3666 A
4002(if)S
(!executable)462 4128 A
4632(*/)S
8418 V
EP
%%Page: 66 66
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(66)S
11 R
2413(File:)S
2646(kernel/protect.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(05885)210 1122 A
(#define)294 1440 A
(TSS_BUSY)336 1776 A
(0x02)168 2532 A
2784(/*)S
(set)126 2910 A
3078(if)S
(TSS)126 3204 A
(descriptor)420 3372 A
3834(is)S
(busy)168 3960 A
4170(*/)S
1845 V
(05886)210 1122 A
(#define)294 1440 A
(ACCESSED)336 1776 A
(0x01)168 2532 A
2784(/*)S
(set)126 2910 A
3078(if)S
(segment)294 3204 A
(accessed)336 3540 A
3918(*/)S
1935 V
(05887)210 1122 A
2025 V
(05888)210 1122 A
1440(/*)S
(Special)294 1566 A
(descriptor)420 1902 A
(types.)252 2364 A
2658(*/)S
2115 V
(05889)210 1122 A
(#define)294 1440 A
(AVL_286_TSS)462 1776 A
2658(1)S
2784(/*)S
(available)378 2910 A
(286)126 3330 A
(TSS)126 3498 A
3666(*/)S
2205 V
(05890)210 1122 A
(#define)294 1440 A
(LDT)126 1776 A
2658(2)S
2784(/*)S
(local)210 2910 A
(descriptor)420 3162 A
(table)210 3624 A
3876(*/)S
2295 V
(05891)210 1122 A
(#define)294 1440 A
(BUSY_286_TSS)504 1776 A
2658(3)S
2784(/*)S
(set)126 2910 A
(transparently)546 3078 A
3666(to)S
(the)126 3792 A
(software)336 3960 A
4338(*/)S
2385 V
(05892)210 1122 A
(#define)294 1440 A
(CALL_286_GATE)546 1776 A
2658(4)S
2784(/*)S
(not)126 2910 A
(used)168 3078 A
3288(*/)S
2475 V
(05893)210 1122 A
(#define)294 1440 A
(TASK_GATE)378 1776 A
2658(5)S
2784(/*)S
(only)168 2910 A
(used)168 3120 A
3330(by)S
(debugger)336 3456 A
3834(*/)S
2565 V
(05894)210 1122 A
(#define)294 1440 A
(INT_286_GATE)504 1776 A
2658(6)S
2784(/*)S
(interrupt)378 2910 A
(gate,)210 3330 A
(used)168 3582 A
(for)126 3792 A
(all)126 3960 A
(vectors)294 4128 A
4464(*/)S
2655 V
(05895)210 1122 A
(#define)294 1440 A
(TRAP_286_GATE)546 1776 A
2658(7)S
2784(/*)S
(not)126 2910 A
(used)168 3078 A
3288(*/)S
2745 V
(05896)210 1122 A
2835 V
(05897)210 1122 A
1440(/*)S
(Extra)210 1566 A
(386)126 1818 A
(hardware)336 1986 A
(constants.)420 2364 A
2826(*/)S
2925 V
(05898)210 1122 A
3015 V
(05899)210 1122 A
1440(/*)S
(Exception)378 1566 A
(vector)252 1986 A
(numbers.)336 2280 A
2658(*/)S
3105 V
(05900)210 1122 A
(#define)294 1440 A
(PAGE_FAULT_VECTOR)714 1776 A
2616(14)S
3195 V
(05901)210 1122 A
(#define)294 1440 A
(COPROC_ERR_VECTOR)714 1776 A
2616(16)S
2784(/*)S
(coprocessor)462 2910 A
(error)210 3414 A
3666(*/)S
3285 V
(05902)210 1122 A
3375 V
(05903)210 1122 A
1440(/*)S
(Descriptor)420 1566 A
(structure)378 2028 A
(offsets.)336 2448 A
2826(*/)S
3465 V
(05904)210 1122 A
(#define)294 1440 A
(DESC_GRANULARITY)672 1776 A
2658(6)S
2784(/*)S
2910(to)S
(granularity)462 3036 A
(byte)168 3540 A
3750(*/)S
3555 V
(05905)210 1122 A
(#define)294 1440 A
(DESC_BASE_HIGH)588 1776 A
2658(7)S
2784(/*)S
2910(to)S
(base_high)378 3036 A
3456(*/)S
3645 V
(05906)210 1122 A
3735 V
(05907)210 1122 A
1440(/*)S
(Base)168 1566 A
(and)126 1776 A
(limit)210 1944 A
(sizes)210 2196 A
(and)126 2448 A
(shifts.)294 2616 A
2952(*/)S
3825 V
(05908)210 1122 A
(#define)294 1440 A
(BASE_HIGH_SHIFT)630 1776 A
2616(24)S
2784(/*)S
(shift)210 2910 A
(for)126 3162 A
(base)168 3330 A
(-->)126 3540 A
(base_high)378 3708 A
4128(*/)S
3915 V
(05909)210 1122 A
(#define)294 1440 A
(BYTE_GRAN_MAX)546 1776 A
(0xFFFFFL)336 2448 A
2910(/*)S
(maximum)294 3036 A
(size)168 3372 A
(for)126 3582 A
(byte)168 3750 A
(granular)336 3960 A
(segment)294 4338 A
4674(*/)S
4005 V
(05910)210 1122 A
(#define)294 1440 A
(GRANULARITY_SHIFT)714 1776 A
2616(16)S
2784(/*)S
(shift)210 2910 A
(for)126 3162 A
(limit)210 3330 A
(-->)126 3582 A
(granularity)462 3750 A
4254(*/)S
4095 V
(05911)210 1122 A
(#define)294 1440 A
(OFFSET_HIGH_SHIFT)714 1776 A
2616(16)S
2784(/*)S
(shift)210 2910 A
(for)126 3162 A
(\(gate\))252 3330 A
(offset)252 3624 A
(-->)126 3918 A
(offset_high)462 4086 A
4590(*/)S
4185 V
(05912)210 1122 A
(#define)294 1440 A
(PAGE_GRAN_SHIFT)630 1776 A
2616(12)S
2784(/*)S
(extra)210 2910 A
(shift)210 3162 A
(for)126 3414 A
(page)168 3582 A
(granular)336 3792 A
(limits)252 4170 A
4464(*/)S
4275 V
(05913)210 1122 A
4365 V
(05914)210 1122 A
1440(/*)S
(Type-byte)378 1566 A
(bits.)210 1986 A
2238(*/)S
4455 V
(05915)210 1122 A
(#define)294 1440 A
(DESC_386_BIT)504 1776 A
(0x08)168 2364 A
2574(/*)S
(386)126 2700 A
(types)210 2868 A
(are)126 3120 A
(obtained)336 3288 A
3666(by)S
(ORing)210 3792 A
(with)168 4044 A
(this)168 4254 A
4464(*/)S
4545 V
(05916)210 1122 A
2784(/*)S
(LDT's)210 2910 A
(and)126 3162 A
(TASK_GATE's)462 3330 A
(don't)210 3834 A
(need)168 4086 A
4296(it)S
4422(*/)S
4635 V
(05917)210 1122 A
4725 V
(05918)210 1122 A
1440(/*)S
(Granularity)462 1566 A
(byte.)210 2070 A
2322(*/)S
4815 V
(05919)210 1122 A
(#define)294 1440 A
(GRANULAR)336 1776 A
(0x80)168 2532 A
2784(/*)S
(set)126 2910 A
(for)126 3078 A
3246(4K)S
(granularilty)504 3372 A
3918(*/)S
4905 V
(05920)210 1122 A
(#define)294 1440 A
(DEFAULT)294 1776 A
(0x40)168 2532 A
2784(/*)S
(set)126 2910 A
(for)126 3078 A
(32-bit)252 3246 A
(defaults)336 3540 A
(\(executable)462 3918 A
(seg\))168 4422 A
4632(*/)S
4995 V
(05921)210 1122 A
(#define)294 1440 A
(BIG)126 1776 A
(0x40)168 2532 A
2784(/*)S
(set)126 2910 A
(for)126 3078 A
("BIG")210 3246 A
(\(expand-down)504 3498 A
(seg\))168 4044 A
4254(*/)S
5085 V
(05922)210 1122 A
(#define)294 1440 A
(AVL)126 1776 A
(0x10)168 2532 A
2784(/*)S
2910(0)S
(for)126 2994 A
(available)378 3162 A
3582(*/)S
5175 V
(05923)210 1122 A
(#define)294 1440 A
(LIMIT_HIGH)420 1776 A
(0x0F)168 2532 A
2784(/*)S
(mask)168 2910 A
(for)126 3120 A
(high)168 3288 A
(bits)168 3498 A
3708(of)S
(limit)210 3834 A
4086(*/)S
5445 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5535 V
(kernel/table.c)588 2676 A
5625 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5805 V
(06000)210 1122 A
1440(/*)S
(The)126 1566 A
(object)252 1734 A
(file)168 2028 A
2238(of)S
("table.c")378 2364 A
(contains)336 2784 A
(most)168 3162 A
(kernel)252 3372 A
(data.)210 3666 A
(Variables)378 3918 A
(that)168 4338 A
5895 V
(06001)210 1122 A
1482(*)S
(are)126 1566 A
(declared)336 1734 A
2112(in)S
(the)126 2238 A
(*.h)126 2406 A
(files)210 2574 A
(appear)252 2826 A
(with)168 3120 A
(EXTERN)252 3330 A
3624(in)S
(front)210 3750 A
4002(of)S
(them,)210 4128 A
4380(as)S
4506(in)S
5985 V
(06002)210 1122 A
1482(*)S
6075 V
(06003)210 1122 A
1482(*)S
(EXTERN)252 1692 A
(int)126 1986 A
2154(x;)S
6165 V
(06004)210 1122 A
1482(*)S
6255 V
(06005)210 1122 A
1482(*)S
(Normally)336 1566 A
(EXTERN)252 1944 A
2238(is)S
(defined)294 2364 A
2700(as)S
(extern,)294 2826 A
3162(so)S
(when)168 3288 A
(they)168 3498 A
(are)126 3708 A
(included)336 3876 A
4254(in)S
(another)294 4380 A
6345 V
(06006)210 1122 A
1482(*)S
(file,)210 1566 A
1818(no)S
(storage)294 1944 A
2280(is)S
(allocated.)420 2406 A
2910(If)S
(EXTERN)252 3036 A
(were)168 3330 A
(not)126 3540 A
(present,)336 3708 A
(but)126 4086 A
(just)168 4254 A
(say,)168 4464 A
6435 V
(06007)210 1122 A
1482(*)S
6525 V
(06008)210 1122 A
1482(*)S
(int)126 1692 A
1860(x;)S
6615 V
(06009)210 1122 A
1482(*)S
6705 V
(06010)210 1122 A
1482(*)S
(then)168 1566 A
(including)378 1776 A
(this)168 2196 A
(file)168 2406 A
2616(in)S
(several)294 2742 A
(source)252 3078 A
(files)210 3372 A
(would)210 3624 A
(cause)210 3876 A
('x')126 4128 A
4296(to)S
4422(be)S
6795 V
(06011)210 1122 A
1482(*)S
(declared)336 1566 A
(several)294 1944 A
(times.)252 2280 A
(While)210 2616 A
(some)168 2868 A
(linkers)294 3078 A
(accept)252 3414 A
(this,)210 3708 A
(others)252 3960 A
4254(do)S
(not,)168 4380 A
6885 V
(06012)210 1122 A
1482(*)S
1566(so)S
(they)168 1692 A
(are)126 1902 A
(declared)336 2070 A
(extern)252 2448 A
(when)168 2742 A
(included)336 2952 A
(normally.)378 3330 A
(However,)336 3792 A
4170(it)S
(must)168 4296 A
4506(be)S
6975 V
(06013)210 1122 A
1482(*)S
(declared)336 1566 A
(for)126 1944 A
(real)168 2112 A
(somewhere.)420 2322 A
(That)168 2826 A
3036(is)S
(done)168 3162 A
(here,)210 3372 A
3624(by)S
(redefining)420 3750 A
(EXTERN)252 4212 A
4506(as)S
7065 V
(06014)210 1122 A
1482(*)S
(the)126 1566 A
(null)168 1734 A
(string,)294 1944 A
2280(so)S
(that)168 2406 A
(inclusion)378 2616 A
3036(of)S
(all)126 3162 A
(*.h)126 3330 A
(files)210 3498 A
3750(in)S
(table.c)294 3876 A
(actually)336 4212 A
8418 V
EP
%%Page: 67 67
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2461(File:)S
(kernel/table.c)604 2694 A
12 B
4560(67)S
1755 V
7 LST
(06015)210 1122 A
1482(*)S
(generates)378 1566 A
(storage)294 1986 A
(for)126 2322 A
(them.)210 2490 A
1845 V
(06016)210 1122 A
1482(*)S
1935 V
(06017)210 1122 A
1482(*)S
(Various)294 1566 A
(variables)378 1902 A
(could)210 2322 A
(not)126 2574 A
2742(be)S
(declared)336 2868 A
(EXTERN,)294 3246 A
(but)126 3582 A
(are)126 3750 A
(declared)336 3918 A
(PUBLIC)252 4296 A
2025 V
(06018)210 1122 A
1482(*)S
1566(or)S
(PRIVATE.)336 1692 A
(The)126 2070 A
(reason)252 2238 A
(for)126 2532 A
(this)168 2700 A
2910(is)S
(that)168 3036 A
(extern)252 3246 A
(variables)378 3540 A
(cannot)252 3960 A
(have)168 4254 A
4464(a)S
2115 V
(06019)210 1122 A
1482(*)S
(default)294 1566 A
(initialization.)630 1902 A
2574(If)S
(such)168 2700 A
(variables)378 2910 A
(are)126 3330 A
(shared,)294 3498 A
(they)168 3834 A
(must)168 4044 A
(also)168 4254 A
4464(be)S
2205 V
(06020)210 1122 A
1482(*)S
(declared)336 1566 A
1944(in)S
(one)126 2070 A
2238(of)S
(the)126 2364 A
(*.h)126 2532 A
(files)210 2700 A
(without)294 2952 A
(the)126 3288 A
(initialization.)630 3456 A
(Examples)336 4170 A
2295 V
(06021)210 1122 A
1482(*)S
(include)294 1566 A
('boot_image')504 1902 A
(\(this)210 2448 A
(file\))210 2700 A
(and)126 2952 A
('idt')210 3120 A
(and)126 3372 A
('gdt')210 3540 A
(\(protect.c\).)504 3792 A
2385 V
(06022)210 1122 A
1482(*)S
2475 V
(06023)210 1122 A
1482(*)S
(Changes:)336 1566 A
2565 V
(06024)210 1122 A
1482(*)S
(Aug)126 1692 A
(02,)126 1860 A
(2005)168 2028 A
(set)126 2322 A
(privileges)420 2490 A
(and)126 2952 A
(minimal)294 3120 A
(boot)168 3456 A
(image)210 3666 A
(\(Jorrit)294 3918 A
4254(N.)S
(Herder\))294 4380 A
2655 V
(06025)210 1122 A
1482(*)S
(Oct)126 1692 A
(17,)126 1860 A
(2004)168 2028 A
(updated)294 2322 A
(above)210 2658 A
(and)126 2910 A
(tasktab)294 3078 A
(comments)336 3414 A
(\(Jorrit)294 3834 A
4170(N.)S
(Herder\))294 4296 A
2745 V
(06026)210 1122 A
1482(*)S
(May)126 1692 A
(01,)126 1860 A
(2004)168 2028 A
(changed)294 2322 A
(struct)252 2658 A
(for)126 2952 A
(system)252 3120 A
(image)210 3414 A
(\(Jorrit)294 3708 A
4044(N.)S
(Herder\))294 4170 A
2835 V
(06027)210 1122 A
1482(*/)S
2925 V
(06028)210 1122 A
(#define)294 1440 A
(_TABLE)252 1776 A
3015 V
(06029)210 1122 A
3105 V
(06030)210 1122 A
(#include)336 1440 A
("kernel.h")420 1818 A
3195 V
(06031)210 1122 A
(#include)336 1440 A
("proc.h")336 1818 A
3285 V
(06032)210 1122 A
(#include)336 1440 A
("ipc.h")294 1818 A
3375 V
(06033)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
3465 V
(06034)210 1122 A
(#include)336 1440 A
(<ibm/int86.h>)546 1818 A
3555 V
(06035)210 1122 A
3645 V
(06036)210 1122 A
1440(/*)S
(Define)252 1566 A
(stack)210 1860 A
(sizes)210 2112 A
(for)126 2364 A
(the)126 2532 A
(kernel)252 2700 A
(tasks)210 2994 A
(included)336 3246 A
3624(in)S
(the)126 3750 A
(system)252 3918 A
(image.)252 4212 A
4506(*/)S
3735 V
(06037)210 1122 A
(#define)294 1440 A
(NO_STACK)336 1776 A
2448(0)S
3825 V
(06038)210 1122 A
(#define)294 1440 A
(SMALL_STACK)462 1776 A
(\(128)168 2448 A
2658(*)S
(sizeof\(char)462 2742 A
(*\)\))126 3246 A
3915 V
(06039)210 1122 A
(#define)294 1440 A
(IDL_S)210 1776 A
(SMALL_STACK)462 2112 A
2784(/*)S
2910(3)S
(intr,)210 2994 A
3246(3)S
(temps,)252 3330 A
3624(4)S
3708(db)S
(for)126 3834 A
(Intel)210 4002 A
4254(*/)S
4005 V
(06040)210 1122 A
(#define)294 1440 A
(HRD_S)210 1776 A
(NO_STACK)336 2112 A
2784(/*)S
(dummy)210 2910 A
(task,)210 3162 A
(uses)168 3414 A
(kernel)252 3624 A
(stack)210 3918 A
4170(*/)S
4095 V
(06041)210 1122 A
(#define)294 1440 A
(TSK_S)210 1776 A
(SMALL_STACK)462 2112 A
2784(/*)S
(system)252 2910 A
(and)126 3204 A
(clock)210 3372 A
(task)168 3624 A
3834(*/)S
4185 V
(06042)210 1122 A
4275 V
(06043)210 1122 A
1440(/*)S
(Stack)210 1566 A
(space)210 1818 A
(for)126 2070 A
(all)126 2238 A
(the)126 2406 A
(task)168 2574 A
(stacks.)294 2784 A
(Declared)336 3162 A
3540(as)S
(\(char)210 3666 A
3918(*\))S
4044(to)S
(align)210 4170 A
(it.)126 4422 A
4590(*/)S
4365 V
(06044)210 1122 A
(#define)294 1440 A
(TOT_STACK_SPACE)630 1776 A
(\(IDL_S)252 2448 A
2742(+)S
(HRD_S)210 2826 A
3078(+)S
3162(\(2)S
3288(*)S
(TSK_S\)\))294 3372 A
4455 V
(06045)210 1122 A
(PUBLIC)252 1440 A
(char)168 1734 A
(*t_stack[TOT_STACK_SPACE)1008 1944 A
2994(/)S
(sizeof\(char)462 3078 A
(*\)];)168 3582 A
4545 V
(06046)210 1122 A
4635 V
(06047)210 1122 A
1440(/*)S
(Define)252 1566 A
(flags)210 1860 A
(for)126 2112 A
(the)126 2280 A
(various)294 2448 A
(process)294 2784 A
(types.)252 3120 A
3414(*/)S
4725 V
(06048)210 1122 A
(#define)294 1440 A
(IDL_F)210 1776 A
(\(SYS_PROC)378 2112 A
2532(|)S
(PREEMPTIBLE)462 2616 A
3120(|)S
(BILLABLE\))378 3204 A
3792(/*)S
(idle)168 3918 A
(task)168 4128 A
4338(*/)S
4815 V
(06049)210 1122 A
(#define)294 1440 A
(TSK_F)210 1776 A
(\(SYS_PROC\))420 2112 A
3792(/*)S
(kernel)252 3918 A
(tasks)210 4212 A
4464(*/)S
4905 V
(06050)210 1122 A
(#define)294 1440 A
(SRV_F)210 1776 A
(\(SYS_PROC)378 2112 A
2532(|)S
(PREEMPTIBLE\))504 2616 A
3792(/*)S
(system)252 3918 A
(services)336 4212 A
4590(*/)S
4995 V
(06051)210 1122 A
(#define)294 1440 A
(USR_F)210 1776 A
(\(BILLABLE)378 2112 A
2532(|)S
(PREEMPTIBLE\))504 2616 A
3792(/*)S
(user)168 3918 A
(processes)378 4128 A
4548(*/)S
5085 V
(06052)210 1122 A
5175 V
(06053)210 1122 A
1440(/*)S
(Define)252 1566 A
(system)252 1860 A
(call)168 2154 A
(traps)210 2364 A
(for)126 2616 A
(the)126 2784 A
(various)294 2952 A
(process)294 3288 A
(types.)252 3624 A
(These)210 3918 A
(call)168 4170 A
(masks)210 4380 A
5265 V
(06054)210 1122 A
1482(*)S
(determine)378 1566 A
(what)168 1986 A
(system)252 2196 A
(call)168 2490 A
(traps)210 2700 A
2952(a)S
(process)294 3036 A
3372(is)S
(allowed)294 3498 A
3834(to)S
(make.)210 3960 A
5355 V
(06055)210 1122 A
1482(*/)S
5445 V
(06056)210 1122 A
(#define)294 1440 A
(TSK_T)210 1776 A
2112(\(1)S
2238(<<)S
(RECEIVE\))336 2364 A
3456(/*)S
(clock)210 3582 A
(and)126 3834 A
(system)252 4002 A
4296(*/)S
5535 V
(06057)210 1122 A
(#define)294 1440 A
(SRV_T)210 1776 A
(\(\3040\))168 2112 A
3456(/*)S
(system)252 3582 A
(services)336 3876 A
4254(*/)S
5625 V
(06058)210 1122 A
(#define)294 1440 A
(USR_T)210 1776 A
(\(\(1)126 2112 A
2280(<<)S
(SENDREC\))336 2406 A
2784(|)S
2868(\(1)S
2994(<<)S
(ECHO\)\))252 3120 A
3456(/*)S
(user)168 3582 A
(processes)378 3792 A
4212(*/)S
5715 V
(06059)210 1122 A
5805 V
(06060)210 1122 A
1440(/*)S
(Send)168 1566 A
(masks)210 1776 A
(determine)378 2028 A
2448(to)S
(whom)168 2574 A
(processes)378 2784 A
(can)126 3204 A
(send)168 3372 A
(messages)336 3582 A
3960(or)S
(notifications.)588 4086 A
5895 V
(06061)210 1122 A
1482(*)S
(The)126 1566 A
(values)252 1734 A
(here)168 2028 A
(are)126 2238 A
(used)168 2406 A
(for)126 2616 A
(the)126 2784 A
(processes)378 2952 A
3372(in)S
(the)126 3498 A
(boot)168 3666 A
(image.)252 3876 A
4170(We)S
(rely)168 4296 A
4506(on)S
5985 V
(06062)210 1122 A
1482(*)S
(the)126 1566 A
(initialization)588 1734 A
(code)168 2364 A
2574(in)S
(main\(\))252 2700 A
2994(to)S
(match)210 3120 A
(the)126 3372 A
(s_nr_to_id\(\))504 3540 A
(mapping)294 4086 A
(for)126 4422 A
(the)126 4590 A
6075 V
(06063)210 1122 A
1482(*)S
(processes)378 1566 A
1986(in)S
(the)126 2112 A
(boot)168 2280 A
(image,)252 2490 A
2784(so)S
(that)168 2910 A
(the)126 3120 A
(send)168 3288 A
(mask)168 3498 A
(that)168 3708 A
3918(is)S
(defined)294 4044 A
(here)168 4380 A
6165 V
(06064)210 1122 A
1482(*)S
(can)126 1566 A
1734(be)S
(directly)336 1860 A
(copied)252 2238 A
(onto)168 2532 A
(map[0])252 2742 A
3036(of)S
(the)126 3162 A
(actual)252 3330 A
(send)168 3624 A
(mask.)210 3834 A
(Privilege)378 4086 A
6255 V
(06065)210 1122 A
1482(*)S
(structure)378 1566 A
1986(0)S
2070(is)S
(shared)252 2196 A
2490(by)S
(user)168 2616 A
(processes.)420 2826 A
6345 V
(06066)210 1122 A
1482(*/)S
6435 V
(06067)210 1122 A
(#define)294 1440 A
(s\(n\))168 1776 A
2448(\(1)S
2574(<<)S
(s_nr_to_id\(n\)\))588 2700 A
6525 V
(06068)210 1122 A
(#define)294 1440 A
(SRV_M)210 1776 A
(\(\3040\))168 2028 A
6615 V
(06069)210 1122 A
(#define)294 1440 A
(SYS_M)210 1776 A
(\(\3040\))168 2028 A
6705 V
(06070)210 1122 A
(#define)294 1440 A
(USR_M)210 1776 A
(\(s\(PM_PROC_NR\))588 2028 A
2658(|)S
(s\(FS_PROC_NR\))546 2742 A
3330(|)S
(s\(RS_PROC_NR\)\))588 3414 A
6795 V
(06071)210 1122 A
(#define)294 1440 A
(DRV_M)210 1776 A
(\(USR_M)252 2028 A
2322(|)S
(s\(SYSTEM\))378 2406 A
2826(|)S
(s\(CLOCK\))336 2910 A
3288(|)S
(s\(LOG_PROC_NR\))588 3372 A
4002(|)S
(s\(TTY_PROC_NR\)\))630 4086 A
6885 V
(06072)210 1122 A
6975 V
(06073)210 1122 A
1440(/*)S
(Define)252 1566 A
(kernel)252 1860 A
(calls)210 2154 A
(that)168 2406 A
(processes)378 2616 A
(are)126 3036 A
(allowed)294 3204 A
3540(to)S
(make.)210 3666 A
(This)168 3918 A
4128(is)S
(not)126 4254 A
(looking)294 4422 A
7065 V
(06074)210 1122 A
1482(*)S
(very)168 1566 A
(nice,)210 1776 A
(but)126 2028 A
2196(we)S
(need)168 2322 A
2532(to)S
(define)252 2658 A
(the)126 2952 A
(access)252 3120 A
(rights)252 3414 A
3708(on)S
3834(a)S
(per)126 3918 A
(call)168 4086 A
(basis.)252 4296 A
8418 V
EP
%%Page: 68 68
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(68)S
11 R
2461(File:)S
(kernel/table.c)604 2694 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(06075)210 1122 A
1482(*)S
(Note)168 1566 A
(that)168 1776 A
(the)126 1986 A
(reincarnation)546 2154 A
(server)252 2742 A
(has)126 3036 A
(all)126 3204 A
(bits)168 3372 A
(on,)126 3582 A
(because)294 3750 A
4086(it)S
(should)252 4212 A
1845 V
(06076)210 1122 A
1482(*)S
1566(be)S
(allowed)294 1692 A
2028(to)S
(distribute)420 2154 A
(rights)252 2616 A
2910(to)S
(services)336 3036 A
(that)168 3414 A
3624(it)S
(starts.)294 3750 A
1935 V
(06077)210 1122 A
1482(*/)S
2025 V
(06078)210 1122 A
(#define)294 1440 A
(c\(n\))168 1776 A
2112(\(1)S
2238(<<)S
(\(\(n\)-KERNEL_CALL\)\))756 2364 A
2115 V
(06079)210 1122 A
(#define)294 1440 A
(RS_C)168 1776 A
2112(\3040)S
2205 V
(06080)210 1122 A
(#define)294 1440 A
(PM_C)168 1776 A
(\304\(c\(SYS_DEVIO\))588 2112 A
2742(|)S
(c\(SYS_SDEVIO\))546 2826 A
3414(|)S
(c\(SYS_VDEVIO\))546 3498 A
4086(\\)S
2295 V
(06081)210 1122 A
1608(|)S
(c\(SYS_IRQCTL\))546 1692 A
2280(|)S
(c\(SYS_INT86\)\))546 2364 A
2385 V
(06082)210 1122 A
(#define)294 1440 A
(FS_C)168 1776 A
(\(c\(SYS_KILL\))504 2112 A
2658(|)S
(c\(SYS_VIRCOPY\))588 2742 A
3372(|)S
(c\(SYS_VIRVCOPY\))630 3456 A
4128(|)S
(c\(SYS_UMAP\))462 4212 A
4716(\\)S
2475 V
(06083)210 1122 A
1608(|)S
(c\(SYS_GETINFO\))588 1692 A
2322(|)S
(c\(SYS_EXIT\))462 2406 A
2910(|)S
(c\(SYS_TIMES\))504 2994 A
3540(|)S
(c\(SYS_SETALARM\)\))672 3624 A
2565 V
(06084)210 1122 A
(#define)294 1440 A
(DRV_C)210 1776 A
(\(FS_C)210 2112 A
2364(|)S
(c\(SYS_SEGCTL\))546 2448 A
3036(|)S
(c\(SYS_IRQCTL\))546 3120 A
3708(|)S
(c\(SYS_INT86\))504 3792 A
4338(\\)S
2655 V
(06085)210 1122 A
1608(|)S
(c\(SYS_DEVIO\))504 1692 A
2238(|)S
(c\(SYS_VDEVIO\))546 2322 A
2910(|)S
(c\(SYS_SDEVIO\)\))588 2994 A
2745 V
(06086)210 1122 A
(#define)294 1440 A
(MEM_C)210 1776 A
(\(DRV_C)252 2112 A
2406(|)S
(c\(SYS_PHYSCOPY\))630 2490 A
3162(|)S
(c\(SYS_PHYSVCOPY\)\))714 3246 A
2835 V
(06087)210 1122 A
2925 V
(06088)210 1122 A
1440(/*)S
(The)126 1566 A
(system)252 1734 A
(image)210 2028 A
(table)210 2280 A
(lists)210 2532 A
(all)126 2784 A
(programs)336 2952 A
(that)168 3330 A
(are)126 3540 A
(part)168 3708 A
3918(of)S
(the)126 4044 A
(boot)168 4212 A
(image.)252 4422 A
3015 V
(06089)210 1122 A
1482(*)S
(The)126 1566 A
(order)210 1734 A
1986(of)S
(the)126 2112 A
(entries)294 2280 A
(here)168 2616 A
(MUST)168 2826 A
(agree)210 3036 A
(with)168 3288 A
(the)126 3498 A
(order)210 3666 A
3918(of)S
(the)126 4044 A
(programs)336 4212 A
3105 V
(06090)210 1122 A
1482(*)S
1566(in)S
(the)126 1692 A
(boot)168 1860 A
(image)210 2070 A
(and)126 2322 A
(all)126 2490 A
(kernel)252 2658 A
(tasks)210 2952 A
(must)168 3204 A
(come)168 3414 A
(first.)252 3624 A
3195 V
(06091)210 1122 A
1482(*)S
(Each)168 1566 A
(entry)210 1776 A
(provides)336 2028 A
(the)126 2406 A
(process)294 2574 A
(number,)294 2910 A
(flags,)252 3246 A
(quantum)294 3540 A
(size)168 3876 A
(\(qs\),)210 4086 A
(scheduling)420 4338 A
3285 V
(06092)210 1122 A
1482(*)S
(queue,)252 1566 A
(allowed)294 1860 A
(traps,)252 2196 A
(ipc)126 2490 A
(mask,)210 2658 A
(and)126 2910 A
3078(a)S
(name)168 3162 A
(for)126 3372 A
(the)126 3540 A
(process)294 3708 A
(table.)252 4044 A
(The)126 4338 A
3375 V
(06093)210 1122 A
1482(*)S
(initial)294 1566 A
(program)294 1902 A
(counter)294 2238 A
(and)126 2574 A
(stack)210 2742 A
(size)168 2994 A
3204(is)S
(also)168 3330 A
(provided)336 3540 A
(for)126 3918 A
(kernel)252 4086 A
(tasks.)252 4380 A
3465 V
(06094)210 1122 A
1482(*/)S
3555 V
(06095)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(boot_image)420 2028 A
(image[])294 2490 A
2826(=)S
2910({)S
3645 V
(06096)210 1122 A
1440(/*)S
(process)294 1566 A
(nr,)126 1902 A
(pc,)126 2154 A
(flags,)252 2322 A
(qs,)126 2616 A
(queue,)252 2826 A
(stack,)252 3120 A
(traps,)252 3414 A
(ipcto,)252 3708 A
(call,)210 4002 A
(name)168 4296 A
4506(*/)S
3735 V
(06097)210 1122 A
1482({)S
(IDLE,)210 1566 A
(idle_task,)420 1860 A
(IDL_F,)252 2322 A
2658(8,)S
(IDLE_Q,)294 2784 A
(IDL_S,)252 3120 A
3582(0,)S
3876(0,)S
4170(0,)S
("IDLE")252 4296 A
4632(},)S
3825 V
(06098)210 1122 A
1482({)S
(CLOCK,clock_task,)714 1566 A
(TSK_F,)252 2322 A
(64,)126 2616 A
(TASK_Q,)294 2784 A
(TSK_S,)252 3120 A
(TSK_T,)252 3414 A
3876(0,)S
4170(0,)S
("CLOCK")294 4296 A
4632(},)S
3915 V
(06099)210 1122 A
1482({)S
(SYSTEM,)294 1566 A
(sys_task,)378 1902 A
(TSK_F,)252 2322 A
(64,)126 2616 A
(TASK_Q,)294 2784 A
(TSK_S,)252 3120 A
(TSK_T,)252 3414 A
3876(0,)S
4170(0,)S
("SYSTEM"},)420 4296 A
4005 V
(06100)210 1122 A
1482({)S
(HARDWARE,)378 1566 A
2196(0,)S
(TSK_F,)252 2322 A
(64,)126 2616 A
(TASK_Q,)294 2784 A
(HRD_S,)252 3120 A
3582(0,)S
3876(0,)S
4170(0,)S
("KERNEL"},)420 4296 A
4095 V
(06101)210 1122 A
1482({)S
(PM_PROC_NR,)462 1566 A
2196(0,)S
(SRV_F,)252 2322 A
(32,)126 2616 A
2994(3,)S
3120(0,)S
(SRV_T,)252 3414 A
(SRV_M,)252 3708 A
(PM_C,)210 4044 A
("pm")168 4296 A
4632(},)S
4185 V
(06102)210 1122 A
1482({)S
(FS_PROC_NR,)462 1566 A
2196(0,)S
(SRV_F,)252 2322 A
(32,)126 2616 A
2994(4,)S
3120(0,)S
(SRV_T,)252 3414 A
(SRV_M,)252 3708 A
(FS_C,)210 4044 A
("fs")168 4296 A
4632(},)S
4275 V
(06103)210 1122 A
1482({)S
(RS_PROC_NR,)462 1566 A
2196(0,)S
(SRV_F,)252 2322 A
2658(4,)S
2994(3,)S
3120(0,)S
(SRV_T,)252 3414 A
(SYS_M,)252 3708 A
(RS_C,)210 4044 A
("rs")168 4296 A
4632(},)S
4365 V
(06104)210 1122 A
1482({)S
(TTY_PROC_NR,)504 1566 A
2196(0,)S
(SRV_F,)252 2322 A
2658(4,)S
2994(1,)S
3120(0,)S
(SRV_T,)252 3414 A
(SYS_M,)252 3708 A
(DRV_C,)252 4002 A
("tty")210 4296 A
4632(},)S
4455 V
(06105)210 1122 A
1482({)S
(MEM_PROC_NR,)504 1566 A
2196(0,)S
(SRV_F,)252 2322 A
2658(4,)S
2994(2,)S
3120(0,)S
(SRV_T,)252 3414 A
(DRV_M,)252 3708 A
(MEM_C,)252 4002 A
("memory"},)420 4296 A
4545 V
(06106)210 1122 A
1482({)S
(LOG_PROC_NR,)504 1566 A
2196(0,)S
(SRV_F,)252 2322 A
2658(4,)S
2994(2,)S
3120(0,)S
(SRV_T,)252 3414 A
(SYS_M,)252 3708 A
(DRV_C,)252 4002 A
("log")210 4296 A
4632(},)S
4635 V
(06107)210 1122 A
1482({)S
(DRVR_PROC_NR,)546 1566 A
2196(0,)S
(SRV_F,)252 2322 A
2658(4,)S
2994(2,)S
3120(0,)S
(SRV_T,)252 3414 A
(SYS_M,)252 3708 A
(DRV_C,)252 4002 A
("driver"},)420 4296 A
4725 V
(06108)210 1122 A
1482({)S
(INIT_PROC_NR,)546 1566 A
2196(0,)S
(USR_F,)252 2322 A
2658(8,)S
(USER_Q,)294 2784 A
3120(0,)S
(USR_T,)252 3414 A
(USR_M,)252 3708 A
4170(0,)S
("init")252 4296 A
4632(},)S
4815 V
(06109)210 1122 A
1440(};)S
4905 V
(06110)210 1122 A
4995 V
(06111)210 1122 A
1440(/*)S
(Verify)252 1566 A
(the)126 1860 A
(size)168 2028 A
2238(of)S
(the)126 2364 A
(system)252 2532 A
(image)210 2826 A
(table)210 3078 A
3330(at)S
(compile)294 3456 A
(time.)210 3792 A
(Also)168 4044 A
(verify)252 4254 A
(that)168 4548 A
5085 V
(06112)210 1122 A
1482(*)S
(the)126 1566 A
(first)210 1734 A
(chunk)210 1986 A
2238(of)S
(the)126 2364 A
(ipc)126 2532 A
(mask)168 2700 A
(has)126 2910 A
(enough)252 3078 A
(bits)168 3372 A
3582(to)S
(accommodate)462 3708 A
(the)126 4212 A
(processes)378 4380 A
5175 V
(06113)210 1122 A
1482(*)S
1566(in)S
(the)126 1692 A
(image.)252 1860 A
5265 V
(06114)210 1122 A
1482(*)S
1566(If)S
1692(a)S
(problem)294 1776 A
2112(is)S
(detected,)378 2238 A
(the)126 2658 A
(size)168 2826 A
3036(of)S
(the)126 3162 A
('dummy')294 3330 A
(array)210 3666 A
(will)168 3918 A
4128(be)S
(negative,)378 4254 A
5355 V
(06115)210 1122 A
1482(*)S
(causing)294 1566 A
1902(a)S
(compile)294 1986 A
(time)168 2322 A
(error.)252 2532 A
(Note)168 2826 A
(that)168 3036 A
3246(no)S
(space)210 3372 A
3624(is)S
(actually)336 3750 A
(allocated)378 4128 A
5445 V
(06116)210 1122 A
1482(*)S
(because)294 1566 A
('dummy')294 1902 A
2238(is)S
(declared)336 2364 A
(extern.)294 2742 A
5535 V
(06117)210 1122 A
1482(*/)S
5625 V
(06118)210 1122 A
(extern)252 1440 A
(int)126 1734 A
(dummy[\(NR_BOOT_PROCS==sizeof\(image\)/)1512 1902 A
5715 V
(06119)210 1122 A
(sizeof\(struct)546 1776 A
(boot_image\)\)?1:-1];)798 2364 A
5805 V
(06120)210 1122 A
(extern)252 1440 A
(int)126 1734 A
(dummy[\(BITCHUNK_BITS)840 1902 A
2784(>)S
(NR_BOOT_PROCS)546 2868 A
3456(-)S
3540(1\))S
3666(?)S
3750(1)S
3834(:)S
(-1];)168 3918 A
5895 V
(06121)210 1122 A
6345 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6435 V
(kernel/mpx.s)504 2676 A
6525 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6705 V
(06200)210 1122 A
1440(#)S
6795 V
(06201)210 1122 A
1440(!)S
(Chooses)294 1524 A
(between)294 1860 A
(the)126 2196 A
(8086)168 2364 A
(and)126 2574 A
(386)126 2742 A
(versions)336 2910 A
3288(of)S
(the)126 3414 A
(Minix)210 3582 A
(startup)294 3834 A
(code.)210 4170 A
6885 V
(06202)210 1122 A
6975 V
(06203)210 1122 A
(#include)336 1440 A
(<minix/config.h>)672 1818 A
7065 V
(06204)210 1122 A
(#if)126 1440 A
(_WORD_SIZE)420 1608 A
2070(==)S
2196(2)S
8418 V
EP
%%Page: 69 69
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2475(File:)S
2708(kernel/mpx.s)S
12 B
4560(69)S
1755 V
7 LST
(06205)210 1122 A
(#include)336 1440 A
("mpx88.s")378 1818 A
1845 V
(06206)210 1122 A
(#else)210 1440 A
1935 V
(06207)210 1122 A
(#include)336 1440 A
("mpx386.s")420 1818 A
2025 V
(06208)210 1122 A
(#endif)252 1440 A
2295 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2385 V
(kernel/mpx386.s)630 2676 A
2475 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2655 V
(06300)210 1122 A
1440(#)S
2745 V
(06301)210 1122 A
1440(!)S
(This)168 1524 A
(file,)210 1734 A
(mpx386.s,)378 1986 A
2406(is)S
(included)336 2532 A
2910(by)S
(mpx.s)210 3036 A
(when)168 3288 A
(Minix)210 3498 A
3750(is)S
(compiled)336 3876 A
(for)126 4254 A
2835 V
(06302)210 1122 A
1440(!)S
(32-bit)252 1524 A
(Intel)210 1818 A
(CPUs.)210 2070 A
(The)126 2322 A
(alternative)462 2490 A
(mpx88.s)294 2994 A
3330(is)S
(compiled)336 3456 A
(for)126 3834 A
(16-bit)252 4002 A
(CPUs.)210 4296 A
2925 V
(06303)210 1122 A
3015 V
(06304)210 1122 A
1440(!)S
(This)168 1524 A
(file)168 1734 A
1944(is)S
(part)168 2070 A
2280(of)S
(the)126 2406 A
(lowest)252 2574 A
(layer)210 2868 A
3120(of)S
(the)126 3246 A
(MINIX)210 3414 A
(kernel.)294 3666 A
(\(The)168 4044 A
(other)210 4254 A
(part)168 4506 A
3105 V
(06305)210 1122 A
1440(!)S
1524(is)S
("proc.c".\))420 1650 A
(The)126 2154 A
(lowest)252 2322 A
(layer)210 2616 A
(does)168 2868 A
(process)294 3078 A
(switching)378 3414 A
(and)126 3834 A
(message)294 4002 A
(handling.)378 4338 A
3195 V
(06306)210 1122 A
1440(!)S
(Furthermore)462 1524 A
2028(it)S
(contains)336 2154 A
(the)126 2532 A
(assembler)378 2700 A
(startup)294 3120 A
(code)168 3456 A
(for)126 3666 A
(Minix)210 3834 A
(and)126 4086 A
(the)126 4254 A
(32-bit)252 4422 A
3285 V
(06307)210 1122 A
1440(!)S
(interrupt)378 1524 A
(handlers.)378 1944 A
2406(It)S
(cooperates)420 2532 A
(with)168 2994 A
(the)126 3204 A
(code)168 3372 A
3582(in)S
("start.c")378 3708 A
4128(to)S
(set)126 4254 A
4422(up)S
4548(a)S
3375 V
(06308)210 1122 A
1440(!)S
(good)168 1524 A
(environment)462 1734 A
(for)126 2238 A
(main\(\).)294 2406 A
3465 V
(06309)210 1122 A
3555 V
(06310)210 1122 A
1440(!)S
(Every)210 1524 A
(transition)420 1776 A
2238(to)S
(the)126 2364 A
(kernel)252 2532 A
(goes)168 2826 A
(through)294 3036 A
(this)168 3372 A
(file.)210 3582 A
(Transitions)462 3876 A
4380(to)S
(the)126 4506 A
3645 V
(06311)210 1122 A
1440(!)S
(kernel)252 1524 A
(may)126 1818 A
1986(be)S
(nested.)294 2112 A
(The)126 2490 A
(initial)294 2658 A
(entry)210 2994 A
(may)126 3246 A
3414(be)S
(with)168 3540 A
3750(a)S
(system)252 3834 A
(call)168 4128 A
(\(i.e.,)252 4338 A
3735 V
(06312)210 1122 A
1440(!)S
(send)168 1524 A
1734(or)S
(receive)294 1860 A
2196(a)S
(message\),)378 2280 A
2700(an)S
(exception)378 2826 A
3246(or)S
3372(a)S
(hardware)336 3456 A
(interrupt;)420 3834 A
(kernel)252 4338 A
3825 V
(06313)210 1122 A
1440(!)S
(reentries)378 1524 A
(may)126 1944 A
(only)168 2112 A
2322(be)S
(made)168 2448 A
2658(by)S
(hardware)336 2784 A
(interrupts.)462 3162 A
(The)126 3708 A
(count)210 3876 A
4128(of)S
(reentries)378 4254 A
3915 V
(06314)210 1122 A
1440(!)S
1524(is)S
(kept)168 1650 A
1860(in)S
("k_reenter".)504 1986 A
2532(It)S
2658(is)S
(important)378 2784 A
(for)126 3204 A
(deciding)336 3372 A
(whether)294 3750 A
4086(to)S
(switch)252 4212 A
4506(to)S
4005 V
(06315)210 1122 A
1440(!)S
(the)126 1524 A
(kernel)252 1692 A
(stack)210 1986 A
(and)126 2238 A
(for)126 2406 A
(protecting)420 2574 A
(the)126 3036 A
(message)294 3204 A
(passing)294 3540 A
(code)168 3876 A
4086(in)S
("proc.c".)378 4212 A
4095 V
(06316)210 1122 A
4185 V
(06317)210 1122 A
1440(!)S
(For)126 1524 A
(the)126 1692 A
(message)294 1860 A
(passing)294 2196 A
(trap,)210 2532 A
(most)168 2784 A
2994(of)S
(the)126 3120 A
(machine)294 3288 A
(state)210 3624 A
3876(is)S
(saved)210 4002 A
4254(in)S
(the)126 4380 A
4275 V
(06318)210 1122 A
1440(!)S
(proc)168 1524 A
(table.)252 1734 A
(\(Some)210 2070 A
2322(of)S
(the)126 2448 A
(registers)378 2616 A
(need)168 3036 A
(not)126 3246 A
3414(be)S
(saved.\))294 3540 A
(Then)168 3918 A
(the)126 4128 A
(stack)210 4296 A
4548(is)S
4365 V
(06319)210 1122 A
1440(!)S
(switched)336 1524 A
1902(to)S
("k_stack",)420 2028 A
(and)126 2490 A
(interrupts)420 2658 A
(are)126 3120 A
(reenabled.)420 3288 A
(Finally,)336 3792 A
(the)126 4170 A
(system)252 4338 A
4455 V
(06320)210 1122 A
1440(!)S
(call)168 1524 A
(handler)294 1734 A
(\(in)126 2070 A
2238(C\))S
2364(is)S
(called.)294 2490 A
(When)168 2868 A
3078(it)S
(returns,)336 3204 A
(interrupts)420 3582 A
(are)126 4044 A
(disabled)336 4212 A
4545 V
(06321)210 1122 A
1440(!)S
(again)210 1524 A
(and)126 1776 A
(the)126 1944 A
(code)168 2112 A
(falls)210 2322 A
(into)168 2574 A
(the)126 2784 A
(restart)294 2952 A
(routine,)336 3288 A
3666(to)S
(finish)252 3792 A
(off)126 4086 A
(held-up)294 4254 A
4635 V
(06322)210 1122 A
1440(!)S
(interrupts)420 1524 A
(and)126 1986 A
(run)126 2154 A
(the)126 2322 A
(process)294 2490 A
2826(or)S
(task)168 2952 A
(whose)210 3162 A
(pointer)294 3414 A
3750(is)S
3876(in)S
("proc_ptr".)462 4002 A
4725 V
(06323)210 1122 A
4815 V
(06324)210 1122 A
1440(!)S
(Hardware)336 1524 A
(interrupt)378 1902 A
(handlers)336 2322 A
2700(do)S
(the)126 2826 A
(same,)210 2994 A
(except)252 3246 A
(\(1\))126 3582 A
(The)126 3750 A
(entire)252 3918 A
(state)210 4212 A
(must)168 4464 A
4905 V
(06325)210 1122 A
1440(!)S
1524(be)S
(saved.)252 1650 A
(\(2\))126 1986 A
(There)210 2154 A
(are)126 2406 A
(too)126 2574 A
(many)168 2742 A
(handlers)336 2952 A
3330(to)S
3456(do)S
(this)168 3582 A
(inline,)294 3792 A
4128(so)S
(the)126 4254 A
(save)168 4422 A
4995 V
(06326)210 1122 A
1440(!)S
(routine)294 1524 A
1860(is)S
(called.)294 1986 A
2364(A)S
(few)126 2448 A
(cycles)252 2616 A
(are)126 2910 A
(saved)210 3078 A
3330(by)S
(pushing)294 3456 A
(the)126 3792 A
(address)294 3960 A
4296(of)S
(the)126 4422 A
5085 V
(06327)210 1122 A
1440(!)S
(appropiate)420 1524 A
(restart)294 1986 A
(routine)294 2322 A
(for)126 2658 A
2826(a)S
(return)252 2910 A
(later.)252 3204 A
(\(3\))126 3540 A
3708(A)S
(stack)210 3792 A
(switch)252 4044 A
4338(is)S
5175 V
(06328)210 1122 A
1440(!)S
(avoided)294 1524 A
(when)168 1860 A
(the)126 2070 A
(stack)210 2238 A
2490(is)S
(already)294 2616 A
(switched.)378 2952 A
(\(4\))126 3414 A
(The)126 3582 A
(\(master\))336 3750 A
(8259)168 4128 A
(interrupt)378 4338 A
5265 V
(06329)210 1122 A
1440(!)S
(controller)420 1524 A
1986(is)S
(reenabled)378 2112 A
(centrally)378 2532 A
2952(in)S
(save\(\).)294 3078 A
(\(5\))126 3456 A
(Each)168 3624 A
(interrupt)378 3834 A
(handler)294 4254 A
5355 V
(06330)210 1122 A
1440(!)S
(masks)210 1524 A
(its)126 1776 A
(interrupt)378 1944 A
(line)168 2364 A
(using)210 2574 A
(the)126 2826 A
(8259)168 2994 A
(before)252 3204 A
(enabling)336 3498 A
(\(other)252 3876 A
(unmasked\))378 4170 A
5445 V
(06331)210 1122 A
1440(!)S
(interrupts,)462 1524 A
(and)126 2028 A
(unmasks)294 2196 A
2532(it)S
(after)210 2658 A
(servicing)378 2910 A
(the)126 3330 A
(interrupt.)420 3498 A
(This)168 4002 A
(limits)252 4212 A
(the)126 4506 A
5535 V
(06332)210 1122 A
1440(!)S
(nest)168 1524 A
(level)210 1734 A
1986(to)S
(the)126 2112 A
(number)252 2280 A
2574(of)S
(lines)210 2700 A
(and)126 2952 A
(protects)336 3120 A
(the)126 3498 A
(handler)294 3666 A
(from)168 4002 A
(itself.)294 4212 A
5625 V
(06333)210 1122 A
5715 V
(06334)210 1122 A
1440(!)S
(For)126 1524 A
(communication)546 1692 A
(with)168 2280 A
(the)126 2490 A
(boot)168 2658 A
(monitor)294 2868 A
3204(at)S
(startup)294 3330 A
(time)168 3666 A
(some)168 3876 A
(constant)336 4086 A
5805 V
(06335)210 1122 A
1440(!)S
(data)168 1524 A
(are)126 1734 A
(compiled)336 1902 A
(into)168 2280 A
(the)126 2490 A
(beginning)378 2658 A
3078(of)S
(the)126 3204 A
(text)168 3372 A
(segment.)336 3582 A
(This)168 3960 A
(facilitates)462 4170 A
5895 V
(06336)210 1122 A
1440(!)S
(reading)294 1524 A
(the)126 1860 A
(data)168 2028 A
2238(at)S
(the)126 2364 A
(start)210 2532 A
2784(of)S
(the)126 2910 A
(boot)168 3078 A
(process,)336 3288 A
(since)210 3666 A
(only)168 3918 A
(the)126 4128 A
(first)210 4296 A
5985 V
(06337)210 1122 A
1440(!)S
(sector)252 1524 A
1818(of)S
(the)126 1944 A
(file)168 2112 A
(needs)210 2322 A
2574(to)S
2700(be)S
(read.)210 2826 A
6075 V
(06338)210 1122 A
6165 V
(06339)210 1122 A
1440(!)S
(Some)168 1524 A
(data)168 1734 A
(storage)294 1944 A
2280(is)S
(also)168 2406 A
(allocated)378 2616 A
3036(at)S
(the)126 3162 A
(end)126 3330 A
3498(of)S
(this)168 3624 A
(file.)210 3834 A
(This)168 4086 A
(data)168 4296 A
6255 V
(06340)210 1122 A
1440(!)S
(will)168 1524 A
1734(be)S
1860(at)S
(the)126 1986 A
(start)210 2154 A
2406(of)S
(the)126 2532 A
(data)168 2700 A
(segment)294 2910 A
3246(of)S
(the)126 3372 A
(kernel)252 3540 A
(and)126 3834 A
(will)168 4002 A
4212(be)S
(read)168 4338 A
6345 V
(06341)210 1122 A
1440(!)S
(and)126 1524 A
(modified)336 1692 A
2070(by)S
(the)126 2196 A
(boot)168 2364 A
(monitor)294 2574 A
(before)252 2910 A
(the)126 3204 A
(kernel)252 3372 A
(starts.)294 3666 A
6435 V
(06342)210 1122 A
6525 V
(06343)210 1122 A
1440(!)S
(sections)336 1524 A
6615 V
(06344)210 1122 A
6705 V
(06345)210 1122 A
(.sect)210 1440 A
(.text)210 1692 A
6795 V
(06346)210 1122 A
(begtext:)336 1440 A
6885 V
(06347)210 1122 A
(.sect)210 1440 A
(.rom)168 1692 A
6975 V
(06348)210 1122 A
(begrom:)294 1440 A
7065 V
(06349)210 1122 A
(.sect)210 1440 A
(.data)210 1692 A
8418 V
EP
%%Page: 70 70
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(70)S
11 R
2393(File:)S
(kernel/mpx386.s)741 2626 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(06350)210 1122 A
(begdata:)336 1440 A
1845 V
(06351)210 1122 A
(.sect)210 1440 A
(.bss)168 1692 A
1935 V
(06352)210 1122 A
(begbss:)294 1440 A
2025 V
(06353)210 1122 A
2115 V
(06354)210 1122 A
(#include)336 1440 A
(<minix/config.h>)672 1818 A
2205 V
(06355)210 1122 A
(#include)336 1440 A
(<minix/const.h>)630 1818 A
2295 V
(06356)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
2385 V
(06357)210 1122 A
(#include)336 1440 A
(<ibm/interrupt.h>)714 1818 A
2475 V
(06358)210 1122 A
(#include)336 1440 A
("const.h")378 1818 A
2565 V
(06359)210 1122 A
(#include)336 1440 A
("protect.h")462 1818 A
2655 V
(06360)210 1122 A
(#include)336 1440 A
("sconst.h")420 1818 A
2745 V
(06361)210 1122 A
2835 V
(06362)210 1122 A
1440(/*)S
(Selected)336 1566 A
(386)126 1944 A
(tss)126 2112 A
(offsets.)336 2280 A
2658(*/)S
2925 V
(06363)210 1122 A
(#define)294 1440 A
(TSS3_S_SP0)420 1776 A
2448(4)S
3015 V
(06364)210 1122 A
3105 V
(06365)210 1122 A
1440(!)S
(Exported)336 1524 A
(functions)378 1902 A
3195 V
(06366)210 1122 A
1440(!)S
(Note:)210 1524 A
1776(in)S
(assembly)336 1902 A
(language)336 2280 A
(the)126 2658 A
(.define)294 2826 A
(statement)378 3162 A
(applied)294 3582 A
3918(to)S
4044(a)S
(function)336 4128 A
(name)168 4506 A
3285 V
(06367)210 1122 A
1440(!)S
1524(is)S
(loosely)294 1650 A
(equivalent)420 1986 A
2448(to)S
2574(a)S
(prototype)378 2658 A
3078(in)S
3204(C)S
(code)168 3288 A
3498(--)S
3624(it)S
(makes)210 3750 A
4002(it)S
(possible)336 4128 A
4506(to)S
3375 V
(06368)210 1122 A
1440(!)S
(link)168 1524 A
1734(to)S
1860(an)S
(entity)252 1986 A
(declared)336 2280 A
2658(in)S
(the)126 2784 A
(assembly)336 2952 A
(code)168 3330 A
(but)126 3540 A
(does)168 3708 A
(not)126 3918 A
(create)252 4086 A
3465 V
(06369)210 1122 A
1440(!)S
(the)126 1524 A
(entity.)294 1692 A
3555 V
(06370)210 1122 A
3645 V
(06371)210 1122 A
(.define)294 1440 A
(_restart)336 1776 A
3735 V
(06372)210 1122 A
(.define)294 1440 A
(save)168 1776 A
3825 V
(06373)210 1122 A
3915 V
(06374)210 1122 A
(.define)294 1440 A
(_divide_error)546 1776 A
4005 V
(06375)210 1122 A
(.define)294 1440 A
(_single_step_exception)924 1776 A
4095 V
(06376)210 1122 A
(.define)294 1440 A
(_nmi)168 1776 A
4185 V
(06377)210 1122 A
(.define)294 1440 A
(_breakpoint_exception)882 1776 A
4275 V
(06378)210 1122 A
(.define)294 1440 A
(_overflow)378 1776 A
4365 V
(06379)210 1122 A
(.define)294 1440 A
(_bounds_check)546 1776 A
4455 V
(06380)210 1122 A
(.define)294 1440 A
(_inval_opcode)546 1776 A
4545 V
(06381)210 1122 A
(.define)294 1440 A
(_copr_not_available)798 1776 A
4635 V
(06382)210 1122 A
(.define)294 1440 A
(_double_fault)546 1776 A
4725 V
(06383)210 1122 A
(.define)294 1440 A
(_copr_seg_overrun)714 1776 A
4815 V
(06384)210 1122 A
(.define)294 1440 A
(_inval_tss)420 1776 A
4905 V
(06385)210 1122 A
(.define)294 1440 A
(_segment_not_present)840 1776 A
4995 V
(06386)210 1122 A
(.define)294 1440 A
(_stack_exception)672 1776 A
5085 V
(06387)210 1122 A
(.define)294 1440 A
(_general_protection)798 1776 A
5175 V
(06388)210 1122 A
(.define)294 1440 A
(_page_fault)462 1776 A
5265 V
(06389)210 1122 A
(.define)294 1440 A
(_copr_error)462 1776 A
5355 V
(06390)210 1122 A
5445 V
(06391)210 1122 A
(.define)294 1440 A
(_hwint00)336 1776 A
2448(!)S
(handlers)336 2532 A
(for)126 2910 A
(hardware)336 3078 A
(interrupts)420 3456 A
5535 V
(06392)210 1122 A
(.define)294 1440 A
(_hwint01)336 1776 A
5625 V
(06393)210 1122 A
(.define)294 1440 A
(_hwint02)336 1776 A
5715 V
(06394)210 1122 A
(.define)294 1440 A
(_hwint03)336 1776 A
5805 V
(06395)210 1122 A
(.define)294 1440 A
(_hwint04)336 1776 A
5895 V
(06396)210 1122 A
(.define)294 1440 A
(_hwint05)336 1776 A
5985 V
(06397)210 1122 A
(.define)294 1440 A
(_hwint06)336 1776 A
6075 V
(06398)210 1122 A
(.define)294 1440 A
(_hwint07)336 1776 A
6165 V
(06399)210 1122 A
(.define)294 1440 A
(_hwint08)336 1776 A
6255 V
(06400)210 1122 A
(.define)294 1440 A
(_hwint09)336 1776 A
6345 V
(06401)210 1122 A
(.define)294 1440 A
(_hwint10)336 1776 A
6435 V
(06402)210 1122 A
(.define)294 1440 A
(_hwint11)336 1776 A
6525 V
(06403)210 1122 A
(.define)294 1440 A
(_hwint12)336 1776 A
6615 V
(06404)210 1122 A
(.define)294 1440 A
(_hwint13)336 1776 A
6705 V
(06405)210 1122 A
(.define)294 1440 A
(_hwint14)336 1776 A
6795 V
(06406)210 1122 A
(.define)294 1440 A
(_hwint15)336 1776 A
6885 V
(06407)210 1122 A
6975 V
(06408)210 1122 A
(.define)294 1440 A
(_s_call)294 1776 A
7065 V
(06409)210 1122 A
(.define)294 1440 A
(_p_s_call)378 1776 A
8418 V
EP
%%Page: 71 71
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2393(File:)S
(kernel/mpx386.s)741 2626 A
12 B
4560(71)S
1755 V
7 LST
(06410)210 1122 A
(.define)294 1440 A
(_level0_call)504 1776 A
1845 V
(06411)210 1122 A
1935 V
(06412)210 1122 A
1440(!)S
(Exported)336 1524 A
(variables.)420 1902 A
2025 V
(06413)210 1122 A
(.define)294 1440 A
(begbss)252 1776 A
2115 V
(06414)210 1122 A
(.define)294 1440 A
(begdata)294 1776 A
2205 V
(06415)210 1122 A
2295 V
(06416)210 1122 A
(.sect)210 1440 A
(.text)210 1692 A
2385 V
(06417)210 1122 A
(!*===========================================================================*)3276 1440 A
2475 V
(06418)210 1122 A
1440(!*)S
(MINIX)210 2784 A
4674(*)S
2565 V
(06419)210 1122 A
(!*===========================================================================*)3276 1440 A
2655 V
(06420)210 1122 A
(MINIX:)252 1440 A
2784(!)S
(this)168 2868 A
3078(is)S
(the)126 3204 A
(entry)210 3372 A
(point)210 3624 A
(for)126 3876 A
(the)126 4044 A
(MINIX)210 4212 A
(kernel)252 4464 A
2745 V
(06421)210 1122 A
(jmp)126 1776 A
(over_flags)420 2112 A
2784(!)S
(skip)168 2868 A
(over)168 3078 A
(the)126 3288 A
(next)168 3456 A
(few)126 3666 A
(bytes)210 3834 A
2835 V
(06422)210 1122 A
(.data2)252 1776 A
(CLICK_SHIFT)462 2112 A
2784(!)S
(for)126 2868 A
(the)126 3036 A
(monitor:)336 3204 A
(memory)252 3582 A
(granularity)462 3876 A
2925 V
(06423)210 1122 A
(flags:)252 1440 A
3015 V
(06424)210 1122 A
(.data2)252 1776 A
(0x01FD)252 2112 A
2784(!)S
(boot)168 2868 A
(monitor)294 3078 A
(flags:)252 3414 A
3105 V
(06425)210 1122 A
2784(!)S
(call)168 3120 A
3330(in)S
(386)126 3456 A
(mode,)210 3624 A
(make)168 3876 A
(bss,)168 4086 A
(make)168 4296 A
(stack,)252 4506 A
3195 V
(06426)210 1122 A
2784(!)S
(load)168 3120 A
(high,)210 3330 A
(don't)210 3582 A
(patch,)252 3834 A
(will)168 4128 A
(return,)294 4338 A
3285 V
(06427)210 1122 A
2784(!)S
(uses)168 3120 A
(generic)294 3330 A
(INT,)168 3666 A
(memory)252 3876 A
(vector,)294 4170 A
3375 V
(06428)210 1122 A
2784(!)S
(new)126 3120 A
(boot)168 3288 A
(code)168 3498 A
(return)252 3708 A
3465 V
(06429)210 1122 A
(nop)126 1776 A
2784(!)S
(extra)210 2868 A
(byte)168 3120 A
3330(to)S
(sync)168 3456 A
3666(up)S
(disassembler)504 3792 A
3555 V
(06430)210 1122 A
(over_flags:)462 1440 A
3645 V
(06431)210 1122 A
3735 V
(06432)210 1122 A
1440(!)S
(Set)126 1524 A
1692(up)S
1818(a)S
1902(C)S
(stack)210 1986 A
(frame)210 2238 A
2490(on)S
(the)126 2616 A
(monitor)294 2784 A
(stack.)252 3120 A
(\(The)168 3456 A
(monitor)294 3666 A
(sets)168 4002 A
4212(cs)S
(and)126 4338 A
4506(ds)S
3825 V
(06433)210 1122 A
1440(!)S
(right.)252 1524 A
(The)126 1860 A
2028(ss)S
(descriptor)420 2154 A
(still)210 2616 A
(references)420 2868 A
(the)126 3330 A
(monitor)294 3498 A
(data)168 3834 A
(segment.\))378 4044 A
3915 V
(06434)210 1122 A
(movzx)210 1776 A
(esp,)168 2112 A
2322(sp)S
2784(!)S
(monitor)294 2868 A
(stack)210 3204 A
3456(is)S
3582(a)S
3666(16)S
(bit)126 3792 A
(stack)210 3960 A
4005 V
(06435)210 1122 A
(push)168 1776 A
(ebp)126 2112 A
4095 V
(06436)210 1122 A
(mov)126 1776 A
(ebp,)168 2112 A
(esp)126 2322 A
4185 V
(06437)210 1122 A
(push)168 1776 A
(esi)126 2112 A
4275 V
(06438)210 1122 A
(push)168 1776 A
(edi)126 2112 A
4365 V
(06439)210 1122 A
(cmp)126 1776 A
(4\(ebp\),)294 2112 A
2448(0)S
2784(!)S
(monitor)294 2868 A
(return)252 3204 A
(vector)252 3498 A
3792(is)S
4455 V
(06440)210 1122 A
1776(jz)S
(noret)210 2112 A
2784(!)S
(nonzero)294 2868 A
3204(if)S
(return)252 3330 A
(possible)336 3624 A
4545 V
(06441)210 1122 A
(inc)126 1776 A
(\(_mon_return\))546 2112 A
4635 V
(06442)210 1122 A
(noret:)252 1440 A
(mov)126 1776 A
(\(_mon_sp\),)420 2112 A
(esp)126 2574 A
2784(!)S
(save)168 2868 A
(stack)210 3078 A
(pointer)294 3330 A
(for)126 3666 A
(later)210 3834 A
(return)252 4086 A
4725 V
(06443)210 1122 A
4815 V
(06444)210 1122 A
1440(!)S
(Copy)168 1524 A
(the)126 1734 A
(monitor)294 1902 A
(global)252 2238 A
(descriptor)420 2532 A
(table)210 2994 A
3246(to)S
(the)126 3372 A
(address)294 3540 A
(space)210 3876 A
4128(of)S
(kernel)252 4254 A
(and)126 4548 A
4905 V
(06445)210 1122 A
1440(!)S
(switch)252 1524 A
(over)168 1818 A
2028(to)S
(it.)126 2154 A
(Prot_init\(\))462 2364 A
(can)126 2868 A
(then)168 3036 A
(update)252 3246 A
3540(it)S
(with)168 3666 A
(immediate)378 3876 A
(effect.)294 4296 A
4995 V
(06446)210 1122 A
5085 V
(06447)210 1122 A
(sgdt)168 1776 A
(\(_gdt+GDT_SELECTOR\))798 2112 A
3456(!)S
(get)126 3540 A
(the)126 3708 A
(monitor)294 3876 A
(gdtr)168 4212 A
5175 V
(06448)210 1122 A
(mov)126 1776 A
(esi,)168 2112 A
(\(_gdt+GDT_SELECTOR+2\))882 2322 A
3456(!)S
(absolute)336 3540 A
(address)294 3918 A
4254(of)S
(GDT)126 4380 A
5265 V
(06449)210 1122 A
(mov)126 1776 A
(ebx,)168 2112 A
(_gdt)168 2322 A
3456(!)S
(address)294 3540 A
3876(of)S
(kernel)252 4002 A
(GDT)126 4296 A
5355 V
(06450)210 1122 A
(mov)126 1776 A
(ecx,)168 2112 A
(8*8)126 2322 A
3456(!)S
(copying)294 3540 A
(eight)210 3876 A
(descriptors)462 4128 A
5445 V
(06451)210 1122 A
(copygdt:)336 1440 A
5535 V
(06452)210 1122 A
(eseg)168 1482 A
(movb)168 1776 A
(al,)126 2112 A
(\(esi\))210 2280 A
5625 V
(06453)210 1122 A
(movb)168 1776 A
(\(ebx\),)252 2112 A
2406(al)S
5715 V
(06454)210 1122 A
(inc)126 1776 A
(esi)126 2112 A
5805 V
(06455)210 1122 A
(inc)126 1776 A
(ebx)126 2112 A
5895 V
(06456)210 1122 A
(loop)168 1776 A
(copygdt)294 2112 A
5985 V
(06457)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(\(_gdt+DS_SELECTOR+2\))840 2322 A
3456(!)S
(base)168 3540 A
3750(of)S
(kernel)252 3876 A
(data)168 4170 A
6075 V
(06458)210 1122 A
(and)126 1776 A
(eax,)168 2112 A
(0x00FFFFFF)420 2322 A
3456(!)S
(only)168 3540 A
3750(24)S
(bits)168 3876 A
6165 V
(06459)210 1122 A
(add)126 1776 A
(eax,)168 2112 A
(_gdt)168 2322 A
3456(!)S
(eax)126 3540 A
3708(=)S
(vir2phys\(gdt\))546 3792 A
6255 V
(06460)210 1122 A
(mov)126 1776 A
(\(_gdt+GDT_SELECTOR+2\),)924 2112 A
(eax)126 3078 A
3456(!)S
(set)126 3540 A
(base)168 3708 A
3918(of)S
(GDT)126 4044 A
6345 V
(06461)210 1122 A
(lgdt)168 1776 A
(\(_gdt+GDT_SELECTOR\))798 2112 A
3456(!)S
(switch)252 3540 A
(over)168 3834 A
4044(to)S
(kernel)252 4170 A
(GDT)126 4464 A
6435 V
(06462)210 1122 A
6525 V
(06463)210 1122 A
1440(!)S
(Locate)252 1524 A
(boot)168 1818 A
(parameters,)462 2028 A
(set)126 2532 A
2700(up)S
(kernel)252 2826 A
(segment)294 3120 A
(registers)378 3456 A
(and)126 3876 A
(stack.)252 4044 A
6615 V
(06464)210 1122 A
(mov)126 1776 A
(ebx,)168 2112 A
(8\(ebp\))252 2322 A
2784(!)S
(boot)168 2868 A
(parameters)420 3078 A
(offset)252 3540 A
6705 V
(06465)210 1122 A
(mov)126 1776 A
(edx,)168 2112 A
(12\(ebp\))294 2322 A
2784(!)S
(boot)168 2868 A
(parameters)420 3078 A
(length)252 3540 A
6795 V
(06466)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(16\(ebp\))294 2322 A
2784(!)S
(address)294 2868 A
3204(of)S
(a.out)210 3330 A
(headers)294 3582 A
6885 V
(06467)210 1122 A
(mov)126 1776 A
(\(_aout\),)336 2112 A
(eax)126 2490 A
6975 V
(06468)210 1122 A
(mov)126 1776 A
(ax,)126 2112 A
2280(ds)S
2784(!)S
(kernel)252 2868 A
(data)168 3162 A
7065 V
(06469)210 1122 A
(mov)126 1776 A
(es,)126 2112 A
2280(ax)S
8418 V
EP
%%Page: 72 72
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(72)S
11 R
2393(File:)S
(kernel/mpx386.s)741 2626 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(06470)210 1122 A
(mov)126 1776 A
(fs,)126 2112 A
2280(ax)S
1845 V
(06471)210 1122 A
(mov)126 1776 A
(gs,)126 2112 A
2280(ax)S
1935 V
(06472)210 1122 A
(mov)126 1776 A
(ss,)126 2112 A
2280(ax)S
2025 V
(06473)210 1122 A
(mov)126 1776 A
(esp,)168 2112 A
(k_stktop)336 2322 A
2784(!)S
(set)126 2868 A
3036(sp)S
3162(to)S
(point)210 3288 A
3540(to)S
(the)126 3666 A
(top)126 3834 A
4002(of)S
(kernel)252 4128 A
(stack)210 4422 A
2115 V
(06474)210 1122 A
2205 V
(06475)210 1122 A
1440(!)S
(Call)168 1524 A
1734(C)S
(startup)294 1818 A
(code)168 2154 A
2364(to)S
(set)126 2490 A
2658(up)S
2784(a)S
(proper)252 2868 A
(environment)462 3162 A
3666(to)S
(run)126 3792 A
(main\(\).)294 3960 A
2295 V
(06476)210 1122 A
(push)168 1776 A
(edx)126 2112 A
2385 V
(06477)210 1122 A
(push)168 1776 A
(ebx)126 2112 A
2475 V
(06478)210 1122 A
(push)168 1776 A
(SS_SELECTOR)462 2112 A
2565 V
(06479)210 1122 A
(push)168 1776 A
(DS_SELECTOR)462 2112 A
2655 V
(06480)210 1122 A
(push)168 1776 A
(CS_SELECTOR)462 2112 A
2745 V
(06481)210 1122 A
(call)168 1776 A
(_cstart)294 2112 A
2784(!)S
(cstart\(cs,)420 2868 A
(ds,)126 3330 A
(mds,)168 3498 A
(parmoff,)336 3708 A
(parmlen\))336 4086 A
2835 V
(06482)210 1122 A
(add)126 1776 A
(esp,)168 2112 A
(5*4)126 2322 A
2925 V
(06483)210 1122 A
3015 V
(06484)210 1122 A
1440(!)S
(Reload)252 1524 A
(gdtr,)210 1818 A
(idtr)168 2070 A
(and)126 2280 A
(the)126 2448 A
(segment)294 2616 A
(registers)378 2952 A
3372(to)S
(global)252 3498 A
(descriptor)420 3792 A
(table)210 4254 A
(set)126 4506 A
3105 V
(06485)210 1122 A
1440(!)S
1524(up)S
1650(by)S
(prot_init\(\).)504 1776 A
3195 V
(06486)210 1122 A
3285 V
(06487)210 1122 A
(lgdt)168 1776 A
(\(_gdt+GDT_SELECTOR\))798 2112 A
3375 V
(06488)210 1122 A
(lidt)168 1776 A
(\(_gdt+IDT_SELECTOR\))798 2112 A
3465 V
(06489)210 1122 A
3555 V
(06490)210 1122 A
(jmpf)168 1776 A
(CS_SELECTOR:csinit)756 2112 A
3645 V
(06491)210 1122 A
(csinit:)294 1440 A
3735 V
(06492)210 1122 A
(o16)126 1608 A
(mov)126 1776 A
(ax,)126 2112 A
(DS_SELECTOR)462 2280 A
3825 V
(06493)210 1122 A
(mov)126 1776 A
(ds,)126 2112 A
2280(ax)S
3915 V
(06494)210 1122 A
(mov)126 1776 A
(es,)126 2112 A
2280(ax)S
4005 V
(06495)210 1122 A
(mov)126 1776 A
(fs,)126 2112 A
2280(ax)S
4095 V
(06496)210 1122 A
(mov)126 1776 A
(gs,)126 2112 A
2280(ax)S
4185 V
(06497)210 1122 A
(mov)126 1776 A
(ss,)126 2112 A
2280(ax)S
4275 V
(06498)210 1122 A
(o16)126 1608 A
(mov)126 1776 A
(ax,)126 2112 A
(TSS_SELECTOR)504 2280 A
3120(!)S
3204(no)S
(other)210 3330 A
(TSS)126 3582 A
3750(is)S
(used)168 3876 A
4365 V
(06499)210 1122 A
(ltr)126 1776 A
2112(ax)S
4455 V
(06500)210 1122 A
(push)168 1776 A
2112(0)S
3120(!)S
(set)126 3204 A
(flags)210 3372 A
3624(to)S
(known)210 3750 A
(good)168 4002 A
(state)210 4212 A
4545 V
(06501)210 1122 A
(popf)168 1776 A
3120(!)S
(esp,)168 3204 A
(clear)210 3414 A
(nested)252 3666 A
(task)168 3960 A
(and)126 4170 A
(int)126 4338 A
(enable)252 4506 A
4635 V
(06502)210 1122 A
4725 V
(06503)210 1122 A
(jmp)126 1776 A
(_main)210 2112 A
3120(!)S
(main\(\))252 3204 A
4815 V
(06504)210 1122 A
4905 V
(06505)210 1122 A
4995 V
(06506)210 1122 A
(!*===========================================================================*)3276 1440 A
5085 V
(06507)210 1122 A
1440(!*)S
(interrupt)378 2784 A
(handlers)336 3204 A
4674(*)S
5175 V
(06508)210 1122 A
1440(!*)S
(interrupt)378 2112 A
(handlers)336 2532 A
(for)126 2910 A
(386)126 3078 A
(32-bit)252 3246 A
(protected)378 3540 A
(mode)168 3960 A
4674(*)S
5265 V
(06509)210 1122 A
(!*===========================================================================*)3276 1440 A
5355 V
(06510)210 1122 A
5445 V
(06511)210 1122 A
(!*===========================================================================*)3276 1440 A
5535 V
(06512)210 1122 A
1440(!*)S
(hwint00)294 2784 A
3120(-)S
3204(07)S
4674(*)S
5625 V
(06513)210 1122 A
(!*===========================================================================*)3276 1440 A
5715 V
(06514)210 1122 A
1440(!)S
(Note)168 1524 A
(this)168 1734 A
1944(is)S
2070(a)S
(macro,)252 2154 A
2448(it)S
(just)168 2574 A
(looks)210 2784 A
(like)168 3036 A
3246(a)S
(subroutine.)462 3330 A
5805 V
(06515)210 1122 A
(#define)294 1440 A
(hwint_master\(irq\))714 1776 A
2784(\\)S
5895 V
(06516)210 1122 A
(call)168 1776 A
(save)168 2112 A
3120(/*)S
(save)168 3246 A
(interrupted)462 3456 A
(process)294 3960 A
(state)210 4296 A
(*/;\\)168 4548 A
5985 V
(06517)210 1122 A
(push)168 1776 A
(\(_irq_handlers+4*irq\))882 2112 A
3120(/*)S
(irq_handlers[irq])714 3246 A
(*/;\\)168 4548 A
6075 V
(06518)210 1122 A
(call)168 1776 A
(_intr_handle)504 2112 A
3120(/*)S
(intr_handle\(irq_handlers[irq]\))1260 3246 A
(*/;\\)168 4548 A
6165 V
(06519)210 1122 A
(pop)126 1776 A
(ecx)126 2112 A
4632(;\\)S
6255 V
(06520)210 1122 A
(cmp)126 1776 A
(\(_irq_actids+4*irq\),)840 2112 A
2994(0)S
3120(/*)S
(interrupt)378 3246 A
(still)210 3666 A
(active?)294 3918 A
(*/;\\)168 4548 A
6345 V
(06521)210 1122 A
1776(jz)S
2112(0f)S
4632(;\\)S
6435 V
(06522)210 1122 A
(inb)126 1776 A
(INT_CTLMASK)462 2112 A
3120(/*)S
(get)126 3246 A
(current)294 3414 A
(mask)168 3750 A
3960(*/)S
4632(;\\)S
6525 V
(06523)210 1122 A
(orb)126 1776 A
(al,)126 2112 A
([1<<irq])336 2280 A
3120(/*)S
(mask)168 3246 A
(irq)126 3456 A
3624(*/)S
4632(;\\)S
6615 V
(06524)210 1122 A
(outb)168 1776 A
(INT_CTLMASK)462 2112 A
3120(/*)S
(disable)294 3246 A
(the)126 3582 A
(irq)126 3750 A
(*/;\\)168 4548 A
6705 V
(06525)210 1122 A
1440(0:)S
(movb)168 1776 A
(al,)126 2112 A
(END_OF_INT)420 2280 A
4632(;\\)S
6795 V
(06526)210 1122 A
(outb)168 1776 A
(INT_CTL)294 2112 A
3120(/*)S
(reenable)336 3246 A
(master)252 3624 A
(8259)168 3918 A
(*/;\\)168 4548 A
6885 V
(06527)210 1122 A
(ret)126 1776 A
3120(/*)S
(restart)294 3246 A
(\(another\))378 3582 A
(process)294 4002 A
4548(*/)S
6975 V
(06528)210 1122 A
7065 V
(06529)210 1122 A
1440(!)S
(Each)168 1524 A
1734(of)S
(these)210 1860 A
(entry)210 2112 A
(points)252 2364 A
2658(is)S
2784(an)S
(expansion)378 2910 A
3330(of)S
(the)126 3456 A
(hwint_master)504 3624 A
(macro)210 4170 A
8418 V
EP
%%Page: 73 73
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2393(File:)S
(kernel/mpx386.s)741 2626 A
12 B
4560(73)S
1755 V
7 LST
(06530)210 1122 A
(.align)252 1776 A
2112(16)S
1845 V
(06531)210 1122 A
(_hwint00:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(0)S
(\(the)168 3708 A
(clock\).)294 3918 A
1935 V
(06532)210 1122 A
(hwint_master\(0\))630 1776 A
2025 V
(06533)210 1122 A
2115 V
(06534)210 1122 A
(.align)252 1776 A
2112(16)S
2205 V
(06535)210 1122 A
(_hwint01:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(1)S
(\(keyboard\))420 3708 A
2295 V
(06536)210 1122 A
(hwint_master\(1\))630 1776 A
2385 V
(06537)210 1122 A
2475 V
(06538)210 1122 A
(.align)252 1776 A
2112(16)S
2565 V
(06539)210 1122 A
(_hwint02:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(2)S
(\(cascade!\))420 3708 A
2655 V
(06540)210 1122 A
(hwint_master\(2\))630 1776 A
2745 V
(06541)210 1122 A
2835 V
(06542)210 1122 A
(.align)252 1776 A
2112(16)S
2925 V
(06543)210 1122 A
(_hwint03:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(3)S
(\(second)294 3708 A
(serial\))294 4044 A
3015 V
(06544)210 1122 A
(hwint_master\(3\))630 1776 A
3105 V
(06545)210 1122 A
3195 V
(06546)210 1122 A
(.align)252 1776 A
2112(16)S
3285 V
(06547)210 1122 A
(_hwint04:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(4)S
(\(first)252 3708 A
(serial\))294 4002 A
3375 V
(06548)210 1122 A
(hwint_master\(4\))630 1776 A
3465 V
(06549)210 1122 A
3555 V
(06550)210 1122 A
(.align)252 1776 A
2112(16)S
3645 V
(06551)210 1122 A
(_hwint05:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(5)S
(\(XT)126 3708 A
(winchester\))462 3876 A
3735 V
(06552)210 1122 A
(hwint_master\(5\))630 1776 A
3825 V
(06553)210 1122 A
3915 V
(06554)210 1122 A
(.align)252 1776 A
2112(16)S
4005 V
(06555)210 1122 A
(_hwint06:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(6)S
(\(floppy\))336 3708 A
4095 V
(06556)210 1122 A
(hwint_master\(6\))630 1776 A
4185 V
(06557)210 1122 A
4275 V
(06558)210 1122 A
(.align)252 1776 A
2112(16)S
4365 V
(06559)210 1122 A
(_hwint07:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(7)S
(\(printer\))378 3708 A
4455 V
(06560)210 1122 A
(hwint_master\(7\))630 1776 A
4545 V
(06561)210 1122 A
4635 V
(06562)210 1122 A
(!*===========================================================================*)3276 1440 A
4725 V
(06563)210 1122 A
1440(!*)S
(hwint08)294 2784 A
3120(-)S
3204(15)S
4674(*)S
4815 V
(06564)210 1122 A
(!*===========================================================================*)3276 1440 A
4905 V
(06565)210 1122 A
1440(!)S
(Note)168 1524 A
(this)168 1734 A
1944(is)S
2070(a)S
(macro,)252 2154 A
2448(it)S
(just)168 2574 A
(looks)210 2784 A
(like)168 3036 A
3246(a)S
(subroutine.)462 3330 A
4995 V
(06566)210 1122 A
(#define)294 1440 A
(hwint_slave\(irq\))672 1776 A
2784(\\)S
5085 V
(06567)210 1122 A
(call)168 1776 A
(save)168 2112 A
3120(/*)S
(save)168 3246 A
(interrupted)462 3456 A
(process)294 3960 A
(state)210 4296 A
(*/;\\)168 4548 A
5175 V
(06568)210 1122 A
(push)168 1776 A
(\(_irq_handlers+4*irq\))882 2112 A
3120(/*)S
(irq_handlers[irq])714 3246 A
(*/;\\)168 4548 A
5265 V
(06569)210 1122 A
(call)168 1776 A
(_intr_handle)504 2112 A
3120(/*)S
(intr_handle\(irq_handlers[irq]\))1260 3246 A
(*/;\\)168 4548 A
5355 V
(06570)210 1122 A
(pop)126 1776 A
(ecx)126 2112 A
4632(;\\)S
5445 V
(06571)210 1122 A
(cmp)126 1776 A
(\(_irq_actids+4*irq\),)840 2112 A
2994(0)S
3120(/*)S
(interrupt)378 3246 A
(still)210 3666 A
(active?)294 3918 A
(*/;\\)168 4548 A
5535 V
(06572)210 1122 A
1776(jz)S
2112(0f)S
4632(;\\)S
5625 V
(06573)210 1122 A
(inb)126 1776 A
(INT2_CTLMASK)504 2112 A
4632(;\\)S
5715 V
(06574)210 1122 A
(orb)126 1776 A
(al,)126 2112 A
([1<<[irq-8]])504 2280 A
4632(;\\)S
5805 V
(06575)210 1122 A
(outb)168 1776 A
(INT2_CTLMASK)504 2112 A
3120(/*)S
(disable)294 3246 A
(the)126 3582 A
(irq)126 3750 A
(*/;\\)168 4548 A
5895 V
(06576)210 1122 A
1440(0:)S
(movb)168 1776 A
(al,)126 2112 A
(END_OF_INT)420 2280 A
4632(;\\)S
5985 V
(06577)210 1122 A
(outb)168 1776 A
(INT_CTL)294 2112 A
3120(/*)S
(reenable)336 3246 A
(master)252 3624 A
(8259)168 3918 A
(*/;\\)168 4548 A
6075 V
(06578)210 1122 A
(outb)168 1776 A
(INT2_CTL)336 2112 A
3120(/*)S
(reenable)336 3246 A
(slave)210 3624 A
(8259)168 3876 A
(*/;\\)168 4548 A
6165 V
(06579)210 1122 A
(ret)126 1776 A
3120(/*)S
(restart)294 3246 A
(\(another\))378 3582 A
(process)294 4002 A
4548(*/)S
6255 V
(06580)210 1122 A
6345 V
(06581)210 1122 A
1440(!)S
(Each)168 1524 A
1734(of)S
(these)210 1860 A
(entry)210 2112 A
(points)252 2364 A
2658(is)S
2784(an)S
(expansion)378 2910 A
3330(of)S
(the)126 3456 A
(hwint_slave)462 3624 A
(macro)210 4128 A
6435 V
(06582)210 1122 A
(.align)252 1776 A
2112(16)S
6525 V
(06583)210 1122 A
(_hwint08:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(8)S
(\(realtime)378 3708 A
(clock\))252 4128 A
6615 V
(06584)210 1122 A
(hwint_slave\(8\))588 1776 A
6705 V
(06585)210 1122 A
6795 V
(06586)210 1122 A
(.align)252 1776 A
2112(16)S
6885 V
(06587)210 1122 A
(_hwint09:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(9)S
(\(irq)168 3708 A
3918(2)S
(redirected\))462 4002 A
6975 V
(06588)210 1122 A
(hwint_slave\(9\))588 1776 A
7065 V
(06589)210 1122 A
8418 V
EP
%%Page: 74 74
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(74)S
11 R
2393(File:)S
(kernel/mpx386.s)741 2626 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(06590)210 1122 A
(.align)252 1776 A
2112(16)S
1845 V
(06591)210 1122 A
(_hwint10:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(10)S
1935 V
(06592)210 1122 A
(hwint_slave\(10\))630 1776 A
2025 V
(06593)210 1122 A
2115 V
(06594)210 1122 A
(.align)252 1776 A
2112(16)S
2205 V
(06595)210 1122 A
(_hwint11:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(11)S
2295 V
(06596)210 1122 A
(hwint_slave\(11\))630 1776 A
2385 V
(06597)210 1122 A
2475 V
(06598)210 1122 A
(.align)252 1776 A
2112(16)S
2565 V
(06599)210 1122 A
(_hwint12:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(12)S
2655 V
(06600)210 1122 A
(hwint_slave\(12\))630 1776 A
2745 V
(06601)210 1122 A
2835 V
(06602)210 1122 A
(.align)252 1776 A
2112(16)S
2925 V
(06603)210 1122 A
(_hwint13:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(13)S
(\(FPU)168 3750 A
(exception\))420 3960 A
3015 V
(06604)210 1122 A
(hwint_slave\(13\))630 1776 A
3105 V
(06605)210 1122 A
3195 V
(06606)210 1122 A
(.align)252 1776 A
2112(16)S
3285 V
(06607)210 1122 A
(_hwint14:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(14)S
(\(AT)126 3750 A
(winchester\))462 3918 A
3375 V
(06608)210 1122 A
(hwint_slave\(14\))630 1776 A
3465 V
(06609)210 1122 A
3555 V
(06610)210 1122 A
(.align)252 1776 A
2112(16)S
3645 V
(06611)210 1122 A
(_hwint15:)378 1440 A
2448(!)S
(Interrupt)378 2532 A
(routine)294 2952 A
(for)126 3288 A
(irq)126 3456 A
3624(15)S
3735 V
(06612)210 1122 A
(hwint_slave\(15\))630 1776 A
3825 V
(06613)210 1122 A
3915 V
(06614)210 1122 A
(!*===========================================================================*)3276 1440 A
4005 V
(06615)210 1122 A
1440(!*)S
(save)168 2784 A
4674(*)S
4095 V
(06616)210 1122 A
(!*===========================================================================*)3276 1440 A
4185 V
(06617)210 1122 A
1440(!)S
(Save)168 1524 A
(for)126 1734 A
(protected)378 1902 A
(mode.)210 2322 A
4275 V
(06618)210 1122 A
1440(!)S
(This)168 1524 A
1734(is)S
(much)168 1860 A
(simpler)294 2070 A
(than)168 2406 A
(for)126 2616 A
(8086)168 2784 A
(mode,)210 2994 A
(because)294 3246 A
(the)126 3582 A
(stack)210 3750 A
(already)294 4002 A
(points)252 4338 A
4365 V
(06619)210 1122 A
1440(!)S
(into)168 1524 A
(the)126 1734 A
(process)294 1902 A
(table,)252 2238 A
2532(or)S
(has)126 2658 A
(already)294 2826 A
(been)168 3162 A
(switched)336 3372 A
3750(to)S
(the)126 3876 A
(kernel)252 4044 A
(stack.)252 4338 A
4455 V
(06620)210 1122 A
4545 V
(06621)210 1122 A
(.align)252 1776 A
2112(16)S
4635 V
(06622)210 1122 A
(save:)210 1440 A
4725 V
(06623)210 1122 A
(cld)126 1776 A
2784(!)S
(set)126 2868 A
(direction)378 3036 A
(flag)168 3456 A
3666(to)S
3792(a)S
(known)210 3876 A
(value)210 4128 A
4815 V
(06624)210 1122 A
(pushad)252 1776 A
2784(!)S
(save)168 2868 A
("general")378 3078 A
(registers)378 3498 A
4905 V
(06625)210 1122 A
(o16)126 1608 A
(push)168 1776 A
2112(ds)S
2784(!)S
(save)168 2868 A
3078(ds)S
4995 V
(06626)210 1122 A
(o16)126 1608 A
(push)168 1776 A
2112(es)S
2784(!)S
(save)168 2868 A
3078(es)S
5085 V
(06627)210 1122 A
(o16)126 1608 A
(push)168 1776 A
2112(fs)S
2784(!)S
(save)168 2868 A
3078(fs)S
5175 V
(06628)210 1122 A
(o16)126 1608 A
(push)168 1776 A
2112(gs)S
2784(!)S
(save)168 2868 A
3078(gs)S
5265 V
(06629)210 1122 A
(mov)126 1776 A
(dx,)126 2112 A
2280(ss)S
2784(!)S
2868(ss)S
2994(is)S
(kernel)252 3120 A
(data)168 3414 A
(segment)294 3624 A
5355 V
(06630)210 1122 A
(mov)126 1776 A
(ds,)126 2112 A
2280(dx)S
2784(!)S
(load)168 2868 A
(rest)168 3078 A
3288(of)S
(kernel)252 3414 A
(segments)336 3708 A
5445 V
(06631)210 1122 A
(mov)126 1776 A
(es,)126 2112 A
2280(dx)S
2784(!)S
(kernel)252 2868 A
(does)168 3162 A
(not)126 3372 A
(use)126 3540 A
(fs,)126 3708 A
3876(gs)S
5535 V
(06632)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(esp)126 2322 A
2784(!)S
(prepare)294 2868 A
3204(to)S
(return)252 3330 A
5625 V
(06633)210 1122 A
(incb)168 1776 A
(\(_k_reenter\))504 2112 A
2784(!)S
(from)168 2868 A
3078(-1)S
3204(if)S
(not)126 3330 A
(reentering)420 3498 A
5715 V
(06634)210 1122 A
(jnz)126 1776 A
(set_restart1)504 2112 A
2784(!)S
(stack)210 2868 A
3120(is)S
(already)294 3246 A
(kernel)252 3582 A
(stack)210 3876 A
5805 V
(06635)210 1122 A
(mov)126 1776 A
(esp,)168 2112 A
(k_stktop)336 2322 A
5895 V
(06636)210 1122 A
(push)168 1776 A
(_restart)336 2112 A
2784(!)S
(build)210 2868 A
(return)252 3120 A
(address)294 3414 A
(for)126 3750 A
(int)126 3918 A
(handler)294 4086 A
5985 V
(06637)210 1122 A
(xor)126 1776 A
(ebp,)168 2112 A
(ebp)126 2322 A
2784(!)S
(for)126 2868 A
(stacktrace)420 3036 A
6075 V
(06638)210 1122 A
(jmp)126 1776 A
(RETADR-P_STACKBASE\(eax\))966 2112 A
6165 V
(06639)210 1122 A
6255 V
(06640)210 1122 A
(.align)252 1776 A
2112(4)S
6345 V
(06641)210 1122 A
(set_restart1:)546 1440 A
6435 V
(06642)210 1122 A
(push)168 1776 A
(restart1)336 2112 A
6525 V
(06643)210 1122 A
(jmp)126 1776 A
(RETADR-P_STACKBASE\(eax\))966 2112 A
6615 V
(06644)210 1122 A
6705 V
(06645)210 1122 A
(!*===========================================================================*)3276 1440 A
6795 V
(06646)210 1122 A
1440(!*)S
(_s_call)294 2784 A
4674(*)S
6885 V
(06647)210 1122 A
(!*===========================================================================*)3276 1440 A
6975 V
(06648)210 1122 A
(.align)252 1776 A
2112(16)S
7065 V
(06649)210 1122 A
(_s_call:)336 1440 A
8418 V
EP
%%Page: 75 75
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2393(File:)S
(kernel/mpx386.s)741 2626 A
12 B
4560(75)S
1755 V
7 LST
(06650)210 1122 A
(_p_s_call:)420 1440 A
1845 V
(06651)210 1122 A
(cld)126 1776 A
2784(!)S
(set)126 2868 A
(direction)378 3036 A
(flag)168 3456 A
3666(to)S
3792(a)S
(known)210 3876 A
(value)210 4128 A
1935 V
(06652)210 1122 A
(sub)126 1776 A
(esp,)168 2112 A
(6*4)126 2322 A
2784(!)S
(skip)168 2868 A
(RETADR,)294 3078 A
(eax,)168 3414 A
(ecx,)168 3624 A
(edx,)168 3834 A
(ebx,)168 4044 A
(est)126 4254 A
2025 V
(06653)210 1122 A
(push)168 1776 A
(ebp)126 2112 A
2784(!)S
(stack)210 2868 A
(already)294 3120 A
(points)252 3456 A
(into)168 3750 A
(proc)168 3960 A
(table)210 4170 A
2115 V
(06654)210 1122 A
(push)168 1776 A
(esi)126 2112 A
2205 V
(06655)210 1122 A
(push)168 1776 A
(edi)126 2112 A
2295 V
(06656)210 1122 A
(o16)126 1608 A
(push)168 1776 A
2112(ds)S
2385 V
(06657)210 1122 A
(o16)126 1608 A
(push)168 1776 A
2112(es)S
2475 V
(06658)210 1122 A
(o16)126 1608 A
(push)168 1776 A
2112(fs)S
2565 V
(06659)210 1122 A
(o16)126 1608 A
(push)168 1776 A
2112(gs)S
2655 V
(06660)210 1122 A
(mov)126 1776 A
(dx,)126 2112 A
2280(ss)S
2745 V
(06661)210 1122 A
(mov)126 1776 A
(ds,)126 2112 A
2280(dx)S
2835 V
(06662)210 1122 A
(mov)126 1776 A
(es,)126 2112 A
2280(dx)S
2925 V
(06663)210 1122 A
(incb)168 1776 A
(\(_k_reenter\))504 2112 A
3015 V
(06664)210 1122 A
(mov)126 1776 A
(esi,)168 2112 A
(esp)126 2322 A
2784(!)S
(assumes)294 2868 A
(P_STACKBASE)462 3204 A
3708(==)S
3834(0)S
3105 V
(06665)210 1122 A
(mov)126 1776 A
(esp,)168 2112 A
(k_stktop)336 2322 A
3195 V
(06666)210 1122 A
(xor)126 1776 A
(ebp,)168 2112 A
(ebp)126 2322 A
2784(!)S
(for)126 2868 A
(stacktrace)420 3036 A
3285 V
(06667)210 1122 A
2784(!)S
(end)126 2868 A
3036(of)S
(inline)252 3162 A
(save)168 3456 A
3375 V
(06668)210 1122 A
2784(!)S
(now)126 2868 A
(set)126 3036 A
3204(up)S
(parameters)420 3330 A
(for)126 3792 A
(sys_call\(\))420 3960 A
3465 V
(06669)210 1122 A
(push)168 1776 A
(ebx)126 2112 A
2784(!)S
(pointer)294 2868 A
3204(to)S
(user)168 3330 A
(message)294 3540 A
3555 V
(06670)210 1122 A
(push)168 1776 A
(eax)126 2112 A
2784(!)S
(src/dest)336 2868 A
3645 V
(06671)210 1122 A
(push)168 1776 A
(ecx)126 2112 A
2784(!)S
(SEND/RECEIVE/BOTH)714 2868 A
3735 V
(06672)210 1122 A
(call)168 1776 A
(_sys_call)378 2112 A
2784(!)S
(sys_call\(function,)756 2868 A
(src_dest,)378 3666 A
(m_ptr\))252 4086 A
3825 V
(06673)210 1122 A
2784(!)S
(caller)252 2868 A
3162(is)S
(now)126 3288 A
(explicitly)420 3456 A
3918(in)S
(proc_ptr)336 4044 A
3915 V
(06674)210 1122 A
(mov)126 1776 A
(AXREG\(esi\),)462 2112 A
(eax)126 2616 A
2784(!)S
(sys_call)336 2868 A
(MUST)168 3246 A
(PRESERVE)336 3456 A
3834(si)S
4005 V
(06675)210 1122 A
4095 V
(06676)210 1122 A
1440(!)S
(Fall)168 1524 A
(into)168 1734 A
(code)168 1944 A
2154(to)S
(restart)294 2280 A
(proc/task)378 2616 A
(running.)336 3036 A
4185 V
(06677)210 1122 A
4275 V
(06678)210 1122 A
(!*===========================================================================*)3276 1440 A
4365 V
(06679)210 1122 A
1440(!*)S
(restart)294 2784 A
4674(*)S
4455 V
(06680)210 1122 A
(!*===========================================================================*)3276 1440 A
4545 V
(06681)210 1122 A
(_restart:)378 1440 A
4635 V
(06682)210 1122 A
4725 V
(06683)210 1122 A
1440(!)S
(Restart)294 1524 A
(the)126 1860 A
(current)294 2028 A
(process)294 2364 A
2700(or)S
(the)126 2826 A
(next)168 2994 A
(process)294 3204 A
3540(if)S
3666(it)S
3792(is)S
(set.)168 3918 A
4815 V
(06684)210 1122 A
4905 V
(06685)210 1122 A
(cmp)126 1776 A
(\(_next_ptr\),)504 2112 A
2658(0)S
3120(!)S
(see)126 3204 A
3372(if)S
(another)294 3498 A
(process)294 3834 A
4170(is)S
(scheduled)378 4296 A
4995 V
(06686)210 1122 A
1776(jz)S
2112(0f)S
5085 V
(06687)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(\(_next_ptr\))462 2322 A
5175 V
(06688)210 1122 A
(mov)126 1776 A
(\(_proc_ptr\),)504 2112 A
(eax)126 2658 A
3120(!)S
(schedule)336 3204 A
(new)126 3582 A
(process)294 3750 A
5265 V
(06689)210 1122 A
(mov)126 1776 A
(\(_next_ptr\),)504 2112 A
2658(0)S
5355 V
(06690)210 1122 A
1440(0:)S
(mov)126 1776 A
(esp,)168 2112 A
(\(_proc_ptr\))462 2322 A
3120(!)S
(will)168 3204 A
(assume)252 3414 A
(P_STACKBASE)462 3708 A
4212(==)S
4338(0)S
5445 V
(06691)210 1122 A
(lldt)168 1776 A
(P_LDT_SEL\(esp\))588 2112 A
3120(!)S
(enable)252 3204 A
(process')336 3498 A
(segment)294 3876 A
(descriptors)462 4212 A
5535 V
(06692)210 1122 A
(lea)126 1776 A
(eax,)168 2112 A
(P_STACKTOP\(esp\))630 2322 A
3120(!)S
(arrange)294 3204 A
(for)126 3540 A
(next)168 3708 A
(interrupt)378 3918 A
5625 V
(06693)210 1122 A
(mov)126 1776 A
(\(_tss+TSS3_S_SP0\),)756 2112 A
(eax)126 2910 A
3120(!)S
3204(to)S
(save)168 3330 A
(state)210 3540 A
3792(in)S
(process)294 3918 A
(table)210 4254 A
5715 V
(06694)210 1122 A
(restart1:)378 1440 A
5805 V
(06695)210 1122 A
(decb)168 1776 A
(\(_k_reenter\))504 2112 A
5895 V
(06696)210 1122 A
(o16)126 1608 A
(pop)126 1776 A
2112(gs)S
5985 V
(06697)210 1122 A
(o16)126 1608 A
(pop)126 1776 A
2112(fs)S
6075 V
(06698)210 1122 A
(o16)126 1608 A
(pop)126 1776 A
2112(es)S
6165 V
(06699)210 1122 A
(o16)126 1608 A
(pop)126 1776 A
2112(ds)S
6255 V
(06700)210 1122 A
(popad)210 1776 A
6345 V
(06701)210 1122 A
(add)126 1776 A
(esp,)168 2112 A
2322(4)S
2784(!)S
(skip)168 2868 A
(return)252 3078 A
(adr)126 3372 A
6435 V
(06702)210 1122 A
(iretd)210 1776 A
2784(!)S
(continue)336 2868 A
(process)294 3246 A
6525 V
(06703)210 1122 A
6615 V
(06704)210 1122 A
(!*===========================================================================*)3276 1440 A
6705 V
(06705)210 1122 A
1440(!*)S
(exception)378 2784 A
(handlers)336 3204 A
4674(*)S
6795 V
(06706)210 1122 A
(!*===========================================================================*)3276 1440 A
6885 V
(06707)210 1122 A
(_divide_error:)588 1440 A
6975 V
(06708)210 1122 A
(push)168 1776 A
(DIVIDE_VECTOR)546 2112 A
7065 V
(06709)210 1122 A
(jmp)126 1776 A
(exception)378 2112 A
8418 V
EP
%%Page: 76 76
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(76)S
11 R
2393(File:)S
(kernel/mpx386.s)741 2626 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(06710)210 1122 A
1845 V
(06711)210 1122 A
(_single_step_exception:)966 1440 A
1935 V
(06712)210 1122 A
(push)168 1776 A
(DEBUG_VECTOR)504 2112 A
2025 V
(06713)210 1122 A
(jmp)126 1776 A
(exception)378 2112 A
2115 V
(06714)210 1122 A
2205 V
(06715)210 1122 A
(_nmi:)210 1440 A
2295 V
(06716)210 1122 A
(push)168 1776 A
(NMI_VECTOR)420 2112 A
2385 V
(06717)210 1122 A
(jmp)126 1776 A
(exception)378 2112 A
2475 V
(06718)210 1122 A
2565 V
(06719)210 1122 A
(_breakpoint_exception:)924 1440 A
2655 V
(06720)210 1122 A
(push)168 1776 A
(BREAKPOINT_VECTOR)714 2112 A
2745 V
(06721)210 1122 A
(jmp)126 1776 A
(exception)378 2112 A
2835 V
(06722)210 1122 A
2925 V
(06723)210 1122 A
(_overflow:)420 1440 A
3015 V
(06724)210 1122 A
(push)168 1776 A
(OVERFLOW_VECTOR)630 2112 A
3105 V
(06725)210 1122 A
(jmp)126 1776 A
(exception)378 2112 A
3195 V
(06726)210 1122 A
3285 V
(06727)210 1122 A
(_bounds_check:)588 1440 A
3375 V
(06728)210 1122 A
(push)168 1776 A
(BOUNDS_VECTOR)546 2112 A
3465 V
(06729)210 1122 A
(jmp)126 1776 A
(exception)378 2112 A
3555 V
(06730)210 1122 A
3645 V
(06731)210 1122 A
(_inval_opcode:)588 1440 A
3735 V
(06732)210 1122 A
(push)168 1776 A
(INVAL_OP_VECTOR)630 2112 A
3825 V
(06733)210 1122 A
(jmp)126 1776 A
(exception)378 2112 A
3915 V
(06734)210 1122 A
4005 V
(06735)210 1122 A
(_copr_not_available:)840 1440 A
4095 V
(06736)210 1122 A
(push)168 1776 A
(COPROC_NOT_VECTOR)714 2112 A
4185 V
(06737)210 1122 A
(jmp)126 1776 A
(exception)378 2112 A
4275 V
(06738)210 1122 A
4365 V
(06739)210 1122 A
(_double_fault:)588 1440 A
4455 V
(06740)210 1122 A
(push)168 1776 A
(DOUBLE_FAULT_VECTOR)798 2112 A
4545 V
(06741)210 1122 A
(jmp)126 1776 A
(errexception)504 2112 A
4635 V
(06742)210 1122 A
4725 V
(06743)210 1122 A
(_copr_seg_overrun:)756 1440 A
4815 V
(06744)210 1122 A
(push)168 1776 A
(COPROC_SEG_VECTOR)714 2112 A
4905 V
(06745)210 1122 A
(jmp)126 1776 A
(exception)378 2112 A
4995 V
(06746)210 1122 A
5085 V
(06747)210 1122 A
(_inval_tss:)462 1440 A
5175 V
(06748)210 1122 A
(push)168 1776 A
(INVAL_TSS_VECTOR)672 2112 A
5265 V
(06749)210 1122 A
(jmp)126 1776 A
(errexception)504 2112 A
5355 V
(06750)210 1122 A
5445 V
(06751)210 1122 A
(_segment_not_present:)882 1440 A
5535 V
(06752)210 1122 A
(push)168 1776 A
(SEG_NOT_VECTOR)588 2112 A
5625 V
(06753)210 1122 A
(jmp)126 1776 A
(errexception)504 2112 A
5715 V
(06754)210 1122 A
5805 V
(06755)210 1122 A
(_stack_exception:)714 1440 A
5895 V
(06756)210 1122 A
(push)168 1776 A
(STACK_FAULT_VECTOR)756 2112 A
5985 V
(06757)210 1122 A
(jmp)126 1776 A
(errexception)504 2112 A
6075 V
(06758)210 1122 A
6165 V
(06759)210 1122 A
(_general_protection:)840 1440 A
6255 V
(06760)210 1122 A
(push)168 1776 A
(PROTECTION_VECTOR)714 2112 A
6345 V
(06761)210 1122 A
(jmp)126 1776 A
(errexception)504 2112 A
6435 V
(06762)210 1122 A
6525 V
(06763)210 1122 A
(_page_fault:)504 1440 A
6615 V
(06764)210 1122 A
(push)168 1776 A
(PAGE_FAULT_VECTOR)714 2112 A
6705 V
(06765)210 1122 A
(jmp)126 1776 A
(errexception)504 2112 A
6795 V
(06766)210 1122 A
6885 V
(06767)210 1122 A
(_copr_error:)504 1440 A
6975 V
(06768)210 1122 A
(push)168 1776 A
(COPROC_ERR_VECTOR)714 2112 A
7065 V
(06769)210 1122 A
(jmp)126 1776 A
(exception)378 2112 A
8418 V
EP
%%Page: 77 77
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2393(File:)S
(kernel/mpx386.s)741 2626 A
12 B
4560(77)S
1755 V
7 LST
(06770)210 1122 A
1845 V
(06771)210 1122 A
(!*===========================================================================*)3276 1440 A
1935 V
(06772)210 1122 A
1440(!*)S
(exception)378 2784 A
4674(*)S
2025 V
(06773)210 1122 A
(!*===========================================================================*)3276 1440 A
2115 V
(06774)210 1122 A
1440(!)S
(This)168 1524 A
1734(is)S
(called)252 1860 A
(for)126 2154 A
(all)126 2322 A
(exceptions)420 2490 A
(which)210 2952 A
3204(do)S
(not)126 3330 A
(push)168 3498 A
3708(an)S
(error)210 3834 A
(code.)210 4086 A
2205 V
(06775)210 1122 A
2295 V
(06776)210 1122 A
(.align)252 1776 A
2112(16)S
2385 V
(06777)210 1122 A
(exception:)420 1440 A
2475 V
(06778)210 1122 A
(sseg)168 1482 A
(mov)126 1776 A
(\(trap_errno\),)546 2112 A
2700(0)S
3120(!)S
(clear)210 3204 A
(trap_errno)420 3456 A
2565 V
(06779)210 1122 A
(sseg)168 1482 A
(pop)126 1776 A
(\(ex_number\))462 2112 A
2655 V
(06780)210 1122 A
(jmp)126 1776 A
(exception1)420 2112 A
2745 V
(06781)210 1122 A
2835 V
(06782)210 1122 A
(!*===========================================================================*)3276 1440 A
2925 V
(06783)210 1122 A
1440(!*)S
(errexception)504 2784 A
4674(*)S
3015 V
(06784)210 1122 A
(!*===========================================================================*)3276 1440 A
3105 V
(06785)210 1122 A
1440(!)S
(This)168 1524 A
1734(is)S
(called)252 1860 A
(for)126 2154 A
(all)126 2322 A
(exceptions)420 2490 A
(which)210 2952 A
(push)168 3204 A
3414(an)S
(error)210 3540 A
(code.)210 3792 A
3195 V
(06786)210 1122 A
3285 V
(06787)210 1122 A
(.align)252 1776 A
2112(16)S
3375 V
(06788)210 1122 A
(errexception:)546 1440 A
3465 V
(06789)210 1122 A
(sseg)168 1482 A
(pop)126 1776 A
(\(ex_number\))462 2112 A
3555 V
(06790)210 1122 A
(sseg)168 1482 A
(pop)126 1776 A
(\(trap_errno\))504 2112 A
3645 V
(06791)210 1122 A
(exception1:)462 1440 A
3120(!)S
(Common)252 3204 A
(for)126 3498 A
(all)126 3666 A
(exceptions.)462 3834 A
3735 V
(06792)210 1122 A
(push)168 1776 A
(eax)126 2112 A
3120(!)S
(eax)126 3204 A
3372(is)S
(scratch)294 3498 A
(register)336 3834 A
3825 V
(06793)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(0+4\(esp\))336 2322 A
3120(!)S
(old)126 3204 A
(eip)126 3372 A
3915 V
(06794)210 1122 A
(sseg)168 1482 A
(mov)126 1776 A
(\(old_eip\),)420 2112 A
(eax)126 2574 A
4005 V
(06795)210 1122 A
(movzx)210 1776 A
(eax,)168 2112 A
(4+4\(esp\))336 2322 A
3120(!)S
(old)126 3204 A
3372(cs)S
4095 V
(06796)210 1122 A
(sseg)168 1482 A
(mov)126 1776 A
(\(old_cs\),)378 2112 A
(eax)126 2532 A
4185 V
(06797)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(8+4\(esp\))336 2322 A
3120(!)S
(old)126 3204 A
(eflags)252 3372 A
4275 V
(06798)210 1122 A
(sseg)168 1482 A
(mov)126 1776 A
(\(old_eflags\),)546 2112 A
(eax)126 2700 A
4365 V
(06799)210 1122 A
(pop)126 1776 A
(eax)126 2112 A
4455 V
(06800)210 1122 A
(call)168 1776 A
(save)168 2112 A
4545 V
(06801)210 1122 A
(push)168 1776 A
(\(old_eflags\))504 2112 A
4635 V
(06802)210 1122 A
(push)168 1776 A
(\(old_cs\))336 2112 A
4725 V
(06803)210 1122 A
(push)168 1776 A
(\(old_eip\))378 2112 A
4815 V
(06804)210 1122 A
(push)168 1776 A
(\(trap_errno\))504 2112 A
4905 V
(06805)210 1122 A
(push)168 1776 A
(\(ex_number\))462 2112 A
4995 V
(06806)210 1122 A
(call)168 1776 A
(_exception)420 2112 A
3120(!)S
(\(ex_number,)462 3204 A
(trap_errno,)462 3708 A
(old_eip,)336 4212 A
5085 V
(06807)210 1122 A
3120(!)S
(old_cs,)294 3456 A
(old_eflags\))462 3792 A
5175 V
(06808)210 1122 A
(add)126 1776 A
(esp,)168 2112 A
(5*4)126 2322 A
5265 V
(06809)210 1122 A
(ret)126 1776 A
5355 V
(06810)210 1122 A
5445 V
(06811)210 1122 A
(!*===========================================================================*)3276 1440 A
5535 V
(06812)210 1122 A
1440(!*)S
(level0_call)462 2784 A
4674(*)S
5625 V
(06813)210 1122 A
(!*===========================================================================*)3276 1440 A
5715 V
(06814)210 1122 A
(_level0_call:)546 1440 A
5805 V
(06815)210 1122 A
(call)168 1776 A
(save)168 2112 A
5895 V
(06816)210 1122 A
(jmp)126 1776 A
(\(_level0_func\))588 2112 A
5985 V
(06817)210 1122 A
6075 V
(06818)210 1122 A
(!*===========================================================================*)3276 1440 A
6165 V
(06819)210 1122 A
1440(!*)S
(data)168 2784 A
4674(*)S
6255 V
(06820)210 1122 A
(!*===========================================================================*)3276 1440 A
6345 V
(06821)210 1122 A
6435 V
(06822)210 1122 A
(.sect)210 1440 A
(.rom)168 1692 A
2112(!)S
(Before)252 2196 A
(the)126 2490 A
(string)252 2658 A
(table)210 2952 A
(please)252 3204 A
6525 V
(06823)210 1122 A
(.data2)252 1776 A
(0x526F)252 2112 A
2784(!)S
(this)168 2868 A
(must)168 3078 A
3288(be)S
(the)126 3414 A
(first)210 3582 A
(data)168 3834 A
(entry)210 4044 A
(\(magic)252 4296 A
4590(#\))S
6615 V
(06824)210 1122 A
6705 V
(06825)210 1122 A
(.sect)210 1440 A
(.bss)168 1692 A
6795 V
(06826)210 1122 A
(k_stack:)336 1440 A
6885 V
(06827)210 1122 A
(.space)252 1776 A
(K_STACK_BYTES)546 2112 A
2784(!)S
(kernel)252 2868 A
(stack)210 3162 A
6975 V
(06828)210 1122 A
(k_stktop:)378 1440 A
2784(!)S
(top)126 2868 A
3036(of)S
(kernel)252 3162 A
(stack)210 3456 A
7065 V
(06829)210 1122 A
(.comm)210 1776 A
(ex_number,)420 2112 A
2574(4)S
8418 V
EP
%%Page: 78 78
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(78)S
11 R
2393(File:)S
(kernel/mpx386.s)741 2626 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(06830)210 1122 A
(.comm)210 1776 A
(trap_errno,)462 2112 A
2616(4)S
1845 V
(06831)210 1122 A
(.comm)210 1776 A
(old_eip,)336 2112 A
2490(4)S
1935 V
(06832)210 1122 A
(.comm)210 1776 A
(old_cs,)294 2112 A
2448(4)S
2025 V
(06833)210 1122 A
(.comm)210 1776 A
(old_eflags,)462 2112 A
2616(4)S
2295 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2385 V
(kernel/start.c)588 2676 A
2475 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2655 V
(06900)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
2532(C)S
(startup)294 2616 A
(code)168 2952 A
(for)126 3162 A
(Minix)210 3330 A
3582(on)S
(Intel)210 3708 A
(processors.)462 3960 A
2745 V
(06901)210 1122 A
1482(*)S
1566(It)S
(cooperates)420 1692 A
(with)168 2154 A
(mpx.s)210 2364 A
2616(to)S
(set)126 2742 A
2910(up)S
3036(a)S
(good)168 3120 A
(environment)462 3330 A
(for)126 3834 A
(main\(\).)294 4002 A
2835 V
(06902)210 1122 A
1482(*)S
2925 V
(06903)210 1122 A
1482(*)S
(This)168 1566 A
(code)168 1776 A
(runs)168 1986 A
2196(in)S
(real)168 2322 A
(mode)168 2532 A
(for)126 2742 A
2910(a)S
2994(16)S
(bit)126 3120 A
(kernel)252 3288 A
(and)126 3582 A
(may)126 3750 A
(have)168 3918 A
4128(to)S
(switch)252 4254 A
3015 V
(06904)210 1122 A
1482(*)S
1566(to)S
(protected)378 1692 A
(mode)168 2112 A
(for)126 2322 A
2490(a)S
(286.)168 2574 A
3105 V
(06905)210 1122 A
1482(*)S
(For)126 1566 A
1734(a)S
1818(32)S
(bit)126 1944 A
(kernel)252 2112 A
(this)168 2406 A
(already)294 2616 A
(runs)168 2952 A
3162(in)S
(protected)378 3288 A
(mode,)210 3708 A
(but)126 3960 A
(the)126 4128 A
(selectors)378 4296 A
3195 V
(06906)210 1122 A
1482(*)S
(are)126 1566 A
(still)210 1734 A
(those)210 1986 A
(given)210 2238 A
2490(by)S
(the)126 2616 A
(BIOS)168 2784 A
(with)168 2994 A
(interrupts)420 3204 A
(disabled,)378 3666 A
4086(so)S
(the)126 4212 A
3285 V
(06907)210 1122 A
1482(*)S
(descriptors)462 1566 A
(need)168 2070 A
2280(to)S
2406(be)S
(reloaded)336 2532 A
(and)126 2910 A
(interrupt)378 3078 A
(descriptors)462 3498 A
(made.)210 4002 A
3375 V
(06908)210 1122 A
1482(*/)S
3465 V
(06909)210 1122 A
3555 V
(06910)210 1122 A
(#include)336 1440 A
("kernel.h")420 1818 A
3645 V
(06911)210 1122 A
(#include)336 1440 A
("protect.h")462 1818 A
3735 V
(06912)210 1122 A
(#include)336 1440 A
("proc.h")336 1818 A
3825 V
(06913)210 1122 A
(#include)336 1440 A
(<stdlib.h>)420 1818 A
3915 V
(06914)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
4005 V
(06915)210 1122 A
4095 V
(06916)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(char)168 2280 A
(*get_value,)462 2490 A
(\(_CONST)294 2994 A
(char)168 3330 A
(*params,)336 3540 A
(_CONST)252 3918 A
(char)168 4212 A
(*key\)\);)294 4422 A
4185 V
(06917)210 1122 A
(/*===========================================================================*)3276 1440 A
4275 V
(06918)210 1122 A
1482(*)S
(cstart)252 2784 A
4674(*)S
4365 V
(06919)210 1122 A
(*===========================================================================*/)3276 1482 A
4455 V
(06920)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(cstart\(cs,)420 1944 A
(ds,)126 2406 A
(mds,)168 2574 A
(parmoff,)336 2784 A
(parmsize\))378 3162 A
4545 V
(06921)210 1122 A
(U16_t)210 1440 A
(cs,)126 1692 A
(ds;)126 1860 A
2784(/*)S
(kernel)252 2910 A
(code)168 3204 A
(and)126 3414 A
(data)168 3582 A
(segment)294 3792 A
4128(*/)S
4635 V
(06922)210 1122 A
(U16_t)210 1440 A
(mds;)168 1692 A
2784(/*)S
(monitor)294 2910 A
(data)168 3246 A
(segment)294 3456 A
3792(*/)S
4725 V
(06923)210 1122 A
(U16_t)210 1440 A
(parmoff,)336 1692 A
(parmsize;)378 2070 A
2784(/*)S
(boot)168 2910 A
(parameters)420 3120 A
(offset)252 3582 A
(and)126 3876 A
(length)252 4044 A
4338(*/)S
4815 V
(06924)210 1122 A
1440({)S
4905 V
(06925)210 1122 A
1440(/*)S
(Perform)294 1566 A
(system)252 1902 A
(initializations)630 2196 A
(prior)210 2868 A
3120(to)S
(calling)294 3246 A
(main\(\).)294 3582 A
(Most)168 3918 A
(settings)336 4128 A
(are)126 4506 A
4995 V
(06926)210 1122 A
1482(*)S
(determined)420 1566 A
(with)168 2028 A
(help)168 2238 A
2448(of)S
(the)126 2574 A
(environment)462 2742 A
(strings)294 3246 A
(passed)252 3582 A
3876(by)S
(MINIX')252 4002 A
(loader.)294 4296 A
5085 V
(06927)210 1122 A
1482(*/)S
5175 V
(06928)210 1122 A
(char)168 1524 A
(params[128*sizeof\(char)924 1734 A
(*\)];)168 2700 A
3456(/*)S
(boot)168 3582 A
(monitor)294 3792 A
(parameters)420 4128 A
4590(*/)S
5265 V
(06929)210 1122 A
(register)336 1524 A
(char)168 1902 A
(*value;)294 2112 A
3456(/*)S
(value)210 3582 A
3834(in)S
(key=value)378 3960 A
(pair)168 4380 A
4590(*/)S
5355 V
(06930)210 1122 A
(extern)252 1524 A
(int)126 1818 A
(etext,)252 1986 A
(end;)168 2280 A
5445 V
(06931)210 1122 A
5535 V
(06932)210 1122 A
1524(/*)S
(Decide)252 1650 A
1944(if)S
(mode)168 2070 A
2280(is)S
(protected;)420 2406 A
(386)126 2868 A
3036(or)S
(higher)252 3162 A
(implies)294 3456 A
(protected)378 3792 A
(mode.)210 4212 A
5625 V
(06933)210 1122 A
1566(*)S
(This)168 1650 A
(must)168 1860 A
2070(be)S
(done)168 2196 A
(first,)252 2406 A
(because)294 2700 A
3036(it)S
3162(is)S
(needed)252 3288 A
(for,)168 3582 A
(e.g.,)210 3792 A
(seg2phys\(\).)462 4044 A
5715 V
(06934)210 1122 A
1566(*)S
(For)126 1650 A
(286)126 1818 A
(machines)336 1986 A
2364(we)S
(cannot)252 2490 A
(decide)252 2784 A
3078(on)S
(protected)378 3204 A
(mode,)210 3624 A
(yet.)168 3876 A
(This)168 4086 A
4296(is)S
5805 V
(06935)210 1122 A
1566(*)S
(done)168 1650 A
(below.)252 1860 A
5895 V
(06936)210 1122 A
1566(*/)S
5985 V
(06937)210 1122 A
(#if)126 1440 A
(_WORD_SIZE)420 1608 A
2070(!=)S
2196(2)S
6075 V
(06938)210 1122 A
(machine.protected)714 1524 A
2280(=)S
2364(1;)S
6165 V
(06939)210 1122 A
(#endif)252 1440 A
6255 V
(06940)210 1122 A
6345 V
(06941)210 1122 A
1524(/*)S
(Record)252 1650 A
(where)210 1944 A
(the)126 2196 A
(kernel)252 2364 A
(and)126 2658 A
(the)126 2826 A
(monitor)294 2994 A
(are.)168 3330 A
3540(*/)S
6435 V
(06942)210 1122 A
(kinfo.code_base)630 1524 A
2196(=)S
(seg2phys\(cs\);)546 2280 A
6525 V
(06943)210 1122 A
(kinfo.code_size)630 1524 A
2196(=)S
(\(phys_bytes\))504 2280 A
(&etext;)294 2826 A
3456(/*)S
(size)168 3582 A
3792(of)S
(code)168 3918 A
(segment)294 4128 A
4464(*/)S
6615 V
(06944)210 1122 A
(kinfo.data_base)630 1524 A
2196(=)S
(seg2phys\(ds\);)546 2280 A
6705 V
(06945)210 1122 A
(kinfo.data_size)630 1524 A
2196(=)S
(\(phys_bytes\))504 2280 A
(&end;)210 2826 A
3456(/*)S
(size)168 3582 A
3792(of)S
(data)168 3918 A
(segment)294 4128 A
4464(*/)S
6795 V
(06946)210 1122 A
6885 V
(06947)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(protected)378 2112 A
(mode)168 2532 A
(descriptors.)504 2742 A
3288(*/)S
6975 V
(06948)210 1122 A
(prot_init\(\);)504 1524 A
7065 V
(06949)210 1122 A
8418 V
EP
%%Page: 79 79
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2474(File:)S
2707(kernel/start.c)S
12 B
4560(79)S
1755 V
7 LST
(06950)210 1122 A
1524(/*)S
(Copy)168 1650 A
(the)126 1860 A
(boot)168 2028 A
(parameters)420 2238 A
2700(to)S
(the)126 2826 A
(local)210 2994 A
(buffer.)294 3246 A
3582(*/)S
1845 V
(06951)210 1122 A
(kinfo.params_base)714 1524 A
2280(=)S
(seg2phys\(mds\))546 2364 A
2952(+)S
(parmoff;)336 3036 A
1935 V
(06952)210 1122 A
(kinfo.params_size)714 1524 A
2280(=)S
(MIN\(parmsize,sizeof\(params\)-2\);)1302 2364 A
2025 V
(06953)210 1122 A
(phys_copy\(kinfo.params_base,)1176 1524 A
(vir2phys\(params\),)714 2742 A
(kinfo.params_size\);)798 3498 A
2115 V
(06954)210 1122 A
2205 V
(06955)210 1122 A
1524(/*)S
(Record)252 1650 A
(miscellaneous)546 1944 A
(information)462 2532 A
(for)126 3036 A
(user-space)420 3204 A
(servers.)336 3666 A
4044(*/)S
2295 V
(06956)210 1122 A
(kinfo.nr_procs)588 1524 A
2154(=)S
(NR_PROCS;)378 2238 A
2385 V
(06957)210 1122 A
(kinfo.nr_tasks)588 1524 A
2154(=)S
(NR_TASKS;)378 2238 A
2475 V
(06958)210 1122 A
(strncpy\(kinfo.release,)924 1524 A
(OS_RELEASE,)462 2490 A
(sizeof\(kinfo.release\)\);)966 2994 A
2565 V
(06959)210 1122 A
(kinfo.release[sizeof\(kinfo.release\)-1])1596 1524 A
3162(=)S
('\\0';)210 3246 A
2655 V
(06960)210 1122 A
(strncpy\(kinfo.version,)924 1524 A
(OS_VERSION,)462 2490 A
(sizeof\(kinfo.version\)\);)966 2994 A
2745 V
(06961)210 1122 A
(kinfo.version[sizeof\(kinfo.version\)-1])1596 1524 A
3162(=)S
('\\0';)210 3246 A
2835 V
(06962)210 1122 A
(kinfo.proc_addr)630 1524 A
2196(=)S
(\(vir_bytes\))462 2280 A
(proc;)210 2784 A
2925 V
(06963)210 1122 A
(kinfo.kmem_base)630 1524 A
2196(=)S
(vir2phys\(0\);)504 2280 A
3015 V
(06964)210 1122 A
(kinfo.kmem_size)630 1524 A
2196(=)S
(\(phys_bytes\))504 2280 A
(&end;)210 2826 A
3105 V
(06965)210 1122 A
3195 V
(06966)210 1122 A
1524(/*)S
(Processor?)420 1650 A
(86,)126 2154 A
(186,)168 2322 A
(286,)168 2532 A
(386,)168 2742 A
(...)126 2952 A
3285 V
(06967)210 1122 A
1566(*)S
(Decide)252 1650 A
1944(if)S
(mode)168 2070 A
2280(is)S
(protected)378 2406 A
(for)126 2826 A
(older)210 2994 A
(machines.)378 3246 A
3375 V
(06968)210 1122 A
1566(*/)S
3465 V
(06969)210 1122 A
(machine.processor=atoi\(get_value\(params,)1680 1524 A
("processor"\)\);)588 3246 A
3555 V
(06970)210 1122 A
(#if)126 1440 A
(_WORD_SIZE)420 1608 A
2070(==)S
2196(2)S
3645 V
(06971)210 1122 A
(machine.protected)714 1524 A
2280(=)S
(machine.processor)714 2364 A
3120(>=)S
(286;)168 3246 A
3735 V
(06972)210 1122 A
(#endif)252 1440 A
3825 V
(06973)210 1122 A
1524(if)S
1650(\(!)S
(machine.protected\))756 1776 A
(mon_return)420 2574 A
3036(=)S
3120(0;)S
3915 V
(06974)210 1122 A
4005 V
(06975)210 1122 A
1524(/*)S
(XT,)126 1650 A
1818(AT)S
1944(or)S
(MCA)126 2070 A
(bus?)168 2238 A
2448(*/)S
4095 V
(06976)210 1122 A
(value)210 1524 A
1776(=)S
(get_value\(params,)714 1860 A
("bus"\);)294 2616 A
4185 V
(06977)210 1122 A
1524(if)S
(\(value)252 1650 A
1944(==)S
(NIL_PTR)294 2070 A
2406(||)S
(strcmp\(value,)546 2532 A
("at"\))210 3120 A
3372(==)S
3498(0\))S
3624({)S
4275 V
(06978)210 1122 A
(machine.pc_at)546 1692 A
2280(=)S
(TRUE;)210 2364 A
3456(/*)S
(PC-AT)210 3582 A
(compatible)420 3834 A
(hardware)336 4296 A
4674(*/)S
4365 V
(06979)210 1122 A
1524(})S
(else)168 1608 A
1818(if)S
(\(strcmp\(value,)588 1944 A
("mca"\))252 2574 A
2868(==)S
2994(0\))S
3120({)S
4455 V
(06980)210 1122 A
(machine.pc_at)546 1692 A
2280(=)S
(machine.ps_mca)588 2364 A
2994(=)S
(TRUE;)210 3078 A
3456(/*)S
(PS/2)168 3582 A
(with)168 3792 A
(micro)210 4002 A
(channel)294 4254 A
4590(*/)S
4545 V
(06981)210 1122 A
1524(})S
4635 V
(06982)210 1122 A
4725 V
(06983)210 1122 A
1524(/*)S
(Type)168 1650 A
1860(of)S
(VDU:)168 1986 A
2196(*/)S
4815 V
(06984)210 1122 A
(value)210 1524 A
1776(=)S
(get_value\(params,)714 1860 A
("video"\);)378 2616 A
3456(/*)S
(EGA)126 3582 A
3750(or)S
(VGA)126 3876 A
(video)210 4044 A
(unit)168 4296 A
4506(*/)S
4905 V
(06985)210 1122 A
1524(if)S
(\(strcmp\(value,)588 1650 A
("ega"\))252 2280 A
2574(==)S
2700(0\))S
(machine.vdu_ega)630 2826 A
3498(=)S
(TRUE;)210 3582 A
4995 V
(06986)210 1122 A
1524(if)S
(\(strcmp\(value,)588 1650 A
("vga"\))252 2280 A
2574(==)S
2700(0\))S
(machine.vdu_vga)630 2826 A
3498(=)S
(machine.vdu_ega)630 3582 A
4254(=)S
(TRUE;)210 4338 A
5085 V
(06987)210 1122 A
5175 V
(06988)210 1122 A
1524(/*)S
(Return)252 1650 A
1944(to)S
(assembler)378 2070 A
(code)168 2490 A
2700(to)S
(switch)252 2826 A
3120(to)S
(protected)378 3246 A
(mode)168 3666 A
(\(if)126 3876 A
(286\),)210 4044 A
5265 V
(06989)210 1122 A
1566(*)S
(reload)252 1650 A
(selectors)378 1944 A
(and)126 2364 A
(call)168 2532 A
(main\(\).)294 2742 A
5355 V
(06990)210 1122 A
1566(*/)S
5445 V
(06991)210 1122 A
1440(})S
5625 V
(06993)210 1122 A
(/*===========================================================================*)3276 1440 A
5715 V
(06994)210 1122 A
1482(*)S
(get_value)378 2784 A
4674(*)S
5805 V
(06995)210 1122 A
(*===========================================================================*/)3276 1482 A
5895 V
(06996)210 1122 A
5985 V
(06997)210 1122 A
(PRIVATE)294 1440 A
(char)168 1776 A
(*get_value\(params,)756 1986 A
(name\))210 2784 A
6075 V
(06998)210 1122 A
(_CONST)252 1440 A
(char)168 1734 A
(*params;)336 1944 A
3456(/*)S
(boot)168 3582 A
(monitor)294 3792 A
(parameters)420 4128 A
4590(*/)S
6165 V
(06999)210 1122 A
(_CONST)252 1440 A
(char)168 1734 A
(*name;)252 1944 A
3456(/*)S
(key)126 3582 A
3750(to)S
(look)168 3876 A
4086(up)S
4212(*/)S
6255 V
(07000)210 1122 A
1440({)S
6345 V
(07001)210 1122 A
1440(/*)S
(Get)126 1566 A
(environment)462 1734 A
(value)210 2238 A
2490(-)S
(kernel)252 2574 A
(version)294 2868 A
3204(of)S
(getenv)252 3330 A
3624(to)S
(avoid)210 3750 A
(setting)294 4002 A
4338(up)S
(the)126 4464 A
6435 V
(07002)210 1122 A
1482(*)S
(usual)210 1566 A
(environment)462 1818 A
(array.)252 2322 A
6525 V
(07003)210 1122 A
1482(*/)S
6615 V
(07004)210 1122 A
(register)336 1524 A
(_CONST)252 1902 A
(char)168 2196 A
(*namep;)294 2406 A
6705 V
(07005)210 1122 A
(register)336 1524 A
(char)168 1902 A
(*envp;)252 2112 A
6795 V
(07006)210 1122 A
6885 V
(07007)210 1122 A
(for)126 1524 A
(\(envp)210 1692 A
1944(=)S
(\(char)210 2028 A
2280(*\))S
(params;)294 2406 A
(*envp)210 2742 A
2994(!=)S
(0;\))126 3120 A
3288({)S
6975 V
(07008)210 1122 A
(for)126 1776 A
(\(namep)252 1944 A
2238(=)S
(name;)210 2322 A
(*namep)252 2574 A
2868(!=)S
2994(0)S
3078(&&)S
(*namep)252 3204 A
3498(==)S
(*envp;)252 3624 A
(namep++,)336 3918 A
(envp++\))294 4296 A
7065 V
(07009)210 1122 A
2112(;)S
8418 V
EP
%%Page: 80 80
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(80)S
11 R
2474(File:)S
2707(kernel/start.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(07010)210 1122 A
1776(if)S
(\(*namep)294 1902 A
2238(==)S
('\\0')168 2364 A
2574(&&)S
(*envp)210 2700 A
2952(==)S
('='\))168 3078 A
(return\(envp)462 3288 A
3792(+)S
(1\);)126 3876 A
1845 V
(07011)210 1122 A
(while)210 1776 A
(\(*envp++)336 2028 A
2406(!=)S
2532(0\))S
1935 V
(07012)210 1122 A
2112(;)S
2025 V
(07013)210 1122 A
1524(})S
2115 V
(07014)210 1122 A
(return\(NIL_PTR\);)672 1524 A
2205 V
(07015)210 1122 A
1440(})S
2745 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2835 V
(kernel/main.c)546 2676 A
2925 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3105 V
(07100)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(main)168 2532 A
(program)294 2742 A
3078(of)S
(MINIX)210 3204 A
3456(as)S
(well)168 3582 A
3792(as)S
(its)126 3918 A
(shutdown)336 4086 A
(code.)210 4464 A
3195 V
(07101)210 1122 A
1482(*)S
(The)126 1566 A
(routine)294 1734 A
(main\(\))252 2070 A
(initializes)462 2364 A
(the)126 2868 A
(system)252 3036 A
(and)126 3330 A
(starts)252 3498 A
(the)126 3792 A
(ball)168 3960 A
(rolling)294 4170 A
4506(by)S
3285 V
(07102)210 1122 A
1482(*)S
(setting)294 1566 A
1902(up)S
(the)126 2028 A
(process)294 2196 A
(table,)252 2532 A
(interrupt)378 2826 A
(vectors,)336 3246 A
(and)126 3624 A
(scheduling)420 3792 A
(each)168 4254 A
(task)168 4464 A
3375 V
(07103)210 1122 A
1482(*)S
1566(to)S
(run)126 1692 A
1860(to)S
(initialize)420 1986 A
(itself.)294 2448 A
3465 V
(07104)210 1122 A
1482(*)S
(The)126 1566 A
(routine)294 1734 A
(shutdown\(\))420 2070 A
(does)168 2532 A
(the)126 2742 A
(opposite)336 2910 A
(and)126 3288 A
(brings)252 3456 A
(down)168 3750 A
(MINIX.)252 3960 A
3555 V
(07105)210 1122 A
1482(*)S
3645 V
(07106)210 1122 A
1482(*)S
(The)126 1566 A
(entries)294 1734 A
(into)168 2070 A
(this)168 2280 A
(file)168 2490 A
(are:)168 2700 A
3735 V
(07107)210 1122 A
1482(*)S
(main:)210 1650 A
(MINIX)210 2448 A
(main)168 2700 A
(program)294 2910 A
3825 V
(07108)210 1122 A
1482(*)S
(prepare_shutdown:)714 1650 A
(prepare)294 2448 A
2784(to)S
(take)168 2910 A
(MINIX)210 3120 A
(down)168 3372 A
3915 V
(07109)210 1122 A
1482(*)S
4005 V
(07110)210 1122 A
1482(*)S
(Changes:)336 1566 A
4095 V
(07111)210 1122 A
1482(*)S
(Nov)126 1650 A
(24,)126 1818 A
(2004)168 1986 A
(simplified)420 2280 A
(main\(\))252 2742 A
(with)168 3036 A
(system)252 3246 A
(image)210 3540 A
(\(Jorrit)294 3834 A
4170(N.)S
(Herder\))294 4296 A
4185 V
(07112)210 1122 A
1482(*)S
(Aug)126 1650 A
(20,)126 1818 A
(2004)168 1986 A
(new)126 2280 A
(prepare_shutdown\(\))756 2448 A
(and)126 3246 A
(shutdown\(\))420 3414 A
(\(Jorrit)294 3918 A
4254(N.)S
(Herder\))294 4380 A
4275 V
(07113)210 1122 A
1482(*/)S
4365 V
(07114)210 1122 A
(#include)336 1440 A
("kernel.h")420 1818 A
4455 V
(07115)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
4545 V
(07116)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
4635 V
(07117)210 1122 A
(#include)336 1440 A
(<unistd.h>)420 1818 A
4725 V
(07118)210 1122 A
(#include)336 1440 A
(<a.out.h>)378 1818 A
4815 V
(07119)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
4905 V
(07120)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
4995 V
(07121)210 1122 A
(#include)336 1440 A
("proc.h")336 1818 A
5085 V
(07122)210 1122 A
5175 V
(07123)210 1122 A
1440(/*)S
(Prototype)378 1566 A
(declarations)504 1986 A
(for)126 2532 A
(PRIVATE)294 2700 A
(functions.)420 3036 A
3498(*/)S
5265 V
(07124)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(announce,)378 2490 A
(\(void\)\);)336 2910 A
5355 V
(07125)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(shutdown,)378 2490 A
(\(timer_t)336 2910 A
(*tp\)\);)252 3288 A
5445 V
(07126)210 1122 A
5535 V
(07127)210 1122 A
(/*===========================================================================*)3276 1440 A
5625 V
(07128)210 1122 A
1482(*)S
(main)168 2784 A
4674(*)S
5715 V
(07129)210 1122 A
(*===========================================================================*/)3276 1482 A
5805 V
(07130)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(main\(\))252 1944 A
5895 V
(07131)210 1122 A
1440({)S
5985 V
(07132)210 1122 A
1440(/*)S
(Start)210 1566 A
(the)126 1818 A
(ball)168 1986 A
(rolling.)336 2196 A
2574(*/)S
6075 V
(07133)210 1122 A
(struct)252 1524 A
(boot_image)420 1818 A
(*ip;)168 2280 A
2784(/*)S
(boot)168 2910 A
(image)210 3120 A
(pointer)294 3372 A
3708(*/)S
6165 V
(07134)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*rp;)168 2406 A
2784(/*)S
(process)294 2910 A
(pointer)294 3246 A
3582(*/)S
6255 V
(07135)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(priv)168 2196 A
(*sp;)168 2406 A
2784(/*)S
(privilege)378 2910 A
(structure)378 3330 A
(pointer)294 3750 A
4086(*/)S
6345 V
(07136)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(i,)S
2196(s;)S
6435 V
(07137)210 1122 A
(int)126 1524 A
(hdrindex;)378 1692 A
2784(/*)S
(index)210 2910 A
3162(to)S
(array)210 3288 A
3540(of)S
(a.out)210 3666 A
(headers)294 3918 A
4254(*/)S
6525 V
(07138)210 1122 A
(phys_clicks)462 1524 A
(text_base;)420 2028 A
6615 V
(07139)210 1122 A
(vir_clicks)420 1524 A
(text_clicks,)504 1986 A
(data_clicks;)504 2532 A
6705 V
(07140)210 1122 A
(reg_t)210 1524 A
(ktsb;)210 1776 A
2784(/*)S
(kernel)252 2910 A
(task)168 3204 A
(stack)210 3414 A
(base)168 3666 A
3876(*/)S
6795 V
(07141)210 1122 A
(struct)252 1524 A
(exec)168 1818 A
(e_hdr;)252 2028 A
2784(/*)S
(for)126 2910 A
3078(a)S
(copy)168 3162 A
3372(of)S
3498(an)S
(a.out)210 3624 A
(header)252 3876 A
4170(*/)S
6885 V
(07142)210 1122 A
6975 V
(07143)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(the)126 2112 A
(interrupt)378 2280 A
(controller.)462 2700 A
3204(*/)S
7065 V
(07144)210 1122 A
(intr_init\(1\);)546 1524 A
8418 V
EP
%%Page: 81 81
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2459(File:)S
2692(kernel/main.c)S
12 B
4560(81)S
1755 V
7 LST
(07145)210 1122 A
1845 V
(07146)210 1122 A
1524(/*)S
(Clear)210 1650 A
(the)126 1902 A
(process)294 2070 A
(table.)252 2406 A
(Anounce)294 2700 A
(each)168 3036 A
(slot)168 3246 A
3456(as)S
(empty)210 3582 A
(and)126 3834 A
(set)126 4002 A
4170(up)S
(mappings)336 4296 A
1935 V
(07147)210 1122 A
1566(*)S
(for)126 1650 A
(proc_addr\(\))462 1818 A
(and)126 2322 A
(proc_nr\(\))378 2490 A
(macros.)294 2910 A
3246(Do)S
(the)126 3372 A
(same)168 3540 A
(for)126 3750 A
(the)126 3918 A
(table)210 4086 A
(with)168 4338 A
2025 V
(07148)210 1122 A
1566(*)S
(privilege)378 1650 A
(structures)420 2070 A
(for)126 2532 A
(the)126 2700 A
(system)252 2868 A
(processes.)420 3162 A
2115 V
(07149)210 1122 A
1566(*/)S
2205 V
(07150)210 1122 A
(for)126 1524 A
(\(rp)126 1692 A
1860(=)S
(BEG_PROC_ADDR,)588 1944 A
2574(i)S
2658(=)S
(-NR_TASKS;)420 2742 A
3204(rp)S
3330(<)S
(END_PROC_ADDR;)588 3414 A
(++rp,)210 4044 A
(++i\))168 4296 A
4506({)S
2295 V
(07151)210 1122 A
(rp->p_rts_flags)630 1776 A
2448(=)S
(SLOT_FREE;)420 2532 A
3456(/*)S
(initialize)420 3582 A
(free)168 4044 A
(slot)168 4254 A
4464(*/)S
2385 V
(07152)210 1122 A
(rp->p_nr)336 1776 A
2154(=)S
2238(i;)S
3456(/*)S
(proc)168 3582 A
(number)252 3792 A
(from)168 4086 A
(ptr)126 4296 A
4464(*/)S
2475 V
(07153)210 1122 A
(\(pproc_addr)462 1776 A
2280(+)S
(NR_TASKS\)[i])504 2364 A
2910(=)S
(rp;)126 2994 A
3456(/*)S
(proc)168 3582 A
(ptr)126 3792 A
(from)168 3960 A
(number)252 4170 A
4464(*/)S
2565 V
(07154)210 1122 A
1524(})S
2655 V
(07155)210 1122 A
(for)126 1524 A
(\(sp)126 1692 A
1860(=)S
(BEG_PRIV_ADDR,)588 1944 A
2574(i)S
2658(=)S
2742(0;)S
2868(sp)S
2994(<)S
(END_PRIV_ADDR;)588 3078 A
(++sp,)210 3708 A
(++i\))168 3960 A
4170({)S
2745 V
(07156)210 1122 A
(sp->s_proc_nr)546 1776 A
2364(=)S
(NONE;)210 2448 A
3456(/*)S
(initialize)420 3582 A
4044(as)S
(free)168 4170 A
4380(*/)S
2835 V
(07157)210 1122 A
(sp->s_id)336 1776 A
2154(=)S
2238(i;)S
3456(/*)S
(priv)168 3582 A
(structure)378 3792 A
(index)210 4212 A
4464(*/)S
2925 V
(07158)210 1122 A
(ppriv_addr[i])546 1776 A
2364(=)S
(sp;)126 2448 A
3456(/*)S
(priv)168 3582 A
(ptr)126 3792 A
(from)168 3960 A
(number)252 4170 A
4464(*/)S
3015 V
(07159)210 1122 A
1524(})S
3105 V
(07160)210 1122 A
3195 V
(07161)210 1122 A
1524(/*)S
(Set)126 1650 A
1818(up)S
(proc)168 1944 A
(table)210 2154 A
(entries)294 2406 A
(for)126 2742 A
(tasks)210 2910 A
(and)126 3162 A
(servers.)336 3330 A
(The)126 3750 A
(stacks)252 3918 A
4212(of)S
(the)126 4338 A
3285 V
(07162)210 1122 A
1566(*)S
(kernel)252 1650 A
(tasks)210 1944 A
(are)126 2196 A
(initialized)462 2364 A
2868(to)S
2994(an)S
(array)210 3120 A
3372(in)S
(data)168 3498 A
(space.)252 3708 A
(The)126 4044 A
(stacks)252 4212 A
3375 V
(07163)210 1122 A
1566(*)S
1650(of)S
(the)126 1776 A
(servers)294 1944 A
(have)168 2280 A
(been)168 2490 A
(added)210 2700 A
2952(to)S
(the)126 3078 A
(data)168 3246 A
(segment)294 3456 A
3792(by)S
(the)126 3918 A
(monitor,)336 4086 A
4464(so)S
3465 V
(07164)210 1122 A
1566(*)S
(the)126 1650 A
(stack)210 1818 A
(pointer)294 2070 A
2406(is)S
(set)126 2532 A
2700(to)S
(the)126 2826 A
(end)126 2994 A
3162(of)S
(the)126 3288 A
(data)168 3456 A
(segment.)336 3666 A
(All)126 4086 A
(the)126 4254 A
3555 V
(07165)210 1122 A
1566(*)S
(processes)378 1650 A
(are)126 2070 A
2238(in)S
(low)126 2364 A
(memory)252 2532 A
2826(on)S
(the)126 2952 A
(8086.)210 3120 A
3414(On)S
(the)126 3540 A
(386)126 3708 A
(only)168 3876 A
(the)126 4086 A
(kernel)252 4254 A
3645 V
(07166)210 1122 A
1566(*)S
1650(is)S
1776(in)S
(low)126 1902 A
(memory,)294 2070 A
(the)126 2406 A
(rest)168 2574 A
2784(is)S
(loaded)252 2910 A
3204(in)S
(extended)336 3330 A
(memory.)294 3708 A
3735 V
(07167)210 1122 A
1566(*/)S
3825 V
(07168)210 1122 A
3915 V
(07169)210 1122 A
1524(/*)S
(Task)168 1650 A
(stacks.)294 1860 A
2196(*/)S
4005 V
(07170)210 1122 A
(ktsb)168 1524 A
1734(=)S
(\(reg_t\))294 1818 A
(t_stack;)336 2154 A
4095 V
(07171)210 1122 A
4185 V
(07172)210 1122 A
(for)126 1524 A
(\(i=0;)210 1692 A
1944(i)S
2028(<)S
(NR_BOOT_PROCS;)588 2112 A
(++i\))168 2742 A
2952({)S
4275 V
(07173)210 1122 A
1776(ip)S
1902(=)S
(&image[i];)420 1986 A
3456(/*)S
(process')336 3582 A
(attributes)420 3960 A
4422(*/)S
4365 V
(07174)210 1122 A
1776(rp)S
1902(=)S
(proc_addr\(ip->proc_nr\);)966 1986 A
3456(/*)S
(get)126 3582 A
(process)294 3750 A
(pointer)294 4086 A
4422(*/)S
4455 V
(07175)210 1122 A
(rp->p_max_priority)756 1776 A
2574(=)S
(ip->priority;)546 2658 A
3456(/*)S
(max)126 3582 A
(scheduling)420 3750 A
(priority)336 4212 A
4590(*/)S
4545 V
(07176)210 1122 A
(rp->p_priority)588 1776 A
2406(=)S
(ip->priority;)546 2490 A
3456(/*)S
(current)294 3582 A
(priority)336 3918 A
4296(*/)S
4635 V
(07177)210 1122 A
(rp->p_quantum_size)756 1776 A
2574(=)S
(ip->quantum;)504 2658 A
3456(/*)S
(quantum)294 3582 A
(size)168 3918 A
4128(in)S
(ticks)210 4254 A
4506(*/)S
4725 V
(07178)210 1122 A
(rp->p_ticks_left)672 1776 A
2490(=)S
(ip->quantum;)504 2574 A
3456(/*)S
(current)294 3582 A
(credit)252 3918 A
4212(*/)S
4815 V
(07179)210 1122 A
(strncpy\(rp->p_name,)798 1776 A
(ip->proc_name,)588 2616 A
(P_NAME_LEN\);)504 3246 A
3792(/*)S
(set)126 3918 A
(process)294 4086 A
(name)168 4422 A
4632(*/)S
4905 V
(07180)210 1122 A
(\(void\))252 1776 A
(get_priv\(rp,)504 2070 A
(\(ip->flags)420 2616 A
3078(&)S
(SYS_PROC\)\);)462 3162 A
3792(/*)S
(assign)252 3918 A
(structure)378 4212 A
4632(*/)S
4995 V
(07181)210 1122 A
(priv\(rp\)->s_flags)714 1776 A
2532(=)S
(ip->flags;)420 2616 A
3792(/*)S
(process)294 3918 A
(flags)210 4254 A
4506(*/)S
5085 V
(07182)210 1122 A
(priv\(rp\)->s_trap_mask)882 1776 A
2700(=)S
(ip->trap_mask;)588 2784 A
3792(/*)S
(allowed)294 3918 A
(traps)210 4254 A
4506(*/)S
5175 V
(07183)210 1122 A
(priv\(rp\)->s_call_mask)882 1776 A
2700(=)S
(ip->call_mask;)588 2784 A
3792(/*)S
(kernel)252 3918 A
(call)168 4212 A
(mask)168 4422 A
4632(*/)S
5265 V
(07184)210 1122 A
(priv\(rp\)->s_ipc_to.chunk[0])1134 1776 A
2952(=)S
(ip->ipc_to;)462 3036 A
3792(/*)S
(restrict)336 3918 A
(targets)294 4296 A
4632(*/)S
5355 V
(07185)210 1122 A
1776(if)S
(\(iskerneln\(proc_nr\(rp\)\)\))1008 1902 A
2952({)S
3456(/*)S
(part)168 3582 A
3792(of)S
(the)126 3918 A
(kernel?)294 4086 A
4422(*/)S
5445 V
(07186)210 1122 A
2112(if)S
(\(ip->stksize)504 2238 A
2784(>)S
2868(0\))S
2994({)S
3456(/*)S
(HARDWARE)336 3582 A
(stack)210 3960 A
(size)168 4212 A
4422(is)S
4548(0)S
4632(*/)S
5535 V
(07187)210 1122 A
(rp->p_priv->s_stack_guard)1050 2448 A
3540(=)S
(\(reg_t)252 3624 A
3918(*\))S
(ktsb;)210 4044 A
5625 V
(07188)210 1122 A
(*rp->p_priv->s_stack_guard)1092 2448 A
3582(=)S
(STACK_GUARD;)504 3666 A
5715 V
(07189)210 1122 A
2112(})S
5805 V
(07190)210 1122 A
(ktsb)168 2112 A
2322(+=)S
(ip->stksize;)504 2448 A
3120(/*)S
(point)210 3246 A
3498(to)S
(high)168 3624 A
(end)126 3834 A
4002(of)S
(stack)210 4128 A
4380(*/)S
5895 V
(07191)210 1122 A
(rp->p_reg.sp)504 2112 A
2658(=)S
(ktsb;)210 2742 A
3120(/*)S
(this)168 3246 A
(task's)252 3456 A
(initial)294 3750 A
(stack)210 4086 A
(ptr)126 4338 A
4506(*/)S
5985 V
(07192)210 1122 A
(text_base)378 2112 A
2532(=)S
(kinfo.code_base)630 2616 A
3288(>>)S
(CLICK_SHIFT;)504 3414 A
6075 V
(07193)210 1122 A
3120(/*)S
(processes)378 3246 A
(that)168 3666 A
(are)126 3876 A
4044(in)S
(the)126 4170 A
(kernel)252 4338 A
4632(*/)S
6165 V
(07194)210 1122 A
(hdrindex)336 2112 A
2490(=)S
2574(0;)S
3120(/*)S
(all)126 3246 A
(use)126 3414 A
(the)126 3582 A
(first)210 3750 A
(a.out)210 4002 A
(header)252 4254 A
4548(*/)S
6255 V
(07195)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
6345 V
(07196)210 1122 A
(hdrindex)336 2112 A
2490(=)S
2574(1)S
2658(+)S
(i-NR_TASKS;)462 2742 A
3456(/*)S
(servers,)336 3582 A
(drivers,)336 3960 A
(INIT)168 4338 A
4548(*/)S
6435 V
(07197)210 1122 A
1776(})S
6525 V
(07198)210 1122 A
6615 V
(07199)210 1122 A
1776(/*)S
(The)126 1902 A
(bootstrap)378 2070 A
(loader)252 2490 A
(created)294 2784 A
3120(an)S
(array)210 3246 A
3498(of)S
(the)126 3624 A
(a.out)210 3792 A
(headers)294 4044 A
4380(at)S
6705 V
(07200)210 1122 A
1818(*)S
(absolute)336 1902 A
(address)294 2280 A
('aout'.)294 2616 A
(Get)126 2952 A
(one)126 3120 A
(element)294 3288 A
3624(to)S
(e_hdr.)252 3750 A
6795 V
(07201)210 1122 A
1818(*/)S
6885 V
(07202)210 1122 A
(phys_copy\(aout)588 1776 A
2406(+)S
(hdrindex)336 2490 A
2868(*)S
(A_MINHDR,)378 2952 A
(vir2phys\(&e_hdr\),)714 3372 A
6975 V
(07203)210 1122 A
(\(phys_bytes\))504 3456 A
(A_MINHDR\);)420 4002 A
7065 V
(07204)210 1122 A
1776(/*)S
(Convert)294 1902 A
(addresses)378 2238 A
2658(to)S
(clicks)252 2784 A
(and)126 3078 A
(build)210 3246 A
(process)294 3498 A
(memory)252 3834 A
(map)126 4128 A
4296(*/)S
8418 V
EP
%%Page: 82 82
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(82)S
11 R
2459(File:)S
2692(kernel/main.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(07205)210 1122 A
(text_base)378 1776 A
2196(=)S
(e_hdr.a_syms)504 2280 A
2826(>>)S
(CLICK_SHIFT;)504 2952 A
1845 V
(07206)210 1122 A
(text_clicks)462 1776 A
2280(=)S
(\(e_hdr.a_text)546 2364 A
2952(+)S
(CLICK_SIZE-1\))546 3036 A
3624(>>)S
(CLICK_SHIFT;)504 3750 A
1935 V
(07207)210 1122 A
1776(if)S
(\(!\(e_hdr.a_flags)672 1902 A
2616(&)S
(A_SEP\)\))294 2700 A
(text_clicks)462 3036 A
3540(=)S
3624(0;)S
3918(/*)S
(common)252 4044 A
(I&D)126 4338 A
4506(*/)S
2025 V
(07208)210 1122 A
(data_clicks)462 1776 A
2280(=)S
(\(e_hdr.a_total)588 2364 A
2994(+)S
(CLICK_SIZE-1\))546 3078 A
3666(>>)S
(CLICK_SHIFT;)504 3792 A
2115 V
(07209)210 1122 A
(rp->p_memmap[T].mem_phys)1008 1776 A
2826(=)S
(text_base;)420 2910 A
2205 V
(07210)210 1122 A
(rp->p_memmap[T].mem_len)966 1776 A
2826(=)S
(text_clicks;)504 2910 A
2295 V
(07211)210 1122 A
(rp->p_memmap[D].mem_phys)1008 1776 A
2826(=)S
(text_base)378 2910 A
3330(+)S
(text_clicks;)504 3414 A
2385 V
(07212)210 1122 A
(rp->p_memmap[D].mem_len)966 1776 A
2826(=)S
(data_clicks;)504 2910 A
2475 V
(07213)210 1122 A
(rp->p_memmap[S].mem_phys)1008 1776 A
2826(=)S
(text_base)378 2910 A
3330(+)S
(text_clicks)462 3414 A
3918(+)S
(data_clicks;)504 4002 A
2565 V
(07214)210 1122 A
(rp->p_memmap[S].mem_vir)966 1776 A
2826(=)S
(data_clicks;)504 2910 A
3456(/*)S
(empty)210 3582 A
3834(-)S
(stack)210 3918 A
4170(is)S
4296(in)S
(data)168 4422 A
4632(*/)S
2655 V
(07215)210 1122 A
2745 V
(07216)210 1122 A
1776(/*)S
(Set)126 1902 A
(initial)294 2070 A
(register)336 2406 A
(values.)294 2784 A
(The)126 3162 A
(processor)378 3330 A
(status)252 3750 A
(word)168 4044 A
(for)126 4254 A
(tasks)210 4422 A
2835 V
(07217)210 1122 A
1818(*)S
1902(is)S
(different)378 2028 A
(from)168 2448 A
(that)168 2658 A
2868(of)S
(other)210 2994 A
(processes)378 3246 A
(because)294 3666 A
(tasks)210 4002 A
(can)126 4254 A
2925 V
(07218)210 1122 A
1818(*)S
(access)252 1902 A
(I/O;)168 2196 A
(this)168 2406 A
2616(is)S
(not)126 2742 A
(allowed)294 2910 A
3246(to)S
(less-privileged)630 3372 A
(processes)378 4044 A
3015 V
(07219)210 1122 A
1818(*/)S
3105 V
(07220)210 1122 A
(rp->p_reg.pc)504 1776 A
2322(=)S
(\(reg_t\))294 2406 A
(ip->initial_pc;)630 2742 A
3195 V
(07221)210 1122 A
(rp->p_reg.psw)546 1776 A
2364(=)S
(\(iskernelp\(rp\)\))630 2448 A
3120(?)S
(INIT_TASK_PSW)546 3204 A
3792(:)S
(INIT_PSW;)378 3876 A
3285 V
(07222)210 1122 A
3375 V
(07223)210 1122 A
1776(/*)S
(Initialize)420 1902 A
(the)126 2364 A
(server)252 2532 A
(stack)210 2826 A
(pointer.)336 3078 A
(Take)168 3456 A
3666(it)S
(down)168 3792 A
(one)126 4002 A
(word)168 4170 A
3465 V
(07224)210 1122 A
1818(*)S
1902(to)S
(give)168 2028 A
(crtso.s)294 2238 A
(something)378 2574 A
2994(to)S
(use)126 3120 A
3288(as)S
("argc".)294 3414 A
3555 V
(07225)210 1122 A
1818(*/)S
3645 V
(07226)210 1122 A
1776(if)S
(\(isusern\(proc_nr\(rp\)\)\))924 1902 A
2868({)S
3456(/*)S
(user-space)420 3582 A
(process?)336 4044 A
4422(*/)S
3735 V
(07227)210 1122 A
(rp->p_reg.sp)504 2112 A
2658(=)S
(\(rp->p_memmap[S].mem_vir)1008 2742 A
3792(+)S
3825 V
(07228)210 1122 A
(rp->p_memmap[S].mem_len\))1008 2784 A
3834(<<)S
(CLICK_SHIFT;)504 3960 A
3915 V
(07229)210 1122 A
(rp->p_reg.sp)504 2112 A
2658(-=)S
(sizeof\(reg_t\);)588 2784 A
4005 V
(07230)210 1122 A
1776(})S
4095 V
(07231)210 1122 A
4185 V
(07232)210 1122 A
1776(/*)S
(Set)126 1902 A
(ready.)252 2070 A
(The)126 2364 A
(HARDWARE)336 2532 A
(task)168 2910 A
3120(is)S
(never)210 3246 A
(ready.)252 3498 A
3792(*/)S
4275 V
(07233)210 1122 A
1776(if)S
(\(rp->p_nr)378 1902 A
2322(!=)S
(HARDWARE\))378 2448 A
2868({)S
4365 V
(07234)210 1122 A
(rp->p_rts_flags)630 2112 A
2784(=)S
2868(0;)S
3456(/*)S
(runnable)336 3582 A
3960(if)S
4086(no)S
(flags)210 4212 A
4464(*/)S
4455 V
(07235)210 1122 A
(lock_enqueue\(rp\);)714 2112 A
3456(/*)S
(add)126 3582 A
3750(to)S
(scheduling)420 3876 A
(queues)252 4338 A
4632(*/)S
4545 V
(07236)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
4635 V
(07237)210 1122 A
(rp->p_rts_flags)630 2112 A
2784(=)S
(NO_MAP;)294 2868 A
3456(/*)S
(prevent)294 3582 A
(from)168 3918 A
(running)294 4128 A
4464(*/)S
4725 V
(07238)210 1122 A
1776(})S
4815 V
(07239)210 1122 A
4905 V
(07240)210 1122 A
1776(/*)S
(Code)168 1902 A
(and)126 2112 A
(data)168 2280 A
(segments)336 2490 A
(must)168 2868 A
3078(be)S
(allocated)378 3204 A
3624(in)S
(protected)378 3750 A
(mode.)210 4170 A
4422(*/)S
4995 V
(07241)210 1122 A
(alloc_segments\(rp\);)798 1776 A
5085 V
(07242)210 1122 A
1524(})S
5175 V
(07243)210 1122 A
5265 V
(07244)210 1122 A
1524(/*)S
(We're)210 1650 A
(definitely)420 1902 A
(not)126 2364 A
(shutting)336 2532 A
(down.)210 2910 A
3162(*/)S
5355 V
(07245)210 1122 A
(shutdown_started)672 1524 A
2238(=)S
2322(0;)S
5445 V
(07246)210 1122 A
5535 V
(07247)210 1122 A
1524(/*)S
(MINIX)210 1650 A
1902(is)S
(now)126 2028 A
(ready.)252 2196 A
(All)126 2490 A
(boot)168 2658 A
(image)210 2868 A
(processes)378 3120 A
(are)126 3540 A
3708(on)S
(the)126 3834 A
(ready)210 4002 A
(queue.)252 4254 A
5625 V
(07248)210 1122 A
1566(*)S
(Return)252 1650 A
1944(to)S
(the)126 2070 A
(assembly)336 2238 A
(code)168 2616 A
2826(to)S
(start)210 2952 A
(running)294 3204 A
(the)126 3540 A
(current)294 3708 A
(process.)336 4044 A
5715 V
(07249)210 1122 A
1566(*/)S
5805 V
(07250)210 1122 A
(bill_ptr)336 1524 A
1902(=)S
(proc_addr\(IDLE\);)672 1986 A
3120(/*)S
3246(it)S
(has)126 3372 A
3540(to)S
(point)210 3666 A
(somewhere)378 3918 A
4338(*/)S
5895 V
(07251)210 1122 A
(announce\(\);)462 1524 A
3120(/*)S
(print)210 3246 A
(MINIX)210 3498 A
(startup)294 3750 A
(banner)252 4086 A
4380(*/)S
5985 V
(07252)210 1122 A
(restart\(\);)420 1524 A
6075 V
(07253)210 1122 A
1440(})S
6255 V
(07255)210 1122 A
(/*===========================================================================*)3276 1440 A
6345 V
(07256)210 1122 A
1482(*)S
(announce)336 2784 A
4674(*)S
6435 V
(07257)210 1122 A
(*===========================================================================*/)3276 1482 A
6525 V
(07258)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(announce\(void\))588 1986 A
6615 V
(07259)210 1122 A
1440({)S
6705 V
(07260)210 1122 A
1524(/*)S
(Display)294 1650 A
(the)126 1986 A
(MINIX)210 2154 A
(startup)294 2406 A
(banner.)294 2742 A
3078(*/)S
6795 V
(07261)210 1122 A
(kprintf\("MINIX)588 1524 A
(%s.%s.")294 2154 A
6885 V
(07262)210 1122 A
("Copyright)420 1692 A
(2006,)210 2154 A
(Vrije)210 2406 A
(Universiteit,)546 2658 A
(Amsterdam,)420 3246 A
(The)126 3708 A
(Netherlands\\n",)630 3876 A
6975 V
(07263)210 1122 A
(OS_RELEASE,)462 1692 A
(OS_VERSION\);)504 2196 A
7065 V
(07264)210 1122 A
8418 V
EP
%%Page: 83 83
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2459(File:)S
2692(kernel/main.c)S
12 B
4560(83)S
1755 V
7 LST
(07265)210 1122 A
1524(/*)S
(Real)168 1650 A
(mode,)210 1860 A
2112(or)S
(16/32-bit)378 2238 A
(protected)378 2658 A
(mode?)210 3078 A
3330(*/)S
1845 V
(07266)210 1122 A
(kprintf\("Executing)756 1524 A
2322(in)S
2448(%s)S
(mode.\\n\\n",)462 2574 A
1935 V
(07267)210 1122 A
(machine.protected)714 1692 A
2448(?)S
("32-bit)294 2532 A
(protected")420 2868 A
3330(:)S
("real"\);)336 3414 A
2025 V
(07268)210 1122 A
1440(})S
2205 V
(07270)210 1122 A
(/*===========================================================================*)3276 1440 A
2295 V
(07271)210 1122 A
1482(*)S
(prepare_shutdown)672 2784 A
4674(*)S
2385 V
(07272)210 1122 A
(*===========================================================================*/)3276 1482 A
2475 V
(07273)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(prepare_shutdown\(how\))882 1944 A
2565 V
(07274)210 1122 A
(int)126 1440 A
(how;)168 1608 A
2655 V
(07275)210 1122 A
1440({)S
2745 V
(07276)210 1122 A
1440(/*)S
(This)168 1566 A
(function)336 1776 A
(prepares)336 2154 A
2532(to)S
(shutdown)336 2658 A
(MINIX.)252 3036 A
3330(*/)S
2835 V
(07277)210 1122 A
(static)252 1524 A
(timer_t)294 1818 A
(shutdown_timer;)630 2154 A
2925 V
(07278)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*rp;)168 2406 A
3015 V
(07279)210 1122 A
(message)294 1524 A
1860(m;)S
3105 V
(07280)210 1122 A
3195 V
(07281)210 1122 A
1524(/*)S
(Show)168 1650 A
(debugging)378 1860 A
(dumps)210 2280 A
2532(on)S
(panics.)294 2658 A
(Make)168 2994 A
(sure)168 3204 A
(that)168 3414 A
(the)126 3624 A
(TTY)126 3792 A
(task)168 3960 A
4170(is)S
(still)210 4296 A
3285 V
(07282)210 1122 A
1566(*)S
(available)378 1650 A
2070(to)S
(handle)252 2196 A
(them.)210 2490 A
(This)168 2742 A
2952(is)S
(done)168 3078 A
(with)168 3288 A
(help)168 3498 A
3708(of)S
3834(a)S
(non-blocking)504 3918 A
(send.)210 4464 A
3375 V
(07283)210 1122 A
1566(*)S
1650(We)S
(rely)168 1776 A
1986(on)S
(TTY)126 2112 A
2280(to)S
(call)168 2406 A
(sys_abort\(\))462 2616 A
(when)168 3120 A
3330(it)S
3456(is)S
(done)168 3582 A
(with)168 3792 A
(the)126 4002 A
(dumps.)252 4170 A
3465 V
(07284)210 1122 A
1566(*/)S
3555 V
(07285)210 1122 A
1524(if)S
(\(how)168 1650 A
1860(==)S
(RBT_PANIC\))420 1986 A
2448({)S
3645 V
(07286)210 1122 A
(m.m_type)336 1692 A
2070(=)S
(PANIC_DUMPS;)504 2154 A
3735 V
(07287)210 1122 A
1692(if)S
(\(nb_send\(TTY_PROC_NR,&m\)==OK\))1218 1818 A
3120(/*)S
(don't)210 3246 A
(block)210 3498 A
3750(if)S
(TTY)126 3876 A
(isn't)210 4044 A
(ready)210 4296 A
4548(*/)S
3825 V
(07288)210 1122 A
(return;)294 1860 A
3120(/*)S
(await)210 3246 A
(sys_abort\(\))462 3498 A
(from)168 4002 A
(TTY)126 4212 A
4380(*/)S
3915 V
(07289)210 1122 A
1524(})S
4005 V
(07290)210 1122 A
4095 V
(07291)210 1122 A
1524(/*)S
(Send)168 1650 A
1860(a)S
(signal)252 1944 A
2238(to)S
(all)126 2364 A
(system)252 2532 A
(processes)378 2826 A
(that)168 3246 A
(are)126 3456 A
(still)210 3624 A
(alive)210 3876 A
4128(to)S
(inform)252 4254 A
4185 V
(07292)210 1122 A
1566(*)S
(them)168 1650 A
(that)168 1860 A
(the)126 2070 A
(MINIX)210 2238 A
(kernel)252 2490 A
2784(is)S
(shutting)336 2910 A
(down.)210 3288 A
3540(A)S
(proper)252 3624 A
(shutdown)336 3918 A
(sequence)336 4296 A
4275 V
(07293)210 1122 A
1566(*)S
(should)252 1650 A
1944(be)S
(implemented)462 2070 A
2574(by)S
2700(a)S
(user-space)420 2784 A
(server.)294 3246 A
(This)168 3582 A
(mechanism)378 3792 A
4212(is)S
(useful)252 4338 A
4365 V
(07294)210 1122 A
1566(*)S
1650(as)S
1776(a)S
(backup)252 1860 A
2154(in)S
(case)168 2280 A
2490(of)S
(system)252 2616 A
(panics,)294 2910 A
3246(so)S
(that)168 3372 A
(system)252 3582 A
(processes)378 3876 A
(can)126 4296 A
(still)210 4464 A
4455 V
(07295)210 1122 A
1566(*)S
(run)126 1650 A
(their)210 1818 A
(shutdown)336 2070 A
(code,)210 2448 A
(e.g,)168 2700 A
2910(to)S
(synchronize)462 3036 A
(the)126 3540 A
3708(FS)S
3834(or)S
3960(to)S
(let)126 4086 A
(the)126 4254 A
(TTY)126 4422 A
4545 V
(07296)210 1122 A
1566(*)S
(switch)252 1650 A
1944(to)S
(the)126 2070 A
(first)210 2238 A
(console.)336 2490 A
4635 V
(07297)210 1122 A
1566(*/)S
4725 V
(07298)210 1122 A
(kprintf\("Sending)672 1524 A
(SIGKSTOP)336 2238 A
2616(to)S
(system)252 2742 A
(processes)378 3036 A
(...\\n"\);)336 3456 A
4815 V
(07299)210 1122 A
(for)126 1524 A
(\(rp=BEG_PROC_ADDR;)756 1692 A
(rp<END_PROC_ADDR;)714 2490 A
(rp++\))210 3246 A
3498({)S
4905 V
(07300)210 1122 A
1692(if)S
(\(!isemptyp\(rp\))588 1818 A
2448(&&)S
(\(priv\(rp\)->s_flags)756 2574 A
3372(&)S
(SYS_PROC\))378 3456 A
3876(&&)S
(!iskernelp\(rp\)\))630 4002 A
4995 V
(07301)210 1122 A
(send_sig\(proc_nr\(rp\),)882 1860 A
(SIGKSTOP\);)420 2784 A
5085 V
(07302)210 1122 A
1524(})S
5175 V
(07303)210 1122 A
5265 V
(07304)210 1122 A
1524(/*)S
(We're)210 1650 A
(shutting)336 1902 A
(down.)210 2280 A
(Diagnostics)462 2532 A
(may)126 3036 A
(behave)252 3204 A
(differently)462 3498 A
(now.)168 4002 A
4212(*/)S
5355 V
(07305)210 1122 A
(shutdown_started)672 1524 A
2238(=)S
2322(1;)S
5445 V
(07306)210 1122 A
5535 V
(07307)210 1122 A
1524(/*)S
(Notify)252 1650 A
(system)252 1944 A
(processes)378 2238 A
2658(of)S
(the)126 2784 A
(upcoming)336 2952 A
(shutdown)336 3330 A
(and)126 3708 A
(allow)210 3876 A
(them)168 4128 A
4338(to)S
4464(be)S
5625 V
(07308)210 1122 A
1566(*)S
(scheduled)378 1650 A
2070(by)S
(setting)294 2196 A
2532(a)S
(watchog)294 2616 A
(timer)210 2952 A
(that)168 3204 A
(calls)210 3414 A
(shutdown\(\).)462 3666 A
(The)126 4170 A
(timer)210 4338 A
5715 V
(07309)210 1122 A
1566(*)S
(argument)336 1650 A
(passes)252 2028 A
(the)126 2322 A
(shutdown)336 2490 A
(status.)294 2868 A
5805 V
(07310)210 1122 A
1566(*/)S
5895 V
(07311)210 1122 A
(kprintf\("MINIX)588 1524 A
(will)168 2154 A
(now)126 2364 A
2532(be)S
(shut)168 2658 A
(down)168 2868 A
(...\\n"\);)336 3078 A
5985 V
(07312)210 1122 A
(tmr_arg\(&shutdown_timer\)->ta_int)1344 1524 A
2910(=)S
(how;)168 2994 A
6075 V
(07313)210 1122 A
6165 V
(07314)210 1122 A
1524(/*)S
(Continue)336 1650 A
(after)210 2028 A
2280(1)S
(second,)294 2364 A
2700(to)S
(give)168 2826 A
(processes)378 3036 A
3456(a)S
(chance)252 3540 A
3834(to)S
(get)126 3960 A
6255 V
(07315)210 1122 A
1566(*)S
(scheduled)378 1650 A
2070(to)S
2196(do)S
(shutdown)336 2322 A
(work.)210 2700 A
6345 V
(07316)210 1122 A
1566(*/)S
6435 V
(07317)210 1122 A
(set_timer\(&shutdown_timer,)1092 1524 A
(get_uptime\(\))504 2658 A
3204(+)S
(HZ,)126 3288 A
(shutdown\);)420 3456 A
6525 V
(07318)210 1122 A
1440(})S
6705 V
(07320)210 1122 A
(/*===========================================================================*)3276 1440 A
6795 V
(07321)210 1122 A
1482(*)S
(shutdown)336 2784 A
4674(*)S
6885 V
(07322)210 1122 A
(*===========================================================================*/)3276 1482 A
6975 V
(07323)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(shutdown\(tp\))504 1986 A
7065 V
(07324)210 1122 A
(timer_t)294 1440 A
(*tp;)168 1776 A
8418 V
EP
%%Page: 84 84
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(84)S
11 R
2459(File:)S
2692(kernel/main.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(07325)210 1122 A
1440({)S
1845 V
(07326)210 1122 A
1440(/*)S
(This)168 1566 A
(function)336 1776 A
2154(is)S
(called)252 2280 A
(from)168 2574 A
(prepare_shutdown)672 2784 A
3498(or)S
(stop_sequence)546 3624 A
4212(to)S
(bring)210 4338 A
1935 V
(07327)210 1122 A
1482(*)S
(down)168 1566 A
(MINIX.)252 1776 A
(How)126 2070 A
2238(to)S
(shutdown)336 2364 A
2742(is)S
2868(in)S
(the)126 2994 A
(argument:)378 3162 A
(RBT_HALT)336 3582 A
(\(return)294 3960 A
4296(to)S
(the)126 4422 A
2025 V
(07328)210 1122 A
1482(*)S
(monitor\),)378 1566 A
(RBT_MONITOR)462 1986 A
(\(execute)336 2490 A
(given)210 2868 A
(code\),)252 3120 A
(RBT_RESET)378 3414 A
(\(hard)210 3834 A
(reset\).)294 4086 A
2115 V
(07329)210 1122 A
1482(*/)S
2205 V
(07330)210 1122 A
(int)126 1524 A
(how)126 1692 A
1860(=)S
(tmr_arg\(tp\)->ta_int;)840 1944 A
2295 V
(07331)210 1122 A
(u16_t)210 1524 A
(magic;)252 1776 A
2385 V
(07332)210 1122 A
2475 V
(07333)210 1122 A
1524(/*)S
(Now)126 1650 A
(mask)168 1818 A
(all)126 2028 A
(interrupts,)462 2196 A
(including)378 2700 A
(the)126 3120 A
(clock,)252 3288 A
(and)126 3582 A
(stop)168 3750 A
(the)126 3960 A
(clock.)252 4128 A
4422(*/)S
2565 V
(07334)210 1122 A
(outb\(INT_CTLMASK,)714 1524 A
(\3040\);)168 2280 A
2655 V
(07335)210 1122 A
(clock_stop\(\);)546 1524 A
2745 V
(07336)210 1122 A
2835 V
(07337)210 1122 A
1524(if)S
(\(mon_return)462 1650 A
2154(&&)S
(how)126 2280 A
2448(!=)S
(RBT_RESET\))420 2574 A
3036({)S
2925 V
(07338)210 1122 A
1776(/*)S
(Reinitialize)504 1902 A
(the)126 2448 A
(interrupt)378 2616 A
(controllers)462 3036 A
3540(to)S
(the)126 3666 A
(BIOS)168 3834 A
(defaults.)378 4044 A
4464(*/)S
3015 V
(07339)210 1122 A
(intr_init\(0\);)546 1776 A
3105 V
(07340)210 1122 A
(outb\(INT_CTLMASK,)714 1776 A
(0\);)126 2532 A
3195 V
(07341)210 1122 A
(outb\(INT2_CTLMASK,)756 1776 A
(0\);)126 2574 A
3285 V
(07342)210 1122 A
3375 V
(07343)210 1122 A
1776(/*)S
(Return)252 1902 A
2196(to)S
(the)126 2322 A
(boot)168 2490 A
(monitor.)336 2700 A
(Set)126 3078 A
(the)126 3246 A
(program)294 3414 A
3750(if)S
(not)126 3876 A
(already)294 4044 A
(done.)210 4380 A
4632(*/)S
3465 V
(07344)210 1122 A
1776(if)S
(\(how)168 1902 A
2112(!=)S
(RBT_MONITOR\))504 2238 A
(phys_copy\(vir2phys\(""\),)966 2784 A
(kinfo.params_base,)756 3792 A
(1\);)126 4590 A
3555 V
(07345)210 1122 A
(level0\(monitor\);)672 1776 A
3645 V
(07346)210 1122 A
1524(})S
3735 V
(07347)210 1122 A
3825 V
(07348)210 1122 A
1524(/*)S
(Reset)210 1650 A
(the)126 1902 A
(system)252 2070 A
2364(by)S
(jumping)294 2490 A
2826(to)S
(the)126 2952 A
(reset)210 3120 A
(address)294 3372 A
(\(real)210 3708 A
(mode\),)252 3960 A
4254(or)S
4380(by)S
3915 V
(07349)210 1122 A
1566(*)S
(forcing)294 1650 A
1986(a)S
(processor)378 2070 A
(shutdown)336 2490 A
(\(protected)420 2868 A
(mode\).)252 3330 A
(First)210 3624 A
(stop)168 3876 A
(the)126 4086 A
(BIOS)168 4254 A
4005 V
(07350)210 1122 A
1566(*)S
(memory)252 1650 A
(test)168 1944 A
2154(by)S
(setting)294 2280 A
2616(a)S
(soft)168 2700 A
(reset)210 2910 A
(flag.)210 3162 A
4095 V
(07351)210 1122 A
1566(*/)S
4185 V
(07352)210 1122 A
(magic)210 1524 A
1776(=)S
(STOP_MEM_CHECK;)630 1860 A
4275 V
(07353)210 1122 A
(phys_copy\(vir2phys\(&magic\),)1134 1524 A
(SOFT_RESET_FLAG_ADDR,)882 2700 A
(SOFT_RESET_FLAG_SIZE\);)924 3624 A
4365 V
(07354)210 1122 A
(level0\(reset\);)588 1524 A
4455 V
(07355)210 1122 A
1440(})S
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(kernel/proc.c)546 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(07400)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(essentially)462 2364 A
(all)126 2868 A
3036(of)S
(the)126 3162 A
(process)294 3330 A
(and)126 3666 A
(message)294 3834 A
(handling.)378 4170 A
5445 V
(07401)210 1122 A
1482(*)S
(Together)336 1566 A
(with)168 1944 A
("mpx.s")294 2154 A
2490(it)S
(forms)210 2616 A
(the)126 2868 A
(lowest)252 3036 A
(layer)210 3330 A
3582(of)S
(the)126 3708 A
(MINIX)210 3876 A
(kernel.)294 4128 A
5535 V
(07402)210 1122 A
1482(*)S
(There)210 1566 A
1818(is)S
(one)126 1944 A
(entry)210 2112 A
(point)210 2364 A
(from)168 2616 A
(the)126 2826 A
(outside:)336 2994 A
5625 V
(07403)210 1122 A
1482(*)S
5715 V
(07404)210 1122 A
1482(*)S
(sys_call:)378 1650 A
2364(a)S
(system)252 2448 A
(call,)210 2742 A
(i.e.,)210 2994 A
(the)126 3246 A
(kernel)252 3414 A
3708(is)S
(trapped)294 3834 A
(with)168 4170 A
4380(an)S
(INT)126 4506 A
5805 V
(07405)210 1122 A
1482(*)S
5895 V
(07406)210 1122 A
1482(*)S
1566(As)S
(well)168 1692 A
1902(as)S
(several)294 2028 A
(entry)210 2364 A
(points)252 2616 A
(used)168 2910 A
(from)168 3120 A
(the)126 3330 A
(interrupt)378 3498 A
(and)126 3918 A
(task)168 4086 A
(level:)252 4296 A
5985 V
(07407)210 1122 A
1482(*)S
6075 V
(07408)210 1122 A
1482(*)S
(lock_notify:)504 1650 A
(notify)252 2364 A
2658(a)S
(process)294 2742 A
3078(of)S
3204(a)S
(system)252 3288 A
(event)210 3582 A
6165 V
(07409)210 1122 A
1482(*)S
(lock_send:)420 1650 A
(send)168 2364 A
2574(a)S
(message)294 2658 A
2994(to)S
3120(a)S
(process)294 3204 A
6255 V
(07410)210 1122 A
1482(*)S
(lock_enqueue:)546 1650 A
(put)126 2364 A
2532(a)S
(process)294 2616 A
2952(on)S
(one)126 3078 A
3246(of)S
(the)126 3372 A
(scheduling)420 3540 A
(queues)252 4002 A
6345 V
(07411)210 1122 A
1482(*)S
(lock_dequeue:)546 1650 A
(remove)252 2364 A
2658(a)S
(process)294 2742 A
(from)168 3078 A
(the)126 3288 A
(scheduling)420 3456 A
(queues)252 3918 A
6435 V
(07412)210 1122 A
1482(*)S
6525 V
(07413)210 1122 A
1482(*)S
(Changes:)336 1566 A
6615 V
(07414)210 1122 A
1482(*)S
(Aug)126 1650 A
(19,)126 1818 A
(2005)168 1986 A
(rewrote)294 2364 A
(scheduling)420 2700 A
(code)168 3162 A
(\(Jorrit)294 3414 A
3750(N.)S
(Herder\))294 3876 A
6705 V
(07415)210 1122 A
1482(*)S
(Jul)126 1650 A
(25,)126 1818 A
(2005)168 1986 A
(rewrote)294 2364 A
(system)252 2700 A
(call)168 2994 A
(handling)336 3204 A
(\(Jorrit)294 3624 A
3960(N.)S
(Herder\))294 4086 A
6795 V
(07416)210 1122 A
1482(*)S
(May)126 1650 A
(26,)126 1818 A
(2005)168 1986 A
(rewrote)294 2364 A
(message)294 2700 A
(passing)294 3036 A
(functions)378 3372 A
(\(Jorrit)294 3834 A
4170(N.)S
(Herder\))294 4296 A
6885 V
(07417)210 1122 A
1482(*)S
(May)126 1650 A
(24,)126 1818 A
(2005)168 1986 A
(new)126 2364 A
(notification)504 2532 A
(system)252 3078 A
(call)168 3372 A
(\(Jorrit)294 3624 A
3960(N.)S
(Herder\))294 4086 A
6975 V
(07418)210 1122 A
1482(*)S
(Oct)126 1650 A
(28,)126 1818 A
(2004)168 1986 A
(nonblocking)462 2364 A
(send)168 2868 A
(and)126 3078 A
(receive)294 3246 A
(calls)210 3582 A
(\(Jorrit)294 3876 A
4212(N.)S
(Herder\))294 4338 A
7065 V
(07419)210 1122 A
1482(*)S
8418 V
EP
%%Page: 85 85
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2471(File:)S
2704(kernel/proc.c)S
12 B
4560(85)S
1755 V
7 LST
(07420)210 1122 A
1482(*)S
(The)126 1566 A
(code)168 1734 A
(here)168 1944 A
2154(is)S
(critical)336 2280 A
2658(to)S
(make)168 2784 A
(everything)420 2994 A
(work)168 3456 A
(and)126 3666 A
3834(is)S
(important)378 3960 A
(for)126 4380 A
(the)126 4548 A
1845 V
(07421)210 1122 A
1482(*)S
(overall)294 1566 A
(performance)462 1902 A
2406(of)S
(the)126 2532 A
(system.)294 2700 A
3036(A)S
(large)210 3120 A
(fraction)336 3372 A
3750(of)S
(the)126 3876 A
(code)168 4044 A
(deals)210 4254 A
(with)168 4506 A
1935 V
(07422)210 1122 A
1482(*)S
(list)168 1566 A
(manipulation.)546 1776 A
2364(To)S
(make)168 2490 A
(this)168 2700 A
(both)168 2910 A
(easy)168 3120 A
3330(to)S
(understand)420 3456 A
(and)126 3918 A
(fast)168 4086 A
4296(to)S
(execute)294 4422 A
2025 V
(07423)210 1122 A
1482(*)S
(pointer)294 1566 A
(pointers)336 1902 A
(are)126 2280 A
(used)168 2448 A
(throughout)420 2658 A
(the)126 3120 A
(code.)210 3288 A
(Pointer)294 3540 A
(pointers)336 3876 A
(prevent)294 4254 A
2115 V
(07424)210 1122 A
1482(*)S
(exceptions)420 1566 A
(for)126 2028 A
(the)126 2196 A
(head)168 2364 A
2574(or)S
(tail)168 2700 A
2910(of)S
3036(a)S
(linked)252 3120 A
(list.)210 3414 A
2205 V
(07425)210 1122 A
1482(*)S
2295 V
(07426)210 1122 A
1482(*)S
(node_t)252 1608 A
(*queue,)294 1902 A
(*new_node;)420 2238 A
2784(//)S
(assume)252 2910 A
(these)210 3204 A
3456(as)S
(global)252 3582 A
(variables)378 3876 A
2385 V
(07427)210 1122 A
1482(*)S
(node_t)252 1608 A
(**xpp)210 1902 A
2154(=)S
(&queue;)294 2238 A
2784(//)S
(get)126 2910 A
(pointer)294 3078 A
(pointer)294 3414 A
3750(to)S
(head)168 3876 A
4086(of)S
(queue)210 4212 A
2475 V
(07428)210 1122 A
1482(*)S
(while)210 1608 A
(\(*xpp)210 1860 A
2112(!=)S
(NULL\))210 2238 A
2784(//)S
(find)168 2910 A
(last)168 3120 A
(pointer)294 3330 A
3666(of)S
(the)126 3792 A
(linked)252 3960 A
(list)168 4254 A
2565 V
(07429)210 1122 A
1482(*)S
(xpp)126 1776 A
1944(=)S
(&\(*xpp\)->next;)588 2028 A
2784(//)S
(get)126 2910 A
(pointer)294 3078 A
3414(to)S
(next)168 3540 A
(pointer)294 3750 A
2655 V
(07430)210 1122 A
1482(*)S
(*xpp)168 1608 A
1818(=)S
(new_node;)378 1902 A
2784(//)S
(now)126 2910 A
(replace)294 3078 A
(the)126 3414 A
(end)126 3582 A
(\(the)168 3750 A
(NULL)168 3960 A
(pointer\))336 4170 A
2745 V
(07431)210 1122 A
1482(*)S
(new_node->next)588 1608 A
2238(=)S
(NULL;)210 2322 A
2784(//)S
(and)126 2910 A
(mark)168 3078 A
(the)126 3288 A
(new)126 3456 A
(end)126 3624 A
3792(of)S
(the)126 3918 A
(list)168 4086 A
2835 V
(07432)210 1122 A
1482(*)S
2925 V
(07433)210 1122 A
1482(*)S
(For)126 1566 A
(example,)336 1734 A
(when)168 2112 A
(adding)252 2322 A
2616(a)S
(new)126 2700 A
(node)168 2868 A
3078(to)S
(the)126 3204 A
(end)126 3372 A
3540(of)S
(the)126 3666 A
(list,)210 3834 A
(one)126 4086 A
(normally)336 4254 A
3015 V
(07434)210 1122 A
1482(*)S
(makes)210 1566 A
1818(an)S
(exception)378 1944 A
(for)126 2364 A
2532(an)S
(empty)210 2658 A
(list)168 2910 A
(and)126 3120 A
(looks)210 3288 A
3540(up)S
(the)126 3666 A
(end)126 3834 A
4002(of)S
(the)126 4128 A
(list)168 4296 A
(for)126 4506 A
3105 V
(07435)210 1122 A
1482(*)S
(nonempty)336 1566 A
(lists.)252 1944 A
2238(As)S
(shown)210 2364 A
(above,)252 2616 A
(this)168 2910 A
3120(is)S
(not)126 3246 A
(required)336 3414 A
(with)168 3792 A
(pointer)294 4002 A
(pointers.)378 4338 A
3195 V
(07436)210 1122 A
1482(*/)S
3285 V
(07437)210 1122 A
3375 V
(07438)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
3465 V
(07439)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
3555 V
(07440)210 1122 A
(#include)336 1440 A
("kernel.h")420 1818 A
3645 V
(07441)210 1122 A
(#include)336 1440 A
("proc.h")336 1818 A
3735 V
(07442)210 1122 A
3825 V
(07443)210 1122 A
1440(/*)S
(Scheduling)420 1566 A
(and)126 2028 A
(message)294 2196 A
(passing)294 2532 A
(functions.)420 2868 A
(The)126 3330 A
(functions)378 3498 A
(are)126 3918 A
(available)378 4086 A
4506(to)S
3915 V
(07444)210 1122 A
1482(*)S
(other)210 1566 A
(parts)210 1818 A
2070(of)S
(the)126 2196 A
(kernel)252 2364 A
(through)294 2658 A
(lock_...\(\).)462 2994 A
(The)126 3498 A
(lock)168 3666 A
(temporarily)462 3876 A
(disables)336 4380 A
4005 V
(07445)210 1122 A
1482(*)S
(interrupts)420 1566 A
2028(to)S
(prevent)294 2154 A
(race)168 2490 A
(conditions.)462 2700 A
4095 V
(07446)210 1122 A
1482(*/)S
4185 V
(07447)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(mini_send,)420 2448 A
(\(struct)294 2910 A
(proc)168 3246 A
(*caller_ptr,)504 3456 A
(int)126 4002 A
(dst,)168 4170 A
4275 V
(07448)210 1122 A
(message)294 2112 A
(*m_ptr,)294 2448 A
(unsigned)336 2784 A
(flags\))252 3162 A
3456(\);)S
4365 V
(07449)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(mini_receive,)546 2448 A
(\(struct)294 3036 A
(proc)168 3372 A
(*caller_ptr,)504 3582 A
(int)126 4128 A
(src,)168 4296 A
4455 V
(07450)210 1122 A
(message)294 2112 A
(*m_ptr,)294 2448 A
(unsigned)336 2784 A
(flags\))252 3162 A
3456(\);)S
4545 V
(07451)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(mini_notify,)504 2448 A
(\(struct)294 2994 A
(proc)168 3330 A
(*caller_ptr,)504 3540 A
(int)126 4086 A
(dst\))168 4254 A
4464(\);)S
4635 V
(07452)210 1122 A
4725 V
(07453)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(enqueue,)336 2490 A
(\(struct)294 2868 A
(proc)168 3204 A
(*rp\))168 3414 A
3624(\);)S
4815 V
(07454)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(dequeue,)336 2490 A
(\(struct)294 2868 A
(proc)168 3204 A
(*rp\))168 3414 A
3624(\);)S
4905 V
(07455)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(sched,)252 2490 A
(\(struct)294 2784 A
(proc)168 3120 A
(*rp,)168 3330 A
(int)126 3540 A
(*queue,)294 3708 A
(int)126 4044 A
(*front\))294 4212 A
4548(\);)S
4995 V
(07456)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(pick_proc,)420 2490 A
(\(void\))252 2952 A
3246(\);)S
5085 V
(07457)210 1122 A
5175 V
(07458)210 1122 A
(#define)294 1440 A
(BuildMess\(m_ptr,)672 1776 A
(src,)168 2490 A
(dst_ptr\))336 2700 A
3078(\\)S
5265 V
(07459)210 1122 A
(\(m_ptr\)->m_source)714 1776 A
2532(=)S
(\(src\);)252 2616 A
4464(\\)S
5355 V
(07460)210 1122 A
(\(m_ptr\)->m_type)630 1776 A
2448(=)S
(NOTIFY_FROM\(src\);)714 2532 A
4464(\\)S
5445 V
(07461)210 1122 A
(\(m_ptr\)->NOTIFY_TIMESTAMP)1050 1776 A
2868(=)S
(get_uptime\(\);)546 2952 A
4464(\\)S
5535 V
(07462)210 1122 A
(switch)252 1776 A
(\(src\))210 2070 A
2322({)S
4464(\\)S
5625 V
(07463)210 1122 A
(case)168 1776 A
(HARDWARE:)378 1986 A
4464(\\)S
5715 V
(07464)210 1122 A
(\(m_ptr\)->NOTIFY_ARG)798 2112 A
2952(=)S
(priv\(dst_ptr\)->s_int_pending;)1218 3036 A
4464(\\)S
5805 V
(07465)210 1122 A
(priv\(dst_ptr\)->s_int_pending)1176 2112 A
3330(=)S
3414(0;)S
4464(\\)S
5895 V
(07466)210 1122 A
(break;)252 2112 A
4464(\\)S
5985 V
(07467)210 1122 A
(case)168 1776 A
(SYSTEM:)294 1986 A
4464(\\)S
6075 V
(07468)210 1122 A
(\(m_ptr\)->NOTIFY_ARG)798 2112 A
2952(=)S
(priv\(dst_ptr\)->s_sig_pending;)1218 3036 A
4464(\\)S
6165 V
(07469)210 1122 A
(priv\(dst_ptr\)->s_sig_pending)1176 2112 A
3330(=)S
3414(0;)S
4464(\\)S
6255 V
(07470)210 1122 A
(break;)252 2112 A
4464(\\)S
6345 V
(07471)210 1122 A
1776(})S
6435 V
(07472)210 1122 A
6525 V
(07473)210 1122 A
(#define)294 1440 A
(CopyMess\(s,sp,sm,dp,dm\))966 1776 A
2784(\\)S
6615 V
(07474)210 1122 A
(cp_mess\(s,)420 1776 A
(\(sp\)->p_memmap[D].mem_phys,)1134 2238 A
3456(\\)S
6705 V
(07475)210 1122 A
(\(vir_bytes\)sm,)588 2154 A
(\(dp\)->p_memmap[D].mem_phys,)1134 2784 A
(\(vir_bytes\)dm\))588 3960 A
6795 V
(07476)210 1122 A
8418 V
EP
%%Page: 86 86
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(86)S
11 R
2471(File:)S
2704(kernel/proc.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(07477)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(07478)210 1122 A
1482(*)S
(sys_call)336 2784 A
4674(*)S
1935 V
(07479)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(07480)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(sys_call\(call_nr,)714 1902 A
(src_dst,)336 2658 A
(m_ptr\))252 3036 A
2115 V
(07481)210 1122 A
(int)126 1440 A
(call_nr;)336 1608 A
2784(/*)S
(system)252 2910 A
(call)168 3204 A
(number)252 3414 A
(and)126 3708 A
(flags)210 3876 A
4128(*/)S
2205 V
(07482)210 1122 A
(int)126 1440 A
(src_dst;)336 1608 A
2784(/*)S
(src)126 2910 A
3078(to)S
(receive)294 3204 A
(from)168 3540 A
3750(or)S
(dst)126 3876 A
4044(to)S
(send)168 4170 A
4380(to)S
4506(*/)S
2295 V
(07483)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(message)294 3372 A
3708(in)S
(the)126 3834 A
(caller's)336 4002 A
(space)210 4380 A
4632(*/)S
2385 V
(07484)210 1122 A
1440({)S
2475 V
(07485)210 1122 A
1440(/*)S
(System)252 1566 A
(calls)210 1860 A
(are)126 2112 A
(done)168 2280 A
2490(by)S
(trapping)336 2616 A
2994(to)S
(the)126 3120 A
(kernel)252 3288 A
(with)168 3582 A
3792(an)S
(INT)126 3918 A
(instruction.)504 4086 A
2565 V
(07486)210 1122 A
1482(*)S
(The)126 1566 A
(trap)168 1734 A
1944(is)S
(caught)252 2070 A
(and)126 2364 A
(sys_call\(\))420 2532 A
2994(is)S
(called)252 3120 A
3414(to)S
(send)168 3540 A
3750(or)S
(receive)294 3876 A
4212(a)S
(message)294 4296 A
2655 V
(07487)210 1122 A
1482(*)S
(\(or)126 1566 A
(both\).)252 1734 A
(The)126 2028 A
(caller)252 2196 A
2490(is)S
(always)252 2616 A
(given)210 2910 A
3162(by)S
('proc_ptr'.)462 3288 A
2745 V
(07488)210 1122 A
1482(*/)S
2835 V
(07489)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*caller_ptr)462 2406 A
2910(=)S
(proc_ptr;)378 2994 A
3456(/*)S
(get)126 3582 A
(pointer)294 3750 A
4086(to)S
(caller)252 4212 A
4506(*/)S
2925 V
(07490)210 1122 A
(int)126 1524 A
(function)336 1692 A
2070(=)S
(call_nr)294 2154 A
2490(&)S
(SYSCALL_FUNC;)546 2574 A
3456(/*)S
(get)126 3582 A
(system)252 3750 A
(call)168 4044 A
(function)336 4254 A
4632(*/)S
3015 V
(07491)210 1122 A
(unsigned)336 1524 A
(flags)210 1902 A
2154(=)S
(call_nr)294 2238 A
2574(&)S
(SYSCALL_FLAGS;)588 2658 A
3456(/*)S
(get)126 3582 A
(flags)210 3750 A
4002(*/)S
3105 V
(07492)210 1122 A
(int)126 1524 A
(mask_entry;)462 1692 A
3456(/*)S
(bit)126 3582 A
3750(to)S
(check)210 3876 A
4128(in)S
(send)168 4254 A
(mask)168 4464 A
4674(*/)S
3195 V
(07493)210 1122 A
(int)126 1524 A
(result;)294 1692 A
3456(/*)S
(the)126 3582 A
(system)252 3750 A
(call's)252 4044 A
(result)252 4338 A
4632(*/)S
3285 V
(07494)210 1122 A
(vir_clicks)420 1524 A
(vlo,)168 1986 A
(vhi;)168 2196 A
2784(/*)S
(virtual)294 2910 A
(clicks)252 3246 A
(containing)420 3540 A
(message)294 4002 A
4338(to)S
(send)168 4464 A
4674(*/)S
3375 V
(07495)210 1122 A
3465 V
(07496)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(if)S
(the)126 2028 A
(process)294 2196 A
(has)126 2532 A
(privileges)420 2700 A
(for)126 3162 A
(the)126 3330 A
(requested)378 3498 A
(call.)210 3918 A
(Calls)210 4170 A
4422(to)S
(the)126 4548 A
3555 V
(07497)210 1122 A
1566(*)S
(kernel)252 1650 A
(may)126 1944 A
(only)168 2112 A
2322(be)S
(SENDREC,)336 2448 A
(because)294 2826 A
(tasks)210 3162 A
(always)252 3414 A
(reply)210 3708 A
(and)126 3960 A
(may)126 4128 A
(not)126 4296 A
(block)210 4464 A
3645 V
(07498)210 1122 A
1566(*)S
1650(if)S
(the)126 1776 A
(caller)252 1944 A
(doesn't)294 2238 A
2574(do)S
(receive\(\).)420 2700 A
3735 V
(07499)210 1122 A
1566(*/)S
3825 V
(07500)210 1122 A
1524(if)S
1650(\(!)S
(\(priv\(caller_ptr\)->s_trap_mask)1260 1776 A
3078(&)S
3162(\(1)S
3288(<<)S
(function\)\))420 3414 A
3876(||)S
3915 V
(07501)210 1122 A
(\(iskerneln\(src_dst\))798 1860 A
2700(&&)S
(function)336 2826 A
3204(!=)S
(SENDREC)294 3330 A
4005 V
(07502)210 1122 A
1902(&&)S
(function)336 2028 A
2406(!=)S
(RECEIVE\)\))378 2532 A
2952({)S
4095 V
(07503)210 1122 A
(kprintf\("sys_call:)756 1692 A
(trap)168 2490 A
2700(%d)S
(not)126 2826 A
(allowed,)336 2994 A
(caller)252 3372 A
(%d,)126 3666 A
(src_dst)294 3834 A
(%d\\n",)252 4170 A
4185 V
(07504)210 1122 A
(function,)378 1860 A
(proc_nr\(caller_ptr\),)840 2280 A
(src_dst\);)378 3162 A
4275 V
(07505)210 1122 A
(return\(ECALLDENIED\);)840 1692 A
3120(/*)S
(trap)168 3246 A
(denied)252 3456 A
3750(by)S
(mask)168 3876 A
4086(or)S
(kernel)252 4212 A
4506(*/)S
4365 V
(07506)210 1122 A
1524(})S
4455 V
(07507)210 1122 A
4545 V
(07508)210 1122 A
1524(/*)S
(Require)294 1650 A
1986(a)S
(valid)210 2070 A
(source)252 2322 A
(and/)168 2616 A
2826(or)S
(destination)462 2952 A
(process,)336 3456 A
(unless)252 3834 A
(echoing.)336 4128 A
4506(*/)S
4635 V
(07509)210 1122 A
1524(if)S
1650(\(!)S
(\(isokprocn\(src_dst\))798 1776 A
2616(||)S
(src_dst)294 2742 A
3078(==)S
(ANY)126 3204 A
3372(||)S
(function)336 3498 A
3876(==)S
(ECHO\)\))252 4002 A
4296({)S
4725 V
(07510)210 1122 A
(kprintf\("sys_call:)756 1692 A
(invalid)294 2490 A
(src_dst,)336 2826 A
(src_dst)294 3204 A
(%d,)126 3540 A
(caller)252 3708 A
(%d\\n",)252 4002 A
4815 V
(07511)210 1122 A
(src_dst,)336 1860 A
(proc_nr\(caller_ptr\)\);)882 2238 A
4905 V
(07512)210 1122 A
(return\(EBADSRCDST\);)798 1692 A
3120(/*)S
(invalid)294 3246 A
(process)294 3582 A
(number)252 3918 A
4212(*/)S
4995 V
(07513)210 1122 A
1524(})S
5085 V
(07514)210 1122 A
5175 V
(07515)210 1122 A
1524(/*)S
1650(If)S
(the)126 1776 A
(call)168 1944 A
(involves)336 2154 A
2532(a)S
(message)294 2616 A
(buffer,)294 2952 A
(i.e.,)210 3288 A
(for)126 3540 A
(SEND,)210 3708 A
(RECEIVE,)336 3960 A
(SENDREC,)336 4338 A
5265 V
(07516)210 1122 A
1566(*)S
1650(or)S
(ECHO,)210 1776 A
(check)210 2028 A
(the)126 2280 A
(message)294 2448 A
(pointer.)336 2784 A
(This)168 3162 A
(check)210 3372 A
(allows)252 3624 A
3918(a)S
(message)294 4002 A
4338(to)S
4464(be)S
5355 V
(07517)210 1122 A
1566(*)S
(anywhere)336 1650 A
2028(in)S
(data)168 2154 A
2364(or)S
(stack)210 2490 A
2742(or)S
(gap.)168 2868 A
3078(It)S
(will)168 3204 A
(have)168 3414 A
3624(to)S
3750(be)S
(made)168 3876 A
(more)168 4086 A
(elaborate)378 4296 A
5445 V
(07518)210 1122 A
1566(*)S
(for)126 1650 A
(machines)336 1818 A
(which)210 2196 A
(don't)210 2448 A
(have)168 2700 A
(the)126 2910 A
(gap)126 3078 A
(mapped.)294 3246 A
5535 V
(07519)210 1122 A
1566(*/)S
5625 V
(07520)210 1122 A
1524(if)S
(\(function)378 1650 A
2070(&)S
(CHECK_PTR\))420 2154 A
2616({)S
5715 V
(07521)210 1122 A
(vlo)126 1692 A
1860(=)S
(\(vir_bytes\))462 1944 A
(m_ptr)210 2448 A
2700(>>)S
(CLICK_SHIFT;)504 2826 A
5805 V
(07522)210 1122 A
(vhi)126 1692 A
1860(=)S
(\(\(vir_bytes\))504 1944 A
(m_ptr)210 2490 A
2742(+)S
(MESS_SIZE)378 2826 A
3246(-)S
3330(1\))S
3456(>>)S
(CLICK_SHIFT;)504 3582 A
5895 V
(07523)210 1122 A
1692(if)S
(\(vlo)168 1818 A
2028(<)S
(caller_ptr->p_memmap[D].mem_vir)1302 2112 A
3456(||)S
(vlo)126 3582 A
3750(>)S
(vhi)126 3834 A
4002(||)S
5985 V
(07524)210 1122 A
(vhi)126 2028 A
2196(>=)S
(caller_ptr->p_memmap[S].mem_vir)1302 2322 A
3666(+)S
6075 V
(07525)210 1122 A
(caller_ptr->p_memmap[S].mem_len\))1344 2028 A
3414({)S
6165 V
(07526)210 1122 A
(kprintf\("sys_call:)756 1860 A
(invalid)294 2658 A
(message)294 2994 A
(pointer,)336 3330 A
(trap)168 3708 A
(%d,)126 3918 A
(caller)252 4086 A
(%d\\n",)252 4380 A
6255 V
(07527)210 1122 A
(function,)378 2112 A
(proc_nr\(caller_ptr\)\);)882 2532 A
6345 V
(07528)210 1122 A
(return\(EFAULT\);)630 1860 A
3120(/*)S
(invalid)294 3246 A
(message)294 3582 A
(pointer)294 3918 A
4254(*/)S
6435 V
(07529)210 1122 A
1692(})S
6525 V
(07530)210 1122 A
1524(})S
6615 V
(07531)210 1122 A
6705 V
(07532)210 1122 A
1524(/*)S
1650(If)S
(the)126 1776 A
(call)168 1944 A
2154(is)S
2280(to)S
(send)168 2406 A
2616(to)S
2742(a)S
(process,)336 2826 A
(i.e.,)210 3204 A
(for)126 3456 A
(SEND,)210 3624 A
(SENDREC)294 3876 A
4212(or)S
(NOTIFY,)294 4338 A
6795 V
(07533)210 1122 A
1566(*)S
(verify)252 1650 A
(that)168 1944 A
(the)126 2154 A
(caller)252 2322 A
2616(is)S
(allowed)294 2742 A
3078(to)S
(send)168 3204 A
3414(to)S
(the)126 3540 A
(given)210 3708 A
(destination)462 3960 A
(and)126 4464 A
6885 V
(07534)210 1122 A
1566(*)S
(that)168 1650 A
(the)126 1860 A
(destination)462 2028 A
2532(is)S
(still)210 2658 A
(alive.)252 2910 A
6975 V
(07535)210 1122 A
1566(*/)S
7065 V
(07536)210 1122 A
1524(if)S
(\(function)378 1650 A
2070(&)S
(CHECK_DST\))420 2154 A
2616({)S
8418 V
EP
%%Page: 87 87
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2471(File:)S
2704(kernel/proc.c)S
12 B
4560(87)S
1755 V
7 LST
(07537)210 1122 A
1692(if)S
1818(\(!)S
(get_sys_bit\(priv\(caller_ptr\)->s_ipc_to,)1638 1944 A
(nr_to_id\(src_dst\)\)\))798 3624 A
4464({)S
1845 V
(07538)210 1122 A
(kprintf\("sys_call:)756 1860 A
(ipc)126 2658 A
(mask)168 2826 A
(denied)252 3036 A
3330(%d)S
(sending)294 3456 A
3792(to)S
(%d\\n",)252 3918 A
1935 V
(07539)210 1122 A
(proc_nr\(caller_ptr\),)840 2112 A
(src_dst\);)378 2994 A
2025 V
(07540)210 1122 A
(return\(ECALLDENIED\);)840 1860 A
3120(/*)S
(call)168 3246 A
(denied)252 3456 A
3750(by)S
(ipc)126 3876 A
(mask)168 4044 A
4254(*/)S
2115 V
(07541)210 1122 A
1692(})S
2205 V
(07542)210 1122 A
2295 V
(07543)210 1122 A
1692(if)S
(\(isemptyn\(src_dst\))756 1818 A
2616(&&)S
(!shutdown_started\))756 2742 A
3540({)S
2385 V
(07544)210 1122 A
(kprintf\("sys_call:)756 1860 A
(dead)168 2658 A
(dest;)210 2868 A
(%d,)126 3120 A
(%d,)126 3288 A
(%d\\n",)252 3456 A
2475 V
(07545)210 1122 A
(function,)378 2028 A
(proc_nr\(caller_ptr\),)840 2448 A
(src_dst\);)378 3330 A
2565 V
(07546)210 1122 A
(return\(EDEADDST\);)714 1860 A
3120(/*)S
(cannot)252 3246 A
(send)168 3540 A
3750(to)S
(the)126 3876 A
(dead)168 4044 A
4254(*/)S
2655 V
(07547)210 1122 A
1692(})S
2745 V
(07548)210 1122 A
1524(})S
2835 V
(07549)210 1122 A
2925 V
(07550)210 1122 A
1524(/*)S
(Now)126 1650 A
(check)210 1818 A
2070(if)S
(the)126 2196 A
(call)168 2364 A
2574(is)S
(known)210 2700 A
(and)126 2952 A
(try)126 3120 A
3288(to)S
(perform)294 3414 A
(the)126 3750 A
(request.)336 3918 A
(The)126 4296 A
(only)168 4464 A
3015 V
(07551)210 1122 A
1566(*)S
(system)252 1650 A
(calls)210 1944 A
(that)168 2196 A
(exist)210 2406 A
2658(in)S
(MINIX)210 2784 A
(are)126 3036 A
(sending)294 3204 A
(and)126 3540 A
(receiving)378 3708 A
(messages.)378 4128 A
3105 V
(07552)210 1122 A
1566(*)S
1734(-)S
(SENDREC:)336 1818 A
(combines)336 2196 A
(SEND)168 2574 A
(and)126 2784 A
(RECEIVE)294 2952 A
3288(in)S
3414(a)S
(single)252 3498 A
(system)252 3792 A
(call)168 4086 A
3195 V
(07553)210 1122 A
1566(*)S
1734(-)S
(SEND:)210 1818 A
(sender)252 2196 A
(blocks)252 2490 A
(until)210 2784 A
(its)126 3036 A
(message)294 3204 A
(has)126 3540 A
(been)168 3708 A
(delivered)378 3918 A
3285 V
(07554)210 1122 A
1566(*)S
1734(-)S
(RECEIVE:)336 1818 A
(receiver)336 2196 A
(blocks)252 2574 A
(until)210 2868 A
3120(an)S
(acceptable)420 3246 A
(message)294 3708 A
(has)126 4044 A
(arrived)294 4212 A
3375 V
(07555)210 1122 A
1566(*)S
1734(-)S
(NOTIFY:)294 1818 A
(nonblocking)462 2196 A
(call;)210 2700 A
(deliver)294 2952 A
(notification)504 3288 A
3834(or)S
(mark)168 3960 A
(pending)294 4170 A
3465 V
(07556)210 1122 A
1566(*)S
1734(-)S
(ECHO:)210 1818 A
(nonblocking)462 2196 A
(call;)210 2700 A
(directly)336 2952 A
(echo)168 3330 A
(back)168 3540 A
(the)126 3750 A
(message)294 3918 A
3555 V
(07557)210 1122 A
1566(*/)S
3645 V
(07558)210 1122 A
(switch\(function\))672 1524 A
2238({)S
3735 V
(07559)210 1122 A
(case)168 1524 A
(SENDREC:)336 1734 A
3825 V
(07560)210 1122 A
1692(/*)S
1818(A)S
(flag)168 1902 A
2112(is)S
(set)126 2238 A
2406(so)S
(that)168 2532 A
(notifications)546 2742 A
(cannot)252 3330 A
(interrupt)378 3624 A
(SENDREC.)336 4044 A
4422(*/)S
3915 V
(07561)210 1122 A
(priv\(caller_ptr\)->s_flags)1050 1692 A
2784(|=)S
(SENDREC_BUSY;)546 2910 A
4005 V
(07562)210 1122 A
1692(/*)S
(fall)168 1818 A
(through)294 2028 A
2364(*/)S
4095 V
(07563)210 1122 A
(case)168 1524 A
(SEND:)210 1734 A
4185 V
(07564)210 1122 A
(result)252 1692 A
1986(=)S
(mini_send\(caller_ptr,)882 2070 A
(src_dst,)336 2994 A
(m_ptr,)252 3372 A
(flags\);)294 3666 A
4275 V
(07565)210 1122 A
1692(if)S
(\(function)378 1818 A
2238(==)S
(SEND)168 2364 A
2574(||)S
(result)252 2700 A
2994(!=)S
(OK\))126 3120 A
3288({)S
4365 V
(07566)210 1122 A
(break;)252 1860 A
3456(/*)S
(done,)210 3582 A
3834(or)S
(SEND)168 3960 A
(failed)252 4170 A
4464(*/)S
4455 V
(07567)210 1122 A
1692(})S
3456(/*)S
(fall)168 3582 A
(through)294 3792 A
(for)126 4128 A
(SENDREC)294 4296 A
4632(*/)S
4545 V
(07568)210 1122 A
(case)168 1524 A
(RECEIVE:)336 1734 A
4635 V
(07569)210 1122 A
1692(if)S
(\(function)378 1818 A
2238(==)S
(RECEIVE\))336 2364 A
4725 V
(07570)210 1122 A
(priv\(caller_ptr\)->s_flags)1050 1860 A
2952(&=)S
(\304SENDREC_BUSY;)588 3078 A
4815 V
(07571)210 1122 A
(result)252 1692 A
1986(=)S
(mini_receive\(caller_ptr,)1008 2070 A
(src_dst,)336 3120 A
(m_ptr,)252 3498 A
(flags\);)294 3792 A
4905 V
(07572)210 1122 A
(break;)252 1692 A
4995 V
(07573)210 1122 A
(case)168 1524 A
(NOTIFY:)294 1734 A
5085 V
(07574)210 1122 A
(result)252 1692 A
1986(=)S
(mini_notify\(caller_ptr,)966 2070 A
(src_dst\);)378 3078 A
5175 V
(07575)210 1122 A
(break;)252 1692 A
5265 V
(07576)210 1122 A
(case)168 1524 A
(ECHO:)210 1734 A
5355 V
(07577)210 1122 A
(CopyMess\(caller_ptr->p_nr,)1092 1692 A
(caller_ptr,)462 2826 A
(m_ptr,)252 3330 A
(caller_ptr,)462 3624 A
(m_ptr\);)294 4128 A
5445 V
(07578)210 1122 A
(result)252 1692 A
1986(=)S
(OK;)126 2070 A
5535 V
(07579)210 1122 A
(break;)252 1692 A
5625 V
(07580)210 1122 A
(default:)336 1524 A
5715 V
(07581)210 1122 A
(result)252 1692 A
1986(=)S
(EBADCALL;)378 2070 A
3456(/*)S
(illegal)294 3582 A
(system)252 3918 A
(call)168 4212 A
4422(*/)S
5805 V
(07582)210 1122 A
1524(})S
5895 V
(07583)210 1122 A
5985 V
(07584)210 1122 A
1524(/*)S
(Now,)168 1650 A
(return)252 1860 A
(the)126 2154 A
(result)252 2322 A
2616(of)S
(the)126 2742 A
(system)252 2910 A
(call)168 3204 A
3414(to)S
(the)126 3540 A
(caller.)294 3708 A
4044(*/)S
6075 V
(07585)210 1122 A
(return\(result\);)630 1524 A
6165 V
(07586)210 1122 A
1440(})S
6345 V
(07588)210 1122 A
(/*===========================================================================*)3276 1440 A
6435 V
(07589)210 1122 A
1482(*)S
(mini_send)378 2784 A
4674(*)S
6525 V
(07590)210 1122 A
(*===========================================================================*/)3276 1482 A
6615 V
(07591)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(mini_send\(caller_ptr,)882 1944 A
(dst,)168 2868 A
(m_ptr,)252 3078 A
(flags\))252 3372 A
6705 V
(07592)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(proc)168 2112 A
(*caller_ptr;)504 2322 A
3120(/*)S
(who)126 3246 A
3414(is)S
(trying)252 3540 A
3834(to)S
(send)168 3960 A
4170(a)S
(message?)336 4254 A
4632(*/)S
6795 V
(07593)210 1122 A
(int)126 1440 A
(dst;)168 1608 A
3120(/*)S
3246(to)S
(whom)168 3372 A
3582(is)S
(message)294 3708 A
(being)210 4044 A
(sent?)210 4296 A
4548(*/)S
6885 V
(07594)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
3120(/*)S
(pointer)294 3246 A
3582(to)S
(message)294 3708 A
(buffer)252 4044 A
4338(*/)S
6975 V
(07595)210 1122 A
(unsigned)336 1440 A
(flags;)252 1818 A
3120(/*)S
(system)252 3246 A
(call)168 3540 A
(flags)210 3750 A
4002(*/)S
7065 V
(07596)210 1122 A
1440({)S
8418 V
EP
%%Page: 88 88
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(88)S
11 R
2471(File:)S
2704(kernel/proc.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(07597)210 1122 A
1440(/*)S
(Send)168 1566 A
1776(a)S
(message)294 1860 A
(from)168 2196 A
('caller_ptr')504 2406 A
2952(to)S
('dst'.)252 3078 A
3372(If)S
('dst')210 3498 A
3750(is)S
(blocked)294 3876 A
(waiting)294 4212 A
1845 V
(07598)210 1122 A
1482(*)S
(for)126 1566 A
(this)168 1734 A
(message,)336 1944 A
(copy)168 2322 A
(the)126 2532 A
(message)294 2700 A
3036(to)S
3162(it)S
(and)126 3288 A
(unblock)294 3456 A
('dst'.)252 3792 A
4086(If)S
('dst')210 4212 A
4464(is)S
1935 V
(07599)210 1122 A
1482(*)S
(not)126 1566 A
(waiting)294 1734 A
2070(at)S
(all,)168 2196 A
2406(or)S
2532(is)S
(waiting)294 2658 A
(for)126 2994 A
(another)294 3162 A
(source,)294 3498 A
(queue)210 3834 A
('caller_ptr'.)546 4086 A
2025 V
(07600)210 1122 A
1482(*/)S
2115 V
(07601)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*dst_ptr)336 2406 A
2784(=)S
(proc_addr\(dst\);)630 2868 A
2205 V
(07602)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(**xpp;)252 2406 A
2295 V
(07603)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*xp;)168 2406 A
2385 V
(07604)210 1122 A
2475 V
(07605)210 1122 A
1524(/*)S
(Check)210 1650 A
(for)126 1902 A
(deadlock)336 2070 A
2448(by)S
('caller_ptr')504 2574 A
(and)126 3120 A
('dst')210 3288 A
(sending)294 3540 A
3876(to)S
(each)168 4002 A
(other.)252 4212 A
4506(*/)S
2565 V
(07606)210 1122 A
1524(xp)S
1650(=)S
(dst_ptr;)336 1734 A
2655 V
(07607)210 1122 A
(while)210 1524 A
(\(xp->p_rts_flags)672 1776 A
2490(&)S
(SENDING\))336 2574 A
2952({)S
3456(/*)S
(check)210 3582 A
(while)210 3834 A
(sending)294 4086 A
4422(*/)S
2745 V
(07608)210 1122 A
1776(xp)S
1902(=)S
(proc_addr\(xp->p_sendto\);)1008 1986 A
3456(/*)S
(get)126 3582 A
(xp's)168 3750 A
(destination)462 3960 A
4464(*/)S
2835 V
(07609)210 1122 A
1776(if)S
(\(xp)126 1902 A
2070(==)S
(caller_ptr\))462 2196 A
(return\(ELOCKED\);)672 2700 A
3456(/*)S
(deadlock)336 3582 A
3960(if)S
(cyclic)252 4086 A
4380(*/)S
2925 V
(07610)210 1122 A
1524(})S
3015 V
(07611)210 1122 A
3105 V
(07612)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(if)S
('dst')210 2028 A
2280(is)S
(blocked)294 2406 A
(waiting)294 2742 A
(for)126 3078 A
(this)168 3246 A
(message.)336 3456 A
(The)126 3834 A
(destination's)546 4002 A
3195 V
(07613)210 1122 A
1566(*)S
(SENDING)294 1650 A
(flag)168 1986 A
(may)126 2196 A
2364(be)S
(set)126 2490 A
(when)168 2658 A
(its)126 2868 A
(SENDREC)294 3036 A
(call)168 3372 A
(blocked)294 3582 A
(while)210 3918 A
(sending.)336 4170 A
3285 V
(07614)210 1122 A
1566(*/)S
3375 V
(07615)210 1122 A
1524(if)S
1650(\()S
(\(dst_ptr->p_rts_flags)882 1734 A
2658(&)S
(\(RECEIVING)420 2742 A
3204(|)S
(SENDING\)\))378 3288 A
3708(==)S
(RECEIVING)378 3834 A
4254(&&)S
3465 V
(07616)210 1122 A
(\(dst_ptr->p_getfrom)798 1734 A
2574(==)S
(ANY)126 2700 A
2868(||)S
(dst_ptr->p_getfrom)756 2994 A
3792(==)S
(caller_ptr->p_nr\)\))756 3918 A
4716({)S
3555 V
(07617)210 1122 A
1776(/*)S
(Destination)462 1902 A
2406(is)S
(indeed)252 2532 A
(waiting)294 2826 A
(for)126 3162 A
(this)168 3330 A
(message.)336 3540 A
3918(*/)S
3645 V
(07618)210 1122 A
(CopyMess\(caller_ptr->p_nr,)1092 1776 A
(caller_ptr,)462 2910 A
(m_ptr,)252 3414 A
(dst_ptr,)336 3708 A
3735 V
(07619)210 1122 A
(dst_ptr->p_messbuf\);)840 2154 A
3825 V
(07620)210 1122 A
1776(if)S
(\(\(dst_ptr->p_rts_flags)924 1902 A
2868(&=)S
(\304RECEIVING\))462 2994 A
3498(==)S
3624(0\))S
(enqueue\(dst_ptr\);)714 3750 A
3915 V
(07621)210 1122 A
1524(})S
(else)168 1608 A
1818(if)S
1944(\()S
2028(!)S
(\(flags)252 2112 A
2406(&)S
(NON_BLOCKING\)\))588 2490 A
3120({)S
4005 V
(07622)210 1122 A
1776(/*)S
(Destination)462 1902 A
2406(is)S
(not)126 2532 A
(waiting.)336 2700 A
(Block)210 3120 A
(and)126 3372 A
(dequeue)294 3540 A
(caller.)294 3876 A
4212(*/)S
4095 V
(07623)210 1122 A
(caller_ptr->p_messbuf)882 1776 A
2700(=)S
(m_ptr;)252 2784 A
4185 V
(07624)210 1122 A
1776(if)S
(\(caller_ptr->p_rts_flags)1008 1902 A
2952(==)S
3078(0\))S
(dequeue\(caller_ptr\);)840 3204 A
4275 V
(07625)210 1122 A
(caller_ptr->p_rts_flags)966 1776 A
2784(|=)S
(SENDING;)336 2910 A
4365 V
(07626)210 1122 A
(caller_ptr->p_sendto)840 1776 A
2658(=)S
(dst;)168 2742 A
4455 V
(07627)210 1122 A
4545 V
(07628)210 1122 A
1776(/*)S
(Process)294 1902 A
2238(is)S
(now)126 2364 A
(blocked.)336 2532 A
(Put)126 2952 A
3120(in)S
3246(on)S
(the)126 3372 A
(destination's)546 3540 A
(queue.)252 4128 A
4422(*/)S
4635 V
(07629)210 1122 A
(xpp)126 1776 A
1944(=)S
(&dst_ptr->p_caller_q;)882 2028 A
3456(/*)S
(find)168 3582 A
(end)126 3792 A
3960(of)S
(list)168 4086 A
4296(*/)S
4725 V
(07630)210 1122 A
(while)210 1776 A
(\(*xpp)210 2028 A
2280(!=)S
(NIL_PROC\))378 2406 A
(xpp)126 2826 A
2994(=)S
(&\(*xpp\)->p_q_link;)756 3078 A
4815 V
(07631)210 1122 A
(*xpp)168 1776 A
1986(=)S
(caller_ptr;)462 2070 A
3456(/*)S
(add)126 3582 A
(caller)252 3750 A
4044(to)S
(end)126 4170 A
4338(*/)S
4905 V
(07632)210 1122 A
(caller_ptr->p_q_link)840 1776 A
2658(=)S
(NIL_PROC;)378 2742 A
3456(/*)S
(mark)168 3582 A
(new)126 3792 A
(end)126 3960 A
4128(of)S
(list)168 4254 A
4464(*/)S
4995 V
(07633)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
5085 V
(07634)210 1122 A
(return\(ENOTREADY\);)756 1776 A
5175 V
(07635)210 1122 A
1524(})S
5265 V
(07636)210 1122 A
(return\(OK\);)462 1524 A
5355 V
(07637)210 1122 A
1440(})S
5535 V
(07639)210 1122 A
(/*===========================================================================*)3276 1440 A
5625 V
(07640)210 1122 A
1482(*)S
(mini_receive)504 2784 A
4674(*)S
5715 V
(07641)210 1122 A
(*===========================================================================*/)3276 1482 A
5805 V
(07642)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(mini_receive\(caller_ptr,)1008 1944 A
(src,)168 2994 A
(m_ptr,)252 3204 A
(flags\))252 3498 A
5895 V
(07643)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(proc)168 2112 A
(*caller_ptr;)504 2322 A
3120(/*)S
(process)294 3246 A
(trying)252 3582 A
3876(to)S
(get)126 4002 A
(message)294 4170 A
4506(*/)S
5985 V
(07644)210 1122 A
(int)126 1440 A
(src;)168 1608 A
3120(/*)S
(which)210 3246 A
(message)294 3498 A
(source)252 3834 A
4128(is)S
(wanted)252 4254 A
4548(*/)S
6075 V
(07645)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
3120(/*)S
(pointer)294 3246 A
3582(to)S
(message)294 3708 A
(buffer)252 4044 A
4338(*/)S
6165 V
(07646)210 1122 A
(unsigned)336 1440 A
(flags;)252 1818 A
3120(/*)S
(system)252 3246 A
(call)168 3540 A
(flags)210 3750 A
4002(*/)S
6255 V
(07647)210 1122 A
1440({)S
6345 V
(07648)210 1122 A
1440(/*)S
1566(A)S
(process)294 1650 A
1986(or)S
(task)168 2112 A
(wants)210 2322 A
2574(to)S
(get)126 2700 A
2868(a)S
(message.)336 2952 A
3372(If)S
3498(a)S
(message)294 3582 A
3918(is)S
(already)294 4044 A
(queued,)294 4380 A
6435 V
(07649)210 1122 A
1482(*)S
(acquire)294 1566 A
1902(it)S
(and)126 2028 A
(deblock)294 2196 A
(the)126 2532 A
(sender.)294 2700 A
3078(If)S
3204(no)S
(message)294 3330 A
(from)168 3666 A
(the)126 3876 A
(desired)294 4044 A
(source)252 4380 A
6525 V
(07650)210 1122 A
1482(*)S
1566(is)S
(available)378 1692 A
(block)210 2112 A
(the)126 2364 A
(caller,)294 2532 A
(unless)252 2868 A
(the)126 3162 A
(flags)210 3330 A
(don't)210 3582 A
(allow)210 3834 A
(blocking.)378 4086 A
6615 V
(07651)210 1122 A
1482(*/)S
6705 V
(07652)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(**xpp;)252 2406 A
6795 V
(07653)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(notification)504 2196 A
(**ntf_q_pp;)462 2742 A
6885 V
(07654)210 1122 A
(message)294 1524 A
1860(m;)S
6975 V
(07655)210 1122 A
(int)126 1524 A
(bit_nr;)294 1692 A
7065 V
(07656)210 1122 A
(sys_map_t)378 1524 A
(*map;)210 1944 A
8418 V
EP
%%Page: 89 89
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2471(File:)S
2704(kernel/proc.c)S
12 B
4560(89)S
1755 V
7 LST
(07657)210 1122 A
(bitchunk_t)420 1524 A
(*chunk;)294 1986 A
1845 V
(07658)210 1122 A
(int)126 1524 A
1692(i,)S
(src_id,)294 1818 A
(src_proc_nr;)504 2154 A
1935 V
(07659)210 1122 A
2025 V
(07660)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(to)S
(see)126 2028 A
2196(if)S
2322(a)S
(message)294 2406 A
(from)168 2742 A
(desired)294 2952 A
(source)252 3288 A
3582(is)S
(already)294 3708 A
(available.)420 4044 A
2115 V
(07661)210 1122 A
1566(*)S
(The)126 1650 A
(caller's)336 1818 A
(SENDING)294 2196 A
(flag)168 2532 A
(may)126 2742 A
2910(be)S
(set)126 3036 A
3204(if)S
(SENDREC)294 3330 A
(couldn't)336 3666 A
(send.)210 4044 A
4296(If)S
4422(it)S
4548(is)S
2205 V
(07662)210 1122 A
1566(*)S
(set,)168 1650 A
(the)126 1860 A
(process)294 2028 A
(should)252 2364 A
2658(be)S
(blocked.)336 2784 A
2295 V
(07663)210 1122 A
1566(*/)S
2385 V
(07664)210 1122 A
1524(if)S
(\(!\(caller_ptr->p_rts_flags)1092 1650 A
2784(&)S
(SENDING\)\))378 2868 A
3288({)S
2475 V
(07665)210 1122 A
2565 V
(07666)210 1122 A
1608(/*)S
(Check)210 1734 A
1986(if)S
(there)210 2112 A
(are)126 2364 A
(pending)294 2532 A
(notifications,)588 2868 A
(except)252 3498 A
(for)126 3792 A
(SENDREC.)336 3960 A
4338(*/)S
2655 V
(07667)210 1122 A
1608(if)S
1734(\(!)S
(\(priv\(caller_ptr\)->s_flags)1092 1860 A
2994(&)S
(SENDREC_BUSY\)\))588 3078 A
3708({)S
2745 V
(07668)210 1122 A
2835 V
(07669)210 1122 A
(map)126 1776 A
1944(=)S
(&priv\(caller_ptr\)->s_notify_pending;)1512 2028 A
2925 V
(07670)210 1122 A
(for)126 1776 A
(\(chunk=&map->chunk[0];)924 1944 A
(chunk<&map->chunk[NR_SYS_CHUNKS];)1386 2910 A
(chunk++\))336 4338 A
4716({)S
3015 V
(07671)210 1122 A
3105 V
(07672)210 1122 A
1944(/*)S
(Find)168 2070 A
2280(a)S
(pending)294 2364 A
(notification)504 2700 A
(from)168 3246 A
(the)126 3456 A
(requested)378 3624 A
(source.)294 4044 A
4380(*/)S
3195 V
(07673)210 1122 A
1944(if)S
2070(\(!)S
(*chunk\))294 2196 A
(continue;)378 2532 A
3792(/*)S
3918(no)S
(bits)168 4044 A
4254(in)S
(chunk)210 4380 A
4632(*/)S
3285 V
(07674)210 1122 A
(for)126 1944 A
(\(i=0;)210 2112 A
2364(!)S
(\(*chunk)294 2448 A
2784(&)S
(\(1<<i\)\);)336 2868 A
(++i\))168 3246 A
3456({})S
3792(/*)S
(look)168 3918 A
4128(up)S
(the)126 4254 A
(bit)126 4422 A
4590(*/)S
3375 V
(07675)210 1122 A
(src_id)252 1944 A
2238(=)S
(\(chunk)252 2322 A
2616(-)S
(&map->chunk[0]\))630 2700 A
3372(*)S
(BITCHUNK_BITS)546 3456 A
4044(+)S
4128(i;)S
3465 V
(07676)210 1122 A
1944(if)S
(\(src_id)294 2070 A
2406(>=)S
(NR_SYS_PROCS\))546 2532 A
(break;)252 3120 A
3792(/*)S
(out)126 3918 A
4086(of)S
(range)210 4212 A
4464(*/)S
3555 V
(07677)210 1122 A
(src_proc_nr)462 1944 A
2448(=)S
(id_to_nr\(src_id\);)714 2532 A
3792(/*)S
(get)126 3918 A
(source)252 4086 A
(proc)168 4380 A
4590(*/)S
3645 V
(07678)210 1122 A
1944(if)S
(\(src!=ANY)378 2070 A
2490(&&)S
(src!=src_proc_nr\))714 2616 A
(continue;)378 3372 A
3792(/*)S
(source)252 3918 A
(not)126 4212 A
4380(ok)S
4506(*/)S
3735 V
(07679)210 1122 A
(*chunk)252 1944 A
2238(&=)S
(\304\(1)126 2364 A
2532(<<)S
(i\);)126 2658 A
3792(/*)S
3918(no)S
(longer)252 4044 A
(pending)294 4338 A
4674(*/)S
3825 V
(07680)210 1122 A
3915 V
(07681)210 1122 A
1944(/*)S
(Found)210 2070 A
2322(a)S
(suitable)336 2406 A
(source,)294 2784 A
(deliver)294 3120 A
(the)126 3456 A
(notification)504 3624 A
(message.)336 4170 A
4548(*/)S
4005 V
(07682)210 1122 A
(BuildMess\(&m,)546 1944 A
(src_proc_nr,)504 2532 A
(caller_ptr\);)504 3078 A
3792(/*)S
(assemble)336 3918 A
(message)294 4296 A
4632(*/)S
4095 V
(07683)210 1122 A
(CopyMess\(src_proc_nr,)882 1944 A
(proc_addr\(HARDWARE\),)840 2868 A
(&m,)126 3750 A
(caller_ptr,)462 3918 A
(m_ptr\);)294 4422 A
4185 V
(07684)210 1122 A
(return\(OK\);)462 1944 A
3792(/*)S
(report)252 3918 A
(success)294 4212 A
4548(*/)S
4275 V
(07685)210 1122 A
1776(})S
4365 V
(07686)210 1122 A
1608(})S
4455 V
(07687)210 1122 A
4545 V
(07688)210 1122 A
1608(/*)S
(Check)210 1734 A
(caller)252 1986 A
(queue.)252 2280 A
(Use)126 2574 A
(pointer)294 2742 A
(pointers)336 3078 A
3456(to)S
(keep)168 3582 A
(code)168 3792 A
(simple.)294 4002 A
4338(*/)S
4635 V
(07689)210 1122 A
(xpp)126 1608 A
1776(=)S
(&caller_ptr->p_caller_q;)1008 1860 A
4725 V
(07690)210 1122 A
(while)210 1608 A
(\(*xpp)210 1860 A
2112(!=)S
(NIL_PROC\))378 2238 A
2658({)S
4815 V
(07691)210 1122 A
1776(if)S
(\(src)168 1902 A
2112(==)S
(ANY)126 2238 A
2406(||)S
(src)126 2532 A
2700(==)S
(proc_nr\(*xpp\)\))588 2826 A
3456({)S
4905 V
(07692)210 1122 A
1944(/*)S
(Found)210 2070 A
(acceptable)420 2322 A
(message.)336 2784 A
(Copy)168 3162 A
3372(it)S
(and)126 3498 A
(update)252 3666 A
(status.)294 3960 A
4296(*/)S
4995 V
(07693)210 1122 A
(CopyMess\(\(*xpp\)->p_nr,)924 1944 A
(*xpp,)210 2910 A
(\(*xpp\)->p_messbuf,)756 3162 A
(caller_ptr,)462 3960 A
(m_ptr\);)294 4464 A
5085 V
(07694)210 1122 A
1944(if)S
(\(\(\(*xpp\)->p_rts_flags)882 2070 A
2994(&=)S
(\304SENDING\))378 3120 A
3540(==)S
3666(0\))S
(enqueue\(*xpp\);)588 3792 A
5175 V
(07695)210 1122 A
(*xpp)168 1944 A
2154(=)S
(\(*xpp\)->p_q_link;)714 2238 A
3456(/*)S
(remove)252 3582 A
(from)168 3876 A
(queue)210 4086 A
4338(*/)S
5265 V
(07696)210 1122 A
(return\(OK\);)462 1944 A
3456(/*)S
(report)252 3582 A
(success)294 3876 A
4212(*/)S
5355 V
(07697)210 1122 A
1776(})S
5445 V
(07698)210 1122 A
(xpp)126 1776 A
1944(=)S
(&\(*xpp\)->p_q_link;)756 2028 A
3456(/*)S
(proceed)294 3582 A
3918(to)S
(next)168 4044 A
4254(*/)S
5535 V
(07699)210 1122 A
1608(})S
5625 V
(07700)210 1122 A
1524(})S
5715 V
(07701)210 1122 A
5805 V
(07702)210 1122 A
1524(/*)S
1650(No)S
(suitable)336 1776 A
(message)294 2154 A
2490(is)S
(available)378 2616 A
3036(or)S
(the)126 3162 A
(caller)252 3330 A
(couldn't)336 3624 A
(send)168 4002 A
4212(in)S
(SENDREC.)336 4338 A
5895 V
(07703)210 1122 A
1566(*)S
(Block)210 1650 A
(the)126 1902 A
(process)294 2070 A
(trying)252 2406 A
2700(to)S
(receive,)336 2826 A
(unless)252 3204 A
(the)126 3498 A
(flags)210 3666 A
(tell)168 3918 A
(otherwise.)420 4128 A
5985 V
(07704)210 1122 A
1566(*/)S
6075 V
(07705)210 1122 A
1524(if)S
1650(\()S
1734(!)S
(\(flags)252 1818 A
2112(&)S
(NON_BLOCKING\)\))588 2196 A
2826({)S
6165 V
(07706)210 1122 A
(caller_ptr->p_getfrom)882 1692 A
2616(=)S
(src;)168 2700 A
6255 V
(07707)210 1122 A
(caller_ptr->p_messbuf)882 1692 A
2616(=)S
(m_ptr;)252 2700 A
6345 V
(07708)210 1122 A
1692(if)S
(\(caller_ptr->p_rts_flags)1008 1818 A
2868(==)S
2994(0\))S
(dequeue\(caller_ptr\);)840 3120 A
6435 V
(07709)210 1122 A
(caller_ptr->p_rts_flags)966 1692 A
2700(|=)S
(RECEIVING;)420 2826 A
6525 V
(07710)210 1122 A
(return\(OK\);)462 1692 A
6615 V
(07711)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
6705 V
(07712)210 1122 A
(return\(ENOTREADY\);)756 1692 A
6795 V
(07713)210 1122 A
1524(})S
6885 V
(07714)210 1122 A
1440(})S
8418 V
EP
%%Page: 90 90
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(90)S
11 R
2471(File:)S
2704(kernel/proc.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(07716)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(07717)210 1122 A
1482(*)S
(mini_notify)462 2784 A
4674(*)S
1935 V
(07718)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(07719)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(mini_notify\(caller_ptr,)966 1944 A
(dst\))168 2952 A
2115 V
(07720)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(proc)168 2112 A
(*caller_ptr;)504 2322 A
3120(/*)S
(sender)252 3246 A
3540(of)S
(the)126 3666 A
(notification)504 3834 A
4380(*/)S
2205 V
(07721)210 1122 A
(int)126 1440 A
(dst;)168 1608 A
3120(/*)S
(which)210 3246 A
(process)294 3498 A
3834(to)S
(notify)252 3960 A
4254(*/)S
2295 V
(07722)210 1122 A
1440({)S
2385 V
(07723)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*dst_ptr)336 2406 A
2784(=)S
(proc_addr\(dst\);)630 2868 A
2475 V
(07724)210 1122 A
(int)126 1524 A
(src_id;)294 1692 A
3120(/*)S
(source)252 3246 A
3540(id)S
(for)126 3666 A
(late)168 3834 A
(delivery)336 4044 A
4422(*/)S
2565 V
(07725)210 1122 A
(message)294 1524 A
1860(m;)S
3120(/*)S
(the)126 3246 A
(notification)504 3414 A
(message)294 3960 A
4296(*/)S
2655 V
(07726)210 1122 A
2745 V
(07727)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(to)S
(see)126 2028 A
2196(if)S
(target)252 2322 A
2616(is)S
(blocked)294 2742 A
(waiting)294 3078 A
(for)126 3414 A
(this)168 3582 A
(message.)336 3792 A
4170(A)S
(process)294 4254 A
2835 V
(07728)210 1122 A
1566(*)S
(can)126 1650 A
1818(be)S
(both)168 1944 A
(sending)294 2154 A
(and)126 2490 A
(receiving)378 2658 A
(during)252 3078 A
3372(a)S
(SENDREC)294 3456 A
(system)252 3792 A
(call.)210 4086 A
2925 V
(07729)210 1122 A
1566(*/)S
3015 V
(07730)210 1122 A
1524(if)S
(\(\(dst_ptr->p_rts_flags)924 1650 A
2616(&)S
(\(RECEIVING|SENDING\)\))840 2700 A
3582(==)S
(RECEIVING)378 3708 A
4128(&&)S
3105 V
(07731)210 1122 A
1692(!)S
(\(priv\(dst_ptr\)->s_flags)966 1776 A
2784(&)S
(SENDREC_BUSY\))546 2868 A
3456(&&)S
3195 V
(07732)210 1122 A
(\(dst_ptr->p_getfrom)798 1692 A
2532(==)S
(ANY)126 2658 A
2826(||)S
(dst_ptr->p_getfrom)756 2952 A
3750(==)S
(caller_ptr->p_nr\)\))756 3876 A
4674({)S
3285 V
(07733)210 1122 A
3375 V
(07734)210 1122 A
1692(/*)S
(Destination)462 1818 A
2322(is)S
(indeed)252 2448 A
(waiting)294 2742 A
(for)126 3078 A
3246(a)S
(message.)336 3330 A
(Assemble)336 3708 A
4086(a)S
(notification)504 4170 A
3465 V
(07735)210 1122 A
1734(*)S
(message)294 1818 A
(and)126 2154 A
(deliver)294 2322 A
(it.)126 2658 A
(Copy)168 2826 A
(from)168 3036 A
(pseudo-source)546 3246 A
(HARDWARE,)378 3834 A
(since)210 4254 A
(the)126 4506 A
3555 V
(07736)210 1122 A
1734(*)S
(message)294 1818 A
2154(is)S
2280(in)S
(the)126 2406 A
(kernel's)336 2574 A
(address)294 2952 A
(space.)252 3288 A
3645 V
(07737)210 1122 A
1734(*/)S
3735 V
(07738)210 1122 A
(BuildMess\(&m,)546 1692 A
(proc_nr\(caller_ptr\),)840 2280 A
(dst_ptr\);)378 3162 A
3825 V
(07739)210 1122 A
(CopyMess\(proc_nr\(caller_ptr\),)1218 1692 A
(proc_addr\(HARDWARE\),)840 2952 A
(&m,)126 3834 A
3915 V
(07740)210 1122 A
(dst_ptr,)336 1860 A
(dst_ptr->p_messbuf\);)840 2238 A
4005 V
(07741)210 1122 A
(dst_ptr->p_rts_flags)840 1692 A
2574(&=)S
(\304RECEIVING;)462 2700 A
3456(/*)S
(deblock)294 3582 A
(destination)462 3918 A
4422(*/)S
4095 V
(07742)210 1122 A
1692(if)S
(\(dst_ptr->p_rts_flags)882 1818 A
2742(==)S
2868(0\))S
(enqueue\(dst_ptr\);)714 2994 A
4185 V
(07743)210 1122 A
(return\(OK\);)462 1692 A
4275 V
(07744)210 1122 A
1524(})S
4365 V
(07745)210 1122 A
4455 V
(07746)210 1122 A
1524(/*)S
(Destination)462 1650 A
2154(is)S
(not)126 2280 A
(ready)210 2448 A
2700(to)S
(receive)294 2826 A
(the)126 3162 A
(notification.)546 3330 A
(Add)126 3918 A
4086(it)S
4212(to)S
(the)126 4338 A
4545 V
(07747)210 1122 A
1566(*)S
(bit)126 1650 A
(map)126 1818 A
(with)168 1986 A
(pending)294 2196 A
(notifications.)588 2532 A
(Note)168 3162 A
(the)126 3372 A
(indirectness:)546 3540 A
(the)126 4128 A
(system)252 4296 A
4590(id)S
4635 V
(07748)210 1122 A
1566(*)S
(instead)294 1650 A
1986(of)S
(the)126 2112 A
(process)294 2280 A
(number)252 2616 A
2910(is)S
(used)168 3036 A
3246(in)S
(the)126 3372 A
(pending)294 3540 A
(bit)126 3876 A
(map.)168 4044 A
4725 V
(07749)210 1122 A
1566(*/)S
4815 V
(07750)210 1122 A
(src_id)252 1524 A
1818(=)S
(priv\(caller_ptr\)->s_id;)966 1902 A
4905 V
(07751)210 1122 A
(set_sys_bit\(priv\(dst_ptr\)->s_notify_pending,)1848 1524 A
(src_id\);)336 3414 A
4995 V
(07752)210 1122 A
(return\(OK\);)462 1524 A
5085 V
(07753)210 1122 A
1440(})S
5265 V
(07755)210 1122 A
(/*===========================================================================*)3276 1440 A
5355 V
(07756)210 1122 A
1482(*)S
(lock_notify)462 2784 A
4674(*)S
5445 V
(07757)210 1122 A
(*===========================================================================*/)3276 1482 A
5535 V
(07758)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(lock_notify\(src,)672 1902 A
(dst\))168 2616 A
5625 V
(07759)210 1122 A
(int)126 1440 A
(src;)168 1608 A
2784(/*)S
(sender)252 2910 A
3204(of)S
(the)126 3330 A
(notification)504 3498 A
4044(*/)S
5715 V
(07760)210 1122 A
(int)126 1440 A
(dst;)168 1608 A
2784(/*)S
(who)126 2910 A
3078(is)S
3204(to)S
3330(be)S
(notified)336 3456 A
3834(*/)S
5805 V
(07761)210 1122 A
1440({)S
5895 V
(07762)210 1122 A
1440(/*)S
(Safe)168 1566 A
(gateway)294 1776 A
2112(to)S
(mini_notify\(\))546 2238 A
(for)126 2826 A
(tasks)210 2994 A
(and)126 3246 A
(interrupt)378 3414 A
(handlers.)378 3834 A
(The)126 4254 A
(sender)252 4422 A
5985 V
(07763)210 1122 A
1482(*)S
1566(is)S
(explicitly)420 1692 A
(given)210 2154 A
2406(to)S
(prevent)294 2532 A
(confusion)378 2868 A
(where)210 3288 A
(the)126 3540 A
(call)168 3708 A
(comes)210 3918 A
(from.)210 4170 A
(MINIX)210 4422 A
6075 V
(07764)210 1122 A
1482(*)S
(kernel)252 1566 A
1860(is)S
(not)126 1986 A
(reentrant,)420 2154 A
(which)210 2616 A
(means)210 2868 A
3120(to)S
(interrupts)420 3246 A
(are)126 3708 A
(disabled)336 3876 A
(after)210 4254 A
6165 V
(07765)210 1122 A
1482(*)S
(the)126 1566 A
(first)210 1734 A
(kernel)252 1986 A
(entry)210 2280 A
(\(hardware)378 2532 A
(interrupt,)420 2952 A
(trap,)210 3414 A
3666(or)S
(exception\).)462 3792 A
(Locking)294 4296 A
6255 V
(07766)210 1122 A
1482(*)S
1566(is)S
(done)168 1692 A
1902(by)S
(temporarily)462 2028 A
(disabling)378 2532 A
(interrupts.)462 2952 A
6345 V
(07767)210 1122 A
1482(*/)S
6435 V
(07768)210 1122 A
(int)126 1524 A
(result;)294 1692 A
6525 V
(07769)210 1122 A
6615 V
(07770)210 1122 A
1524(/*)S
(Exception)378 1650 A
2070(or)S
(interrupt)378 2196 A
(occurred,)378 2616 A
(thus)168 3036 A
(already)294 3246 A
(locked.)294 3582 A
3918(*/)S
6705 V
(07771)210 1122 A
1524(if)S
(\(k_reenter)420 1650 A
2112(>=)S
2238(0\))S
2364({)S
6795 V
(07772)210 1122 A
(result)252 1692 A
1986(=)S
(mini_notify\(proc_addr\(src\),)1134 2070 A
(dst\);)210 3246 A
6885 V
(07773)210 1122 A
1524(})S
6975 V
(07774)210 1122 A
7065 V
(07775)210 1122 A
1524(/*)S
(Call)168 1650 A
(from)168 1860 A
(task)168 2070 A
(level,)252 2280 A
(locking)294 2574 A
2910(is)S
(required.)378 3036 A
3456(*/)S
8418 V
EP
%%Page: 91 91
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2471(File:)S
2704(kernel/proc.c)S
12 B
4560(91)S
1755 V
7 LST
(07776)210 1122 A
(else)168 1524 A
1734({)S
1845 V
(07777)210 1122 A
(lock\(0,)294 1692 A
("notify"\);)420 2028 A
1935 V
(07778)210 1122 A
(result)252 1692 A
1986(=)S
(mini_notify\(proc_addr\(src\),)1134 2070 A
(dst\);)210 3246 A
2025 V
(07779)210 1122 A
(unlock\(0\);)420 1692 A
2115 V
(07780)210 1122 A
1524(})S
2205 V
(07781)210 1122 A
(return\(result\);)630 1524 A
2295 V
(07782)210 1122 A
1440(})S
2475 V
(07784)210 1122 A
(/*===========================================================================*)3276 1440 A
2565 V
(07785)210 1122 A
1482(*)S
(enqueue)294 2784 A
4674(*)S
2655 V
(07786)210 1122 A
(*===========================================================================*/)3276 1482 A
2745 V
(07787)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(enqueue\(rp\))462 1986 A
2835 V
(07788)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(proc)168 2112 A
(*rp;)168 2322 A
2784(/*)S
(this)168 2910 A
(process)294 3120 A
3456(is)S
(now)126 3582 A
(runnable)336 3750 A
4128(*/)S
2925 V
(07789)210 1122 A
1440({)S
3015 V
(07790)210 1122 A
1440(/*)S
(Add)126 1566 A
('rp')168 1734 A
1944(to)S
(one)126 2070 A
2238(of)S
(the)126 2364 A
(queues)252 2532 A
2826(of)S
(runnable)336 2952 A
(processes.)420 3330 A
(This)168 3834 A
(function)336 4044 A
4422(is)S
3105 V
(07791)210 1122 A
1482(*)S
(responsible)462 1566 A
(for)126 2070 A
(inserting)378 2238 A
2658(a)S
(process)294 2742 A
(into)168 3078 A
(one)126 3288 A
3456(of)S
(the)126 3582 A
(scheduling)420 3750 A
(queues.)294 4212 A
3195 V
(07792)210 1122 A
1482(*)S
(The)126 1566 A
(mechanism)378 1734 A
2154(is)S
(implemented)462 2280 A
(here.)210 2784 A
(The)126 3120 A
(actual)252 3288 A
(scheduling)420 3582 A
(policy)252 4044 A
4338(is)S
3285 V
(07793)210 1122 A
1482(*)S
(defined)294 1566 A
1902(in)S
(sched\(\))294 2028 A
(and)126 2364 A
(pick_proc\(\).)504 2532 A
3375 V
(07794)210 1122 A
1482(*/)S
3465 V
(07795)210 1122 A
(int)126 1524 A
1692(q;)S
3456(/*)S
(scheduling)420 3582 A
(queue)210 4044 A
4296(to)S
(use)126 4422 A
4590(*/)S
3555 V
(07796)210 1122 A
(int)126 1524 A
(front;)252 1692 A
3456(/*)S
(add)126 3582 A
3750(to)S
(front)210 3876 A
4128(or)S
(back)168 4254 A
4464(*/)S
3645 V
(07797)210 1122 A
3735 V
(07798)210 1122 A
1524(/*)S
(Determine)378 1650 A
(where)210 2070 A
2322(to)S
(insert)252 2448 A
2742(to)S
(process.)336 2868 A
3246(*/)S
3825 V
(07799)210 1122 A
(sched\(rp,)378 1524 A
(&q,)126 1944 A
(&front\);)336 2112 A
3915 V
(07800)210 1122 A
4005 V
(07801)210 1122 A
1524(/*)S
(Now)126 1650 A
(add)126 1818 A
(the)126 1986 A
(process)294 2154 A
2490(to)S
(the)126 2616 A
(queue.)252 2784 A
3078(*/)S
4095 V
(07802)210 1122 A
1524(if)S
(\(rdy_head[q])504 1650 A
2196(==)S
(NIL_PROC\))378 2322 A
2742({)S
3456(/*)S
(add)126 3582 A
3750(to)S
(empty)210 3876 A
(queue)210 4128 A
4380(*/)S
4185 V
(07803)210 1122 A
(rdy_head[q])462 1692 A
2196(=)S
(rdy_tail[q])462 2280 A
2784(=)S
(rp;)126 2868 A
3456(/*)S
(create)252 3582 A
3876(a)S
(new)126 3960 A
(queue)210 4128 A
4380(*/)S
4275 V
(07804)210 1122 A
(rp->p_nextready)630 1692 A
2364(=)S
(NIL_PROC;)378 2448 A
3456(/*)S
(mark)168 3582 A
(new)126 3792 A
(end)126 3960 A
4128(*/)S
4365 V
(07805)210 1122 A
1524(})S
4455 V
(07806)210 1122 A
(else)168 1524 A
1734(if)S
(\(front\))294 1860 A
2196({)S
3456(/*)S
(add)126 3582 A
3750(to)S
(head)168 3876 A
4086(of)S
(queue)210 4212 A
4464(*/)S
4545 V
(07807)210 1122 A
(rp->p_nextready)630 1692 A
2364(=)S
(rdy_head[q];)504 2448 A
3456(/*)S
(chain)210 3582 A
(head)168 3834 A
4044(of)S
(queue)210 4170 A
4422(*/)S
4635 V
(07808)210 1122 A
(rdy_head[q])462 1692 A
2196(=)S
(rp;)126 2280 A
3456(/*)S
(set)126 3582 A
(new)126 3750 A
(queue)210 3918 A
(head)168 4170 A
4380(*/)S
4725 V
(07809)210 1122 A
1524(})S
4815 V
(07810)210 1122 A
(else)168 1524 A
1734({)S
3456(/*)S
(add)126 3582 A
3750(to)S
(tail)168 3876 A
4086(of)S
(queue)210 4212 A
4464(*/)S
4905 V
(07811)210 1122 A
(rdy_tail[q]->p_nextready)1008 1692 A
2742(=)S
(rp;)126 2826 A
3456(/*)S
(chain)210 3582 A
(tail)168 3834 A
4044(of)S
(queue)210 4170 A
4422(*/)S
4995 V
(07812)210 1122 A
(rdy_tail[q])462 1692 A
2196(=)S
(rp;)126 2280 A
3456(/*)S
(set)126 3582 A
(new)126 3750 A
(queue)210 3918 A
(tail)168 4170 A
4380(*/)S
5085 V
(07813)210 1122 A
(rp->p_nextready)630 1692 A
2364(=)S
(NIL_PROC;)378 2448 A
3456(/*)S
(mark)168 3582 A
(new)126 3792 A
(end)126 3960 A
4128(*/)S
5175 V
(07814)210 1122 A
1524(})S
5265 V
(07815)210 1122 A
5355 V
(07816)210 1122 A
1524(/*)S
(Now)126 1650 A
(select)252 1818 A
(the)126 2112 A
(next)168 2280 A
(process)294 2490 A
2826(to)S
(run.)168 2952 A
3162(*/)S
5445 V
(07817)210 1122 A
(pick_proc\(\);)504 1524 A
5535 V
(07818)210 1122 A
1440(})S
5715 V
(07820)210 1122 A
(/*===========================================================================*)3276 1440 A
5805 V
(07821)210 1122 A
1482(*)S
(dequeue)294 2784 A
4674(*)S
5895 V
(07822)210 1122 A
(*===========================================================================*/)3276 1482 A
5985 V
(07823)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(dequeue\(rp\))462 1986 A
6075 V
(07824)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(proc)168 2112 A
(*rp;)168 2322 A
2784(/*)S
(this)168 2910 A
(process)294 3120 A
3456(is)S
3582(no)S
(longer)252 3708 A
(runnable)336 4002 A
4380(*/)S
6165 V
(07825)210 1122 A
1440({)S
6255 V
(07826)210 1122 A
1440(/*)S
1566(A)S
(process)294 1650 A
(must)168 1986 A
2196(be)S
(removed)294 2322 A
(from)168 2658 A
(the)126 2868 A
(scheduling)420 3036 A
(queues,)294 3498 A
(for)126 3834 A
(example,)336 4002 A
(because)294 4380 A
6345 V
(07827)210 1122 A
1482(*)S
1566(it)S
(has)126 1692 A
(blocked.)336 1860 A
2280(If)S
(the)126 2406 A
(currently)378 2574 A
(active)252 2994 A
(process)294 3288 A
3624(is)S
(removed,)336 3750 A
4128(a)S
(new)126 4212 A
(process)294 4380 A
6435 V
(07828)210 1122 A
1482(*)S
1566(is)S
(picked)252 1692 A
1986(to)S
(run)126 2112 A
2280(by)S
(calling)294 2406 A
(pick_proc\(\).)504 2742 A
6525 V
(07829)210 1122 A
1482(*/)S
6615 V
(07830)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(q)S
2154(=)S
(rp->p_priority;)630 2238 A
3456(/*)S
(queue)210 3582 A
3834(to)S
(use)126 3960 A
4128(*/)S
6705 V
(07831)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(**xpp;)252 2406 A
3456(/*)S
(iterate)294 3582 A
(over)168 3918 A
(queue)210 4128 A
4380(*/)S
6795 V
(07832)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*prev_xp;)378 2406 A
6885 V
(07833)210 1122 A
6975 V
(07834)210 1122 A
1524(/*)S
(Side-effect)462 1650 A
(for)126 2154 A
(kernel:)294 2322 A
(check)210 2658 A
2910(if)S
(the)126 3036 A
(task's)252 3204 A
(stack)210 3498 A
(still)210 3750 A
4002(is)S
(ok?)126 4128 A
4296(*/)S
7065 V
(07835)210 1122 A
1524(if)S
(\(iskernelp\(rp\)\))630 1650 A
2322({)S
8418 V
EP
%%Page: 92 92
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(92)S
11 R
2471(File:)S
2704(kernel/proc.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(07836)210 1122 A
1776(if)S
(\(*priv\(rp\)->s_stack_guard)1050 1902 A
2994(!=)S
(STACK_GUARD\))504 3120 A
1845 V
(07837)210 1122 A
(panic\("stack)504 2112 A
(overrun)294 2658 A
2994(by)S
(task",)252 3120 A
(proc_nr\(rp\)\);)546 3414 A
1935 V
(07838)210 1122 A
1524(})S
2025 V
(07839)210 1122 A
2115 V
(07840)210 1122 A
1524(/*)S
(Now)126 1650 A
(make)168 1818 A
(sure)168 2028 A
(that)168 2238 A
(the)126 2448 A
(process)294 2616 A
2952(is)S
(not)126 3078 A
3246(in)S
(its)126 3372 A
(ready)210 3540 A
(queue.)252 3792 A
(Remove)252 4086 A
(the)126 4380 A
2205 V
(07841)210 1122 A
1566(*)S
(process)294 1650 A
1986(if)S
2112(it)S
2238(is)S
(found.)252 2364 A
2658(A)S
(process)294 2742 A
(can)126 3078 A
3246(be)S
(made)168 3372 A
(unready)294 3582 A
(even)168 3918 A
4128(if)S
4254(it)S
4380(is)S
(not)126 4506 A
2295 V
(07842)210 1122 A
1566(*)S
(running)294 1650 A
1986(by)S
(being)210 2112 A
(sent)168 2364 A
2574(a)S
(signal)252 2658 A
(that)168 2952 A
(kills)210 3162 A
(it.)126 3414 A
2385 V
(07843)210 1122 A
1566(*/)S
2475 V
(07844)210 1122 A
(prev_xp)294 1524 A
1860(=)S
(NIL_PROC;)378 1944 A
2565 V
(07845)210 1122 A
(for)126 1524 A
(\(xpp)168 1692 A
1902(=)S
(&rdy_head[q];)546 1986 A
(*xpp)168 2574 A
2784(!=)S
(NIL_PROC;)378 2910 A
(xpp)126 3330 A
3498(=)S
(&\(*xpp\)->p_nextready\))882 3582 A
4506({)S
2655 V
(07846)210 1122 A
2745 V
(07847)210 1122 A
1692(if)S
(\(*xpp)210 1818 A
2070(==)S
(rp\))126 2196 A
2364({)S
3456(/*)S
(found)210 3582 A
(process)294 3834 A
4170(to)S
(remove)252 4296 A
4590(*/)S
2835 V
(07848)210 1122 A
(*xpp)168 1860 A
2070(=)S
(\(*xpp\)->p_nextready;)840 2154 A
3456(/*)S
(replace)294 3582 A
(with)168 3918 A
(next)168 4128 A
(chain)210 4338 A
4590(*/)S
2925 V
(07849)210 1122 A
1860(if)S
(\(rp)126 1986 A
2154(==)S
(rdy_tail[q]\))504 2280 A
3456(/*)S
(queue)210 3582 A
(tail)168 3834 A
(removed)294 4044 A
4380(*/)S
3015 V
(07850)210 1122 A
(rdy_tail[q])462 2028 A
2532(=)S
(prev_xp;)336 2616 A
3456(/*)S
(set)126 3582 A
(new)126 3750 A
(tail)168 3918 A
4128(*/)S
3105 V
(07851)210 1122 A
1860(if)S
(\(rp)126 1986 A
2154(==)S
(proc_ptr)336 2280 A
2658(||)S
2784(rp)S
2910(==)S
(next_ptr\))378 3036 A
3456(/*)S
(active)252 3582 A
(process)294 3876 A
(removed)294 4212 A
4548(*/)S
3195 V
(07852)210 1122 A
(pick_proc\(\);)504 2028 A
3456(/*)S
(pick)168 3582 A
(new)126 3792 A
(process)294 3960 A
4296(to)S
(run)126 4422 A
4590(*/)S
3285 V
(07853)210 1122 A
(break;)252 1860 A
3375 V
(07854)210 1122 A
1692(})S
3465 V
(07855)210 1122 A
(prev_xp)294 1692 A
2028(=)S
(*xpp;)210 2112 A
3456(/*)S
(save)168 3582 A
(previous)336 3792 A
4170(in)S
(chain)210 4296 A
4548(*/)S
3555 V
(07856)210 1122 A
1524(})S
3645 V
(07857)210 1122 A
1440(})S
3825 V
(07859)210 1122 A
(/*===========================================================================*)3276 1440 A
3915 V
(07860)210 1122 A
1482(*)S
(sched)210 2784 A
4674(*)S
4005 V
(07861)210 1122 A
(*===========================================================================*/)3276 1482 A
4095 V
(07862)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(sched\(rp,)378 1986 A
(queue,)252 2406 A
(front\))252 2700 A
4185 V
(07863)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(proc)168 2112 A
(*rp;)168 2322 A
3456(/*)S
(process)294 3582 A
3918(to)S
4044(be)S
(scheduled)378 4170 A
4590(*/)S
4275 V
(07864)210 1122 A
(int)126 1440 A
(*queue;)294 1608 A
3456(/*)S
(return:)294 3582 A
(queue)210 3918 A
4170(to)S
(use)126 4296 A
4464(*/)S
4365 V
(07865)210 1122 A
(int)126 1440 A
(*front;)294 1608 A
3456(/*)S
(return:)294 3582 A
(front)210 3918 A
4170(or)S
(back)168 4296 A
4506(*/)S
4455 V
(07866)210 1122 A
1440({)S
4545 V
(07867)210 1122 A
1440(/*)S
(This)168 1566 A
(function)336 1776 A
(determines)420 2154 A
(the)126 2616 A
(scheduling)420 2784 A
(policy.)294 3246 A
3624(It)S
3750(is)S
(called)252 3876 A
(whenever)336 4170 A
4548(a)S
4635 V
(07868)210 1122 A
1482(*)S
(process)294 1566 A
(must)168 1902 A
2112(be)S
(added)210 2238 A
2490(to)S
(one)126 2616 A
2784(of)S
(the)126 2910 A
(scheduling)420 3078 A
(queues)252 3540 A
3834(to)S
(decide)252 3960 A
(where)210 4254 A
4506(to)S
4725 V
(07869)210 1122 A
1482(*)S
(insert)252 1566 A
(it.)126 1860 A
2070(As)S
2196(a)S
(side-effect)462 2280 A
(the)126 2784 A
(process')336 2952 A
(priority)336 3330 A
(may)126 3708 A
3876(be)S
(updated.)336 4002 A
4815 V
(07870)210 1122 A
1482(*/)S
4905 V
(07871)210 1122 A
(static)252 1524 A
(struct)252 1818 A
(proc)168 2112 A
(*prev_ptr)378 2322 A
2742(=)S
(NIL_PROC;)378 2826 A
3456(/*)S
(previous)336 3582 A
(without)294 3960 A
(time)168 4296 A
4506(*/)S
4995 V
(07872)210 1122 A
(int)126 1524 A
(time_left)378 1692 A
2112(=)S
(\(rp->p_ticks_left)714 2196 A
2952(>)S
(0\);)126 3036 A
3456(/*)S
(quantum)294 3582 A
(fully)210 3918 A
(consumed)336 4170 A
4548(*/)S
5085 V
(07873)210 1122 A
(int)126 1524 A
(penalty)294 1692 A
2028(=)S
2112(0;)S
3456(/*)S
(change)252 3582 A
3876(in)S
(priority)336 4002 A
4380(*/)S
5175 V
(07874)210 1122 A
5265 V
(07875)210 1122 A
1524(/*)S
(Check)210 1650 A
(whether)294 1902 A
(the)126 2238 A
(process)294 2406 A
(has)126 2742 A
(time)168 2910 A
(left.)210 3120 A
(Otherwise)378 3372 A
(give)168 3792 A
4002(a)S
(new)126 4086 A
(quantum)294 4254 A
5355 V
(07876)210 1122 A
1566(*)S
(and)126 1650 A
(possibly)336 1818 A
(raise)210 2196 A
(the)126 2448 A
(priority.)378 2616 A
(Processes)378 3078 A
(using)210 3498 A
(multiple)336 3750 A
(quantums)336 4128 A
5445 V
(07877)210 1122 A
1566(*)S
1650(in)S
1776(a)S
(row)126 1860 A
(get)126 2028 A
2196(a)S
(lower)210 2280 A
(priority)336 2532 A
2910(to)S
(catch)210 3036 A
(infinite)336 3288 A
(loops)210 3666 A
3918(in)S
(high)168 4044 A
(priority)336 4254 A
5535 V
(07878)210 1122 A
1566(*)S
(processes)378 1650 A
(\(system)294 2070 A
(servers)294 2406 A
(and)126 2742 A
(drivers\).)378 2910 A
5625 V
(07879)210 1122 A
1566(*/)S
5715 V
(07880)210 1122 A
1524(if)S
1650(\()S
1734(!)S
(time_left\))420 1818 A
2280({)S
3456(/*)S
(quantum)294 3582 A
(consumed)336 3918 A
4296(?)S
4380(*/)S
5805 V
(07881)210 1122 A
(rp->p_ticks_left)672 1692 A
2406(=)S
(rp->p_quantum_size;)798 2490 A
3456(/*)S
(give)168 3582 A
(new)126 3792 A
(quantum)294 3960 A
4296(*/)S
5895 V
(07882)210 1122 A
1692(if)S
(\(prev_ptr)378 1818 A
2238(==)S
(rp\))126 2364 A
(penalty)294 2532 A
(++;)126 2868 A
3456(/*)S
(catch)210 3582 A
(infinite)336 3834 A
(loops)210 4212 A
4464(*/)S
5985 V
(07883)210 1122 A
(else)168 1692 A
(penalty)294 1902 A
(--;)126 2238 A
3456(/*)S
(give)168 3582 A
(slow)168 3792 A
(way)126 4002 A
(back)168 4170 A
4380(*/)S
6075 V
(07884)210 1122 A
(prev_ptr)336 1692 A
2070(=)S
(rp;)126 2154 A
3456(/*)S
(store)210 3582 A
(ptr)126 3834 A
(for)126 4002 A
(next)168 4170 A
4380(*/)S
6165 V
(07885)210 1122 A
1524(})S
6255 V
(07886)210 1122 A
6345 V
(07887)210 1122 A
1524(/*)S
(Determine)378 1650 A
(the)126 2070 A
(new)126 2238 A
(priority)336 2406 A
2784(of)S
(this)168 2910 A
(process.)336 3120 A
(The)126 3498 A
(bounds)252 3666 A
(are)126 3960 A
(determined)420 4128 A
6435 V
(07888)210 1122 A
1566(*)S
1650(by)S
(IDLE's)252 1776 A
(queue)210 2070 A
(and)126 2322 A
(the)126 2490 A
(maximum)294 2658 A
(priority)336 2994 A
3372(of)S
(this)168 3498 A
(process.)336 3708 A
(Kernel)252 4086 A
(tasks)210 4380 A
6525 V
(07889)210 1122 A
1566(*)S
(and)126 1650 A
(the)126 1818 A
(idle)168 1986 A
(process)294 2196 A
(are)126 2532 A
(never)210 2700 A
(changed)294 2952 A
3288(in)S
(priority.)378 3414 A
6615 V
(07890)210 1122 A
1566(*/)S
6705 V
(07891)210 1122 A
1524(if)S
(\(penalty)336 1650 A
2028(!=)S
2154(0)S
2238(&&)S
2364(!)S
(iskernelp\(rp\)\))588 2448 A
3078({)S
6795 V
(07892)210 1122 A
(rp->p_priority)588 1692 A
2322(+=)S
(penalty;)336 2448 A
3456(/*)S
(update)252 3582 A
(with)168 3876 A
(penalty)294 4086 A
4422(*/)S
6885 V
(07893)210 1122 A
1692(if)S
(\(rp->p_priority)630 1818 A
2490(<)S
(rp->p_max_priority\))798 2574 A
3456(/*)S
(check)210 3582 A
(upper)210 3834 A
(bound)210 4086 A
4338(*/)S
6975 V
(07894)210 1122 A
(rp->p_priority=rp->p_max_priority;)1428 1860 A
7065 V
(07895)210 1122 A
(else)168 1692 A
1902(if)S
(\(rp->p_priority)630 2028 A
2700(>)S
(IDLE_Q-1\))378 2784 A
3456(/*)S
(check)210 3582 A
(lower)210 3834 A
(bound)210 4086 A
4338(*/)S
8418 V
EP
%%Page: 93 93
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2471(File:)S
2704(kernel/proc.c)S
12 B
4560(93)S
1755 V
7 LST
(07896)210 1122 A
(rp->p_priority)588 1860 A
2490(=)S
(IDLE_Q-1;)378 2574 A
1845 V
(07897)210 1122 A
1524(})S
1935 V
(07898)210 1122 A
2025 V
(07899)210 1122 A
1524(/*)S
1650(If)S
(there)210 1776 A
2028(is)S
(time)168 2154 A
(left,)210 2364 A
(the)126 2616 A
(process)294 2784 A
3120(is)S
(added)210 3246 A
3498(to)S
(the)126 3624 A
(front)210 3792 A
4044(of)S
(its)126 4170 A
(queue,)252 4338 A
2115 V
(07900)210 1122 A
1566(*)S
1650(so)S
(that)168 1776 A
1986(it)S
(can)126 2112 A
(immediately)462 2280 A
(run.)168 2784 A
(The)126 2994 A
(queue)210 3162 A
3414(to)S
(use)126 3540 A
(simply)252 3708 A
4002(is)S
(always)252 4128 A
(the)126 4422 A
2205 V
(07901)210 1122 A
1566(*)S
(process')336 1650 A
(current)294 2028 A
(priority.)378 2364 A
2295 V
(07902)210 1122 A
1566(*/)S
2385 V
(07903)210 1122 A
(*queue)252 1524 A
1818(=)S
(rp->p_priority;)630 1902 A
2475 V
(07904)210 1122 A
(*front)252 1524 A
1818(=)S
(time_left;)420 1902 A
2565 V
(07905)210 1122 A
1440(})S
2745 V
(07907)210 1122 A
(/*===========================================================================*)3276 1440 A
2835 V
(07908)210 1122 A
1482(*)S
(pick_proc)378 2784 A
4674(*)S
2925 V
(07909)210 1122 A
(*===========================================================================*/)3276 1482 A
3015 V
(07910)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(pick_proc\(\))462 1986 A
3105 V
(07911)210 1122 A
1440({)S
3195 V
(07912)210 1122 A
1440(/*)S
(Decide)252 1566 A
(who)126 1860 A
2028(to)S
(run)126 2154 A
(now.)168 2322 A
2574(A)S
(new)126 2658 A
(process)294 2826 A
3162(is)S
(selected)336 3288 A
3666(by)S
(setting)294 3792 A
('next_ptr'.)462 4128 A
3285 V
(07913)210 1122 A
1482(*)S
(When)168 1566 A
1776(a)S
(billable)336 1860 A
(process)294 2238 A
2574(is)S
(selected,)378 2700 A
(record)252 3120 A
3414(it)S
3540(in)S
('bill_ptr',)462 3666 A
4170(so)S
(that)168 4296 A
(the)126 4506 A
3375 V
(07914)210 1122 A
1482(*)S
(clock)210 1566 A
(task)168 1818 A
(can)126 2028 A
(tell)168 2196 A
(who)126 2406 A
2574(to)S
(bill)168 2700 A
(for)126 2910 A
(system)252 3078 A
(time.)210 3372 A
3465 V
(07915)210 1122 A
1482(*/)S
3555 V
(07916)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*rp;)168 2406 A
3456(/*)S
(process)294 3582 A
3918(to)S
(run)126 4044 A
4212(*/)S
3645 V
(07917)210 1122 A
(int)126 1524 A
1692(q;)S
3456(/*)S
(iterate)294 3582 A
(over)168 3918 A
(queues)252 4128 A
4422(*/)S
3735 V
(07918)210 1122 A
3825 V
(07919)210 1122 A
1524(/*)S
(Check)210 1650 A
(each)168 1902 A
2112(of)S
(the)126 2238 A
(scheduling)420 2406 A
(queues)252 2868 A
(for)126 3162 A
(ready)210 3330 A
(processes.)420 3582 A
(The)126 4044 A
(number)252 4212 A
4506(of)S
3915 V
(07920)210 1122 A
1566(*)S
(queues)252 1650 A
1944(is)S
(defined)294 2070 A
2406(in)S
(proc.h,)294 2532 A
(and)126 2868 A
(priorities)420 3036 A
(are)126 3498 A
(set)126 3666 A
3834(in)S
(the)126 3960 A
(image)210 4128 A
(table.)252 4380 A
4005 V
(07921)210 1122 A
1566(*)S
(The)126 1650 A
(lowest)252 1818 A
(queue)210 2112 A
(contains)336 2364 A
(IDLE,)210 2742 A
(which)210 2994 A
3246(is)S
(always)252 3372 A
(ready.)252 3666 A
4095 V
(07922)210 1122 A
1566(*/)S
4185 V
(07923)210 1122 A
(for)126 1524 A
(\(q=0;)210 1692 A
1944(q)S
2028(<)S
(NR_SCHED_QUEUES;)672 2112 A
(q++\))168 2826 A
3036({)S
4275 V
(07924)210 1122 A
1692(if)S
1818(\()S
(\(rp)126 1902 A
2070(=)S
(rdy_head[q]\))504 2154 A
2700(!=)S
(NIL_PROC\))378 2826 A
3246({)S
4365 V
(07925)210 1122 A
(next_ptr)336 1860 A
2238(=)S
(rp;)126 2322 A
3456(/*)S
(run)126 3582 A
(process)294 3750 A
('rp')168 4086 A
(next)168 4296 A
4506(*/)S
4455 V
(07926)210 1122 A
1860(if)S
(\(priv\(rp\)->s_flags)756 1986 A
2784(&)S
(BILLABLE\))378 2868 A
4545 V
(07927)210 1122 A
(bill_ptr)336 2028 A
2406(=)S
(rp;)126 2490 A
3456(/*)S
(bill)168 3582 A
(for)126 3792 A
(system)252 3960 A
(time)168 4254 A
4464(*/)S
4635 V
(07928)210 1122 A
(return;)294 1860 A
4725 V
(07929)210 1122 A
1692(})S
4815 V
(07930)210 1122 A
1524(})S
4905 V
(07931)210 1122 A
1440(})S
5085 V
(07933)210 1122 A
(/*===========================================================================*)3276 1440 A
5175 V
(07934)210 1122 A
1482(*)S
(lock_send)378 2784 A
4674(*)S
5265 V
(07935)210 1122 A
(*===========================================================================*/)3276 1482 A
5355 V
(07936)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(lock_send\(dst,)588 1902 A
(m_ptr\))252 2532 A
5445 V
(07937)210 1122 A
(int)126 1440 A
(dst;)168 1608 A
2784(/*)S
2910(to)S
(whom)168 3036 A
3246(is)S
(message)294 3372 A
(being)210 3708 A
(sent?)210 3960 A
4212(*/)S
5535 V
(07938)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(message)294 3372 A
(buffer)252 3708 A
4002(*/)S
5625 V
(07939)210 1122 A
1440({)S
5715 V
(07940)210 1122 A
1440(/*)S
(Safe)168 1566 A
(gateway)294 1776 A
2112(to)S
(mini_send\(\))462 2238 A
(for)126 2742 A
(tasks.)252 2910 A
3204(*/)S
5805 V
(07941)210 1122 A
(int)126 1524 A
(result;)294 1692 A
5895 V
(07942)210 1122 A
(lock\(2,)294 1524 A
("send"\);)336 1860 A
5985 V
(07943)210 1122 A
(result)252 1524 A
1818(=)S
(mini_send\(proc_ptr,)798 1902 A
(dst,)168 2742 A
(m_ptr,)252 2952 A
(NON_BLOCKING\);)588 3246 A
6075 V
(07944)210 1122 A
(unlock\(2\);)420 1524 A
6165 V
(07945)210 1122 A
(return\(result\);)630 1524 A
6255 V
(07946)210 1122 A
1440(})S
6435 V
(07948)210 1122 A
(/*===========================================================================*)3276 1440 A
6525 V
(07949)210 1122 A
1482(*)S
(lock_enqueue)504 2784 A
4674(*)S
6615 V
(07950)210 1122 A
(*===========================================================================*/)3276 1482 A
6705 V
(07951)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(lock_enqueue\(rp\))672 1944 A
6795 V
(07952)210 1122 A
(struct)252 1440 A
(proc)168 1734 A
(*rp;)168 1944 A
2784(/*)S
(this)168 2910 A
(process)294 3120 A
3456(is)S
(now)126 3582 A
(runnable)336 3750 A
4128(*/)S
6885 V
(07953)210 1122 A
1440({)S
6975 V
(07954)210 1122 A
1440(/*)S
(Safe)168 1566 A
(gateway)294 1776 A
2112(to)S
(enqueue\(\))378 2238 A
(for)126 2658 A
(tasks.)252 2826 A
3120(*/)S
7065 V
(07955)210 1122 A
(lock\(3,)294 1524 A
("enqueue"\);)462 1860 A
8418 V
EP
%%Page: 94 94
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(94)S
11 R
2471(File:)S
2704(kernel/proc.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(07956)210 1122 A
(enqueue\(rp\);)504 1524 A
1845 V
(07957)210 1122 A
(unlock\(3\);)420 1524 A
1935 V
(07958)210 1122 A
1440(})S
2115 V
(07960)210 1122 A
(/*===========================================================================*)3276 1440 A
2205 V
(07961)210 1122 A
1482(*)S
(lock_dequeue)504 2784 A
4674(*)S
2295 V
(07962)210 1122 A
(*===========================================================================*/)3276 1482 A
2385 V
(07963)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(lock_dequeue\(rp\))672 1944 A
2475 V
(07964)210 1122 A
(struct)252 1440 A
(proc)168 1734 A
(*rp;)168 1944 A
2784(/*)S
(this)168 2910 A
(process)294 3120 A
3456(is)S
3582(no)S
(longer)252 3708 A
(runnable)336 4002 A
4380(*/)S
2565 V
(07965)210 1122 A
1440({)S
2655 V
(07966)210 1122 A
1440(/*)S
(Safe)168 1566 A
(gateway)294 1776 A
2112(to)S
(dequeue\(\))378 2238 A
(for)126 2658 A
(tasks.)252 2826 A
3120(*/)S
2745 V
(07967)210 1122 A
(lock\(4,)294 1524 A
("dequeue"\);)462 1860 A
2835 V
(07968)210 1122 A
(dequeue\(rp\);)504 1524 A
2925 V
(07969)210 1122 A
(unlock\(4\);)420 1524 A
3015 V
(07970)210 1122 A
1440(})S
3645 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3735 V
(kernel/exception.c)756 2676 A
3825 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4005 V
(08000)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
2364(a)S
(simple)252 2448 A
(exception)378 2742 A
(handler.)336 3162 A
(Exceptions)420 3582 A
4044(in)S
(user)168 4170 A
4095 V
(08001)210 1122 A
1482(*)S
(processes)378 1566 A
(are)126 1986 A
(converted)378 2154 A
2574(to)S
(signals.)336 2700 A
(Exceptions)420 3078 A
3540(in)S
3666(a)S
(kernel)252 3750 A
(task)168 4044 A
(cause)210 4254 A
4185 V
(08002)210 1122 A
1482(*)S
1566(a)S
(panic.)252 1650 A
4275 V
(08003)210 1122 A
1482(*/)S
4365 V
(08004)210 1122 A
4455 V
(08005)210 1122 A
(#include)336 1440 A
("kernel.h")420 1818 A
4545 V
(08006)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
4635 V
(08007)210 1122 A
(#include)336 1440 A
("proc.h")336 1818 A
4725 V
(08008)210 1122 A
4815 V
(08009)210 1122 A
(/*===========================================================================*)3276 1440 A
4905 V
(08010)210 1122 A
1482(*)S
(exception)378 2784 A
4674(*)S
4995 V
(08011)210 1122 A
(*===========================================================================*/)3276 1482 A
5085 V
(08012)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(exception\(vec_nr\))714 1944 A
5175 V
(08013)210 1122 A
(unsigned)336 1440 A
(vec_nr;)294 1818 A
5265 V
(08014)210 1122 A
1440({)S
5355 V
(08015)210 1122 A
1440(/*)S
1566(An)S
(exception)378 1692 A
2112(or)S
(unexpected)420 2238 A
(interrupt)378 2700 A
(has)126 3120 A
(occurred.)378 3288 A
3708(*/)S
5445 V
(08016)210 1122 A
5535 V
(08017)210 1122 A
(struct)252 1524 A
(ex_s)168 1818 A
2028({)S
5625 V
(08018)210 1122 A
(char)168 1776 A
(*msg;)210 1986 A
5715 V
(08019)210 1122 A
(int)126 1776 A
(signum;)294 1944 A
5805 V
(08020)210 1122 A
(int)126 1776 A
(minprocessor;)546 1944 A
5895 V
(08021)210 1122 A
1524(};)S
5985 V
(08022)210 1122 A
(static)252 1524 A
(struct)252 1818 A
(ex_s)168 2112 A
(ex_data[])378 2322 A
2742(=)S
2826({)S
6075 V
(08023)210 1122 A
1776({)S
("Divide)294 1860 A
(error",)294 2196 A
(SIGFPE,)294 2532 A
2868(86)S
2994(},)S
6165 V
(08024)210 1122 A
1776({)S
("Debug)252 1860 A
(exception",)462 2154 A
(SIGTRAP,)336 2658 A
3036(86)S
3162(},)S
6255 V
(08025)210 1122 A
1776({)S
("Nonmaskable)504 1860 A
(interrupt",)462 2406 A
(SIGBUS,)294 2910 A
3246(86)S
3372(},)S
6345 V
(08026)210 1122 A
1776({)S
("Breakpoint",)546 1860 A
(SIGEMT,)294 2448 A
2784(86)S
2910(},)S
6435 V
(08027)210 1122 A
1776({)S
("Overflow",)462 1860 A
(SIGFPE,)294 2364 A
2700(86)S
2826(},)S
6525 V
(08028)210 1122 A
1776({)S
("Bounds)294 1860 A
(check",)294 2196 A
(SIGFPE,)294 2532 A
(186)126 2868 A
3036(},)S
6615 V
(08029)210 1122 A
1776({)S
("Invalid)336 1860 A
(opcode",)336 2238 A
(SIGILL,)294 2616 A
(186)126 2952 A
3120(},)S
6705 V
(08030)210 1122 A
1776({)S
("Coprocessor)504 1860 A
(not)126 2406 A
(available",)462 2574 A
(SIGFPE,)294 3078 A
(186)126 3414 A
3582(},)S
6795 V
(08031)210 1122 A
1776({)S
("Double)294 1860 A
(fault",)294 2196 A
(SIGBUS,)294 2532 A
(286)126 2868 A
3036(},)S
6885 V
(08032)210 1122 A
1776({)S
("Copressor)420 1860 A
(segment)294 2322 A
(overrun",)378 2658 A
(SIGSEGV,)336 3078 A
(286)126 3456 A
3624(},)S
6975 V
(08033)210 1122 A
1776({)S
("Invalid)336 1860 A
(TSS",)210 2238 A
(SIGSEGV,)336 2490 A
(286)126 2868 A
3036(},)S
7065 V
(08034)210 1122 A
1776({)S
("Segment)336 1860 A
(not)126 2238 A
(present",)378 2406 A
(SIGSEGV,)336 2826 A
(286)126 3204 A
3372(},)S
8418 V
EP
%%Page: 95 95
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2354(File:)S
2587(kernel/exception.c)S
12 B
4560(95)S
1755 V
7 LST
(08035)210 1122 A
1776({)S
("Stack)252 1860 A
(exception",)462 2154 A
(SIGSEGV,)336 2658 A
(286)126 3036 A
3204(},)S
3456(/*)S
(STACK_FAULT)462 3582 A
(already)294 4086 A
(used)168 4422 A
4632(*/)S
1845 V
(08036)210 1122 A
1776({)S
("General)336 1860 A
(protection",)504 2238 A
(SIGSEGV,)336 2784 A
(286)126 3162 A
3330(},)S
1935 V
(08037)210 1122 A
1776({)S
("Page)210 1860 A
(fault",)294 2112 A
(SIGSEGV,)336 2448 A
(386)126 2826 A
2994(},)S
3456(/*)S
(not)126 3582 A
(close)210 3750 A
4002(*/)S
2025 V
(08038)210 1122 A
1776({)S
(NIL_PTR,)336 1860 A
(SIGILL,)294 2238 A
2574(0)S
2658(},)S
3456(/*)S
(probably)336 3582 A
(software)336 3960 A
(trap)168 4338 A
4548(*/)S
2115 V
(08039)210 1122 A
1776({)S
("Coprocessor)504 1860 A
(error",)294 2406 A
(SIGFPE,)294 2742 A
(386)126 3078 A
3246(},)S
2205 V
(08040)210 1122 A
1524(};)S
2295 V
(08041)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(ex_s)168 2196 A
(*ep;)168 2406 A
2385 V
(08042)210 1122 A
(struct)252 1524 A
(proc)168 1818 A
(*saved_proc;)504 2028 A
2475 V
(08043)210 1122 A
2565 V
(08044)210 1122 A
1524(/*)S
(Save)168 1650 A
(proc_ptr,)378 1860 A
(because)294 2280 A
2616(it)S
(may)126 2742 A
2910(be)S
(changed)294 3036 A
3372(by)S
(debug)210 3498 A
(statements.)462 3750 A
4254(*/)S
2655 V
(08045)210 1122 A
(saved_proc)420 1524 A
1986(=)S
(proc_ptr;)378 2070 A
2745 V
(08046)210 1122 A
2835 V
(08047)210 1122 A
1524(ep)S
1650(=)S
(&ex_data[vec_nr];)714 1734 A
2925 V
(08048)210 1122 A
3015 V
(08049)210 1122 A
1524(if)S
(\(vec_nr)294 1650 A
1986(==)S
2112(2\))S
2238({)S
2784(/*)S
(spurious)336 2910 A
(NMI)126 3288 A
3456(on)S
(some)168 3582 A
(machines)336 3792 A
4170(*/)S
3105 V
(08050)210 1122 A
(kprintf\("got)504 1776 A
(spurious)336 2322 A
(NMI\\n"\);)336 2700 A
3195 V
(08051)210 1122 A
(return;)294 1776 A
3285 V
(08052)210 1122 A
1524(})S
3375 V
(08053)210 1122 A
3465 V
(08054)210 1122 A
1524(/*)S
1650(If)S
1776(an)S
(exception)378 1902 A
(occurs)252 2322 A
(while)210 2616 A
(running)294 2868 A
3204(a)S
(process,)336 3288 A
(the)126 3666 A
(k_reenter)378 3834 A
(variable)336 4254 A
3555 V
(08055)210 1122 A
1566(*)S
(will)168 1650 A
1860(be)S
(zero.)210 1986 A
(Exceptions)420 2238 A
2700(in)S
(interrupt)378 2826 A
(handlers)336 3246 A
3624(or)S
(system)252 3750 A
(traps)210 4044 A
(will)168 4296 A
(make)168 4506 A
3645 V
(08056)210 1122 A
1566(*)S
(k_reenter)378 1650 A
(larger)252 2070 A
(than)168 2364 A
(zero.)210 2574 A
3735 V
(08057)210 1122 A
1566(*/)S
3825 V
(08058)210 1122 A
1524(if)S
(\(k_reenter)420 1650 A
2112(==)S
2238(0)S
2322(&&)S
2448(!)S
(iskernelp\(saved_proc\)\))924 2532 A
3498({)S
3915 V
(08059)210 1122 A
(cause_sig\(proc_nr\(saved_proc\),)1260 1776 A
(ep->signum\);)504 3078 A
4005 V
(08060)210 1122 A
(return;)294 1776 A
4095 V
(08061)210 1122 A
1524(})S
4185 V
(08062)210 1122 A
4275 V
(08063)210 1122 A
1524(/*)S
(Exception)378 1650 A
2070(in)S
(system)252 2196 A
(code.)210 2490 A
(This)168 2742 A
2952(is)S
(not)126 3078 A
(supposed)336 3246 A
3624(to)S
(happen.)294 3750 A
4086(*/)S
4365 V
(08064)210 1122 A
1524(if)S
(\(ep->msg)336 1650 A
2028(==)S
(NIL_PTR)294 2154 A
2490(||)S
(machine.processor)714 2616 A
3372(<)S
(ep->minprocessor\))714 3456 A
4455 V
(08065)210 1122 A
(kprintf\("\\nIntel-reserved)1050 1776 A
(exception)378 2868 A
(%d\\n",)252 3288 A
(vec_nr\);)336 3582 A
4545 V
(08066)210 1122 A
(else)168 1524 A
4635 V
(08067)210 1122 A
(kprintf\("\\n%s\\n",)714 1776 A
(ep->msg\);)378 2532 A
4725 V
(08068)210 1122 A
(kprintf\("k_reenter)756 1524 A
2322(=)S
2406(%d)S
2532(",)S
(k_reenter\);)462 2658 A
4815 V
(08069)210 1122 A
(kprintf\("process)672 1524 A
2238(%d)S
(\(%s\),)210 2364 A
2616(",)S
(proc_nr\(saved_proc\),)840 2742 A
(saved_proc->p_name\);)840 3624 A
4905 V
(08070)210 1122 A
(kprintf\("pc)462 1524 A
2028(=)S
(%u:0x%x",)378 2112 A
(\(unsigned\))420 2532 A
(saved_proc->p_reg.cs,)882 2994 A
4995 V
(08071)210 1122 A
(\(unsigned\))420 1524 A
(saved_proc->p_reg.pc\);)924 1986 A
5085 V
(08072)210 1122 A
5175 V
(08073)210 1122 A
(panic\("exception)672 1524 A
2238(in)S
2364(a)S
(kernel)252 2448 A
(task",)252 2742 A
(NO_NUM\);)336 3036 A
5265 V
(08074)210 1122 A
1440(})S
5895 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5985 V
(kernel/i8259.c)588 2676 A
6075 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6255 V
(08100)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(routines)336 2364 A
(for)126 2742 A
(initializing)504 2910 A
(the)126 3456 A
(8259)168 3624 A
(interrupt)378 3834 A
(controller:)462 4254 A
6345 V
(08101)210 1122 A
1482(*)S
(put_irq_handler:)672 1776 A
(register)336 2490 A
2868(an)S
(interrupt)378 2994 A
(handler)294 3414 A
6435 V
(08102)210 1122 A
1482(*)S
(rm_irq_handler:)630 1776 A
(deregister)420 2448 A
2910(an)S
(interrupt)378 3036 A
(handler)294 3456 A
6525 V
(08103)210 1122 A
1482(*)S
(intr_handle:)504 1776 A
(handle)252 2448 A
2742(a)S
(hardware)336 2826 A
(interrupt)378 3204 A
6615 V
(08104)210 1122 A
1482(*)S
(intr_init:)420 1776 A
(initialize)420 2448 A
(the)126 2910 A
(interrupt)378 3078 A
(controller\(s\))546 3498 A
6705 V
(08105)210 1122 A
1482(*/)S
6795 V
(08106)210 1122 A
6885 V
(08107)210 1122 A
(#include)336 1440 A
("kernel.h")420 1818 A
6975 V
(08108)210 1122 A
(#include)336 1440 A
("proc.h")336 1818 A
7065 V
(08109)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
8418 V
EP
%%Page: 96 96
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(96)S
11 R
2444(File:)S
(kernel/i8259.c)638 2677 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(08110)210 1122 A
1845 V
(08111)210 1122 A
(#define)294 1440 A
(ICW1_AT)294 1776 A
(0x11)168 2448 A
2784(/*)S
(edge)168 2910 A
(triggered,)420 3120 A
(cascade,)336 3582 A
(need)168 3960 A
(ICW4)168 4170 A
4380(*/)S
1935 V
(08112)210 1122 A
(#define)294 1440 A
(ICW1_PC)294 1776 A
(0x13)168 2448 A
2784(/*)S
(edge)168 2910 A
(triggered,)420 3120 A
3582(no)S
(cascade,)336 3708 A
(need)168 4086 A
(ICW4)168 4296 A
4506(*/)S
2025 V
(08113)210 1122 A
(#define)294 1440 A
(ICW1_PS)294 1776 A
(0x19)168 2448 A
2784(/*)S
(level)210 2910 A
(triggered,)420 3162 A
(cascade,)336 3624 A
(need)168 4002 A
(ICW4)168 4212 A
4422(*/)S
2115 V
(08114)210 1122 A
(#define)294 1440 A
(ICW4_AT_SLAVE)546 1776 A
(0x01)168 2448 A
2784(/*)S
(not)126 2910 A
(SFNM,)210 3078 A
(not)126 3330 A
(buffered,)378 3498 A
(normal)252 3918 A
(EOI,)168 4212 A
(8086)168 4422 A
4632(*/)S
2205 V
(08115)210 1122 A
(#define)294 1440 A
(ICW4_AT_MASTER)588 1776 A
(0x05)168 2448 A
2784(/*)S
(not)126 2910 A
(SFNM,)210 3078 A
(not)126 3330 A
(buffered,)378 3498 A
(normal)252 3918 A
(EOI,)168 4212 A
(8086)168 4422 A
4632(*/)S
2295 V
(08116)210 1122 A
(#define)294 1440 A
(ICW4_PC_SLAVE)546 1776 A
(0x09)168 2448 A
2784(/*)S
(not)126 2910 A
(SFNM,)210 3078 A
(buffered,)378 3330 A
(normal)252 3750 A
(EOI,)168 4044 A
(8086)168 4254 A
4464(*/)S
2385 V
(08117)210 1122 A
(#define)294 1440 A
(ICW4_PC_MASTER)588 1776 A
(0x0D)168 2448 A
2784(/*)S
(not)126 2910 A
(SFNM,)210 3078 A
(buffered,)378 3330 A
(normal)252 3750 A
(EOI,)168 4044 A
(8086)168 4254 A
4464(*/)S
2475 V
(08118)210 1122 A
2565 V
(08119)210 1122 A
(#define)294 1440 A
(set_vec\(nr,)462 1776 A
(addr\))210 2280 A
(\(\(void\)0\))378 2784 A
2655 V
(08120)210 1122 A
2745 V
(08121)210 1122 A
(/*===========================================================================*)3276 1440 A
2835 V
(08122)210 1122 A
1482(*)S
(intr_init)378 2784 A
4674(*)S
2925 V
(08123)210 1122 A
(*===========================================================================*/)3276 1482 A
3015 V
(08124)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(intr_init\(mine\))630 1944 A
3105 V
(08125)210 1122 A
(int)126 1440 A
(mine;)210 1608 A
3195 V
(08126)210 1122 A
1440({)S
3285 V
(08127)210 1122 A
1440(/*)S
(Initialize)420 1566 A
(the)126 2028 A
(8259s,)252 2196 A
(finishing)378 2490 A
(with)168 2910 A
(all)126 3120 A
(interrupts)420 3288 A
(disabled.)378 3750 A
(This)168 4212 A
4422(is)S
3375 V
(08128)210 1122 A
1482(*)S
(only)168 1566 A
(done)168 1776 A
1986(in)S
(protected)378 2112 A
(mode,)210 2532 A
2784(in)S
(real)168 2910 A
(mode)168 3120 A
3330(we)S
(don't)210 3456 A
(touch)210 3708 A
(the)126 3960 A
(8259s,)252 4128 A
(but)126 4422 A
3465 V
(08129)210 1122 A
1482(*)S
(use)126 1566 A
(the)126 1734 A
(BIOS)168 1902 A
(locations)378 2112 A
(instead.)336 2532 A
(The)126 2952 A
(flag)168 3120 A
("mine")252 3330 A
3624(is)S
(set)126 3750 A
3918(if)S
(the)126 4044 A
(8259s)210 4212 A
(are)126 4464 A
3555 V
(08130)210 1122 A
1482(*)S
1566(to)S
1692(be)S
(programmed)420 1818 A
(for)126 2280 A
(MINIX,)252 2448 A
2742(or)S
2868(to)S
2994(be)S
(reset)210 3120 A
3372(to)S
(what)168 3498 A
(the)126 3708 A
(BIOS)168 3876 A
(expects.)336 4086 A
3645 V
(08131)210 1122 A
1482(*/)S
3735 V
(08132)210 1122 A
(int)126 1524 A
1692(i;)S
3825 V
(08133)210 1122 A
3915 V
(08134)210 1122 A
(intr_disable\(\);)630 1524 A
4005 V
(08135)210 1122 A
4095 V
(08136)210 1122 A
1692(/*)S
(The)126 1818 A
1986(AT)S
(and)126 2112 A
(newer)210 2280 A
(PS/2)168 2532 A
(have)168 2742 A
(two)126 2952 A
(interrupt)378 3120 A
(controllers,)504 3540 A
(one)126 4086 A
(master,)294 4254 A
4185 V
(08137)210 1122 A
1734(*)S
(one)126 1818 A
(slaved)252 1986 A
2280(at)S
(IRQ)126 2406 A
2574(2.)S
(\(We)126 2742 A
(don't)210 2910 A
(have)168 3162 A
3372(to)S
(deal)168 3498 A
(with)168 3708 A
(the)126 3918 A
4086(PC)S
(that)168 4212 A
4275 V
(08138)210 1122 A
1734(*)S
(has)126 1818 A
(just)168 1986 A
(one)126 2196 A
(controller,)462 2364 A
(because)294 2868 A
3204(it)S
(must)168 3330 A
(run)126 3540 A
3708(in)S
(real)168 3834 A
(mode.\))252 4044 A
4365 V
(08139)210 1122 A
1734(*/)S
4455 V
(08140)210 1122 A
(outb\(INT_CTL,)546 1692 A
(machine.ps_mca)588 2280 A
2910(?)S
(ICW1_PS)294 2994 A
3330(:)S
(ICW1_AT\);)378 3414 A
4545 V
(08141)210 1122 A
(outb\(INT_CTLMASK,)714 1692 A
(mine)168 2448 A
2658(?)S
(IRQ0_VECTOR)462 2742 A
3246(:)S
(BIOS_IRQ0_VEC\);)630 3330 A
4635 V
(08142)210 1122 A
3792(/*)S
(ICW2)168 3918 A
(for)126 4128 A
(master)252 4296 A
4590(*/)S
4725 V
(08143)210 1122 A
(outb\(INT_CTLMASK,)714 1692 A
2448(\(1)S
2574(<<)S
(CASCADE_IRQ\)\);)588 2700 A
3792(/*)S
(ICW3)168 3918 A
(tells)210 4128 A
(slaves)252 4380 A
4674(*/)S
4815 V
(08144)210 1122 A
(outb\(INT_CTLMASK,)714 1692 A
(ICW4_AT_MASTER\);)672 2448 A
4905 V
(08145)210 1122 A
(outb\(INT_CTLMASK,)714 1692 A
(\304\(1)126 2448 A
2616(<<)S
(CASCADE_IRQ\)\);)588 2742 A
3792(/*)S
(IRQ)126 3918 A
(0-7)126 4086 A
(mask)168 4254 A
4464(*/)S
4995 V
(08146)210 1122 A
(outb\(INT2_CTL,)588 1692 A
(machine.ps_mca)588 2322 A
2952(?)S
(ICW1_PS)294 3036 A
3372(:)S
(ICW1_AT\);)378 3456 A
5085 V
(08147)210 1122 A
(outb\(INT2_CTLMASK,)756 1692 A
(mine)168 2490 A
2700(?)S
(IRQ8_VECTOR)462 2784 A
3288(:)S
(BIOS_IRQ8_VEC\);)630 3372 A
5175 V
(08148)210 1122 A
3792(/*)S
(ICW2)168 3918 A
(for)126 4128 A
(slave)210 4296 A
4548(*/)S
5265 V
(08149)210 1122 A
(outb\(INT2_CTLMASK,)756 1692 A
(CASCADE_IRQ\);)546 2490 A
3456(/*)S
(ICW3)168 3582 A
3792(is)S
(slave)210 3918 A
4170(nr)S
4296(*/)S
5355 V
(08150)210 1122 A
(outb\(INT2_CTLMASK,)756 1692 A
(ICW4_AT_SLAVE\);)630 2490 A
5445 V
(08151)210 1122 A
(outb\(INT2_CTLMASK,)756 1692 A
(\3040\);)168 2490 A
3792(/*)S
(IRQ)126 3918 A
(8-15)168 4086 A
(mask)168 4296 A
4506(*/)S
5535 V
(08152)210 1122 A
5625 V
(08153)210 1122 A
1692(/*)S
(Copy)168 1818 A
(the)126 2028 A
(BIOS)168 2196 A
(vectors)294 2406 A
(from)168 2742 A
(the)126 2952 A
(BIOS)168 3120 A
3330(to)S
(the)126 3456 A
(Minix)210 3624 A
(location,)378 3876 A
4296(so)S
4422(we)S
5715 V
(08154)210 1122 A
1734(*)S
(can)126 1818 A
(still)210 1986 A
(make)168 2238 A
(BIOS)168 2448 A
(calls)210 2658 A
(without)294 2910 A
(reprogramming)546 3246 A
(the)126 3834 A
(i8259s.)294 4002 A
5805 V
(08155)210 1122 A
1734(*/)S
5895 V
(08156)210 1122 A
(phys_copy\(BIOS_VECTOR\(0\))1008 1692 A
2742(*)S
(4L,)126 2826 A
(VECTOR\(0\))378 2994 A
3414(*)S
(4L,)126 3498 A
3666(8)S
3750(*)S
(4L\);)168 3834 A
5985 V
(08157)210 1122 A
1440(})S
6165 V
(08159)210 1122 A
(/*===========================================================================*)3276 1440 A
6255 V
(08160)210 1122 A
1482(*)S
(put_irq_handler)630 2784 A
4674(*)S
6345 V
(08161)210 1122 A
(*===========================================================================*/)3276 1482 A
6435 V
(08162)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(put_irq_handler\(hook,)882 1944 A
(irq,)168 2868 A
(handler\))336 3078 A
6525 V
(08163)210 1122 A
(irq_hook_t)420 1440 A
(*hook;)252 1902 A
6615 V
(08164)210 1122 A
(int)126 1440 A
(irq;)168 1608 A
6705 V
(08165)210 1122 A
(irq_handler_t)546 1440 A
(handler;)336 2028 A
6795 V
(08166)210 1122 A
1440({)S
6885 V
(08167)210 1122 A
1440(/*)S
(Register)336 1566 A
1944(an)S
(interrupt)378 2070 A
(handler.)336 2490 A
2868(*/)S
6975 V
(08168)210 1122 A
(int)126 1524 A
(id;)126 1692 A
7065 V
(08169)210 1122 A
(irq_hook_t)420 1524 A
(**line;)294 1986 A
8418 V
EP
%%Page: 97 97
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2444(File:)S
(kernel/i8259.c)638 2677 A
12 B
4560(97)S
1755 V
7 LST
(08170)210 1122 A
1845 V
(08171)210 1122 A
1524(if)S
(\(irq)168 1650 A
1860(<)S
1944(0)S
2028(||)S
(irq)126 2154 A
2322(>=)S
(NR_IRQ_VECTORS\))630 2448 A
1935 V
(08172)210 1122 A
(panic\("invalid)588 1692 A
(call)168 2322 A
2532(to)S
(put_irq_handler",)714 2658 A
(irq\);)210 3414 A
2025 V
(08173)210 1122 A
2115 V
(08174)210 1122 A
(line)168 1524 A
1734(=)S
(&irq_handlers[irq];)798 1818 A
2205 V
(08175)210 1122 A
1524(id)S
1650(=)S
1734(1;)S
2295 V
(08176)210 1122 A
(while)210 1524 A
(\(*line)252 1776 A
2070(!=)S
(NULL\))210 2196 A
2448({)S
2385 V
(08177)210 1122 A
1692(if)S
(\(hook)210 1818 A
2070(==)S
(*line\))252 2196 A
(return;)294 2490 A
3120(/*)S
(extra)210 3246 A
(initialization)588 3498 A
4128(*/)S
2475 V
(08178)210 1122 A
(line)168 1692 A
1902(=)S
(&\(*line\)->next;)630 1986 A
2565 V
(08179)210 1122 A
1692(id)S
(<<=)126 1818 A
1986(1;)S
2655 V
(08180)210 1122 A
1524(})S
2745 V
(08181)210 1122 A
1524(if)S
(\(id)126 1650 A
1818(==)S
1944(0\))S
(panic\("Too)420 2070 A
(many)168 2532 A
(handlers)336 2742 A
(for)126 3120 A
(irq",)210 3288 A
(irq\);)210 3540 A
2835 V
(08182)210 1122 A
2925 V
(08183)210 1122 A
(hook->next)420 1524 A
1986(=)S
(NULL;)210 2070 A
3015 V
(08184)210 1122 A
(hook->handler)546 1524 A
2112(=)S
(handler;)336 2196 A
3105 V
(08185)210 1122 A
(hook->irq)378 1524 A
1944(=)S
(irq;)168 2028 A
3195 V
(08186)210 1122 A
(hook->id)336 1524 A
1902(=)S
(id;)126 1986 A
3285 V
(08187)210 1122 A
(*line)210 1524 A
1776(=)S
(hook;)210 1860 A
3375 V
(08188)210 1122 A
3465 V
(08189)210 1122 A
(irq_use)294 1524 A
1860(|=)S
1986(1)S
2070(<<)S
(irq;)168 2196 A
3555 V
(08190)210 1122 A
1440(})S
3735 V
(08192)210 1122 A
(/*===========================================================================*)3276 1440 A
3825 V
(08193)210 1122 A
1482(*)S
(rm_irq_handler)588 2784 A
4674(*)S
3915 V
(08194)210 1122 A
(*===========================================================================*/)3276 1482 A
4005 V
(08195)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(rm_irq_handler\(hook\))840 1944 A
4095 V
(08196)210 1122 A
(irq_hook_t)420 1440 A
(*hook;)252 1902 A
4185 V
(08197)210 1122 A
1440({)S
4275 V
(08198)210 1122 A
1440(/*)S
(Unregister)420 1566 A
2028(an)S
(interrupt)378 2154 A
(handler.)336 2574 A
2952(*/)S
4365 V
(08199)210 1122 A
(int)126 1524 A
(irq)126 1692 A
1860(=)S
(hook->irq;)420 1944 A
4455 V
(08200)210 1122 A
(int)126 1524 A
1692(id)S
1818(=)S
(hook->id;)378 1902 A
4545 V
(08201)210 1122 A
(irq_hook_t)420 1524 A
(**line;)294 1986 A
4635 V
(08202)210 1122 A
4725 V
(08203)210 1122 A
1524(if)S
(\(irq)168 1650 A
1860(<)S
1944(0)S
2028(||)S
(irq)126 2154 A
2322(>=)S
(NR_IRQ_VECTORS\))630 2448 A
4815 V
(08204)210 1122 A
(panic\("invalid)588 1692 A
(call)168 2322 A
2532(to)S
(rm_irq_handler",)672 2658 A
(irq\);)210 3372 A
4905 V
(08205)210 1122 A
4995 V
(08206)210 1122 A
(line)168 1524 A
1734(=)S
(&irq_handlers[irq];)798 1818 A
5085 V
(08207)210 1122 A
(while)210 1524 A
(\(*line)252 1776 A
2070(!=)S
(NULL\))210 2196 A
2448({)S
5175 V
(08208)210 1122 A
1692(if)S
(\(\(*line\)->id)504 1818 A
2364(==)S
(id\))126 2490 A
2658({)S
5265 V
(08209)210 1122 A
(\(*line\))294 1860 A
2196(=)S
(\(*line\)->next;)588 2280 A
5355 V
(08210)210 1122 A
1860(if)S
1986(\(!)S
(irq_handlers[irq]\))756 2112 A
(irq_use)294 2910 A
3246(&=)S
(\304\(1)126 3372 A
3540(<<)S
(irq\);)210 3666 A
5445 V
(08211)210 1122 A
(return;)294 1860 A
5535 V
(08212)210 1122 A
1692(})S
5625 V
(08213)210 1122 A
(line)168 1692 A
1902(=)S
(&\(*line\)->next;)630 1986 A
5715 V
(08214)210 1122 A
1524(})S
5805 V
(08215)210 1122 A
1524(/*)S
(When)168 1650 A
(the)126 1860 A
(handler)294 2028 A
2364(is)S
(not)126 2490 A
(found,)252 2658 A
(normally)336 2952 A
(return)252 3330 A
(here.)210 3624 A
3876(*/)S
5895 V
(08216)210 1122 A
1440(})S
6075 V
(08218)210 1122 A
(/*===========================================================================*)3276 1440 A
6165 V
(08219)210 1122 A
1482(*)S
(intr_handle)462 2784 A
4674(*)S
6255 V
(08220)210 1122 A
(*===========================================================================*/)3276 1482 A
6345 V
(08221)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(intr_handle\(hook\))714 1944 A
6435 V
(08222)210 1122 A
(irq_hook_t)420 1440 A
(*hook;)252 1902 A
6525 V
(08223)210 1122 A
1440({)S
6615 V
(08224)210 1122 A
1440(/*)S
(Call)168 1566 A
(the)126 1776 A
(interrupt)378 1944 A
(handlers)336 2364 A
(for)126 2742 A
2910(an)S
(interrupt)378 3036 A
(with)168 3456 A
(the)126 3666 A
(given)210 3834 A
(hook)168 4086 A
(list.)210 4296 A
6705 V
(08225)210 1122 A
1482(*)S
(The)126 1566 A
(assembly)336 1734 A
(part)168 2112 A
2322(of)S
(the)126 2448 A
(handler)294 2616 A
(has)126 2952 A
(already)294 3120 A
(masked)252 3456 A
(the)126 3750 A
(IRQ,)168 3918 A
(reenabled)378 4128 A
(the)126 4548 A
6795 V
(08226)210 1122 A
1482(*)S
(controller\(s\))546 1566 A
(and)126 2154 A
(enabled)294 2322 A
(interrupts.)462 2658 A
6885 V
(08227)210 1122 A
1482(*/)S
6975 V
(08228)210 1122 A
7065 V
(08229)210 1122 A
1524(/*)S
(Call)168 1650 A
(list)168 1860 A
2070(of)S
(handlers)336 2196 A
(for)126 2574 A
2742(an)S
(IRQ.)168 2868 A
3078(*/)S
8418 V
EP
%%Page: 98 98
BP
/slant 0 def
/height 0 def
1485 V
12 B
1080(98)S
11 R
2444(File:)S
(kernel/i8259.c)638 2677 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(08230)210 1122 A
(while)210 1524 A
(\(hook)210 1776 A
2028(!=)S
(NULL\))210 2154 A
2406({)S
1845 V
(08231)210 1122 A
1692(/*)S
(For)126 1818 A
(each)168 1986 A
(handler)294 2196 A
2532(in)S
(the)126 2658 A
(list,)210 2826 A
(mark)168 3078 A
3288(it)S
(active)252 3414 A
3708(by)S
(setting)294 3834 A
(its)126 4170 A
4338(ID)S
(bit,)168 4464 A
1935 V
(08232)210 1122 A
1734(*)S
(call)168 1818 A
(the)126 2028 A
(function,)378 2196 A
(and)126 2616 A
(unmark)252 2784 A
3078(it)S
3204(if)S
(the)126 3330 A
(function)336 3498 A
(returns)294 3876 A
(true.)210 4212 A
2025 V
(08233)210 1122 A
1734(*/)S
2115 V
(08234)210 1122 A
(irq_actids[hook->irq])882 1692 A
2616(|=)S
(hook->id;)378 2742 A
2205 V
(08235)210 1122 A
1692(if)S
(\(\(*hook->handler\)\(hook\)\))1008 1818 A
(irq_actids[hook->irq])882 2868 A
3792(&=)S
(\304hook->id;)420 3918 A
2295 V
(08236)210 1122 A
(hook)168 1692 A
1902(=)S
(hook->next;)462 1986 A
2385 V
(08237)210 1122 A
1524(})S
2475 V
(08238)210 1122 A
2565 V
(08239)210 1122 A
1524(/*)S
(The)126 1650 A
(assembly)336 1818 A
(code)168 2196 A
(will)168 2406 A
(now)126 2616 A
(disable)294 2784 A
(interrupts,)462 3120 A
(unmask)252 3624 A
(the)126 3918 A
(IRQ)126 4086 A
4254(if)S
(and)126 4380 A
(only)168 4548 A
2655 V
(08240)210 1122 A
1566(*)S
1650(if)S
(all)126 1776 A
(active)252 1944 A
2238(ID)S
(bits)168 2364 A
(are)126 2574 A
(cleared,)336 2742 A
(and)126 3120 A
(restart)294 3288 A
3624(a)S
(process.)336 3708 A
2745 V
(08241)210 1122 A
1566(*/)S
2835 V
(08242)210 1122 A
1440(})S
3195 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3285 V
(kernel/protect.c)672 2676 A
3375 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3555 V
(08300)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(code)168 2364 A
(for)126 2574 A
(initialization)588 2742 A
3372(of)S
(protected)378 3498 A
(mode,)210 3918 A
4170(to)S
(initialize)420 4296 A
3645 V
(08301)210 1122 A
1482(*)S
(code)168 1566 A
(and)126 1776 A
(data)168 1944 A
(segment)294 2154 A
(descriptors,)504 2490 A
(and)126 3036 A
3204(to)S
(initialize)420 3330 A
(global)252 3792 A
(descriptors)462 4086 A
3735 V
(08302)210 1122 A
1482(*)S
(for)126 1566 A
(local)210 1734 A
(descriptors)462 1986 A
2490(in)S
(the)126 2616 A
(process)294 2784 A
(table.)252 3120 A
3825 V
(08303)210 1122 A
1482(*/)S
3915 V
(08304)210 1122 A
4005 V
(08305)210 1122 A
(#include)336 1440 A
("kernel.h")420 1818 A
4095 V
(08306)210 1122 A
(#include)336 1440 A
("proc.h")336 1818 A
4185 V
(08307)210 1122 A
(#include)336 1440 A
("protect.h")462 1818 A
4275 V
(08308)210 1122 A
4365 V
(08309)210 1122 A
(#define)294 1440 A
(INT_GATE_TYPE)546 1776 A
(\(INT_286_GATE)546 2448 A
3036(|)S
(DESC_386_BIT\))546 3120 A
4455 V
(08310)210 1122 A
(#define)294 1440 A
(TSS_TYPE)336 1776 A
(\(AVL_286_TSS)504 2448 A
3036(|)S
(DESC_386_BIT\))546 3120 A
4545 V
(08311)210 1122 A
4635 V
(08312)210 1122 A
(struct)252 1440 A
(desctableptr_s)588 1734 A
2364({)S
4725 V
(08313)210 1122 A
(char)168 1524 A
(limit[sizeof\(u16_t\)];)882 1734 A
4815 V
(08314)210 1122 A
(char)168 1524 A
(base[sizeof\(u32_t\)];)840 1734 A
3120(/*)S
(really)252 3246 A
(u24_t)210 3540 A
3792(+)S
(pad)126 3876 A
(for)126 4044 A
(286)126 4212 A
4380(*/)S
4905 V
(08315)210 1122 A
1440(};)S
4995 V
(08316)210 1122 A
5085 V
(08317)210 1122 A
(struct)252 1440 A
(gatedesc_s)420 1734 A
2196({)S
5175 V
(08318)210 1122 A
(u16_t)210 1524 A
(offset_low;)462 1776 A
5265 V
(08319)210 1122 A
(u16_t)210 1524 A
(selector;)378 1776 A
5355 V
(08320)210 1122 A
(u8_t)168 1524 A
(pad;)168 1734 A
2784(/*)S
(|000|XXXXX|)462 2910 A
3414(ig)S
3540(&)S
(trpg,)210 3624 A
(|XXXXXXXX|)420 3876 A
(task)168 4338 A
4548(g)S
4632(*/)S
5445 V
(08321)210 1122 A
(u8_t)168 1524 A
(p_dpl_type;)462 1734 A
2784(/*)S
(|P|DL|0|TYPE|)546 2910 A
3498(*/)S
5535 V
(08322)210 1122 A
(u16_t)210 1524 A
(offset_high;)504 1776 A
5625 V
(08323)210 1122 A
1440(};)S
5715 V
(08324)210 1122 A
5805 V
(08325)210 1122 A
(struct)252 1440 A
(tss_s)210 1734 A
1986({)S
5895 V
(08326)210 1122 A
(reg_t)210 1524 A
(backlink;)378 1776 A
5985 V
(08327)210 1122 A
(reg_t)210 1524 A
(sp0;)168 1776 A
2784(/*)S
(stack)210 2910 A
(pointer)294 3162 A
3498(to)S
(use)126 3624 A
(during)252 3792 A
(interrupt)378 4086 A
4506(*/)S
6075 V
(08328)210 1122 A
(reg_t)210 1524 A
(ss0;)168 1776 A
2784(/*)S
2994(")S
(segment)294 3162 A
3540(")S
3666(")S
3876(")S
4254(")S
4506(*/)S
6165 V
(08329)210 1122 A
(reg_t)210 1524 A
(sp1;)168 1776 A
6255 V
(08330)210 1122 A
(reg_t)210 1524 A
(ss1;)168 1776 A
6345 V
(08331)210 1122 A
(reg_t)210 1524 A
(sp2;)168 1776 A
6435 V
(08332)210 1122 A
(reg_t)210 1524 A
(ss2;)168 1776 A
6525 V
(08333)210 1122 A
(reg_t)210 1524 A
(cr3;)168 1776 A
6615 V
(08334)210 1122 A
(reg_t)210 1524 A
(ip;)126 1776 A
6705 V
(08335)210 1122 A
(reg_t)210 1524 A
(flags;)252 1776 A
6795 V
(08336)210 1122 A
(reg_t)210 1524 A
(ax;)126 1776 A
6885 V
(08337)210 1122 A
(reg_t)210 1524 A
(cx;)126 1776 A
6975 V
(08338)210 1122 A
(reg_t)210 1524 A
(dx;)126 1776 A
7065 V
(08339)210 1122 A
(reg_t)210 1524 A
(bx;)126 1776 A
8418 V
EP
%%Page: 99 99
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2415(File:)S
2648(kernel/protect.c)S
12 B
4560(99)S
1755 V
7 LST
(08340)210 1122 A
(reg_t)210 1524 A
(sp;)126 1776 A
1845 V
(08341)210 1122 A
(reg_t)210 1524 A
(bp;)126 1776 A
1935 V
(08342)210 1122 A
(reg_t)210 1524 A
(si;)126 1776 A
2025 V
(08343)210 1122 A
(reg_t)210 1524 A
(di;)126 1776 A
2115 V
(08344)210 1122 A
(reg_t)210 1524 A
(es;)126 1776 A
2205 V
(08345)210 1122 A
(reg_t)210 1524 A
(cs;)126 1776 A
2295 V
(08346)210 1122 A
(reg_t)210 1524 A
(ss;)126 1776 A
2385 V
(08347)210 1122 A
(reg_t)210 1524 A
(ds;)126 1776 A
2475 V
(08348)210 1122 A
(reg_t)210 1524 A
(fs;)126 1776 A
2565 V
(08349)210 1122 A
(reg_t)210 1524 A
(gs;)126 1776 A
2655 V
(08350)210 1122 A
(reg_t)210 1524 A
(ldt;)168 1776 A
2745 V
(08351)210 1122 A
(u16_t)210 1524 A
(trap;)210 1776 A
2835 V
(08352)210 1122 A
(u16_t)210 1524 A
(iobase;)294 1776 A
2925 V
(08353)210 1122 A
1440(/*)S
(u8_t)168 1566 A
(iomap[0];)378 1776 A
2196(*/)S
3015 V
(08354)210 1122 A
1440(};)S
3105 V
(08355)210 1122 A
3195 V
(08356)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(segdesc_s)378 2028 A
(gdt[GDT_SIZE];)588 2448 A
3456(/*)S
(used)168 3582 A
3792(in)S
(klib.s)252 3918 A
(and)126 4212 A
(mpx.s)210 4380 A
4632(*/)S
3285 V
(08357)210 1122 A
(PRIVATE)294 1440 A
(struct)252 1776 A
(gatedesc_s)420 2070 A
(idt[IDT_SIZE];)588 2532 A
3456(/*)S
(zero-init)378 3582 A
4002(so)S
(none)168 4128 A
(present)294 4338 A
4674(*/)S
3375 V
(08358)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(tss_s)210 2028 A
(tss;)168 2280 A
3456(/*)S
(zero)168 3582 A
(init)168 3792 A
4002(*/)S
3465 V
(08359)210 1122 A
3555 V
(08360)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(int_gate,)378 2490 A
(\(unsigned)378 2910 A
(vec_nr,)294 3330 A
(vir_bytes)378 3666 A
(offset,)294 4086 A
3645 V
(08361)210 1122 A
(unsigned)336 2112 A
(dpl_type\))378 2490 A
2910(\);)S
3735 V
(08362)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(sdesc,)252 2490 A
(\(struct)294 2784 A
(segdesc_s)378 3120 A
(*segdp,)294 3540 A
(phys_bytes)420 3876 A
(base,)210 4338 A
3825 V
(08363)210 1122 A
(vir_bytes)378 2112 A
(size\))210 2532 A
2784(\);)S
3915 V
(08364)210 1122 A
4005 V
(08365)210 1122 A
(/*===========================================================================*)3276 1440 A
4095 V
(08366)210 1122 A
1482(*)S
(prot_init)378 2784 A
4674(*)S
4185 V
(08367)210 1122 A
(*===========================================================================*/)3276 1482 A
4275 V
(08368)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(prot_init\(\))462 1944 A
4365 V
(08369)210 1122 A
1440({)S
4455 V
(08370)210 1122 A
1440(/*)S
(Set)126 1566 A
1734(up)S
(tables)252 1860 A
(for)126 2154 A
(protected)378 2322 A
(mode.)210 2742 A
4545 V
(08371)210 1122 A
1482(*)S
(All)126 1566 A
(GDT)126 1734 A
(slots)210 1902 A
(are)126 2154 A
(allocated)378 2322 A
2742(at)S
(compile)294 2868 A
(time.)210 3204 A
4635 V
(08372)210 1122 A
1482(*/)S
4725 V
(08373)210 1122 A
(struct)252 1524 A
(gate_table_s)504 1818 A
(*gtp;)210 2364 A
4815 V
(08374)210 1122 A
(struct)252 1524 A
(desctableptr_s)588 1818 A
(*dtp;)210 2448 A
4905 V
(08375)210 1122 A
(unsigned)336 1524 A
(ldt_index;)420 1902 A
4995 V
(08376)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*rp;)168 2406 A
5085 V
(08377)210 1122 A
5175 V
(08378)210 1122 A
(static)252 1524 A
(struct)252 1818 A
(gate_table_s)504 2112 A
2658({)S
5265 V
(08379)210 1122 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(\(*gate\),)336 2490 A
(\(void\))252 2868 A
3162(\);)S
5355 V
(08380)210 1122 A
(unsigned)336 1776 A
(char)168 2154 A
(vec_nr;)294 2364 A
5445 V
(08381)210 1122 A
(unsigned)336 1776 A
(char)168 2154 A
(privilege;)420 2364 A
5535 V
(08382)210 1122 A
1524(})S
5625 V
(08383)210 1122 A
(gate_table[])504 1524 A
2070(=)S
2154({)S
5715 V
(08384)210 1122 A
1776({)S
(divide_error,)546 1860 A
(DIVIDE_VECTOR,)588 2448 A
(INTR_PRIVILEGE)588 3078 A
3708(},)S
5805 V
(08385)210 1122 A
1776({)S
(single_step_exception,)924 1860 A
(DEBUG_VECTOR,)546 2826 A
(INTR_PRIVILEGE)588 3414 A
4044(},)S
5895 V
(08386)210 1122 A
1776({)S
(nmi,)168 1860 A
(NMI_VECTOR,)462 2070 A
(INTR_PRIVILEGE)588 2574 A
3204(},)S
5985 V
(08387)210 1122 A
1776({)S
(breakpoint_exception,)882 1860 A
(BREAKPOINT_VECTOR,)756 2784 A
(USER_PRIVILEGE)588 3582 A
4212(},)S
6075 V
(08388)210 1122 A
1776({)S
(overflow,)378 1860 A
(OVERFLOW_VECTOR,)672 2280 A
(USER_PRIVILEGE)588 2994 A
3624(},)S
6165 V
(08389)210 1122 A
1776({)S
(bounds_check,)546 1860 A
(BOUNDS_VECTOR,)588 2448 A
(INTR_PRIVILEGE)588 3078 A
3708(},)S
6255 V
(08390)210 1122 A
1776({)S
(inval_opcode,)546 1860 A
(INVAL_OP_VECTOR,)672 2448 A
(INTR_PRIVILEGE)588 3162 A
3792(},)S
6345 V
(08391)210 1122 A
1776({)S
(copr_not_available,)798 1860 A
(COPROC_NOT_VECTOR,)756 2700 A
(INTR_PRIVILEGE)588 3498 A
4128(},)S
6435 V
(08392)210 1122 A
1776({)S
(double_fault,)546 1860 A
(DOUBLE_FAULT_VECTOR,)840 2448 A
(INTR_PRIVILEGE)588 3330 A
3960(},)S
6525 V
(08393)210 1122 A
1776({)S
(copr_seg_overrun,)714 1860 A
(COPROC_SEG_VECTOR,)756 2616 A
(INTR_PRIVILEGE)588 3414 A
4044(},)S
6615 V
(08394)210 1122 A
1776({)S
(inval_tss,)420 1860 A
(INVAL_TSS_VECTOR,)714 2322 A
(INTR_PRIVILEGE)588 3078 A
3708(},)S
6705 V
(08395)210 1122 A
1776({)S
(segment_not_present,)840 1860 A
(SEG_NOT_VECTOR,)630 2742 A
(INTR_PRIVILEGE)588 3414 A
4044(},)S
6795 V
(08396)210 1122 A
1776({)S
(stack_exception,)672 1860 A
(STACK_FAULT_VECTOR,)798 2574 A
(INTR_PRIVILEGE)588 3414 A
4044(},)S
6885 V
(08397)210 1122 A
1776({)S
(general_protection,)798 1860 A
(PROTECTION_VECTOR,)756 2700 A
(INTR_PRIVILEGE)588 3498 A
4128(},)S
6975 V
(08398)210 1122 A
1776({)S
(page_fault,)462 1860 A
(PAGE_FAULT_VECTOR,)756 2364 A
(INTR_PRIVILEGE)588 3162 A
3792(},)S
7065 V
(08399)210 1122 A
1776({)S
(copr_error,)462 1860 A
(COPROC_ERR_VECTOR,)756 2364 A
(INTR_PRIVILEGE)588 3162 A
3792(},)S
8418 V
EP
%%Page: 100 100
BP
/slant 0 def
/height 0 def
1485 V
12 B
(100)180 1080 A
11 R
2415(File:)S
2648(kernel/protect.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(08400)210 1122 A
1776({)S
(hwint00,)336 1860 A
(VECTOR\()294 2238 A
(0\),)126 2574 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
1845 V
(08401)210 1122 A
1776({)S
(hwint01,)336 1860 A
(VECTOR\()294 2238 A
(1\),)126 2574 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
1935 V
(08402)210 1122 A
1776({)S
(hwint02,)336 1860 A
(VECTOR\()294 2238 A
(2\),)126 2574 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
2025 V
(08403)210 1122 A
1776({)S
(hwint03,)336 1860 A
(VECTOR\()294 2238 A
(3\),)126 2574 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
2115 V
(08404)210 1122 A
1776({)S
(hwint04,)336 1860 A
(VECTOR\()294 2238 A
(4\),)126 2574 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
2205 V
(08405)210 1122 A
1776({)S
(hwint05,)336 1860 A
(VECTOR\()294 2238 A
(5\),)126 2574 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
2295 V
(08406)210 1122 A
1776({)S
(hwint06,)336 1860 A
(VECTOR\()294 2238 A
(6\),)126 2574 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
2385 V
(08407)210 1122 A
1776({)S
(hwint07,)336 1860 A
(VECTOR\()294 2238 A
(7\),)126 2574 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
2475 V
(08408)210 1122 A
1776({)S
(hwint08,)336 1860 A
(VECTOR\()294 2238 A
(8\),)126 2574 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
2565 V
(08409)210 1122 A
1776({)S
(hwint09,)336 1860 A
(VECTOR\()294 2238 A
(9\),)126 2574 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
2655 V
(08410)210 1122 A
1776({)S
(hwint10,)336 1860 A
(VECTOR\(10\),)462 2238 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
2745 V
(08411)210 1122 A
1776({)S
(hwint11,)336 1860 A
(VECTOR\(11\),)462 2238 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
2835 V
(08412)210 1122 A
1776({)S
(hwint12,)336 1860 A
(VECTOR\(12\),)462 2238 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
2925 V
(08413)210 1122 A
1776({)S
(hwint13,)336 1860 A
(VECTOR\(13\),)462 2238 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
3015 V
(08414)210 1122 A
1776({)S
(hwint14,)336 1860 A
(VECTOR\(14\),)462 2238 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
3105 V
(08415)210 1122 A
1776({)S
(hwint15,)336 1860 A
(VECTOR\(15\),)462 2238 A
(INTR_PRIVILEGE)588 2742 A
3372(},)S
3195 V
(08416)210 1122 A
1776({)S
(s_call,)294 1860 A
(SYS386_VECTOR,)588 2196 A
(USER_PRIVILEGE)588 2826 A
3456(},)S
3792(/*)S
(386)126 3918 A
(system)252 4086 A
(call)168 4380 A
4590(*/)S
3285 V
(08417)210 1122 A
1776({)S
(level0_call,)504 1860 A
(LEVEL0_VECTOR,)588 2406 A
(TASK_PRIVILEGE)588 3036 A
3666(},)S
3375 V
(08418)210 1122 A
1524(};)S
3465 V
(08419)210 1122 A
3555 V
(08420)210 1122 A
1524(/*)S
(Build)210 1650 A
(gdt)126 1902 A
(and)126 2070 A
(idt)126 2238 A
(pointers)336 2406 A
2784(in)S
(GDT)126 2910 A
(where)210 3078 A
(the)126 3330 A
(BIOS)168 3498 A
(expects)294 3708 A
(them.)210 4044 A
4296(*/)S
3645 V
(08421)210 1122 A
(dtp=)168 1524 A
(\(struct)294 1734 A
(desctableptr_s)588 2070 A
2700(*\))S
(&gdt[GDT_INDEX];)672 2826 A
3735 V
(08422)210 1122 A
1524(*)S
(\(u16_t)252 1608 A
1902(*\))S
(dtp->limit)420 2028 A
2490(=)S
(\(sizeof)294 2574 A
(gdt\))168 2910 A
3120(-)S
3204(1;)S
3825 V
(08423)210 1122 A
1524(*)S
(\(u32_t)252 1608 A
1902(*\))S
(dtp->base)378 2028 A
2448(=)S
(vir2phys\(gdt\);)588 2532 A
3915 V
(08424)210 1122 A
4005 V
(08425)210 1122 A
(dtp=)168 1524 A
(\(struct)294 1734 A
(desctableptr_s)588 2070 A
2700(*\))S
(&gdt[IDT_INDEX];)672 2826 A
4095 V
(08426)210 1122 A
1524(*)S
(\(u16_t)252 1608 A
1902(*\))S
(dtp->limit)420 2028 A
2490(=)S
(\(sizeof)294 2574 A
(idt\))168 2910 A
3120(-)S
3204(1;)S
4185 V
(08427)210 1122 A
1524(*)S
(\(u32_t)252 1608 A
1902(*\))S
(dtp->base)378 2028 A
2448(=)S
(vir2phys\(idt\);)588 2532 A
4275 V
(08428)210 1122 A
4365 V
(08429)210 1122 A
1524(/*)S
(Build)210 1650 A
(segment)294 1902 A
(descriptors)462 2238 A
(for)126 2742 A
(tasks)210 2910 A
(and)126 3162 A
(interrupt)378 3330 A
(handlers.)378 3750 A
4170(*/)S
4455 V
(08430)210 1122 A
(init_codeseg\(&gdt[CS_INDEX],)1176 1524 A
4545 V
(08431)210 1122 A
(kinfo.code_base,)672 1818 A
(kinfo.code_size,)672 2532 A
(INTR_PRIVILEGE\);)672 3246 A
4635 V
(08432)210 1122 A
(init_dataseg\(&gdt[DS_INDEX],)1176 1524 A
4725 V
(08433)210 1122 A
(kinfo.data_base,)672 1818 A
(kinfo.data_size,)672 2532 A
(INTR_PRIVILEGE\);)672 3246 A
4815 V
(08434)210 1122 A
(init_dataseg\(&gdt[ES_INDEX],)1176 1524 A
(0L,)126 2742 A
2910(0,)S
(TASK_PRIVILEGE\);)672 3036 A
4905 V
(08435)210 1122 A
4995 V
(08436)210 1122 A
1524(/*)S
(Build)210 1650 A
(scratch)294 1902 A
(descriptors)462 2238 A
(for)126 2742 A
(functions)378 2910 A
3330(in)S
(klib88.)294 3456 A
3792(*/)S
5085 V
(08437)210 1122 A
(init_dataseg\(&gdt[DS_286_INDEX],)1344 1524 A
(0L,)126 2910 A
3078(0,)S
(TASK_PRIVILEGE\);)672 3204 A
5175 V
(08438)210 1122 A
(init_dataseg\(&gdt[ES_286_INDEX],)1344 1524 A
(0L,)126 2910 A
3078(0,)S
(TASK_PRIVILEGE\);)672 3204 A
5265 V
(08439)210 1122 A
5355 V
(08440)210 1122 A
1524(/*)S
(Build)210 1650 A
(local)210 1902 A
(descriptors)462 2154 A
2658(in)S
(GDT)126 2784 A
(for)126 2952 A
(LDT's)210 3120 A
3372(in)S
(process)294 3498 A
(table.)252 3834 A
5445 V
(08441)210 1122 A
1566(*)S
(The)126 1650 A
(LDT's)210 1818 A
(are)126 2070 A
(allocated)378 2238 A
2658(at)S
(compile)294 2784 A
(time)168 3120 A
3330(in)S
(the)126 3456 A
(process)294 3624 A
(table,)252 3960 A
(and)126 4254 A
5535 V
(08442)210 1122 A
1566(*)S
(initialized)462 1650 A
(whenever)336 2154 A
2532(a)S
(process')336 2616 A
(map)126 2994 A
3162(is)S
(initialized)462 3288 A
3792(or)S
(changed.)336 3918 A
5625 V
(08443)210 1122 A
1566(*/)S
5715 V
(08444)210 1122 A
(for)126 1524 A
(\(rp)126 1692 A
1860(=)S
(BEG_PROC_ADDR,)588 1944 A
(ldt_index)378 2574 A
2994(=)S
(FIRST_LDT_INDEX;)672 3078 A
5805 V
(08445)210 1122 A
1734(rp)S
1860(<)S
(END_PROC_ADDR;)588 1944 A
(++rp,)210 2574 A
(ldt_index++\))504 2826 A
3372({)S
5895 V
(08446)210 1122 A
(init_dataseg\(&gdt[ldt_index],)1218 1776 A
(vir2phys\(rp->p_ldt\),)840 3036 A
5985 V
(08447)210 1122 A
(sizeof\(rp->p_ldt\),)756 2994 A
(INTR_PRIVILEGE\);)672 3792 A
6075 V
(08448)210 1122 A
(gdt[ldt_index].access)882 1776 A
2700(=)S
(PRESENT)294 2784 A
3120(|)S
(LDT;)168 3204 A
6165 V
(08449)210 1122 A
(rp->p_ldt_sel)546 1776 A
2364(=)S
(ldt_index)378 2448 A
2868(*)S
(DESC_SIZE;)420 2952 A
6255 V
(08450)210 1122 A
1524(})S
6345 V
(08451)210 1122 A
6435 V
(08452)210 1122 A
1524(/*)S
(Build)210 1650 A
(main)168 1902 A
(TSS.)168 2112 A
6525 V
(08453)210 1122 A
1566(*)S
(This)168 1650 A
1860(is)S
(used)168 1986 A
(only)168 2196 A
2406(to)S
(record)252 2532 A
(the)126 2826 A
(stack)210 2994 A
(pointer)294 3246 A
3582(to)S
3708(be)S
(used)168 3834 A
(after)210 4044 A
4296(an)S
6615 V
(08454)210 1122 A
1566(*)S
(interrupt.)420 1650 A
6705 V
(08455)210 1122 A
1566(*)S
(The)126 1650 A
(pointer)294 1818 A
2154(is)S
(set)126 2280 A
2448(up)S
2574(so)S
(that)168 2700 A
2910(an)S
(interrupt)378 3036 A
(automatically)546 3456 A
(saves)210 4044 A
(the)126 4296 A
6795 V
(08456)210 1122 A
1566(*)S
(current)294 1650 A
(process's)378 1986 A
(registers)378 2406 A
(ip:cs:f:sp:ss)546 2826 A
3414(in)S
(the)126 3540 A
(correct)294 3708 A
(slots)210 4044 A
4296(in)S
(the)126 4422 A
6885 V
(08457)210 1122 A
1566(*)S
(process)294 1650 A
(table.)252 1986 A
6975 V
(08458)210 1122 A
1566(*/)S
7065 V
(08459)210 1122 A
(tss.ss0)294 1524 A
1860(=)S
(DS_SELECTOR;)504 1944 A
8418 V
EP
%%Page: 101 101
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2415(File:)S
2648(kernel/protect.c)S
12 B
(101)180 4500 A
1755 V
7 LST
(08460)210 1122 A
(init_dataseg\(&gdt[TSS_INDEX],)1218 1524 A
(vir2phys\(&tss\),)630 2784 A
(sizeof\(tss\),)504 3456 A
(INTR_PRIVILEGE\);)672 4002 A
1845 V
(08461)210 1122 A
(gdt[TSS_INDEX].access)882 1524 A
2448(=)S
(PRESENT)294 2532 A
2868(|)S
(\(INTR_PRIVILEGE)630 2952 A
3624(<<)S
(DPL_SHIFT\))420 3750 A
4212(|)S
(TSS_TYPE;)378 4296 A
1935 V
(08462)210 1122 A
2025 V
(08463)210 1122 A
1524(/*)S
(Build)210 1650 A
(descriptors)462 1902 A
(for)126 2406 A
(interrupt)378 2574 A
(gates)210 2994 A
3246(in)S
(IDT.)168 3372 A
3582(*/)S
2115 V
(08464)210 1122 A
(for)126 1524 A
(\(gtp)168 1692 A
1902(=)S
(&gate_table[0];)630 1986 A
2205 V
(08465)210 1122 A
(gtp)126 1734 A
1902(<)S
(&gate_table[sizeof)756 1986 A
(gate_table)420 2784 A
3246(/)S
(sizeof)252 3330 A
(gate_table[0]];)630 3624 A
(++gtp\))252 4296 A
4590({)S
2295 V
(08466)210 1122 A
(int_gate\(gtp->vec_nr,)882 1776 A
(\(vir_bytes\))462 2700 A
(gtp->gate,)420 3204 A
2385 V
(08467)210 1122 A
(PRESENT)294 2154 A
2490(|)S
(INT_GATE_TYPE)546 2574 A
3162(|)S
(\(gtp->privilege)630 3246 A
3918(<<)S
(DPL_SHIFT\)\);)504 4044 A
2475 V
(08468)210 1122 A
1524(})S
2565 V
(08469)210 1122 A
2655 V
(08470)210 1122 A
1524(/*)S
(Complete)336 1650 A
(building)336 2028 A
2406(of)S
(main)168 2532 A
(TSS.)168 2742 A
2952(*/)S
2745 V
(08471)210 1122 A
(tss.iobase)420 1524 A
1986(=)S
(sizeof)252 2070 A
(tss;)168 2364 A
2784(/*)S
(empty)210 2910 A
(i/o)126 3162 A
(permissions)462 3330 A
(map)126 3834 A
4002(*/)S
2835 V
(08472)210 1122 A
1440(})S
3015 V
(08474)210 1122 A
(/*===========================================================================*)3276 1440 A
3105 V
(08475)210 1122 A
1482(*)S
(init_codeseg)504 2784 A
4674(*)S
3195 V
(08476)210 1122 A
(*===========================================================================*/)3276 1482 A
3285 V
(08477)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(init_codeseg\(segdp,)798 1944 A
(base,)210 2784 A
(size,)210 3036 A
(privilege\))420 3288 A
3375 V
(08478)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(segdesc_s)378 2112 A
(*segdp;)294 2532 A
3465 V
(08479)210 1122 A
(phys_bytes)420 1440 A
(base;)210 1902 A
3555 V
(08480)210 1122 A
(vir_bytes)378 1440 A
(size;)210 1860 A
3645 V
(08481)210 1122 A
(int)126 1440 A
(privilege;)420 1608 A
3735 V
(08482)210 1122 A
1440({)S
3825 V
(08483)210 1122 A
1440(/*)S
(Build)210 1566 A
(descriptor)420 1818 A
(for)126 2280 A
2448(a)S
(code)168 2532 A
(segment.)336 2742 A
3120(*/)S
3915 V
(08484)210 1122 A
(sdesc\(segdp,)504 1524 A
(base,)210 2070 A
(size\);)252 2322 A
4005 V
(08485)210 1122 A
(segdp->access)546 1524 A
2112(=)S
(\(privilege)420 2196 A
2658(<<)S
(DPL_SHIFT\))420 2784 A
4095 V
(08486)210 1122 A
2112(|)S
(\(PRESENT)336 2196 A
2574(|)S
(SEGMENT)294 2658 A
2994(|)S
(EXECUTABLE)420 3078 A
3540(|)S
(READABLE\);)420 3624 A
4185 V
(08487)210 1122 A
2112(/*)S
(CONFORMING)420 2238 A
2700(=)S
2784(0,)S
(ACCESSED)336 2910 A
3288(=)S
3372(0)S
3456(*/)S
4275 V
(08488)210 1122 A
1440(})S
4455 V
(08490)210 1122 A
(/*===========================================================================*)3276 1440 A
4545 V
(08491)210 1122 A
1482(*)S
(init_dataseg)504 2784 A
4674(*)S
4635 V
(08492)210 1122 A
(*===========================================================================*/)3276 1482 A
4725 V
(08493)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(init_dataseg\(segdp,)798 1944 A
(base,)210 2784 A
(size,)210 3036 A
(privilege\))420 3288 A
4815 V
(08494)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(segdesc_s)378 2112 A
(*segdp;)294 2532 A
4905 V
(08495)210 1122 A
(phys_bytes)420 1440 A
(base;)210 1902 A
4995 V
(08496)210 1122 A
(vir_bytes)378 1440 A
(size;)210 1860 A
5085 V
(08497)210 1122 A
(int)126 1440 A
(privilege;)420 1608 A
5175 V
(08498)210 1122 A
1440({)S
5265 V
(08499)210 1122 A
1440(/*)S
(Build)210 1566 A
(descriptor)420 1818 A
(for)126 2280 A
2448(a)S
(data)168 2532 A
(segment.)336 2742 A
3120(*/)S
5355 V
(08500)210 1122 A
(sdesc\(segdp,)504 1524 A
(base,)210 2070 A
(size\);)252 2322 A
5445 V
(08501)210 1122 A
(segdp->access)546 1524 A
2112(=)S
(\(privilege)420 2196 A
2658(<<)S
(DPL_SHIFT\))420 2784 A
3246(|)S
(\(PRESENT)336 3330 A
3708(|)S
(SEGMENT)294 3792 A
4128(|)S
(WRITEABLE\);)462 4212 A
5535 V
(08502)210 1122 A
2112(/*)S
(EXECUTABLE)420 2238 A
2700(=)S
2784(0,)S
(EXPAND_DOWN)462 2910 A
3414(=)S
3498(0,)S
(ACCESSED)336 3624 A
4002(=)S
4086(0)S
4170(*/)S
5625 V
(08503)210 1122 A
1440(})S
5805 V
(08505)210 1122 A
(/*===========================================================================*)3276 1440 A
5895 V
(08506)210 1122 A
1482(*)S
(sdesc)210 2784 A
4674(*)S
5985 V
(08507)210 1122 A
(*===========================================================================*/)3276 1482 A
6075 V
(08508)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(sdesc\(segdp,)504 1986 A
(base,)210 2532 A
(size\))210 2784 A
6165 V
(08509)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(segdesc_s)378 2112 A
(*segdp;)294 2532 A
6255 V
(08510)210 1122 A
(phys_bytes)420 1440 A
(base;)210 1902 A
6345 V
(08511)210 1122 A
(vir_bytes)378 1440 A
(size;)210 1860 A
6435 V
(08512)210 1122 A
1440({)S
6525 V
(08513)210 1122 A
1440(/*)S
(Fill)168 1566 A
1776(in)S
(the)126 1902 A
(size)168 2070 A
(fields)252 2280 A
(\(base,)252 2574 A
(limit)210 2868 A
(and)126 3120 A
(granularity\))504 3288 A
3834(of)S
3960(a)S
(descriptor.)462 4044 A
4548(*/)S
6615 V
(08514)210 1122 A
(segdp->base_low)630 1524 A
2196(=)S
(base;)210 2280 A
6705 V
(08515)210 1122 A
(segdp->base_middle)756 1524 A
2322(=)S
(base)168 2406 A
2616(>>)S
(BASE_MIDDLE_SHIFT;)756 2742 A
6795 V
(08516)210 1122 A
(segdp->base_high)672 1524 A
2238(=)S
(base)168 2322 A
2532(>>)S
(BASE_HIGH_SHIFT;)672 2658 A
6885 V
(08517)210 1122 A
6975 V
(08518)210 1122 A
(--size;)294 1524 A
2784(/*)S
(convert)294 2910 A
3246(to)S
3372(a)S
(limit,)252 3456 A
3750(0)S
(size)168 3834 A
(means)210 4044 A
4296(4G)S
4422(*/)S
7065 V
(08519)210 1122 A
1524(if)S
(\(size)210 1650 A
1902(>)S
(BYTE_GRAN_MAX\))588 1986 A
2616({)S
8418 V
EP
%%Page: 102 102
BP
/slant 0 def
/height 0 def
1485 V
12 B
(102)180 1080 A
11 R
2415(File:)S
2648(kernel/protect.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(08520)210 1122 A
(segdp->limit_low)672 1776 A
2490(=)S
(size)168 2574 A
2784(>>)S
(PAGE_GRAN_SHIFT;)672 2910 A
1845 V
(08521)210 1122 A
(segdp->granularity)756 1776 A
2574(=)S
(GRANULAR)336 2658 A
3036(|)S
(\(size)210 3120 A
3372(>>)S
1935 V
(08522)210 1122 A
(\(PAGE_GRAN_SHIFT)672 2994 A
3708(+)S
(GRANULARITY_SHIFT\)\);)840 3792 A
2025 V
(08523)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
2115 V
(08524)210 1122 A
(segdp->limit_low)672 1776 A
2490(=)S
(size;)210 2574 A
2205 V
(08525)210 1122 A
(segdp->granularity)756 1776 A
2574(=)S
(size)168 2658 A
2868(>>)S
(GRANULARITY_SHIFT;)756 2994 A
2295 V
(08526)210 1122 A
1524(})S
2385 V
(08527)210 1122 A
(segdp->granularity)756 1524 A
2322(|=)S
(DEFAULT;)336 2448 A
3120(/*)S
(means)210 3246 A
(BIG)126 3498 A
(for)126 3666 A
(data)168 3834 A
(seg)126 4044 A
4212(*/)S
2475 V
(08528)210 1122 A
1440(})S
2655 V
(08530)210 1122 A
(/*===========================================================================*)3276 1440 A
2745 V
(08531)210 1122 A
1482(*)S
(seg2phys)336 2784 A
4674(*)S
2835 V
(08532)210 1122 A
(*===========================================================================*/)3276 1482 A
2925 V
(08533)210 1122 A
(PUBLIC)252 1440 A
(phys_bytes)420 1734 A
(seg2phys\(seg\))546 2196 A
3015 V
(08534)210 1122 A
(U16_t)210 1440 A
(seg;)168 1692 A
3105 V
(08535)210 1122 A
1440({)S
3195 V
(08536)210 1122 A
1440(/*)S
(Return)252 1566 A
(the)126 1860 A
(base)168 2028 A
(address)294 2238 A
2574(of)S
2700(a)S
(segment,)336 2784 A
(with)168 3162 A
(seg)126 3372 A
(being)210 3540 A
(either)252 3792 A
4086(a)S
(8086)168 4170 A
(segment)294 4380 A
3285 V
(08537)210 1122 A
1482(*)S
(register,)378 1566 A
1986(or)S
2112(a)S
(286/386)294 2196 A
(segment)294 2532 A
(selector.)378 2868 A
3375 V
(08538)210 1122 A
1482(*/)S
3465 V
(08539)210 1122 A
(phys_bytes)420 1524 A
(base;)210 1986 A
3555 V
(08540)210 1122 A
(struct)252 1524 A
(segdesc_s)378 1818 A
(*segdp;)294 2238 A
3645 V
(08541)210 1122 A
3735 V
(08542)210 1122 A
1524(if)S
1650(\(!)S
(machine.protected\))756 1776 A
2574({)S
3825 V
(08543)210 1122 A
(base)168 1776 A
1986(=)S
(hclick_to_physb\(seg\);)882 2070 A
3915 V
(08544)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
4005 V
(08545)210 1122 A
(segdp)210 1776 A
2028(=)S
(&gdt[seg)336 2112 A
2490(>>)S
(3];)126 2616 A
4095 V
(08546)210 1122 A
(base)168 1776 A
1986(=)S
(\(\(u32_t\))336 2196 A
(segdp->base_low)630 2574 A
3246(<<)S
3372(0\))S
4185 V
(08547)210 1122 A
2112(|)S
(\(\(u32_t\))336 2196 A
(segdp->base_middle)756 2574 A
3372(<<)S
(16\))126 3498 A
4275 V
(08548)210 1122 A
2112(|)S
(\(\(u32_t\))336 2196 A
(segdp->base_high)672 2574 A
3288(<<)S
(24\);)168 3414 A
4365 V
(08549)210 1122 A
1524(})S
4455 V
(08550)210 1122 A
(return)252 1524 A
(base;)210 1818 A
4545 V
(08551)210 1122 A
1440(})S
4725 V
(08553)210 1122 A
(/*===========================================================================*)3276 1440 A
4815 V
(08554)210 1122 A
1482(*)S
(phys2seg)336 2784 A
4674(*)S
4905 V
(08555)210 1122 A
(*===========================================================================*/)3276 1482 A
4995 V
(08556)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(phys2seg\(seg,)546 1944 A
(off,)168 2532 A
(phys\))210 2742 A
5085 V
(08557)210 1122 A
(u16_t)210 1440 A
(*seg;)210 1692 A
5175 V
(08558)210 1122 A
(vir_bytes)378 1440 A
(*off;)210 1860 A
5265 V
(08559)210 1122 A
(phys_bytes)420 1440 A
(phys;)210 1902 A
5355 V
(08560)210 1122 A
1440({)S
5445 V
(08561)210 1122 A
1440(/*)S
(Return)252 1566 A
1860(a)S
(segment)294 1944 A
(selector)336 2280 A
(and)126 2658 A
(offset)252 2826 A
(that)168 3120 A
(can)126 3330 A
3498(be)S
(used)168 3624 A
3834(to)S
(reach)210 3960 A
4212(a)S
(physical)336 4296 A
5535 V
(08562)210 1122 A
1482(*)S
(address,)336 1566 A
(for)126 1944 A
(use)126 2112 A
2280(by)S
2406(a)S
(driver)252 2490 A
(doing)210 2784 A
(memory)252 3036 A
(I/O)126 3330 A
3498(in)S
(the)126 3624 A
(A0000)210 3792 A
4044(-)S
(DFFFF)210 4128 A
(range.)252 4380 A
5625 V
(08563)210 1122 A
1482(*/)S
5715 V
(08564)210 1122 A
(*seg)168 1524 A
1734(=)S
(FLAT_DS_SELECTOR;)714 1818 A
5805 V
(08565)210 1122 A
(*off)168 1524 A
1734(=)S
(phys;)210 1818 A
5895 V
(08566)210 1122 A
1440(})S
6075 V
(08568)210 1122 A
(/*===========================================================================*)3276 1440 A
6165 V
(08569)210 1122 A
1482(*)S
(int_gate)336 2784 A
4674(*)S
6255 V
(08570)210 1122 A
(*===========================================================================*/)3276 1482 A
6345 V
(08571)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(int_gate\(vec_nr,)672 1986 A
(offset,)294 2700 A
(dpl_type\))378 3036 A
6435 V
(08572)210 1122 A
(unsigned)336 1440 A
(vec_nr;)294 1818 A
6525 V
(08573)210 1122 A
(vir_bytes)378 1440 A
(offset;)294 1860 A
6615 V
(08574)210 1122 A
(unsigned)336 1440 A
(dpl_type;)378 1818 A
6705 V
(08575)210 1122 A
1440({)S
6795 V
(08576)210 1122 A
1440(/*)S
(Build)210 1566 A
(descriptor)420 1818 A
(for)126 2280 A
2448(an)S
(interrupt)378 2574 A
(gate.)210 2994 A
3246(*/)S
6885 V
(08577)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(gatedesc_s)420 2196 A
(*idp;)210 2658 A
6975 V
(08578)210 1122 A
7065 V
(08579)210 1122 A
(idp)126 1524 A
1692(=)S
(&idt[vec_nr];)546 1776 A
8418 V
EP
%%Page: 103 103
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2415(File:)S
2648(kernel/protect.c)S
12 B
(103)180 4500 A
1755 V
7 LST
(08580)210 1122 A
(idp->offset_low)630 1524 A
2196(=)S
(offset;)294 2280 A
1845 V
(08581)210 1122 A
(idp->selector)546 1524 A
2112(=)S
(CS_SELECTOR;)504 2196 A
1935 V
(08582)210 1122 A
(idp->p_dpl_type)630 1524 A
2196(=)S
(dpl_type;)378 2280 A
2025 V
(08583)210 1122 A
(idp->offset_high)672 1524 A
2238(=)S
(offset)252 2322 A
2616(>>)S
(OFFSET_HIGH_SHIFT;)756 2742 A
2115 V
(08584)210 1122 A
1440(})S
2295 V
(08586)210 1122 A
(/*===========================================================================*)3276 1440 A
2385 V
(08587)210 1122 A
1482(*)S
(enable_iop)420 2784 A
4674(*)S
2475 V
(08588)210 1122 A
(*===========================================================================*/)3276 1482 A
2565 V
(08589)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(enable_iop\(pp\))588 1944 A
2655 V
(08590)210 1122 A
(struct)252 1440 A
(proc)168 1734 A
(*pp;)168 1944 A
2745 V
(08591)210 1122 A
1440({)S
2835 V
(08592)210 1122 A
1440(/*)S
(Allow)210 1566 A
1818(a)S
(user)168 1902 A
(process)294 2112 A
2448(to)S
(use)126 2574 A
(I/O)126 2742 A
(instructions.)546 2910 A
(Change)252 3540 A
(the)126 3834 A
(I/O)126 4002 A
(Permission)420 4170 A
2925 V
(08593)210 1122 A
1482(*)S
(Level)210 1566 A
(bits)168 1818 A
2028(in)S
(the)126 2154 A
(psw.)168 2322 A
(These)210 2532 A
(specify)294 2784 A
(least-privileged)672 3120 A
(Current)294 3834 A
(Permission)420 4170 A
3015 V
(08594)210 1122 A
1482(*)S
(Level)210 1566 A
(allowed)294 1818 A
2154(to)S
(execute)294 2280 A
(I/O)126 2616 A
(instructions.)546 2784 A
(Users)210 3372 A
(and)126 3624 A
(servers)294 3792 A
(have)168 4128 A
(CPL)126 4338 A
4506(3.)S
3105 V
(08595)210 1122 A
1482(*)S
(You)126 1566 A
(can't)210 1734 A
(have)168 1986 A
(less)168 2196 A
(privilege)378 2406 A
(than)168 2826 A
(that.)210 3036 A
(Kernel)252 3288 A
(has)126 3582 A
(CPL)126 3750 A
3918(0,)S
(tasks)210 4044 A
(CPL)126 4296 A
4464(1.)S
3195 V
(08596)210 1122 A
1482(*/)S
3285 V
(08597)210 1122 A
(pp->p_reg.psw)546 1524 A
2112(|=)S
(0x3000;)294 2238 A
3375 V
(08598)210 1122 A
1440(})S
3555 V
(08600)210 1122 A
(/*===========================================================================*)3276 1440 A
3645 V
(08601)210 1122 A
1482(*)S
(alloc_segments)588 2784 A
4674(*)S
3735 V
(08602)210 1122 A
(*===========================================================================*/)3276 1482 A
3825 V
(08603)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(alloc_segments\(rp\))756 1944 A
3915 V
(08604)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(proc)168 2112 A
(*rp;)168 2322 A
4005 V
(08605)210 1122 A
1440({)S
4095 V
(08606)210 1122 A
1440(/*)S
(This)168 1566 A
1776(is)S
(called)252 1902 A
2196(at)S
(system)252 2322 A
(initialization)588 2616 A
(from)168 3246 A
(main\(\))252 3456 A
(and)126 3750 A
3918(by)S
(do_newmap\(\).)504 4044 A
4185 V
(08607)210 1122 A
1482(*)S
(The)126 1566 A
(code)168 1734 A
(has)126 1944 A
2112(a)S
(separate)336 2196 A
(function)336 2574 A
(because)294 2952 A
3288(of)S
(all)126 3414 A
(hardware-dependencies.)924 3582 A
4275 V
(08608)210 1122 A
1482(*)S
(Note)168 1566 A
(that)168 1776 A
(IDLE)168 1986 A
2196(is)S
(part)168 2322 A
2532(of)S
(the)126 2658 A
(kernel)252 2826 A
(and)126 3120 A
(gets)168 3288 A
(TASK_PRIVILEGE)588 3498 A
(here.)210 4128 A
4365 V
(08609)210 1122 A
1482(*/)S
4455 V
(08610)210 1122 A
(phys_bytes)420 1524 A
(code_bytes;)462 1986 A
4545 V
(08611)210 1122 A
(phys_bytes)420 1524 A
(data_bytes;)462 1986 A
4635 V
(08612)210 1122 A
(int)126 1524 A
(privilege;)420 1692 A
4725 V
(08613)210 1122 A
4815 V
(08614)210 1122 A
1524(if)S
(\(machine.protected\))798 1650 A
2490({)S
4905 V
(08615)210 1122 A
(data_bytes)420 1692 A
2154(=)S
(\(phys_bytes\))504 2238 A
(\(rp->p_memmap[S].mem_vir)1008 2784 A
3834(+)S
4995 V
(08616)210 1122 A
(rp->p_memmap[S].mem_len\))1008 1860 A
2910(<<)S
(CLICK_SHIFT;)504 3036 A
5085 V
(08617)210 1122 A
1692(if)S
(\(rp->p_memmap[T].mem_len)1008 1818 A
2868(==)S
2994(0\))S
5175 V
(08618)210 1122 A
(code_bytes)420 1860 A
2322(=)S
(data_bytes;)462 2406 A
3120(/*)S
(common)252 3246 A
(I&D,)168 3540 A
(poor)168 3750 A
(protect)294 3960 A
4296(*/)S
5265 V
(08619)210 1122 A
(else)168 1692 A
5355 V
(08620)210 1122 A
(code_bytes)420 1860 A
2322(=)S
(\(phys_bytes\))504 2406 A
(rp->p_memmap[T].mem_len)966 2952 A
3960(<<)S
(CLICK_SHIFT;)504 4086 A
5445 V
(08621)210 1122 A
(privilege)378 1692 A
2112(=)S
(\(iskernelp\(rp\)\))630 2196 A
2868(?)S
(TASK_PRIVILEGE)588 2952 A
3582(:)S
(USER_PRIVILEGE;)630 3666 A
5535 V
(08622)210 1122 A
(init_codeseg\(&rp->p_ldt[CS_LDT_INDEX],)1596 1692 A
5625 V
(08623)210 1122 A
(\(phys_bytes\))504 1860 A
(rp->p_memmap[T].mem_phys)1008 2406 A
3456(<<)S
(CLICK_SHIFT,)504 3582 A
5715 V
(08624)210 1122 A
(code_bytes,)462 1860 A
(privilege\);)462 2364 A
5805 V
(08625)210 1122 A
(init_dataseg\(&rp->p_ldt[DS_LDT_INDEX],)1596 1692 A
5895 V
(08626)210 1122 A
(\(phys_bytes\))504 1860 A
(rp->p_memmap[D].mem_phys)1008 2406 A
3456(<<)S
(CLICK_SHIFT,)504 3582 A
5985 V
(08627)210 1122 A
(data_bytes,)462 1860 A
(privilege\);)462 2364 A
6075 V
(08628)210 1122 A
(rp->p_reg.cs)504 1692 A
2238(=)S
(\(CS_LDT_INDEX)546 2322 A
2910(*)S
(DESC_SIZE\))420 2994 A
3456(|)S
3540(TI)S
3666(|)S
(privilege;)420 3750 A
6165 V
(08629)210 1122 A
(rp->p_reg.gs)504 1692 A
2238(=)S
6255 V
(08630)210 1122 A
(rp->p_reg.fs)504 1692 A
2238(=)S
6345 V
(08631)210 1122 A
(rp->p_reg.ss)504 1692 A
2238(=)S
6435 V
(08632)210 1122 A
(rp->p_reg.es)504 1692 A
2238(=)S
6525 V
(08633)210 1122 A
(rp->p_reg.ds)504 1692 A
2238(=)S
(\(DS_LDT_INDEX*DESC_SIZE\))1008 2322 A
3372(|)S
3456(TI)S
3582(|)S
(privilege;)420 3666 A
6615 V
(08634)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
6705 V
(08635)210 1122 A
(rp->p_reg.cs)504 1692 A
2238(=)S
(click_to_hclick\(rp->p_memmap[T].mem_phys\);)1764 2322 A
6795 V
(08636)210 1122 A
(rp->p_reg.ss)504 1692 A
2238(=)S
6885 V
(08637)210 1122 A
(rp->p_reg.es)504 1692 A
2238(=)S
6975 V
(08638)210 1122 A
(rp->p_reg.ds)504 1692 A
2238(=)S
(click_to_hclick\(rp->p_memmap[D].mem_phys\);)1764 2322 A
7065 V
(08639)210 1122 A
1524(})S
8418 V
EP
%%Page: 104 104
BP
/slant 0 def
/height 0 def
1485 V
12 B
(104)180 1080 A
11 R
2415(File:)S
2648(kernel/protect.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(08640)210 1122 A
1440(})S
2295 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2385 V
(kernel/klib.s)546 2676 A
2475 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2655 V
(08700)210 1122 A
1440(#)S
2745 V
(08701)210 1122 A
1440(!)S
(Chooses)294 1524 A
(between)294 1860 A
(the)126 2196 A
(8086)168 2364 A
(and)126 2574 A
(386)126 2742 A
(versions)336 2910 A
3288(of)S
(the)126 3414 A
(low)126 3582 A
(level)210 3750 A
(kernel)252 4002 A
(code.)210 4296 A
2835 V
(08702)210 1122 A
2925 V
(08703)210 1122 A
(#include)336 1440 A
(<minix/config.h>)672 1818 A
3015 V
(08704)210 1122 A
(#if)126 1440 A
(_WORD_SIZE)420 1608 A
2070(==)S
2196(2)S
3105 V
(08705)210 1122 A
(#include)336 1440 A
("klib88.s")420 1818 A
3195 V
(08706)210 1122 A
(#else)210 1440 A
3285 V
(08707)210 1122 A
(#include)336 1440 A
("klib386.s")462 1818 A
3375 V
(08708)210 1122 A
(#endif)252 1440 A
3645 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3735 V
(kernel/klib386.s)672 2676 A
3825 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4005 V
(08800)210 1122 A
1440(#)S
4095 V
(08801)210 1122 A
1440(!)S
(sections)336 1524 A
4185 V
(08802)210 1122 A
4275 V
(08803)210 1122 A
(.sect)210 1440 A
(.text;)252 1692 A
(.sect)210 1986 A
(.rom;)210 2238 A
(.sect)210 2490 A
(.data;)252 2742 A
(.sect)210 3036 A
(.bss)168 3288 A
4365 V
(08804)210 1122 A
4455 V
(08805)210 1122 A
(#include)336 1440 A
(<minix/config.h>)672 1818 A
4545 V
(08806)210 1122 A
(#include)336 1440 A
(<minix/const.h>)630 1818 A
4635 V
(08807)210 1122 A
(#include)336 1440 A
("const.h")378 1818 A
4725 V
(08808)210 1122 A
(#include)336 1440 A
("sconst.h")420 1818 A
4815 V
(08809)210 1122 A
(#include)336 1440 A
("protect.h")462 1818 A
4905 V
(08810)210 1122 A
4995 V
(08811)210 1122 A
1440(!)S
(This)168 1524 A
(file)168 1734 A
(contains)336 1944 A
2322(a)S
(number)252 2406 A
2700(of)S
(assembly)336 2826 A
(code)168 3204 A
(utility)294 3414 A
(routines)336 3750 A
(needed)252 4128 A
4422(by)S
(the)126 4548 A
5085 V
(08812)210 1122 A
1440(!)S
(kernel.)294 1524 A
(They)168 1902 A
(are:)168 2112 A
5175 V
(08813)210 1122 A
5265 V
(08814)210 1122 A
(.define)294 1440 A
(_monitor)336 1776 A
2448(!)S
(exit)168 2532 A
(Minix)210 2742 A
(and)126 2994 A
(return)252 3162 A
3456(to)S
(the)126 3582 A
(monitor)294 3750 A
5355 V
(08815)210 1122 A
(.define)294 1440 A
(_int86)252 1776 A
2448(!)S
(let)126 2532 A
(the)126 2700 A
(monitor)294 2868 A
(make)168 3204 A
3414(an)S
(8086)168 3540 A
(interrupt)378 3750 A
(call)168 4170 A
5445 V
(08816)210 1122 A
(.define)294 1440 A
(_cp_mess)336 1776 A
2448(!)S
(copies)252 2532 A
(messages)336 2826 A
(from)168 3204 A
(source)252 3414 A
3708(to)S
(destination)462 3834 A
5535 V
(08817)210 1122 A
(.define)294 1440 A
(_exit)210 1776 A
2448(!)S
(dummy)210 2532 A
(for)126 2784 A
(library)294 2952 A
(routines)336 3288 A
5625 V
(08818)210 1122 A
(.define)294 1440 A
(__exit)252 1776 A
2448(!)S
(dummy)210 2532 A
(for)126 2784 A
(library)294 2952 A
(routines)336 3288 A
5715 V
(08819)210 1122 A
(.define)294 1440 A
(___exit)294 1776 A
2448(!)S
(dummy)210 2532 A
(for)126 2784 A
(library)294 2952 A
(routines)336 3288 A
5805 V
(08820)210 1122 A
(.define)294 1440 A
(___main)294 1776 A
2448(!)S
(dummy)210 2532 A
(for)126 2784 A
(GCC)126 2952 A
5895 V
(08821)210 1122 A
(.define)294 1440 A
(_phys_insw)420 1776 A
2448(!)S
(transfer)336 2532 A
(data)168 2910 A
(from)168 3120 A
(\(disk)210 3330 A
(controller\))462 3582 A
(port)168 4086 A
4296(to)S
(memory)252 4422 A
5985 V
(08822)210 1122 A
(.define)294 1440 A
(_phys_insb)420 1776 A
2448(!)S
(likewise)336 2532 A
(byte)168 2910 A
3120(by)S
(byte)168 3246 A
6075 V
(08823)210 1122 A
(.define)294 1440 A
(_phys_outsw)462 1776 A
2448(!)S
(transfer)336 2532 A
(data)168 2910 A
(from)168 3120 A
(memory)252 3330 A
3624(to)S
(\(disk)210 3750 A
(controller\))462 4002 A
(port)168 4506 A
6165 V
(08824)210 1122 A
(.define)294 1440 A
(_phys_outsb)462 1776 A
2448(!)S
(likewise)336 2532 A
(byte)168 2910 A
3120(by)S
(byte)168 3246 A
6255 V
(08825)210 1122 A
(.define)294 1440 A
(_enable_irq)462 1776 A
2448(!)S
(enable)252 2532 A
2826(an)S
(irq)126 2952 A
3120(at)S
(the)126 3246 A
(8259)168 3414 A
(controller)420 3624 A
6345 V
(08826)210 1122 A
(.define)294 1440 A
(_disable_irq)504 1776 A
2448(!)S
(disable)294 2532 A
2868(an)S
(irq)126 2994 A
6435 V
(08827)210 1122 A
(.define)294 1440 A
(_phys_copy)420 1776 A
2448(!)S
(copy)168 2532 A
(data)168 2742 A
(from)168 2952 A
(anywhere)336 3162 A
3540(to)S
(anywhere)336 3666 A
4044(in)S
(memory)252 4170 A
6525 V
(08828)210 1122 A
(.define)294 1440 A
(_phys_memset)504 1776 A
2448(!)S
(write)210 2532 A
(pattern)294 2784 A
(anywhere)336 3120 A
3498(in)S
(memory)252 3624 A
6615 V
(08829)210 1122 A
(.define)294 1440 A
(_mem_rdw)336 1776 A
2448(!)S
(copy)168 2532 A
(one)126 2742 A
(word)168 2910 A
(from)168 3120 A
([segment:offset])672 3330 A
6705 V
(08830)210 1122 A
(.define)294 1440 A
(_reset)252 1776 A
2448(!)S
(reset)210 2532 A
(the)126 2784 A
(system)252 2952 A
6795 V
(08831)210 1122 A
(.define)294 1440 A
(_idle_task)420 1776 A
2448(!)S
(task)168 2532 A
(executed)336 2742 A
(when)168 3120 A
(there)210 3330 A
3582(is)S
3708(no)S
(work)168 3834 A
6885 V
(08832)210 1122 A
(.define)294 1440 A
(_level0)294 1776 A
2448(!)S
(call)168 2532 A
2742(a)S
(function)336 2826 A
3204(at)S
(level)210 3330 A
3582(0)S
6975 V
(08833)210 1122 A
(.define)294 1440 A
(_read_tsc)378 1776 A
2448(!)S
(read)168 2532 A
(the)126 2742 A
(cycle)210 2910 A
(counter)294 3162 A
(\(Pentium)336 3498 A
(and)126 3876 A
(up\))126 4044 A
7065 V
(08834)210 1122 A
(.define)294 1440 A
(_read_cpu_flags)630 1776 A
2448(!)S
(read)168 2532 A
(the)126 2742 A
(cpu)126 2910 A
(flags)210 3078 A
8418 V
EP
%%Page: 105 105
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2405(File:)S
(kernel/klib386.s)717 2638 A
12 B
(105)180 4500 A
1755 V
7 LST
(08835)210 1122 A
1845 V
(08836)210 1122 A
1440(!)S
(The)126 1524 A
(routines)336 1692 A
(only)168 2070 A
(guarantee)378 2280 A
2700(to)S
(preserve)336 2826 A
(the)126 3204 A
(registers)378 3372 A
(the)126 3792 A
3960(C)S
(compiler)336 4044 A
1935 V
(08837)210 1122 A
1440(!)S
(expects)294 1524 A
1860(to)S
1986(be)S
(preserved)378 2112 A
(\(ebx,)210 2532 A
(esi,)168 2784 A
(edi,)168 2994 A
(ebp,)168 3204 A
(esp,)168 3414 A
(segment)294 3624 A
(registers,)420 3960 A
(and)126 4422 A
2025 V
(08838)210 1122 A
1440(!)S
(direction)378 1524 A
(bit)126 1944 A
2112(in)S
(the)126 2238 A
(flags\).)294 2406 A
2115 V
(08839)210 1122 A
2205 V
(08840)210 1122 A
(.sect)210 1440 A
(.text)210 1692 A
2295 V
(08841)210 1122 A
(!*===========================================================================*)3276 1440 A
2385 V
(08842)210 1122 A
1440(!*)S
(monitor)294 2784 A
4674(*)S
2475 V
(08843)210 1122 A
(!*===========================================================================*)3276 1440 A
2565 V
(08844)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(void)168 1818 A
(monitor\(\);)420 2028 A
2655 V
(08845)210 1122 A
1440(!)S
(Return)252 1524 A
1818(to)S
(the)126 1944 A
(monitor.)336 2112 A
2745 V
(08846)210 1122 A
2835 V
(08847)210 1122 A
(_monitor:)378 1440 A
2925 V
(08848)210 1122 A
(mov)126 1776 A
(esp,)168 2112 A
(\(_mon_sp\))378 2322 A
3120(!)S
(restore)294 3204 A
(monitor)294 3540 A
(stack)210 3876 A
(pointer)294 4128 A
3015 V
(08849)210 1122 A
(o16)126 1608 A
(mov)126 1776 A
(dx,)126 2112 A
(SS_SELECTOR)462 2280 A
3120(!)S
(monitor)294 3204 A
(data)168 3540 A
(segment)294 3750 A
3105 V
(08850)210 1122 A
(mov)126 1776 A
(ds,)126 2112 A
2280(dx)S
3195 V
(08851)210 1122 A
(mov)126 1776 A
(es,)126 2112 A
2280(dx)S
3285 V
(08852)210 1122 A
(mov)126 1776 A
(fs,)126 2112 A
2280(dx)S
3375 V
(08853)210 1122 A
(mov)126 1776 A
(gs,)126 2112 A
2280(dx)S
3465 V
(08854)210 1122 A
(mov)126 1776 A
(ss,)126 2112 A
2280(dx)S
3555 V
(08855)210 1122 A
(pop)126 1776 A
(edi)126 2112 A
3645 V
(08856)210 1122 A
(pop)126 1776 A
(esi)126 2112 A
3735 V
(08857)210 1122 A
(pop)126 1776 A
(ebp)126 2112 A
3825 V
(08858)210 1122 A
(o16)126 1608 A
(retf)168 1776 A
3120(!)S
(return)252 3204 A
3498(to)S
(the)126 3624 A
(monitor)294 3792 A
3915 V
(08859)210 1122 A
4005 V
(08860)210 1122 A
4095 V
(08861)210 1122 A
(!*===========================================================================*)3276 1440 A
4185 V
(08862)210 1122 A
1440(!*)S
(int86)210 2784 A
4674(*)S
4275 V
(08863)210 1122 A
(!*===========================================================================*)3276 1440 A
4365 V
(08864)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(void)168 1818 A
(int86\(\);)336 2028 A
4455 V
(08865)210 1122 A
(_int86:)294 1440 A
4545 V
(08866)210 1122 A
(cmpb)168 1776 A
(\(_mon_return\),)588 2112 A
2742(0)S
3120(!)S
3204(is)S
(the)126 3330 A
(monitor)294 3498 A
(there?)252 3834 A
4635 V
(08867)210 1122 A
(jnz)126 1776 A
2112(0f)S
4725 V
(08868)210 1122 A
(movb)168 1776 A
(ah,)126 2112 A
(0x01)168 2280 A
3120(!)S
3204(an)S
(int)126 3330 A
3498(13)S
(error)210 3624 A
(seems)210 3876 A
(appropriate)462 4128 A
4815 V
(08869)210 1122 A
(movb)168 1776 A
(\(_reg86+)336 2112 A
(0\),)126 2490 A
2658(ah)S
3120(!)S
(reg86.w.f)378 3204 A
3624(=)S
3708(1)S
(\(set)168 3792 A
(carry)210 4002 A
(flag\))210 4254 A
4905 V
(08870)210 1122 A
(movb)168 1776 A
(\(_reg86+13\),)504 2112 A
2658(ah)S
3120(!)S
(reg86.b.ah)420 3204 A
3666(=)S
(0x01)168 3750 A
3960(=)S
("invalid)336 4044 A
(command")336 4422 A
4995 V
(08871)210 1122 A
(ret)126 1776 A
5085 V
(08872)210 1122 A
1440(0:)S
(push)168 1776 A
(ebp)126 2112 A
3120(!)S
(save)168 3204 A
3414(C)S
(registers)378 3498 A
5175 V
(08873)210 1122 A
(push)168 1776 A
(esi)126 2112 A
5265 V
(08874)210 1122 A
(push)168 1776 A
(edi)126 2112 A
5355 V
(08875)210 1122 A
(push)168 1776 A
(ebx)126 2112 A
5445 V
(08876)210 1122 A
(pushf)210 1776 A
3120(!)S
(save)168 3204 A
(flags)210 3414 A
5535 V
(08877)210 1122 A
(cli)126 1776 A
3120(!)S
3204(no)S
(interruptions)546 3330 A
5625 V
(08878)210 1122 A
5715 V
(08879)210 1122 A
(inb)126 1776 A
(INT2_CTLMASK)504 2112 A
5805 V
(08880)210 1122 A
(movb)168 1776 A
(ah,)126 2112 A
2280(al)S
5895 V
(08881)210 1122 A
(inb)126 1776 A
(INT_CTLMASK)462 2112 A
5985 V
(08882)210 1122 A
(push)168 1776 A
(eax)126 2112 A
3120(!)S
(save)168 3204 A
(interrupt)378 3414 A
(masks)210 3834 A
6075 V
(08883)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(\(_irq_use\))420 2322 A
3120(!)S
(map)126 3204 A
3372(of)S
(in-use)252 3498 A
(IRQ's)210 3792 A
6165 V
(08884)210 1122 A
(and)126 1776 A
(eax,)168 2112 A
(\304[1<<CLOCK_IRQ])630 2322 A
3120(!)S
(keep)168 3204 A
(the)126 3414 A
(clock)210 3582 A
(ticking)294 3834 A
6255 V
(08885)210 1122 A
(outb)168 1776 A
(INT_CTLMASK)462 2112 A
3120(!)S
(enable)252 3204 A
(all)126 3498 A
(unused)252 3666 A
(IRQ's)210 3960 A
(and)126 4212 A
(vv.)126 4380 A
6345 V
(08886)210 1122 A
(movb)168 1776 A
(al,)126 2112 A
2280(ah)S
6435 V
(08887)210 1122 A
(outb)168 1776 A
(INT2_CTLMASK)504 2112 A
6525 V
(08888)210 1122 A
6615 V
(08889)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(SS_SELECTOR)462 2322 A
3120(!)S
(monitor)294 3204 A
(data)168 3540 A
(segment)294 3750 A
6705 V
(08890)210 1122 A
(mov)126 1776 A
(ss,)126 2112 A
2280(ax)S
6795 V
(08891)210 1122 A
(xchg)168 1776 A
(esp,)168 2112 A
(\(_mon_sp\))378 2322 A
3120(!)S
(switch)252 3204 A
(stacks)252 3498 A
6885 V
(08892)210 1122 A
(push)168 1776 A
(\(_reg86+36\))462 2112 A
3120(!)S
(parameters)420 3204 A
(used)168 3666 A
3876(in)S
(INT)126 4002 A
(call)168 4170 A
6975 V
(08893)210 1122 A
(push)168 1776 A
(\(_reg86+32\))462 2112 A
7065 V
(08894)210 1122 A
(push)168 1776 A
(\(_reg86+28\))462 2112 A
8418 V
EP
%%Page: 106 106
BP
/slant 0 def
/height 0 def
1485 V
12 B
(106)180 1080 A
11 R
2405(File:)S
(kernel/klib386.s)717 2638 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(08895)210 1122 A
(push)168 1776 A
(\(_reg86+24\))462 2112 A
1845 V
(08896)210 1122 A
(push)168 1776 A
(\(_reg86+20\))462 2112 A
1935 V
(08897)210 1122 A
(push)168 1776 A
(\(_reg86+16\))462 2112 A
2025 V
(08898)210 1122 A
(push)168 1776 A
(\(_reg86+12\))462 2112 A
2115 V
(08899)210 1122 A
(push)168 1776 A
(\(_reg86+)336 2112 A
2490(8\))S
2205 V
(08900)210 1122 A
(push)168 1776 A
(\(_reg86+)336 2112 A
2490(4\))S
2295 V
(08901)210 1122 A
(push)168 1776 A
(\(_reg86+)336 2112 A
2490(0\))S
2385 V
(08902)210 1122 A
(mov)126 1776 A
(ds,)126 2112 A
2280(ax)S
3120(!)S
(remaining)378 3204 A
(data)168 3624 A
(selectors)378 3834 A
2475 V
(08903)210 1122 A
(mov)126 1776 A
(es,)126 2112 A
2280(ax)S
2565 V
(08904)210 1122 A
(mov)126 1776 A
(fs,)126 2112 A
2280(ax)S
2655 V
(08905)210 1122 A
(mov)126 1776 A
(gs,)126 2112 A
2280(ax)S
2745 V
(08906)210 1122 A
(push)168 1776 A
2112(cs)S
2835 V
(08907)210 1122 A
(push)168 1776 A
(return)252 2112 A
3120(!)S
(kernel)252 3204 A
(return)252 3498 A
(address)294 3792 A
(and)126 4128 A
(selector)336 4296 A
2925 V
(08908)210 1122 A
(o16)126 1608 A
(jmpf)168 1776 A
(20+2*4+10*4+2*4\(esp\))840 2112 A
3120(!)S
(make)168 3204 A
(the)126 3414 A
(call)168 3582 A
3015 V
(08909)210 1122 A
(return:)294 1440 A
3105 V
(08910)210 1122 A
(pop)126 1776 A
(\(_reg86+)336 2112 A
2490(0\))S
3195 V
(08911)210 1122 A
(pop)126 1776 A
(\(_reg86+)336 2112 A
2490(4\))S
3285 V
(08912)210 1122 A
(pop)126 1776 A
(\(_reg86+)336 2112 A
2490(8\))S
3375 V
(08913)210 1122 A
(pop)126 1776 A
(\(_reg86+12\))462 2112 A
3465 V
(08914)210 1122 A
(pop)126 1776 A
(\(_reg86+16\))462 2112 A
3555 V
(08915)210 1122 A
(pop)126 1776 A
(\(_reg86+20\))462 2112 A
3645 V
(08916)210 1122 A
(pop)126 1776 A
(\(_reg86+24\))462 2112 A
3735 V
(08917)210 1122 A
(pop)126 1776 A
(\(_reg86+28\))462 2112 A
3825 V
(08918)210 1122 A
(pop)126 1776 A
(\(_reg86+32\))462 2112 A
3915 V
(08919)210 1122 A
(pop)126 1776 A
(\(_reg86+36\))462 2112 A
4005 V
(08920)210 1122 A
(lgdt)168 1776 A
(\(_gdt+GDT_SELECTOR\))798 2112 A
3120(!)S
(reload)252 3204 A
(global)252 3498 A
(descriptor)420 3792 A
(table)210 4254 A
4095 V
(08921)210 1122 A
(jmpf)168 1776 A
(CS_SELECTOR:csinit)756 2112 A
3120(!)S
(restore)294 3204 A
(everything)420 3540 A
4185 V
(08922)210 1122 A
(csinit:)294 1440 A
(mov)126 1776 A
(eax,)168 2112 A
(DS_SELECTOR)462 2322 A
4275 V
(08923)210 1122 A
(mov)126 1776 A
(ds,)126 2112 A
2280(ax)S
4365 V
(08924)210 1122 A
(mov)126 1776 A
(es,)126 2112 A
2280(ax)S
4455 V
(08925)210 1122 A
(mov)126 1776 A
(fs,)126 2112 A
2280(ax)S
4545 V
(08926)210 1122 A
(mov)126 1776 A
(gs,)126 2112 A
2280(ax)S
4635 V
(08927)210 1122 A
(mov)126 1776 A
(ss,)126 2112 A
2280(ax)S
4725 V
(08928)210 1122 A
(xchg)168 1776 A
(esp,)168 2112 A
(\(_mon_sp\))378 2322 A
3120(!)S
(unswitch)336 3204 A
(stacks)252 3582 A
4815 V
(08929)210 1122 A
(lidt)168 1776 A
(\(_gdt+IDT_SELECTOR\))798 2112 A
3120(!)S
(reload)252 3204 A
(interrupt)378 3498 A
(descriptor)420 3918 A
(table)210 4380 A
4905 V
(08930)210 1122 A
(andb)168 1776 A
(\(_gdt+TSS_SELECTOR+DESC_ACCESS\),)1344 2112 A
(\3040x02)210 3498 A
3792(!)S
(clear)210 3876 A
(TSS)126 4128 A
(busy)168 4296 A
(bit)126 4506 A
4995 V
(08931)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(TSS_SELECTOR)504 2322 A
5085 V
(08932)210 1122 A
(ltr)126 1776 A
2112(ax)S
3120(!)S
(set)126 3204 A
(TSS)126 3372 A
(register)336 3540 A
5175 V
(08933)210 1122 A
5265 V
(08934)210 1122 A
(pop)126 1776 A
(eax)126 2112 A
5355 V
(08935)210 1122 A
(outb)168 1776 A
(INT_CTLMASK)462 2112 A
3120(!)S
(restore)294 3204 A
(interrupt)378 3540 A
(masks)210 3960 A
5445 V
(08936)210 1122 A
(movb)168 1776 A
(al,)126 2112 A
2280(ah)S
5535 V
(08937)210 1122 A
(outb)168 1776 A
(INT2_CTLMASK)504 2112 A
5625 V
(08938)210 1122 A
5715 V
(08939)210 1122 A
(add)126 1776 A
(\(_lost_ticks\),)588 2112 A
(ecx)126 2742 A
3120(!)S
(record)252 3204 A
(lost)168 3498 A
(clock)210 3708 A
(ticks)210 3960 A
5805 V
(08940)210 1122 A
5895 V
(08941)210 1122 A
(popf)168 1776 A
3120(!)S
(restore)294 3204 A
(flags)210 3540 A
5985 V
(08942)210 1122 A
(pop)126 1776 A
(ebx)126 2112 A
3120(!)S
(restore)294 3204 A
3540(C)S
(registers)378 3624 A
6075 V
(08943)210 1122 A
(pop)126 1776 A
(edi)126 2112 A
6165 V
(08944)210 1122 A
(pop)126 1776 A
(esi)126 2112 A
6255 V
(08945)210 1122 A
(pop)126 1776 A
(ebp)126 2112 A
6345 V
(08946)210 1122 A
(ret)126 1776 A
6435 V
(08947)210 1122 A
6525 V
(08948)210 1122 A
6615 V
(08949)210 1122 A
(!*===========================================================================*)3276 1440 A
6705 V
(08950)210 1122 A
1440(!*)S
(cp_mess)294 2784 A
4674(*)S
6795 V
(08951)210 1122 A
(!*===========================================================================*)3276 1440 A
6885 V
(08952)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(void)168 1818 A
(cp_mess\(int)462 2028 A
(src,)168 2532 A
(phys_clicks)462 2742 A
(src_clicks,)462 3246 A
(vir_bytes)378 3750 A
(src_offset,)462 4170 A
6975 V
(08953)210 1122 A
1440(!)S
(phys_clicks)462 2364 A
(dst_clicks,)462 2868 A
(vir_bytes)378 3372 A
(dst_offset\);)504 3792 A
7065 V
(08954)210 1122 A
1440(!)S
(This)168 1524 A
(routine)294 1734 A
(makes)210 2070 A
2322(a)S
(fast)168 2406 A
(copy)168 2616 A
2826(of)S
2952(a)S
(message)294 3036 A
(from)168 3372 A
(anywhere)336 3582 A
3960(in)S
(the)126 4086 A
(address)294 4254 A
8418 V
EP
%%Page: 107 107
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2405(File:)S
(kernel/klib386.s)717 2638 A
12 B
(107)180 4500 A
1755 V
7 LST
(08955)210 1122 A
1440(!)S
(space)210 1524 A
1776(to)S
(anywhere)336 1902 A
(else.)210 2280 A
2574(It)S
(also)168 2700 A
(copies)252 2910 A
(the)126 3204 A
(source)252 3372 A
(address)294 3666 A
(provided)336 4002 A
4380(as)S
4506(a)S
1845 V
(08956)210 1122 A
1440(!)S
(parameter)378 1524 A
1944(to)S
(the)126 2070 A
(call)168 2238 A
(into)168 2448 A
(the)126 2658 A
(first)210 2826 A
(word)168 3078 A
3288(of)S
(the)126 3414 A
(destination)462 3582 A
(message.)336 4086 A
1935 V
(08957)210 1122 A
1440(!)S
2025 V
(08958)210 1122 A
1440(!)S
(Note)168 1524 A
(that)168 1734 A
(the)126 1944 A
(message)294 2112 A
(size,)210 2448 A
("Msize")294 2700 A
3036(is)S
3162(in)S
(DWORDS)252 3288 A
(\(not)168 3582 A
(bytes\))252 3792 A
(and)126 4086 A
(must)168 4254 A
4464(be)S
(set)126 4590 A
2115 V
(08959)210 1122 A
1440(!)S
(correctly.)420 1524 A
(Changing)336 2028 A
(the)126 2406 A
(definition)420 2574 A
3036(of)S
(message)294 3162 A
3498(in)S
(the)126 3624 A
(type)168 3792 A
(file)168 4002 A
(and)126 4212 A
(not)126 4380 A
2205 V
(08960)210 1122 A
1440(!)S
(changing)336 1524 A
1902(it)S
(here)168 2028 A
(will)168 2238 A
(lead)168 2448 A
2658(to)S
(total)210 2784 A
(disaster.)378 3036 A
2295 V
(08961)210 1122 A
2385 V
(08962)210 1122 A
(CM_ARGS)294 1440 A
1776(=)S
2112(4)S
2196(+)S
2280(4)S
2364(+)S
2448(4)S
2532(+)S
2616(4)S
2700(+)S
2784(4)S
3120(!)S
3204(4)S
3288(+)S
3372(4)S
3456(+)S
3540(4)S
3624(+)S
3708(4)S
3792(+)S
3876(4)S
2475 V
(08963)210 1122 A
1440(!)S
2112(es)S
2280(ds)S
(edi)126 2406 A
(esi)126 2574 A
(eip)126 2742 A
(proc)168 3120 A
(scl)126 3330 A
(sof)126 3498 A
(dcl)126 3666 A
(dof)126 3834 A
2565 V
(08964)210 1122 A
2655 V
(08965)210 1122 A
(.align)252 1776 A
2112(16)S
2745 V
(08966)210 1122 A
(_cp_mess:)378 1440 A
2835 V
(08967)210 1122 A
(cld)126 1776 A
2925 V
(08968)210 1122 A
(push)168 1776 A
(esi)126 2112 A
3015 V
(08969)210 1122 A
(push)168 1776 A
(edi)126 2112 A
3105 V
(08970)210 1122 A
(push)168 1776 A
2112(ds)S
3195 V
(08971)210 1122 A
(push)168 1776 A
2112(es)S
3285 V
(08972)210 1122 A
3375 V
(08973)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(FLAT_DS_SELECTOR)672 2322 A
3465 V
(08974)210 1122 A
(mov)126 1776 A
(ds,)126 2112 A
2280(ax)S
3555 V
(08975)210 1122 A
(mov)126 1776 A
(es,)126 2112 A
2280(ax)S
3645 V
(08976)210 1122 A
3735 V
(08977)210 1122 A
(mov)126 1776 A
(esi,)168 2112 A
(CM_ARGS+4\(esp\))588 2322 A
3456(!)S
(src)126 3540 A
(clicks)252 3708 A
3825 V
(08978)210 1122 A
(shl)126 1776 A
(esi,)168 2112 A
(CLICK_SHIFT)462 2322 A
3915 V
(08979)210 1122 A
(add)126 1776 A
(esi,)168 2112 A
(CM_ARGS+4+4\(esp\))672 2322 A
3456(!)S
(src)126 3540 A
(offset)252 3708 A
4005 V
(08980)210 1122 A
(mov)126 1776 A
(edi,)168 2112 A
(CM_ARGS+4+4+4\(esp\))756 2322 A
3456(!)S
(dst)126 3540 A
(clicks)252 3708 A
4095 V
(08981)210 1122 A
(shl)126 1776 A
(edi,)168 2112 A
(CLICK_SHIFT)462 2322 A
4185 V
(08982)210 1122 A
(add)126 1776 A
(edi,)168 2112 A
(CM_ARGS+4+4+4+4\(esp\))840 2322 A
3456(!)S
(dst)126 3540 A
(offset)252 3708 A
4275 V
(08983)210 1122 A
4365 V
(08984)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(CM_ARGS\(esp\))504 2322 A
3120(!)S
(process)294 3204 A
(number)252 3540 A
3834(of)S
(sender)252 3960 A
4455 V
(08985)210 1122 A
(stos)168 1776 A
3120(!)S
(copy)168 3204 A
(number)252 3414 A
3708(of)S
(sender)252 3834 A
4128(to)S
(dest)168 4254 A
(message)294 4464 A
4545 V
(08986)210 1122 A
(add)126 1776 A
(esi,)168 2112 A
2322(4)S
3120(!)S
3204(do)S
(not)126 3330 A
(copy)168 3498 A
(first)210 3708 A
(word)168 3960 A
4635 V
(08987)210 1122 A
(mov)126 1776 A
(ecx,)168 2112 A
(Msize)210 2322 A
2574(-)S
2658(1)S
3120(!)S
(remember,)378 3204 A
(first)210 3624 A
(word)168 3876 A
(does)168 4086 A
(not)126 4296 A
(count)210 4464 A
4725 V
(08988)210 1122 A
(rep)126 1776 A
4815 V
(08989)210 1122 A
(movs)168 1776 A
3120(!)S
(copy)168 3204 A
(the)126 3414 A
(message)294 3582 A
4905 V
(08990)210 1122 A
4995 V
(08991)210 1122 A
(pop)126 1776 A
2112(es)S
5085 V
(08992)210 1122 A
(pop)126 1776 A
2112(ds)S
5175 V
(08993)210 1122 A
(pop)126 1776 A
(edi)126 2112 A
5265 V
(08994)210 1122 A
(pop)126 1776 A
(esi)126 2112 A
5355 V
(08995)210 1122 A
(ret)126 1776 A
3120(!)S
(that)168 3204 A
3414(is)S
(all)126 3540 A
(folks!)252 3708 A
5445 V
(08996)210 1122 A
5535 V
(08997)210 1122 A
5625 V
(08998)210 1122 A
(!*===========================================================================*)3276 1440 A
5715 V
(08999)210 1122 A
1440(!*)S
(exit)168 2784 A
4674(*)S
5805 V
(09000)210 1122 A
(!*===========================================================================*)3276 1440 A
5895 V
(09001)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(void)168 1818 A
(exit\(\);)294 2028 A
5985 V
(09002)210 1122 A
1440(!)S
(Some)168 1524 A
(library)294 1734 A
(routines)336 2070 A
(use)126 2448 A
(exit,)210 2616 A
2868(so)S
(provide)294 2994 A
3330(a)S
(dummy)210 3414 A
(version.)336 3666 A
6075 V
(09003)210 1122 A
1440(!)S
(Actual)252 1524 A
(calls)210 1818 A
2070(to)S
(exit)168 2196 A
(cannot)252 2406 A
(occur)210 2700 A
2952(in)S
(the)126 3078 A
(kernel.)294 3246 A
6165 V
(09004)210 1122 A
1440(!)S
(GNU)126 1524 A
1692(CC)S
(likes)210 1818 A
2070(to)S
(call)168 2196 A
(___main)294 2406 A
(from)168 2742 A
(main\(\))252 2952 A
(for)126 3246 A
(nonobvious)420 3414 A
(reasons.)336 3876 A
6255 V
(09005)210 1122 A
6345 V
(09006)210 1122 A
(_exit:)252 1440 A
6435 V
(09007)210 1122 A
(__exit:)294 1440 A
6525 V
(09008)210 1122 A
(___exit:)336 1440 A
6615 V
(09009)210 1122 A
(sti)126 1776 A
6705 V
(09010)210 1122 A
(jmp)126 1776 A
(___exit)294 2112 A
6795 V
(09011)210 1122 A
6885 V
(09012)210 1122 A
(___main:)336 1440 A
6975 V
(09013)210 1122 A
(ret)126 1776 A
7065 V
(09014)210 1122 A
8418 V
EP
%%Page: 108 108
BP
/slant 0 def
/height 0 def
1485 V
12 B
(108)180 1080 A
11 R
2405(File:)S
(kernel/klib386.s)717 2638 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(09015)210 1122 A
1845 V
(09016)210 1122 A
(!*===========================================================================*)3276 1440 A
1935 V
(09017)210 1122 A
1440(!*)S
(phys_insw)378 2784 A
4674(*)S
2025 V
(09018)210 1122 A
(!*===========================================================================*)3276 1440 A
2115 V
(09019)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(void)168 1818 A
(phys_insw\(Port_t)672 2028 A
(port,)210 2742 A
(phys_bytes)420 2994 A
(buf,)168 3456 A
(size_t)252 3666 A
(count\);)294 3960 A
2205 V
(09020)210 1122 A
1440(!)S
(Input)210 1524 A
1776(an)S
(array)210 1902 A
(from)168 2154 A
2364(an)S
(I/O)126 2490 A
(port.)210 2658 A
(Absolute)336 2952 A
(address)294 3330 A
(version)294 3666 A
4002(of)S
(insw\(\).)294 4128 A
2295 V
(09021)210 1122 A
2385 V
(09022)210 1122 A
(_phys_insw:)462 1440 A
2475 V
(09023)210 1122 A
(push)168 1776 A
(ebp)126 2112 A
2565 V
(09024)210 1122 A
(mov)126 1776 A
(ebp,)168 2112 A
(esp)126 2322 A
2655 V
(09025)210 1122 A
(cld)126 1776 A
2745 V
(09026)210 1122 A
(push)168 1776 A
(edi)126 2112 A
2835 V
(09027)210 1122 A
(push)168 1776 A
2112(es)S
2925 V
(09028)210 1122 A
(mov)126 1776 A
(ecx,)168 2112 A
(FLAT_DS_SELECTOR)672 2322 A
3015 V
(09029)210 1122 A
(mov)126 1776 A
(es,)126 2112 A
2280(cx)S
3105 V
(09030)210 1122 A
(mov)126 1776 A
(edx,)168 2112 A
(8\(ebp\))252 2322 A
3120(!)S
(port)168 3204 A
3414(to)S
(read)168 3540 A
(from)168 3750 A
3195 V
(09031)210 1122 A
(mov)126 1776 A
(edi,)168 2112 A
(12\(ebp\))294 2322 A
3120(!)S
(destination)462 3204 A
(addr)168 3708 A
3285 V
(09032)210 1122 A
(mov)126 1776 A
(ecx,)168 2112 A
(16\(ebp\))294 2322 A
3120(!)S
(byte)168 3204 A
(count)210 3414 A
3375 V
(09033)210 1122 A
(shr)126 1776 A
(ecx,)168 2112 A
2322(1)S
3120(!)S
(word)168 3204 A
(count)210 3414 A
3465 V
(09034)210 1122 A
(rep)126 1440 A
(o16)126 1608 A
(ins)126 1776 A
3120(!)S
(input)210 3204 A
(many)168 3456 A
(words)210 3666 A
3555 V
(09035)210 1122 A
(pop)126 1776 A
2112(es)S
3645 V
(09036)210 1122 A
(pop)126 1776 A
(edi)126 2112 A
3735 V
(09037)210 1122 A
(pop)126 1776 A
(ebp)126 2112 A
3825 V
(09038)210 1122 A
(ret)126 1776 A
3915 V
(09039)210 1122 A
4005 V
(09040)210 1122 A
4095 V
(09041)210 1122 A
(!*===========================================================================*)3276 1440 A
4185 V
(09042)210 1122 A
1440(!*)S
(phys_insb)378 2784 A
4674(*)S
4275 V
(09043)210 1122 A
(!*===========================================================================*)3276 1440 A
4365 V
(09044)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(void)168 1818 A
(phys_insb\(Port_t)672 2028 A
(port,)210 2742 A
(phys_bytes)420 2994 A
(buf,)168 3456 A
(size_t)252 3666 A
(count\);)294 3960 A
4455 V
(09045)210 1122 A
1440(!)S
(Input)210 1524 A
1776(an)S
(array)210 1902 A
(from)168 2154 A
2364(an)S
(I/O)126 2490 A
(port.)210 2658 A
(Absolute)336 2952 A
(address)294 3330 A
(version)294 3666 A
4002(of)S
(insb\(\).)294 4128 A
4545 V
(09046)210 1122 A
4635 V
(09047)210 1122 A
(_phys_insb:)462 1440 A
4725 V
(09048)210 1122 A
(push)168 1776 A
(ebp)126 2112 A
4815 V
(09049)210 1122 A
(mov)126 1776 A
(ebp,)168 2112 A
(esp)126 2322 A
4905 V
(09050)210 1122 A
(cld)126 1776 A
4995 V
(09051)210 1122 A
(push)168 1776 A
(edi)126 2112 A
5085 V
(09052)210 1122 A
(push)168 1776 A
2112(es)S
5175 V
(09053)210 1122 A
(mov)126 1776 A
(ecx,)168 2112 A
(FLAT_DS_SELECTOR)672 2322 A
5265 V
(09054)210 1122 A
(mov)126 1776 A
(es,)126 2112 A
2280(cx)S
5355 V
(09055)210 1122 A
(mov)126 1776 A
(edx,)168 2112 A
(8\(ebp\))252 2322 A
3120(!)S
(port)168 3204 A
3414(to)S
(read)168 3540 A
(from)168 3750 A
5445 V
(09056)210 1122 A
(mov)126 1776 A
(edi,)168 2112 A
(12\(ebp\))294 2322 A
3120(!)S
(destination)462 3204 A
(addr)168 3708 A
5535 V
(09057)210 1122 A
(mov)126 1776 A
(ecx,)168 2112 A
(16\(ebp\))294 2322 A
3120(!)S
(byte)168 3204 A
(count)210 3414 A
5625 V
(09058)210 1122 A
1440(!)S
(shr)126 1776 A
(ecx,)168 2112 A
2322(1)S
3120(!)S
(word)168 3204 A
(count)210 3414 A
5715 V
(09059)210 1122 A
(rep)126 1566 A
(insb)168 1776 A
3120(!)S
(input)210 3204 A
(many)168 3456 A
(bytes)210 3666 A
5805 V
(09060)210 1122 A
(pop)126 1776 A
2112(es)S
5895 V
(09061)210 1122 A
(pop)126 1776 A
(edi)126 2112 A
5985 V
(09062)210 1122 A
(pop)126 1776 A
(ebp)126 2112 A
6075 V
(09063)210 1122 A
(ret)126 1776 A
6165 V
(09064)210 1122 A
6255 V
(09065)210 1122 A
6345 V
(09066)210 1122 A
(!*===========================================================================*)3276 1440 A
6435 V
(09067)210 1122 A
1440(!*)S
(phys_outsw)420 2784 A
4674(*)S
6525 V
(09068)210 1122 A
(!*===========================================================================*)3276 1440 A
6615 V
(09069)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(void)168 1818 A
(phys_outsw\(Port_t)714 2028 A
(port,)210 2784 A
(phys_bytes)420 3036 A
(buf,)168 3498 A
(size_t)252 3708 A
(count\);)294 4002 A
6705 V
(09070)210 1122 A
1440(!)S
(Output)252 1524 A
1818(an)S
(array)210 1944 A
2196(to)S
2322(an)S
(I/O)126 2448 A
(port.)210 2616 A
(Absolute)336 2910 A
(address)294 3288 A
(version)294 3624 A
3960(of)S
(outsw\(\).)336 4086 A
6795 V
(09071)210 1122 A
6885 V
(09072)210 1122 A
(.align)252 1776 A
2112(16)S
6975 V
(09073)210 1122 A
(_phys_outsw:)504 1440 A
7065 V
(09074)210 1122 A
(push)168 1776 A
(ebp)126 2112 A
8418 V
EP
%%Page: 109 109
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2405(File:)S
(kernel/klib386.s)717 2638 A
12 B
(109)180 4500 A
1755 V
7 LST
(09075)210 1122 A
(mov)126 1776 A
(ebp,)168 2112 A
(esp)126 2322 A
1845 V
(09076)210 1122 A
(cld)126 1776 A
1935 V
(09077)210 1122 A
(push)168 1776 A
(esi)126 2112 A
2025 V
(09078)210 1122 A
(push)168 1776 A
2112(ds)S
2115 V
(09079)210 1122 A
(mov)126 1776 A
(ecx,)168 2112 A
(FLAT_DS_SELECTOR)672 2322 A
2205 V
(09080)210 1122 A
(mov)126 1776 A
(ds,)126 2112 A
2280(cx)S
2295 V
(09081)210 1122 A
(mov)126 1776 A
(edx,)168 2112 A
(8\(ebp\))252 2322 A
3120(!)S
(port)168 3204 A
3414(to)S
(write)210 3540 A
3792(to)S
2385 V
(09082)210 1122 A
(mov)126 1776 A
(esi,)168 2112 A
(12\(ebp\))294 2322 A
3120(!)S
(source)252 3204 A
(addr)168 3498 A
2475 V
(09083)210 1122 A
(mov)126 1776 A
(ecx,)168 2112 A
(16\(ebp\))294 2322 A
3120(!)S
(byte)168 3204 A
(count)210 3414 A
2565 V
(09084)210 1122 A
(shr)126 1776 A
(ecx,)168 2112 A
2322(1)S
3120(!)S
(word)168 3204 A
(count)210 3414 A
2655 V
(09085)210 1122 A
(rep)126 1440 A
(o16)126 1608 A
(outs)168 1776 A
3120(!)S
(output)252 3204 A
(many)168 3498 A
(words)210 3708 A
2745 V
(09086)210 1122 A
(pop)126 1776 A
2112(ds)S
2835 V
(09087)210 1122 A
(pop)126 1776 A
(esi)126 2112 A
2925 V
(09088)210 1122 A
(pop)126 1776 A
(ebp)126 2112 A
3015 V
(09089)210 1122 A
(ret)126 1776 A
3105 V
(09090)210 1122 A
3195 V
(09091)210 1122 A
3285 V
(09092)210 1122 A
(!*===========================================================================*)3276 1440 A
3375 V
(09093)210 1122 A
1440(!*)S
(phys_outsb)420 2784 A
4674(*)S
3465 V
(09094)210 1122 A
(!*===========================================================================*)3276 1440 A
3555 V
(09095)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(void)168 1818 A
(phys_outsb\(Port_t)714 2028 A
(port,)210 2784 A
(phys_bytes)420 3036 A
(buf,)168 3498 A
(size_t)252 3708 A
(count\);)294 4002 A
3645 V
(09096)210 1122 A
1440(!)S
(Output)252 1524 A
1818(an)S
(array)210 1944 A
2196(to)S
2322(an)S
(I/O)126 2448 A
(port.)210 2616 A
(Absolute)336 2910 A
(address)294 3288 A
(version)294 3624 A
3960(of)S
(outsb\(\).)336 4086 A
3735 V
(09097)210 1122 A
3825 V
(09098)210 1122 A
(.align)252 1776 A
2112(16)S
3915 V
(09099)210 1122 A
(_phys_outsb:)504 1440 A
4005 V
(09100)210 1122 A
(push)168 1776 A
(ebp)126 2112 A
4095 V
(09101)210 1122 A
(mov)126 1776 A
(ebp,)168 2112 A
(esp)126 2322 A
4185 V
(09102)210 1122 A
(cld)126 1776 A
4275 V
(09103)210 1122 A
(push)168 1776 A
(esi)126 2112 A
4365 V
(09104)210 1122 A
(push)168 1776 A
2112(ds)S
4455 V
(09105)210 1122 A
(mov)126 1776 A
(ecx,)168 2112 A
(FLAT_DS_SELECTOR)672 2322 A
4545 V
(09106)210 1122 A
(mov)126 1776 A
(ds,)126 2112 A
2280(cx)S
4635 V
(09107)210 1122 A
(mov)126 1776 A
(edx,)168 2112 A
(8\(ebp\))252 2322 A
3120(!)S
(port)168 3204 A
3414(to)S
(write)210 3540 A
3792(to)S
4725 V
(09108)210 1122 A
(mov)126 1776 A
(esi,)168 2112 A
(12\(ebp\))294 2322 A
3120(!)S
(source)252 3204 A
(addr)168 3498 A
4815 V
(09109)210 1122 A
(mov)126 1776 A
(ecx,)168 2112 A
(16\(ebp\))294 2322 A
3120(!)S
(byte)168 3204 A
(count)210 3414 A
4905 V
(09110)210 1122 A
(rep)126 1566 A
(outsb)210 1776 A
3120(!)S
(output)252 3204 A
(many)168 3498 A
(bytes)210 3708 A
4995 V
(09111)210 1122 A
(pop)126 1776 A
2112(ds)S
5085 V
(09112)210 1122 A
(pop)126 1776 A
(esi)126 2112 A
5175 V
(09113)210 1122 A
(pop)126 1776 A
(ebp)126 2112 A
5265 V
(09114)210 1122 A
(ret)126 1776 A
5355 V
(09115)210 1122 A
5445 V
(09116)210 1122 A
5535 V
(09117)210 1122 A
(!*==========================================================================*)3234 1440 A
5625 V
(09118)210 1122 A
1440(!*)S
(enable_irq)420 2784 A
4632(*)S
5715 V
(09119)210 1122 A
(!*==========================================================================*/)3276 1440 A
5805 V
(09120)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(void)168 1818 A
(enable_irq\(irq_hook_t)882 2028 A
(*hook\))252 2952 A
5895 V
(09121)210 1122 A
1440(!)S
(Enable)252 1524 A
1818(an)S
(interrupt)378 1944 A
(request)294 2364 A
(line)168 2700 A
2910(by)S
(clearing)336 3036 A
3414(an)S
(8259)168 3540 A
(bit.)168 3750 A
5985 V
(09122)210 1122 A
1440(!)S
(Equivalent)420 1524 A
1986(C)S
(code)168 2070 A
(for)126 2280 A
(hook->irq)378 2448 A
2868(<)S
2952(8:)S
6075 V
(09123)210 1122 A
1440(!)S
1608(if)S
(\(\(irq_actids[hook->irq])966 1734 A
2742(&=)S
(\304hook->id\))420 2868 A
3330(==)S
3456(0\))S
6165 V
(09124)210 1122 A
1440(!)S
(outb\(INT_CTLMASK,)714 1776 A
(inb\(INT_CTLMASK\))672 2532 A
3246(&)S
(\304\(1)126 3330 A
3498(<<)S
(irq\)\);)252 3624 A
6255 V
(09125)210 1122 A
6345 V
(09126)210 1122 A
(.align)252 1776 A
2112(16)S
6435 V
(09127)210 1122 A
(_enable_irq:)504 1440 A
6525 V
(09128)210 1122 A
(push)168 1776 A
(ebp)126 2112 A
6615 V
(09129)210 1122 A
(mov)126 1776 A
(ebp,)168 2112 A
(esp)126 2322 A
6705 V
(09130)210 1122 A
(pushf)210 1776 A
6795 V
(09131)210 1122 A
(cli)126 1776 A
6885 V
(09132)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(8\(ebp\))252 2322 A
3120(!)S
(hook)168 3204 A
6975 V
(09133)210 1122 A
(mov)126 1776 A
(ecx,)168 2112 A
(8\(eax\))252 2322 A
3120(!)S
(irq)126 3204 A
7065 V
(09134)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(12\(eax\))294 2322 A
3120(!)S
3204(id)S
(bit)126 3330 A
8418 V
EP
%%Page: 110 110
BP
/slant 0 def
/height 0 def
1485 V
12 B
(110)180 1080 A
11 R
2405(File:)S
(kernel/klib386.s)717 2638 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(09135)210 1122 A
(not)126 1776 A
(eax)126 2112 A
1845 V
(09136)210 1122 A
(and)126 1776 A
(_irq_actids\(ecx*4\),)798 2112 A
(eax)126 2952 A
3120(!)S
(clear)210 3204 A
(this)168 3456 A
3666(id)S
(bit)126 3792 A
1935 V
(09137)210 1122 A
(jnz)126 1776 A
(en_done)294 2112 A
3120(!)S
(still)210 3204 A
(masked)252 3456 A
3750(by)S
(other)210 3876 A
(handlers?)378 4128 A
2025 V
(09138)210 1122 A
(movb)168 1776 A
(ah,)126 2112 A
2280(\3041)S
2115 V
(09139)210 1122 A
(rolb)168 1776 A
(ah,)126 2112 A
2280(cl)S
3120(!)S
3204(ah)S
3330(=)S
(\304\(1)126 3414 A
3582(<<)S
(\(irq)168 3708 A
3918(%)S
(8\)\))126 4002 A
2205 V
(09140)210 1122 A
(mov)126 1776 A
(edx,)168 2112 A
(INT_CTLMASK)462 2322 A
3120(!)S
(enable)252 3204 A
(irq)126 3498 A
3666(<)S
3750(8)S
3834(at)S
(the)126 3960 A
(master)252 4128 A
(8259)168 4422 A
2295 V
(09141)210 1122 A
(cmpb)168 1776 A
(cl,)126 2112 A
2280(8)S
2385 V
(09142)210 1122 A
1776(jb)S
2112(0f)S
2475 V
(09143)210 1122 A
(mov)126 1776 A
(edx,)168 2112 A
(INT2_CTLMASK)504 2322 A
3120(!)S
(enable)252 3204 A
(irq)126 3498 A
3666(>=)S
3792(8)S
3876(at)S
(the)126 4002 A
(slave)210 4170 A
(8259)168 4422 A
2565 V
(09144)210 1122 A
1440(0:)S
(inb)126 1776 A
2112(dx)S
2655 V
(09145)210 1122 A
(andb)168 1776 A
(al,)126 2112 A
2280(ah)S
2745 V
(09146)210 1122 A
(outb)168 1776 A
2112(dx)S
3120(!)S
(clear)210 3204 A
(bit)126 3456 A
3624(at)S
(the)126 3750 A
(8259)168 3918 A
2835 V
(09147)210 1122 A
(en_done:popf)504 1440 A
2925 V
(09148)210 1122 A
(leave)210 1776 A
3015 V
(09149)210 1122 A
(ret)126 1776 A
3105 V
(09150)210 1122 A
3195 V
(09151)210 1122 A
3285 V
(09152)210 1122 A
(!*==========================================================================*)3234 1440 A
3375 V
(09153)210 1122 A
1440(!*)S
(disable_irq)462 2784 A
4632(*)S
3465 V
(09154)210 1122 A
(!*==========================================================================*/)3276 1440 A
3555 V
(09155)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(int)126 1818 A
(disable_irq\(irq_hook_t)924 1986 A
(*hook\))252 2952 A
3645 V
(09156)210 1122 A
1440(!)S
(Disable)294 1524 A
1860(an)S
(interrupt)378 1986 A
(request)294 2406 A
(line)168 2742 A
2952(by)S
(setting)294 3078 A
3414(an)S
(8259)168 3540 A
(bit.)168 3750 A
3735 V
(09157)210 1122 A
1440(!)S
(Equivalent)420 1524 A
1986(C)S
(code)168 2070 A
(for)126 2280 A
(irq)126 2448 A
2616(<)S
2700(8:)S
3825 V
(09158)210 1122 A
1440(!)S
(irq_actids[hook->irq])882 1608 A
2532(|=)S
(hook->id;)378 2658 A
3915 V
(09159)210 1122 A
1440(!)S
(outb\(INT_CTLMASK,)714 1608 A
(inb\(INT_CTLMASK\))672 2364 A
3078(|)S
3162(\(1)S
3288(<<)S
(irq\)\);)252 3414 A
4005 V
(09160)210 1122 A
1440(!)S
(Returns)294 1524 A
(true)168 1860 A
(iff)126 2070 A
(the)126 2238 A
(interrupt)378 2406 A
(was)126 2826 A
(not)126 2994 A
(already)294 3162 A
(disabled.)378 3498 A
4095 V
(09161)210 1122 A
4185 V
(09162)210 1122 A
(.align)252 1776 A
2112(16)S
4275 V
(09163)210 1122 A
(_disable_irq:)546 1440 A
4365 V
(09164)210 1122 A
(push)168 1776 A
(ebp)126 2112 A
4455 V
(09165)210 1122 A
(mov)126 1776 A
(ebp,)168 2112 A
(esp)126 2322 A
4545 V
(09166)210 1122 A
(pushf)210 1776 A
4635 V
(09167)210 1122 A
(cli)126 1776 A
4725 V
(09168)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(8\(ebp\))252 2322 A
3120(!)S
(hook)168 3204 A
4815 V
(09169)210 1122 A
(mov)126 1776 A
(ecx,)168 2112 A
(8\(eax\))252 2322 A
3120(!)S
(irq)126 3204 A
4905 V
(09170)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(12\(eax\))294 2322 A
3120(!)S
3204(id)S
(bit)126 3330 A
4995 V
(09171)210 1122 A
1776(or)S
(_irq_actids\(ecx*4\),)798 2112 A
(eax)126 2952 A
3120(!)S
(set)126 3204 A
(this)168 3372 A
3582(id)S
(bit)126 3708 A
5085 V
(09172)210 1122 A
(movb)168 1776 A
(ah,)126 2112 A
2280(1)S
5175 V
(09173)210 1122 A
(rolb)168 1776 A
(ah,)126 2112 A
2280(cl)S
3120(!)S
3204(ah)S
3330(=)S
3414(\(1)S
3540(<<)S
(\(irq)168 3666 A
3876(%)S
(8\)\))126 3960 A
5265 V
(09174)210 1122 A
(mov)126 1776 A
(edx,)168 2112 A
(INT_CTLMASK)462 2322 A
3120(!)S
(disable)294 3204 A
(irq)126 3540 A
3708(<)S
3792(8)S
3876(at)S
(the)126 4002 A
(master)252 4170 A
(8259)168 4464 A
5355 V
(09175)210 1122 A
(cmpb)168 1776 A
(cl,)126 2112 A
2280(8)S
5445 V
(09176)210 1122 A
1776(jb)S
2112(0f)S
5535 V
(09177)210 1122 A
(mov)126 1776 A
(edx,)168 2112 A
(INT2_CTLMASK)504 2322 A
3120(!)S
(disable)294 3204 A
(irq)126 3540 A
3708(>=)S
3834(8)S
3918(at)S
(the)126 4044 A
(slave)210 4212 A
(8259)168 4464 A
5625 V
(09178)210 1122 A
1440(0:)S
(inb)126 1776 A
2112(dx)S
5715 V
(09179)210 1122 A
(testb)210 1776 A
(al,)126 2112 A
2280(ah)S
5805 V
(09180)210 1122 A
(jnz)126 1776 A
(dis_already)462 2112 A
3120(!)S
(already)294 3204 A
(disabled?)378 3540 A
5895 V
(09181)210 1122 A
(orb)126 1776 A
(al,)126 2112 A
2280(ah)S
5985 V
(09182)210 1122 A
(outb)168 1776 A
2112(dx)S
3120(!)S
(set)126 3204 A
(bit)126 3372 A
3540(at)S
(the)126 3666 A
(8259)168 3834 A
6075 V
(09183)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
2322(1)S
3120(!)S
(disabled)336 3204 A
3582(by)S
(this)168 3708 A
(function)336 3918 A
6165 V
(09184)210 1122 A
(popf)168 1776 A
6255 V
(09185)210 1122 A
(leave)210 1776 A
6345 V
(09186)210 1122 A
(ret)126 1776 A
6435 V
(09187)210 1122 A
(dis_already:)504 1440 A
6525 V
(09188)210 1122 A
(xor)126 1776 A
(eax,)168 2112 A
(eax)126 2322 A
3120(!)S
(already)294 3204 A
(disabled)336 3540 A
6615 V
(09189)210 1122 A
(popf)168 1776 A
6705 V
(09190)210 1122 A
(leave)210 1776 A
6795 V
(09191)210 1122 A
(ret)126 1776 A
6885 V
(09192)210 1122 A
6975 V
(09193)210 1122 A
8418 V
EP
%%Page: 111 111
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2405(File:)S
(kernel/klib386.s)717 2638 A
12 B
(111)180 4500 A
1755 V
7 LST
(09194)210 1122 A
(!*===========================================================================*)3276 1440 A
1845 V
(09195)210 1122 A
1440(!*)S
(phys_copy)378 2784 A
4674(*)S
1935 V
(09196)210 1122 A
(!*===========================================================================*)3276 1440 A
2025 V
(09197)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(void)168 1818 A
(phys_copy\(phys_bytes)840 2028 A
(source,)294 2910 A
(phys_bytes)420 3246 A
(destination,)504 3708 A
2115 V
(09198)210 1122 A
1440(!)S
(phys_bytes)420 2448 A
(bytecount\);)462 2910 A
2205 V
(09199)210 1122 A
1440(!)S
(Copy)168 1524 A
1734(a)S
(block)210 1818 A
2070(of)S
(physical)336 2196 A
(memory.)294 2574 A
2295 V
(09200)210 1122 A
2385 V
(09201)210 1122 A
(PC_ARGS)294 1440 A
1776(=)S
2112(4)S
2196(+)S
2280(4)S
2364(+)S
2448(4)S
2532(+)S
2616(4)S
2784(!)S
2868(4)S
2952(+)S
3036(4)S
3120(+)S
3204(4)S
2475 V
(09202)210 1122 A
1440(!)S
2112(es)S
(edi)126 2238 A
(esi)126 2406 A
(eip)126 2574 A
(src)126 2826 A
(dst)126 2994 A
(len)126 3162 A
2565 V
(09203)210 1122 A
2655 V
(09204)210 1122 A
(.align)252 1776 A
2112(16)S
2745 V
(09205)210 1122 A
(_phys_copy:)462 1440 A
2835 V
(09206)210 1122 A
(cld)126 1776 A
2925 V
(09207)210 1122 A
(push)168 1776 A
(esi)126 2112 A
3015 V
(09208)210 1122 A
(push)168 1776 A
(edi)126 2112 A
3105 V
(09209)210 1122 A
(push)168 1776 A
2112(es)S
3195 V
(09210)210 1122 A
3285 V
(09211)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(FLAT_DS_SELECTOR)672 2322 A
3375 V
(09212)210 1122 A
(mov)126 1776 A
(es,)126 2112 A
2280(ax)S
3465 V
(09213)210 1122 A
3555 V
(09214)210 1122 A
(mov)126 1776 A
(esi,)168 2112 A
(PC_ARGS\(esp\))504 2322 A
3645 V
(09215)210 1122 A
(mov)126 1776 A
(edi,)168 2112 A
(PC_ARGS+4\(esp\))588 2322 A
3735 V
(09216)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(PC_ARGS+4+4\(esp\))672 2322 A
3825 V
(09217)210 1122 A
3915 V
(09218)210 1122 A
(cmp)126 1776 A
(eax,)168 2112 A
2322(10)S
3120(!)S
(avoid)210 3204 A
(align)210 3456 A
(overhead)336 3708 A
(for)126 4086 A
(small)210 4254 A
(counts)252 4506 A
4005 V
(09219)210 1122 A
1776(jb)S
(pc_small)336 2112 A
4095 V
(09220)210 1122 A
(mov)126 1776 A
(ecx,)168 2112 A
(esi)126 2322 A
3120(!)S
(align)210 3204 A
(source,)294 3456 A
(hope)168 3792 A
(target)252 4002 A
4296(is)S
(too)126 4422 A
4185 V
(09221)210 1122 A
(neg)126 1776 A
(ecx)126 2112 A
4275 V
(09222)210 1122 A
(and)126 1776 A
(ecx,)168 2112 A
2322(3)S
3120(!)S
(count)210 3204 A
(for)126 3456 A
(alignment)378 3624 A
4365 V
(09223)210 1122 A
(sub)126 1776 A
(eax,)168 2112 A
(ecx)126 2322 A
4455 V
(09224)210 1122 A
(rep)126 1776 A
4545 V
(09225)210 1122 A
(eseg)168 1566 A
(movsb)210 1776 A
4635 V
(09226)210 1122 A
(mov)126 1776 A
(ecx,)168 2112 A
(eax)126 2322 A
4725 V
(09227)210 1122 A
(shr)126 1776 A
(ecx,)168 2112 A
2322(2)S
3120(!)S
(count)210 3204 A
3456(of)S
(dwords)252 3582 A
4815 V
(09228)210 1122 A
(rep)126 1776 A
4905 V
(09229)210 1122 A
(eseg)168 1566 A
(movs)168 1776 A
4995 V
(09230)210 1122 A
(and)126 1776 A
(eax,)168 2112 A
2322(3)S
5085 V
(09231)210 1122 A
(pc_small:)378 1440 A
5175 V
(09232)210 1122 A
(xchg)168 1776 A
(ecx,)168 2112 A
(eax)126 2322 A
3120(!)S
(remainder)378 3204 A
5265 V
(09233)210 1122 A
(rep)126 1776 A
5355 V
(09234)210 1122 A
(eseg)168 1566 A
(movsb)210 1776 A
5445 V
(09235)210 1122 A
5535 V
(09236)210 1122 A
(pop)126 1776 A
2112(es)S
5625 V
(09237)210 1122 A
(pop)126 1776 A
(edi)126 2112 A
5715 V
(09238)210 1122 A
(pop)126 1776 A
(esi)126 2112 A
5805 V
(09239)210 1122 A
(ret)126 1776 A
5895 V
(09240)210 1122 A
5985 V
(09241)210 1122 A
(!*===========================================================================*)3276 1440 A
6075 V
(09242)210 1122 A
1440(!*)S
(phys_memset)462 2784 A
4674(*)S
6165 V
(09243)210 1122 A
(!*===========================================================================*)3276 1440 A
6255 V
(09244)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(void)168 1818 A
(phys_memset\(phys_bytes)924 2028 A
(source,)294 2994 A
(unsigned)336 3330 A
(long)168 3708 A
(pattern,)336 3918 A
6345 V
(09245)210 1122 A
1440(!)S
(phys_bytes)420 1776 A
(bytecount\);)462 2238 A
6435 V
(09246)210 1122 A
1440(!)S
(Fill)168 1524 A
1734(a)S
(block)210 1818 A
2070(of)S
(physical)336 2196 A
(memory)252 2574 A
(with)168 2868 A
(pattern.)336 3078 A
6525 V
(09247)210 1122 A
6615 V
(09248)210 1122 A
(.align)252 1776 A
2112(16)S
6705 V
(09249)210 1122 A
(_phys_memset:)546 1440 A
6795 V
(09250)210 1122 A
(push)168 1776 A
(ebp)126 2112 A
6885 V
(09251)210 1122 A
(mov)126 1776 A
(ebp,)168 2112 A
(esp)126 2322 A
6975 V
(09252)210 1122 A
(push)168 1776 A
(esi)126 2112 A
7065 V
(09253)210 1122 A
(push)168 1776 A
(ebx)126 2112 A
8418 V
EP
%%Page: 112 112
BP
/slant 0 def
/height 0 def
1485 V
12 B
(112)180 1080 A
11 R
2405(File:)S
(kernel/klib386.s)717 2638 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(09254)210 1122 A
(push)168 1776 A
2112(ds)S
1845 V
(09255)210 1122 A
(mov)126 1776 A
(esi,)168 2112 A
(8\(ebp\))252 2322 A
1935 V
(09256)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(16\(ebp\))294 2322 A
2025 V
(09257)210 1122 A
(mov)126 1776 A
(ebx,)168 2112 A
(FLAT_DS_SELECTOR)672 2322 A
2115 V
(09258)210 1122 A
(mov)126 1776 A
(ds,)126 2112 A
2280(bx)S
2205 V
(09259)210 1122 A
(mov)126 1776 A
(ebx,)168 2112 A
(12\(ebp\))294 2322 A
2295 V
(09260)210 1122 A
(shr)126 1776 A
(eax,)168 2112 A
2322(2)S
2385 V
(09261)210 1122 A
(fill_start:)462 1440 A
2475 V
(09262)210 1122 A
(mov)126 1776 A
(\(esi\),)252 2112 A
(ebx)126 2406 A
2565 V
(09263)210 1122 A
(add)126 1776 A
(esi,)168 2112 A
2322(4)S
2655 V
(09264)210 1122 A
(dec)126 1776 A
(eax)126 2112 A
2745 V
(09265)210 1122 A
(jnz)126 1776 A
(fill_start)420 2112 A
2835 V
(09266)210 1122 A
1776(!)S
(Any)126 1860 A
(remaining)378 2028 A
(bytes?)252 2448 A
2925 V
(09267)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(16\(ebp\))294 2322 A
3015 V
(09268)210 1122 A
(and)126 1776 A
(eax,)168 2112 A
2322(3)S
3105 V
(09269)210 1122 A
(remain_fill:)504 1440 A
3195 V
(09270)210 1122 A
(cmp)126 1776 A
(eax,)168 2112 A
2322(0)S
3285 V
(09271)210 1122 A
1776(jz)S
(fill_done)378 2112 A
3375 V
(09272)210 1122 A
(movb)168 1776 A
(bl,)126 2112 A
(12\(ebp\))294 2280 A
3465 V
(09273)210 1122 A
(movb)168 1776 A
(\(esi\),)252 2112 A
2406(bl)S
3555 V
(09274)210 1122 A
(add)126 1776 A
(esi,)168 2112 A
2322(1)S
3645 V
(09275)210 1122 A
(inc)126 1776 A
(ebp)126 2112 A
3735 V
(09276)210 1122 A
(dec)126 1776 A
(eax)126 2112 A
3825 V
(09277)210 1122 A
(jmp)126 1776 A
(remain_fill)462 2112 A
3915 V
(09278)210 1122 A
(fill_done:)420 1440 A
4005 V
(09279)210 1122 A
(pop)126 1776 A
2112(ds)S
4095 V
(09280)210 1122 A
(pop)126 1776 A
(ebx)126 2112 A
4185 V
(09281)210 1122 A
(pop)126 1776 A
(esi)126 2112 A
4275 V
(09282)210 1122 A
(pop)126 1776 A
(ebp)126 2112 A
4365 V
(09283)210 1122 A
(ret)126 1776 A
4455 V
(09284)210 1122 A
4545 V
(09285)210 1122 A
(!*===========================================================================*)3276 1440 A
4635 V
(09286)210 1122 A
1440(!*)S
(mem_rdw)294 2784 A
4674(*)S
4725 V
(09287)210 1122 A
(!*===========================================================================*)3276 1440 A
4815 V
(09288)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(u16_t)210 1818 A
(mem_rdw\(U16_t)546 2070 A
(segment,)336 2658 A
(u16_t)210 3036 A
(*offset\);)378 3288 A
4905 V
(09289)210 1122 A
1440(!)S
(Load)168 1524 A
(and)126 1734 A
(return)252 1902 A
(word)168 2196 A
2406(at)S
(far)126 2532 A
(pointer)294 2700 A
(segment:offset.)630 3036 A
4995 V
(09290)210 1122 A
5085 V
(09291)210 1122 A
(.align)252 1776 A
2112(16)S
5175 V
(09292)210 1122 A
(_mem_rdw:)378 1440 A
5265 V
(09293)210 1122 A
(mov)126 1776 A
(cx,)126 2112 A
2280(ds)S
5355 V
(09294)210 1122 A
(mov)126 1776 A
(ds,)126 2112 A
(4\(esp\))252 2280 A
3120(!)S
(segment)294 3204 A
5445 V
(09295)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(4+4\(esp\))336 2322 A
3120(!)S
(offset)252 3204 A
5535 V
(09296)210 1122 A
(movzx)210 1776 A
(eax,)168 2112 A
(\(eax\))210 2322 A
3120(!)S
(word)168 3204 A
3414(to)S
(return)252 3540 A
5625 V
(09297)210 1122 A
(mov)126 1776 A
(ds,)126 2112 A
2280(cx)S
5715 V
(09298)210 1122 A
(ret)126 1776 A
5805 V
(09299)210 1122 A
5895 V
(09300)210 1122 A
5985 V
(09301)210 1122 A
(!*===========================================================================*)3276 1440 A
6075 V
(09302)210 1122 A
1440(!*)S
(reset)210 2784 A
4674(*)S
6165 V
(09303)210 1122 A
(!*===========================================================================*)3276 1440 A
6255 V
(09304)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(void)168 1818 A
(reset\(\);)336 2028 A
6345 V
(09305)210 1122 A
1440(!)S
(Reset)210 1524 A
(the)126 1776 A
(system)252 1944 A
2238(by)S
(loading)294 2364 A
(IDT)126 2700 A
(with)168 2868 A
(offset)252 3078 A
3372(0)S
(and)126 3456 A
(interrupting.)546 3624 A
6435 V
(09306)210 1122 A
6525 V
(09307)210 1122 A
(_reset:)294 1440 A
6615 V
(09308)210 1122 A
(lidt)168 1776 A
(\(idt_zero\))420 2112 A
6705 V
(09309)210 1122 A
(int)126 1776 A
2112(3)S
2784(!)S
(anything)336 2868 A
(goes,)210 3246 A
(the)126 3498 A
(386)126 3666 A
(will)168 3834 A
(not)126 4044 A
(like)168 4212 A
4422(it)S
6795 V
(09310)210 1122 A
(.sect)210 1440 A
(.data)210 1692 A
6885 V
(09311)210 1122 A
(idt_zero:)378 1440 A
(.data4)252 2112 A
2448(0,)S
2574(0)S
6975 V
(09312)210 1122 A
(.sect)210 1440 A
(.text)210 1692 A
7065 V
(09313)210 1122 A
8418 V
EP
%%Page: 113 113
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2405(File:)S
(kernel/klib386.s)717 2638 A
12 B
(113)180 4500 A
1755 V
7 LST
(09314)210 1122 A
1845 V
(09315)210 1122 A
(!*===========================================================================*)3276 1440 A
1935 V
(09316)210 1122 A
1440(!*)S
(idle_task)378 2784 A
4674(*)S
2025 V
(09317)210 1122 A
(!*===========================================================================*)3276 1440 A
2115 V
(09318)210 1122 A
(_idle_task:)462 1440 A
2205 V
(09319)210 1122 A
1440(!)S
(This)168 1524 A
(task)168 1734 A
1944(is)S
(called)252 2070 A
(when)168 2364 A
(the)126 2574 A
(system)252 2742 A
(has)126 3036 A
(nothing)294 3204 A
(else)168 3540 A
3750(to)S
(do.)126 3876 A
(The)126 4086 A
(HLT)126 4254 A
2295 V
(09320)210 1122 A
1440(!)S
(instruction)462 1524 A
(puts)168 2028 A
(the)126 2238 A
(processor)378 2406 A
2826(in)S
2952(a)S
(state)210 3036 A
(where)210 3288 A
3540(it)S
(draws)210 3666 A
(minimum)294 3918 A
(power.)252 4254 A
2385 V
(09321)210 1122 A
(push)168 1776 A
(halt)168 2112 A
2475 V
(09322)210 1122 A
(call)168 1776 A
(_level0)294 2112 A
2784(!)S
(level0\(halt\))504 2868 A
2565 V
(09323)210 1122 A
(pop)126 1776 A
(eax)126 2112 A
2655 V
(09324)210 1122 A
(jmp)126 1776 A
(_idle_task)420 2112 A
2745 V
(09325)210 1122 A
(halt:)210 1440 A
2835 V
(09326)210 1122 A
(sti)126 1776 A
2925 V
(09327)210 1122 A
(hlt)126 1776 A
3015 V
(09328)210 1122 A
(cli)126 1776 A
3105 V
(09329)210 1122 A
(ret)126 1776 A
3195 V
(09330)210 1122 A
3285 V
(09331)210 1122 A
(!*===========================================================================*)3276 1440 A
3375 V
(09332)210 1122 A
1440(!*)S
(level0)252 2700 A
4674(*)S
3465 V
(09333)210 1122 A
(!*===========================================================================*)3276 1440 A
3555 V
(09334)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(void)168 1818 A
(level0\(void)462 2028 A
(\(*func\)\(void\)\))588 2532 A
3645 V
(09335)210 1122 A
1440(!)S
(Call)168 1524 A
1734(a)S
(function)336 1818 A
2196(at)S
(permission)420 2322 A
(level)210 2784 A
3036(0.)S
(This)168 3204 A
(allows)252 3414 A
(kernel)252 3708 A
(tasks)210 4002 A
4254(to)S
4380(do)S
3735 V
(09336)210 1122 A
1440(!)S
(things)252 1524 A
(that)168 1818 A
(are)126 2028 A
(only)168 2196 A
(possible)336 2406 A
2784(at)S
(the)126 2910 A
(most)168 3078 A
(privileged)420 3288 A
(CPU)126 3750 A
(level.)252 3918 A
3825 V
(09337)210 1122 A
1440(!)S
3915 V
(09338)210 1122 A
(_level0:)336 1440 A
4005 V
(09339)210 1122 A
(mov)126 1776 A
(eax,)168 2112 A
(4\(esp\))252 2322 A
4095 V
(09340)210 1122 A
(mov)126 1776 A
(\(_level0_func\),)630 2112 A
(eax)126 2784 A
4185 V
(09341)210 1122 A
(int)126 1776 A
(LEVEL0_VECTOR)546 2112 A
4275 V
(09342)210 1122 A
(ret)126 1776 A
4365 V
(09343)210 1122 A
4455 V
(09344)210 1122 A
4545 V
(09345)210 1122 A
(!*===========================================================================*)3276 1440 A
4635 V
(09346)210 1122 A
1440(!*)S
(read_tsc)336 2700 A
4674(*)S
4725 V
(09347)210 1122 A
(!*===========================================================================*)3276 1440 A
4815 V
(09348)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(void)168 1818 A
(read_tsc\(unsigned)714 2028 A
(long)168 2784 A
(*high,)252 2994 A
(unsigned)336 3288 A
(long)168 3666 A
(*low\);)252 3876 A
4905 V
(09349)210 1122 A
1440(!)S
(Read)168 1524 A
(the)126 1734 A
(cycle)210 1902 A
(counter)294 2154 A
2490(of)S
(the)126 2616 A
(CPU.)168 2784 A
(Pentium)294 2994 A
(and)126 3330 A
(up.)126 3498 A
4995 V
(09350)210 1122 A
(.align)252 1440 A
1734(16)S
5085 V
(09351)210 1122 A
(_read_tsc:)420 1440 A
5175 V
(09352)210 1122 A
(.data1)252 1440 A
(0x0f)168 1734 A
2448(!)S
(this)168 2532 A
2742(is)S
(the)126 2868 A
(RDTSC)210 3036 A
(instruction)462 3288 A
5265 V
(09353)210 1122 A
(.data1)252 1440 A
(0x31)168 1734 A
2448(!)S
2532(it)S
(places)252 2658 A
(the)126 2952 A
(TSC)126 3120 A
3288(in)S
(EDX:EAX)294 3414 A
5355 V
(09354)210 1122 A
(push)168 1776 A
(ebp)126 1986 A
5445 V
(09355)210 1122 A
(mov)126 1776 A
(ebp,)168 1944 A
(8\(esp\))252 2154 A
5535 V
(09356)210 1122 A
(mov)126 1776 A
(\(ebp\),)252 1944 A
(edx)126 2238 A
5625 V
(09357)210 1122 A
(mov)126 1776 A
(ebp,)168 1944 A
(12\(esp\))294 2154 A
5715 V
(09358)210 1122 A
(mov)126 1776 A
(\(ebp\),)252 1944 A
(eax)126 2238 A
5805 V
(09359)210 1122 A
(pop)126 1776 A
(ebp)126 1944 A
5895 V
(09360)210 1122 A
(ret)126 1776 A
5985 V
(09361)210 1122 A
6075 V
(09362)210 1122 A
(!*===========================================================================*)3276 1440 A
6165 V
(09363)210 1122 A
1440(!*)S
(read_flags)420 2700 A
5010(*)S
6255 V
(09364)210 1122 A
(!*===========================================================================*)3276 1440 A
6345 V
(09365)210 1122 A
1440(!)S
(PUBLIC)252 1524 A
(unsigned)336 1818 A
(long)168 2196 A
(read_cpu_flags\(void\);)882 2406 A
6435 V
(09366)210 1122 A
1440(!)S
(Read)168 1524 A
(CPU)126 1734 A
(status)252 1902 A
(flags)210 2196 A
(from)168 2448 A
2658(C.)S
6525 V
(09367)210 1122 A
(.align)252 1440 A
1734(16)S
6615 V
(09368)210 1122 A
(_read_cpu_flags:)672 1440 A
6705 V
(09369)210 1122 A
(pushf)210 1776 A
6795 V
(09370)210 1122 A
(mov)126 1776 A
(eax,)168 1944 A
(\(esp\))210 2154 A
6885 V
(09371)210 1122 A
(popf)168 1776 A
6975 V
(09372)210 1122 A
(ret)126 1776 A
7065 V
(09373)210 1122 A
8418 V
EP
%%Page: 114 114
BP
/slant 0 def
/height 0 def
1485 V
12 B
(114)180 1080 A
11 R
2437(File:)S
(kernel/utility.c)652 2670 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(kernel/utility.c)672 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(09400)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
2364(a)S
(collection)420 2448 A
2910(of)S
(miscellaneous)546 3036 A
(procedures:)462 3624 A
2295 V
(09401)210 1122 A
1482(*)S
(panic:)252 1650 A
(abort)210 2280 A
(MINIX)210 2532 A
(due)126 2784 A
2952(to)S
3078(a)S
(fatal)210 3162 A
(error)210 3414 A
2385 V
(09402)210 1122 A
1482(*)S
(kprintf:)336 1650 A
(diagnostic)420 2280 A
(output)252 2742 A
(for)126 3036 A
(the)126 3204 A
(kernel)252 3372 A
2475 V
(09403)210 1122 A
1482(*)S
2565 V
(09404)210 1122 A
1482(*)S
(Changes:)336 1566 A
2655 V
(09405)210 1122 A
1482(*)S
(Dec)126 1650 A
(10,)126 1818 A
(2004)168 1986 A
(kernel)252 2280 A
(printing)336 2574 A
2952(to)S
(circular)336 3078 A
(buffer)252 3456 A
(\(Jorrit)294 3792 A
4128(N.)S
(Herder\))294 4254 A
2745 V
(09406)210 1122 A
1482(*)S
2835 V
(09407)210 1122 A
1482(*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(routines)336 2532 A
(that)168 2910 A
(take)168 3120 A
(care)168 3330 A
3540(of)S
(kernel)252 3666 A
(messages,)378 3960 A
(i.e.,)210 4380 A
2925 V
(09408)210 1122 A
1482(*)S
(diagnostic)420 1566 A
(output)252 2028 A
(within)252 2322 A
(the)126 2616 A
(kernel.)294 2784 A
(Kernel)252 3120 A
(messages)336 3414 A
(are)126 3792 A
(not)126 3960 A
(directly)336 4128 A
3015 V
(09409)210 1122 A
1482(*)S
(displayed)378 1566 A
1986(on)S
(the)126 2112 A
(console,)336 2280 A
(because)294 2658 A
(this)168 2994 A
(must)168 3204 A
3414(be)S
(done)168 3540 A
3750(by)S
(the)126 3876 A
(output)252 4044 A
(driver.)294 4338 A
3105 V
(09410)210 1122 A
1482(*)S
(Instead,)336 1566 A
(the)126 1944 A
(kernel)252 2112 A
(accumulates)462 2406 A
(characters)420 2910 A
3372(in)S
3498(a)S
(buffer)252 3582 A
(and)126 3876 A
(notifies)336 4044 A
(the)126 4422 A
3195 V
(09411)210 1122 A
1482(*)S
(output)252 1566 A
(driver)252 1860 A
(when)168 2154 A
2364(a)S
(new)126 2448 A
(message)294 2616 A
2952(is)S
(ready.)252 3078 A
3285 V
(09412)210 1122 A
1482(*/)S
3375 V
(09413)210 1122 A
3465 V
(09414)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
3555 V
(09415)210 1122 A
(#include)336 1440 A
("kernel.h")420 1818 A
3645 V
(09416)210 1122 A
(#include)336 1440 A
(<stdarg.h>)420 1818 A
3735 V
(09417)210 1122 A
(#include)336 1440 A
(<unistd.h>)420 1818 A
3825 V
(09418)210 1122 A
(#include)336 1440 A
(<stddef.h>)420 1818 A
3915 V
(09419)210 1122 A
(#include)336 1440 A
(<stdlib.h>)420 1818 A
4005 V
(09420)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
4095 V
(09421)210 1122 A
(#include)336 1440 A
("proc.h")336 1818 A
4185 V
(09422)210 1122 A
4275 V
(09423)210 1122 A
(#define)294 1440 A
(END_OF_KMESS)504 1776 A
2448(-1)S
4365 V
(09424)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\(void)630 1776 A
(kputc,)252 2448 A
(\(int)168 2742 A
(c\)\);)168 2952 A
4455 V
(09425)210 1122 A
4545 V
(09426)210 1122 A
(/*===========================================================================*)3276 1440 A
4635 V
(09427)210 1122 A
1482(*)S
(panic)210 2784 A
4674(*)S
4725 V
(09428)210 1122 A
(*===========================================================================*/)3276 1482 A
4815 V
(09429)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(panic\(mess,nr\))588 1944 A
4905 V
(09430)210 1122 A
(_CONST)252 1440 A
(char)168 1734 A
(*mess;)252 1944 A
4995 V
(09431)210 1122 A
(int)126 1440 A
(nr;)126 1608 A
5085 V
(09432)210 1122 A
1440({)S
5175 V
(09433)210 1122 A
1440(/*)S
(The)126 1566 A
(system)252 1734 A
(has)126 2028 A
(run)126 2196 A
(aground)294 2364 A
2700(of)S
2826(a)S
(fatal)210 2910 A
(kernel)252 3162 A
(error.)252 3456 A
(Terminate)378 3750 A
(execution.)420 4170 A
4632(*/)S
5265 V
(09434)210 1122 A
(static)252 1524 A
(int)126 1818 A
(panicking)378 1986 A
2406(=)S
2490(0;)S
5355 V
(09435)210 1122 A
1524(if)S
(\(panicking)420 1650 A
(++\))126 2112 A
(return;)294 2280 A
3120(/*)S
(prevent)294 3246 A
(recursive)378 3582 A
(panics)252 4002 A
4296(*/)S
5445 V
(09436)210 1122 A
5535 V
(09437)210 1122 A
1524(if)S
(\(mess)210 1650 A
1902(!=)S
(NULL\))210 2028 A
2280({)S
5625 V
(09438)210 1122 A
(kprintf\("\\nKernel)714 1776 A
(panic:)252 2532 A
(%s",)168 2826 A
(mess\);)252 3036 A
5715 V
(09439)210 1122 A
1776(if)S
(\(nr)126 1902 A
2070(!=)S
(NO_NUM\))294 2196 A
(kprintf\(")378 2532 A
(%d",)168 2952 A
(nr\);)168 3162 A
5805 V
(09440)210 1122 A
(kprintf\("\\n",NO_NUM\);)882 1776 A
5895 V
(09441)210 1122 A
1524(})S
5985 V
(09442)210 1122 A
6075 V
(09443)210 1122 A
1524(/*)S
(Abort)210 1650 A
(MINIX.)252 1902 A
2196(*/)S
6165 V
(09444)210 1122 A
(prepare_shutdown\(RBT_PANIC\);)1176 1524 A
6255 V
(09445)210 1122 A
1440(})S
6435 V
(09447)210 1122 A
(/*===========================================================================*)3276 1440 A
6525 V
(09448)210 1122 A
1482(*)S
(kprintf)294 2784 A
4674(*)S
6615 V
(09449)210 1122 A
(*===========================================================================*/)3276 1482 A
6705 V
(09450)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(kprintf\(const)546 1944 A
(char)168 2532 A
(*fmt,)210 2742 A
(...\))168 2994 A
3456(/*)S
(format)252 3582 A
3876(to)S
4002(be)S
(printed)294 4128 A
4464(*/)S
6795 V
(09451)210 1122 A
1440({)S
6885 V
(09452)210 1122 A
(int)126 1524 A
1692(c;)S
3456(/*)S
(next)168 3582 A
(character)378 3792 A
4212(in)S
(fmt)126 4338 A
4506(*/)S
6975 V
(09453)210 1122 A
(int)126 1524 A
1692(d;)S
7065 V
(09454)210 1122 A
(unsigned)336 1524 A
(long)168 1902 A
2112(u;)S
3456(/*)S
(hold)168 3582 A
(number)252 3792 A
(argument)336 4086 A
4464(*/)S
8418 V
EP
%%Page: 115 115
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2437(File:)S
(kernel/utility.c)652 2670 A
12 B
(115)180 4500 A
1755 V
7 LST
(09455)210 1122 A
(int)126 1524 A
(base;)210 1692 A
3456(/*)S
(base)168 3582 A
3792(of)S
(number)252 3918 A
(arg)126 4212 A
4380(*/)S
1845 V
(09456)210 1122 A
(int)126 1524 A
(negative)336 1692 A
2070(=)S
2154(0;)S
3456(/*)S
(print)210 3582 A
(minus)210 3834 A
(sign)168 4086 A
4296(*/)S
1935 V
(09457)210 1122 A
(static)252 1524 A
(char)168 1818 A
(x2c[])210 2028 A
2280(=)S
("0123456789ABCDEF";)798 2364 A
3456(/*)S
3582(nr)S
(conversion)420 3708 A
(table)210 4170 A
4422(*/)S
2025 V
(09458)210 1122 A
(char)168 1524 A
(ascii[8)294 1734 A
2070(*)S
(sizeof\(long\))504 2154 A
2700(/)S
2784(3)S
2868(+)S
(2];)126 2952 A
3456(/*)S
(string)252 3582 A
(for)126 3876 A
(ascii)210 4044 A
(number)252 4296 A
4590(*/)S
2115 V
(09459)210 1122 A
(char)168 1524 A
1734(*s)S
1860(=)S
(NULL;)210 1944 A
3456(/*)S
(string)252 3582 A
3876(to)S
4002(be)S
(printed)294 4128 A
4464(*/)S
2205 V
(09460)210 1122 A
(va_list)294 1524 A
(argp;)210 1860 A
3456(/*)S
(optional)336 3582 A
(arguments)378 3960 A
4380(*/)S
2295 V
(09461)210 1122 A
2385 V
(09462)210 1122 A
(va_start\(argp,)588 1524 A
(fmt\);)210 2154 A
3456(/*)S
(init)168 3582 A
(variable)336 3792 A
(arguments)378 4170 A
4590(*/)S
2475 V
(09463)210 1122 A
2565 V
(09464)210 1122 A
(while\(\(c=*fmt++\))672 1524 A
2238(!=)S
2364(0\))S
2490({)S
2655 V
(09465)210 1122 A
2745 V
(09466)210 1122 A
1692(if)S
1818(\(c)S
1944(==)S
('%'\))168 2070 A
2280({)S
3456(/*)S
(expect)252 3582 A
(format)252 3876 A
('%key')252 4170 A
4464(*/)S
2835 V
(09467)210 1122 A
(switch\(c)336 1860 A
2238(=)S
(*fmt++\))294 2322 A
2658({)S
3456(/*)S
(determine)378 3582 A
(what)168 4002 A
4212(to)S
4338(do)S
4464(*/)S
2925 V
(09468)210 1122 A
3015 V
(09469)210 1122 A
1860(/*)S
(Known)210 1986 A
(keys)168 2238 A
(are)126 2448 A
(%d,)126 2616 A
(%u,)126 2784 A
(%x,)126 2952 A
(%s,)126 3120 A
(and)126 3288 A
(%%.)126 3456 A
(This)168 3624 A
3834(is)S
(easily)252 3960 A
(extended)336 4254 A
3105 V
(09470)210 1122 A
1902(*)S
(with)168 1986 A
(number)252 2196 A
(types)210 2490 A
(like)168 2742 A
2952(%b)S
(and)126 3078 A
3246(%o)S
3372(by)S
(providing)378 3498 A
3918(a)S
(different)378 4002 A
(base.)210 4422 A
3195 V
(09471)210 1122 A
1902(*)S
(Number)252 1986 A
(type)168 2280 A
(keys)168 2490 A
(don't)210 2700 A
(set)126 2952 A
3120(a)S
(string)252 3204 A
3498(to)S
('s',)168 3624 A
(but)126 3834 A
(use)126 4002 A
(the)126 4170 A
(general)294 4338 A
3285 V
(09472)210 1122 A
1902(*)S
(conversion)420 1986 A
(after)210 2448 A
(the)126 2700 A
(switch)252 2868 A
(statement.)420 3162 A
3375 V
(09473)210 1122 A
1902(*/)S
3465 V
(09474)210 1122 A
(case)168 1860 A
('d':)168 2070 A
3456(/*)S
(output)252 3582 A
(decimal)294 3876 A
4212(*/)S
3555 V
(09475)210 1122 A
2028(d)S
2112(=)S
(va_arg\(argp,)504 2196 A
(signed)252 2742 A
(int\);)210 3036 A
3645 V
(09476)210 1122 A
2028(if)S
2154(\(d)S
2280(<)S
2364(0\))S
2490({)S
(negative)336 2574 A
2952(=)S
3036(1;)S
3162(u)S
3246(=)S
(-d;)126 3330 A
3498(})S
(else)168 3624 A
3834({)S
3918(u)S
4002(=)S
4086(d;)S
4212(})S
3735 V
(09477)210 1122 A
(base)168 2028 A
2238(=)S
(10;)126 2322 A
3825 V
(09478)210 1122 A
(break;)252 2028 A
3915 V
(09479)210 1122 A
(case)168 1860 A
('u':)168 2070 A
3456(/*)S
(output)252 3582 A
(unsigned)336 3876 A
(long)168 4254 A
4464(*/)S
4005 V
(09480)210 1122 A
2028(u)S
2112(=)S
(va_arg\(argp,)504 2196 A
(unsigned)336 2742 A
(long\);)252 3120 A
4095 V
(09481)210 1122 A
(base)168 2028 A
2238(=)S
(10;)126 2322 A
4185 V
(09482)210 1122 A
(break;)252 2028 A
4275 V
(09483)210 1122 A
(case)168 1860 A
('x':)168 2070 A
3456(/*)S
(output)252 3582 A
(hexadecimal)462 3876 A
4380(*/)S
4365 V
(09484)210 1122 A
2028(u)S
2112(=)S
(va_arg\(argp,)504 2196 A
(unsigned)336 2742 A
(long\);)252 3120 A
4455 V
(09485)210 1122 A
(base)168 2028 A
2238(=)S
(0x10;)210 2322 A
4545 V
(09486)210 1122 A
(break;)252 2028 A
4635 V
(09487)210 1122 A
(case)168 1860 A
('s':)168 2070 A
3456(/*)S
(output)252 3582 A
(string)252 3876 A
4170(*/)S
4725 V
(09488)210 1122 A
2028(s)S
2112(=)S
(va_arg\(argp,)504 2196 A
(char)168 2742 A
(*\);)126 2952 A
4815 V
(09489)210 1122 A
2028(if)S
2154(\(s)S
2280(==)S
(NULL\))210 2406 A
2658(s)S
2742(=)S
("\(null\)";)378 2826 A
4905 V
(09490)210 1122 A
(break;)252 2028 A
4995 V
(09491)210 1122 A
(case)168 1860 A
('%':)168 2070 A
3456(/*)S
(output)252 3582 A
(percent)294 3876 A
4212(*/)S
5085 V
(09492)210 1122 A
2028(s)S
2112(=)S
("%";)168 2196 A
5175 V
(09493)210 1122 A
(break;)252 2028 A
5265 V
(09494)210 1122 A
5355 V
(09495)210 1122 A
1860(/*)S
(Unrecognized)504 1986 A
(key.)168 2532 A
2742(*/)S
5445 V
(09496)210 1122 A
(default:)336 1860 A
3456(/*)S
(echo)168 3582 A
(back)168 3792 A
(%key)168 4002 A
4212(*/)S
5535 V
(09497)210 1122 A
2028(s)S
2112(=)S
("%?";)210 2196 A
5625 V
(09498)210 1122 A
(s[1])168 2028 A
2238(=)S
2322(c;)S
3456(/*)S
(set)126 3582 A
(unknown)294 3750 A
(key)126 4086 A
4254(*/)S
5715 V
(09499)210 1122 A
1860(})S
5805 V
(09500)210 1122 A
5895 V
(09501)210 1122 A
1860(/*)S
(Assume)252 1986 A
2280(a)S
(number)252 2364 A
2658(if)S
2784(no)S
(string)252 2910 A
3204(is)S
(set.)168 3330 A
(Convert)294 3540 A
3876(to)S
(ascii.)252 4002 A
4296(*/)S
5985 V
(09502)210 1122 A
1860(if)S
1986(\(s)S
2112(==)S
(NULL\))210 2238 A
2490({)S
6075 V
(09503)210 1122 A
2028(s)S
2112(=)S
(ascii)210 2196 A
2448(+)S
(sizeof\(ascii\)-1;)672 2532 A
6165 V
(09504)210 1122 A
2028(*s)S
2154(=)S
2238(0;)S
6255 V
(09505)210 1122 A
2028(do)S
2154({)S
(*--s)168 2280 A
2490(=)S
(x2c[\(u)252 2574 A
2868(%)S
(base\)];)294 2952 A
3288(})S
3456(/*)S
(work)168 3582 A
(backwards)378 3792 A
4212(*/)S
6345 V
(09506)210 1122 A
(while)210 2028 A
(\(\(u)126 2280 A
2448(/=)S
(base\))210 2574 A
2826(>)S
(0\);)126 2910 A
6435 V
(09507)210 1122 A
1860(})S
6525 V
(09508)210 1122 A
6615 V
(09509)210 1122 A
1860(/*)S
(This)168 1986 A
2196(is)S
(where)210 2322 A
(the)126 2574 A
(actual)252 2742 A
(output)252 3036 A
(for)126 3330 A
(format)252 3498 A
("%key")252 3792 A
4086(is)S
(done.)210 4212 A
4464(*/)S
6705 V
(09510)210 1122 A
1860(if)S
(\(negative\))420 1986 A
(kputc\('-'\);)462 2448 A
3456(/*)S
(print)210 3582 A
(sign)168 3834 A
4044(if)S
(negative)336 4170 A
4548(*/)S
6795 V
(09511)210 1122 A
(while\(*s)336 1860 A
2238(!=)S
2364(0\))S
2490({)S
(kputc\(*s++\);)504 2574 A
3120(})S
3456(/*)S
(print)210 3582 A
(string/)294 3834 A
(number)252 4170 A
4464(*/)S
6885 V
(09512)210 1122 A
1860(s)S
1944(=)S
(NULL;)210 2028 A
3456(/*)S
(reset)210 3582 A
(for)126 3834 A
(next)168 4002 A
(round)210 4212 A
4464(*/)S
6975 V
(09513)210 1122 A
1692(})S
7065 V
(09514)210 1122 A
(else)168 1692 A
1902({)S
8418 V
EP
%%Page: 116 116
BP
/slant 0 def
/height 0 def
1485 V
12 B
(116)180 1080 A
11 R
2437(File:)S
(kernel/utility.c)652 2670 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(09515)210 1122 A
(kputc\(c\);)378 1860 A
3456(/*)S
(print)210 3582 A
(and)126 3834 A
(continue)336 4002 A
4380(*/)S
1845 V
(09516)210 1122 A
1692(})S
1935 V
(09517)210 1122 A
1524(})S
2025 V
(09518)210 1122 A
(kputc\(END_OF_KMESS\);)840 1524 A
3456(/*)S
(terminate)378 3582 A
(output)252 4002 A
4296(*/)S
2115 V
(09519)210 1122 A
(va_end\(argp\);)546 1524 A
3456(/*)S
(end)126 3582 A
(variable)336 3750 A
(arguments)378 4128 A
4548(*/)S
2205 V
(09520)210 1122 A
1440(})S
2385 V
(09522)210 1122 A
(/*===========================================================================*)3276 1440 A
2475 V
(09523)210 1122 A
1482(*)S
(kputc)210 2784 A
4674(*)S
2565 V
(09524)210 1122 A
(*===========================================================================*/)3276 1482 A
2655 V
(09525)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(kputc\(c\))336 1986 A
2745 V
(09526)210 1122 A
(int)126 1440 A
1608(c;)S
3120(/*)S
(character)378 3246 A
3666(to)S
(append)252 3792 A
4086(*/)S
2835 V
(09527)210 1122 A
1440({)S
2925 V
(09528)210 1122 A
1440(/*)S
(Accumulate)420 1566 A
2028(a)S
(single)252 2112 A
(character)378 2406 A
(for)126 2826 A
2994(a)S
(kernel)252 3078 A
(message.)336 3372 A
(Send)168 3750 A
3960(a)S
(notification)504 4044 A
3015 V
(09529)210 1122 A
1482(*)S
1566(to)S
(the)126 1692 A
(output)252 1860 A
(driver)252 2154 A
2448(if)S
2574(an)S
(END_OF_KMESS)504 2700 A
3246(is)S
(encountered.)504 3372 A
3105 V
(09530)210 1122 A
1482(*/)S
3195 V
(09531)210 1122 A
1524(if)S
1650(\(c)S
1776(!=)S
(END_OF_KMESS\))546 1902 A
2490({)S
3285 V
(09532)210 1122 A
(kmess.km_buf[kmess.km_next])1134 1692 A
2868(=)S
2952(c;)S
3120(/*)S
(put)126 3246 A
(normal)252 3414 A
(char)168 3708 A
3918(in)S
(buffer)252 4044 A
4338(*/)S
3375 V
(09533)210 1122 A
1692(if)S
(\(kmess.km_size)588 1818 A
2448(<)S
(KMESS_BUF_SIZE\))630 2532 A
3465 V
(09534)210 1122 A
(kmess.km_size)546 1860 A
2448(+=)S
2574(1;)S
3555 V
(09535)210 1122 A
(kmess.km_next)546 1692 A
2280(=)S
(\(kmess.km_next)588 2364 A
2994(+)S
3078(1\))S
3204(%)S
(KMESS_BUF_SIZE;)630 3288 A
3645 V
(09536)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3735 V
(09537)210 1122 A
(send_sig\(OUTPUT_PROC_NR,)1008 1692 A
(SIGKMESS\);)420 2742 A
3825 V
(09538)210 1122 A
1524(})S
3915 V
(09539)210 1122 A
1440(})S
4545 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4635 V
(kernel/system.h)630 2676 A
4725 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4905 V
(09600)210 1122 A
1440(/*)S
(Function)336 1566 A
(prototypes)420 1944 A
(for)126 2406 A
(the)126 2574 A
(system)252 2742 A
(library.)336 3036 A
4995 V
(09601)210 1122 A
1482(*)S
(The)126 1566 A
(implementation)588 1734 A
2364(is)S
(contained)378 2490 A
2910(in)S
(src/kernel/system/.)798 3036 A
5085 V
(09602)210 1122 A
1482(*)S
5175 V
(09603)210 1122 A
1482(*)S
(The)126 1566 A
(system)252 1734 A
(library)294 2028 A
(allows)252 2364 A
(access)252 2658 A
2952(to)S
(system)252 3078 A
(services)336 3372 A
3750(by)S
(doing)210 3876 A
4128(a)S
(kernel)252 4212 A
(call.)210 4506 A
5265 V
(09604)210 1122 A
1482(*)S
(Kernel)252 1566 A
(calls)210 1860 A
(are)126 2112 A
(transformed)462 2280 A
(into)168 2784 A
(request)294 2994 A
(messages)336 3330 A
3708(to)S
(the)126 3834 A
(SYS)126 4002 A
(task)168 4170 A
(that)168 4380 A
4590(is)S
5355 V
(09605)210 1122 A
1482(*)S
(responsible)462 1566 A
(for)126 2070 A
(handling)336 2238 A
(the)126 2616 A
(call.)210 2784 A
3036(By)S
(convention,)462 3162 A
(sys_call\(\))420 3666 A
4128(is)S
(transformed)462 4254 A
5445 V
(09606)210 1122 A
1482(*)S
(into)168 1566 A
1776(a)S
(message)294 1860 A
(with)168 2196 A
(type)168 2406 A
(SYS_CALL)336 2616 A
(that)168 2994 A
3204(is)S
(handled)294 3330 A
3666(in)S
3792(a)S
(function)336 3876 A
(do_call\(\).)420 4254 A
5535 V
(09607)210 1122 A
1482(*/)S
5625 V
(09608)210 1122 A
5715 V
(09609)210 1122 A
(#ifndef)294 1440 A
(SYSTEM_H)336 1776 A
5805 V
(09610)210 1122 A
(#define)294 1440 A
(SYSTEM_H)336 1776 A
5895 V
(09611)210 1122 A
5985 V
(09612)210 1122 A
1440(/*)S
(Common)252 1566 A
(includes)336 1860 A
(for)126 2238 A
(the)126 2406 A
(system)252 2574 A
(library.)336 2868 A
3246(*/)S
6075 V
(09613)210 1122 A
(#include)336 1440 A
("kernel.h")420 1818 A
6165 V
(09614)210 1122 A
(#include)336 1440 A
("proto.h")378 1818 A
6255 V
(09615)210 1122 A
(#include)336 1440 A
("proc.h")336 1818 A
6345 V
(09616)210 1122 A
6435 V
(09617)210 1122 A
1440(/*)S
(Default)294 1566 A
(handler)294 1902 A
(for)126 2238 A
(unused)252 2406 A
(kernel)252 2700 A
(calls.)252 2994 A
3288(*/)S
6525 V
(09618)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_unused,)420 2112 A
(\(message)336 2574 A
(*m_ptr\))294 2952 A
3288(\);)S
6615 V
(09619)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_exec,)336 2112 A
(\(message)336 2490 A
(*m_ptr\))294 2868 A
3204(\);)S
6705 V
(09620)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_fork,)336 2112 A
(\(message)336 2490 A
(*m_ptr\))294 2868 A
3204(\);)S
6795 V
(09621)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_newmap,)420 2112 A
(\(message)336 2574 A
(*m_ptr\))294 2952 A
3288(\);)S
6885 V
(09622)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_exit,)336 2112 A
(\(message)336 2490 A
(*m_ptr\))294 2868 A
3204(\);)S
6975 V
(09623)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_trace,)378 2112 A
(\(message)336 2532 A
(*m_ptr\))294 2910 A
3246(\);)S
7065 V
(09624)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_nice,)336 2112 A
(\(message)336 2490 A
(*m_ptr\))294 2868 A
3204(\);)S
8418 V
EP
%%Page: 117 117
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2413(File:)S
2646(kernel/system.h)S
12 B
(117)180 4500 A
1755 V
7 LST
(09625)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_copy,)336 2112 A
(\(message)336 2490 A
(*m_ptr\))294 2868 A
3204(\);)S
1845 V
(09626)210 1122 A
(#define)294 1440 A
(do_vircopy)420 1776 A
(do_copy)294 2448 A
1935 V
(09627)210 1122 A
(#define)294 1440 A
(do_physcopy)462 1776 A
(do_copy)294 2448 A
2025 V
(09628)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_vcopy,)378 2112 A
(\(message)336 2532 A
(*m_ptr\))294 2910 A
3246(\);)S
2115 V
(09629)210 1122 A
(#define)294 1440 A
(do_virvcopy)462 1776 A
(do_vcopy)336 2448 A
2205 V
(09630)210 1122 A
(#define)294 1440 A
(do_physvcopy)504 1776 A
(do_vcopy)336 2448 A
2295 V
(09631)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_umap,)336 2112 A
(\(message)336 2490 A
(*m_ptr\))294 2868 A
3204(\);)S
2385 V
(09632)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_memset,)420 2112 A
(\(message)336 2574 A
(*m_ptr\))294 2952 A
3288(\);)S
2475 V
(09633)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_abort,)378 2112 A
(\(message)336 2532 A
(*m_ptr\))294 2910 A
3246(\);)S
2565 V
(09634)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_getinfo,)462 2112 A
(\(message)336 2616 A
(*m_ptr\))294 2994 A
3330(\);)S
2655 V
(09635)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_privctl,)462 2112 A
(\(message)336 2616 A
(*m_ptr\))294 2994 A
3330(\);)S
2745 V
(09636)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_segctl,)420 2112 A
(\(message)336 2574 A
(*m_ptr\))294 2952 A
3288(\);)S
2835 V
(09637)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_irqctl,)420 2112 A
(\(message)336 2574 A
(*m_ptr\))294 2952 A
3288(\);)S
2925 V
(09638)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_devio,)378 2112 A
(\(message)336 2532 A
(*m_ptr\))294 2910 A
3246(\);)S
3015 V
(09639)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_vdevio,)420 2112 A
(\(message)336 2574 A
(*m_ptr\))294 2952 A
3288(\);)S
3105 V
(09640)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_int86,)378 2112 A
(\(message)336 2532 A
(*m_ptr\))294 2910 A
3246(\);)S
3195 V
(09641)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_sdevio,)420 2112 A
(\(message)336 2574 A
(*m_ptr\))294 2952 A
3288(\);)S
3285 V
(09642)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_kill,)336 2112 A
(\(message)336 2490 A
(*m_ptr\))294 2868 A
3204(\);)S
3375 V
(09643)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_getksig,)462 2112 A
(\(message)336 2616 A
(*m_ptr\))294 2994 A
3330(\);)S
3465 V
(09644)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_endksig,)462 2112 A
(\(message)336 2616 A
(*m_ptr\))294 2994 A
3330(\);)S
3555 V
(09645)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_sigsend,)462 2112 A
(\(message)336 2616 A
(*m_ptr\))294 2994 A
3330(\);)S
3645 V
(09646)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_sigreturn,)546 2112 A
(\(message)336 2700 A
(*m_ptr\))294 3078 A
3414(\);)S
3735 V
(09647)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_times,)378 2112 A
(\(message)336 2532 A
(*m_ptr\))294 2910 A
3246(\);)S
3825 V
(09648)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_setalarm,)504 2112 A
(\(message)336 2658 A
(*m_ptr\))294 3036 A
3372(\);)S
3915 V
(09649)210 1122 A
4005 V
(09650)210 1122 A
(#endif)252 1440 A
1776(/*)S
(SYSTEM_H)336 1902 A
2280(*/)S
4095 V
(09651)210 1122 A
4185 V
(09652)210 1122 A
4275 V
(09653)210 1122 A
4545 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4635 V
(kernel/system.c)630 2676 A
4725 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4905 V
(09700)210 1122 A
1440(/*)S
(This)168 1566 A
(task)168 1776 A
(provides)336 1986 A
2364(an)S
(interface)378 2490 A
(between)294 2910 A
(the)126 3246 A
(kernel)252 3414 A
(and)126 3708 A
(user-space)420 3876 A
(system)252 4338 A
4995 V
(09701)210 1122 A
1482(*)S
(processes.)420 1566 A
(System)252 2028 A
(services)336 2322 A
(can)126 2700 A
2868(be)S
(accessed)336 2994 A
3372(by)S
(doing)210 3498 A
3750(a)S
(kernel)252 3834 A
(call.)210 4128 A
(Kernel)252 4380 A
5085 V
(09702)210 1122 A
1482(*)S
(calls)210 1566 A
(are)126 1818 A
(transformed)462 2028 A
(into)168 2532 A
(request)294 2742 A
(messages,)378 3078 A
(which)210 3498 A
(are)126 3750 A
(handled)294 3918 A
4254(by)S
(this)168 4380 A
5175 V
(09703)210 1122 A
1482(*)S
(task.)210 1566 A
1818(By)S
(convention,)462 1944 A
2448(a)S
(sys_call\(\))420 2532 A
2994(is)S
(transformed)462 3120 A
3624(in)S
3750(a)S
(SYS_CALL)336 3834 A
(request)294 4212 A
5265 V
(09704)210 1122 A
1482(*)S
(message)294 1566 A
(that)168 1902 A
2112(is)S
(handled)294 2238 A
2574(in)S
2700(a)S
(function)336 2784 A
(named)210 3162 A
(do_call\(\).)420 3414 A
5355 V
(09705)210 1122 A
1482(*)S
5445 V
(09706)210 1122 A
1482(*)S
1566(A)S
(private)294 1650 A
(call)168 1986 A
(vector)252 2196 A
2490(is)S
(used)168 2616 A
2826(to)S
(map)126 2952 A
(all)126 3120 A
(kernel)252 3288 A
(calls)210 3582 A
3834(to)S
(the)126 3960 A
(functions)378 4128 A
(that)168 4548 A
5535 V
(09707)210 1122 A
1482(*)S
(handle)252 1566 A
(them.)210 1860 A
(The)126 2112 A
(actual)252 2280 A
(handler)294 2574 A
(functions)378 2910 A
(are)126 3330 A
(contained)378 3498 A
3918(in)S
(separate)336 4044 A
(files)210 4422 A
5625 V
(09708)210 1122 A
1482(*)S
1566(to)S
(keep)168 1692 A
(this)168 1902 A
(file)168 2112 A
(clean.)252 2322 A
(The)126 2616 A
(call)168 2784 A
(vector)252 2994 A
3288(is)S
(used)168 3414 A
3624(in)S
(the)126 3750 A
(system)252 3918 A
(task's)252 4212 A
(main)168 4506 A
5715 V
(09709)210 1122 A
1482(*)S
(loop)168 1566 A
1776(to)S
(handle)252 1902 A
(all)126 2196 A
(incoming)336 2364 A
(requests.)378 2742 A
5805 V
(09710)210 1122 A
1482(*)S
5895 V
(09711)210 1122 A
1482(*)S
1566(In)S
(addition)336 1692 A
2070(to)S
(the)126 2196 A
(main)168 2364 A
(sys_task\(\))420 2574 A
(entry)210 3036 A
(point,)252 3288 A
(which)210 3582 A
(starts)252 3834 A
(the)126 4128 A
(main)168 4296 A
(loop,)210 4506 A
5985 V
(09712)210 1122 A
1482(*)S
(there)210 1566 A
(are)126 1818 A
(several)294 1986 A
(other)210 2322 A
(minor)210 2574 A
(entry)210 2826 A
(points:)294 3078 A
6075 V
(09713)210 1122 A
1482(*)S
(get_priv:)378 1650 A
(assign)252 2448 A
(privilege)378 2742 A
(structure)378 3162 A
3582(to)S
(user)168 3708 A
3918(or)S
(system)252 4044 A
(process)294 4338 A
6165 V
(09714)210 1122 A
1482(*)S
(send_sig:)378 1650 A
(send)168 2448 A
2658(a)S
(signal)252 2742 A
(directly)336 3036 A
3414(to)S
3540(a)S
(system)252 3624 A
(process)294 3918 A
6255 V
(09715)210 1122 A
1482(*)S
(cause_sig:)420 1650 A
(take)168 2448 A
(action)252 2658 A
2952(to)S
(cause)210 3078 A
3330(a)S
(signal)252 3414 A
3708(to)S
(occur)210 3834 A
(via)126 4086 A
4254(PM)S
6345 V
(09716)210 1122 A
1482(*)S
(umap_local:)462 1650 A
(map)126 2448 A
(virtual)294 2616 A
(address)294 2952 A
3288(in)S
(LOCAL_SEG)378 3414 A
3834(to)S
(physical)336 3960 A
6435 V
(09717)210 1122 A
1482(*)S
(umap_remote:)504 1650 A
(map)126 2448 A
(virtual)294 2616 A
(address)294 2952 A
3288(in)S
(REMOTE_SEG)420 3414 A
3876(to)S
(physical)336 4002 A
6525 V
(09718)210 1122 A
1482(*)S
(umap_bios:)420 1650 A
(map)126 2448 A
(virtual)294 2616 A
(address)294 2952 A
3288(in)S
(BIOS_SEG)336 3414 A
3792(to)S
(physical)336 3918 A
6615 V
(09719)210 1122 A
1482(*)S
(virtual_copy:)546 1650 A
(copy)168 2448 A
(bytes)210 2658 A
(from)168 2910 A
(one)126 3120 A
(virtual)294 3288 A
(address)294 3624 A
3960(to)S
(another)294 4086 A
6705 V
(09720)210 1122 A
1482(*)S
(get_randomness:)630 1650 A
(accumulate)420 2448 A
(randomness)420 2910 A
3372(in)S
3498(a)S
(buffer)252 3582 A
6795 V
(09721)210 1122 A
1482(*)S
6885 V
(09722)210 1122 A
1482(*)S
(Changes:)336 1566 A
6975 V
(09723)210 1122 A
1482(*)S
(Aug)126 1650 A
(04,)126 1818 A
(2005)168 1986 A
(check)210 2280 A
2532(if)S
(kernel)252 2658 A
(call)168 2952 A
3162(is)S
(allowed)294 3288 A
(\(Jorrit)294 3666 A
4002(N.)S
(Herder\))294 4128 A
7065 V
(09724)210 1122 A
1482(*)S
(Jul)126 1650 A
(20,)126 1818 A
(2005)168 1986 A
(send)168 2280 A
(signal)252 2490 A
2784(to)S
(services)336 2910 A
(with)168 3288 A
(message)294 3498 A
(\(Jorrit)294 3876 A
4212(N.)S
(Herder\))294 4338 A
8418 V
EP
%%Page: 118 118
BP
/slant 0 def
/height 0 def
1485 V
12 B
(118)180 1080 A
11 R
2416(File:)S
2649(kernel/system.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(09725)210 1122 A
1482(*)S
(Jan)126 1650 A
(15,)126 1818 A
(2005)168 1986 A
(new,)168 2280 A
(generalized)462 2490 A
(virtual)294 2994 A
(copy)168 3330 A
(function)336 3540 A
(\(Jorrit)294 3960 A
4296(N.)S
(Herder\))294 4422 A
1845 V
(09726)210 1122 A
1482(*)S
(Oct)126 1650 A
(10,)126 1818 A
(2004)168 1986 A
(dispatch)336 2280 A
(system)252 2658 A
(calls)210 2952 A
(from)168 3204 A
(call)168 3414 A
(vector)252 3624 A
(\(Jorrit)294 3960 A
4296(N.)S
(Herder\))294 4422 A
1935 V
(09727)210 1122 A
1482(*)S
(Sep)126 1650 A
(30,)126 1818 A
(2004)168 1986 A
(source)252 2280 A
(code)168 2574 A
(documentation)546 2784 A
(updated)294 3372 A
(\(Jorrit)294 3750 A
4086(N.)S
(Herder\))294 4212 A
2025 V
(09728)210 1122 A
1482(*/)S
2115 V
(09729)210 1122 A
2205 V
(09730)210 1122 A
(#include)336 1440 A
("kernel.h")420 1818 A
2295 V
(09731)210 1122 A
(#include)336 1440 A
("system.h")420 1818 A
2385 V
(09732)210 1122 A
(#include)336 1440 A
(<stdlib.h>)420 1818 A
2475 V
(09733)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
2565 V
(09734)210 1122 A
(#include)336 1440 A
(<unistd.h>)420 1818 A
2655 V
(09735)210 1122 A
(#include)336 1440 A
(<sys/sigcontext.h>)756 1818 A
2745 V
(09736)210 1122 A
(#include)336 1440 A
(<ibm/memory.h>)588 1818 A
2835 V
(09737)210 1122 A
(#include)336 1440 A
("protect.h")462 1818 A
2925 V
(09738)210 1122 A
3015 V
(09739)210 1122 A
1440(/*)S
(Declaration)462 1566 A
2070(of)S
(the)126 2196 A
(call)168 2364 A
(vector)252 2574 A
(that)168 2868 A
(defines)294 3078 A
(the)126 3414 A
(mapping)294 3582 A
3918(of)S
(kernel)252 4044 A
(calls)210 4338 A
3105 V
(09740)210 1122 A
1482(*)S
1566(to)S
(handler)294 1692 A
(functions.)420 2028 A
(The)126 2490 A
(vector)252 2658 A
2952(is)S
(initialized)462 3078 A
3582(in)S
(sys_init\(\))420 3708 A
(with)168 4170 A
(map\(\),)252 4380 A
3195 V
(09741)210 1122 A
1482(*)S
(which)210 1566 A
(makes)210 1818 A
(sure)168 2070 A
(the)126 2280 A
(kernel)252 2448 A
(call)168 2742 A
(numbers)294 2952 A
(are)126 3288 A
(ok.)126 3456 A
3624(No)S
(space)210 3750 A
4002(is)S
(allocated,)420 4128 A
3285 V
(09742)210 1122 A
1482(*)S
(because)294 1566 A
(the)126 1902 A
(dummy)210 2070 A
2322(is)S
(declared)336 2448 A
(extern.)294 2826 A
3162(If)S
3288(an)S
(illegal)294 3414 A
(call)168 3750 A
3960(is)S
(given,)252 4086 A
(the)126 4380 A
3375 V
(09743)210 1122 A
1482(*)S
(array)210 1566 A
(size)168 1818 A
(will)168 2028 A
2238(be)S
(negative)336 2364 A
(and)126 2742 A
(this)168 2910 A
(won't)210 3120 A
(compile.)336 3372 A
3465 V
(09744)210 1122 A
1482(*/)S
3555 V
(09745)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(\(*call_vec[NR_SYS_CALLS]\)\(message)1386 1902 A
(*m_ptr\);)336 3330 A
3645 V
(09746)210 1122 A
3735 V
(09747)210 1122 A
(#define)294 1440 A
(map\(call_nr,)504 1776 A
(handler\))336 2322 A
2700(\\)S
3825 V
(09748)210 1122 A
({extern)294 1608 A
(int)126 1944 A
(dummy[NR_SYS_CALLS>\(unsigned\)\(call_nr-KERNEL_CALL\))2100 2112 A
4254(?)S
(1:-1];})294 4338 A
4674(\\)S
3915 V
(09749)210 1122 A
(call_vec[\(call_nr-KERNEL_CALL\)])1302 1608 A
2952(=)S
(\(handler\))378 3036 A
4005 V
(09750)210 1122 A
4095 V
(09751)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(initialize,)462 2490 A
(\(void\)\);)336 2994 A
4185 V
(09752)210 1122 A
4275 V
(09753)210 1122 A
(/*===========================================================================*)3276 1440 A
4365 V
(09754)210 1122 A
1482(*)S
(sys_task)336 2784 A
4674(*)S
4455 V
(09755)210 1122 A
(*===========================================================================*/)3276 1482 A
4545 V
(09756)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(sys_task\(\))420 1944 A
4635 V
(09757)210 1122 A
1440({)S
4725 V
(09758)210 1122 A
1440(/*)S
(Main)168 1566 A
(entry)210 1776 A
(point)210 2028 A
2280(of)S
(sys_task.)378 2406 A
(Get)126 2868 A
(the)126 3036 A
(message)294 3204 A
(and)126 3540 A
(dispatch)336 3708 A
4086(on)S
(type.)210 4212 A
4464(*/)S
4815 V
(09759)210 1122 A
(static)252 1524 A
(message)294 1818 A
2154(m;)S
4905 V
(09760)210 1122 A
(register)336 1524 A
(int)126 1902 A
(result;)294 2070 A
4995 V
(09761)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*caller_ptr;)504 2406 A
5085 V
(09762)210 1122 A
(unsigned)336 1524 A
(int)126 1902 A
(call_nr;)336 2070 A
5175 V
(09763)210 1122 A
(int)126 1524 A
1692(s;)S
5265 V
(09764)210 1122 A
5355 V
(09765)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(the)126 2112 A
(system)252 2280 A
(task.)210 2574 A
2826(*/)S
5445 V
(09766)210 1122 A
(initialize\(\);)546 1524 A
5535 V
(09767)210 1122 A
5625 V
(09768)210 1122 A
(while)210 1524 A
(\(TRUE\))252 1776 A
2070({)S
5715 V
(09769)210 1122 A
1692(/*)S
(Get)126 1818 A
(work.)210 1986 A
(Block)210 2238 A
(and)126 2490 A
(wait)168 2658 A
(until)210 2868 A
3120(a)S
(request)294 3204 A
(message)294 3540 A
(arrives.)336 3876 A
4254(*/)S
5805 V
(09770)210 1122 A
(receive\(ANY,)504 1692 A
(&m\);)168 2238 A
5895 V
(09771)210 1122 A
(call_nr)294 1692 A
2028(=)S
(\(unsigned\))420 2112 A
(m.m_type)336 2574 A
2952(-)S
(KERNEL_CALL;)504 3036 A
5985 V
(09772)210 1122 A
(caller_ptr)420 1692 A
2154(=)S
(proc_addr\(m.m_source\);)924 2238 A
6075 V
(09773)210 1122 A
6165 V
(09774)210 1122 A
1692(/*)S
(See)126 1818 A
1986(if)S
(the)126 2112 A
(caller)252 2280 A
(made)168 2574 A
2784(a)S
(valid)210 2868 A
(request)294 3120 A
(and)126 3456 A
(try)126 3624 A
3792(to)S
(handle)252 3918 A
(it.)126 4212 A
4380(*/)S
6255 V
(09775)210 1122 A
1692(if)S
1818(\(!)S
(\(priv\(caller_ptr\)->s_call_mask)1260 1944 A
3246(&)S
(\(1<<call_nr\)\)\))588 3330 A
3960({)S
6345 V
(09776)210 1122 A
(kprintf\("SYSTEM:)672 1860 A
(request)294 2574 A
2910(%d)S
(from)168 3036 A
3246(%d)S
(denied.\\n",)462 3372 A
(call_nr,m.m_source\);)840 3876 A
6435 V
(09777)210 1122 A
(result)252 1860 A
2154(=)S
(ECALLDENIED;)504 2238 A
3456(/*)S
(illegal)294 3582 A
(message)294 3918 A
(type)168 4254 A
4464(*/)S
6525 V
(09778)210 1122 A
1692(})S
(else)168 1776 A
1986(if)S
(\(call_nr)336 2112 A
2490(>=)S
(NR_SYS_CALLS\))546 2616 A
3204({)S
3792(/*)S
(check)210 3918 A
(call)168 4170 A
(number)252 4380 A
4674(*/)S
6615 V
(09779)210 1122 A
(kprintf\("SYSTEM:)672 1860 A
(illegal)294 2574 A
(request)294 2910 A
3246(%d)S
(from)168 3372 A
(%d.\\n",)294 3582 A
(call_nr,m.m_source\);)840 3918 A
6705 V
(09780)210 1122 A
(result)252 1860 A
2154(=)S
(EBADREQUEST;)504 2238 A
3456(/*)S
(illegal)294 3582 A
(message)294 3918 A
(type)168 4254 A
4464(*/)S
6795 V
(09781)210 1122 A
1692(})S
6885 V
(09782)210 1122 A
(else)168 1692 A
1902({)S
6975 V
(09783)210 1122 A
(result)252 1860 A
2154(=)S
(\(*call_vec[call_nr]\)\(&m\);)1050 2238 A
3456(/*)S
(handle)252 3582 A
(the)126 3876 A
(kernel)252 4044 A
(call)168 4338 A
4548(*/)S
7065 V
(09784)210 1122 A
1692(})S
8418 V
EP
%%Page: 119 119
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2416(File:)S
2649(kernel/system.c)S
12 B
(119)180 4500 A
1755 V
7 LST
(09785)210 1122 A
1845 V
(09786)210 1122 A
1692(/*)S
(Send)168 1818 A
2028(a)S
(reply,)252 2112 A
(unless)252 2406 A
(inhibited)378 2700 A
3120(by)S
3246(a)S
(handler)294 3330 A
(function.)378 3666 A
(Use)126 4086 A
(the)126 4254 A
(kernel)252 4422 A
1935 V
(09787)210 1122 A
1734(*)S
(function)336 1818 A
(lock_send\(\))462 2196 A
2700(to)S
(prevent)294 2826 A
3162(a)S
(system)252 3246 A
(call)168 3540 A
(trap.)210 3750 A
(The)126 4002 A
(destination)462 4170 A
2025 V
(09788)210 1122 A
1734(*)S
1818(is)S
(known)210 1944 A
2196(to)S
2322(be)S
(blocked)294 2448 A
(waiting)294 2784 A
(for)126 3120 A
3288(a)S
(message.)336 3372 A
2115 V
(09789)210 1122 A
1734(*/)S
2205 V
(09790)210 1122 A
1692(if)S
(\(result)294 1818 A
2154(!=)S
(EDONTREPLY\))462 2280 A
2784({)S
2295 V
(09791)210 1122 A
(m.m_type)336 1860 A
2238(=)S
(result;)294 2322 A
3456(/*)S
(report)252 3582 A
(status)252 3876 A
4170(of)S
(call)168 4296 A
4506(*/)S
2385 V
(09792)210 1122 A
1860(if)S
(\(OK)126 1986 A
2154(!=)S
(\(s=lock_send\(m.m_source,)1008 2280 A
(&m\)\)\))210 3330 A
3582({)S
2475 V
(09793)210 1122 A
(kprintf\("SYSTEM,)672 2028 A
(reply)210 2742 A
2994(to)S
3120(%d)S
(failed:)294 3246 A
(%d\\n",)252 3582 A
(m.m_source,)462 3876 A
(s\);)126 4380 A
2565 V
(09794)210 1122 A
1860(})S
2655 V
(09795)210 1122 A
1692(})S
2745 V
(09796)210 1122 A
1524(})S
2835 V
(09797)210 1122 A
1440(})S
3015 V
(09799)210 1122 A
(/*===========================================================================*)3276 1440 A
3105 V
(09800)210 1122 A
1482(*)S
(initialize)420 2784 A
4674(*)S
3195 V
(09801)210 1122 A
(*===========================================================================*/)3276 1482 A
3285 V
(09802)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(initialize\(void\))672 1986 A
3375 V
(09803)210 1122 A
1440({)S
3465 V
(09804)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(priv)168 2196 A
(*sp;)168 2406 A
3555 V
(09805)210 1122 A
(int)126 1524 A
1692(i;)S
3645 V
(09806)210 1122 A
3735 V
(09807)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(IRQ)126 2112 A
(handler)294 2280 A
(hooks.)252 2616 A
(Mark)168 2910 A
(all)126 3120 A
(hooks)210 3288 A
(available.)420 3540 A
4002(*/)S
3825 V
(09808)210 1122 A
(for)126 1524 A
(\(i=0;)210 1692 A
(i<NR_IRQ_HOOKS;)630 1944 A
(i++\))168 2616 A
2826({)S
3915 V
(09809)210 1122 A
(irq_hooks[i].proc_nr)840 1692 A
2574(=)S
(NONE;)210 2658 A
4005 V
(09810)210 1122 A
1524(})S
4095 V
(09811)210 1122 A
4185 V
(09812)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(all)126 2112 A
(alarm)210 2280 A
(timers)252 2532 A
(for)126 2826 A
(all)126 2994 A
(processes.)420 3162 A
3624(*/)S
4275 V
(09813)210 1122 A
(for)126 1524 A
(\(sp=BEG_PRIV_ADDR;)756 1692 A
2490(sp)S
2616(<)S
(END_PRIV_ADDR;)588 2700 A
(sp++\))210 3330 A
3582({)S
4365 V
(09814)210 1122 A
(tmr_inittimer\(&\(sp->s_alarm_timer\)\);)1512 1608 A
4455 V
(09815)210 1122 A
1524(})S
4545 V
(09816)210 1122 A
4635 V
(09817)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(the)126 2112 A
(call)168 2280 A
(vector)252 2490 A
2784(to)S
2910(a)S
(safe)168 2994 A
(default)294 3204 A
(handler.)336 3540 A
(Some)168 3918 A
(kernel)252 4128 A
(calls)210 4422 A
4725 V
(09818)210 1122 A
1566(*)S
(may)126 1650 A
1818(be)S
(disabled)336 1944 A
2322(or)S
(nonexistant.)504 2448 A
(Then)168 2994 A
(explicitly)420 3204 A
(map)126 3666 A
(known)210 3834 A
(calls)210 4086 A
4338(to)S
(their)210 4464 A
4815 V
(09819)210 1122 A
1566(*)S
(handler)294 1650 A
(functions.)420 1986 A
(This)168 2448 A
2658(is)S
(done)168 2784 A
(with)168 2994 A
3204(a)S
(macro)210 3288 A
(that)168 3540 A
(gives)210 3750 A
4002(a)S
(compile)294 4086 A
(error)210 4422 A
4905 V
(09820)210 1122 A
1566(*)S
1650(if)S
1776(an)S
(illegal)294 1902 A
(call)168 2238 A
(number)252 2448 A
2742(is)S
(used.)210 2868 A
(The)126 3120 A
(ordering)336 3288 A
3666(is)S
(not)126 3792 A
(important)378 3960 A
(here.)210 4380 A
4995 V
(09821)210 1122 A
1566(*/)S
5085 V
(09822)210 1122 A
(for)126 1524 A
(\(i=0;)210 1692 A
(i<NR_SYS_CALLS;)630 1944 A
(i++\))168 2616 A
2826({)S
5175 V
(09823)210 1122 A
(call_vec[i])462 1692 A
2196(=)S
(do_unused;)420 2280 A
5265 V
(09824)210 1122 A
1524(})S
5355 V
(09825)210 1122 A
5445 V
(09826)210 1122 A
1524(/*)S
(Process)294 1650 A
(management.)462 1986 A
2490(*/)S
5535 V
(09827)210 1122 A
(map\(SYS_FORK,)546 1524 A
(do_fork\);)378 2112 A
3120(/*)S
3246(a)S
(process)294 3330 A
(forked)252 3666 A
3960(a)S
(new)126 4044 A
(process)294 4212 A
4548(*/)S
5625 V
(09828)210 1122 A
(map\(SYS_EXEC,)546 1524 A
(do_exec\);)378 2112 A
3120(/*)S
(update)252 3246 A
(process)294 3540 A
(after)210 3876 A
(execute)294 4128 A
4464(*/)S
5715 V
(09829)210 1122 A
(map\(SYS_EXIT,)546 1524 A
(do_exit\);)378 2112 A
3120(/*)S
(clean)210 3246 A
3498(up)S
(after)210 3624 A
(process)294 3876 A
(exit)168 4212 A
4422(*/)S
5805 V
(09830)210 1122 A
(map\(SYS_NICE,)546 1524 A
(do_nice\);)378 2112 A
3120(/*)S
(set)126 3246 A
(scheduling)420 3414 A
(priority)336 3876 A
4254(*/)S
5895 V
(09831)210 1122 A
(map\(SYS_PRIVCTL,)672 1524 A
(do_privctl\);)504 2238 A
3120(/*)S
(system)252 3246 A
(privileges)420 3540 A
(control)294 4002 A
4338(*/)S
5985 V
(09832)210 1122 A
(map\(SYS_TRACE,)588 1524 A
(do_trace\);)420 2154 A
3120(/*)S
(request)294 3246 A
3582(a)S
(trace)210 3666 A
(operation)378 3918 A
4338(*/)S
6075 V
(09833)210 1122 A
6165 V
(09834)210 1122 A
1524(/*)S
(Signal)252 1650 A
(handling.)378 1944 A
2364(*/)S
6255 V
(09835)210 1122 A
(map\(SYS_KILL,)546 1524 A
(do_kill\);)378 2112 A
3120(/*)S
(cause)210 3246 A
3498(a)S
(process)294 3582 A
3918(to)S
4044(be)S
(signaled)336 4170 A
4548(*/)S
6345 V
(09836)210 1122 A
(map\(SYS_GETKSIG,)672 1524 A
(do_getksig\);)504 2238 A
3120(/*)S
3246(PM)S
(checks)252 3372 A
(for)126 3666 A
(pending)294 3834 A
(signals)294 4170 A
4506(*/)S
6435 V
(09837)210 1122 A
(map\(SYS_ENDKSIG,)672 1524 A
(do_endksig\);)504 2238 A
3120(/*)S
3246(PM)S
(finished)336 3372 A
(processing)420 3750 A
(signal)252 4212 A
4506(*/)S
6525 V
(09838)210 1122 A
(map\(SYS_SIGSEND,)672 1524 A
(do_sigsend\);)504 2238 A
3120(/*)S
(start)210 3246 A
(POSIX-style)462 3498 A
(signal)252 4002 A
4296(*/)S
6615 V
(09839)210 1122 A
(map\(SYS_SIGRETURN,)756 1524 A
(do_sigreturn\);)588 2322 A
3120(/*)S
(return)252 3246 A
(from)168 3540 A
(POSIX-style)462 3750 A
(signal)252 4254 A
4548(*/)S
6705 V
(09840)210 1122 A
6795 V
(09841)210 1122 A
1524(/*)S
(Device)252 1650 A
(I/O.)168 1944 A
2154(*/)S
6885 V
(09842)210 1122 A
(map\(SYS_IRQCTL,)630 1524 A
(do_irqctl\);)462 2196 A
3120(/*)S
(interrupt)378 3246 A
(control)294 3666 A
(operations)420 4002 A
4464(*/)S
6975 V
(09843)210 1122 A
(map\(SYS_DEVIO,)588 1524 A
(do_devio\);)420 2154 A
3120(/*)S
(inb,)168 3246 A
(inw,)168 3456 A
(inl,)168 3666 A
(outb,)210 3876 A
(outw,)210 4128 A
(outl)168 4380 A
4590(*/)S
7065 V
(09844)210 1122 A
(map\(SYS_SDEVIO,)630 1524 A
(do_sdevio\);)462 2196 A
3120(/*)S
(phys_insb,)420 3246 A
(_insw,)252 3708 A
(_outsb,)294 4002 A
(_outsw)252 4338 A
4632(*/)S
8418 V
EP
%%Page: 120 120
BP
/slant 0 def
/height 0 def
1485 V
12 B
(120)180 1080 A
11 R
2416(File:)S
2649(kernel/system.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(09845)210 1122 A
(map\(SYS_VDEVIO,)630 1524 A
(do_vdevio\);)462 2196 A
3120(/*)S
(vector)252 3246 A
(with)168 3540 A
(devio)210 3750 A
(requests)336 4002 A
4380(*/)S
1845 V
(09846)210 1122 A
(map\(SYS_INT86,)588 1524 A
(do_int86\);)420 2154 A
3120(/*)S
(real-mode)378 3246 A
(BIOS)168 3666 A
(calls)210 3876 A
4128(*/)S
1935 V
(09847)210 1122 A
2025 V
(09848)210 1122 A
1524(/*)S
(Memory)252 1650 A
(management.)462 1944 A
2448(*/)S
2115 V
(09849)210 1122 A
(map\(SYS_NEWMAP,)630 1524 A
(do_newmap\);)462 2196 A
3120(/*)S
(set)126 3246 A
3414(up)S
3540(a)S
(process)294 3624 A
(memory)252 3960 A
(map)126 4254 A
4422(*/)S
2205 V
(09850)210 1122 A
(map\(SYS_SEGCTL,)630 1524 A
(do_segctl\);)462 2196 A
3120(/*)S
(add)126 3246 A
(segment)294 3414 A
(and)126 3750 A
(get)126 3918 A
(selector)336 4086 A
4464(*/)S
2295 V
(09851)210 1122 A
(map\(SYS_MEMSET,)630 1524 A
(do_memset\);)462 2196 A
3120(/*)S
(write)210 3246 A
(char)168 3498 A
3708(to)S
(memory)252 3834 A
(area)168 4128 A
4338(*/)S
2385 V
(09852)210 1122 A
2475 V
(09853)210 1122 A
1524(/*)S
(Copying.)336 1650 A
2028(*/)S
2565 V
(09854)210 1122 A
(map\(SYS_UMAP,)546 1524 A
(do_umap\);)378 2112 A
3120(/*)S
(map)126 3246 A
(virtual)294 3414 A
3750(to)S
(physical)336 3876 A
(address)294 4254 A
4590(*/)S
2655 V
(09855)210 1122 A
(map\(SYS_VIRCOPY,)672 1524 A
(do_vircopy\);)504 2238 A
3120(/*)S
(use)126 3246 A
(pure)168 3414 A
(virtual)294 3624 A
(addressing)420 3960 A
4422(*/)S
2745 V
(09856)210 1122 A
(map\(SYS_PHYSCOPY,)714 1524 A
(do_physcopy\);)546 2280 A
3120(/*)S
(use)126 3246 A
(physical)336 3414 A
(addressing)420 3792 A
4254(*/)S
2835 V
(09857)210 1122 A
(map\(SYS_VIRVCOPY,)714 1524 A
(do_virvcopy\);)546 2280 A
3120(/*)S
(vector)252 3246 A
(with)168 3540 A
(copy)168 3750 A
(requests)336 3960 A
4338(*/)S
2925 V
(09858)210 1122 A
(map\(SYS_PHYSVCOPY,)756 1524 A
(do_physvcopy\);)588 2322 A
3120(/*)S
(vector)252 3246 A
(with)168 3540 A
(copy)168 3750 A
(requests)336 3960 A
4338(*/)S
3015 V
(09859)210 1122 A
3105 V
(09860)210 1122 A
1524(/*)S
(Clock)210 1650 A
(functionality.)588 1902 A
2532(*/)S
3195 V
(09861)210 1122 A
(map\(SYS_TIMES,)588 1524 A
(do_times\);)420 2154 A
3120(/*)S
(get)126 3246 A
(uptime)252 3414 A
(and)126 3708 A
(process)294 3876 A
(times)210 4212 A
4464(*/)S
3285 V
(09862)210 1122 A
(map\(SYS_SETALARM,)714 1524 A
(do_setalarm\);)546 2280 A
3120(/*)S
(schedule)336 3246 A
3624(a)S
(synchronous)462 3708 A
(alarm)210 4212 A
4464(*/)S
3375 V
(09863)210 1122 A
3465 V
(09864)210 1122 A
1524(/*)S
(System)252 1650 A
(control.)336 1944 A
2322(*/)S
3555 V
(09865)210 1122 A
(map\(SYS_ABORT,)588 1524 A
(do_abort\);)420 2154 A
3120(/*)S
(abort)210 3246 A
(MINIX)210 3498 A
3750(*/)S
3645 V
(09866)210 1122 A
(map\(SYS_GETINFO,)672 1524 A
(do_getinfo\);)504 2238 A
3120(/*)S
(request)294 3246 A
(system)252 3582 A
(information)462 3876 A
4380(*/)S
3735 V
(09867)210 1122 A
1440(})S
3915 V
(09869)210 1122 A
(/*===========================================================================*)3276 1440 A
4005 V
(09870)210 1122 A
1482(*)S
(get_priv)336 2784 A
4674(*)S
4095 V
(09871)210 1122 A
(*===========================================================================*/)3276 1482 A
4185 V
(09872)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(get_priv\(rc,)504 1902 A
(proc_type\))420 2448 A
4275 V
(09873)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(proc)168 2112 A
(*rc;)168 2322 A
3120(/*)S
(new)126 3246 A
(\(child\))294 3414 A
(process)294 3750 A
(pointer)294 4086 A
4422(*/)S
4365 V
(09874)210 1122 A
(int)126 1440 A
(proc_type;)420 1608 A
3120(/*)S
(system)252 3246 A
3540(or)S
(user)168 3666 A
(process)294 3876 A
(flag)168 4212 A
4422(*/)S
4455 V
(09875)210 1122 A
1440({)S
4545 V
(09876)210 1122 A
1440(/*)S
(Get)126 1566 A
1734(a)S
(privilege)378 1818 A
(structure.)420 2238 A
(All)126 2700 A
(user)168 2868 A
(processes)378 3078 A
(share)210 3498 A
(the)126 3750 A
(same)168 3918 A
(privilege)378 4128 A
4635 V
(09877)210 1122 A
1482(*)S
(structure.)420 1566 A
(System)252 2028 A
(processes)378 2322 A
(get)126 2742 A
(their)210 2910 A
(own)126 3162 A
(privilege)378 3330 A
(structure.)420 3750 A
4725 V
(09878)210 1122 A
1482(*/)S
4815 V
(09879)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(priv)168 2196 A
(*sp;)168 2406 A
3456(/*)S
(privilege)378 3582 A
(structure)378 4002 A
4422(*/)S
4905 V
(09880)210 1122 A
4995 V
(09881)210 1122 A
1524(if)S
(\(proc_type)420 1650 A
2112(==)S
(SYS_PROC\))378 2238 A
2658({)S
3456(/*)S
(find)168 3582 A
3792(a)S
(new)126 3876 A
(slot)168 4044 A
4254(*/)S
5085 V
(09882)210 1122 A
(for)126 1692 A
(\(sp)126 1860 A
2028(=)S
(BEG_PRIV_ADDR;)588 2112 A
2742(sp)S
2868(<)S
(END_PRIV_ADDR;)588 2952 A
(++sp\))210 3582 A
5175 V
(09883)210 1122 A
1860(if)S
(\(sp->s_proc_nr)588 1986 A
2616(==)S
(NONE)168 2742 A
2952(&&)S
(sp->s_id)336 3078 A
3456(!=)S
(USER_PRIV_ID\))546 3582 A
(break;)252 4170 A
5265 V
(09884)210 1122 A
1692(if)S
(\(sp->s_proc_nr)588 1818 A
2448(!=)S
(NONE\))210 2574 A
(return\(ENOSPC\);)630 2826 A
5355 V
(09885)210 1122 A
(rc->p_priv)420 1692 A
2154(=)S
(sp;)126 2238 A
3456(/*)S
(assign)252 3582 A
(new)126 3876 A
(slot)168 4044 A
4254(*/)S
5445 V
(09886)210 1122 A
(rc->p_priv->s_proc_nr)882 1692 A
2616(=)S
(proc_nr\(rc\);)504 2700 A
3456(/*)S
(set)126 3582 A
(association)462 3750 A
4254(*/)S
5535 V
(09887)210 1122 A
(rc->p_priv->s_flags)798 1692 A
2532(=)S
(SYS_PROC;)378 2616 A
3456(/*)S
(mark)168 3582 A
3792(as)S
(privileged)420 3918 A
4380(*/)S
5625 V
(09888)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
5715 V
(09889)210 1122 A
(rc->p_priv)420 1692 A
2154(=)S
(&priv[USER_PRIV_ID];)840 2238 A
3456(/*)S
(use)126 3582 A
(shared)252 3750 A
(slot)168 4044 A
4254(*/)S
5805 V
(09890)210 1122 A
(rc->p_priv->s_proc_nr)882 1692 A
2616(=)S
(INIT_PROC_NR;)546 2700 A
3456(/*)S
(set)126 3582 A
(association)462 3750 A
4254(*/)S
5895 V
(09891)210 1122 A
(rc->p_priv->s_flags)798 1692 A
2532(=)S
2616(0;)S
3456(/*)S
3582(no)S
(initial)294 3708 A
(flags)210 4044 A
4296(*/)S
5985 V
(09892)210 1122 A
1524(})S
6075 V
(09893)210 1122 A
(return\(OK\);)462 1524 A
6165 V
(09894)210 1122 A
1440(})S
6345 V
(09896)210 1122 A
(/*===========================================================================*)3276 1440 A
6435 V
(09897)210 1122 A
1482(*)S
(get_randomness)588 2784 A
4674(*)S
6525 V
(09898)210 1122 A
(*===========================================================================*/)3276 1482 A
6615 V
(09899)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(get_randomness\(source\))924 1944 A
6705 V
(09900)210 1122 A
(int)126 1440 A
(source;)294 1608 A
6795 V
(09901)210 1122 A
1440({)S
6885 V
(09902)210 1122 A
1440(/*)S
1566(On)S
(machines)336 1692 A
(with)168 2070 A
(the)126 2280 A
(RDTSC)210 2448 A
(\(cycle)252 2700 A
(counter)294 2994 A
(read)168 3330 A
(instruction)462 3540 A
4044(-)S
(pentium)294 4128 A
6975 V
(09903)210 1122 A
1482(*)S
(and)126 1566 A
(up\),)168 1734 A
(use)126 1944 A
(that)168 2112 A
(for)126 2322 A
(high-resolution)630 2490 A
(raw)126 3162 A
(entropy)294 3330 A
(gathering.)420 3666 A
(Otherwise,)420 4128 A
7065 V
(09904)210 1122 A
1482(*)S
(use)126 1566 A
(the)126 1734 A
(realtime)336 1902 A
(clock)210 2280 A
(\(tick)210 2532 A
(resolution\).)504 2784 A
8418 V
EP
%%Page: 121 121
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2416(File:)S
2649(kernel/system.c)S
12 B
(121)180 4500 A
1755 V
7 LST
(09905)210 1122 A
1482(*)S
1845 V
(09906)210 1122 A
1482(*)S
(Unfortunately)546 1566 A
(this)168 2154 A
(test)168 2364 A
2574(is)S
(run-time)336 2700 A
3078(-)S
3162(we)S
(don't)210 3288 A
(want)168 3540 A
3750(to)S
(bother)252 3876 A
(with)168 4170 A
1935 V
(09907)210 1122 A
1482(*)S
(compiling)378 1566 A
(different)378 1986 A
(kernels)294 2406 A
(for)126 2742 A
(different)378 2910 A
(machines.)378 3330 A
2025 V
(09908)210 1122 A
1482(*)S
2115 V
(09909)210 1122 A
1482(*)S
1566(On)S
(machines)336 1692 A
(without)294 2070 A
(RDTSC,)252 2406 A
2700(we)S
(use)126 2826 A
(read_clock\(\).)546 2994 A
2205 V
(09910)210 1122 A
1482(*/)S
2295 V
(09911)210 1122 A
(int)126 1524 A
(r_next;)294 1692 A
2385 V
(09912)210 1122 A
(unsigned)336 1524 A
(long)168 1902 A
(tsc_high,)378 2112 A
(tsc_low;)336 2532 A
2475 V
(09913)210 1122 A
2565 V
(09914)210 1122 A
(source)252 1524 A
1818(%=)S
(RANDOM_SOURCES;)630 1944 A
2655 V
(09915)210 1122 A
(r_next=)294 1524 A
(krandom.bin[source].r_next;)1134 1860 A
2745 V
(09916)210 1122 A
1524(if)S
(\(machine.processor)756 1650 A
2448(>)S
(486\))168 2532 A
2742({)S
2835 V
(09917)210 1122 A
(read_tsc\(&tsc_high,)798 1692 A
(&tsc_low\);)420 2532 A
2925 V
(09918)210 1122 A
(krandom.bin[source].r_buf[r_next])1386 1692 A
3120(=)S
(tsc_low;)336 3204 A
3015 V
(09919)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3105 V
(09920)210 1122 A
(krandom.bin[source].r_buf[r_next])1386 1692 A
3120(=)S
(read_clock\(\);)546 3204 A
3195 V
(09921)210 1122 A
1524(})S
3285 V
(09922)210 1122 A
1524(if)S
(\(krandom.bin[source].r_size)1134 1650 A
2826(<)S
(RANDOM_ELEMENTS\))672 2910 A
3624({)S
3375 V
(09923)210 1122 A
(krandom.bin[source].r_size)1092 1776 A
(++;)126 2910 A
3465 V
(09924)210 1122 A
1524(})S
3555 V
(09925)210 1122 A
(krandom.bin[source].r_next)1092 1524 A
2658(=)S
(\(r_next)294 2742 A
3078(+)S
3162(1)S
3246(\))S
3330(%)S
(RANDOM_ELEMENTS;)672 3414 A
3645 V
(09926)210 1122 A
1440(})S
3825 V
(09928)210 1122 A
(/*===========================================================================*)3276 1440 A
3915 V
(09929)210 1122 A
1482(*)S
(send_sig)336 2784 A
4674(*)S
4005 V
(09930)210 1122 A
(*===========================================================================*/)3276 1482 A
4095 V
(09931)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(send_sig\(proc_nr,)714 1944 A
(sig_nr\))294 2700 A
4185 V
(09932)210 1122 A
(int)126 1440 A
(proc_nr;)336 1608 A
2784(/*)S
(system)252 2910 A
(process)294 3204 A
3540(to)S
3666(be)S
(signalled)378 3792 A
4212(*/)S
4275 V
(09933)210 1122 A
(int)126 1440 A
(sig_nr;)294 1608 A
2784(/*)S
(signal)252 2910 A
3204(to)S
3330(be)S
(sent,)210 3456 A
3708(1)S
3792(to)S
(_NSIG)210 3918 A
4170(*/)S
4365 V
(09934)210 1122 A
1440({)S
4455 V
(09935)210 1122 A
1440(/*)S
(Notify)252 1566 A
1860(a)S
(system)252 1944 A
(process)294 2238 A
(about)210 2574 A
2826(a)S
(signal.)294 2910 A
(This)168 3246 A
3456(is)S
(straightforward.)672 3582 A
(Simply)252 4296 A
4545 V
(09936)210 1122 A
1482(*)S
(set)126 1566 A
(the)126 1734 A
(signal)252 1902 A
(that)168 2196 A
2406(is)S
2532(to)S
2658(be)S
(delivered)378 2784 A
3204(in)S
(the)126 3330 A
(pending)294 3498 A
(signals)294 3834 A
(map)126 4170 A
(and)126 4338 A
4635 V
(09937)210 1122 A
1482(*)S
(send)168 1566 A
1776(a)S
(notification)504 1860 A
(with)168 2406 A
(source)252 2616 A
(SYSTEM.)294 2910 A
4725 V
(09938)210 1122 A
1482(*/)S
4815 V
(09939)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*rp;)168 2406 A
4905 V
(09940)210 1122 A
4995 V
(09941)210 1122 A
1524(rp)S
1650(=)S
(proc_addr\(proc_nr\);)798 1734 A
5085 V
(09942)210 1122 A
(sigaddset\(&priv\(rp\)->s_sig_pending,)1470 1524 A
(sig_nr\);)336 3036 A
5175 V
(09943)210 1122 A
(lock_notify\(SYSTEM,)798 1524 A
(proc_nr\);)378 2364 A
5265 V
(09944)210 1122 A
1440(})S
5445 V
(09946)210 1122 A
(/*===========================================================================*)3276 1440 A
5535 V
(09947)210 1122 A
1482(*)S
(cause_sig)378 2784 A
4674(*)S
5625 V
(09948)210 1122 A
(*===========================================================================*/)3276 1482 A
5715 V
(09949)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(cause_sig\(proc_nr,)756 1944 A
(sig_nr\))294 2742 A
5805 V
(09950)210 1122 A
(int)126 1440 A
(proc_nr;)336 1608 A
2784(/*)S
(process)294 2910 A
3246(to)S
3372(be)S
(signalled)378 3498 A
3918(*/)S
5895 V
(09951)210 1122 A
(int)126 1440 A
(sig_nr;)294 1608 A
2784(/*)S
(signal)252 2910 A
3204(to)S
3330(be)S
(sent,)210 3456 A
3708(1)S
3792(to)S
(_NSIG)210 3918 A
4170(*/)S
5985 V
(09952)210 1122 A
1440({)S
6075 V
(09953)210 1122 A
1440(/*)S
1566(A)S
(system)252 1650 A
(process)294 1944 A
(wants)210 2280 A
2532(to)S
(send)168 2658 A
2868(a)S
(signal)252 2952 A
3246(to)S
3372(a)S
(process.)336 3456 A
(Examples)336 3876 A
(are:)168 4254 A
6165 V
(09954)210 1122 A
1482(*)S
1608(-)S
(HARDWARE)336 1692 A
(wanting)294 2070 A
2406(to)S
(cause)210 2532 A
2784(a)S
(SIGSEGV)294 2868 A
(after)210 3204 A
3456(a)S
(CPU)126 3540 A
(exception)378 3708 A
6255 V
(09955)210 1122 A
1482(*)S
1608(-)S
(TTY)126 1692 A
(wanting)294 1860 A
2196(to)S
(cause)210 2322 A
(SIGINT)252 2574 A
(upon)168 2868 A
(getting)294 3078 A
3414(a)S
(DEL)126 3498 A
6345 V
(09956)210 1122 A
1482(*)S
1608(-)S
1692(FS)S
(wanting)294 1818 A
2154(to)S
(cause)210 2280 A
(SIGPIPE)294 2532 A
(for)126 2868 A
3036(a)S
(broken)252 3120 A
(pipe)168 3414 A
6435 V
(09957)210 1122 A
1482(*)S
(Signals)294 1566 A
(are)126 1902 A
(handled)294 2070 A
2406(by)S
(sending)294 2532 A
2868(a)S
(message)294 2952 A
3288(to)S
(PM.)126 3414 A
(This)168 3624 A
(function)336 3834 A
(handles)294 4212 A
(the)126 4548 A
6525 V
(09958)210 1122 A
1482(*)S
(signals)294 1566 A
(and)126 1902 A
(makes)210 2070 A
(sure)168 2322 A
(the)126 2532 A
2700(PM)S
(gets)168 2826 A
(them)168 3036 A
3246(by)S
(sending)294 3372 A
3708(a)S
(notification.)546 3792 A
(The)126 4380 A
6615 V
(09959)210 1122 A
1482(*)S
(process)294 1566 A
(being)210 1902 A
(signaled)336 2154 A
2532(is)S
(blocked)294 2658 A
(while)210 2994 A
3246(PM)S
(has)126 3372 A
(not)126 3540 A
(finished)336 3708 A
(all)126 4086 A
(signals)294 4254 A
6705 V
(09960)210 1122 A
1482(*)S
(for)126 1566 A
(it.)126 1734 A
6795 V
(09961)210 1122 A
1482(*)S
(Race)168 1566 A
(conditions)420 1776 A
(between)294 2238 A
(calls)210 2574 A
2826(to)S
(this)168 2952 A
(function)336 3162 A
(and)126 3540 A
(the)126 3708 A
(system)252 3876 A
(calls)210 4170 A
(that)168 4422 A
6885 V
(09962)210 1122 A
1482(*)S
(process)294 1566 A
(pending)294 1902 A
(kernel)252 2238 A
(signals)294 2532 A
(cannot)252 2868 A
(exist.)252 3162 A
(Signal)252 3456 A
(related)294 3750 A
(functions)378 4086 A
(are)126 4506 A
6975 V
(09963)210 1122 A
1482(*)S
(only)168 1566 A
(called)252 1776 A
(when)168 2070 A
2280(a)S
(user)168 2364 A
(process)294 2574 A
(causes)252 2910 A
3204(a)S
(CPU)126 3288 A
(exception)378 3456 A
(and)126 3876 A
(from)168 4044 A
(the)126 4254 A
(kernel)252 4422 A
7065 V
(09964)210 1122 A
1482(*)S
(process)294 1566 A
(level,)252 1902 A
(which)210 2196 A
(runs)168 2448 A
2658(to)S
(completion.)462 2784 A
8418 V
EP
%%Page: 122 122
BP
/slant 0 def
/height 0 def
1485 V
12 B
(122)180 1080 A
11 R
2416(File:)S
2649(kernel/system.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(09965)210 1122 A
1482(*/)S
1845 V
(09966)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*rp;)168 2406 A
1935 V
(09967)210 1122 A
2025 V
(09968)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(if)S
(the)126 2028 A
(signal)252 2196 A
2490(is)S
(already)294 2616 A
(pending.)336 2952 A
(Process)294 3330 A
3666(it)S
(otherwise.)420 3792 A
4254(*/)S
2115 V
(09969)210 1122 A
1524(rp)S
1650(=)S
(proc_addr\(proc_nr\);)798 1734 A
2205 V
(09970)210 1122 A
1524(if)S
1650(\(!)S
(sigismember\(&rp->p_pending,)1134 1776 A
(sig_nr\)\))336 2952 A
3330({)S
2295 V
(09971)210 1122 A
(sigaddset\(&rp->p_pending,)1050 1692 A
(sig_nr\);)336 2784 A
2385 V
(09972)210 1122 A
1692(if)S
1818(\(!)S
(\(rp->p_rts_flags)672 1944 A
2658(&)S
(SIGNALED\)\))420 2742 A
3204({)S
3792(/*)S
(other)210 3918 A
(pending)294 4170 A
4506(*/)S
2475 V
(09973)210 1122 A
1860(if)S
(\(rp->p_rts_flags)672 1986 A
2700(==)S
2826(0\))S
(lock_dequeue\(rp\);)714 2952 A
3792(/*)S
(make)168 3918 A
(not)126 4128 A
(ready)210 4296 A
4548(*/)S
2565 V
(09974)210 1122 A
(rp->p_rts_flags)630 1860 A
2532(|=)S
(SIGNALED)336 2658 A
3036(|)S
(SIG_PENDING;)504 3120 A
3792(/*)S
(update)252 3918 A
(flags)210 4212 A
4464(*/)S
2655 V
(09975)210 1122 A
(send_sig\(PM_PROC_NR,)840 1860 A
(SIGKSIG\);)378 2742 A
2745 V
(09976)210 1122 A
1692(})S
2835 V
(09977)210 1122 A
1524(})S
2925 V
(09978)210 1122 A
1440(})S
3105 V
(09980)210 1122 A
(/*===========================================================================*)3276 1440 A
3195 V
(09981)210 1122 A
1482(*)S
(umap_local)420 2784 A
4674(*)S
3285 V
(09982)210 1122 A
(*===========================================================================*/)3276 1482 A
3375 V
(09983)210 1122 A
(PUBLIC)252 1440 A
(phys_bytes)420 1734 A
(umap_local\(rp,)588 2196 A
(seg,)168 2826 A
(vir_addr,)378 3036 A
(bytes\))252 3456 A
3465 V
(09984)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(proc)168 2112 A
(*rp;)168 2322 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(proc)168 3372 A
(table)210 3582 A
(entry)210 3834 A
(for)126 4086 A
(process)294 4254 A
4590(*/)S
3555 V
(09985)210 1122 A
(int)126 1440 A
(seg;)168 1608 A
2784(/*)S
2910(T,)S
3036(D,)S
3162(or)S
3288(S)S
(segment)294 3372 A
3708(*/)S
3645 V
(09986)210 1122 A
(vir_bytes)378 1440 A
(vir_addr;)378 1860 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
3582(in)S
(bytes)210 3708 A
(within)252 3960 A
(the)126 4254 A
(seg)126 4422 A
4590(*/)S
3735 V
(09987)210 1122 A
(vir_bytes)378 1440 A
(bytes;)252 1860 A
2784(/*)S
2910(#)S
2994(of)S
(bytes)210 3120 A
3372(to)S
3498(be)S
(copied)252 3624 A
3918(*/)S
3825 V
(09988)210 1122 A
1440({)S
3915 V
(09989)210 1122 A
1440(/*)S
(Calculate)378 1566 A
(the)126 1986 A
(physical)336 2154 A
(memory)252 2532 A
(address)294 2826 A
(for)126 3162 A
3330(a)S
(given)210 3414 A
(virtual)294 3666 A
(address.)336 4002 A
4380(*/)S
4005 V
(09990)210 1122 A
(vir_clicks)420 1524 A
(vc;)126 1986 A
2784(/*)S
(the)126 2910 A
(virtual)294 3078 A
(address)294 3414 A
3750(in)S
(clicks)252 3876 A
4170(*/)S
4095 V
(09991)210 1122 A
(phys_bytes)420 1524 A
(pa;)126 1986 A
2784(/*)S
(intermediate)504 2910 A
(variables)378 3456 A
3876(as)S
(phys_bytes)420 4002 A
4464(*/)S
4185 V
(09992)210 1122 A
(phys_bytes)420 1524 A
(seg_base;)378 1986 A
4275 V
(09993)210 1122 A
4365 V
(09994)210 1122 A
1524(/*)S
1650(If)S
('seg')210 1776 A
2028(is)S
2154(D)S
2238(it)S
(could)210 2364 A
(really)252 2616 A
2910(be)S
3036(S)S
(and)126 3120 A
(vice)168 3288 A
(versa.)252 3498 A
3834(T)S
(really)252 3918 A
(means)210 4212 A
4464(T.)S
4455 V
(09995)210 1122 A
1566(*)S
1650(If)S
(the)126 1776 A
(virtual)294 1944 A
(address)294 2280 A
(falls)210 2616 A
2868(in)S
(the)126 2994 A
(gap,)168 3162 A
3414(it)S
(causes)252 3540 A
3834(a)S
(problem.)336 3918 A
4296(On)S
(the)126 4422 A
4545 V
(09996)210 1122 A
1566(*)S
(8088)168 1650 A
1860(it)S
1986(is)S
(probably)336 2112 A
2490(a)S
(legal)210 2574 A
(stack)210 2826 A
(reference,)420 3078 A
(since)210 3540 A
("stackfaults")546 3792 A
(are)126 4380 A
4635 V
(09997)210 1122 A
1566(*)S
(not)126 1650 A
(detected)336 1818 A
2196(by)S
(the)126 2322 A
(hardware.)378 2490 A
2952(On)S
(8088s,)252 3078 A
(the)126 3372 A
(gap)126 3540 A
3708(is)S
(called)252 3834 A
4128(S)S
(and)126 4212 A
4725 V
(09998)210 1122 A
1566(*)S
(accepted,)378 1650 A
(but)126 2070 A
2238(on)S
(other)210 2364 A
(machines)336 2616 A
2994(it)S
3120(is)S
(called)252 3246 A
3540(D)S
(and)126 3624 A
(rejected.)378 3792 A
4815 V
(09999)210 1122 A
1566(*)S
(The)126 1650 A
(Atari)210 1818 A
2070(ST)S
(behaves)294 2196 A
(like)168 2532 A
(the)126 2742 A
(8088)168 2910 A
3120(in)S
(this)168 3246 A
(respect.)336 3456 A
4905 V
(10000)210 1122 A
1566(*/)S
4995 V
(10001)210 1122 A
5085 V
(10002)210 1122 A
1524(if)S
(\(bytes)252 1650 A
1944(<=)S
2070(0\))S
(return\()294 2196 A
(\(phys_bytes\))504 2532 A
(0\);)126 3078 A
5175 V
(10003)210 1122 A
1524(if)S
(\(vir_addr)378 1650 A
2070(+)S
(bytes)210 2154 A
2406(<=)S
(vir_addr\))378 2532 A
(return)252 2952 A
3246(0;)S
3456(/*)S
(overflow)336 3582 A
3960(*/)S
5265 V
(10004)210 1122 A
1524(vc)S
1650(=)S
(\(vir_addr)378 1734 A
2154(+)S
(bytes)210 2238 A
2490(-)S
2574(1\))S
2700(>>)S
(CLICK_SHIFT;)504 2826 A
3456(/*)S
(last)168 3582 A
(click)210 3792 A
4044(of)S
(data)168 4170 A
4380(*/)S
5355 V
(10005)210 1122 A
5445 V
(10006)210 1122 A
1524(if)S
(\(seg)168 1650 A
1860(!=)S
1986(T\))S
5535 V
(10007)210 1122 A
(seg)126 1776 A
1944(=)S
(\(vc)126 2028 A
2196(<)S
(rp->p_memmap[D].mem_vir)966 2280 A
3288(+)S
(rp->p_memmap[D].mem_len)966 3372 A
4380(?)S
4464(D)S
4548(:)S
(S\);)126 4632 A
5625 V
(10008)210 1122 A
5715 V
(10009)210 1122 A
1524(if)S
(\(\(vir_addr>>CLICK_SHIFT\))1008 1650 A
2700(>=)S
(rp->p_memmap[seg].mem_vir)1050 2826 A
3918(+)S
5805 V
(10010)210 1122 A
(rp->p_memmap[seg].mem_len\))1092 1776 A
(return\()294 2910 A
(\(phys_bytes\))504 3246 A
3792(0)S
3876(\);)S
5895 V
(10011)210 1122 A
5985 V
(10012)210 1122 A
1524(if)S
(\(vc)126 1650 A
1818(>=)S
(rp->p_memmap[seg].mem_vir)1050 1944 A
3036(+)S
6075 V
(10013)210 1122 A
(rp->p_memmap[seg].mem_len\))1092 1776 A
(return\()294 2910 A
(\(phys_bytes\))504 3246 A
3792(0)S
3876(\);)S
6165 V
(10014)210 1122 A
6255 V
(10015)210 1122 A
(seg_base)336 1524 A
1902(=)S
(\(phys_bytes\))504 1986 A
(rp->p_memmap[seg].mem_phys;)1134 2532 A
6345 V
(10016)210 1122 A
(seg_base)336 1524 A
1902(=)S
(seg_base)336 1986 A
2364(<<)S
(CLICK_SHIFT;)504 2490 A
3120(/*)S
(segment)294 3246 A
(origin)252 3582 A
3876(in)S
(bytes)210 4002 A
4254(*/)S
6435 V
(10017)210 1122 A
1524(pa)S
1650(=)S
(\(phys_bytes\))504 1734 A
(vir_addr;)378 2280 A
6525 V
(10018)210 1122 A
1524(pa)S
1650(-=)S
(rp->p_memmap[seg].mem_vir)1050 1776 A
2868(<<)S
(CLICK_SHIFT;)504 2994 A
6615 V
(10019)210 1122 A
(return\(seg_base)630 1524 A
2196(+)S
(pa\);)168 2280 A
6705 V
(10020)210 1122 A
1440(})S
8418 V
EP
%%Page: 123 123
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2416(File:)S
2649(kernel/system.c)S
12 B
(123)180 4500 A
1755 V
7 LST
(10022)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(10023)210 1122 A
1482(*)S
(umap_remote)462 2784 A
4674(*)S
1935 V
(10024)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(10025)210 1122 A
(PUBLIC)252 1440 A
(phys_bytes)420 1734 A
(umap_remote\(rp,)630 2196 A
(seg,)168 2868 A
(vir_addr,)378 3078 A
(bytes\))252 3498 A
2115 V
(10026)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(proc)168 2112 A
(*rp;)168 2322 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(proc)168 3372 A
(table)210 3582 A
(entry)210 3834 A
(for)126 4086 A
(process)294 4254 A
4590(*/)S
2205 V
(10027)210 1122 A
(int)126 1440 A
(seg;)168 1608 A
2784(/*)S
(index)210 2910 A
3162(of)S
(remote)252 3288 A
(segment)294 3582 A
3918(*/)S
2295 V
(10028)210 1122 A
(vir_bytes)378 1440 A
(vir_addr;)378 1860 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
3582(in)S
(bytes)210 3708 A
(within)252 3960 A
(the)126 4254 A
(seg)126 4422 A
4590(*/)S
2385 V
(10029)210 1122 A
(vir_bytes)378 1440 A
(bytes;)252 1860 A
2784(/*)S
2910(#)S
2994(of)S
(bytes)210 3120 A
3372(to)S
3498(be)S
(copied)252 3624 A
3918(*/)S
2475 V
(10030)210 1122 A
1440({)S
2565 V
(10031)210 1122 A
1440(/*)S
(Calculate)378 1566 A
(the)126 1986 A
(physical)336 2154 A
(memory)252 2532 A
(address)294 2826 A
(for)126 3162 A
3330(a)S
(given)210 3414 A
(virtual)294 3666 A
(address.)336 4002 A
4380(*/)S
2655 V
(10032)210 1122 A
(struct)252 1524 A
(far_mem)294 1818 A
(*fm;)168 2154 A
2745 V
(10033)210 1122 A
2835 V
(10034)210 1122 A
1524(if)S
(\(bytes)252 1650 A
1944(<=)S
2070(0\))S
(return\()294 2196 A
(\(phys_bytes\))504 2532 A
(0\);)126 3078 A
2925 V
(10035)210 1122 A
1524(if)S
(\(seg)168 1650 A
1860(<)S
1944(0)S
2028(||)S
(seg)126 2154 A
2322(>=)S
(NR_REMOTE_SEGS\))630 2448 A
(return\()294 3120 A
(\(phys_bytes\))504 3456 A
(0\);)126 4002 A
3015 V
(10036)210 1122 A
3105 V
(10037)210 1122 A
1524(fm)S
1650(=)S
(&rp->p_priv->s_farmem[seg];)1134 1734 A
3195 V
(10038)210 1122 A
1524(if)S
1650(\(!)S
(fm->in_use\))462 1776 A
(return\()294 2280 A
(\(phys_bytes\))504 2616 A
(0\);)126 3162 A
3285 V
(10039)210 1122 A
1524(if)S
(\(vir_addr)378 1650 A
2070(+)S
(bytes)210 2154 A
2406(>)S
(fm->mem_len\))504 2490 A
(return\()294 3036 A
(\(phys_bytes\))504 3372 A
(0\);)126 3918 A
3375 V
(10040)210 1122 A
3465 V
(10041)210 1122 A
(return\(fm->mem_phys)798 1524 A
2364(+)S
(\(phys_bytes\))504 2448 A
(vir_addr\);)420 2994 A
3555 V
(10042)210 1122 A
1440(})S
3735 V
(10044)210 1122 A
(/*===========================================================================*)3276 1440 A
3825 V
(10045)210 1122 A
1482(*)S
(umap_bios)378 2784 A
4674(*)S
3915 V
(10046)210 1122 A
(*===========================================================================*/)3276 1482 A
4005 V
(10047)210 1122 A
(PUBLIC)252 1440 A
(phys_bytes)420 1734 A
(umap_bios\(rp,)546 2196 A
(vir_addr,)378 2784 A
(bytes\))252 3204 A
4095 V
(10048)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(proc)168 2112 A
(*rp;)168 2322 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(proc)168 3372 A
(table)210 3582 A
(entry)210 3834 A
(for)126 4086 A
(process)294 4254 A
4590(*/)S
4185 V
(10049)210 1122 A
(vir_bytes)378 1440 A
(vir_addr;)378 1860 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
3582(in)S
(BIOS)168 3708 A
(segment)294 3918 A
4254(*/)S
4275 V
(10050)210 1122 A
(vir_bytes)378 1440 A
(bytes;)252 1860 A
2784(/*)S
2910(#)S
2994(of)S
(bytes)210 3120 A
3372(to)S
3498(be)S
(copied)252 3624 A
3918(*/)S
4365 V
(10051)210 1122 A
1440({)S
4455 V
(10052)210 1122 A
1440(/*)S
(Calculate)378 1566 A
(the)126 1986 A
(physical)336 2154 A
(memory)252 2532 A
(address)294 2826 A
3162(at)S
(the)126 3288 A
(BIOS.)210 3456 A
(Note:)210 3708 A
(currently,)420 3960 A
(BIOS)168 4422 A
4545 V
(10053)210 1122 A
1482(*)S
(address)294 1566 A
(zero)168 1902 A
(\(the)168 2112 A
(first)210 2322 A
(BIOS)168 2574 A
(interrupt)378 2784 A
(vector\))294 3204 A
3540(is)S
(not)126 3666 A
(considered)420 3834 A
4296(as)S
4422(an)S
4635 V
(10054)210 1122 A
1482(*)S
(error)210 1566 A
(here,)210 1818 A
(but)126 2070 A
(since)210 2238 A
(the)126 2490 A
(physical)336 2658 A
(address)294 3036 A
(will)168 3372 A
3582(be)S
(zero)168 3708 A
3918(as)S
(well,)210 4044 A
(the)126 4296 A
4725 V
(10055)210 1122 A
1482(*)S
(calling)294 1566 A
(function)336 1902 A
(will)168 2280 A
(think)210 2490 A
2742(an)S
(error)210 2868 A
(occurred.)378 3120 A
(This)168 3540 A
3750(is)S
(not)126 3876 A
4044(a)S
(problem,)336 4128 A
4815 V
(10056)210 1122 A
1482(*)S
(since)210 1566 A
1818(no)S
(one)126 1944 A
(uses)168 2112 A
(the)126 2322 A
(first)210 2490 A
(BIOS)168 2742 A
(interrupt)378 2952 A
(vector.)294 3372 A
4905 V
(10057)210 1122 A
1482(*/)S
4995 V
(10058)210 1122 A
5085 V
(10059)210 1122 A
1524(/*)S
(Check)210 1650 A
(all)126 1902 A
(acceptable)420 2070 A
(ranges.)294 2532 A
2868(*/)S
5175 V
(10060)210 1122 A
1524(if)S
(\(vir_addr)378 1650 A
2070(>=)S
(BIOS_MEM_BEGIN)588 2196 A
2826(&&)S
(vir_addr)336 2952 A
3330(+)S
(bytes)210 3414 A
3666(<=)S
(BIOS_MEM_END\))546 3792 A
5265 V
(10061)210 1122 A
(return)252 1776 A
(\(phys_bytes\))504 2070 A
(vir_addr;)378 2616 A
5355 V
(10062)210 1122 A
(else)168 1524 A
1734(if)S
(\(vir_addr)378 1860 A
2280(>=)S
(BASE_MEM_TOP)504 2406 A
2952(&&)S
(vir_addr)336 3078 A
3456(+)S
(bytes)210 3540 A
3792(<=)S
(UPPER_MEM_END\))588 3918 A
5445 V
(10063)210 1122 A
(return)252 1776 A
(\(phys_bytes\))504 2070 A
(vir_addr;)378 2616 A
5535 V
(10064)210 1122 A
(kprintf\("Warning,)714 1524 A
(error)210 2280 A
2532(in)S
(umap_bios,)420 2658 A
(virtual)294 3120 A
(address)294 3456 A
(0x%x\\n",)336 3792 A
(vir_addr\);)420 4170 A
5625 V
(10065)210 1122 A
(return)252 1524 A
1818(0;)S
5715 V
(10066)210 1122 A
1440(})S
5895 V
(10068)210 1122 A
(/*===========================================================================*)3276 1440 A
5985 V
(10069)210 1122 A
1482(*)S
(virtual_copy)504 2784 A
4674(*)S
6075 V
(10070)210 1122 A
(*===========================================================================*/)3276 1482 A
6165 V
(10071)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(virtual_copy\(src_addr,)924 1902 A
(dst_addr,)378 2868 A
(bytes\))252 3288 A
6255 V
(10072)210 1122 A
(struct)252 1440 A
(vir_addr)336 1734 A
(*src_addr;)420 2112 A
2784(/*)S
(source)252 2910 A
(virtual)294 3204 A
(address)294 3540 A
3876(*/)S
6345 V
(10073)210 1122 A
(struct)252 1440 A
(vir_addr)336 1734 A
(*dst_addr;)420 2112 A
2784(/*)S
(destination)462 2910 A
(virtual)294 3414 A
(address)294 3750 A
4086(*/)S
6435 V
(10074)210 1122 A
(vir_bytes)378 1440 A
(bytes;)252 1860 A
2784(/*)S
2910(#)S
2994(of)S
(bytes)210 3120 A
3372(to)S
(copy)168 3498 A
3750(*/)S
6525 V
(10075)210 1122 A
1440({)S
6615 V
(10076)210 1122 A
1440(/*)S
(Copy)168 1566 A
(bytes)210 1776 A
(from)168 2028 A
(virtual)294 2238 A
(address)294 2574 A
(src_addr)336 2910 A
3288(to)S
(virtual)294 3414 A
(address)294 3750 A
(dst_addr.)378 4086 A
6705 V
(10077)210 1122 A
1482(*)S
(Virtual)294 1566 A
(addresses)378 1902 A
(can)126 2322 A
2490(be)S
2616(in)S
(ABS,)168 2742 A
(LOCAL_SEG,)420 2952 A
(REMOTE_SEG,)462 3414 A
3918(or)S
(BIOS_SEG.)378 4044 A
6795 V
(10078)210 1122 A
1482(*/)S
6885 V
(10079)210 1122 A
(struct)252 1524 A
(vir_addr)336 1818 A
(*vir_addr[2];)546 2196 A
2784(/*)S
(virtual)294 2910 A
(source)252 3246 A
(and)126 3540 A
(destination)462 3708 A
(address)294 4212 A
4548(*/)S
6975 V
(10080)210 1122 A
(phys_bytes)420 1524 A
(phys_addr[2];)546 1986 A
2784(/*)S
(absolute)336 2910 A
(source)252 3288 A
(and)126 3582 A
(destination)462 3750 A
4254(*/)S
7065 V
(10081)210 1122 A
(int)126 1524 A
(seg_index;)420 1692 A
8418 V
EP
%%Page: 124 124
BP
/slant 0 def
/height 0 def
1485 V
12 B
(124)180 1080 A
11 R
2416(File:)S
2649(kernel/system.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(10082)210 1122 A
(int)126 1524 A
1692(i;)S
1845 V
(10083)210 1122 A
1935 V
(10084)210 1122 A
1524(/*)S
(Check)210 1650 A
(copy)168 1902 A
(count.)252 2112 A
2406(*/)S
2025 V
(10085)210 1122 A
1524(if)S
(\(bytes)252 1650 A
1944(<=)S
2070(0\))S
(return\(EDOM\);)546 2196 A
2115 V
(10086)210 1122 A
2205 V
(10087)210 1122 A
1524(/*)S
1650(Do)S
(some)168 1776 A
(more)168 1986 A
(checks)252 2196 A
(and)126 2490 A
(map)126 2658 A
(virtual)294 2826 A
(addresses)378 3162 A
3582(to)S
(physical)336 3708 A
(addresses.)420 4086 A
4548(*/)S
2295 V
(10088)210 1122 A
(vir_addr[_SRC_])630 1524 A
2196(=)S
(src_addr;)378 2280 A
2385 V
(10089)210 1122 A
(vir_addr[_DST_])630 1524 A
2196(=)S
(dst_addr;)378 2280 A
2475 V
(10090)210 1122 A
(for)126 1524 A
(\(i=_SRC_;)378 1692 A
(i<=_DST_;)378 2112 A
(i++\))168 2532 A
2742({)S
2565 V
(10091)210 1122 A
2655 V
(10092)210 1122 A
1692(/*)S
(Get)126 1818 A
(physical)336 1986 A
(address.)336 2364 A
2742(*/)S
2745 V
(10093)210 1122 A
(switch\(\(vir_addr[i]->segment)1176 1692 A
2910(&)S
(SEGMENT_TYPE\)\))588 2994 A
3624({)S
2835 V
(10094)210 1122 A
(case)168 1692 A
(LOCAL_SEG:)420 1902 A
2925 V
(10095)210 1122 A
(seg_index)378 1860 A
2280(=)S
(vir_addr[i]->segment)840 2364 A
3246(&)S
(SEGMENT_INDEX;)588 3330 A
3015 V
(10096)210 1122 A
(phys_addr[i])504 1860 A
2406(=)S
(umap_local\()462 2490 A
(proc_addr\(vir_addr[i]->proc_nr\),)1344 2994 A
3105 V
(10097)210 1122 A
(seg_index,)420 2028 A
(vir_addr[i]->offset,)840 2490 A
(bytes)210 3372 A
3624(\);)S
3195 V
(10098)210 1122 A
(break;)252 1860 A
3285 V
(10099)210 1122 A
(case)168 1692 A
(REMOTE_SEG:)462 1902 A
3375 V
(10100)210 1122 A
(seg_index)378 1860 A
2280(=)S
(vir_addr[i]->segment)840 2364 A
3246(&)S
(SEGMENT_INDEX;)588 3330 A
3465 V
(10101)210 1122 A
(phys_addr[i])504 1860 A
2406(=)S
(umap_remote\()504 2490 A
(proc_addr\(vir_addr[i]->proc_nr\),)1344 3036 A
3555 V
(10102)210 1122 A
(seg_index,)420 2028 A
(vir_addr[i]->offset,)840 2490 A
(bytes)210 3372 A
3624(\);)S
3645 V
(10103)210 1122 A
(break;)252 1860 A
3735 V
(10104)210 1122 A
(case)168 1692 A
(BIOS_SEG:)378 1902 A
3825 V
(10105)210 1122 A
(phys_addr[i])504 1860 A
2406(=)S
(umap_bios\()420 2490 A
(proc_addr\(vir_addr[i]->proc_nr\),)1344 2952 A
3915 V
(10106)210 1122 A
(vir_addr[i]->offset,)840 2028 A
(bytes)210 2910 A
3162(\);)S
4005 V
(10107)210 1122 A
(break;)252 1860 A
4095 V
(10108)210 1122 A
(case)168 1692 A
(PHYS_SEG:)378 1902 A
4185 V
(10109)210 1122 A
(phys_addr[i])504 1860 A
2406(=)S
(vir_addr[i]->offset;)840 2490 A
4275 V
(10110)210 1122 A
(break;)252 1860 A
4365 V
(10111)210 1122 A
(default:)336 1692 A
4455 V
(10112)210 1122 A
(return\(EINVAL\);)630 1860 A
4545 V
(10113)210 1122 A
1692(})S
4635 V
(10114)210 1122 A
4725 V
(10115)210 1122 A
1692(/*)S
(Check)210 1818 A
2070(if)S
(mapping)294 2196 A
(succeeded.)420 2532 A
2994(*/)S
4815 V
(10116)210 1122 A
1692(if)S
(\(phys_addr[i])546 1818 A
2406(<=)S
2532(0)S
2616(&&)S
(vir_addr[i]->segment)840 2742 A
3624(!=)S
(PHYS_SEG\))378 3750 A
4905 V
(10117)210 1122 A
(return\(EFAULT\);)630 1860 A
4995 V
(10118)210 1122 A
1524(})S
5085 V
(10119)210 1122 A
5175 V
(10120)210 1122 A
1524(/*)S
(Now)126 1650 A
(copy)168 1818 A
(bytes)210 2028 A
(between)294 2280 A
(physical)336 2616 A
(addresseses.)504 2994 A
3540(*/)S
5265 V
(10121)210 1122 A
(phys_copy\(phys_addr[_SRC_],)1134 1524 A
(phys_addr[_DST_],)714 2700 A
(\(phys_bytes\))504 3456 A
(bytes\);)294 4002 A
5355 V
(10122)210 1122 A
(return\(OK\);)462 1524 A
5445 V
(10123)210 1122 A
1440(})S
5895 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5985 V
(kernel/system/do_setalarm.c)1134 2676 A
6075 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6255 V
(10200)210 1122 A
1440(/*)S
(The)126 1566 A
(kernel)252 1734 A
(call)168 2028 A
(implemented)462 2238 A
2742(in)S
(this)168 2868 A
(file:)210 3078 A
6345 V
(10201)210 1122 A
1482(*)S
(m_type:)294 1650 A
(SYS_SETALARM)504 2112 A
6435 V
(10202)210 1122 A
1482(*)S
6525 V
(10203)210 1122 A
1482(*)S
(The)126 1566 A
(parameters)420 1734 A
(for)126 2196 A
(this)168 2364 A
(kernel)252 2574 A
(call)168 2868 A
(are:)168 3078 A
6615 V
(10204)210 1122 A
1482(*)S
(m2_l1:)252 1692 A
(ALRM_EXP_TIME)546 2112 A
(\(alarm's)336 3120 A
(expiration)420 3498 A
(time\))210 3960 A
6705 V
(10205)210 1122 A
1482(*)S
(m2_i2:)252 1692 A
(ALRM_ABS_TIME)546 2112 A
(\(expiration)462 3120 A
(time)168 3624 A
3834(is)S
(absolute?\))420 3960 A
6795 V
(10206)210 1122 A
1482(*)S
(m2_l1:)252 1692 A
(ALRM_TIME_LEFT)588 2112 A
(\(return)294 3120 A
(seconds)294 3456 A
(left)168 3792 A
4002(of)S
(previous\))378 4128 A
6885 V
(10207)210 1122 A
1482(*/)S
6975 V
(10208)210 1122 A
7065 V
(10209)210 1122 A
(#include)336 1440 A
("../system.h")546 1818 A
8418 V
EP
%%Page: 125 125
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2129(File:)S
(kernel/system/do_setalarm.c)1269 2362 A
12 B
(125)180 4500 A
1755 V
7 LST
(10210)210 1122 A
1845 V
(10211)210 1122 A
(#if)126 1440 A
(USE_SETALARM)504 1608 A
1935 V
(10212)210 1122 A
2025 V
(10213)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(cause_alarm,)504 2490 A
(\(timer_t)336 3036 A
(*tp\))168 3414 A
3624(\);)S
2115 V
(10214)210 1122 A
2205 V
(10215)210 1122 A
(/*===========================================================================*)3276 1440 A
2295 V
(10216)210 1122 A
1482(*)S
(do_setalarm)462 2784 A
4674(*)S
2385 V
(10217)210 1122 A
(*===========================================================================*/)3276 1482 A
2475 V
(10218)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_setalarm\(m_ptr\))756 1902 A
2565 V
(10219)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(request)294 3372 A
(message)294 3708 A
4044(*/)S
2655 V
(10220)210 1122 A
1440({)S
2745 V
(10221)210 1122 A
1440(/*)S
1566(A)S
(process)294 1650 A
(requests)336 1986 A
2364(a)S
(synchronous)462 2448 A
(alarm,)252 2952 A
3246(or)S
(wants)210 3372 A
3624(to)S
(cancel)252 3750 A
(its)126 4044 A
(alarm.)252 4212 A
4506(*/)S
2835 V
(10222)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*rp;)168 2406 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(requesting)420 3372 A
(process)294 3834 A
4170(*/)S
2925 V
(10223)210 1122 A
(int)126 1524 A
(proc_nr;)336 1692 A
2784(/*)S
(which)210 2910 A
(process)294 3162 A
(wants)210 3498 A
(the)126 3750 A
(alarm)210 3918 A
4170(*/)S
3015 V
(10224)210 1122 A
(long)168 1524 A
(exp_time;)378 1734 A
2784(/*)S
(expiration)420 2910 A
(time)168 3372 A
(for)126 3582 A
(this)168 3750 A
(alarm)210 3960 A
4212(*/)S
3105 V
(10225)210 1122 A
(int)126 1524 A
(use_abs_time;)546 1692 A
2784(/*)S
(use)126 2910 A
(absolute)336 3078 A
3456(or)S
(relative)336 3582 A
(time)168 3960 A
4170(*/)S
3195 V
(10226)210 1122 A
(timer_t)294 1524 A
(*tp;)168 1860 A
2784(/*)S
(the)126 2910 A
(process')336 3078 A
(timer)210 3456 A
(structure)378 3708 A
4128(*/)S
3285 V
(10227)210 1122 A
(clock_t)294 1524 A
(uptime;)294 1860 A
2784(/*)S
(placeholder)462 2910 A
(for)126 3414 A
(current)294 3582 A
(uptime)252 3918 A
4212(*/)S
3375 V
(10228)210 1122 A
3465 V
(10229)210 1122 A
1524(/*)S
(Extract)294 1650 A
(shared)252 1986 A
(parameters)420 2280 A
(from)168 2742 A
(the)126 2952 A
(request)294 3120 A
(message.)336 3456 A
3834(*/)S
3555 V
(10230)210 1122 A
(exp_time)336 1524 A
1902(=)S
(m_ptr->ALRM_EXP_TIME;)882 1986 A
3120(/*)S
(alarm's)294 3246 A
(expiration)420 3582 A
(time)168 4044 A
4254(*/)S
3645 V
(10231)210 1122 A
(use_abs_time)504 1524 A
2070(=)S
(m_ptr->ALRM_ABS_TIME;)882 2154 A
3120(/*)S
(flag)168 3246 A
(for)126 3456 A
(absolute)336 3624 A
(time)168 4002 A
4212(*/)S
3735 V
(10232)210 1122 A
(proc_nr)294 1524 A
1860(=)S
(m_ptr->m_source;)672 1944 A
3120(/*)S
(process)294 3246 A
3582(to)S
(interrupt)378 3708 A
(later)210 4128 A
4380(*/)S
3825 V
(10233)210 1122 A
1524(rp)S
1650(=)S
(proc_addr\(proc_nr\);)798 1734 A
3915 V
(10234)210 1122 A
1524(if)S
1650(\(!)S
(\(priv\(rp\)->s_flags)756 1776 A
2574(&)S
(SYS_PROC\)\))420 2658 A
(return\(EPERM\);)588 3120 A
4005 V
(10235)210 1122 A
4095 V
(10236)210 1122 A
1524(/*)S
(Get)126 1650 A
(the)126 1818 A
(timer)210 1986 A
(structure)378 2238 A
(and)126 2658 A
(set)126 2826 A
(the)126 2994 A
(parameters)420 3162 A
(for)126 3624 A
(this)168 3792 A
(alarm.)252 4002 A
4296(*/)S
4185 V
(10237)210 1122 A
1524(tp)S
1650(=)S
(&\(priv\(rp\)->s_alarm_timer\);)1134 1734 A
4275 V
(10238)210 1122 A
(tmr_arg\(tp\)->ta_int)798 1524 A
2364(=)S
(proc_nr;)336 2448 A
4365 V
(10239)210 1122 A
(tp->tmr_func)504 1524 A
2070(=)S
(cause_alarm;)504 2154 A
4455 V
(10240)210 1122 A
4545 V
(10241)210 1122 A
1524(/*)S
(Return)252 1650 A
(the)126 1944 A
(ticks)210 2112 A
(left)168 2364 A
2574(on)S
(the)126 2700 A
(previous)336 2868 A
(alarm.)252 3246 A
3540(*/)S
4635 V
(10242)210 1122 A
(uptime)252 1524 A
1818(=)S
(get_uptime\(\);)546 1902 A
4725 V
(10243)210 1122 A
1524(if)S
(\(\(tp->tmr_exp_time)756 1650 A
2448(!=)S
(TMR_NEVER\))420 2574 A
3036(&&)S
(\(uptime)294 3162 A
3498(<)S
(tp->tmr_exp_time\))714 3582 A
4338(\))S
4422({)S
4815 V
(10244)210 1122 A
(m_ptr->ALRM_TIME_LEFT)882 1692 A
2616(=)S
(\(tp->tmr_exp_time)714 2700 A
3456(-)S
(uptime\);)336 3540 A
4905 V
(10245)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
4995 V
(10246)210 1122 A
(m_ptr->ALRM_TIME_LEFT)882 1692 A
2616(=)S
2700(0;)S
5085 V
(10247)210 1122 A
1524(})S
5175 V
(10248)210 1122 A
5265 V
(10249)210 1122 A
1524(/*)S
(Finally,)336 1650 A
(\(re\)set)294 2028 A
(the)126 2364 A
(timer)210 2532 A
(depending)378 2784 A
3204(on)S
(the)126 3330 A
(expiration)420 3498 A
(time.)210 3960 A
4212(*/)S
5355 V
(10250)210 1122 A
1524(if)S
(\(exp_time)378 1650 A
2070(==)S
2196(0\))S
2322({)S
5445 V
(10251)210 1122 A
(reset_timer\(tp\);)672 1692 A
5535 V
(10252)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
5625 V
(10253)210 1122 A
(tp->tmr_exp_time)672 1692 A
2406(=)S
(\(use_abs_time\))588 2490 A
3120(?)S
(exp_time)336 3204 A
3582(:)S
(exp_time)336 3666 A
4044(+)S
(get_uptime\(\);)546 4128 A
5715 V
(10254)210 1122 A
(set_timer\(tp,)546 1692 A
(tp->tmr_exp_time,)714 2280 A
(tp->tmr_func\);)588 3036 A
5805 V
(10255)210 1122 A
1524(})S
5895 V
(10256)210 1122 A
(return\(OK\);)462 1524 A
5985 V
(10257)210 1122 A
1440(})S
6165 V
(10259)210 1122 A
(/*===========================================================================*)3276 1440 A
6255 V
(10260)210 1122 A
1482(*)S
(cause_alarm)462 2784 A
4674(*)S
6345 V
(10261)210 1122 A
(*===========================================================================*/)3276 1482 A
6435 V
(10262)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(cause_alarm\(tp\))630 1986 A
6525 V
(10263)210 1122 A
(timer_t)294 1440 A
(*tp;)168 1776 A
6615 V
(10264)210 1122 A
1440({)S
6705 V
(10265)210 1122 A
1440(/*)S
(Routine)294 1566 A
(called)252 1902 A
2196(if)S
2322(a)S
(timer)210 2406 A
(goes)168 2658 A
(off)126 2868 A
(and)126 3036 A
(the)126 3204 A
(process)294 3372 A
(requested)378 3708 A
4128(a)S
(synchronous)462 4212 A
6795 V
(10266)210 1122 A
1482(*)S
(alarm.)252 1566 A
(The)126 1860 A
(process)294 2028 A
(number)252 2364 A
2658(is)S
(stored)252 2784 A
3078(in)S
(timer)210 3204 A
(argument)336 3456 A
('ta_int'.)378 3834 A
(Notify)252 4254 A
(that)168 4548 A
6885 V
(10267)210 1122 A
1482(*)S
(process)294 1566 A
(with)168 1902 A
2112(a)S
(notification)504 2196 A
(message)294 2742 A
(from)168 3078 A
(CLOCK.)252 3288 A
6975 V
(10268)210 1122 A
1482(*/)S
7065 V
(10269)210 1122 A
(int)126 1524 A
(proc_nr)294 1692 A
2028(=)S
(tmr_arg\(tp\)->ta_int;)840 2112 A
3456(/*)S
(get)126 3582 A
(process)294 3750 A
(number)252 4086 A
4380(*/)S
8418 V
EP
%%Page: 126 126
BP
/slant 0 def
/height 0 def
1485 V
12 B
(126)180 1080 A
11 R
2129(File:)S
(kernel/system/do_setalarm.c)1269 2362 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(10270)210 1122 A
(lock_notify\(CLOCK,)756 1524 A
(proc_nr\);)378 2322 A
3456(/*)S
(notify)252 3582 A
(process)294 3876 A
4212(*/)S
1845 V
(10271)210 1122 A
1440(})S
2025 V
(10273)210 1122 A
(#endif)252 1440 A
1734(/*)S
(USE_SETALARM)504 1860 A
2406(*/)S
2295 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2385 V
(kernel/system/do_exec.c)966 2676 A
2475 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2655 V
(10300)210 1122 A
1440(/*)S
(The)126 1566 A
(kernel)252 1734 A
(call)168 2028 A
(implemented)462 2238 A
2742(in)S
(this)168 2868 A
(file:)210 3078 A
2745 V
(10301)210 1122 A
1482(*)S
(m_type:)294 1650 A
(SYS_EXEC)336 2112 A
2835 V
(10302)210 1122 A
1482(*)S
2925 V
(10303)210 1122 A
1482(*)S
(The)126 1566 A
(parameters)420 1734 A
(for)126 2196 A
(this)168 2364 A
(kernel)252 2574 A
(call)168 2868 A
(are:)168 3078 A
3015 V
(10304)210 1122 A
1482(*)S
(m1_i1:)252 1692 A
(PR_PROC_NR)420 2112 A
(\(process)336 3120 A
(that)168 3498 A
(did)126 3708 A
(exec)168 3876 A
(call\))210 4086 A
3105 V
(10305)210 1122 A
1482(*)S
(m1_p1:)252 1692 A
(PR_STACK_PTR)504 2112 A
(\(new)168 3120 A
(stack)210 3330 A
(pointer\))336 3582 A
3195 V
(10306)210 1122 A
1482(*)S
(m1_p2:)252 1692 A
(PR_NAME_PTR)462 2112 A
(\(pointer)336 3120 A
3498(to)S
(program)294 3624 A
(name\))210 3960 A
3285 V
(10307)210 1122 A
1482(*)S
(m1_p3:)252 1692 A
(PR_IP_PTR)378 2112 A
(\(new)168 3120 A
(instruction)462 3330 A
(pointer\))336 3834 A
3375 V
(10308)210 1122 A
1482(*/)S
3465 V
(10309)210 1122 A
(#include)336 1440 A
("../system.h")546 1818 A
3555 V
(10310)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
3645 V
(10311)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
3735 V
(10312)210 1122 A
3825 V
(10313)210 1122 A
(#if)126 1440 A
(USE_EXEC)336 1608 A
3915 V
(10314)210 1122 A
4005 V
(10315)210 1122 A
(/*===========================================================================*)3276 1440 A
4095 V
(10316)210 1122 A
1482(*)S
(do_exec)294 2784 A
4674(*)S
4185 V
(10317)210 1122 A
(*===========================================================================*/)3276 1482 A
4275 V
(10318)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_exec\(m_ptr\))588 1902 A
4365 V
(10319)210 1122 A
(register)336 1440 A
(message)294 1818 A
(*m_ptr;)294 2154 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(request)294 3372 A
(message)294 3708 A
4044(*/)S
4455 V
(10320)210 1122 A
1440({)S
4545 V
(10321)210 1122 A
1440(/*)S
(Handle)252 1566 A
(sys_exec\(\).)462 1860 A
2406(A)S
(process)294 2490 A
(has)126 2826 A
(done)168 2994 A
3204(a)S
(successful)420 3288 A
(EXEC.)210 3750 A
(Patch)210 4002 A
4254(it)S
(up.)126 4380 A
4548(*/)S
4635 V
(10322)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*rp;)168 2406 A
4725 V
(10323)210 1122 A
(reg_t)210 1524 A
(sp;)126 1776 A
2784(/*)S
(new)126 2910 A
3078(sp)S
3204(*/)S
4815 V
(10324)210 1122 A
(phys_bytes)420 1524 A
(phys_name;)420 1986 A
4905 V
(10325)210 1122 A
(char)168 1524 A
(*np;)168 1734 A
4995 V
(10326)210 1122 A
5085 V
(10327)210 1122 A
1524(rp)S
1650(=)S
(proc_addr\(m_ptr->PR_PROC_NR\);)1218 1734 A
5175 V
(10328)210 1122 A
1524(sp)S
1650(=)S
(\(reg_t\))294 1734 A
(m_ptr->PR_STACK_PTR;)840 2070 A
5265 V
(10329)210 1122 A
(rp->p_reg.sp)504 1524 A
2070(=)S
(sp;)126 2154 A
2784(/*)S
(set)126 2910 A
(the)126 3078 A
(stack)210 3246 A
(pointer)294 3498 A
3834(*/)S
5355 V
(10330)210 1122 A
(phys_memset\(vir2phys\(&rp->p_ldt[EXTRA_LDT_INDEX]\),)2100 1524 A
3666(0,)S
5445 V
(10331)210 1122 A
(\(LDT_SIZE)378 1776 A
2196(-)S
(EXTRA_LDT_INDEX\))672 2280 A
2994(*)S
(sizeof\(rp->p_ldt[0]\)\);)924 3078 A
5535 V
(10332)210 1122 A
(rp->p_reg.pc)504 1524 A
2070(=)S
(\(reg_t\))294 2154 A
(m_ptr->PR_IP_PTR;)714 2490 A
3456(/*)S
(set)126 3582 A
3750(pc)S
3876(*/)S
5625 V
(10333)210 1122 A
(rp->p_rts_flags)630 1524 A
2196(&=)S
(\304RECEIVING;)462 2322 A
3120(/*)S
3246(PM)S
(does)168 3372 A
(not)126 3582 A
(reply)210 3750 A
4002(to)S
(EXEC)168 4128 A
(call)168 4338 A
4548(*/)S
5715 V
(10334)210 1122 A
1524(if)S
(\(rp->p_rts_flags)672 1650 A
2364(==)S
2490(0\))S
(lock_enqueue\(rp\);)714 2616 A
5805 V
(10335)210 1122 A
5895 V
(10336)210 1122 A
1524(/*)S
(Save)168 1650 A
(command)294 1860 A
(name)168 2196 A
(for)126 2406 A
(debugging,)420 2574 A
(ps\(1\))210 3036 A
(output,)294 3288 A
(etc.)168 3624 A
3834(*/)S
5985 V
(10337)210 1122 A
(phys_name)378 1524 A
1944(=)S
(numap_local\(m_ptr->m_source,)1176 2028 A
(\(vir_bytes\))462 3246 A
(m_ptr->PR_NAME_PTR,)798 3750 A
6075 V
(10338)210 1122 A
(\(vir_bytes\))462 3120 A
(P_NAME_LEN)420 3624 A
4086(-)S
(1\);)126 4170 A
6165 V
(10339)210 1122 A
1524(if)S
(\(phys_name)420 1650 A
2112(!=)S
2238(0\))S
2364({)S
6255 V
(10340)210 1122 A
(phys_copy\(phys_name,)840 1776 A
(vir2phys\(rp->p_name\),)882 2658 A
(\(phys_bytes\))504 3582 A
(P_NAME_LEN)420 4128 A
4590(-)S
(1\);)126 4674 A
6345 V
(10341)210 1122 A
(for)126 1776 A
(\(np)126 1944 A
2112(=)S
(rp->p_name;)462 2196 A
(\(*np)168 2700 A
2910(&)S
(BYTE\))210 2994 A
3246(>=)S
3372(')S
3456(';)S
(np++\))210 3582 A
3834({})S
6435 V
(10342)210 1122 A
(*np)126 1776 A
1944(=)S
2028(0;)S
3792(/*)S
(mark)168 3918 A
(end)126 4128 A
4296(*/)S
6525 V
(10343)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
6615 V
(10344)210 1122 A
(strncpy\(rp->p_name,)798 1776 A
("<unset>",)420 2616 A
(P_NAME_LEN\);)504 3078 A
6705 V
(10345)210 1122 A
1524(})S
6795 V
(10346)210 1122 A
(return\(OK\);)462 1524 A
6885 V
(10347)210 1122 A
1440(})S
6975 V
(10348)210 1122 A
(#endif)252 1440 A
1734(/*)S
(USE_EXEC)336 1860 A
2238(*/)S
8418 V
EP
%%Page: 127 127
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2449(File:)S
2682(kernel/clock.c)S
12 B
(127)180 4500 A
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(kernel/clock.c)588 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(10400)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(clock)210 2532 A
(task,)210 2784 A
(which)210 3036 A
(handles)294 3288 A
(time)168 3624 A
(related)294 3834 A
(functions.)420 4170 A
2295 V
(10401)210 1122 A
1482(*)S
(Important)378 1566 A
(events)252 1986 A
(that)168 2280 A
(are)126 2490 A
(handled)294 2658 A
2994(by)S
(the)126 3120 A
(CLOCK)210 3288 A
(include)294 3540 A
(setting)294 3876 A
(and)126 4212 A
2385 V
(10402)210 1122 A
1482(*)S
(monitoring)420 1566 A
(alarm)210 2028 A
(timers)252 2280 A
(and)126 2574 A
(deciding)336 2742 A
(when)168 3120 A
3330(to)S
(\(re\)schedule)504 3456 A
(processes.)420 4002 A
2475 V
(10403)210 1122 A
1482(*)S
(The)126 1566 A
(CLOCK)210 1734 A
(offers)252 1986 A
2280(a)S
(direct)252 2364 A
(interface)378 2658 A
3078(to)S
(kernel)252 3204 A
(processes.)420 3498 A
(System)252 3960 A
(services)336 4254 A
2565 V
(10404)210 1122 A
1482(*)S
(can)126 1566 A
(access)252 1734 A
(its)126 2028 A
(services)336 2196 A
(through)294 2574 A
(system)252 2910 A
(calls,)252 3204 A
(such)168 3498 A
3708(as)S
(sys_setalarm\(\).)630 3834 A
(The)126 4506 A
2655 V
(10405)210 1122 A
1482(*)S
(CLOCK)210 1566 A
(task)168 1818 A
(thus)168 2028 A
2238(is)S
(hidden)252 2364 A
(from)168 2658 A
(the)126 2868 A
(outside)294 3036 A
(world.)252 3372 A
2745 V
(10406)210 1122 A
1482(*)S
2835 V
(10407)210 1122 A
1482(*)S
(Changes:)336 1566 A
2925 V
(10408)210 1122 A
1482(*)S
(Oct)126 1650 A
(08,)126 1818 A
(2005)168 1986 A
(reordering)420 2280 A
(and)126 2742 A
(comment)294 2910 A
(editing)294 3246 A
(\(A.)126 3582 A
3750(S.)S
(Woodhull\))378 3876 A
3015 V
(10409)210 1122 A
1482(*)S
(Mar)126 1650 A
(18,)126 1818 A
(2004)168 1986 A
(clock)210 2280 A
(interface)378 2532 A
(moved)210 2952 A
3204(to)S
(SYSTEM)252 3330 A
(task)168 3624 A
(\(Jorrit)294 3834 A
4170(N.)S
(Herder\))294 4296 A
3105 V
(10410)210 1122 A
1482(*)S
(Sep)126 1650 A
(30,)126 1818 A
(2004)168 1986 A
(source)252 2280 A
(code)168 2574 A
(documentation)546 2784 A
(updated)294 3372 A
(\(Jorrit)294 3750 A
4086(N.)S
(Herder\))294 4212 A
3195 V
(10411)210 1122 A
1482(*)S
(Sep)126 1650 A
(24,)126 1818 A
(2004)168 1986 A
(redesigned)420 2280 A
(alarm)210 2742 A
(timers)252 2994 A
(\(Jorrit)294 3330 A
3666(N.)S
(Herder\))294 3792 A
3285 V
(10412)210 1122 A
1482(*)S
3375 V
(10413)210 1122 A
1482(*)S
(The)126 1566 A
(function)336 1734 A
(do_clocktick\(\))588 2112 A
2742(is)S
(triggered)378 2868 A
3288(by)S
(the)126 3414 A
(clock's)294 3582 A
(interrupt)378 3918 A
3465 V
(10414)210 1122 A
1482(*)S
(handler)294 1566 A
(when)168 1902 A
2112(a)S
(watchdog)336 2196 A
(timer)210 2574 A
(has)126 2826 A
(expired)294 2994 A
3330(or)S
3456(a)S
(process)294 3540 A
(must)168 3876 A
4086(be)S
(scheduled.)420 4212 A
3555 V
(10415)210 1122 A
1482(*)S
3645 V
(10416)210 1122 A
1482(*)S
1566(In)S
(addition)336 1692 A
2070(to)S
(the)126 2196 A
(main)168 2364 A
(clock_task\(\))504 2574 A
(entry)210 3120 A
(point,)252 3372 A
(which)210 3666 A
(starts)252 3918 A
(the)126 4212 A
(main)168 4380 A
3735 V
(10417)210 1122 A
1482(*)S
(loop,)210 1566 A
(there)210 1818 A
(are)126 2070 A
(several)294 2238 A
(other)210 2574 A
(minor)210 2826 A
(entry)210 3078 A
(points:)294 3330 A
3825 V
(10418)210 1122 A
1482(*)S
(clock_stop:)462 1650 A
(called)252 2448 A
(just)168 2742 A
(before)252 2952 A
(MINIX)210 3246 A
(shutdown)336 3498 A
3915 V
(10419)210 1122 A
1482(*)S
(get_uptime:)462 1650 A
(get)126 2448 A
(realtime)336 2616 A
(since)210 2994 A
(boot)168 3246 A
3456(in)S
(clock)210 3582 A
(ticks)210 3834 A
4005 V
(10420)210 1122 A
1482(*)S
(set_timer:)420 1650 A
(set)126 2448 A
2616(a)S
(watchdog)336 2700 A
(timer)210 3078 A
(\(+\))126 3330 A
4095 V
(10421)210 1122 A
1482(*)S
(reset_timer:)504 1650 A
(reset)210 2448 A
2700(a)S
(watchdog)336 2784 A
(timer)210 3162 A
(\(+\))126 3414 A
4185 V
(10422)210 1122 A
1482(*)S
(read_clock:)462 1650 A
(read)168 2448 A
(the)126 2658 A
(counter)294 2826 A
3162(of)S
(channel)294 3288 A
3624(0)S
3708(of)S
(the)126 3834 A
(8253A)210 4002 A
(timer)210 4254 A
4275 V
(10423)210 1122 A
1482(*)S
4365 V
(10424)210 1122 A
1482(*)S
(\(+\))126 1566 A
(The)126 1734 A
(CLOCK)210 1902 A
(task)168 2154 A
(keeps)210 2364 A
(tracks)252 2616 A
2910(of)S
(watchdog)336 3036 A
(timers)252 3414 A
(for)126 3708 A
(the)126 3876 A
(entire)252 4044 A
(kernel.)294 4338 A
4455 V
(10425)210 1122 A
1482(*)S
(The)126 1566 A
(watchdog)336 1734 A
(functions)378 2112 A
2532(of)S
(expired)294 2658 A
(timers)252 2994 A
(are)126 3288 A
(executed)336 3456 A
3834(in)S
(do_clocktick\(\).)630 3960 A
4545 V
(10426)210 1122 A
1482(*)S
1566(It)S
1692(is)S
(crucial)294 1818 A
(that)168 2154 A
(watchdog)336 2364 A
(functions)378 2742 A
(not)126 3162 A
(block,)252 3330 A
3624(or)S
(the)126 3750 A
(CLOCK)210 3918 A
(task)168 4170 A
(may)126 4380 A
4635 V
(10427)210 1122 A
1482(*)S
1566(be)S
(blocked.)336 1692 A
2070(Do)S
(not)126 2196 A
(send\(\))252 2364 A
2658(a)S
(message)294 2742 A
(when)168 3078 A
(the)126 3288 A
(receiver)336 3456 A
3834(is)S
(not)126 3960 A
(expecting)378 4128 A
(it.)126 4548 A
4725 V
(10428)210 1122 A
1482(*)S
(Instead,)336 1566 A
(notify\(\),)378 1944 A
(which)210 2364 A
(always)252 2616 A
(returns,)336 2910 A
(should)252 3288 A
3582(be)S
(used.)210 3708 A
4815 V
(10429)210 1122 A
1482(*/)S
4905 V
(10430)210 1122 A
4995 V
(10431)210 1122 A
(#include)336 1440 A
("kernel.h")420 1818 A
5085 V
(10432)210 1122 A
(#include)336 1440 A
("proc.h")336 1818 A
5175 V
(10433)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
5265 V
(10434)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
5355 V
(10435)210 1122 A
5445 V
(10436)210 1122 A
1440(/*)S
(Function)336 1566 A
(prototype)378 1944 A
(for)126 2364 A
(PRIVATE)294 2532 A
(functions.)420 2868 A
3330(*/)S
5535 V
(10437)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(init_clock,)462 2490 A
(\(void\))252 2994 A
3288(\);)S
5625 V
(10438)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(clock_handler,)588 2448 A
(\(irq_hook_t)462 3078 A
(*hook\))252 3582 A
3876(\);)S
5715 V
(10439)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(do_clocktick,)546 2448 A
(\(message)336 3036 A
(*m_ptr\))294 3414 A
3750(\);)S
5805 V
(10440)210 1122 A
5895 V
(10441)210 1122 A
1440(/*)S
(Clock)210 1566 A
(parameters.)462 1818 A
2322(*/)S
5985 V
(10442)210 1122 A
(#define)294 1440 A
(COUNTER_FREQ)504 1776 A
(\(2*TIMER_FREQ\))588 2322 A
2952(/*)S
(counter)294 3078 A
(frequency)378 3414 A
(using)210 3834 A
(square)252 4086 A
(wave)168 4380 A
4590(*/)S
6075 V
(10443)210 1122 A
(#define)294 1440 A
(LATCH_COUNT)462 1776 A
(0x00)168 2448 A
2784(/*)S
(cc00xxxx,)378 2910 A
3330(c)S
3414(=)S
(channel,)336 3498 A
3876(x)S
3960(=)S
(any)126 4044 A
4212(*/)S
6165 V
(10444)210 1122 A
(#define)294 1440 A
(SQUARE_WAVE)462 1776 A
(0x36)168 2448 A
2784(/*)S
(ccaammmb,)378 2910 A
3330(a)S
3414(=)S
(access,)294 3498 A
3834(m)S
3918(=)S
(mode,)210 4002 A
4254(b)S
4338(=)S
(BCD)126 4422 A
4590(*/)S
6255 V
(10445)210 1122 A
2784(/*)S
(11x11,)252 2994 A
3288(11)S
3414(=)S
(LSB)126 3498 A
(then)168 3666 A
(MSB,)168 3876 A
(x11)126 4086 A
4254(=)S
4338(sq)S
(wave)168 4464 A
4674(*/)S
6345 V
(10446)210 1122 A
(#define)294 1440 A
(TIMER_COUNT)462 1776 A
(\(\(unsigned\))462 2280 A
(\(TIMER_FREQ/HZ\)\))672 2784 A
3498(/*)S
(initial)294 3624 A
(value)210 3960 A
(for)126 4212 A
(counter*/)378 4380 A
6435 V
(10447)210 1122 A
(#define)294 1440 A
(TIMER_FREQ)420 1776 A
(1193182L)336 2280 A
2784(/*)S
(clock)210 2910 A
(frequency)378 3162 A
(for)126 3582 A
(timer)210 3750 A
4002(in)S
4128(PC)S
(and)126 4254 A
4422(AT)S
4548(*/)S
6525 V
(10448)210 1122 A
6615 V
(10449)210 1122 A
(#define)294 1440 A
(CLOCK_ACK_BIT)546 1776 A
(0x80)168 2448 A
2784(/*)S
(PS/2)168 2910 A
(clock)210 3120 A
(interrupt)378 3372 A
(acknowledge)462 3792 A
(bit)126 4296 A
4464(*/)S
6705 V
(10450)210 1122 A
6795 V
(10451)210 1122 A
1440(/*)S
(The)126 1566 A
(CLOCK's)294 1734 A
(timers)252 2070 A
(queue.)252 2364 A
(The)126 2658 A
(functions)378 2826 A
3246(in)S
(<timers.h>)420 3372 A
(operate)294 3834 A
4170(on)S
(this.)210 4296 A
6885 V
(10452)210 1122 A
1482(*)S
(Each)168 1566 A
(system)252 1776 A
(process)294 2070 A
(possesses)378 2406 A
2826(a)S
(single)252 2910 A
(synchronous)462 3204 A
(alarm)210 3708 A
(timer.)252 3960 A
4254(If)S
(other)210 4380 A
6975 V
(10453)210 1122 A
1482(*)S
(kernel)252 1566 A
(parts)210 1860 A
(want)168 2112 A
2322(to)S
(use)126 2448 A
(additional)420 2616 A
(timers,)294 3078 A
(they)168 3414 A
(must)168 3624 A
(declare)294 3834 A
(their)210 4170 A
(own)126 4422 A
7065 V
(10454)210 1122 A
1482(*)S
(persistent)420 1566 A
(\(static\))336 2028 A
(timer)210 2406 A
(structure,)420 2658 A
(which)210 3120 A
(can)126 3372 A
3540(be)S
(passed)252 3666 A
3960(to)S
(the)126 4086 A
(clock)210 4254 A
8418 V
EP
%%Page: 128 128
BP
/slant 0 def
/height 0 def
1485 V
12 B
(128)180 1080 A
11 R
2449(File:)S
2682(kernel/clock.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(10455)210 1122 A
1482(*)S
(via)126 1566 A
(\(re\)set_timer\(\).)672 1734 A
1845 V
(10456)210 1122 A
1482(*)S
(When)168 1566 A
1776(a)S
(timer)210 1860 A
(expires)294 2112 A
(its)126 2448 A
(watchdog)336 2616 A
(function)336 2994 A
3372(is)S
(run)126 3498 A
3666(by)S
(the)126 3792 A
(CLOCK)210 3960 A
(task.)210 4212 A
1935 V
(10457)210 1122 A
1482(*/)S
2025 V
(10458)210 1122 A
(PRIVATE)294 1440 A
(timer_t)294 1776 A
(*clock_timers;)588 2112 A
3120(/*)S
(queue)210 3246 A
3498(of)S
(CLOCK)210 3624 A
(timers)252 3876 A
4170(*/)S
2115 V
(10459)210 1122 A
(PRIVATE)294 1440 A
(clock_t)294 1776 A
(next_timeout;)546 2112 A
3120(/*)S
(realtime)336 3246 A
(that)168 3624 A
(next)168 3834 A
(timer)210 4044 A
(expires)294 4296 A
4632(*/)S
2205 V
(10460)210 1122 A
2295 V
(10461)210 1122 A
1440(/*)S
(The)126 1566 A
(time)168 1734 A
1944(is)S
(incremented)462 2070 A
2574(by)S
(the)126 2700 A
(interrupt)378 2868 A
(handler)294 3288 A
3624(on)S
(each)168 3750 A
(clock)210 3960 A
(tick.)210 4212 A
4464(*/)S
2385 V
(10462)210 1122 A
(PRIVATE)294 1440 A
(clock_t)294 1776 A
(realtime;)378 2112 A
3120(/*)S
(real)168 3246 A
(time)168 3456 A
(clock)210 3666 A
3918(*/)S
2475 V
(10463)210 1122 A
(PRIVATE)294 1440 A
(irq_hook_t)420 1776 A
(clock_hook;)462 2238 A
3120(/*)S
(interrupt)378 3246 A
(handler)294 3666 A
(hook)168 4002 A
4212(*/)S
2565 V
(10464)210 1122 A
2655 V
(10465)210 1122 A
(/*===========================================================================*)3276 1440 A
2745 V
(10466)210 1122 A
1482(*)S
(clock_task)420 2784 A
4674(*)S
2835 V
(10467)210 1122 A
(*===========================================================================*/)3276 1482 A
2925 V
(10468)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(clock_task\(\))504 1944 A
3015 V
(10469)210 1122 A
1440({)S
3105 V
(10470)210 1122 A
1440(/*)S
(Main)168 1566 A
(program)294 1776 A
2112(of)S
(clock)210 2238 A
(task.)210 2490 A
2742(If)S
(the)126 2868 A
(call)168 3036 A
3246(is)S
(not)126 3372 A
(HARD_INT)336 3540 A
3918(it)S
4044(is)S
4170(an)S
(error.)252 4296 A
3195 V
(10471)210 1122 A
1482(*/)S
3285 V
(10472)210 1122 A
(message)294 1524 A
1860(m;)S
2784(/*)S
(message)294 2910 A
(buffer)252 3246 A
(for)126 3540 A
(both)168 3708 A
(input)210 3918 A
(and)126 4170 A
(output)252 4338 A
4632(*/)S
3375 V
(10473)210 1122 A
(int)126 1524 A
(result;)294 1692 A
2784(/*)S
(result)252 2910 A
(returned)336 3204 A
3582(by)S
(the)126 3708 A
(handler)294 3876 A
4212(*/)S
3465 V
(10474)210 1122 A
3555 V
(10475)210 1122 A
(init_clock\(\);)546 1524 A
2784(/*)S
(initialize)420 2910 A
(clock)210 3372 A
(task)168 3624 A
3834(*/)S
3645 V
(10476)210 1122 A
3735 V
(10477)210 1122 A
1524(/*)S
(Main)168 1650 A
(loop)168 1860 A
2070(of)S
(the)126 2196 A
(clock)210 2364 A
(task.)210 2616 A
(Get)126 2910 A
(work,)210 3078 A
(process)294 3330 A
(it.)126 3666 A
(Never)210 3834 A
(reply.)252 4086 A
4380(*/)S
3825 V
(10478)210 1122 A
(while)210 1524 A
(\(TRUE\))252 1776 A
2070({)S
3915 V
(10479)210 1122 A
4005 V
(10480)210 1122 A
1692(/*)S
1818(Go)S
(get)126 1944 A
2112(a)S
(message.)336 2196 A
2574(*/)S
4095 V
(10481)210 1122 A
(receive\(ANY,)504 1692 A
(&m\);)168 2238 A
4185 V
(10482)210 1122 A
4275 V
(10483)210 1122 A
1692(/*)S
(Handle)252 1818 A
(the)126 2112 A
(request.)336 2280 A
(Only)168 2658 A
(clock)210 2868 A
(ticks)210 3120 A
(are)126 3372 A
(expected.)378 3540 A
3960(*/)S
4365 V
(10484)210 1122 A
(switch)252 1692 A
(\(m.m_type\))420 1986 A
2448({)S
4455 V
(10485)210 1122 A
(case)168 1692 A
(HARD_INT:)378 1902 A
4545 V
(10486)210 1122 A
(result)252 1860 A
2154(=)S
(do_clocktick\(&m\);)714 2238 A
3120(/*)S
(handle)252 3246 A
(clock)210 3540 A
(tick)168 3792 A
4002(*/)S
4635 V
(10487)210 1122 A
(break;)252 1860 A
4725 V
(10488)210 1122 A
(default:)336 1692 A
3120(/*)S
(illegal)294 3246 A
(request)294 3582 A
(type)168 3918 A
4128(*/)S
4815 V
(10489)210 1122 A
(kprintf\("CLOCK:)630 1860 A
(illegal)294 2532 A
(request)294 2868 A
3204(%d)S
(from)168 3330 A
(%d.\\n",)294 3540 A
(m.m_type,m.m_source\);)882 3876 A
4905 V
(10490)210 1122 A
1692(})S
4995 V
(10491)210 1122 A
1524(})S
5085 V
(10492)210 1122 A
1440(})S
5265 V
(10494)210 1122 A
(/*===========================================================================*)3276 1440 A
5355 V
(10495)210 1122 A
1482(*)S
(do_clocktick)504 2784 A
4674(*)S
5445 V
(10496)210 1122 A
(*===========================================================================*/)3276 1482 A
5535 V
(10497)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(do_clocktick\(m_ptr\))798 1944 A
5625 V
(10498)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
3120(/*)S
(pointer)294 3246 A
3582(to)S
(request)294 3708 A
(message)294 4044 A
4380(*/)S
5715 V
(10499)210 1122 A
1440({)S
5805 V
(10500)210 1122 A
1440(/*)S
(Despite)294 1566 A
(its)126 1902 A
(name,)210 2070 A
(this)168 2322 A
(routine)294 2532 A
2868(is)S
(not)126 2994 A
(called)252 3162 A
3456(on)S
(every)210 3582 A
(clock)210 3834 A
(tick.)210 4086 A
4338(It)S
5895 V
(10501)210 1122 A
1482(*)S
1566(is)S
(called)252 1692 A
1986(on)S
(those)210 2112 A
(clock)210 2364 A
(ticks)210 2616 A
(when)168 2868 A
3078(a)S
(lot)126 3162 A
3330(of)S
(work)168 3456 A
(needs)210 3666 A
3918(to)S
4044(be)S
(done.)210 4170 A
5985 V
(10502)210 1122 A
1482(*/)S
6075 V
(10503)210 1122 A
6165 V
(10504)210 1122 A
1524(/*)S
1650(A)S
(process)294 1734 A
(used)168 2070 A
2280(up)S
2406(a)S
(full)168 2490 A
(quantum.)336 2700 A
(The)126 3078 A
(interrupt)378 3246 A
(handler)294 3666 A
(stored)252 4002 A
(this)168 4296 A
6255 V
(10505)210 1122 A
1566(*)S
(process)294 1650 A
1986(in)S
('prev_ptr'.)462 2112 A
(First)210 2658 A
(make)168 2910 A
(sure)168 3120 A
(that)168 3330 A
(the)126 3540 A
(process)294 3708 A
4044(is)S
(not)126 4170 A
4338(on)S
(the)126 4464 A
6345 V
(10506)210 1122 A
1566(*)S
(scheduling)420 1650 A
(queues.)294 2112 A
(Then)168 2490 A
(announce)336 2700 A
(the)126 3078 A
(process)294 3246 A
(ready)210 3582 A
(again.)252 3834 A
(Since)210 4128 A
4380(it)S
(has)126 4506 A
6435 V
(10507)210 1122 A
1566(*)S
1650(no)S
(more)168 1776 A
(time)168 1986 A
(left,)210 2196 A
2448(it)S
(gets)168 2574 A
2784(a)S
(new)126 2868 A
(quantum)294 3036 A
(and)126 3372 A
3540(is)S
(inserted)336 3666 A
4044(at)S
(the)126 4170 A
(right)210 4338 A
6525 V
(10508)210 1122 A
1566(*)S
(place)210 1650 A
1902(in)S
(the)126 2028 A
(queues.)294 2196 A
2574(As)S
2700(a)S
(side-effect)462 2784 A
3288(a)S
(new)126 3372 A
(process)294 3540 A
(will)168 3876 A
4086(be)S
(scheduled.)420 4212 A
6615 V
(10509)210 1122 A
1566(*/)S
6705 V
(10510)210 1122 A
1524(if)S
(\(prev_ptr->p_ticks_left)966 1650 A
2658(<=)S
2784(0)S
2868(&&)S
(priv\(prev_ptr\)->s_flags)966 2994 A
4002(&)S
(PREEMPTIBLE\))504 4086 A
4632({)S
6795 V
(10511)210 1122 A
(lock_dequeue\(prev_ptr\);)966 1692 A
3120(/*)S
(take)168 3246 A
3456(it)S
(off)126 3582 A
(the)126 3750 A
(queues)252 3918 A
4212(*/)S
6885 V
(10512)210 1122 A
(lock_enqueue\(prev_ptr\);)966 1692 A
3120(/*)S
(and)126 3246 A
(reinsert)336 3414 A
3792(it)S
(again)210 3918 A
4170(*/)S
6975 V
(10513)210 1122 A
1524(})S
7065 V
(10514)210 1122 A
8418 V
EP
%%Page: 129 129
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2449(File:)S
2682(kernel/clock.c)S
12 B
(129)180 4500 A
1755 V
7 LST
(10515)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(if)S
2028(a)S
(clock)210 2112 A
(timer)210 2364 A
(expired)294 2616 A
(and)126 2952 A
(run)126 3120 A
(its)126 3288 A
(watchdog)336 3456 A
(function.)378 3834 A
4254(*/)S
1845 V
(10516)210 1122 A
1524(if)S
(\(next_timeout)546 1650 A
2238(<=)S
(realtime\))378 2364 A
2784({)S
1935 V
(10517)210 1122 A
(tmrs_exptimers\(&clock_timers,)1218 1776 A
(realtime,)378 3036 A
(NULL\);)252 3456 A
2025 V
(10518)210 1122 A
(next_timeout)504 1776 A
2322(=)S
(clock_timers)504 2406 A
2952(==)S
(NULL)168 3078 A
3288(?)S
2115 V
(10519)210 1122 A
(TMR_NEVER)378 2112 A
2532(:)S
(clock_timers->tmr_exp_time;)1134 2616 A
2205 V
(10520)210 1122 A
1524(})S
2295 V
(10521)210 1122 A
2385 V
(10522)210 1122 A
1524(/*)S
(Inhibit)294 1650 A
(sending)294 1986 A
2322(a)S
(reply.)252 2406 A
2700(*/)S
2475 V
(10523)210 1122 A
(return\(EDONTREPLY\);)798 1524 A
2565 V
(10524)210 1122 A
1440(})S
2745 V
(10526)210 1122 A
(/*===========================================================================*)3276 1440 A
2835 V
(10527)210 1122 A
1482(*)S
(init_clock)420 2784 A
4674(*)S
2925 V
(10528)210 1122 A
(*===========================================================================*/)3276 1482 A
3015 V
(10529)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(init_clock\(\))504 1986 A
3105 V
(10530)210 1122 A
1440({)S
3195 V
(10531)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(the)126 2112 A
(CLOCK's)294 2280 A
(interrupt)378 2616 A
(hook.)210 3036 A
3288(*/)S
3285 V
(10532)210 1122 A
(clock_hook.proc_nr)756 1524 A
2322(=)S
(CLOCK;)252 2406 A
3375 V
(10533)210 1122 A
3465 V
(10534)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(channel)294 2112 A
2448(0)S
2532(of)S
(the)126 2658 A
(8253A)210 2826 A
(timer)210 3078 A
(to,)126 3330 A
(e.g.,)210 3498 A
3750(60)S
(Hz.)126 3876 A
4044(*/)S
3555 V
(10535)210 1122 A
(outb\(TIMER_MODE,)672 1524 A
(SQUARE_WAVE\);)546 2238 A
3120(/*)S
(set)126 3246 A
(timer)210 3414 A
3666(to)S
(run)126 3792 A
(continuously)504 3960 A
4506(*/)S
3645 V
(10536)210 1122 A
(outb\(TIMER0,)504 1524 A
(TIMER_COUNT\);)546 2070 A
3120(/*)S
(load)168 3246 A
(timer)210 3456 A
(low)126 3708 A
(byte)168 3876 A
4086(*/)S
3735 V
(10537)210 1122 A
(outb\(TIMER0,)504 1524 A
(TIMER_COUNT)462 2070 A
2574(>>)S
(8\);)126 2700 A
3120(/*)S
(load)168 3246 A
(timer)210 3456 A
(high)168 3708 A
(byte)168 3918 A
4128(*/)S
3825 V
(10538)210 1122 A
(put_irq_handler\(&clock_hook,)1176 1524 A
(CLOCK_IRQ,)420 2742 A
(clock_handler\);/*)714 3204 A
(register)336 3960 A
(handler)294 4338 A
4674(*/)S
3915 V
(10539)210 1122 A
(enable_irq\(&clock_hook\);)1008 1524 A
3120(/*)S
(ready)210 3246 A
(for)126 3498 A
(clock)210 3666 A
(interrupts)420 3918 A
4380(*/)S
4005 V
(10540)210 1122 A
1440(})S
4185 V
(10542)210 1122 A
(/*===========================================================================*)3276 1440 A
4275 V
(10543)210 1122 A
1482(*)S
(clock_stop)420 2784 A
4674(*)S
4365 V
(10544)210 1122 A
(*===========================================================================*/)3276 1482 A
4455 V
(10545)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(clock_stop\(\))504 1944 A
4545 V
(10546)210 1122 A
1440({)S
4635 V
(10547)210 1122 A
1440(/*)S
(Reset)210 1566 A
(the)126 1818 A
(clock)210 1986 A
2238(to)S
(the)126 2364 A
(BIOS)168 2532 A
(rate.)210 2742 A
(\(For)168 2994 A
(rebooting\))420 3204 A
3666(*/)S
4725 V
(10548)210 1122 A
(outb\(TIMER_MODE,)672 1524 A
(0x36\);)252 2238 A
4815 V
(10549)210 1122 A
(outb\(TIMER0,)504 1524 A
(0\);)126 2070 A
4905 V
(10550)210 1122 A
(outb\(TIMER0,)504 1524 A
(0\);)126 2070 A
4995 V
(10551)210 1122 A
1440(})S
5175 V
(10553)210 1122 A
(/*===========================================================================*)3276 1440 A
5265 V
(10554)210 1122 A
1482(*)S
(clock_handler)546 2784 A
4674(*)S
5355 V
(10555)210 1122 A
(*===========================================================================*/)3276 1482 A
5445 V
(10556)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(clock_handler\(hook\))798 1944 A
5535 V
(10557)210 1122 A
(irq_hook_t)420 1440 A
(*hook;)252 1902 A
5625 V
(10558)210 1122 A
1440({)S
5715 V
(10559)210 1122 A
1440(/*)S
(This)168 1566 A
(executes)336 1776 A
2154(on)S
(each)168 2280 A
(clock)210 2490 A
(tick)168 2742 A
(\(i.e.,)252 2952 A
(every)210 3246 A
(time)168 3498 A
(the)126 3708 A
(timer)210 3876 A
(chip)168 4128 A
(generates)378 4338 A
5805 V
(10560)210 1122 A
1482(*)S
1566(an)S
(interrupt\).)462 1692 A
2196(It)S
(does)168 2322 A
2532(a)S
(little)252 2616 A
(bit)126 2910 A
3078(of)S
(work)168 3204 A
3414(so)S
(the)126 3540 A
(clock)210 3708 A
(task)168 3960 A
(does)168 4170 A
(not)126 4380 A
(have)168 4548 A
5895 V
(10561)210 1122 A
1482(*)S
1566(to)S
1692(be)S
(called)252 1818 A
2112(on)S
(every)210 2238 A
(tick.)210 2490 A
(The)126 2784 A
(clock)210 2952 A
(task)168 3204 A
3414(is)S
(called)252 3540 A
(when:)210 3834 A
5985 V
(10562)210 1122 A
1482(*)S
6075 V
(10563)210 1122 A
1482(*)S
(\(1\))126 1776 A
(the)126 1944 A
(scheduling)420 2112 A
(quantum)294 2574 A
2910(of)S
(the)126 3036 A
(running)294 3204 A
(process)294 3540 A
(has)126 3876 A
(expired,)336 4044 A
4422(or)S
6165 V
(10564)210 1122 A
1482(*)S
(\(2\))126 1776 A
1944(a)S
(timer)210 2028 A
(has)126 2280 A
(expired)294 2448 A
(and)126 2784 A
(the)126 2952 A
(watchdog)336 3120 A
(function)336 3498 A
(should)252 3876 A
4170(be)S
(run.)168 4296 A
6255 V
(10565)210 1122 A
1482(*)S
6345 V
(10566)210 1122 A
1482(*)S
(Many)168 1566 A
(global)252 1776 A
(global)252 2070 A
(and)126 2364 A
(static)252 2532 A
(variables)378 2826 A
(are)126 3246 A
(accessed)336 3414 A
(here.)210 3792 A
(The)126 4086 A
(safety)252 4254 A
4548(of)S
6435 V
(10567)210 1122 A
1482(*)S
(this)168 1566 A
(must)168 1776 A
1986(be)S
(justified.)420 2112 A
(All)126 2574 A
(scheduling)420 2742 A
(and)126 3204 A
(message)294 3372 A
(passing)294 3708 A
(code)168 4044 A
(acquires)336 4254 A
4632(a)S
6525 V
(10568)210 1122 A
1482(*)S
(lock)168 1566 A
1776(by)S
(temporarily)462 1902 A
(disabling)378 2406 A
(interrupts,)462 2826 A
3330(so)S
3456(no)S
(conflicts)378 3582 A
(with)168 4002 A
(calls)210 4212 A
(from)168 4464 A
6615 V
(10569)210 1122 A
1482(*)S
(the)126 1566 A
(task)168 1734 A
(level)210 1944 A
(can)126 2196 A
(occur.)252 2364 A
(Furthermore,)504 2658 A
(interrupts)420 3204 A
(are)126 3666 A
(not)126 3834 A
(reentrant,)420 4002 A
(the)126 4464 A
6705 V
(10570)210 1122 A
1482(*)S
(interrupt)378 1566 A
(handler)294 1986 A
(cannot)252 2322 A
2616(be)S
(bothered)336 2742 A
3120(by)S
(other)210 3246 A
(interrupts.)462 3498 A
6795 V
(10571)210 1122 A
1482(*)S
6885 V
(10572)210 1122 A
1482(*)S
(Variables)378 1566 A
(that)168 1986 A
(are)126 2196 A
(updated)294 2364 A
2700(in)S
(the)126 2826 A
(clock's)294 2994 A
(interrupt)378 3330 A
(handler:)336 3750 A
6975 V
(10573)210 1122 A
1482(*)S
(lost_ticks:)462 1776 A
7065 V
(10574)210 1122 A
1482(*)S
(Clock)210 2112 A
(ticks)210 2364 A
(counted)294 2616 A
(outside)294 2952 A
(the)126 3288 A
(clock)210 3456 A
(task.)210 3708 A
(This)168 3960 A
(for)126 4170 A
(example)294 4338 A
8418 V
EP
%%Page: 130 130
BP
/slant 0 def
/height 0 def
1485 V
12 B
(130)180 1080 A
11 R
2449(File:)S
2682(kernel/clock.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(10575)210 1122 A
1482(*)S
2112(is)S
(used)168 2238 A
(when)168 2448 A
(the)126 2658 A
(boot)168 2826 A
(monitor)294 3036 A
(processes)378 3372 A
3792(a)S
(real)168 3876 A
(mode)168 4086 A
(interrupt.)420 4296 A
1845 V
(10576)210 1122 A
1482(*)S
(realtime:)378 1776 A
1935 V
(10577)210 1122 A
1482(*)S
(The)126 2112 A
(current)294 2280 A
(uptime)252 2616 A
2910(is)S
(incremented)462 3036 A
(with)168 3540 A
(all)126 3750 A
(outstanding)462 3918 A
(ticks.)252 4422 A
2025 V
(10578)210 1122 A
1482(*)S
(proc_ptr,)378 1776 A
(bill_ptr:)378 2196 A
2115 V
(10579)210 1122 A
1482(*)S
(These)210 2112 A
(are)126 2364 A
(used)168 2532 A
(for)126 2742 A
(accounting.)462 2910 A
3456(It)S
(does)168 3582 A
(not)126 3792 A
(matter)252 3960 A
4254(if)S
(proc.c)252 4380 A
2205 V
(10580)210 1122 A
1482(*)S
2112(is)S
(changing)336 2238 A
(them,)210 2616 A
(provided)336 2868 A
(they)168 3246 A
(are)126 3456 A
(always)252 3624 A
(valid)210 3918 A
(pointers,)378 4170 A
2295 V
(10581)210 1122 A
1482(*)S
(since)210 2112 A
2364(at)S
(worst)210 2490 A
(the)126 2742 A
(previous)336 2910 A
(process)294 3288 A
(would)210 3624 A
3876(be)S
(billed.)294 4002 A
2385 V
(10582)210 1122 A
1482(*/)S
2475 V
(10583)210 1122 A
(register)336 1524 A
(unsigned)336 1902 A
(ticks;)252 2280 A
2565 V
(10584)210 1122 A
2655 V
(10585)210 1122 A
1524(/*)S
(Acknowledge)462 1650 A
(the)126 2154 A
(PS/2)168 2322 A
(clock)210 2532 A
(interrupt.)420 2784 A
3246(*/)S
2745 V
(10586)210 1122 A
1524(if)S
(\(machine.ps_mca\))672 1650 A
(outb\(PORT_B,)504 2364 A
(inb\(PORT_B\))462 2910 A
3414(|)S
(CLOCK_ACK_BIT\);)630 3498 A
2835 V
(10587)210 1122 A
2925 V
(10588)210 1122 A
1524(/*)S
(Get)126 1650 A
(number)252 1818 A
2112(of)S
(ticks)210 2238 A
(and)126 2490 A
(update)252 2658 A
(realtime.)378 2952 A
3372(*/)S
3015 V
(10589)210 1122 A
(ticks)210 1524 A
1776(=)S
(lost_ticks)420 1860 A
2322(+)S
2406(1;)S
3105 V
(10590)210 1122 A
(lost_ticks)420 1524 A
1986(=)S
2070(0;)S
3195 V
(10591)210 1122 A
(realtime)336 1524 A
1902(+=)S
(ticks;)252 2028 A
3285 V
(10592)210 1122 A
3375 V
(10593)210 1122 A
1524(/*)S
(Update)252 1650 A
(user)168 1944 A
(and)126 2154 A
(system)252 2322 A
(accounting)420 2616 A
(times.)252 3078 A
(Charge)252 3372 A
(the)126 3666 A
(current)294 3834 A
(process)294 4170 A
(for)126 4506 A
3465 V
(10594)210 1122 A
1566(*)S
(user)168 1650 A
(time.)210 1860 A
2112(If)S
(the)126 2238 A
(current)294 2406 A
(process)294 2742 A
3078(is)S
(not)126 3204 A
(billable,)378 3372 A
(that)168 3792 A
(is,)126 4002 A
4170(if)S
4296(a)S
(non-user)336 4380 A
3555 V
(10595)210 1122 A
1566(*)S
(process)294 1650 A
1986(is)S
(running,)336 2112 A
(charge)252 2490 A
(the)126 2784 A
(billable)336 2952 A
(process)294 3330 A
(for)126 3666 A
(system)252 3834 A
(time)168 4128 A
4338(as)S
(well.)210 4464 A
3645 V
(10596)210 1122 A
1566(*)S
(Thus)168 1650 A
(the)126 1860 A
(unbillable)420 2028 A
(process')336 2490 A
(user)168 2868 A
(time)168 3078 A
3288(is)S
(the)126 3414 A
(billable)336 3582 A
(user's)252 3960 A
(system)252 4254 A
(time.)210 4548 A
3735 V
(10597)210 1122 A
1566(*/)S
3825 V
(10598)210 1122 A
(proc_ptr->p_user_time)882 1524 A
2448(+=)S
(ticks;)252 2574 A
3915 V
(10599)210 1122 A
1524(if)S
(\(priv\(proc_ptr\)->s_flags)1008 1650 A
2700(&)S
(PREEMPTIBLE\))504 2784 A
3330({)S
4005 V
(10600)210 1122 A
(proc_ptr->p_ticks_left)924 1692 A
2658(-=)S
(ticks;)252 2784 A
4095 V
(10601)210 1122 A
1524(})S
4185 V
(10602)210 1122 A
1524(if)S
1650(\(!)S
(\(priv\(proc_ptr\)->s_flags)1008 1776 A
2826(&)S
(BILLABLE\)\))420 2910 A
3372({)S
4275 V
(10603)210 1122 A
(bill_ptr->p_sys_time)840 1692 A
2574(+=)S
(ticks;)252 2700 A
4365 V
(10604)210 1122 A
(bill_ptr->p_ticks_left)924 1692 A
2658(-=)S
(ticks;)252 2784 A
4455 V
(10605)210 1122 A
1524(})S
4545 V
(10606)210 1122 A
4635 V
(10607)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(if)S
(do_clocktick\(\))588 2028 A
(must)168 2658 A
2868(be)S
(called.)294 2994 A
(Done)168 3330 A
(for)126 3540 A
(alarms)252 3708 A
(and)126 4002 A
(scheduling.)462 4170 A
4725 V
(10608)210 1122 A
1566(*)S
(Some)168 1650 A
(processes,)420 1860 A
(such)168 2322 A
2532(as)S
(the)126 2658 A
(kernel)252 2826 A
(tasks,)252 3120 A
(cannot)252 3414 A
3708(be)S
(preempted.)420 3834 A
4815 V
(10609)210 1122 A
1566(*/)S
4905 V
(10610)210 1122 A
1524(if)S
(\(\(next_timeout)588 1650 A
2280(<=)S
(realtime\))378 2406 A
2826(||)S
(\(proc_ptr->p_ticks_left)966 2952 A
3960(<=)S
(0\)\))126 4086 A
4254({)S
4995 V
(10611)210 1122 A
(prev_ptr)336 1692 A
2070(=)S
(proc_ptr;)378 2154 A
3456(/*)S
(store)210 3582 A
(running)294 3834 A
(process)294 4170 A
4506(*/)S
5085 V
(10612)210 1122 A
(lock_notify\(HARDWARE,)882 1692 A
(CLOCK\);)294 2616 A
3456(/*)S
(send)168 3582 A
(notification)504 3792 A
4338(*/)S
5175 V
(10613)210 1122 A
1524(})S
5265 V
(10614)210 1122 A
(return\(1\);)420 1524 A
3456(/*)S
(reenable)336 3582 A
(interrupts)420 3960 A
4422(*/)S
5355 V
(10615)210 1122 A
1440(})S
5535 V
(10617)210 1122 A
(/*===========================================================================*)3276 1440 A
5625 V
(10618)210 1122 A
1482(*)S
(get_uptime)420 2784 A
4674(*)S
5715 V
(10619)210 1122 A
(*===========================================================================*/)3276 1482 A
5805 V
(10620)210 1122 A
(PUBLIC)252 1440 A
(clock_t)294 1734 A
(get_uptime\(\))504 2070 A
5895 V
(10621)210 1122 A
1440({)S
5985 V
(10622)210 1122 A
1440(/*)S
(Get)126 1566 A
(and)126 1734 A
(return)252 1902 A
(the)126 2196 A
(current)294 2364 A
(clock)210 2700 A
(uptime)252 2952 A
3246(in)S
(ticks.)252 3372 A
3666(*/)S
6075 V
(10623)210 1122 A
(return\(realtime\);)714 1524 A
6165 V
(10624)210 1122 A
1440(})S
6345 V
(10626)210 1122 A
(/*===========================================================================*)3276 1440 A
6435 V
(10627)210 1122 A
1482(*)S
(set_timer)378 2784 A
4674(*)S
6525 V
(10628)210 1122 A
(*===========================================================================*/)3276 1482 A
6615 V
(10629)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(set_timer\(tp,)546 1944 A
(exp_time,)378 2532 A
(watchdog\))378 2952 A
6705 V
(10630)210 1122 A
(struct)252 1440 A
(timer)210 1734 A
(*tp;)168 1986 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(timer)210 3372 A
(structure)378 3624 A
4044(*/)S
6795 V
(10631)210 1122 A
(clock_t)294 1440 A
(exp_time;)378 1776 A
2784(/*)S
(expiration)420 2910 A
(realtime)336 3372 A
3750(*/)S
6885 V
(10632)210 1122 A
(tmr_func_t)420 1440 A
(watchdog;)378 1902 A
2784(/*)S
(watchdog)336 2910 A
3288(to)S
3414(be)S
(called)252 3540 A
3834(*/)S
6975 V
(10633)210 1122 A
1440({)S
7065 V
(10634)210 1122 A
1440(/*)S
(Insert)252 1566 A
(the)126 1860 A
(new)126 2028 A
(timer)210 2196 A
2448(in)S
(the)126 2574 A
(active)252 2742 A
(timers)252 3036 A
(list.)210 3330 A
(Always)252 3582 A
(update)252 3876 A
(the)126 4170 A
8418 V
EP
%%Page: 131 131
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2449(File:)S
2682(kernel/clock.c)S
12 B
(131)180 4500 A
1755 V
7 LST
(10635)210 1122 A
1482(*)S
(next)168 1566 A
(timeout)294 1776 A
(time)168 2112 A
2322(by)S
(setting)294 2448 A
2784(it)S
2910(to)S
(the)126 3036 A
(front)210 3204 A
3456(of)S
(the)126 3582 A
(active)252 3750 A
(list.)210 4044 A
1845 V
(10636)210 1122 A
1482(*/)S
1935 V
(10637)210 1122 A
(tmrs_settimer\(&clock_timers,)1176 1524 A
(tp,)126 2742 A
(exp_time,)378 2910 A
(watchdog,)378 3330 A
(NULL\);)252 3750 A
2025 V
(10638)210 1122 A
(next_timeout)504 1524 A
2070(=)S
(clock_timers->tmr_exp_time;)1134 2154 A
2115 V
(10639)210 1122 A
1440(})S
2295 V
(10641)210 1122 A
(/*===========================================================================*)3276 1440 A
2385 V
(10642)210 1122 A
1482(*)S
(reset_timer)462 2784 A
4674(*)S
2475 V
(10643)210 1122 A
(*===========================================================================*/)3276 1482 A
2565 V
(10644)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(reset_timer\(tp\))630 1944 A
2655 V
(10645)210 1122 A
(struct)252 1440 A
(timer)210 1734 A
(*tp;)168 1986 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(timer)210 3372 A
(structure)378 3624 A
4044(*/)S
2745 V
(10646)210 1122 A
1440({)S
2835 V
(10647)210 1122 A
1440(/*)S
(The)126 1566 A
(timer)210 1734 A
(pointed)294 1986 A
2322(to)S
2448(by)S
('tp')168 2574 A
2784(is)S
2910(no)S
(longer)252 3036 A
(needed.)294 3330 A
(Remove)252 3666 A
3960(it)S
(from)168 4086 A
(both)168 4296 A
(the)126 4506 A
2925 V
(10648)210 1122 A
1482(*)S
(active)252 1566 A
(and)126 1860 A
(expired)294 2028 A
(lists.)252 2364 A
(Always)252 2658 A
(update)252 2952 A
(the)126 3246 A
(next)168 3414 A
(timeout)294 3624 A
(time)168 3960 A
4170(by)S
(setting)294 4296 A
3015 V
(10649)210 1122 A
1482(*)S
1566(it)S
1692(to)S
(the)126 1818 A
(front)210 1986 A
2238(of)S
(the)126 2364 A
(active)252 2532 A
(list.)210 2826 A
3105 V
(10650)210 1122 A
1482(*/)S
3195 V
(10651)210 1122 A
(tmrs_clrtimer\(&clock_timers,)1176 1524 A
(tp,)126 2742 A
(NULL\);)252 2910 A
3285 V
(10652)210 1122 A
(next_timeout)504 1524 A
2070(=)S
(\(clock_timers)546 2154 A
2742(==)S
(NULL\))210 2868 A
3120(?)S
3375 V
(10653)210 1122 A
(TMR_NEVER)378 1776 A
2196(:)S
(clock_timers->tmr_exp_time;)1134 2280 A
3465 V
(10654)210 1122 A
1440(})S
3645 V
(10656)210 1122 A
(/*===========================================================================*)3276 1440 A
3735 V
(10657)210 1122 A
1482(*)S
(read_clock)420 2784 A
4674(*)S
3825 V
(10658)210 1122 A
(*===========================================================================*/)3276 1482 A
3915 V
(10659)210 1122 A
(PUBLIC)252 1440 A
(unsigned)336 1734 A
(long)168 2112 A
(read_clock\(\))504 2322 A
4005 V
(10660)210 1122 A
1440({)S
4095 V
(10661)210 1122 A
1440(/*)S
(Read)168 1566 A
(the)126 1776 A
(counter)294 1944 A
2280(of)S
(channel)294 2406 A
2742(0)S
2826(of)S
(the)126 2952 A
(8253A)210 3120 A
(timer.)252 3372 A
(This)168 3708 A
(counter)294 3918 A
(counts)252 4254 A
4185 V
(10662)210 1122 A
1482(*)S
(down)168 1566 A
1776(at)S
1902(a)S
(rate)168 1986 A
2196(of)S
(TIMER_FREQ)420 2322 A
(and)126 2784 A
(restarts)336 2952 A
3330(at)S
(TIMER_COUNT-1)546 3456 A
(when)168 4044 A
4254(it)S
4275 V
(10663)210 1122 A
1482(*)S
(reaches)294 1566 A
(zero.)210 1902 A
2154(A)S
(hardware)336 2238 A
(interrupt)378 2616 A
(\(clock)252 3036 A
(tick\))210 3330 A
(occurs)252 3582 A
(when)168 3876 A
(the)126 4086 A
(counter)294 4254 A
4365 V
(10664)210 1122 A
1482(*)S
(gets)168 1566 A
1776(to)S
(zero)168 1902 A
(and)126 2112 A
(restarts)336 2280 A
(its)126 2658 A
(cycle.)252 2826 A
4455 V
(10665)210 1122 A
1482(*/)S
4545 V
(10666)210 1122 A
(unsigned)336 1524 A
(count;)252 1902 A
4635 V
(10667)210 1122 A
4725 V
(10668)210 1122 A
(outb\(TIMER_MODE,)672 1524 A
(LATCH_COUNT\);)546 2238 A
4815 V
(10669)210 1122 A
(count)210 1524 A
1776(=)S
(inb\(TIMER0\);)504 1860 A
4905 V
(10670)210 1122 A
(count)210 1524 A
1776(|=)S
(\(inb\(TIMER0\))504 1902 A
2448(<<)S
(8\);)126 2574 A
4995 V
(10671)210 1122 A
5085 V
(10672)210 1122 A
(return)252 1524 A
(count;)252 1818 A
5175 V
(10673)210 1122 A
1440(})S
5445 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5535 V
(drivers/drivers.h)714 2676 A
5625 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5805 V
(10700)210 1122 A
1440(/*)S
(This)168 1566 A
1776(is)S
(the)126 1902 A
(master)252 2070 A
(header)252 2364 A
(for)126 2658 A
(all)126 2826 A
(device)252 2994 A
(drivers.)336 3288 A
3666(It)S
(includes)336 3792 A
(some)168 4170 A
(other)210 4380 A
5895 V
(10701)210 1122 A
1482(*)S
(files)210 1566 A
(and)126 1818 A
(defines)294 1986 A
(the)126 2322 A
(principal)378 2490 A
(constants.)420 2910 A
5985 V
(10702)210 1122 A
1482(*/)S
6075 V
(10703)210 1122 A
(#define)294 1440 A
(_POSIX_SOURCE)546 1776 A
2574(1)S
2784(/*)S
(tell)168 2910 A
(headers)294 3120 A
3456(to)S
(include)294 3582 A
(POSIX)210 3918 A
(stuff)210 4170 A
4422(*/)S
6165 V
(10704)210 1122 A
(#define)294 1440 A
(_MINIX)252 1776 A
2574(1)S
2784(/*)S
(tell)168 2910 A
(headers)294 3120 A
3456(to)S
(include)294 3582 A
(MINIX)210 3918 A
(stuff)210 4170 A
4422(*/)S
6255 V
(10705)210 1122 A
(#define)294 1440 A
(_SYSTEM)294 1776 A
2574(1)S
2784(/*)S
(get)126 2910 A
(negative)336 3078 A
(error)210 3456 A
(number)252 3708 A
4002(in)S
(<errno.h>)378 4128 A
4548(*/)S
6345 V
(10706)210 1122 A
6435 V
(10707)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(are)126 2154 A
2322(so)S
(basic,)252 2448 A
(all)126 2742 A
(the)126 2910 A
(*.c)126 3078 A
(files)210 3246 A
(get)126 3498 A
(them)168 3666 A
(automatically.)588 3876 A
4506(*/)S
6525 V
(10708)210 1122 A
(#include)336 1440 A
(<minix/config.h>)672 1818 A
2784(/*)S
(MUST)168 2910 A
3120(be)S
(first)210 3246 A
3498(*/)S
6615 V
(10709)210 1122 A
(#include)336 1440 A
(<ansi.h>)336 1818 A
2784(/*)S
(MUST)168 2910 A
3120(be)S
(second)252 3246 A
3540(*/)S
6705 V
(10710)210 1122 A
(#include)336 1440 A
(<minix/type.h>)588 1818 A
6795 V
(10711)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
6885 V
(10712)210 1122 A
(#include)336 1440 A
(<minix/dmap.h>)588 1818 A
6975 V
(10713)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
7065 V
(10714)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
8418 V
EP
%%Page: 132 132
BP
/slant 0 def
/height 0 def
1485 V
12 B
(132)180 1080 A
11 R
2398(File:)S
2631(drivers/drivers.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(10715)210 1122 A
(#include)336 1440 A
(<minix/const.h>)630 1818 A
1845 V
(10716)210 1122 A
(#include)336 1440 A
(<minix/devio.h>)630 1818 A
1935 V
(10717)210 1122 A
(#include)336 1440 A
(<minix/syslib.h>)672 1818 A
2025 V
(10718)210 1122 A
(#include)336 1440 A
(<minix/sysutil.h>)714 1818 A
2115 V
(10719)210 1122 A
(#include)336 1440 A
(<minix/bitmap.h>)672 1818 A
2205 V
(10720)210 1122 A
2295 V
(10721)210 1122 A
(#include)336 1440 A
(<ibm/interrupt.h>)714 1818 A
2784(/*)S
(IRQ)126 2910 A
(vectors)294 3078 A
(and)126 3414 A
(miscellaneous)546 3582 A
(ports)210 4170 A
4422(*/)S
2385 V
(10722)210 1122 A
(#include)336 1440 A
(<ibm/bios.h>)504 1818 A
2784(/*)S
(BIOS)168 2910 A
(index)210 3120 A
(numbers)294 3372 A
3708(*/)S
2475 V
(10723)210 1122 A
(#include)336 1440 A
(<ibm/ports.h>)546 1818 A
2784(/*)S
(Well-known)420 2910 A
(ports)210 3372 A
3624(*/)S
2565 V
(10724)210 1122 A
2655 V
(10725)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
2745 V
(10726)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
2835 V
(10727)210 1122 A
(#include)336 1440 A
(<stdlib.h>)420 1818 A
2925 V
(10728)210 1122 A
(#include)336 1440 A
(<limits.h>)420 1818 A
3015 V
(10729)210 1122 A
(#include)336 1440 A
(<stddef.h>)420 1818 A
3105 V
(10730)210 1122 A
(#include)336 1440 A
(<errno.h>)378 1818 A
3195 V
(10731)210 1122 A
(#include)336 1440 A
(<unistd.h>)420 1818 A
3285 V
(10732)210 1122 A
3645 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3735 V
(drivers/libdriver/driver.h)1092 2676 A
3825 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4005 V
(10800)210 1122 A
1440(/*)S
(Types)210 1566 A
(and)126 1818 A
(constants)378 1986 A
(shared)252 2406 A
(between)294 2700 A
(the)126 3036 A
(generic)294 3204 A
(and)126 3540 A
(device)252 3708 A
(dependent)378 4002 A
4095 V
(10801)210 1122 A
1482(*)S
(device)252 1566 A
(driver)252 1860 A
(code.)210 2154 A
4185 V
(10802)210 1122 A
1482(*/)S
4275 V
(10803)210 1122 A
4365 V
(10804)210 1122 A
(#define)294 1440 A
(_POSIX_SOURCE)546 1776 A
2574(1)S
2784(/*)S
(tell)168 2910 A
(headers)294 3120 A
3456(to)S
(include)294 3582 A
(POSIX)210 3918 A
(stuff)210 4170 A
4422(*/)S
4455 V
(10805)210 1122 A
(#define)294 1440 A
(_MINIX)252 1776 A
2574(1)S
2784(/*)S
(tell)168 2910 A
(headers)294 3120 A
3456(to)S
(include)294 3582 A
(MINIX)210 3918 A
(stuff)210 4170 A
4422(*/)S
4545 V
(10806)210 1122 A
(#define)294 1440 A
(_SYSTEM)294 1776 A
2574(1)S
2784(/*)S
(get)126 2910 A
(negative)336 3078 A
(error)210 3456 A
(number)252 3708 A
4002(in)S
(<errno.h>)378 4128 A
4548(*/)S
4635 V
(10807)210 1122 A
4725 V
(10808)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(are)126 2154 A
2322(so)S
(basic,)252 2448 A
(all)126 2742 A
(the)126 2910 A
(*.c)126 3078 A
(files)210 3246 A
(get)126 3498 A
(them)168 3666 A
(automatically.)588 3876 A
4506(*/)S
4815 V
(10809)210 1122 A
(#include)336 1440 A
(<minix/config.h>)672 1818 A
2784(/*)S
(MUST)168 2910 A
3120(be)S
(first)210 3246 A
3498(*/)S
4905 V
(10810)210 1122 A
(#include)336 1440 A
(<ansi.h>)336 1818 A
2784(/*)S
(MUST)168 2910 A
3120(be)S
(second)252 3246 A
3540(*/)S
4995 V
(10811)210 1122 A
(#include)336 1440 A
(<minix/type.h>)588 1818 A
5085 V
(10812)210 1122 A
(#include)336 1440 A
(<minix/ipc.h>)546 1818 A
5175 V
(10813)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
5265 V
(10814)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
5355 V
(10815)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
5445 V
(10816)210 1122 A
(#include)336 1440 A
(<minix/const.h>)630 1818 A
5535 V
(10817)210 1122 A
(#include)336 1440 A
(<minix/syslib.h>)672 1818 A
5625 V
(10818)210 1122 A
(#include)336 1440 A
(<minix/sysutil.h>)714 1818 A
5715 V
(10819)210 1122 A
5805 V
(10820)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
5895 V
(10821)210 1122 A
(#include)336 1440 A
(<limits.h>)420 1818 A
5985 V
(10822)210 1122 A
(#include)336 1440 A
(<stddef.h>)420 1818 A
6075 V
(10823)210 1122 A
(#include)336 1440 A
(<errno.h>)378 1818 A
6165 V
(10824)210 1122 A
6255 V
(10825)210 1122 A
(#include)336 1440 A
(<minix/partition.h>)798 1818 A
6345 V
(10826)210 1122 A
(#include)336 1440 A
(<minix/u64.h>)546 1818 A
6435 V
(10827)210 1122 A
6525 V
(10828)210 1122 A
1440(/*)S
(Info)168 1566 A
(about)210 1776 A
(and)126 2028 A
(entry)210 2196 A
(points)252 2448 A
(into)168 2742 A
(the)126 2952 A
(device)252 3120 A
(dependent)378 3414 A
(code.)210 3834 A
4086(*/)S
6615 V
(10829)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
2028({)S
6705 V
(10830)210 1122 A
(_PROTOTYPE\()462 1524 A
(char)168 2028 A
(*\(*dr_name\),)504 2238 A
(\(void\))252 2784 A
3078(\);)S
6795 V
(10831)210 1122 A
(_PROTOTYPE\()462 1524 A
(int)126 2028 A
(\(*dr_open\),)462 2196 A
(\(struct)294 2700 A
(driver)252 3036 A
(*dp,)168 3330 A
(message)294 3540 A
(*m_ptr\))294 3876 A
4212(\);)S
6885 V
(10832)210 1122 A
(_PROTOTYPE\()462 1524 A
(int)126 2028 A
(\(*dr_close\),)504 2196 A
(\(struct)294 2742 A
(driver)252 3078 A
(*dp,)168 3372 A
(message)294 3582 A
(*m_ptr\))294 3918 A
4254(\);)S
6975 V
(10833)210 1122 A
(_PROTOTYPE\()462 1524 A
(int)126 2028 A
(\(*dr_ioctl\),)504 2196 A
(\(struct)294 2742 A
(driver)252 3078 A
(*dp,)168 3372 A
(message)294 3582 A
(*m_ptr\))294 3918 A
4254(\);)S
7065 V
(10834)210 1122 A
(_PROTOTYPE\()462 1524 A
(struct)252 2028 A
(device)252 2322 A
(*\(*dr_prepare\),)630 2616 A
(\(int)168 3288 A
(device\))294 3498 A
3834(\);)S
8418 V
EP
%%Page: 133 133
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2213(File:)S
(drivers/libdriver/driver.h)1100 2446 A
12 B
(133)180 4500 A
1755 V
7 LST
(10835)210 1122 A
(_PROTOTYPE\()462 1524 A
(int)126 2028 A
(\(*dr_transfer\),)630 2196 A
(\(int)168 2868 A
(proc_nr,)336 3078 A
(int)126 3456 A
(opcode,)294 3624 A
(off_t)210 3960 A
(position,)378 4212 A
1845 V
(10836)210 1122 A
(iovec_t)294 3120 A
(*iov,)210 3456 A
(unsigned)336 3708 A
(nr_req\))294 4086 A
4422(\);)S
1935 V
(10837)210 1122 A
(_PROTOTYPE\()462 1524 A
(void)168 2028 A
(\(*dr_cleanup\),)588 2238 A
(\(void\))252 2868 A
3162(\);)S
2025 V
(10838)210 1122 A
(_PROTOTYPE\()462 1524 A
(void)168 2028 A
(\(*dr_geometry\),)630 2238 A
(\(struct)294 2910 A
(partition)378 3246 A
(*entry\))294 3666 A
4002(\);)S
2115 V
(10839)210 1122 A
(_PROTOTYPE\()462 1524 A
(void)168 2028 A
(\(*dr_signal\),)546 2238 A
(\(struct)294 2826 A
(driver)252 3162 A
(*dp,)168 3456 A
(message)294 3666 A
(*m_ptr\))294 4002 A
4338(\);)S
2205 V
(10840)210 1122 A
(_PROTOTYPE\()462 1524 A
(void)168 2028 A
(\(*dr_alarm\),)504 2238 A
(\(struct)294 2784 A
(driver)252 3120 A
(*dp,)168 3414 A
(message)294 3624 A
(*m_ptr\))294 3960 A
4296(\);)S
2295 V
(10841)210 1122 A
(_PROTOTYPE\()462 1524 A
(int)126 2028 A
(\(*dr_cancel\),)546 2196 A
(\(struct)294 2784 A
(driver)252 3120 A
(*dp,)168 3414 A
(message)294 3624 A
(*m_ptr\))294 3960 A
4296(\);)S
2385 V
(10842)210 1122 A
(_PROTOTYPE\()462 1524 A
(int)126 2028 A
(\(*dr_select\),)546 2196 A
(\(struct)294 2784 A
(driver)252 3120 A
(*dp,)168 3414 A
(message)294 3624 A
(*m_ptr\))294 3960 A
4296(\);)S
2475 V
(10843)210 1122 A
(_PROTOTYPE\()462 1524 A
(int)126 2028 A
(\(*dr_other\),)504 2196 A
(\(struct)294 2742 A
(driver)252 3078 A
(*dp,)168 3372 A
(message)294 3582 A
(*m_ptr\))294 3918 A
4254(\);)S
2565 V
(10844)210 1122 A
(_PROTOTYPE\()462 1524 A
(int)126 2028 A
(\(*dr_hw_int\),)546 2196 A
(\(struct)294 2784 A
(driver)252 3120 A
(*dp,)168 3414 A
(message)294 3624 A
(*m_ptr\))294 3960 A
4296(\);)S
2655 V
(10845)210 1122 A
1440(};)S
2745 V
(10846)210 1122 A
2835 V
(10847)210 1122 A
(#if)126 1440 A
(\(CHIP)210 1608 A
1860(==)S
(INTEL\))252 1986 A
2925 V
(10848)210 1122 A
3015 V
(10849)210 1122 A
1440(/*)S
(Number)252 1566 A
1860(of)S
(bytes)210 1986 A
(you)126 2238 A
(can)126 2406 A
(DMA)126 2574 A
(before)252 2742 A
(hitting)294 3036 A
3372(a)S
(64K)126 3456 A
(boundary:)378 3624 A
4044(*/)S
3105 V
(10850)210 1122 A
(#define)294 1440 A
(dma_bytes_left\(phys\))840 1776 A
2784(\\)S
3195 V
(10851)210 1122 A
(\(\(unsigned\))462 1566 A
(\(sizeof\(int\))504 2070 A
2616(==)S
2742(2)S
2826(?)S
2910(0)S
2994(:)S
(0x10000\))336 3078 A
3456(-)S
(\(unsigned\))420 3540 A
(\(\(phys\))294 4002 A
4338(&)S
(0xFFFF\)\))336 4422 A
3285 V
(10852)210 1122 A
3375 V
(10853)210 1122 A
(#endif)252 1440 A
1734(/*)S
(CHIP)168 1860 A
2070(==)S
(INTEL)210 2196 A
2448(*/)S
3465 V
(10854)210 1122 A
3555 V
(10855)210 1122 A
1440(/*)S
(Base)168 1566 A
(and)126 1776 A
(size)168 1944 A
2154(of)S
2280(a)S
(partition)378 2364 A
2784(in)S
(bytes.)252 2910 A
3204(*/)S
3645 V
(10856)210 1122 A
(struct)252 1440 A
(device)252 1734 A
2028({)S
3735 V
(10857)210 1122 A
(u64_t)210 1524 A
(dv_base;)336 1776 A
3825 V
(10858)210 1122 A
(u64_t)210 1524 A
(dv_size;)336 1776 A
3915 V
(10859)210 1122 A
1440(};)S
4005 V
(10860)210 1122 A
4095 V
(10861)210 1122 A
(#define)294 1440 A
(NIL_DEV)294 1776 A
(\(\(struct)336 2448 A
(device)252 2826 A
3120(*\))S
3246(0\))S
4185 V
(10862)210 1122 A
4275 V
(10863)210 1122 A
1440(/*)S
(Functions)378 1566 A
(defined)294 1986 A
2322(by)S
(driver.c:)378 2448 A
2868(*/)S
4365 V
(10864)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(driver_task,)504 2154 A
(\(struct)294 2700 A
(driver)252 3036 A
(*dr\))168 3330 A
3540(\);)S
4455 V
(10865)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*no_name,)378 2154 A
(\(void\))252 2574 A
2868(\);)S
4545 V
(10866)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_nop,)294 2112 A
(\(struct)294 2448 A
(driver)252 2784 A
(*dp,)168 3078 A
(message)294 3288 A
(*m_ptr\))294 3624 A
3960(\);)S
4635 V
(10867)210 1122 A
(_PROTOTYPE\()462 1440 A
(struct)252 1944 A
(device)252 2238 A
(*nop_prepare,)546 2532 A
(\(int)168 3120 A
(device\))294 3330 A
3666(\);)S
4725 V
(10868)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(nop_cleanup,)504 2154 A
(\(void\))252 2700 A
2994(\);)S
4815 V
(10869)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(nop_task,)378 2154 A
(\(void\))252 2574 A
2868(\);)S
4905 V
(10870)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(nop_signal,)462 2154 A
(\(struct)294 2658 A
(driver)252 2994 A
(*dp,)168 3288 A
(message)294 3498 A
(*m_ptr\))294 3834 A
4170(\);)S
4995 V
(10871)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(nop_alarm,)420 2154 A
(\(struct)294 2616 A
(driver)252 2952 A
(*dp,)168 3246 A
(message)294 3456 A
(*m_ptr\))294 3792 A
4128(\);)S
5085 V
(10872)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(nop_cancel,)462 2112 A
(\(struct)294 2616 A
(driver)252 2952 A
(*dp,)168 3246 A
(message)294 3456 A
(*m_ptr\))294 3792 A
4128(\);)S
5175 V
(10873)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(nop_select,)462 2112 A
(\(struct)294 2616 A
(driver)252 2952 A
(*dp,)168 3246 A
(message)294 3456 A
(*m_ptr\))294 3792 A
4128(\);)S
5265 V
(10874)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_diocntl,)462 2112 A
(\(struct)294 2616 A
(driver)252 2952 A
(*dp,)168 3246 A
(message)294 3456 A
(*m_ptr\))294 3792 A
4128(\);)S
5355 V
(10875)210 1122 A
5445 V
(10876)210 1122 A
1440(/*)S
(Parameters)420 1566 A
(for)126 2028 A
(the)126 2196 A
(disk)168 2364 A
(drive.)252 2574 A
2868(*/)S
5535 V
(10877)210 1122 A
(#define)294 1440 A
(SECTOR_SIZE)462 1776 A
(512)126 2490 A
2784(/*)S
(physical)336 2910 A
(sector)252 3288 A
(size)168 3582 A
3792(in)S
(bytes)210 3918 A
4170(*/)S
5625 V
(10878)210 1122 A
(#define)294 1440 A
(SECTOR_SHIFT)504 1776 A
2574(9)S
2784(/*)S
(for)126 2910 A
(division)336 3078 A
3456(*/)S
5715 V
(10879)210 1122 A
(#define)294 1440 A
(SECTOR_MASK)462 1776 A
(511)126 2490 A
2784(/*)S
(and)126 2910 A
(remainder)378 3078 A
3498(*/)S
5805 V
(10880)210 1122 A
5895 V
(10881)210 1122 A
1440(/*)S
(Size)168 1566 A
1776(of)S
(the)126 1902 A
(DMA)126 2070 A
(buffer)252 2238 A
(buffer)252 2532 A
2826(in)S
(bytes.)252 2952 A
3246(*/)S
5985 V
(10882)210 1122 A
(#define)294 1440 A
(USE_EXTRA_DMA_BUF)714 1776 A
2574(0)S
2784(/*)S
(usually)294 2910 A
(not)126 3246 A
(needed)252 3414 A
3708(*/)S
6075 V
(10883)210 1122 A
(#define)294 1440 A
(DMA_BUF_SIZE)504 1776 A
(\(DMA_SECTORS)504 2448 A
2994(*)S
(SECTOR_SIZE\))504 3078 A
6165 V
(10884)210 1122 A
6255 V
(10885)210 1122 A
(#if)126 1440 A
(\(CHIP)210 1608 A
1860(==)S
(INTEL\))252 1986 A
6345 V
(10886)210 1122 A
(extern)252 1440 A
(u8_t)168 1734 A
(*tmp_buf;)378 1944 A
3120(/*)S
(the)126 3246 A
(DMA)126 3414 A
(buffer)252 3582 A
3876(*/)S
6435 V
(10887)210 1122 A
(#else)210 1440 A
6525 V
(10888)210 1122 A
(extern)252 1440 A
(u8_t)168 1734 A
(tmp_buf[];)420 1944 A
3120(/*)S
(the)126 3246 A
(DMA)126 3414 A
(buffer)252 3582 A
3876(*/)S
6615 V
(10889)210 1122 A
(#endif)252 1440 A
6705 V
(10890)210 1122 A
(extern)252 1440 A
(phys_bytes)420 1734 A
(tmp_phys;)378 2196 A
3120(/*)S
(phys)168 3246 A
(address)294 3456 A
3792(of)S
(DMA)126 3918 A
(buffer)252 4086 A
4380(*/)S
8418 V
EP
%%Page: 134 134
BP
/slant 0 def
/height 0 def
1485 V
12 B
(134)180 1080 A
11 R
2214(File:)S
(drivers/libdriver/drvlib.h)1099 2447 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(drivers/libdriver/drvlib.h)1092 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(10900)210 1122 A
1440(/*)S
(IBM)126 1566 A
(device)252 1734 A
(driver)252 2028 A
(definitions)462 2322 A
(Author:)294 3792 A
(Kees)168 4128 A
4338(J.)S
(Bot)126 4464 A
2295 V
(10901)210 1122 A
1482(*)S
4128(7)S
(Dec)126 4212 A
(1995)168 4380 A
2385 V
(10902)210 1122 A
1482(*/)S
2475 V
(10903)210 1122 A
2565 V
(10904)210 1122 A
(#include)336 1440 A
(<ibm/partition.h>)714 1818 A
2655 V
(10905)210 1122 A
2745 V
(10906)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(partition,)420 2154 A
(\(struct)294 2616 A
(driver)252 2952 A
(*dr,)168 3246 A
(int)126 3456 A
(device,)294 3624 A
(int)126 3960 A
(style,)252 4128 A
(int)126 4422 A
(atapi\))252 4590 A
4884(\);)S
2835 V
(10907)210 1122 A
2925 V
(10908)210 1122 A
1440(/*)S
(BIOS)168 1566 A
(parameter)378 1776 A
(table)210 2196 A
(layout.)294 2448 A
2784(*/)S
3015 V
(10909)210 1122 A
(#define)294 1440 A
(bp_cylinders\(t\))630 1776 A
2784(\(*)S
(\(u16_t)252 2910 A
3204(*\))S
(\(&\(t\)[0]\)\))420 3330 A
3105 V
(10910)210 1122 A
(#define)294 1440 A
(bp_heads\(t\))462 1776 A
2784(\(*)S
(\(u8_t)210 2910 A
3162(*\))S
(\(&\(t\)[2]\)\))420 3330 A
3195 V
(10911)210 1122 A
(#define)294 1440 A
(bp_reduced_wr\(t\))672 1776 A
2784(\(*)S
(\(u16_t)252 2910 A
3204(*\))S
(\(&\(t\)[3]\)\))420 3330 A
3285 V
(10912)210 1122 A
(#define)294 1440 A
(bp_precomp\(t\))546 1776 A
2784(\(*)S
(\(u16_t)252 2910 A
3204(*\))S
(\(&\(t\)[5]\)\))420 3330 A
3375 V
(10913)210 1122 A
(#define)294 1440 A
(bp_max_ecc\(t\))546 1776 A
2784(\(*)S
(\(u8_t)210 2910 A
3162(*\))S
(\(&\(t\)[7]\)\))420 3330 A
3465 V
(10914)210 1122 A
(#define)294 1440 A
(bp_ctlbyte\(t\))546 1776 A
2784(\(*)S
(\(u8_t)210 2910 A
3162(*\))S
(\(&\(t\)[8]\)\))420 3330 A
3555 V
(10915)210 1122 A
(#define)294 1440 A
(bp_landingzone\(t\))714 1776 A
2784(\(*)S
(\(u16_t)252 2910 A
3204(*\))S
(\(&\(t\)[12]\)\))462 3330 A
3645 V
(10916)210 1122 A
(#define)294 1440 A
(bp_sectors\(t\))546 1776 A
2784(\(*)S
(\(u8_t)210 2910 A
3162(*\))S
(\(&\(t\)[14]\)\))462 3330 A
3735 V
(10917)210 1122 A
3825 V
(10918)210 1122 A
1440(/*)S
(Miscellaneous.)588 1566 A
2196(*/)S
3915 V
(10919)210 1122 A
(#define)294 1440 A
(DEV_PER_DRIVE)546 1776 A
2448(\(1)S
2574(+)S
(NR_PARTITIONS\))588 2658 A
4005 V
(10920)210 1122 A
(#define)294 1440 A
(MINOR_t0)336 1776 A
2448(64)S
4095 V
(10921)210 1122 A
(#define)294 1440 A
(MINOR_r0)336 1776 A
(120)126 2448 A
4185 V
(10922)210 1122 A
(#define)294 1440 A
(MINOR_d0p0s0)504 1776 A
(128)126 2448 A
4275 V
(10923)210 1122 A
(#define)294 1440 A
(MINOR_fd0p0)462 1776 A
(\(28<<2\))294 2448 A
4365 V
(10924)210 1122 A
(#define)294 1440 A
(P_FLOPPY)336 1776 A
2448(0)S
4455 V
(10925)210 1122 A
(#define)294 1440 A
(P_PRIMARY)378 1776 A
2448(1)S
4545 V
(10926)210 1122 A
(#define)294 1440 A
(P_SUB)210 1776 A
2448(2)S
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(drivers/libdriver/driver.c)1092 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(11000)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(device)252 2364 A
(independent)462 2658 A
(device)252 3162 A
(driver)252 3456 A
(interface.)420 3750 A
5445 V
(11001)210 1122 A
1482(*)S
5535 V
(11002)210 1122 A
1482(*)S
(Changes:)336 1566 A
5625 V
(11003)210 1122 A
1482(*)S
(Jul)126 1650 A
(25,)126 1818 A
(2005)168 1986 A
(added)210 2280 A
(SYS_SIG)294 2532 A
(type)168 2868 A
(for)126 3078 A
(signals)294 3246 A
(\(Jorrit)294 3624 A
3960(N.)S
(Herder\))294 4086 A
5715 V
(11004)210 1122 A
1482(*)S
(Sep)126 1650 A
(15,)126 1818 A
(2004)168 1986 A
(added)210 2280 A
(SYN_ALARM)378 2532 A
(type)168 2952 A
(for)126 3162 A
(timeouts)336 3330 A
(\(Jorrit)294 3750 A
4086(N.)S
(Herder\))294 4212 A
5805 V
(11005)210 1122 A
1482(*)S
(Jul)126 1650 A
(23,)126 1818 A
(2004)168 1986 A
(removed)294 2280 A
(kernel)252 2616 A
(dependencies)504 2910 A
(\(Jorrit)294 3498 A
3834(N.)S
(Herder\))294 3960 A
5895 V
(11006)210 1122 A
1482(*)S
(Apr)126 1650 A
(02,)126 1818 A
(1992)168 1986 A
(constructed)462 2280 A
(from)168 2784 A
2994(AT)S
(wini)168 3120 A
(and)126 3330 A
(floppy)252 3498 A
(driver)252 3792 A
(\(Kees)210 4128 A
4380(J.)S
(Bot\))168 4506 A
5985 V
(11007)210 1122 A
1482(*)S
6075 V
(11008)210 1122 A
1482(*)S
6165 V
(11009)210 1122 A
1482(*)S
(The)126 1566 A
(drivers)294 1734 A
(support)294 2070 A
(the)126 2406 A
(following)378 2574 A
(operations)420 2994 A
(\(using)252 3456 A
(message)294 3750 A
(format)252 4086 A
(m2\):)168 4380 A
6255 V
(11010)210 1122 A
1482(*)S
6345 V
(11011)210 1122 A
1482(*)S
(m_type)252 1692 A
(DEVICE)252 2196 A
(PROC_NR)294 2616 A
(COUNT)210 3120 A
(POSITION)336 3498 A
(ADRRESS)294 3918 A
6435 V
(11012)210 1122 A
1482(*)S
(----------------------------------------------------------------)2688 1566 A
6525 V
(11013)210 1122 A
1482(*)S
1566(|)S
(DEV_OPEN)336 1692 A
2112(|)S
(device)252 2196 A
2532(|)S
(proc)168 2616 A
2826(nr)S
2952(|)S
3372(|)S
3792(|)S
4212(|)S
6615 V
(11014)210 1122 A
1482(*)S
(|------------+---------+---------+---------+---------+---------|)2688 1566 A
6705 V
(11015)210 1122 A
1482(*)S
1566(|)S
(DEV_CLOSE)378 1692 A
2112(|)S
(device)252 2196 A
2532(|)S
(proc)168 2616 A
2826(nr)S
2952(|)S
3372(|)S
3792(|)S
4212(|)S
6795 V
(11016)210 1122 A
1482(*)S
(|------------+---------+---------+---------+---------+---------|)2688 1566 A
6885 V
(11017)210 1122 A
1482(*)S
1566(|)S
(DEV_READ)336 1692 A
2112(|)S
(device)252 2196 A
2532(|)S
(proc)168 2616 A
2826(nr)S
2952(|)S
(bytes)210 3078 A
3372(|)S
(offset)252 3498 A
3792(|)S
(buf)126 3876 A
(ptr)126 4044 A
4212(|)S
6975 V
(11018)210 1122 A
1482(*)S
(|------------+---------+---------+---------+---------+---------|)2688 1566 A
7065 V
(11019)210 1122 A
1482(*)S
1566(|)S
(DEV_WRITE)378 1692 A
2112(|)S
(device)252 2196 A
2532(|)S
(proc)168 2616 A
2826(nr)S
2952(|)S
(bytes)210 3078 A
3372(|)S
(offset)252 3498 A
3792(|)S
(buf)126 3876 A
(ptr)126 4044 A
4212(|)S
8418 V
EP
%%Page: 135 135
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2216(File:)S
(drivers/libdriver/driver.c)1095 2449 A
12 B
(135)180 4500 A
1755 V
7 LST
(11020)210 1122 A
1482(*)S
(|------------+---------+---------+---------+---------+---------|)2688 1566 A
1845 V
(11021)210 1122 A
1482(*)S
1566(|)S
(DEV_GATHER)420 1650 A
2112(|)S
(device)252 2196 A
2532(|)S
(proc)168 2616 A
2826(nr)S
2952(|)S
(iov)126 3036 A
(len)126 3204 A
3372(|)S
(offset)252 3498 A
3792(|)S
(iov)126 3876 A
(ptr)126 4044 A
4212(|)S
1935 V
(11022)210 1122 A
1482(*)S
(|------------+---------+---------+---------+---------+---------|)2688 1566 A
2025 V
(11023)210 1122 A
1482(*)S
1566(|)S
(DEV_SCATTER|)504 1650 A
(device)252 2196 A
2532(|)S
(proc)168 2616 A
2826(nr)S
2952(|)S
(iov)126 3036 A
(len)126 3204 A
3372(|)S
(offset)252 3498 A
3792(|)S
(iov)126 3876 A
(ptr)126 4044 A
4212(|)S
2115 V
(11024)210 1122 A
1482(*)S
(|------------+---------+---------+---------+---------+---------|)2688 1566 A
2205 V
(11025)210 1122 A
1482(*)S
1566(|)S
(DEV_IOCTL)378 1692 A
2112(|)S
(device)252 2196 A
2532(|)S
(proc)168 2616 A
2826(nr)S
(|func)210 2952 A
(code|)210 3204 A
3792(|)S
(buf)126 3876 A
(ptr)126 4044 A
4212(|)S
2295 V
(11026)210 1122 A
1482(*)S
(|------------+---------+---------+---------+---------+---------|)2688 1566 A
2385 V
(11027)210 1122 A
1482(*)S
1566(|)S
(CANCEL)252 1692 A
2112(|)S
(device)252 2196 A
2532(|)S
(proc)168 2616 A
2826(nr)S
2952(|)S
(r/w)126 3036 A
3372(|)S
3792(|)S
4212(|)S
2475 V
(11028)210 1122 A
1482(*)S
(|------------+---------+---------+---------+---------+---------|)2688 1566 A
2565 V
(11029)210 1122 A
1482(*)S
1566(|)S
(HARD_STOP)378 1692 A
2112(|)S
2532(|)S
2952(|)S
3372(|)S
3792(|)S
4212(|)S
2655 V
(11030)210 1122 A
1482(*)S
(----------------------------------------------------------------)2688 1566 A
2745 V
(11031)210 1122 A
1482(*)S
2835 V
(11032)210 1122 A
1482(*)S
(The)126 1566 A
(file)168 1734 A
(contains)336 1944 A
(one)126 2322 A
(entry)210 2490 A
(point:)252 2742 A
2925 V
(11033)210 1122 A
1482(*)S
3015 V
(11034)210 1122 A
1482(*)S
(driver_task:)504 1650 A
(called)252 2448 A
2742(by)S
(the)126 2868 A
(device)252 3036 A
(dependent)378 3330 A
(task)168 3750 A
(entry)210 3960 A
3105 V
(11035)210 1122 A
1482(*/)S
3195 V
(11036)210 1122 A
3285 V
(11037)210 1122 A
(#include)336 1440 A
("../drivers.h")588 1818 A
3375 V
(11038)210 1122 A
(#include)336 1440 A
(<sys/ioc_disk.h>)672 1818 A
3465 V
(11039)210 1122 A
(#include)336 1440 A
("driver.h")420 1818 A
3555 V
(11040)210 1122 A
3645 V
(11041)210 1122 A
(#define)294 1440 A
(BUF_EXTRA)378 1776 A
2448(0)S
3735 V
(11042)210 1122 A
3825 V
(11043)210 1122 A
1440(/*)S
(Claim)210 1566 A
(space)210 1818 A
(for)126 2070 A
(variables.)420 2238 A
2700(*/)S
3915 V
(11044)210 1122 A
(PRIVATE)294 1440 A
(u8_t)168 1776 A
(buffer[\(unsigned\))714 1986 A
2742(2)S
2826(*)S
(DMA_BUF_SIZE)504 2910 A
3456(+)S
(BUF_EXTRA];)462 3540 A
4005 V
(11045)210 1122 A
(u8_t)168 1440 A
(*tmp_buf;)378 1650 A
2784(/*)S
(the)126 2910 A
(DMA)126 3078 A
(buffer)252 3246 A
(eventually)420 3540 A
4002(*/)S
4095 V
(11046)210 1122 A
(phys_bytes)420 1440 A
(tmp_phys;)378 1902 A
2784(/*)S
(phys)168 2910 A
(address)294 3120 A
3456(of)S
(DMA)126 3582 A
(buffer)252 3750 A
4044(*/)S
4185 V
(11047)210 1122 A
4275 V
(11048)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(init_buffer,)504 2490 A
(\(void\))252 3036 A
3330(\);)S
4365 V
(11049)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(do_rdwt,)336 2448 A
(\(struct)294 2826 A
(driver)252 3162 A
(*dr,)168 3456 A
(message)294 3666 A
(*mp\))168 4002 A
4212(\);)S
4455 V
(11050)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(do_vrdwt,)378 2448 A
(\(struct)294 2868 A
(driver)252 3204 A
(*dr,)168 3498 A
(message)294 3708 A
(*mp\))168 4044 A
4254(\);)S
4545 V
(11051)210 1122 A
4635 V
(11052)210 1122 A
(int)126 1440 A
(device_caller;)588 1608 A
4725 V
(11053)210 1122 A
4815 V
(11054)210 1122 A
(/*===========================================================================*)3276 1440 A
4905 V
(11055)210 1122 A
1482(*)S
(driver_task)462 2784 A
4674(*)S
4995 V
(11056)210 1122 A
(*===========================================================================*/)3276 1482 A
5085 V
(11057)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(driver_task\(dp\))630 1944 A
5175 V
(11058)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dp;)168 2028 A
2448(/*)S
(Device)252 2574 A
(dependent)378 2868 A
(entry)210 3288 A
(points.)294 3540 A
3876(*/)S
5265 V
(11059)210 1122 A
1440({)S
5355 V
(11060)210 1122 A
1440(/*)S
(Main)168 1566 A
(program)294 1776 A
2112(of)S
(any)126 2238 A
(device)252 2406 A
(driver)252 2700 A
(task.)210 2994 A
3246(*/)S
5445 V
(11061)210 1122 A
5535 V
(11062)210 1122 A
(int)126 1524 A
1692(r,)S
(proc_nr;)336 1818 A
5625 V
(11063)210 1122 A
(message)294 1524 A
(mess;)210 1860 A
5715 V
(11064)210 1122 A
5805 V
(11065)210 1122 A
1524(/*)S
(Get)126 1650 A
1818(a)S
(DMA)126 1902 A
(buffer.)294 2070 A
2406(*/)S
5895 V
(11066)210 1122 A
(init_buffer\(\);)588 1524 A
5985 V
(11067)210 1122 A
6075 V
(11068)210 1122 A
1524(/*)S
(Here)168 1650 A
1860(is)S
(the)126 1986 A
(main)168 2154 A
(loop)168 2364 A
2574(of)S
(the)126 2700 A
(disk)168 2868 A
(task.)210 3078 A
3372(It)S
(waits)210 3498 A
(for)126 3750 A
3918(a)S
(message,)336 4002 A
(carries)294 4380 A
6165 V
(11069)210 1122 A
1566(*)S
1650(it)S
(out,)168 1776 A
(and)126 1986 A
(sends)210 2154 A
2406(a)S
(reply.)252 2490 A
6255 V
(11070)210 1122 A
1566(*/)S
6345 V
(11071)210 1122 A
(while)210 1524 A
(\(TRUE\))252 1776 A
2070({)S
6435 V
(11072)210 1122 A
6525 V
(11073)210 1122 A
1776(/*)S
(Wait)168 1902 A
(for)126 2112 A
2280(a)S
(request)294 2364 A
2700(to)S
(read)168 2826 A
3036(or)S
(write)210 3162 A
3414(a)S
(disk)168 3498 A
(block.)252 3708 A
4002(*/)S
6615 V
(11074)210 1122 A
(if\(receive\(ANY,)630 1776 A
(&mess\))252 2448 A
2742(!=)S
(OK\))126 2868 A
(continue;)378 3036 A
6705 V
(11075)210 1122 A
6795 V
(11076)210 1122 A
(device_caller)546 1776 A
2364(=)S
(mess.m_source;)588 2448 A
6885 V
(11077)210 1122 A
(proc_nr)294 1776 A
2112(=)S
(mess.PROC_NR;)546 2196 A
6975 V
(11078)210 1122 A
7065 V
(11079)210 1122 A
1776(/*)S
(Now)126 1902 A
(carry)210 2070 A
(out)126 2322 A
(the)126 2490 A
(work.)210 2658 A
2910(*/)S
8418 V
EP
%%Page: 136 136
BP
/slant 0 def
/height 0 def
1485 V
12 B
(136)180 1080 A
11 R
2216(File:)S
(drivers/libdriver/driver.c)1095 2449 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(11080)210 1122 A
(switch\(mess.m_type\))798 1776 A
2616({)S
1845 V
(11081)210 1122 A
(case)168 1776 A
(DEV_OPEN:)378 1986 A
2784(r)S
2868(=)S
(\(*dp->dr_open\)\(dp,)756 2952 A
(&mess\);)294 3750 A
(break;)252 4128 A
1935 V
(11082)210 1122 A
(case)168 1776 A
(DEV_CLOSE:)420 1986 A
2784(r)S
2868(=)S
(\(*dp->dr_close\)\(dp,)798 2952 A
(&mess\);)294 3792 A
(break;)252 4128 A
2025 V
(11083)210 1122 A
(case)168 1776 A
(DEV_IOCTL:)420 1986 A
2784(r)S
2868(=)S
(\(*dp->dr_ioctl\)\(dp,)798 2952 A
(&mess\);)294 3792 A
(break;)252 4128 A
2115 V
(11084)210 1122 A
(case)168 1776 A
(CANCEL:)294 1986 A
2784(r)S
2868(=)S
(\(*dp->dr_cancel\)\(dp,)840 2952 A
(&mess\);break;)546 3834 A
2205 V
(11085)210 1122 A
(case)168 1776 A
(DEV_SELECT:)462 1986 A
2784(r)S
2868(=)S
(\(*dp->dr_select\)\(dp,)840 2952 A
(&mess\);break;)546 3834 A
2295 V
(11086)210 1122 A
2385 V
(11087)210 1122 A
(case)168 1776 A
(DEV_READ:)378 1986 A
2475 V
(11088)210 1122 A
(case)168 1776 A
(DEV_WRITE:)420 1986 A
2532(r)S
2616(=)S
(do_rdwt\(dp,)462 2700 A
(&mess\);)294 3204 A
(break;)252 3792 A
2565 V
(11089)210 1122 A
(case)168 1776 A
(DEV_GATHER:)462 1986 A
2655 V
(11090)210 1122 A
(case)168 1776 A
(DEV_SCATTER:)504 1986 A
2532(r)S
2616(=)S
(do_vrdwt\(dp,)504 2700 A
(&mess\);)294 3246 A
(break;)252 3792 A
2745 V
(11091)210 1122 A
2835 V
(11092)210 1122 A
(case)168 1776 A
(HARD_INT:)378 1986 A
2784(/*)S
(leftover)336 2910 A
(interrupt)378 3288 A
3708(or)S
(expired)294 3834 A
(timer.)252 4170 A
4464(*/)S
2925 V
(11093)210 1122 A
(if\(dp->dr_hw_int\))714 2784 A
3540({)S
3015 V
(11094)210 1122 A
(\(*dp->dr_hw_int\)\(dp,)840 3120 A
(&mess\);)294 4002 A
3105 V
(11095)210 1122 A
2784(})S
3195 V
(11096)210 1122 A
(continue;)378 2784 A
3285 V
(11097)210 1122 A
(case)168 1776 A
(SYS_SIG:)336 1986 A
(\(*dp->dr_signal\)\(dp,)840 2784 A
(&mess\);)294 3666 A
3375 V
(11098)210 1122 A
(continue;)378 2784 A
3456(/*)S
(don't)210 3582 A
(reply)210 3834 A
4086(*/)S
3465 V
(11099)210 1122 A
(case)168 1776 A
(SYN_ALARM:)420 1986 A
(\(*dp->dr_alarm\)\(dp,)798 2784 A
(&mess\);)294 3624 A
3555 V
(11100)210 1122 A
(continue;)378 2784 A
3456(/*)S
(don't)210 3582 A
(reply)210 3834 A
4086(*/)S
3645 V
(11101)210 1122 A
(default:)336 1776 A
3735 V
(11102)210 1122 A
(if\(dp->dr_other\))672 2112 A
3825 V
(11103)210 1122 A
2448(r)S
2532(=)S
(\(*dp->dr_other\)\(dp,)798 2616 A
(&mess\);)294 3456 A
3915 V
(11104)210 1122 A
(else)168 2112 A
4005 V
(11105)210 1122 A
2448(r)S
2532(=)S
(EINVAL;)294 2616 A
4095 V
(11106)210 1122 A
(break;)252 2112 A
4185 V
(11107)210 1122 A
1776(})S
4275 V
(11108)210 1122 A
4365 V
(11109)210 1122 A
1776(/*)S
(Clean)210 1902 A
2154(up)S
(leftover)336 2280 A
(state.)252 2658 A
2952(*/)S
4455 V
(11110)210 1122 A
(\(*dp->dr_cleanup\)\(\);)840 1776 A
4545 V
(11111)210 1122 A
4635 V
(11112)210 1122 A
1776(/*)S
(Finally,)336 1902 A
(prepare)294 2280 A
(and)126 2616 A
(send)168 2784 A
(the)126 2994 A
(reply)210 3162 A
(message.)336 3414 A
3792(*/)S
4725 V
(11113)210 1122 A
1776(if)S
1902(\(r)S
2028(!=)S
(EDONTREPLY\))462 2154 A
2658({)S
4815 V
(11114)210 1122 A
(mess.m_type)462 2112 A
2616(=)S
(TASK_REPLY;)462 2700 A
4905 V
(11115)210 1122 A
(mess.REP_PROC_NR)672 2112 A
2826(=)S
(proc_nr;)336 2910 A
4995 V
(11116)210 1122 A
2112(/*)S
(Status)252 2238 A
2532(is)S
2658(#)S
2742(of)S
(bytes)210 2868 A
(transferred)462 3120 A
3624(or)S
(error)210 3750 A
(code.)210 4002 A
4254(*/)S
5085 V
(11117)210 1122 A
(mess.REP_STATUS)630 2112 A
2784(=)S
2868(r;)S
5175 V
(11118)210 1122 A
(send\(device_caller,)798 2112 A
(&mess\);)294 2952 A
5265 V
(11119)210 1122 A
1776(})S
5355 V
(11120)210 1122 A
1524(})S
5445 V
(11121)210 1122 A
1440(})S
5625 V
(11123)210 1122 A
(/*===========================================================================*)3276 1440 A
5715 V
(11124)210 1122 A
1482(*)S
(init_buffer)462 2784 A
4674(*)S
5805 V
(11125)210 1122 A
(*===========================================================================*/)3276 1482 A
5895 V
(11126)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(init_buffer\(\))546 1986 A
5985 V
(11127)210 1122 A
1440({)S
6075 V
(11128)210 1122 A
1440(/*)S
(Select)252 1566 A
1860(a)S
(buffer)252 1944 A
(that)168 2238 A
(can)126 2448 A
(safely)252 2616 A
2910(be)S
(used)168 3036 A
(for)126 3246 A
(DMA)126 3414 A
(transfers.)420 3582 A
4086(It)S
(may)126 4212 A
(also)168 4380 A
6165 V
(11129)210 1122 A
1482(*)S
1566(be)S
(used)168 1692 A
1902(to)S
(read)168 2028 A
(partition)378 2238 A
(tables)252 2658 A
(and)126 2952 A
(such.)210 3120 A
(Its)126 3414 A
(absolute)336 3582 A
(address)294 3960 A
4296(is)S
6255 V
(11130)210 1122 A
1482(*)S
('tmp_phys',)462 1566 A
(the)126 2070 A
(normal)252 2238 A
(address)294 2532 A
2868(is)S
('tmp_buf'.)420 2994 A
6345 V
(11131)210 1122 A
1482(*/)S
6435 V
(11132)210 1122 A
6525 V
(11133)210 1122 A
(unsigned)336 1524 A
(left;)210 1902 A
6615 V
(11134)210 1122 A
6705 V
(11135)210 1122 A
(tmp_buf)294 1524 A
1860(=)S
(buffer;)294 1944 A
6795 V
(11136)210 1122 A
(sys_umap\(SELF,)588 1524 A
2154(D,)S
(\(vir_bytes\)buffer,)756 2280 A
(\(phys_bytes\)sizeof\(buffer\),)1134 3078 A
(&tmp_phys\);)462 4254 A
6885 V
(11137)210 1122 A
6975 V
(11138)210 1122 A
1524(if)S
(\(\(left)252 1650 A
1944(=)S
(dma_bytes_left\(tmp_phys\)\))1050 2028 A
3120(<)S
(DMA_BUF_SIZE\))546 3204 A
3792({)S
7065 V
(11139)210 1122 A
1776(/*)S
(First)210 1902 A
(half)168 2154 A
2364(of)S
(buffer)252 2490 A
(crosses)294 2784 A
3120(a)S
(64K)126 3204 A
(boundary,)378 3372 A
(can't)210 3792 A
(DMA)126 4044 A
(into)168 4212 A
(that)168 4422 A
4632(*/)S
8418 V
EP
%%Page: 137 137
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2216(File:)S
(drivers/libdriver/driver.c)1095 2449 A
12 B
(137)180 4500 A
1755 V
7 LST
(11140)210 1122 A
(tmp_buf)294 1776 A
2112(+=)S
(left;)210 2238 A
1845 V
(11141)210 1122 A
(tmp_phys)336 1776 A
2154(+=)S
(left;)210 2280 A
1935 V
(11142)210 1122 A
1524(})S
2025 V
(11143)210 1122 A
1440(})S
2205 V
(11145)210 1122 A
(/*===========================================================================*)3276 1440 A
2295 V
(11146)210 1122 A
1482(*)S
(do_rdwt)294 2784 A
4674(*)S
2385 V
(11147)210 1122 A
(*===========================================================================*/)3276 1482 A
2475 V
(11148)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(do_rdwt\(dp,)462 1944 A
(mp\))126 2448 A
2565 V
(11149)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dp;)168 2028 A
2784(/*)S
(device)252 2910 A
(dependent)378 3204 A
(entry)210 3624 A
(points)252 3876 A
4170(*/)S
2655 V
(11150)210 1122 A
(message)294 1440 A
(*mp;)168 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(read)168 3372 A
3582(or)S
(write)210 3708 A
(message)294 3960 A
4296(*/)S
2745 V
(11151)210 1122 A
1440({)S
2835 V
(11152)210 1122 A
1440(/*)S
(Carry)210 1566 A
(out)126 1818 A
1986(a)S
(single)252 2070 A
(read)168 2364 A
2574(or)S
(write)210 2700 A
(request.)336 2952 A
3330(*/)S
2925 V
(11153)210 1122 A
(iovec_t)294 1524 A
(iovec1;)294 1860 A
3015 V
(11154)210 1122 A
(int)126 1524 A
1692(r,)S
(opcode;)294 1818 A
3105 V
(11155)210 1122 A
(phys_bytes)420 1524 A
(phys_addr;)420 1986 A
3195 V
(11156)210 1122 A
3285 V
(11157)210 1122 A
1524(/*)S
(Disk)168 1650 A
(address?)336 1860 A
(Address)294 2280 A
(and)126 2616 A
(length)252 2784 A
3078(of)S
(the)126 3204 A
(user)168 3372 A
(buffer?)294 3582 A
3918(*/)S
3375 V
(11158)210 1122 A
1524(if)S
(\(mp->COUNT)420 1650 A
2112(<)S
2196(0\))S
(return\(EINVAL\);)630 2322 A
3465 V
(11159)210 1122 A
3555 V
(11160)210 1122 A
1524(/*)S
(Check)210 1650 A
(the)126 1902 A
(user)168 2070 A
(buffer.)294 2280 A
2616(*/)S
3645 V
(11161)210 1122 A
(sys_umap\(mp->PROC_NR,)882 1524 A
2448(D,)S
(\(vir_bytes\))462 2574 A
(mp->ADDRESS,)504 3078 A
(mp->COUNT,)420 3624 A
(&phys_addr\);)504 4086 A
3735 V
(11162)210 1122 A
1524(if)S
(\(phys_addr)420 1650 A
2112(==)S
2238(0\))S
(return\(EFAULT\);)630 2364 A
3825 V
(11163)210 1122 A
3915 V
(11164)210 1122 A
1524(/*)S
(Prepare)294 1650 A
(for)126 1986 A
(I/O.)168 2154 A
2364(*/)S
4005 V
(11165)210 1122 A
1524(if)S
(\(\(*dp->dr_prepare\)\(mp->DEVICE\))1260 1650 A
2952(==)S
(NIL_DEV\))336 3078 A
(return\(ENXIO\);)588 3456 A
4095 V
(11166)210 1122 A
4185 V
(11167)210 1122 A
1524(/*)S
(Create)252 1650 A
1944(a)S
(one)126 2028 A
(element)294 2196 A
(scatter/gather)588 2532 A
(vector)252 3162 A
(for)126 3456 A
(the)126 3624 A
(buffer.)294 3792 A
4128(*/)S
4275 V
(11168)210 1122 A
(opcode)252 1524 A
1818(=)S
(mp->m_type)420 1902 A
2364(==)S
(DEV_READ)336 2490 A
2868(?)S
(DEV_GATHER)420 2952 A
3414(:)S
(DEV_SCATTER;)504 3498 A
4365 V
(11169)210 1122 A
(iovec1.iov_addr)630 1524 A
2196(=)S
(\(vir_bytes\))462 2280 A
(mp->ADDRESS;)504 2784 A
4455 V
(11170)210 1122 A
(iovec1.iov_size)630 1524 A
2196(=)S
(mp->COUNT;)420 2280 A
4545 V
(11171)210 1122 A
4635 V
(11172)210 1122 A
1524(/*)S
(Transfer)336 1650 A
(bytes)210 2028 A
(from/to)294 2280 A
(the)126 2616 A
(device.)294 2784 A
3120(*/)S
4725 V
(11173)210 1122 A
1524(r)S
1608(=)S
(\(*dp->dr_transfer\)\(mp->PROC_NR,)1302 1692 A
(opcode,)294 3036 A
(mp->POSITION,)546 3372 A
(&iovec1,)336 3960 A
(1\);)126 4338 A
4815 V
(11174)210 1122 A
4905 V
(11175)210 1122 A
1524(/*)S
(Return)252 1650 A
(the)126 1944 A
(number)252 2112 A
2406(of)S
(bytes)210 2532 A
(transferred)462 2784 A
3288(or)S
3414(an)S
(error)210 3540 A
(code.)210 3792 A
4044(*/)S
4995 V
(11176)210 1122 A
(return\(r)336 1524 A
1902(==)S
2028(OK)S
2154(?)S
(\(mp->COUNT)420 2238 A
2700(-)S
(iovec1.iov_size\))672 2784 A
3498(:)S
(r\);)126 3582 A
5085 V
(11177)210 1122 A
1440(})S
5265 V
(11179)210 1122 A
(/*==========================================================================*)3234 1440 A
5355 V
(11180)210 1122 A
1482(*)S
(do_vrdwt)336 2784 A
4632(*)S
5445 V
(11181)210 1122 A
(*==========================================================================*/)3234 1482 A
5535 V
(11182)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(do_vrdwt\(dp,)504 1944 A
(mp\))126 2490 A
5625 V
(11183)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dp;)168 2028 A
2448(/*)S
(device)252 2574 A
(dependent)378 2868 A
(entry)210 3288 A
(points)252 3540 A
3834(*/)S
5715 V
(11184)210 1122 A
(message)294 1440 A
(*mp;)168 1776 A
2448(/*)S
(pointer)294 2574 A
2910(to)S
(read)168 3036 A
3246(or)S
(write)210 3372 A
(message)294 3624 A
3960(*/)S
5805 V
(11185)210 1122 A
1440({)S
5895 V
(11186)210 1122 A
1440(/*)S
(Carry)210 1566 A
(out)126 1818 A
1986(an)S
(device)252 2112 A
(read)168 2406 A
2616(or)S
(write)210 2742 A
(to/from)294 2994 A
3330(a)S
(vector)252 3414 A
3708(of)S
(user)168 3834 A
(addresses.)420 4044 A
5985 V
(11187)210 1122 A
1482(*)S
(The)126 1566 A
("user)210 1734 A
(addresses")420 1986 A
(are)126 2448 A
(assumed)294 2616 A
2952(to)S
3078(be)S
(safe,)210 3204 A
(i.e.)168 3456 A
3666(FS)S
(transferring)504 3792 A
(to/from)294 4338 A
6075 V
(11188)210 1122 A
1482(*)S
(its)126 1566 A
(own)126 1734 A
(buffers,)336 1902 A
2280(so)S
(they)168 2406 A
(are)126 2616 A
(not)126 2784 A
(checked.)336 2952 A
6165 V
(11189)210 1122 A
1482(*/)S
6255 V
(11190)210 1122 A
(static)252 1524 A
(iovec_t)294 1818 A
(iovec[NR_IOREQS];)714 2154 A
6345 V
(11191)210 1122 A
(iovec_t)294 1524 A
(*iov;)210 1860 A
6435 V
(11192)210 1122 A
(phys_bytes)420 1524 A
(iovec_size;)462 1986 A
6525 V
(11193)210 1122 A
(unsigned)336 1524 A
(nr_req;)294 1902 A
6615 V
(11194)210 1122 A
(int)126 1524 A
1692(r;)S
6705 V
(11195)210 1122 A
6795 V
(11196)210 1122 A
(nr_req)252 1524 A
1818(=)S
(mp->COUNT;)420 1902 A
2448(/*)S
(Length)252 2574 A
2868(of)S
(I/O)126 2994 A
(vector)252 3162 A
3456(*/)S
6885 V
(11197)210 1122 A
6975 V
(11198)210 1122 A
1524(if)S
(\(mp->m_source)546 1650 A
2238(<)S
2322(0\))S
2448({)S
7065 V
(11199)210 1122 A
1608(/*)S
(Called)252 1734 A
2028(by)S
2154(a)S
(task,)210 2238 A
2490(no)S
(need)168 2616 A
2826(to)S
(copy)168 2952 A
(vector.)294 3162 A
3498(*/)S
8418 V
EP
%%Page: 138 138
BP
/slant 0 def
/height 0 def
1485 V
12 B
(138)180 1080 A
11 R
2216(File:)S
(drivers/libdriver/driver.c)1095 2449 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(11200)210 1122 A
(iov)126 1608 A
1776(=)S
(\(iovec_t)336 1860 A
2238(*\))S
(mp->ADDRESS;)504 2364 A
1845 V
(11201)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
1935 V
(11202)210 1122 A
1608(/*)S
(Copy)168 1734 A
(the)126 1944 A
(vector)252 2112 A
(from)168 2406 A
(the)126 2616 A
(caller)252 2784 A
3078(to)S
(kernel)252 3204 A
(space.)252 3498 A
3792(*/)S
2025 V
(11203)210 1122 A
1608(if)S
(\(nr_req)294 1734 A
2070(>)S
(NR_IOREQS\))420 2154 A
(nr_req)252 2616 A
2910(=)S
(NR_IOREQS;)420 2994 A
2115 V
(11204)210 1122 A
(iovec_size)420 1608 A
2070(=)S
(\(phys_bytes\))504 2154 A
(\(nr_req)294 2700 A
3036(*)S
(sizeof\(iovec[0]\)\);)756 3120 A
2205 V
(11205)210 1122 A
2295 V
(11206)210 1122 A
1608(if)S
(\(OK)126 1734 A
1902(!=)S
(sys_datacopy\(mp->m_source,)1092 2028 A
(\(vir_bytes\))462 3162 A
(mp->ADDRESS,)504 3666 A
2385 V
(11207)210 1122 A
(SELF,)210 2112 A
(\(vir_bytes\))462 2364 A
(iovec,)252 2868 A
(iovec_size\)\))504 3162 A
2475 V
(11208)210 1122 A
(panic\(\(*dp->dr_name\)\(\),"bad)1134 1776 A
(I/O)126 2952 A
(vector)252 3120 A
(by",)168 3414 A
(mp->m_source\);)588 3624 A
2565 V
(11209)210 1122 A
(iov)126 1608 A
1776(=)S
(iovec;)252 1860 A
2655 V
(11210)210 1122 A
1524(})S
2745 V
(11211)210 1122 A
2835 V
(11212)210 1122 A
1524(/*)S
(Prepare)294 1650 A
(for)126 1986 A
(I/O.)168 2154 A
2364(*/)S
2925 V
(11213)210 1122 A
1524(if)S
(\(\(*dp->dr_prepare\)\(mp->DEVICE\))1260 1650 A
2952(==)S
(NIL_DEV\))336 3078 A
(return\(ENXIO\);)588 3456 A
3015 V
(11214)210 1122 A
3105 V
(11215)210 1122 A
1524(/*)S
(Transfer)336 1650 A
(bytes)210 2028 A
(from/to)294 2280 A
(the)126 2616 A
(device.)294 2784 A
3120(*/)S
3195 V
(11216)210 1122 A
1524(r)S
1608(=)S
(\(*dp->dr_transfer\)\(mp->PROC_NR,)1302 1692 A
(mp->m_type,)462 3036 A
(mp->POSITION,)546 3540 A
(iov,)168 4128 A
(nr_req\);)336 4338 A
3285 V
(11217)210 1122 A
3375 V
(11218)210 1122 A
1524(/*)S
(Copy)168 1650 A
(the)126 1860 A
(I/O)126 2028 A
(vector)252 2196 A
(back)168 2490 A
2700(to)S
(the)126 2826 A
(caller.)294 2994 A
3330(*/)S
3465 V
(11219)210 1122 A
1524(if)S
(\(mp->m_source)546 1650 A
2238(>=)S
2364(0\))S
2490({)S
3555 V
(11220)210 1122 A
(sys_datacopy\(SELF,)756 1608 A
(\(vir_bytes\))462 2406 A
(iovec,)252 2910 A
3645 V
(11221)210 1122 A
(mp->m_source,)546 1776 A
(\(vir_bytes\))462 2364 A
(mp->ADDRESS,)504 2868 A
(iovec_size\);)504 3414 A
3735 V
(11222)210 1122 A
1524(})S
3825 V
(11223)210 1122 A
(return\(r\);)420 1524 A
3915 V
(11224)210 1122 A
1440(})S
4095 V
(11226)210 1122 A
(/*===========================================================================*)3276 1440 A
4185 V
(11227)210 1122 A
1482(*)S
(no_name)294 2784 A
4674(*)S
4275 V
(11228)210 1122 A
(*===========================================================================*/)3276 1482 A
4365 V
(11229)210 1122 A
(PUBLIC)252 1440 A
(char)168 1734 A
(*no_name\(\))420 1944 A
4455 V
(11230)210 1122 A
1440({)S
4545 V
(11231)210 1122 A
1440(/*)S
(Use)126 1566 A
(this)168 1734 A
(default)294 1944 A
(name)168 2280 A
2490(if)S
(there)210 2616 A
2868(is)S
2994(no)S
(specific)336 3120 A
(name)168 3498 A
(for)126 3708 A
(the)126 3876 A
(device.)294 4044 A
(This)168 4380 A
(was)126 4590 A
4635 V
(11232)210 1122 A
1482(*)S
(originally)420 1566 A
(done)168 2028 A
2238(by)S
(fetching)336 2364 A
(the)126 2742 A
(name)168 2910 A
(from)168 3120 A
(the)126 3330 A
(task)168 3498 A
(table)210 3708 A
(for)126 3960 A
(this)168 4128 A
(process:)336 4338 A
4725 V
(11233)210 1122 A
1482(*)S
("return\(tasktab[proc_number\(proc_ptr\))1554 1566 A
3162(+)S
(NR_TASKS].name\);",)756 3246 A
(but)126 4044 A
(currently)378 4212 A
4632(a)S
4815 V
(11234)210 1122 A
1482(*)S
(real)168 1566 A
("noname")336 1776 A
2154(is)S
(returned.)378 2280 A
(Perhaps,)336 2700 A
(some)168 3078 A
(system)252 3288 A
(information)462 3582 A
(service)294 4086 A
(can)126 4422 A
4590(be)S
4905 V
(11235)210 1122 A
1482(*)S
(queried)294 1566 A
(for)126 1902 A
2070(a)S
(name)168 2154 A
2364(at)S
2490(a)S
(later)210 2574 A
(time.)210 2826 A
4995 V
(11236)210 1122 A
1482(*/)S
5085 V
(11237)210 1122 A
(static)252 1524 A
(char)168 1818 A
(name[])252 2028 A
2322(=)S
("noname";)378 2406 A
5175 V
(11238)210 1122 A
(return)252 1524 A
(name;)210 1818 A
5265 V
(11239)210 1122 A
1440(})S
5445 V
(11241)210 1122 A
(/*============================================================================*)3318 1440 A
5535 V
(11242)210 1122 A
1482(*)S
(do_nop)252 2784 A
4716(*)S
5625 V
(11243)210 1122 A
(*============================================================================*/)3318 1482 A
5715 V
(11244)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_nop\(dp,)420 1902 A
(mp\))126 2364 A
5805 V
(11245)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dp;)168 2028 A
5895 V
(11246)210 1122 A
(message)294 1440 A
(*mp;)168 1776 A
5985 V
(11247)210 1122 A
1440({)S
6075 V
(11248)210 1122 A
1440(/*)S
(Nothing)294 1566 A
(there,)252 1902 A
2196(or)S
(nothing)294 2322 A
2658(to)S
(do.)126 2784 A
2952(*/)S
6165 V
(11249)210 1122 A
6255 V
(11250)210 1122 A
(switch)252 1524 A
(\(mp->m_type\))504 1818 A
2364({)S
6345 V
(11251)210 1122 A
(case)168 1524 A
(DEV_OPEN:)378 1734 A
(return\(ENODEV\);)630 2448 A
6435 V
(11252)210 1122 A
(case)168 1524 A
(DEV_CLOSE:)420 1734 A
(return\(OK\);)462 2448 A
6525 V
(11253)210 1122 A
(case)168 1524 A
(DEV_IOCTL:)420 1734 A
(return\(ENOTTY\);)630 2448 A
6615 V
(11254)210 1122 A
(default:)336 1524 A
(return\(EIO\);)504 2448 A
6705 V
(11255)210 1122 A
1524(})S
6795 V
(11256)210 1122 A
1440(})S
8418 V
EP
%%Page: 139 139
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2216(File:)S
(drivers/libdriver/driver.c)1095 2449 A
12 B
(139)180 4500 A
1755 V
7 LST
(11258)210 1122 A
(/*============================================================================*)3318 1440 A
1845 V
(11259)210 1122 A
1482(*)S
(nop_signal)420 2784 A
4716(*)S
1935 V
(11260)210 1122 A
(*============================================================================*/)3318 1482 A
2025 V
(11261)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(nop_signal\(dp,)588 1944 A
(mp\))126 2574 A
2115 V
(11262)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dp;)168 2028 A
2205 V
(11263)210 1122 A
(message)294 1440 A
(*mp;)168 1776 A
2295 V
(11264)210 1122 A
1440({)S
2385 V
(11265)210 1122 A
1440(/*)S
(Default)294 1566 A
(action)252 1902 A
(for)126 2196 A
(signal)252 2364 A
2658(is)S
2784(to)S
(ignore.)294 2910 A
3246(*/)S
2475 V
(11266)210 1122 A
1440(})S
2655 V
(11268)210 1122 A
(/*============================================================================*)3318 1440 A
2745 V
(11269)210 1122 A
1482(*)S
(nop_alarm)378 2784 A
4716(*)S
2835 V
(11270)210 1122 A
(*============================================================================*/)3318 1482 A
2925 V
(11271)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(nop_alarm\(dp,)546 1944 A
(mp\))126 2532 A
3015 V
(11272)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dp;)168 2028 A
3105 V
(11273)210 1122 A
(message)294 1440 A
(*mp;)168 1776 A
3195 V
(11274)210 1122 A
1440({)S
3285 V
(11275)210 1122 A
1440(/*)S
(Ignore)252 1566 A
(the)126 1860 A
(leftover)336 2028 A
(alarm.)252 2406 A
2700(*/)S
3375 V
(11276)210 1122 A
1440(})S
3555 V
(11278)210 1122 A
(/*===========================================================================*)3276 1440 A
3645 V
(11279)210 1122 A
1482(*)S
(nop_prepare)462 2784 A
4674(*)S
3735 V
(11280)210 1122 A
(*===========================================================================*/)3276 1482 A
3825 V
(11281)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(device)252 2028 A
(*nop_prepare\(device\))840 2322 A
3915 V
(11282)210 1122 A
1440({)S
4005 V
(11283)210 1122 A
1440(/*)S
(Nothing)294 1566 A
1902(to)S
(prepare)294 2028 A
(for.)168 2364 A
2574(*/)S
4095 V
(11284)210 1122 A
(return\(NIL_DEV\);)672 1524 A
4185 V
(11285)210 1122 A
1440(})S
4365 V
(11287)210 1122 A
(/*===========================================================================*)3276 1440 A
4455 V
(11288)210 1122 A
1482(*)S
(nop_cleanup)462 2784 A
4674(*)S
4545 V
(11289)210 1122 A
(*===========================================================================*/)3276 1482 A
4635 V
(11290)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(nop_cleanup\(\))546 1944 A
4725 V
(11291)210 1122 A
1440({)S
4815 V
(11292)210 1122 A
1440(/*)S
(Nothing)294 1566 A
1902(to)S
(clean)210 2028 A
(up.)126 2280 A
2448(*/)S
4905 V
(11293)210 1122 A
1440(})S
5085 V
(11295)210 1122 A
(/*===========================================================================*)3276 1440 A
5175 V
(11296)210 1122 A
1482(*)S
(nop_cancel)420 2784 A
4674(*)S
5265 V
(11297)210 1122 A
(*===========================================================================*/)3276 1482 A
5355 V
(11298)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(nop_cancel\(struct)714 1902 A
(driver)252 2658 A
(*dr,)168 2952 A
(message)294 3162 A
(*m\))126 3498 A
5445 V
(11299)210 1122 A
1440({)S
5535 V
(11300)210 1122 A
1440(/*)S
(Nothing)294 1566 A
1902(to)S
2028(do)S
(for)126 2154 A
(cancel.)294 2322 A
2658(*/)S
5625 V
(11301)210 1122 A
(return\(OK\);)462 1566 A
5715 V
(11302)210 1122 A
1440(})S
5895 V
(11304)210 1122 A
(/*===========================================================================*)3276 1440 A
5985 V
(11305)210 1122 A
1482(*)S
(nop_select)420 2784 A
4674(*)S
6075 V
(11306)210 1122 A
(*===========================================================================*/)3276 1482 A
6165 V
(11307)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(nop_select\(struct)714 1902 A
(driver)252 2658 A
(*dr,)168 2952 A
(message)294 3162 A
(*m\))126 3498 A
6255 V
(11308)210 1122 A
1440({)S
6345 V
(11309)210 1122 A
1440(/*)S
(Nothing)294 1566 A
1902(to)S
2028(do)S
(for)126 2154 A
(select.)294 2322 A
2658(*/)S
6435 V
(11310)210 1122 A
(return\(OK\);)462 1566 A
6525 V
(11311)210 1122 A
1440(})S
6705 V
(11313)210 1122 A
(/*============================================================================*)3318 1440 A
6795 V
(11314)210 1122 A
1482(*)S
(do_diocntl)420 2784 A
4716(*)S
6885 V
(11315)210 1122 A
(*============================================================================*/)3318 1482 A
6975 V
(11316)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_diocntl\(dp,)588 1902 A
(mp\))126 2532 A
7065 V
(11317)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dp;)168 2028 A
8418 V
EP
%%Page: 140 140
BP
/slant 0 def
/height 0 def
1485 V
12 B
(140)180 1080 A
11 R
2216(File:)S
(drivers/libdriver/driver.c)1095 2449 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(11318)210 1122 A
(message)294 1440 A
(*mp;)168 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(ioctl)210 3372 A
(request)294 3624 A
3960(*/)S
1845 V
(11319)210 1122 A
1440({)S
1935 V
(11320)210 1122 A
1440(/*)S
(Carry)210 1566 A
(out)126 1818 A
1986(a)S
(partition)378 2070 A
(setting/getting)630 2490 A
(request.)336 3162 A
3540(*/)S
2025 V
(11321)210 1122 A
(struct)252 1524 A
(device)252 1818 A
(*dv;)168 2112 A
2115 V
(11322)210 1122 A
(struct)252 1524 A
(partition)378 1818 A
(entry;)252 2238 A
2205 V
(11323)210 1122 A
(int)126 1524 A
1692(s;)S
2295 V
(11324)210 1122 A
2385 V
(11325)210 1122 A
1524(if)S
(\(mp->REQUEST)504 1650 A
2196(!=)S
(DIOCSETP)336 2322 A
2700(&&)S
(mp->REQUEST)462 2826 A
3330(!=)S
(DIOCGETP\))378 3456 A
3876({)S
2475 V
(11326)210 1122 A
(if\(dp->dr_other\))672 1776 A
2490({)S
2565 V
(11327)210 1122 A
(return)252 2112 A
(dp->dr_other\(dp,)672 2406 A
(mp\);)168 3120 A
2655 V
(11328)210 1122 A
1776(})S
(else)168 1860 A
(return\(ENOTTY\);)630 2070 A
2745 V
(11329)210 1122 A
1524(})S
2835 V
(11330)210 1122 A
2925 V
(11331)210 1122 A
1524(/*)S
(Decode)252 1650 A
(the)126 1944 A
(message)294 2112 A
(parameters.)462 2448 A
2952(*/)S
3015 V
(11332)210 1122 A
1524(if)S
(\(\(dv)168 1650 A
1860(=)S
(\(*dp->dr_prepare\)\(mp->DEVICE\)\))1260 1944 A
3246(==)S
(NIL_DEV\))336 3372 A
(return\(ENXIO\);)588 3750 A
3105 V
(11333)210 1122 A
3195 V
(11334)210 1122 A
1524(if)S
(\(mp->REQUEST)504 1650 A
2196(==)S
(DIOCSETP\))378 2322 A
2742({)S
3285 V
(11335)210 1122 A
1776(/*)S
(Copy)168 1902 A
(just)168 2112 A
(this)168 2322 A
(one)126 2532 A
(partition)378 2700 A
(table)210 3120 A
(entry.)252 3372 A
3666(*/)S
3375 V
(11336)210 1122 A
1776(if)S
(\(OK)126 1902 A
2070(!=)S
(\(s=sys_datacopy\(mp->PROC_NR,)1176 2196 A
(\(vir_bytes\))462 3414 A
(mp->ADDRESS,)504 3918 A
3465 V
(11337)210 1122 A
(SELF,)210 2112 A
(\(vir_bytes\))462 2364 A
(&entry,)294 2868 A
(sizeof\(entry\)\)\)\))672 3204 A
3555 V
(11338)210 1122 A
(return)252 1944 A
2238(s;)S
3645 V
(11339)210 1122 A
(dv->dv_base)462 1776 A
2280(=)S
(entry.base;)462 2364 A
3735 V
(11340)210 1122 A
(dv->dv_size)462 1776 A
2280(=)S
(entry.size;)462 2364 A
3825 V
(11341)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3915 V
(11342)210 1122 A
1776(/*)S
(Return)252 1902 A
2196(a)S
(partition)378 2280 A
(table)210 2700 A
(entry)210 2952 A
(and)126 3204 A
(the)126 3372 A
(geometry)336 3540 A
3918(of)S
(the)126 4044 A
(drive.)252 4212 A
4506(*/)S
4005 V
(11343)210 1122 A
(entry.base)420 1776 A
2238(=)S
(dv->dv_base;)504 2322 A
4095 V
(11344)210 1122 A
(entry.size)420 1776 A
2238(=)S
(dv->dv_size;)504 2322 A
4185 V
(11345)210 1122 A
(\(*dp->dr_geometry\)\(&entry\);)1134 1776 A
4275 V
(11346)210 1122 A
1776(if)S
(\(OK)126 1902 A
2070(!=)S
(\(s=sys_datacopy\(SELF,)882 2196 A
(\(vir_bytes\))462 3120 A
(&entry,)294 3624 A
4365 V
(11347)210 1122 A
(mp->PROC_NR,)504 2112 A
(\(vir_bytes\))462 2658 A
(mp->ADDRESS,)504 3162 A
(sizeof\(entry\)\)\)\))672 3708 A
4455 V
(11348)210 1122 A
(return)252 1944 A
2238(s;)S
4545 V
(11349)210 1122 A
1524(})S
4635 V
(11350)210 1122 A
(return\(OK\);)462 1524 A
4725 V
(11351)210 1122 A
1440(})S
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(drivers/libdriver/drvlib.c)1092 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(11400)210 1122 A
1440(/*)S
(IBM)126 1566 A
(device)252 1734 A
(driver)252 2028 A
(utility)294 2322 A
(functions.)420 2658 A
(Author:)294 3792 A
(Kees)168 4128 A
4338(J.)S
(Bot)126 4464 A
5445 V
(11401)210 1122 A
1482(*)S
4128(7)S
(Dec)126 4212 A
(1995)168 4380 A
5535 V
(11402)210 1122 A
1482(*)S
(Entry)210 1566 A
(point:)252 1818 A
5625 V
(11403)210 1122 A
1482(*)S
(partition:)420 1650 A
(partition)378 2112 A
2532(a)S
(disk)168 2616 A
2826(to)S
(the)126 2952 A
(partition)378 3120 A
(table\(s\))336 3540 A
3918(on)S
(it.)126 4044 A
5715 V
(11404)210 1122 A
1482(*/)S
5805 V
(11405)210 1122 A
5895 V
(11406)210 1122 A
(#include)336 1440 A
("driver.h")420 1818 A
5985 V
(11407)210 1122 A
(#include)336 1440 A
("drvlib.h")420 1818 A
6075 V
(11408)210 1122 A
(#include)336 1440 A
(<unistd.h>)420 1818 A
6165 V
(11409)210 1122 A
6255 V
(11410)210 1122 A
1440(/*)S
(Extended)336 1566 A
(partition?)420 1944 A
2406(*/)S
6345 V
(11411)210 1122 A
(#define)294 1440 A
(ext_part\(s\))462 1776 A
(\(\(s\))168 2448 A
2658(==)S
(0x05)168 2784 A
2994(||)S
(\(s\))126 3120 A
3288(==)S
(0x0F\))210 3414 A
6435 V
(11412)210 1122 A
6525 V
(11413)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(extpartition,)546 2490 A
(\(struct)294 3078 A
(driver)252 3414 A
(*dp,)168 3708 A
(int)126 3918 A
(extdev,)294 4086 A
6615 V
(11414)210 1122 A
(unsigned)336 3456 A
(long)168 3834 A
(extbase\))336 4044 A
4422(\);)S
6705 V
(11415)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(get_part_table,)630 2448 A
(\(struct)294 3120 A
(driver)252 3456 A
(*dp,)168 3750 A
(int)126 3960 A
(device,)294 4128 A
6795 V
(11416)210 1122 A
(unsigned)336 2448 A
(long)168 2826 A
(offset,)294 3036 A
(struct)252 3372 A
(part_entry)420 3666 A
(*table\)\);)378 4128 A
6885 V
(11417)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(sort,)210 2490 A
(\(struct)294 2742 A
(part_entry)420 3078 A
(*table\))294 3540 A
3876(\);)S
6975 V
(11418)210 1122 A
7065 V
(11419)210 1122 A
(#ifndef)294 1440 A
(CD_SECTOR_SIZE)588 1776 A
8418 V
EP
%%Page: 141 141
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2216(File:)S
(drivers/libdriver/drvlib.c)1094 2449 A
12 B
(141)180 4500 A
1755 V
7 LST
(11420)210 1122 A
(#define)294 1440 A
(CD_SECTOR_SIZE)588 1776 A
(2048)168 2406 A
1845 V
(11421)210 1122 A
(#endif)252 1440 A
1935 V
(11422)210 1122 A
2025 V
(11423)210 1122 A
(/*============================================================================*)3318 1440 A
2115 V
(11424)210 1122 A
1482(*)S
(partition)378 2784 A
4716(*)S
2205 V
(11425)210 1122 A
(*============================================================================*/)3318 1482 A
2295 V
(11426)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(partition\(dp,)546 1944 A
(device,)294 2532 A
(style,)252 2868 A
(atapi\))252 3162 A
2385 V
(11427)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dp;)168 2028 A
2448(/*)S
(device)252 2574 A
(dependent)378 2868 A
(entry)210 3288 A
(points)252 3540 A
3834(*/)S
2475 V
(11428)210 1122 A
(int)126 1440 A
(device;)294 1608 A
2448(/*)S
(device)252 2574 A
2868(to)S
(partition)378 2994 A
3414(*/)S
2565 V
(11429)210 1122 A
(int)126 1440 A
(style;)252 1608 A
2448(/*)S
(partitioning)504 2574 A
(style:)252 3120 A
(floppy,)294 3414 A
(primary,)336 3750 A
(sub.)168 4128 A
4338(*/)S
2655 V
(11430)210 1122 A
(int)126 1440 A
(atapi;)252 1608 A
2448(/*)S
(atapi)210 2574 A
(device)252 2826 A
3120(*/)S
2745 V
(11431)210 1122 A
1440({)S
2835 V
(11432)210 1122 A
1440(/*)S
(This)168 1566 A
(routine)294 1776 A
2112(is)S
(called)252 2238 A
2532(on)S
(first)210 2658 A
(open)168 2910 A
3120(to)S
(initialize)420 3246 A
(the)126 3708 A
(partition)378 3876 A
(tables)252 4296 A
2925 V
(11433)210 1122 A
1482(*)S
1566(of)S
1692(a)S
(device.)294 1776 A
2154(It)S
(makes)210 2280 A
(sure)168 2532 A
(that)168 2742 A
(each)168 2952 A
(partition)378 3162 A
(falls)210 3582 A
(safely)252 3834 A
(within)252 4128 A
(the)126 4422 A
3015 V
(11434)210 1122 A
1482(*)S
(device's)336 1566 A
(limits.)294 1944 A
(Depending)378 2322 A
2742(on)S
(the)126 2868 A
(partition)378 3036 A
(style)210 3456 A
3708(we)S
(are)126 3834 A
(either)252 4002 A
(making)252 4296 A
3105 V
(11435)210 1122 A
1482(*)S
(floppy)252 1566 A
(partitions,)462 1860 A
(primary)294 2364 A
(partitions)420 2700 A
3162(or)S
(subpartitions.)588 3288 A
(Only)168 3960 A
(primary)294 4170 A
3195 V
(11436)210 1122 A
1482(*)S
(partitions)420 1566 A
(are)126 2028 A
(sorted,)294 2196 A
(because)294 2532 A
(they)168 2868 A
(are)126 3078 A
(shared)252 3246 A
(with)168 3540 A
(other)210 3750 A
(operating)378 4002 A
3285 V
(11437)210 1122 A
1482(*)S
(systems)294 1566 A
(that)168 1902 A
(expect)252 2112 A
(this.)210 2406 A
3375 V
(11438)210 1122 A
1482(*/)S
3465 V
(11439)210 1122 A
(struct)252 1524 A
(part_entry)420 1818 A
(table[NR_PARTITIONS],)882 2280 A
(*pe;)168 3204 A
3555 V
(11440)210 1122 A
(int)126 1524 A
(disk,)210 1692 A
(par;)168 1944 A
3645 V
(11441)210 1122 A
(struct)252 1524 A
(device)252 1818 A
(*dv;)168 2112 A
3735 V
(11442)210 1122 A
(unsigned)336 1524 A
(long)168 1902 A
(base,)210 2112 A
(limit,)252 2364 A
(part_limit;)462 2658 A
3825 V
(11443)210 1122 A
3915 V
(11444)210 1122 A
1524(/*)S
(Get)126 1650 A
(the)126 1818 A
(geometry)336 1986 A
2364(of)S
(the)126 2490 A
(device)252 2658 A
2952(to)S
(partition)378 3078 A
3498(*/)S
4005 V
(11445)210 1122 A
1524(if)S
(\(\(dv)168 1650 A
1860(=)S
(\(*dp->dr_prepare\)\(device\)\))1092 1944 A
3078(==)S
(NIL_DEV)294 3204 A
4095 V
(11446)210 1122 A
2784(||)S
(cmp64u\(dv->dv_size,)798 2910 A
3750(0\))S
3876(==)S
4002(0\))S
(return;)294 4128 A
4185 V
(11447)210 1122 A
(base)168 1524 A
1734(=)S
(div64u\(dv->dv_base,)798 1818 A
(SECTOR_SIZE\);)546 2658 A
4275 V
(11448)210 1122 A
(limit)210 1524 A
1776(=)S
(base)168 1860 A
2070(+)S
(div64u\(dv->dv_size,)798 2154 A
(SECTOR_SIZE\);)546 2994 A
4365 V
(11449)210 1122 A
4455 V
(11450)210 1122 A
1524(/*)S
(Read)168 1650 A
(the)126 1860 A
(partition)378 2028 A
(table)210 2448 A
(for)126 2700 A
(the)126 2868 A
(device.)294 3036 A
3372(*/)S
4545 V
(11451)210 1122 A
(if\(!get_part_table\(dp,)924 1524 A
(device,)294 2490 A
(0L,)126 2826 A
(table\)\))294 2994 A
3330({)S
4635 V
(11452)210 1122 A
(return;)294 1860 A
4725 V
(11453)210 1122 A
1524(})S
4815 V
(11454)210 1122 A
4905 V
(11455)210 1122 A
1524(/*)S
(Compute)294 1650 A
(the)126 1986 A
(device)252 2154 A
(number)252 2448 A
2742(of)S
(the)126 2868 A
(first)210 3036 A
(partition.)420 3288 A
3750(*/)S
4995 V
(11456)210 1122 A
(switch)252 1524 A
(\(style\))294 1818 A
2154({)S
5085 V
(11457)210 1122 A
(case)168 1524 A
(P_FLOPPY:)378 1734 A
5175 V
(11458)210 1122 A
(device)252 1776 A
2070(+=)S
(MINOR_fd0p0;)504 2196 A
5265 V
(11459)210 1122 A
(break;)252 1776 A
5355 V
(11460)210 1122 A
(case)168 1524 A
(P_PRIMARY:)420 1734 A
5445 V
(11461)210 1122 A
(sort\(table\);)504 1776 A
2784(/*)S
(sort)168 2910 A
3120(a)S
(primary)294 3204 A
(partition)378 3540 A
(table)210 3960 A
4212(*/)S
5535 V
(11462)210 1122 A
(device)252 1776 A
2070(+=)S
2196(1;)S
5625 V
(11463)210 1122 A
(break;)252 1776 A
5715 V
(11464)210 1122 A
(case)168 1524 A
(P_SUB:)252 1734 A
5805 V
(11465)210 1122 A
(disk)168 1776 A
1986(=)S
(device)252 2070 A
2364(/)S
(DEV_PER_DRIVE;)588 2448 A
5895 V
(11466)210 1122 A
(par)126 1776 A
1944(=)S
(device)252 2028 A
2322(%)S
(DEV_PER_DRIVE)546 2406 A
2994(-)S
3078(1;)S
5985 V
(11467)210 1122 A
(device)252 1776 A
2070(=)S
(MINOR_d0p0s0)504 2154 A
2700(+)S
(\(disk)210 2784 A
3036(*)S
(NR_PARTITIONS)546 3120 A
3708(+)S
(par\))168 3792 A
4002(*)S
(NR_PARTITIONS;)588 4086 A
6075 V
(11468)210 1122 A
1524(})S
6165 V
(11469)210 1122 A
6255 V
(11470)210 1122 A
1524(/*)S
(Find)168 1650 A
1860(an)S
(array)210 1986 A
2238(of)S
(devices.)336 2364 A
2742(*/)S
6345 V
(11471)210 1122 A
1524(if)S
(\(\(dv)168 1650 A
1860(=)S
(\(*dp->dr_prepare\)\(device\)\))1092 1944 A
3078(==)S
(NIL_DEV\))336 3204 A
(return;)294 3582 A
6435 V
(11472)210 1122 A
6525 V
(11473)210 1122 A
1524(/*)S
(Set)126 1650 A
(the)126 1818 A
(geometry)336 1986 A
2364(of)S
(the)126 2490 A
(partitions)420 2658 A
(from)168 3120 A
(the)126 3330 A
(partition)378 3498 A
(table.)252 3918 A
4212(*/)S
6615 V
(11474)210 1122 A
(for)126 1524 A
(\(par)168 1692 A
1902(=)S
1986(0;)S
(par)126 2112 A
2280(<)S
(NR_PARTITIONS;)588 2364 A
(par++,)252 2994 A
(dv++\))210 3288 A
3540({)S
6705 V
(11475)210 1122 A
1776(/*)S
(Shrink)252 1902 A
(the)126 2196 A
(partition)378 2364 A
2784(to)S
(fit)126 2910 A
(within)252 3078 A
(the)126 3372 A
(device.)294 3540 A
3876(*/)S
6795 V
(11476)210 1122 A
1776(pe)S
1902(=)S
(&table[par];)504 1986 A
6885 V
(11477)210 1122 A
(part_limit)420 1776 A
2238(=)S
(pe->lowsec)420 2322 A
2784(+)S
(pe->size;)378 2868 A
6975 V
(11478)210 1122 A
1776(if)S
(\(part_limit)462 1902 A
2406(<)S
(pe->lowsec\))462 2490 A
(part_limit)420 2994 A
3456(=)S
(limit;)252 3540 A
7065 V
(11479)210 1122 A
1776(if)S
(\(part_limit)462 1902 A
2406(>)S
(limit\))252 2490 A
(part_limit)420 2784 A
3246(=)S
(limit;)252 3330 A
8418 V
EP
%%Page: 142 142
BP
/slant 0 def
/height 0 def
1485 V
12 B
(142)180 1080 A
11 R
2216(File:)S
(drivers/libdriver/drvlib.c)1094 2449 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(11480)210 1122 A
1776(if)S
(\(pe->lowsec)462 1902 A
2406(<)S
(base\))210 2490 A
(pe->lowsec)420 2742 A
3204(=)S
(base;)210 3288 A
1845 V
(11481)210 1122 A
1776(if)S
(\(part_limit)462 1902 A
2406(<)S
(pe->lowsec\))462 2490 A
(part_limit)420 2994 A
3456(=)S
(pe->lowsec;)462 3540 A
1935 V
(11482)210 1122 A
2025 V
(11483)210 1122 A
(dv->dv_base)462 1776 A
2280(=)S
(mul64u\(pe->lowsec,)756 2364 A
(SECTOR_SIZE\);)546 3162 A
2115 V
(11484)210 1122 A
(dv->dv_size)462 1776 A
2280(=)S
(mul64u\(part_limit)714 2364 A
3120(-)S
(pe->lowsec,)462 3204 A
(SECTOR_SIZE\);)546 3708 A
2205 V
(11485)210 1122 A
2295 V
(11486)210 1122 A
1776(if)S
(\(style)252 1902 A
2196(==)S
(P_PRIMARY\))420 2322 A
2784({)S
2385 V
(11487)210 1122 A
2112(/*)S
(Each)168 2238 A
(Minix)210 2448 A
(primary)294 2700 A
(partition)378 3036 A
(can)126 3456 A
3624(be)S
(subpartitioned.)630 3750 A
4422(*/)S
2475 V
(11488)210 1122 A
2112(if)S
(\(pe->sysind)462 2238 A
2742(==)S
(MINIX_PART\))462 2868 A
2565 V
(11489)210 1122 A
(partition\(dp,)546 2448 A
(device)252 3036 A
3330(+)S
(par,)168 3414 A
(P_SUB,)252 3624 A
(atapi\);)294 3918 A
2655 V
(11490)210 1122 A
2745 V
(11491)210 1122 A
2112(/*)S
2238(An)S
(extended)336 2364 A
(partition)378 2742 A
(has)126 3162 A
(logical)294 3330 A
(partitions.)462 3666 A
4170(*/)S
2835 V
(11492)210 1122 A
2112(if)S
(\(ext_part\(pe->sysind\)\))924 2238 A
2925 V
(11493)210 1122 A
(extpartition\(dp,)672 2448 A
(device)252 3162 A
3456(+)S
(par,)168 3540 A
(pe->lowsec\);)504 3750 A
3015 V
(11494)210 1122 A
1776(})S
3105 V
(11495)210 1122 A
1524(})S
3195 V
(11496)210 1122 A
1440(})S
3375 V
(11498)210 1122 A
(/*============================================================================*)3318 1440 A
3465 V
(11499)210 1122 A
1482(*)S
(extpartition)504 2784 A
4716(*)S
3555 V
(11500)210 1122 A
(*============================================================================*/)3318 1482 A
3645 V
(11501)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(extpartition\(dp,)672 1986 A
(extdev,)294 2700 A
(extbase\))336 3036 A
3735 V
(11502)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dp;)168 2028 A
2448(/*)S
(device)252 2574 A
(dependent)378 2868 A
(entry)210 3288 A
(points)252 3540 A
3834(*/)S
3825 V
(11503)210 1122 A
(int)126 1440 A
(extdev;)294 1608 A
2448(/*)S
(extended)336 2574 A
(partition)378 2952 A
3372(to)S
(scan)168 3498 A
3708(*/)S
3915 V
(11504)210 1122 A
(unsigned)336 1440 A
(long)168 1818 A
(extbase;)336 2028 A
2448(/*)S
(sector)252 2574 A
(offset)252 2868 A
3162(of)S
(the)126 3288 A
(base)168 3456 A
(extended)336 3666 A
(partition)378 4044 A
4464(*/)S
4005 V
(11505)210 1122 A
1440({)S
4095 V
(11506)210 1122 A
1440(/*)S
(Extended)336 1566 A
(partitions)420 1944 A
(cannot)252 2406 A
2700(be)S
(ignored)294 2826 A
(alas,)210 3162 A
(because)294 3414 A
(people)252 3750 A
(like)168 4044 A
4254(to)S
(move)168 4380 A
4185 V
(11507)210 1122 A
1482(*)S
(files)210 1566 A
1818(to)S
(and)126 1944 A
(from)168 2112 A
(DOS)126 2322 A
(partitions.)462 2490 A
(Avoid)210 3036 A
(reading)294 3288 A
(this)168 3624 A
(code,)210 3834 A
(it's)168 4086 A
4296(no)S
(fun.)168 4422 A
4275 V
(11508)210 1122 A
1482(*/)S
4365 V
(11509)210 1122 A
(struct)252 1524 A
(part_entry)420 1818 A
(table[NR_PARTITIONS],)882 2280 A
(*pe;)168 3204 A
4455 V
(11510)210 1122 A
(int)126 1524 A
(subdev,)294 1692 A
(disk,)210 2028 A
(par;)168 2280 A
4545 V
(11511)210 1122 A
(struct)252 1524 A
(device)252 1818 A
(*dv;)168 2112 A
4635 V
(11512)210 1122 A
(unsigned)336 1524 A
(long)168 1902 A
(offset,)294 2112 A
(nextoffset;)462 2448 A
4725 V
(11513)210 1122 A
4815 V
(11514)210 1122 A
(disk)168 1524 A
1734(=)S
(extdev)252 1818 A
2112(/)S
(DEV_PER_DRIVE;)588 2196 A
4905 V
(11515)210 1122 A
(par)126 1524 A
1692(=)S
(extdev)252 1776 A
2070(%)S
(DEV_PER_DRIVE)546 2154 A
2742(-)S
2826(1;)S
4995 V
(11516)210 1122 A
(subdev)252 1524 A
1818(=)S
(MINOR_d0p0s0)504 1902 A
2448(+)S
(\(disk)210 2532 A
2784(*)S
(NR_PARTITIONS)546 2868 A
3456(+)S
(par\))168 3540 A
3750(*)S
(NR_PARTITIONS;)588 3834 A
5085 V
(11517)210 1122 A
5175 V
(11518)210 1122 A
(offset)252 1524 A
1818(=)S
1902(0;)S
5265 V
(11519)210 1122 A
1524(do)S
1650({)S
5355 V
(11520)210 1122 A
1776(if)S
(\(!get_part_table\(dp,)840 1902 A
(extdev,)294 2784 A
(offset,)294 3120 A
(table\)\))294 3456 A
(return;)294 3792 A
5445 V
(11521)210 1122 A
(sort\(table\);)504 1776 A
5535 V
(11522)210 1122 A
5625 V
(11523)210 1122 A
1776(/*)S
(The)126 1902 A
(table)210 2070 A
(should)252 2322 A
(contain)294 2616 A
(one)126 2952 A
(logical)294 3120 A
(partition)378 3456 A
(and)126 3876 A
(optionally)420 4044 A
5715 V
(11524)210 1122 A
1818(*)S
(another)294 1902 A
(extended)336 2238 A
(partition.)420 2616 A
(\(It's)210 3120 A
3372(a)S
(linked)252 3456 A
(list.\))252 3750 A
5805 V
(11525)210 1122 A
1818(*/)S
5895 V
(11526)210 1122 A
(nextoffset)420 1776 A
2238(=)S
2322(0;)S
5985 V
(11527)210 1122 A
(for)126 1776 A
(\(par)168 1944 A
2154(=)S
2238(0;)S
(par)126 2364 A
2532(<)S
(NR_PARTITIONS;)588 2616 A
(par++\))252 3246 A
3540({)S
6075 V
(11528)210 1122 A
2112(pe)S
2238(=)S
(&table[par];)504 2322 A
6165 V
(11529)210 1122 A
2112(if)S
(\(ext_part\(pe->sysind\)\))924 2238 A
3204({)S
6255 V
(11530)210 1122 A
(nextoffset)420 2448 A
2910(=)S
(pe->lowsec;)462 2994 A
6345 V
(11531)210 1122 A
2112(})S
(else)168 2196 A
6435 V
(11532)210 1122 A
2112(if)S
(\(pe->sysind)462 2238 A
2742(!=)S
(NO_PART\))336 2868 A
3246({)S
6525 V
(11533)210 1122 A
2448(if)S
(\(\(dv)168 2574 A
2784(=)S
(\(*dp->dr_prepare\)\(subdev\)\))1092 2868 A
4002(==)S
(NIL_DEV\))336 4128 A
(return;)294 4506 A
6615 V
(11534)210 1122 A
6705 V
(11535)210 1122 A
(dv->dv_base)462 2448 A
2952(=)S
(mul64u\(extbase)588 3036 A
3666(+)S
(offset)252 3750 A
4044(+)S
(pe->lowsec,)462 4128 A
6795 V
(11536)210 1122 A
(SECTOR_SIZE\);)546 4128 A
6885 V
(11537)210 1122 A
(dv->dv_size)462 2448 A
2952(=)S
(mul64u\(pe->size,)672 3036 A
(SECTOR_SIZE\);)546 3750 A
6975 V
(11538)210 1122 A
7065 V
(11539)210 1122 A
2448(/*)S
(Out)126 2574 A
2742(of)S
(devices?)336 2868 A
3246(*/)S
8418 V
EP
%%Page: 143 143
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2216(File:)S
(drivers/libdriver/drvlib.c)1094 2449 A
12 B
(143)180 4500 A
1755 V
7 LST
(11540)210 1122 A
2448(if)S
(\(++subdev)378 2574 A
2994(%)S
(NR_PARTITIONS)546 3078 A
3666(==)S
3792(0\))S
(return;)294 3918 A
1845 V
(11541)210 1122 A
2112(})S
1935 V
(11542)210 1122 A
1776(})S
2025 V
(11543)210 1122 A
1524(})S
(while)210 1608 A
(\(\(offset)336 1860 A
2238(=)S
(nextoffset\))462 2322 A
2826(!=)S
(0\);)126 2952 A
2115 V
(11544)210 1122 A
1440(})S
2295 V
(11546)210 1122 A
(/*============================================================================*)3318 1440 A
2385 V
(11547)210 1122 A
1482(*)S
(get_part_table)588 2784 A
4716(*)S
2475 V
(11548)210 1122 A
(*============================================================================*/)3318 1482 A
2565 V
(11549)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(get_part_table\(dp,)756 1944 A
(device,)294 2742 A
(offset,)294 3078 A
(table\))252 3414 A
2655 V
(11550)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dp;)168 2028 A
2745 V
(11551)210 1122 A
(int)126 1440 A
(device;)294 1608 A
2835 V
(11552)210 1122 A
(unsigned)336 1440 A
(long)168 1818 A
(offset;)294 2028 A
2784(/*)S
(sector)252 2910 A
(offset)252 3204 A
3498(to)S
(the)126 3624 A
(table)210 3792 A
4044(*/)S
2925 V
(11553)210 1122 A
(struct)252 1440 A
(part_entry)420 1734 A
(*table;)294 2196 A
2784(/*)S
(four)168 2910 A
(entries)294 3120 A
3456(*/)S
3015 V
(11554)210 1122 A
1440({)S
3105 V
(11555)210 1122 A
1440(/*)S
(Read)168 1566 A
(the)126 1776 A
(partition)378 1944 A
(table)210 2364 A
(for)126 2616 A
(the)126 2784 A
(device,)294 2952 A
(return)252 3288 A
(true)168 3582 A
(iff)126 3792 A
(there)210 3960 A
(were)168 4212 A
4422(no)S
3195 V
(11556)210 1122 A
1482(*)S
(errors.)294 1566 A
3285 V
(11557)210 1122 A
1482(*/)S
3375 V
(11558)210 1122 A
(iovec_t)294 1524 A
(iovec1;)294 1860 A
3465 V
(11559)210 1122 A
(off_t)210 1524 A
(position;)378 1776 A
3555 V
(11560)210 1122 A
(static)252 1524 A
(unsigned)336 1818 A
(char)168 2196 A
(partbuf[CD_SECTOR_SIZE];)1008 2406 A
3645 V
(11561)210 1122 A
3735 V
(11562)210 1122 A
(position)336 1524 A
1902(=)S
(offset)252 1986 A
2280(<<)S
(SECTOR_SHIFT;)546 2406 A
3825 V
(11563)210 1122 A
(iovec1.iov_addr)630 1524 A
2196(=)S
(\(vir_bytes\))462 2280 A
(partbuf;)336 2784 A
3915 V
(11564)210 1122 A
(iovec1.iov_size)630 1524 A
2196(=)S
(CD_SECTOR_SIZE;)630 2280 A
4005 V
(11565)210 1122 A
1524(if)S
(\(\(*dp->dr_prepare\)\(device\))1092 1650 A
2784(!=)S
(NIL_DEV\))336 2910 A
3288({)S
4095 V
(11566)210 1122 A
(\(void\))252 1776 A
(\(*dp->dr_transfer\)\(SELF,)1008 2070 A
(DEV_GATHER,)462 3120 A
(position,)378 3624 A
(&iovec1,)336 4044 A
(1\);)126 4422 A
4185 V
(11567)210 1122 A
1524(})S
4275 V
(11568)210 1122 A
1524(if)S
(\(iovec1.iov_size)672 1650 A
2364(!=)S
2490(0\))S
2616({)S
4365 V
(11569)210 1122 A
(return)252 1776 A
2070(0;)S
4455 V
(11570)210 1122 A
1524(})S
4545 V
(11571)210 1122 A
1524(if)S
(\(partbuf[510])546 1650 A
2238(!=)S
(0x55)168 2364 A
2574(||)S
(partbuf[511])504 2700 A
3246(!=)S
(0xAA\))210 3372 A
3624({)S
4635 V
(11572)210 1122 A
1776(/*)S
(Invalid)294 1902 A
(partition)378 2238 A
(table.)252 2658 A
2952(*/)S
4725 V
(11573)210 1122 A
(return)252 1776 A
2070(0;)S
4815 V
(11574)210 1122 A
1524(})S
4905 V
(11575)210 1122 A
(memcpy\(table,)546 1524 A
(\(partbuf)336 2112 A
2490(+)S
(PART_TABLE_OFF\),)672 2574 A
(NR_PARTITIONS)546 3288 A
3876(*)S
(sizeof\(table[0]\)\);)756 3960 A
4995 V
(11576)210 1122 A
(return)252 1524 A
1818(1;)S
5085 V
(11577)210 1122 A
1440(})S
5265 V
(11579)210 1122 A
(/*===========================================================================*)3276 1440 A
5355 V
(11580)210 1122 A
1482(*)S
(sort)168 2784 A
4674(*)S
5445 V
(11581)210 1122 A
(*===========================================================================*/)3276 1482 A
5535 V
(11582)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(sort\(table\))462 1986 A
5625 V
(11583)210 1122 A
(struct)252 1440 A
(part_entry)420 1734 A
(*table;)294 2196 A
5715 V
(11584)210 1122 A
1440({)S
5805 V
(11585)210 1122 A
1440(/*)S
(Sort)168 1566 A
1776(a)S
(partition)378 1860 A
(table.)252 2280 A
2574(*/)S
5895 V
(11586)210 1122 A
(struct)252 1524 A
(part_entry)420 1818 A
(*pe,)168 2280 A
(tmp;)168 2490 A
5985 V
(11587)210 1122 A
(int)126 1524 A
1692(n)S
1776(=)S
(NR_PARTITIONS;)588 1860 A
6075 V
(11588)210 1122 A
6165 V
(11589)210 1122 A
1524(do)S
1650({)S
6255 V
(11590)210 1122 A
(for)126 1776 A
(\(pe)126 1944 A
2112(=)S
(table;)252 2196 A
2490(pe)S
2616(<)S
(table)210 2700 A
2952(+)S
(NR_PARTITIONS-1;)672 3036 A
(pe++\))210 3750 A
4002({)S
6345 V
(11591)210 1122 A
2112(if)S
(\(pe[0].sysind)546 2238 A
2826(==)S
(NO_PART)294 2952 A
6435 V
(11592)210 1122 A
2448(||)S
(\(pe[0].lowsec)546 2574 A
3162(>)S
(pe[1].lowsec)504 3246 A
6525 V
(11593)210 1122 A
3120(&&)S
(pe[1].sysind)504 3246 A
3792(!=)S
(NO_PART\)\))378 3918 A
4338({)S
6615 V
(11594)210 1122 A
(tmp)126 2448 A
2616(=)S
(pe[0];)252 2700 A
(pe[0])210 2994 A
3246(=)S
(pe[1];)252 3330 A
(pe[1])210 3624 A
3876(=)S
(tmp;)168 3960 A
6705 V
(11595)210 1122 A
2112(})S
6795 V
(11596)210 1122 A
1776(})S
6885 V
(11597)210 1122 A
1524(})S
(while)210 1608 A
(\(--n)168 1860 A
2070(>)S
(0\);)126 2154 A
6975 V
(11598)210 1122 A
1440(})S
8418 V
EP
%%Page: 144 144
BP
/slant 0 def
/height 0 def
1485 V
12 B
(144)180 1080 A
11 R
2170(File:)S
2403(drivers/memory/memory.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(drivers/memory/memory.c)966 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(11600)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(device)252 2532 A
(dependent)378 2826 A
(part)168 3246 A
3456(of)S
(the)126 3582 A
(drivers)294 3750 A
(for)126 4086 A
(the)126 4254 A
2295 V
(11601)210 1122 A
1482(*)S
(following)378 1566 A
(special)294 1986 A
(files:)252 2322 A
2385 V
(11602)210 1122 A
1482(*)S
(/dev/ram)336 1734 A
2448(-)S
(RAM)126 2532 A
(disk)168 2700 A
2475 V
(11603)210 1122 A
1482(*)S
(/dev/mem)336 1734 A
2448(-)S
(absolute)336 2532 A
(memory)252 2910 A
2565 V
(11604)210 1122 A
1482(*)S
(/dev/kmem)378 1734 A
2448(-)S
(kernel)252 2532 A
(virtual)294 2826 A
(memory)252 3162 A
2655 V
(11605)210 1122 A
1482(*)S
(/dev/null)378 1734 A
2448(-)S
(null)168 2532 A
(device)252 2742 A
(\(data)210 3036 A
(sink\))210 3288 A
2745 V
(11606)210 1122 A
1482(*)S
(/dev/boot)378 1734 A
2448(-)S
(boot)168 2532 A
(device)252 2742 A
(loaded)252 3036 A
(from)168 3330 A
(boot)168 3540 A
(image)210 3750 A
2835 V
(11607)210 1122 A
1482(*)S
(/dev/zero)378 1734 A
2448(-)S
(null)168 2532 A
(byte)168 2742 A
(stream)252 2952 A
(generator)378 3246 A
2925 V
(11608)210 1122 A
1482(*)S
3015 V
(11609)210 1122 A
1482(*)S
(Changes:)336 1608 A
3105 V
(11610)210 1122 A
1482(*)S
(Apr)126 1776 A
(29,)126 1944 A
(2005)168 2112 A
(added)210 2448 A
(null)168 2700 A
(byte)168 2910 A
(generator)378 3120 A
(\(Jorrit)294 3582 A
3918(N.)S
(Herder\))294 4044 A
3195 V
(11611)210 1122 A
1482(*)S
(Apr)126 1776 A
(09,)126 1944 A
(2005)168 2112 A
(added)210 2448 A
(support)294 2700 A
(for)126 3036 A
(boot)168 3204 A
(device)252 3414 A
(\(Jorrit)294 3750 A
4086(N.)S
(Herder\))294 4212 A
3285 V
(11612)210 1122 A
1482(*)S
(Jul)126 1776 A
(26,)126 1944 A
(2004)168 2112 A
(moved)210 2448 A
(RAM)126 2700 A
(driver)252 2868 A
3162(to)S
(user-space)420 3288 A
(\(Jorrit)294 3792 A
4128(N.)S
(Herder\))294 4254 A
3375 V
(11613)210 1122 A
1482(*)S
(Apr)126 1776 A
(20,)126 1944 A
(1992)168 2112 A
(device)252 2448 A
(dependent/independent)882 2742 A
(split)210 3666 A
(\(Kees)210 3960 A
4212(J.)S
(Bot\))168 4338 A
3465 V
(11614)210 1122 A
1482(*/)S
3555 V
(11615)210 1122 A
3645 V
(11616)210 1122 A
(#include)336 1440 A
("../drivers.h")588 1818 A
3735 V
(11617)210 1122 A
(#include)336 1440 A
("../libdriver/driver.h")966 1818 A
3825 V
(11618)210 1122 A
(#include)336 1440 A
(<sys/ioc_memory.h>)756 1818 A
3915 V
(11619)210 1122 A
(#include)336 1440 A
("../../kernel/const.h")924 1818 A
4005 V
(11620)210 1122 A
(#include)336 1440 A
("../../kernel/config.h")966 1818 A
4095 V
(11621)210 1122 A
(#include)336 1440 A
("../../kernel/type.h")882 1818 A
4185 V
(11622)210 1122 A
4275 V
(11623)210 1122 A
(#include)336 1440 A
("assert.h")420 1818 A
4365 V
(11624)210 1122 A
4455 V
(11625)210 1122 A
(#define)294 1440 A
(NR_DEVS)294 1776 A
2574(6)S
3120(/*)S
(number)252 3246 A
3540(of)S
(minor)210 3666 A
(devices)294 3918 A
4254(*/)S
4545 V
(11626)210 1122 A
4635 V
(11627)210 1122 A
(PRIVATE)294 1440 A
(struct)252 1776 A
(device)252 2070 A
(m_geom[NR_DEVS];)672 2364 A
3120(/*)S
(base)168 3246 A
(and)126 3456 A
(size)168 3624 A
3834(of)S
(each)168 3960 A
(device)252 4170 A
4464(*/)S
4725 V
(11628)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(m_seg[NR_DEVS];)630 1944 A
3120(/*)S
(segment)294 3246 A
(index)210 3582 A
3834(of)S
(each)168 3960 A
(device)252 4170 A
4464(*/)S
4815 V
(11629)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(m_device;)378 1944 A
3120(/*)S
(current)294 3246 A
(device)252 3582 A
3876(*/)S
4905 V
(11630)210 1122 A
(PRIVATE)294 1440 A
(struct)252 1776 A
(kinfo)210 2070 A
(kinfo;)252 2322 A
3120(/*)S
(kernel)252 3246 A
(information)462 3540 A
4044(*/)S
4995 V
(11631)210 1122 A
(PRIVATE)294 1440 A
(struct)252 1776 A
(machine)294 2070 A
(machine;)336 2406 A
3120(/*)S
(machine)294 3246 A
(information)462 3582 A
4086(*/)S
5085 V
(11632)210 1122 A
5175 V
(11633)210 1122 A
(extern)252 1440 A
(int)126 1734 A
(errno;)252 1902 A
3120(/*)S
(error)210 3246 A
(number)252 3498 A
(for)126 3792 A
3960(PM)S
(calls)210 4086 A
4338(*/)S
5265 V
(11634)210 1122 A
5355 V
(11635)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(char)168 2280 A
(*m_name,)336 2490 A
(\(void\))252 2868 A
4464(\);)S
5445 V
(11636)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(struct)252 2280 A
(device)252 2574 A
(*m_prepare,)462 2868 A
(\(int)168 3372 A
(device\))294 3582 A
4464(\);)S
5535 V
(11637)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(m_transfer,)462 2448 A
(\(int)168 2952 A
(proc_nr,)336 3162 A
(int)126 3540 A
(opcode,)294 3708 A
(off_t)210 4044 A
(position,)378 4296 A
5625 V
(11638)210 1122 A
(iovec_t)294 3120 A
(*iov,)210 3456 A
(unsigned)336 3708 A
(nr_req\))294 4086 A
4464(\);)S
5715 V
(11639)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(m_do_open,)420 2448 A
(\(struct)294 2910 A
(driver)252 3246 A
(*dp,)168 3540 A
(message)294 3750 A
(*m_ptr\))294 4086 A
4464(\);)S
5805 V
(11640)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(m_init,)294 2490 A
(\(void\))252 2826 A
3120(\);)S
5895 V
(11641)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(m_ioctl,)336 2448 A
(\(struct)294 2826 A
(driver)252 3162 A
(*dp,)168 3456 A
(message)294 3666 A
(*m_ptr\))294 4002 A
4464(\);)S
5985 V
(11642)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(m_geometry,)462 2490 A
(\(struct)294 2994 A
(partition)378 3330 A
(*entry\))294 3750 A
4464(\);)S
6075 V
(11643)210 1122 A
6165 V
(11644)210 1122 A
1440(/*)S
(Entry)210 1566 A
(points)252 1818 A
2112(to)S
(this)168 2238 A
(driver.)294 2448 A
2784(*/)S
6255 V
(11645)210 1122 A
(PRIVATE)294 1440 A
(struct)252 1776 A
(driver)252 2070 A
(m_dtab)252 2364 A
2658(=)S
2742({)S
6345 V
(11646)210 1122 A
(m_name,)294 1524 A
2112(/*)S
(current)294 2238 A
(device's)336 2574 A
(name)168 2952 A
3162(*/)S
6435 V
(11647)210 1122 A
(m_do_open,)420 1524 A
2112(/*)S
(open)168 2238 A
2448(or)S
(mount)210 2574 A
2826(*/)S
6525 V
(11648)210 1122 A
(do_nop,)294 1524 A
2112(/*)S
(nothing)294 2238 A
2574(on)S
2700(a)S
(close)210 2784 A
3036(*/)S
6615 V
(11649)210 1122 A
(m_ioctl,)336 1524 A
2112(/*)S
(specify)294 2238 A
(ram)126 2574 A
(disk)168 2742 A
(geometry)336 2952 A
3330(*/)S
6705 V
(11650)210 1122 A
(m_prepare,)420 1524 A
2112(/*)S
(prepare)294 2238 A
(for)126 2574 A
(I/O)126 2742 A
2910(on)S
3036(a)S
(given)210 3120 A
(minor)210 3372 A
(device)252 3624 A
3918(*/)S
6795 V
(11651)210 1122 A
(m_transfer,)462 1524 A
2112(/*)S
2238(do)S
(the)126 2364 A
(I/O)126 2532 A
2700(*/)S
6885 V
(11652)210 1122 A
(nop_cleanup,)504 1524 A
2112(/*)S
2238(no)S
(need)168 2364 A
2574(to)S
(clean)210 2700 A
2952(up)S
3078(*/)S
6975 V
(11653)210 1122 A
(m_geometry,)462 1524 A
2112(/*)S
(memory)252 2238 A
(device)252 2532 A
("geometry")420 2826 A
3288(*/)S
7065 V
(11654)210 1122 A
(nop_signal,)462 1524 A
2112(/*)S
(system)252 2238 A
(signals)294 2532 A
2868(*/)S
8418 V
EP
%%Page: 145 145
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2170(File:)S
2403(drivers/memory/memory.c)S
12 B
(145)180 4500 A
1755 V
7 LST
(11655)210 1122 A
(nop_alarm,)420 1524 A
1845 V
(11656)210 1122 A
(nop_cancel,)462 1524 A
1935 V
(11657)210 1122 A
(nop_select,)462 1524 A
2025 V
(11658)210 1122 A
(NULL,)210 1524 A
2115 V
(11659)210 1122 A
(NULL)168 1524 A
2205 V
(11660)210 1122 A
1440(};)S
2295 V
(11661)210 1122 A
2385 V
(11662)210 1122 A
1440(/*)S
(Buffer)252 1566 A
(for)126 1860 A
(the)126 2028 A
(/dev/zero)378 2196 A
(null)168 2616 A
(byte)168 2826 A
(feed.)210 3036 A
3288(*/)S
2475 V
(11663)210 1122 A
(#define)294 1440 A
(ZERO_BUF_SIZE)546 1776 A
(1024)168 3120 A
2565 V
(11664)210 1122 A
(PRIVATE)294 1440 A
(char)168 1776 A
(dev_zero[ZERO_BUF_SIZE];)1008 1986 A
2655 V
(11665)210 1122 A
2745 V
(11666)210 1122 A
(#define)294 1440 A
(click_to_round_k\(n\))798 1776 A
2616(\\)S
2835 V
(11667)210 1122 A
(\(\(unsigned\))462 1776 A
(\(\(\(\(unsigned)504 2280 A
(long\))210 2826 A
(\(n\))126 3078 A
3246(<<)S
(CLICK_SHIFT\))504 3372 A
3918(+)S
(512\))168 4002 A
4212(/)S
(1024\)\))252 4296 A
2925 V
(11668)210 1122 A
3015 V
(11669)210 1122 A
(/*===========================================================================*)3276 1440 A
3105 V
(11670)210 1122 A
1482(*)S
(main)168 2910 A
4674(*)S
3195 V
(11671)210 1122 A
(*===========================================================================*/)3276 1482 A
3285 V
(11672)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(main\(void\))420 1902 A
3375 V
(11673)210 1122 A
1440({)S
3465 V
(11674)210 1122 A
1440(/*)S
(Main)168 1566 A
(program.)336 1776 A
(Initialize)420 2154 A
(the)126 2616 A
(memory)252 2784 A
(driver)252 3078 A
(and)126 3372 A
(start)210 3540 A
(the)126 3792 A
(main)168 3960 A
(loop.)210 4170 A
4422(*/)S
3555 V
(11675)210 1122 A
(m_init\(\);)378 1524 A
3645 V
(11676)210 1122 A
(driver_task\(&m_dtab\);)882 1524 A
3735 V
(11677)210 1122 A
(return\(OK\);)462 1524 A
3825 V
(11678)210 1122 A
1440(})S
4005 V
(11680)210 1122 A
(/*===========================================================================*)3276 1440 A
4095 V
(11681)210 1122 A
1482(*)S
(m_name)252 2826 A
4674(*)S
4185 V
(11682)210 1122 A
(*===========================================================================*/)3276 1482 A
4275 V
(11683)210 1122 A
(PRIVATE)294 1440 A
(char)168 1776 A
(*m_name\(\))378 1986 A
4365 V
(11684)210 1122 A
1440({)S
4455 V
(11685)210 1122 A
1440(/*)S
(Return)252 1566 A
1860(a)S
(name)168 1944 A
(for)126 2154 A
(the)126 2322 A
(current)294 2490 A
(device.)294 2826 A
3162(*/)S
4545 V
(11686)210 1122 A
(static)252 1524 A
(char)168 1818 A
(name[])252 2028 A
2322(=)S
("memory";)378 2406 A
4635 V
(11687)210 1122 A
(return)252 1524 A
(name;)210 1818 A
4725 V
(11688)210 1122 A
1440(})S
4905 V
(11690)210 1122 A
(/*===========================================================================*)3276 1440 A
4995 V
(11691)210 1122 A
1482(*)S
(m_prepare)378 2784 A
4674(*)S
5085 V
(11692)210 1122 A
(*===========================================================================*/)3276 1482 A
5175 V
(11693)210 1122 A
(PRIVATE)294 1440 A
(struct)252 1776 A
(device)252 2070 A
(*m_prepare\(device\))756 2364 A
5265 V
(11694)210 1122 A
(int)126 1440 A
(device;)294 1608 A
5355 V
(11695)210 1122 A
1440({)S
5445 V
(11696)210 1122 A
1440(/*)S
(Prepare)294 1566 A
(for)126 1902 A
(I/O)126 2070 A
2238(on)S
2364(a)S
(device:)294 2448 A
(check)210 2784 A
3036(if)S
(the)126 3162 A
(minor)210 3330 A
(device)252 3582 A
(number)252 3876 A
4170(is)S
(ok.)126 4296 A
4464(*/)S
5535 V
(11697)210 1122 A
1524(if)S
(\(device)294 1650 A
1986(<)S
2070(0)S
2154(||)S
(device)252 2280 A
2574(>=)S
(NR_DEVS\))336 2700 A
(return\(NIL_DEV\);)672 3078 A
5625 V
(11698)210 1122 A
(m_device)336 1524 A
1902(=)S
(device;)294 1986 A
5715 V
(11699)210 1122 A
5805 V
(11700)210 1122 A
(return\(&m_geom[device]\);)1008 1524 A
5895 V
(11701)210 1122 A
1440(})S
6075 V
(11703)210 1122 A
(/*===========================================================================*)3276 1440 A
6165 V
(11704)210 1122 A
1482(*)S
(m_transfer)420 2784 A
4674(*)S
6255 V
(11705)210 1122 A
(*===========================================================================*/)3276 1482 A
6345 V
(11706)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(m_transfer\(proc_nr,)798 1944 A
(opcode,)294 2784 A
(position,)378 3120 A
(iov,)168 3540 A
(nr_req\))294 3750 A
6435 V
(11707)210 1122 A
(int)126 1440 A
(proc_nr;)336 1608 A
2784(/*)S
(process)294 2910 A
(doing)210 3246 A
(the)126 3498 A
(request)294 3666 A
4002(*/)S
6525 V
(11708)210 1122 A
(int)126 1440 A
(opcode;)294 1608 A
2784(/*)S
(DEV_GATHER)420 2910 A
3372(or)S
(DEV_SCATTER)462 3498 A
4002(*/)S
6615 V
(11709)210 1122 A
(off_t)210 1440 A
(position;)378 1692 A
2784(/*)S
(offset)252 2910 A
3204(on)S
(device)252 3330 A
3624(to)S
(read)168 3750 A
3960(or)S
(write)210 4086 A
4338(*/)S
6705 V
(11710)210 1122 A
(iovec_t)294 1440 A
(*iov;)210 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(read)168 3372 A
3582(or)S
(write)210 3708 A
(request)294 3960 A
(vector)252 4296 A
4590(*/)S
6795 V
(11711)210 1122 A
(unsigned)336 1440 A
(nr_req;)294 1818 A
2784(/*)S
(length)252 2910 A
3204(of)S
(request)294 3330 A
(vector)252 3666 A
3960(*/)S
6885 V
(11712)210 1122 A
1440({)S
6975 V
(11713)210 1122 A
1440(/*)S
(Read)168 1566 A
1776(or)S
(write)210 1902 A
(one)126 2154 A
(the)126 2322 A
(driver's)336 2490 A
(minor)210 2868 A
(devices.)336 3120 A
3498(*/)S
7065 V
(11714)210 1122 A
(phys_bytes)420 1524 A
(mem_phys;)378 1986 A
8418 V
EP
%%Page: 146 146
BP
/slant 0 def
/height 0 def
1485 V
12 B
(146)180 1080 A
11 R
2170(File:)S
2403(drivers/memory/memory.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(11715)210 1122 A
(int)126 1524 A
(seg;)168 1692 A
1845 V
(11716)210 1122 A
(unsigned)336 1524 A
(count,)252 1902 A
(left,)210 2196 A
(chunk;)252 2448 A
1935 V
(11717)210 1122 A
(vir_bytes)378 1524 A
(user_vir;)378 1944 A
2025 V
(11718)210 1122 A
(struct)252 1524 A
(device)252 1818 A
(*dv;)168 2112 A
2115 V
(11719)210 1122 A
(unsigned)336 1524 A
(long)168 1902 A
(dv_size;)336 2112 A
2205 V
(11720)210 1122 A
(int)126 1524 A
1692(s;)S
2295 V
(11721)210 1122 A
2385 V
(11722)210 1122 A
1524(/*)S
(Get)126 1650 A
(minor)210 1818 A
(device)252 2070 A
(number)252 2364 A
(and)126 2658 A
(check)210 2826 A
(for)126 3078 A
(/dev/null.)420 3246 A
3708(*/)S
2475 V
(11723)210 1122 A
1524(dv)S
1650(=)S
(&m_geom[m_device];)756 1734 A
2565 V
(11724)210 1122 A
(dv_size)294 1524 A
1860(=)S
(cv64ul\(dv->dv_size\);)840 1944 A
2655 V
(11725)210 1122 A
2745 V
(11726)210 1122 A
(while)210 1524 A
(\(nr_req)294 1776 A
2112(>)S
2196(0\))S
2322({)S
2835 V
(11727)210 1122 A
2925 V
(11728)210 1122 A
1776(/*)S
(How)126 1902 A
(much)168 2070 A
2280(to)S
(transfer)336 2406 A
(and)126 2784 A
(where)210 2952 A
3204(to)S
3330(/)S
(from.)210 3414 A
3666(*/)S
3015 V
(11729)210 1122 A
(count)210 1776 A
2028(=)S
(iov->iov_size;)588 2112 A
3105 V
(11730)210 1122 A
(user_vir)336 1776 A
2154(=)S
(iov->iov_addr;)588 2238 A
3195 V
(11731)210 1122 A
3285 V
(11732)210 1122 A
(switch)252 1776 A
(\(m_device\))420 2070 A
2532({)S
3375 V
(11733)210 1122 A
3465 V
(11734)210 1122 A
1776(/*)S
1902(No)S
(copying;)336 2028 A
(ignore)252 2406 A
(request.)336 2700 A
3078(*/)S
3555 V
(11735)210 1122 A
(case)168 1776 A
(NULL_DEV:)378 1986 A
3645 V
(11736)210 1122 A
1944(if)S
(\(opcode)294 2070 A
2406(==)S
(DEV_GATHER\))462 2532 A
(return\(OK\);)462 3036 A
3792(/*)S
(always)252 3918 A
4212(at)S
(EOF)126 4338 A
4506(*/)S
3735 V
(11737)210 1122 A
(break;)252 1944 A
3825 V
(11738)210 1122 A
3915 V
(11739)210 1122 A
1776(/*)S
(Virtual)294 1902 A
(copying.)336 2238 A
(For)126 2616 A
(RAM)126 2784 A
(disk,)210 2952 A
(kernel)252 3204 A
(memory)252 3498 A
(and)126 3792 A
(boot)168 3960 A
(device.)294 4170 A
4506(*/)S
4005 V
(11740)210 1122 A
(case)168 1776 A
(RAM_DEV:)336 1986 A
4095 V
(11741)210 1122 A
(case)168 1776 A
(KMEM_DEV:)378 1986 A
4185 V
(11742)210 1122 A
(case)168 1776 A
(BOOT_DEV:)378 1986 A
4275 V
(11743)210 1122 A
1944(if)S
(\(position)378 2070 A
2490(>=)S
(dv_size\))336 2616 A
(return\(OK\);)462 2994 A
3792(/*)S
(check)210 3918 A
(for)126 4170 A
(EOF)126 4338 A
4506(*/)S
4365 V
(11744)210 1122 A
1944(if)S
(\(position)378 2070 A
2490(+)S
(count)210 2574 A
2826(>)S
(dv_size\))336 2910 A
(count)210 3288 A
3540(=)S
(dv_size)294 3624 A
3960(-)S
(position;)378 4044 A
4455 V
(11745)210 1122 A
(seg)126 1944 A
2112(=)S
(m_seg[m_device];)672 2196 A
4545 V
(11746)210 1122 A
4635 V
(11747)210 1122 A
1944(if)S
(\(opcode)294 2070 A
2406(==)S
(DEV_GATHER\))462 2532 A
3036({)S
3792(/*)S
(copy)168 3918 A
(actual)252 4128 A
(data)168 4422 A
4632(*/)S
4725 V
(11748)210 1122 A
(sys_vircopy\(SELF,seg,position,)1260 2112 A
(proc_nr,D,user_vir,)798 3414 A
(count\);)294 4254 A
4815 V
(11749)210 1122 A
1944(})S
(else)168 2028 A
2238({)S
4905 V
(11750)210 1122 A
(sys_vircopy\(proc_nr,D,user_vir,)1302 2112 A
(SELF,seg,position,)756 3456 A
(count\);)294 4254 A
4995 V
(11751)210 1122 A
1944(})S
5085 V
(11752)210 1122 A
(break;)252 1944 A
5175 V
(11753)210 1122 A
5265 V
(11754)210 1122 A
1776(/*)S
(Physical)336 1902 A
(copying.)336 2280 A
(Only)168 2658 A
(used)168 2868 A
3078(to)S
(access)252 3204 A
(entire)252 3498 A
(memory.)294 3792 A
4128(*/)S
5355 V
(11755)210 1122 A
(case)168 1776 A
(MEM_DEV:)336 1986 A
5445 V
(11756)210 1122 A
1944(if)S
(\(position)378 2070 A
2490(>=)S
(dv_size\))336 2616 A
(return\(OK\);)462 2994 A
3792(/*)S
(check)210 3918 A
(for)126 4170 A
(EOF)126 4338 A
4506(*/)S
5535 V
(11757)210 1122 A
1944(if)S
(\(position)378 2070 A
2490(+)S
(count)210 2574 A
2826(>)S
(dv_size\))336 2910 A
(count)210 3288 A
3540(=)S
(dv_size)294 3624 A
3960(-)S
(position;)378 4044 A
5625 V
(11758)210 1122 A
(mem_phys)336 1944 A
2322(=)S
(cv64ul\(dv->dv_base\))798 2406 A
3246(+)S
(position;)378 3330 A
5715 V
(11759)210 1122 A
5805 V
(11760)210 1122 A
1944(if)S
(\(opcode)294 2070 A
2406(==)S
(DEV_GATHER\))462 2532 A
3036({)S
3792(/*)S
(copy)168 3918 A
(data)168 4128 A
4338(*/)S
5895 V
(11761)210 1122 A
(sys_physcopy\(NONE,)756 2112 A
(PHYS_SEG,)378 2910 A
(mem_phys,)378 3330 A
5985 V
(11762)210 1122 A
(proc_nr,)336 2448 A
2826(D,)S
(user_vir,)378 2952 A
(count\);)294 3372 A
6075 V
(11763)210 1122 A
1944(})S
(else)168 2028 A
2238({)S
6165 V
(11764)210 1122 A
(sys_physcopy\(proc_nr,)882 2112 A
3036(D,)S
(user_vir,)378 3162 A
6255 V
(11765)210 1122 A
(NONE,)210 2448 A
(PHYS_SEG,)378 2700 A
(mem_phys,)378 3120 A
(count\);)294 3540 A
6345 V
(11766)210 1122 A
1944(})S
6435 V
(11767)210 1122 A
(break;)252 1944 A
6525 V
(11768)210 1122 A
6615 V
(11769)210 1122 A
1776(/*)S
(Null)168 1902 A
(byte)168 2112 A
(stream)252 2322 A
(generator.)420 2616 A
3078(*/)S
6705 V
(11770)210 1122 A
(case)168 1776 A
(ZERO_DEV:)378 1986 A
6795 V
(11771)210 1122 A
1944(if)S
(\(opcode)294 2070 A
2406(==)S
(DEV_GATHER\))462 2532 A
3036({)S
6885 V
(11772)210 1122 A
(left)168 2112 A
2322(=)S
(count;)252 2406 A
6975 V
(11773)210 1122 A
(while)210 2112 A
(\(left)210 2364 A
2616(>)S
2700(0\))S
2826({)S
7065 V
(11774)210 1122 A
(chunk)210 2280 A
2532(=)S
(\(left)210 2616 A
2868(>)S
(ZERO_BUF_SIZE\))588 2952 A
3582(?)S
(ZERO_BUF_SIZE)546 3666 A
4254(:)S
(left;)210 4338 A
8418 V
EP
%%Page: 147 147
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2170(File:)S
2403(drivers/memory/memory.c)S
12 B
(147)180 4500 A
1755 V
7 LST
(11775)210 1122 A
2280(if)S
(\(OK)126 2406 A
2574(!=)S
(\(s=sys_vircopy\(SELF,)840 2700 A
3582(D,)S
(\(vir_bytes\))462 3708 A
(dev_zero,)378 4212 A
1845 V
(11776)210 1122 A
(proc_nr,)336 2616 A
2994(D,)S
(user_vir,)378 3120 A
(chunk\)\)\))336 3540 A
1935 V
(11777)210 1122 A
(report\("MEM","sys_vircopy)1050 2448 A
(failed",)336 3540 A
(s\);)126 3918 A
2025 V
(11778)210 1122 A
(left)168 2280 A
2490(-=)S
(chunk;)252 2616 A
2115 V
(11779)210 1122 A
(user_vir)336 2280 A
2658(+=)S
(chunk;)252 2784 A
2205 V
(11780)210 1122 A
2112(})S
2295 V
(11781)210 1122 A
1944(})S
2385 V
(11782)210 1122 A
(break;)252 1944 A
2475 V
(11783)210 1122 A
2565 V
(11784)210 1122 A
1776(/*)S
(Unknown)294 1902 A
(\(illegal\))378 2238 A
(minor)210 2658 A
(device.)294 2910 A
3246(*/)S
2655 V
(11785)210 1122 A
(default:)336 1776 A
2745 V
(11786)210 1122 A
(return\(EINVAL\);)630 1944 A
2835 V
(11787)210 1122 A
1776(})S
2925 V
(11788)210 1122 A
3015 V
(11789)210 1122 A
1776(/*)S
(Book)168 1902 A
(the)126 2112 A
(number)252 2280 A
2574(of)S
(bytes)210 2700 A
(transferred.)504 2952 A
3498(*/)S
3105 V
(11790)210 1122 A
(position)336 1776 A
2154(+=)S
(count;)252 2280 A
3195 V
(11791)210 1122 A
(iov->iov_addr)546 1776 A
2364(+=)S
(count;)252 2490 A
3285 V
(11792)210 1122 A
1776(if)S
(\(\(iov->iov_size)630 1902 A
2574(-=)S
(count\))252 2700 A
2994(==)S
3120(0\))S
3246({)S
(iov++;)252 3330 A
(nr_req--;)378 3624 A
4044(})S
3375 V
(11793)210 1122 A
3465 V
(11794)210 1122 A
1524(})S
3555 V
(11795)210 1122 A
(return\(OK\);)462 1524 A
3645 V
(11796)210 1122 A
1440(})S
3825 V
(11798)210 1122 A
(/*===========================================================================*)3276 1440 A
3915 V
(11799)210 1122 A
1482(*)S
(m_do_open)378 2784 A
4674(*)S
4005 V
(11800)210 1122 A
(*===========================================================================*/)3276 1482 A
4095 V
(11801)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(m_do_open\(dp,)546 1944 A
(m_ptr\))252 2532 A
4185 V
(11802)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dp;)168 2028 A
4275 V
(11803)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
4365 V
(11804)210 1122 A
1440({)S
4455 V
(11805)210 1122 A
1440(/*)S
(Check)210 1566 A
(device)252 1818 A
(number)252 2112 A
2406(on)S
(open.)210 2532 A
(\(This)210 2826 A
(used)168 3078 A
3288(to)S
(give)168 3414 A
(I/O)126 3624 A
(privileges)420 3792 A
4254(to)S
4380(a)S
4545 V
(11806)210 1122 A
1482(*)S
(process)294 1566 A
(opening)294 1902 A
(/dev/mem)336 2238 A
2616(or)S
(/dev/kmem.)420 2742 A
(This)168 3204 A
(may)126 3414 A
3582(be)S
(needed)252 3708 A
4002(in)S
(case)168 4128 A
4338(of)S
4635 V
(11807)210 1122 A
1482(*)S
(memory)252 1566 A
(mapped)252 1860 A
(I/O.)168 2154 A
(With)168 2364 A
(system)252 2574 A
(calls)210 2868 A
3120(to)S
3246(do)S
(I/O)126 3372 A
(this)168 3540 A
3750(is)S
3876(no)S
(longer)252 4002 A
(needed.\))336 4296 A
4725 V
(11808)210 1122 A
1482(*/)S
4815 V
(11809)210 1122 A
1524(if)S
(\(m_prepare\(m_ptr->DEVICE\))1050 1650 A
2742(==)S
(NIL_DEV\))336 2868 A
(return\(ENXIO\);)588 3246 A
4905 V
(11810)210 1122 A
4995 V
(11811)210 1122 A
(return\(OK\);)462 1524 A
5085 V
(11812)210 1122 A
1440(})S
5265 V
(11814)210 1122 A
(/*===========================================================================*)3276 1440 A
5355 V
(11815)210 1122 A
1482(*)S
(m_init)252 2784 A
4674(*)S
5445 V
(11816)210 1122 A
(*===========================================================================*/)3276 1482 A
5535 V
(11817)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(m_init\(\))336 1986 A
5625 V
(11818)210 1122 A
1440({)S
5715 V
(11819)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(this)168 2112 A
(task.)210 2322 A
(All)126 2574 A
(minor)210 2742 A
(devices)294 2994 A
(are)126 3330 A
(initialized)462 3498 A
(one)126 4002 A
4170(by)S
(one.)168 4296 A
4506(*/)S
5805 V
(11820)210 1122 A
(int)126 1524 A
1692(i,)S
1818(s;)S
5895 V
(11821)210 1122 A
5985 V
(11822)210 1122 A
1524(if)S
(\(OK)126 1650 A
1818(!=)S
(\(s=sys_getkinfo\(&kinfo\)\)\))1050 1944 A
3036({)S
6075 V
(11823)210 1122 A
(panic\("MEM","Couldn't)882 1692 A
(get)126 2616 A
(kernel)252 2784 A
(information.",s\);)714 3078 A
6165 V
(11824)210 1122 A
1524(})S
6255 V
(11825)210 1122 A
6345 V
(11826)210 1122 A
1524(/*)S
(Install)294 1650 A
(remote)252 1986 A
(segment)294 2280 A
(for)126 2616 A
(/dev/kmem)378 2784 A
(memory.)294 3204 A
3540(*/)S
6435 V
(11827)210 1122 A
(m_geom[KMEM_DEV].dv_base)1008 1524 A
2574(=)S
(cvul64\(kinfo.kmem_base\);)1008 2658 A
6525 V
(11828)210 1122 A
(m_geom[KMEM_DEV].dv_size)1008 1524 A
2574(=)S
(cvul64\(kinfo.kmem_size\);)1008 2658 A
6615 V
(11829)210 1122 A
1524(if)S
(\(OK)126 1650 A
1818(!=)S
(\(s=sys_segctl\(&m_seg[KMEM_DEV],)1302 1944 A
(\(u16_t)252 3288 A
3582(*\))S
(&s,)126 3708 A
(\(vir_bytes)420 3876 A
4338(*\))S
(&s,)126 4464 A
6705 V
(11830)210 1122 A
(kinfo.kmem_base,)672 2112 A
(kinfo.kmem_size\)\)\))756 2826 A
3624({)S
6795 V
(11831)210 1122 A
(panic\("MEM","Couldn't)882 1692 A
(install)294 2616 A
(remote)252 2952 A
(segment.",s\);)546 3246 A
6885 V
(11832)210 1122 A
1524(})S
6975 V
(11833)210 1122 A
7065 V
(11834)210 1122 A
1524(/*)S
(Install)294 1650 A
(remote)252 1986 A
(segment)294 2280 A
(for)126 2616 A
(/dev/boot)378 2784 A
(memory,)294 3204 A
3540(if)S
(enabled.)336 3666 A
4044(*/)S
8418 V
EP
%%Page: 148 148
BP
/slant 0 def
/height 0 def
1485 V
12 B
(148)180 1080 A
11 R
2170(File:)S
2403(drivers/memory/memory.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(11835)210 1122 A
(m_geom[BOOT_DEV].dv_base)1008 1524 A
2574(=)S
(cvul64\(kinfo.bootdev_base\);)1134 2658 A
1845 V
(11836)210 1122 A
(m_geom[BOOT_DEV].dv_size)1008 1524 A
2574(=)S
(cvul64\(kinfo.bootdev_size\);)1134 2658 A
1935 V
(11837)210 1122 A
1524(if)S
(\(kinfo.bootdev_base)798 1650 A
2490(>)S
2574(0\))S
2700({)S
2025 V
(11838)210 1122 A
1692(if)S
(\(OK)126 1818 A
1986(!=)S
(\(s=sys_segctl\(&m_seg[BOOT_DEV],)1302 2112 A
(\(u16_t)252 3456 A
3750(*\))S
(&s,)126 3876 A
(\(vir_bytes)420 4044 A
4506(*\))S
(&s,)126 4632 A
2115 V
(11839)210 1122 A
(kinfo.bootdev_base,)798 2028 A
(kinfo.bootdev_size\)\)\))882 2868 A
3792({)S
2205 V
(11840)210 1122 A
(panic\("MEM","Couldn't)882 1860 A
(install)294 2784 A
(remote)252 3120 A
(segment.",s\);)546 3414 A
2295 V
(11841)210 1122 A
1692(})S
2385 V
(11842)210 1122 A
1524(})S
2475 V
(11843)210 1122 A
2565 V
(11844)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(/dev/zero.)420 2112 A
(Simply)252 2574 A
(write)210 2868 A
(zeros)210 3120 A
(into)168 3372 A
(the)126 3582 A
(buffer.)294 3750 A
4086(*/)S
2655 V
(11845)210 1122 A
(for)126 1524 A
(\(i=0;)210 1692 A
(i<ZERO_BUF_SIZE;)672 1944 A
(i++\))168 2658 A
2868({)S
2745 V
(11846)210 1122 A
(dev_zero[i])462 1734 A
2238(=)S
('\\0';)210 2322 A
2835 V
(11847)210 1122 A
1524(})S
2925 V
(11848)210 1122 A
3015 V
(11849)210 1122 A
1524(/*)S
(Set)126 1650 A
1818(up)S
(memory)252 1944 A
(ranges)252 2238 A
(for)126 2532 A
(/dev/mem.)378 2700 A
3120(*/)S
3105 V
(11850)210 1122 A
1524(if)S
(\(OK)126 1650 A
1818(!=)S
(\(s=sys_getmachine\(&machine\)\)\))1218 1944 A
3204({)S
3195 V
(11851)210 1122 A
(panic\("MEM","Couldn't)882 1692 A
(get)126 2616 A
(machine)294 2784 A
(information.",s\);)714 3120 A
3285 V
(11852)210 1122 A
1524(})S
3375 V
(11853)210 1122 A
1524(if)S
1650(\(!)S
(machine.protected\))756 1776 A
2574({)S
3465 V
(11854)210 1122 A
(m_geom[MEM_DEV].dv_size)966 1776 A
2784(=)S
(cvul64\(0x100000\);)714 2952 A
3708(/*)S
3834(1M)S
(for)126 3960 A
(8086)168 4128 A
(systems)294 4338 A
4674(*/)S
3555 V
(11855)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3645 V
(11856)210 1122 A
(m_geom[MEM_DEV].dv_size)966 1776 A
2784(=)S
(cvul64\(0xFFFFFFFF\);)798 2868 A
3708(/*)S
(4G-1)168 3834 A
(for)126 4044 A
(386)126 4212 A
(systems)294 4380 A
4716(*/)S
3735 V
(11857)210 1122 A
1524(})S
3825 V
(11858)210 1122 A
1440(})S
4005 V
(11860)210 1122 A
(/*===========================================================================*)3276 1440 A
4095 V
(11861)210 1122 A
1482(*)S
(m_ioctl)294 2784 A
4674(*)S
4185 V
(11862)210 1122 A
(*===========================================================================*/)3276 1482 A
4275 V
(11863)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(m_ioctl\(dp,)462 1944 A
(m_ptr\))252 2448 A
4365 V
(11864)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dp;)168 2028 A
3120(/*)S
(pointer)294 3246 A
3582(to)S
(driver)252 3708 A
(structure)378 4002 A
4422(*/)S
4455 V
(11865)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
3120(/*)S
(pointer)294 3246 A
3582(to)S
(control)294 3708 A
(message)294 4044 A
4380(*/)S
4545 V
(11866)210 1122 A
1440({)S
4635 V
(11867)210 1122 A
1440(/*)S
(I/O)126 1566 A
(controls)336 1734 A
(for)126 2112 A
(the)126 2280 A
(memory)252 2448 A
(driver.)294 2742 A
(Currently)378 3078 A
(there)210 3498 A
3750(is)S
(one)126 3876 A
(I/O)126 4044 A
(control:)336 4212 A
4725 V
(11868)210 1122 A
1482(*)S
1566(-)S
(MIOCRAMSIZE:)504 1650 A
2196(to)S
(set)126 2322 A
(the)126 2490 A
(size)168 2658 A
2868(of)S
(the)126 2994 A
(RAM)126 3162 A
(disk.)210 3330 A
4815 V
(11869)210 1122 A
1482(*/)S
4905 V
(11870)210 1122 A
(struct)252 1524 A
(device)252 1818 A
(*dv;)168 2112 A
4995 V
(11871)210 1122 A
1524(if)S
(\(\(dv)168 1650 A
1860(=)S
(m_prepare\(m_ptr->DEVICE\)\))1050 1944 A
3036(==)S
(NIL_DEV\))336 3162 A
(return\(ENXIO\);)588 3540 A
5085 V
(11872)210 1122 A
5175 V
(11873)210 1122 A
(switch)252 1524 A
(\(m_ptr->REQUEST\))672 1818 A
2532({)S
5265 V
(11874)210 1122 A
(case)168 1608 A
(MIOCRAMSIZE:)504 1818 A
2364({)S
5355 V
(11875)210 1122 A
1776(/*)S
1902(FS)S
(wants)210 2028 A
2280(to)S
(create)252 2406 A
2700(a)S
(new)126 2784 A
(RAM)126 2952 A
(disk)168 3120 A
(with)168 3330 A
(the)126 3540 A
(given)210 3708 A
(size.)210 3960 A
4212(*/)S
5445 V
(11876)210 1122 A
(phys_bytes)420 1776 A
(ramdev_size;)504 2238 A
5535 V
(11877)210 1122 A
(phys_bytes)420 1776 A
(ramdev_base;)504 2238 A
5625 V
(11878)210 1122 A
(int)126 1776 A
1944(s;)S
5715 V
(11879)210 1122 A
5805 V
(11880)210 1122 A
1776(if)S
(\(m_ptr->PROC_NR)630 1902 A
2574(!=)S
(FS_PROC_NR\))462 2700 A
3204({)S
5895 V
(11881)210 1122 A
(report\("MEM",)546 1944 A
("warning,)378 2532 A
(MIOCRAMSIZE)462 2952 A
(called)252 3456 A
(by",)168 3750 A
(m_ptr->PROC_NR\);)672 3960 A
5985 V
(11882)210 1122 A
(return\(EPERM\);)588 1944 A
6075 V
(11883)210 1122 A
1776(})S
6165 V
(11884)210 1122 A
6255 V
(11885)210 1122 A
1776(/*)S
(Try)126 1902 A
2070(to)S
(allocate)336 2196 A
2574(a)S
(piece)210 2658 A
2910(of)S
(memory)252 3036 A
(for)126 3330 A
(the)126 3498 A
(RAM)126 3666 A
(disk.)210 3834 A
4086(*/)S
6345 V
(11886)210 1122 A
(ramdev_size)462 1776 A
2280(=)S
(m_ptr->POSITION;)672 2364 A
6435 V
(11887)210 1122 A
1776(if)S
(\(allocmem\(ramdev_size,)924 1902 A
(&ramdev_base\))546 2868 A
3456(<)S
3540(0\))S
3666({)S
6525 V
(11888)210 1122 A
(report\("MEM",)546 1944 A
("warning,)378 2532 A
(allocmem)336 2952 A
(failed",)336 3330 A
(errno\);)294 3708 A
6615 V
(11889)210 1122 A
(return\(ENOMEM\);)630 1944 A
6705 V
(11890)210 1122 A
1776(})S
6795 V
(11891)210 1122 A
(dv->dv_base)462 1776 A
2280(=)S
(cvul64\(ramdev_base\);)840 2364 A
6885 V
(11892)210 1122 A
(dv->dv_size)462 1776 A
2280(=)S
(cvul64\(ramdev_size\);)840 2364 A
6975 V
(11893)210 1122 A
7065 V
(11894)210 1122 A
1776(if)S
(\(OK)126 1902 A
2070(!=)S
(\(s=sys_segctl\(&m_seg[RAM_DEV],)1260 2196 A
(\(u16_t)252 3498 A
3792(*\))S
(&s,)126 3918 A
(\(vir_bytes)420 4086 A
4548(*\))S
(&s,)126 4674 A
8418 V
EP
%%Page: 149 149
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2170(File:)S
2403(drivers/memory/memory.c)S
12 B
(149)180 4500 A
1755 V
7 LST
(11895)210 1122 A
(ramdev_base,)504 2112 A
(ramdev_size\)\)\))588 2658 A
3288({)S
1845 V
(11896)210 1122 A
(panic\("MEM","Couldn't)882 2112 A
(install)294 3036 A
(remote)252 3372 A
(segment.",s\);)546 3666 A
1935 V
(11897)210 1122 A
1776(})S
2025 V
(11898)210 1122 A
(break;)252 1776 A
2115 V
(11899)210 1122 A
1608(})S
2205 V
(11900)210 1122 A
2295 V
(11901)210 1122 A
(default:)336 1608 A
2385 V
(11902)210 1122 A
(return\(do_diocntl\(&m_dtab,)1092 1776 A
(m_ptr\)\);)336 2910 A
2475 V
(11903)210 1122 A
1524(})S
2565 V
(11904)210 1122 A
(return\(OK\);)462 1524 A
2655 V
(11905)210 1122 A
1440(})S
2835 V
(11907)210 1122 A
(/*===========================================================================*)3276 1440 A
2925 V
(11908)210 1122 A
1482(*)S
(m_geometry)420 2784 A
4674(*)S
3015 V
(11909)210 1122 A
(*===========================================================================*/)3276 1482 A
3105 V
(11910)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(m_geometry\(entry\))714 1986 A
3195 V
(11911)210 1122 A
(struct)252 1440 A
(partition)378 1734 A
(*entry;)294 2154 A
3285 V
(11912)210 1122 A
1440({)S
3375 V
(11913)210 1122 A
1524(/*)S
(Memory)252 1650 A
(devices)294 1944 A
(don't)210 2280 A
(have)168 2532 A
2742(a)S
(geometry,)378 2826 A
(but)126 3246 A
(the)126 3414 A
(outside)294 3582 A
(world)210 3918 A
(insists.)336 4170 A
4548(*/)S
3465 V
(11914)210 1122 A
(entry->cylinders)672 1524 A
2238(=)S
(div64u\(m_geom[m_device].dv_size,)1344 2322 A
(SECTOR_SIZE\))504 3708 A
4254(/)S
(\(64)126 4338 A
4506(*)S
(32\);)168 4590 A
3555 V
(11915)210 1122 A
(entry->heads)504 1524 A
2070(=)S
(64;)126 2154 A
3645 V
(11916)210 1122 A
(entry->sectors)588 1524 A
2154(=)S
(32;)126 2238 A
3735 V
(11917)210 1122 A
1440(})S
4095 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4185 V
(drivers/at_wini/at_wini.h)1050 2676 A
4275 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4455 V
(12000)210 1122 A
(#include)336 1440 A
("../drivers.h")588 1818 A
4545 V
(12001)210 1122 A
(#include)336 1440 A
("../libdriver/driver.h")966 1818 A
4635 V
(12002)210 1122 A
(#include)336 1440 A
("../libdriver/drvlib.h")966 1818 A
4725 V
(12003)210 1122 A
4815 V
(12004)210 1122 A
(_PROTOTYPE\(int)588 1440 A
(main,)210 2070 A
(\(void\)\);)336 2322 A
4905 V
(12005)210 1122 A
4995 V
(12006)210 1122 A
(#define)294 1440 A
(VERBOSE)294 1776 A
2574(0)S
2784(/*)S
(display)294 2910 A
(identify)336 3246 A
(messages)336 3624 A
(during)252 4002 A
(boot)168 4296 A
4506(*/)S
5085 V
(12007)210 1122 A
(#define)294 1440 A
(ENABLE_ATAPI)504 1776 A
2448(0)S
2784(/*)S
(add)126 2910 A
(ATAPI)210 3078 A
(cd-rom)252 3330 A
(support)294 3624 A
3960(to)S
(driver)252 4086 A
4380(*/)S
5445 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5535 V
(drivers/at_wini/at_wini.c)1050 2676 A
5625 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5805 V
(12100)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(device)252 2532 A
(dependent)378 2826 A
(part)168 3246 A
3456(of)S
3582(a)S
(driver)252 3666 A
(for)126 3960 A
(the)126 4128 A
(IBM-AT)252 4296 A
5895 V
(12101)210 1122 A
1482(*)S
(winchester)420 1566 A
(controller.)462 2028 A
(Written)294 2574 A
2910(by)S
(Adri)168 3036 A
(Koppes.)294 3246 A
5985 V
(12102)210 1122 A
1482(*)S
6075 V
(12103)210 1122 A
1482(*)S
(The)126 1566 A
(file)168 1734 A
(contains)336 1944 A
(one)126 2322 A
(entry)210 2490 A
(point:)252 2742 A
6165 V
(12104)210 1122 A
1482(*)S
6255 V
(12105)210 1122 A
1482(*)S
(at_winchester_task:)798 1650 A
(main)168 2784 A
(entry)210 2994 A
(when)168 3246 A
(system)252 3456 A
3750(is)S
(brought)294 3876 A
4212(up)S
6345 V
(12106)210 1122 A
1482(*)S
6435 V
(12107)210 1122 A
1482(*)S
(Changes:)336 1566 A
6525 V
(12108)210 1122 A
1482(*)S
(Aug)126 1650 A
(19,)126 1818 A
(2005)168 1986 A
(ata)126 2280 A
(pci)126 2448 A
(support,)336 2616 A
(supports)336 2994 A
(SATA)168 3372 A
(\(Ben)168 3624 A
(Gras\))210 3834 A
6615 V
(12109)210 1122 A
1482(*)S
(Nov)126 1650 A
(18,)126 1818 A
(2004)168 1986 A
(moved)210 2280 A
2532(AT)S
(disk)168 2658 A
(driver)252 2868 A
3162(to)S
(user-space)420 3288 A
(\(Jorrit)294 3792 A
4128(N.)S
(Herder\))294 4254 A
6705 V
(12110)210 1122 A
1482(*)S
(Aug)126 1650 A
(20,)126 1818 A
(2004)168 1986 A
(watchdogs)378 2280 A
(replaced)336 2700 A
3078(by)S
(sync)168 3204 A
(alarms)252 3414 A
(\(Jorrit)294 3750 A
4086(N.)S
(Herder\))294 4212 A
6795 V
(12111)210 1122 A
1482(*)S
(Mar)126 1650 A
(23,)126 1818 A
(2000)168 1986 A
(added)210 2280 A
(ATAPI)210 2532 A
(CDROM)210 2784 A
(support)294 3036 A
(\(Michael)336 3414 A
(Temari\))294 3792 A
6885 V
(12112)210 1122 A
1482(*)S
(May)126 1650 A
(14,)126 1818 A
(2000)168 1986 A
(d-d/i)210 2280 A
(rewrite)294 2532 A
(\(Kees)210 2910 A
3162(J.)S
(Bot\))168 3288 A
6975 V
(12113)210 1122 A
1482(*)S
(Apr)126 1650 A
(13,)126 1818 A
(1992)168 1986 A
(device)252 2280 A
(dependent/independent)882 2574 A
(split)210 3498 A
(\(Kees)210 3792 A
4044(J.)S
(Bot\))168 4170 A
7065 V
(12114)210 1122 A
1482(*/)S
8418 V
EP
%%Page: 150 150
BP
/slant 0 def
/height 0 def
1485 V
12 B
(150)180 1080 A
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(12115)210 1122 A
1845 V
(12116)210 1122 A
(#include)336 1440 A
("at_wini.h")462 1818 A
1935 V
(12117)210 1122 A
(#include)336 1440 A
("../libpci/pci.h")714 1818 A
2025 V
(12118)210 1122 A
2115 V
(12119)210 1122 A
(#include)336 1440 A
(<minix/sysutil.h>)714 1818 A
2205 V
(12120)210 1122 A
(#include)336 1440 A
(<minix/keymap.h>)672 1818 A
2295 V
(12121)210 1122 A
(#include)336 1440 A
(<sys/ioc_disk.h>)672 1818 A
2385 V
(12122)210 1122 A
2475 V
(12123)210 1122 A
(#define)294 1440 A
(ATAPI_DEBUG)462 1776 A
2616(0)S
2784(/*)S
2910(To)S
(debug)210 3036 A
(ATAPI)210 3288 A
(code.)210 3540 A
3792(*/)S
2565 V
(12124)210 1122 A
2655 V
(12125)210 1122 A
1440(/*)S
(I/O)126 1566 A
(Ports)210 1734 A
(used)168 1986 A
2196(by)S
(winchester)420 2322 A
(disk)168 2784 A
(controllers.)504 2994 A
3540(*/)S
2745 V
(12126)210 1122 A
2835 V
(12127)210 1122 A
1440(/*)S
(Read)168 1566 A
(and)126 1776 A
(write)210 1944 A
(registers)378 2196 A
2616(*/)S
2925 V
(12128)210 1122 A
(#define)294 1440 A
(REG_CMD_BASE0)546 1776 A
(0x1F0)210 2448 A
2784(/*)S
(command)294 2910 A
(base)168 3246 A
(register)336 3456 A
3834(of)S
(controller)420 3960 A
4422(0)S
4506(*/)S
3015 V
(12129)210 1122 A
(#define)294 1440 A
(REG_CMD_BASE1)546 1776 A
(0x170)210 2448 A
2784(/*)S
(command)294 2910 A
(base)168 3246 A
(register)336 3456 A
3834(of)S
(controller)420 3960 A
4422(1)S
4506(*/)S
3105 V
(12130)210 1122 A
(#define)294 1440 A
(REG_CTL_BASE0)546 1776 A
(0x3F6)210 2448 A
2784(/*)S
(control)294 2910 A
(base)168 3246 A
(register)336 3456 A
3834(of)S
(controller)420 3960 A
4422(0)S
4506(*/)S
3195 V
(12131)210 1122 A
(#define)294 1440 A
(REG_CTL_BASE1)546 1776 A
(0x376)210 2448 A
2784(/*)S
(control)294 2910 A
(base)168 3246 A
(register)336 3456 A
3834(of)S
(controller)420 3960 A
4422(1)S
4506(*/)S
3285 V
(12132)210 1122 A
3375 V
(12133)210 1122 A
(#define)294 1440 A
(REG_DATA)336 1776 A
2616(0)S
2784(/*)S
(data)168 2910 A
(register)336 3120 A
(\(offset)294 3498 A
(from)168 3834 A
(the)126 4044 A
(base)168 4212 A
(reg.\))210 4422 A
4674(*/)S
3465 V
(12134)210 1122 A
(#define)294 1440 A
(REG_PRECOMP)462 1776 A
2616(1)S
2784(/*)S
(start)210 2910 A
3162(of)S
(write)210 3288 A
(precompensation)630 3540 A
4212(*/)S
3555 V
(12135)210 1122 A
(#define)294 1440 A
(REG_COUNT)378 1776 A
2616(2)S
2784(/*)S
(sectors)294 2910 A
3246(to)S
(transfer)336 3372 A
3750(*/)S
3645 V
(12136)210 1122 A
(#define)294 1440 A
(REG_SECTOR)420 1776 A
2616(3)S
2784(/*)S
(sector)252 2910 A
(number)252 3204 A
3498(*/)S
3735 V
(12137)210 1122 A
(#define)294 1440 A
(REG_CYL_LO)420 1776 A
2616(4)S
2784(/*)S
(low)126 2910 A
(byte)168 3078 A
3288(of)S
(cylinder)336 3414 A
(number)252 3792 A
4086(*/)S
3825 V
(12138)210 1122 A
(#define)294 1440 A
(REG_CYL_HI)420 1776 A
2616(5)S
2784(/*)S
(high)168 2910 A
(byte)168 3120 A
3330(of)S
(cylinder)336 3456 A
(number)252 3834 A
4128(*/)S
3915 V
(12139)210 1122 A
(#define)294 1440 A
(REG_LDH)294 1776 A
2616(6)S
2784(/*)S
(lba,)168 2910 A
(drive)210 3120 A
(and)126 3372 A
(head)168 3540 A
3750(*/)S
4005 V
(12140)210 1122 A
(#define)294 1440 A
(LDH_DEFAULT)462 1860 A
(0xA0)168 2784 A
3120(/*)S
(ECC)126 3246 A
(enable,)294 3414 A
(512)126 3750 A
(bytes)210 3918 A
(per)126 4170 A
(sector)252 4338 A
4632(*/)S
4095 V
(12141)210 1122 A
(#define)294 1440 A
(LDH_LBA)294 1860 A
(0x40)168 2784 A
3120(/*)S
(Use)126 3246 A
(LBA)126 3414 A
(addressing)420 3582 A
4044(*/)S
4185 V
(12142)210 1122 A
(#define)294 1440 A
(ldh_init\(drive\))630 1860 A
(\(LDH_DEFAULT)504 2784 A
3330(|)S
(\(\(drive\))336 3414 A
3792(<<)S
(4\)\))126 3918 A
4275 V
(12143)210 1122 A
4365 V
(12144)210 1122 A
1440(/*)S
(Read)168 1566 A
(only)168 1776 A
(registers)378 1986 A
2406(*/)S
4455 V
(12145)210 1122 A
(#define)294 1440 A
(REG_STATUS)420 1776 A
2616(7)S
2784(/*)S
(status)252 2910 A
3204(*/)S
4545 V
(12146)210 1122 A
(#define)294 1440 A
(STATUS_BSY)420 1860 A
(0x80)168 2784 A
3120(/*)S
(controller)420 3246 A
(busy)168 3708 A
3918(*/)S
4635 V
(12147)210 1122 A
(#define)294 1440 A
(STATUS_RDY)420 1860 A
(0x40)168 2784 A
3120(/*)S
(drive)210 3246 A
(ready)210 3498 A
3750(*/)S
4725 V
(12148)210 1122 A
(#define)294 1440 A
(STATUS_WF)378 1860 A
(0x20)168 2784 A
3120(/*)S
(write)210 3246 A
(fault)210 3498 A
3750(*/)S
4815 V
(12149)210 1122 A
(#define)294 1440 A
(STATUS_SC)378 1860 A
(0x10)168 2784 A
3120(/*)S
(seek)168 3246 A
(complete)336 3456 A
(\(obsolete\))420 3834 A
4296(*/)S
4905 V
(12150)210 1122 A
(#define)294 1440 A
(STATUS_DRQ)420 1860 A
(0x08)168 2784 A
3120(/*)S
(data)168 3246 A
(transfer)336 3456 A
(request)294 3834 A
4170(*/)S
4995 V
(12151)210 1122 A
(#define)294 1440 A
(STATUS_CRD)420 1860 A
(0x04)168 2784 A
3120(/*)S
(corrected)378 3246 A
(data)168 3666 A
3876(*/)S
5085 V
(12152)210 1122 A
(#define)294 1440 A
(STATUS_IDX)420 1860 A
(0x02)168 2784 A
3120(/*)S
(index)210 3246 A
(pulse)210 3498 A
3750(*/)S
5175 V
(12153)210 1122 A
(#define)294 1440 A
(STATUS_ERR)420 1860 A
(0x01)168 2784 A
3120(/*)S
(error)210 3246 A
3498(*/)S
5265 V
(12154)210 1122 A
(#define)294 1440 A
(STATUS_ADMBSY)546 1860 A
(0x100)210 2742 A
3120(/*)S
(administratively)672 3246 A
(busy)168 3960 A
(\(software\))420 4170 A
4632(*/)S
5355 V
(12155)210 1122 A
(#define)294 1440 A
(REG_ERROR)378 1776 A
2616(1)S
2784(/*)S
(error)210 2910 A
(code)168 3162 A
3372(*/)S
5445 V
(12156)210 1122 A
(#define)294 1440 A
(ERROR_BB)336 1860 A
(0x80)168 2784 A
3120(/*)S
(bad)126 3246 A
(block)210 3414 A
3666(*/)S
5535 V
(12157)210 1122 A
(#define)294 1440 A
(ERROR_ECC)378 1860 A
(0x40)168 2784 A
3120(/*)S
(bad)126 3246 A
(ecc)126 3414 A
(bytes)210 3582 A
3834(*/)S
5625 V
(12158)210 1122 A
(#define)294 1440 A
(ERROR_ID)336 1860 A
(0x10)168 2784 A
3120(/*)S
3246(id)S
(not)126 3372 A
(found)210 3540 A
3792(*/)S
5715 V
(12159)210 1122 A
(#define)294 1440 A
(ERROR_AC)336 1860 A
(0x04)168 2784 A
3120(/*)S
(aborted)294 3246 A
(command)294 3582 A
3918(*/)S
5805 V
(12160)210 1122 A
(#define)294 1440 A
(ERROR_TK)336 1860 A
(0x02)168 2784 A
3120(/*)S
(track)210 3246 A
(zero)168 3498 A
(error)210 3708 A
3960(*/)S
5895 V
(12161)210 1122 A
(#define)294 1440 A
(ERROR_DM)336 1860 A
(0x01)168 2784 A
3120(/*)S
3246(no)S
(data)168 3372 A
(address)294 3582 A
(mark)168 3918 A
4128(*/)S
5985 V
(12162)210 1122 A
6075 V
(12163)210 1122 A
1440(/*)S
(Write)210 1566 A
(only)168 1818 A
(registers)378 2028 A
2448(*/)S
6165 V
(12164)210 1122 A
(#define)294 1440 A
(REG_COMMAND)462 1776 A
2616(7)S
2784(/*)S
(command)294 2910 A
3246(*/)S
6255 V
(12165)210 1122 A
(#define)294 1440 A
(CMD_IDLE)336 1860 A
(0x00)168 2784 A
3120(/*)S
(for)126 3246 A
(w_command:)420 3414 A
(drive)210 3876 A
(idle)168 4128 A
4338(*/)S
6345 V
(12166)210 1122 A
(#define)294 1440 A
(CMD_RECALIBRATE)630 1860 A
(0x10)168 2784 A
3120(/*)S
(recalibrate)462 3246 A
(drive)210 3750 A
4002(*/)S
6435 V
(12167)210 1122 A
(#define)294 1440 A
(CMD_READ)336 1860 A
(0x20)168 2784 A
3120(/*)S
(read)168 3246 A
(data)168 3456 A
3666(*/)S
6525 V
(12168)210 1122 A
(#define)294 1440 A
(CMD_READ_EXT)504 1860 A
(0x24)168 2784 A
3120(/*)S
(read)168 3246 A
(data)168 3456 A
(\(LBA48)252 3666 A
(addressed\))420 3960 A
4422(*/)S
6615 V
(12169)210 1122 A
(#define)294 1440 A
(CMD_WRITE)378 1860 A
(0x30)168 2784 A
3120(/*)S
(write)210 3246 A
(data)168 3498 A
3708(*/)S
6705 V
(12170)210 1122 A
(#define)294 1440 A
(CMD_WRITE_EXT)546 1860 A
(0x34)168 2784 A
3120(/*)S
(write)210 3246 A
(data)168 3498 A
(\(LBA48)252 3708 A
(addressed\))420 4002 A
4464(*/)S
6795 V
(12171)210 1122 A
(#define)294 1440 A
(CMD_READVERIFY)588 1860 A
(0x40)168 2784 A
3120(/*)S
(read)168 3246 A
(verify)252 3456 A
3750(*/)S
6885 V
(12172)210 1122 A
(#define)294 1440 A
(CMD_FORMAT)420 1860 A
(0x50)168 2784 A
3120(/*)S
(format)252 3246 A
(track)210 3540 A
3792(*/)S
6975 V
(12173)210 1122 A
(#define)294 1440 A
(CMD_SEEK)336 1860 A
(0x70)168 2784 A
3120(/*)S
(seek)168 3246 A
(cylinder)336 3456 A
3834(*/)S
7065 V
(12174)210 1122 A
(#define)294 1440 A
(CMD_DIAG)336 1860 A
(0x90)168 2784 A
3120(/*)S
(execute)294 3246 A
(device)252 3582 A
(diagnostics)462 3876 A
4380(*/)S
8418 V
EP
%%Page: 151 151
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
12 B
(151)180 4500 A
1755 V
7 LST
(12175)210 1122 A
(#define)294 1440 A
(CMD_SPECIFY)462 1860 A
(0x91)168 2784 A
3120(/*)S
(specify)294 3246 A
(parameters)420 3582 A
4044(*/)S
1845 V
(12176)210 1122 A
(#define)294 1440 A
(ATA_IDENTIFY)504 1860 A
(0xEC)168 2784 A
3120(/*)S
(identify)336 3246 A
(drive)210 3624 A
3876(*/)S
1935 V
(12177)210 1122 A
1440(/*)S
(#define)294 1566 A
(REG_CTL)294 1902 A
(0x206)210 2784 A
3120(*/)S
3246(/*)S
(control)294 3372 A
(register)336 3708 A
4086(*/)S
2025 V
(12178)210 1122 A
(#define)294 1440 A
(REG_CTL)294 1776 A
2448(0)S
2784(/*)S
(control)294 2910 A
(register)336 3246 A
3624(*/)S
2115 V
(12179)210 1122 A
(#define)294 1440 A
(CTL_NORETRY)462 1860 A
(0x80)168 2784 A
3120(/*)S
(disable)294 3246 A
(access)252 3582 A
(retry)210 3876 A
4128(*/)S
2205 V
(12180)210 1122 A
(#define)294 1440 A
(CTL_NOECC)378 1860 A
(0x40)168 2784 A
3120(/*)S
(disable)294 3246 A
(ecc)126 3582 A
(retry)210 3750 A
4002(*/)S
2295 V
(12181)210 1122 A
(#define)294 1440 A
(CTL_EIGHTHEADS)588 1860 A
(0x08)168 2784 A
3120(/*)S
(more)168 3246 A
(than)168 3456 A
(eight)210 3666 A
(heads)210 3918 A
4170(*/)S
2385 V
(12182)210 1122 A
(#define)294 1440 A
(CTL_RESET)378 1860 A
(0x04)168 2784 A
3120(/*)S
(reset)210 3246 A
(controller)420 3498 A
3960(*/)S
2475 V
(12183)210 1122 A
(#define)294 1440 A
(CTL_INTDISABLE)588 1860 A
(0x02)168 2784 A
3120(/*)S
(disable)294 3246 A
(interrupts)420 3582 A
4044(*/)S
2565 V
(12184)210 1122 A
2655 V
(12185)210 1122 A
(#define)294 1440 A
(REG_STATUS)420 1776 A
2616(7)S
2784(/*)S
(status)252 2910 A
3204(*/)S
2745 V
(12186)210 1122 A
(#define)294 1440 A
(STATUS_BSY)420 1860 A
(0x80)168 2784 A
3120(/*)S
(controller)420 3246 A
(busy)168 3708 A
3918(*/)S
2835 V
(12187)210 1122 A
(#define)294 1440 A
(STATUS_DRDY)462 1860 A
(0x40)168 2784 A
3120(/*)S
(drive)210 3246 A
(ready)210 3498 A
3750(*/)S
2925 V
(12188)210 1122 A
(#define)294 1440 A
(STATUS_DMADF)504 1860 A
(0x20)168 2784 A
3120(/*)S
(dma)126 3246 A
(ready/drive)462 3414 A
(fault)210 3918 A
4170(*/)S
3015 V
(12189)210 1122 A
(#define)294 1440 A
(STATUS_SRVCDSC)588 1860 A
(0x10)168 2784 A
3120(/*)S
(service)294 3246 A
3582(or)S
(dsc)126 3708 A
3876(*/)S
3105 V
(12190)210 1122 A
(#define)294 1440 A
(STATUS_DRQ)420 1860 A
(0x08)168 2784 A
3120(/*)S
(data)168 3246 A
(transfer)336 3456 A
(request)294 3834 A
4170(*/)S
3195 V
(12191)210 1122 A
(#define)294 1440 A
(STATUS_CORR)462 1860 A
(0x04)168 2784 A
3120(/*)S
(correctable)462 3246 A
(error)210 3750 A
(occurred)336 4002 A
4380(*/)S
3285 V
(12192)210 1122 A
(#define)294 1440 A
(STATUS_CHECK)504 1860 A
(0x01)168 2784 A
3120(/*)S
(check)210 3246 A
(error)210 3498 A
3750(*/)S
3375 V
(12193)210 1122 A
3465 V
(12194)210 1122 A
1440(/*)S
(Interrupt)378 1566 A
(request)294 1986 A
(lines.)252 2322 A
2616(*/)S
3555 V
(12195)210 1122 A
(#define)294 1440 A
(NO_IRQ)252 1776 A
2490(0)S
2784(/*)S
2910(no)S
(IRQ)126 3036 A
(set)126 3204 A
(yet)126 3372 A
3540(*/)S
3645 V
(12196)210 1122 A
3735 V
(12197)210 1122 A
(#define)294 1440 A
(ATAPI_PACKETSIZE)672 1776 A
2784(12)S
3825 V
(12198)210 1122 A
(#define)294 1440 A
(SENSE_PACKETSIZE)672 1776 A
2784(18)S
3915 V
(12199)210 1122 A
4005 V
(12200)210 1122 A
1440(/*)S
(Common)252 1566 A
(command)294 1860 A
(block)210 2196 A
2448(*/)S
4095 V
(12201)210 1122 A
(struct)252 1440 A
(command)294 1734 A
2070({)S
4185 V
(12202)210 1122 A
(u8_t)168 1524 A
(precomp;)336 1776 A
2448(/*)S
(REG_PRECOMP,)504 2574 A
(etc.)168 3120 A
3330(*/)S
4275 V
(12203)210 1122 A
(u8_t)168 1524 A
(count;)252 1776 A
4365 V
(12204)210 1122 A
(u8_t)168 1524 A
(sector;)294 1776 A
4455 V
(12205)210 1122 A
(u8_t)168 1524 A
(cyl_lo;)294 1776 A
4545 V
(12206)210 1122 A
(u8_t)168 1524 A
(cyl_hi;)294 1776 A
4635 V
(12207)210 1122 A
(u8_t)168 1524 A
(ldh;)168 1776 A
4725 V
(12208)210 1122 A
(u8_t)168 1524 A
(command;)336 1776 A
4815 V
(12209)210 1122 A
1440(};)S
4905 V
(12210)210 1122 A
4995 V
(12211)210 1122 A
1440(/*)S
(Error)210 1566 A
(codes)210 1818 A
2070(*/)S
5085 V
(12212)210 1122 A
(#define)294 1440 A
(ERR)126 1776 A
(\(-1\))168 2490 A
2784(/*)S
(general)294 2910 A
(error)210 3246 A
3498(*/)S
5175 V
(12213)210 1122 A
(#define)294 1440 A
(ERR_BAD_SECTOR)588 1776 A
(\(-2\))168 2490 A
2784(/*)S
(block)210 2910 A
(marked)252 3162 A
(bad)126 3456 A
(detected)336 3624 A
4002(*/)S
5265 V
(12214)210 1122 A
5355 V
(12215)210 1122 A
1440(/*)S
(Some)168 1566 A
(controllers)462 1776 A
(don't)210 2280 A
(interrupt,)420 2532 A
(the)126 2994 A
(clock)210 3162 A
(will)168 3414 A
(wake)168 3624 A
3834(us)S
(up.)126 3960 A
4128(*/)S
5445 V
(12216)210 1122 A
(#define)294 1440 A
(WAKEUP)252 1776 A
(\(32*HZ\))294 2448 A
2784(/*)S
(drive)210 2910 A
(may)126 3162 A
3330(be)S
(out)126 3456 A
(for)126 3624 A
3792(31)S
(seconds)294 3918 A
(max)126 4254 A
4422(*/)S
5535 V
(12217)210 1122 A
5625 V
(12218)210 1122 A
1440(/*)S
(Miscellaneous.)588 1566 A
2196(*/)S
5715 V
(12219)210 1122 A
(#define)294 1440 A
(MAX_DRIVES)420 1776 A
2574(8)S
5805 V
(12220)210 1122 A
(#define)294 1440 A
(COMPAT_DRIVES)546 1776 A
2574(4)S
5895 V
(12221)210 1122 A
(#define)294 1440 A
(MAX_SECS)336 1776 A
(256)126 2490 A
2784(/*)S
(controller)420 2910 A
(can)126 3372 A
(transfer)336 3540 A
(this)168 3918 A
(many)168 4128 A
(sectors)294 4338 A
4674(*/)S
5985 V
(12222)210 1122 A
(#define)294 1440 A
(MAX_ERRORS)420 1776 A
2574(4)S
2784(/*)S
(how)126 2910 A
(often)210 3078 A
3330(to)S
(try)126 3456 A
(rd/wt)210 3624 A
(before)252 3876 A
(quitting)336 4170 A
4548(*/)S
6075 V
(12223)210 1122 A
(#define)294 1440 A
(NR_MINORS)378 1776 A
(\(MAX_DRIVES)462 2448 A
2952(*)S
(DEV_PER_DRIVE\))588 3036 A
6165 V
(12224)210 1122 A
(#define)294 1440 A
(SUB_PER_DRIVE)546 1776 A
(\(NR_PARTITIONS)588 2448 A
3078(*)S
(NR_PARTITIONS\))588 3162 A
6255 V
(12225)210 1122 A
(#define)294 1440 A
(NR_SUBDEVS)420 1776 A
(\(MAX_DRIVES)462 2448 A
2952(*)S
(SUB_PER_DRIVE\))588 3036 A
6345 V
(12226)210 1122 A
(#define)294 1440 A
(DELAY_USECS)462 1776 A
(1000)168 2448 A
2784(/*)S
(controller)420 2910 A
(timeout)294 3372 A
3708(in)S
(microseconds)504 3834 A
4380(*/)S
6435 V
(12227)210 1122 A
(#define)294 1440 A
(DELAY_TICKS)462 1776 A
2574(1)S
2784(/*)S
(controller)420 2910 A
(timeout)294 3372 A
3708(in)S
(ticks)210 3834 A
4086(*/)S
6525 V
(12228)210 1122 A
(#define)294 1440 A
(DEF_TIMEOUT_TICKS)714 1776 A
(300)126 2784 A
3120(/*)S
(controller)420 3246 A
(timeout)294 3708 A
4044(in)S
(ticks)210 4170 A
4422(*/)S
6615 V
(12229)210 1122 A
(#define)294 1440 A
(RECOVERY_USECS)588 1776 A
(500000)252 2406 A
2784(/*)S
(controller)420 2910 A
(recovery)336 3372 A
(time)168 3750 A
3960(in)S
(microseconds)504 4086 A
4632(*/)S
6705 V
(12230)210 1122 A
(#define)294 1440 A
(RECOVERY_TICKS)588 1776 A
2532(30)S
2784(/*)S
(controller)420 2910 A
(recovery)336 3372 A
(time)168 3750 A
3960(in)S
(ticks)210 4086 A
4338(*/)S
6795 V
(12231)210 1122 A
(#define)294 1440 A
(INITIALIZED)462 1776 A
(0x01)168 2448 A
2784(/*)S
(drive)210 2910 A
3162(is)S
(initialized)462 3288 A
3792(*/)S
6885 V
(12232)210 1122 A
(#define)294 1440 A
(DEAF)168 1776 A
(0x02)168 2448 A
2784(/*)S
(controller)420 2910 A
(must)168 3372 A
3582(be)S
(reset)210 3708 A
3960(*/)S
6975 V
(12233)210 1122 A
(#define)294 1440 A
(SMART)210 1776 A
(0x04)168 2448 A
2784(/*)S
(drive)210 2910 A
(supports)336 3162 A
(ATA)126 3540 A
(commands)336 3708 A
4086(*/)S
7065 V
(12234)210 1122 A
(#define)294 1440 A
(ATAPI)210 1776 A
2574(0)S
2784(/*)S
(don't)210 2910 A
(bother)252 3162 A
(with)168 3456 A
(ATAPI;)252 3666 A
(optimise)336 3960 A
(out)126 4338 A
4506(*/)S
8418 V
EP
%%Page: 152 152
BP
/slant 0 def
/height 0 def
1485 V
12 B
(152)180 1080 A
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(12235)210 1122 A
(#define)294 1440 A
(IDENTIFIED)420 1776 A
(0x10)168 2448 A
2784(/*)S
(w_identify)420 2910 A
(done)168 3372 A
(successfully)504 3582 A
4128(*/)S
1845 V
(12236)210 1122 A
(#define)294 1440 A
(IGNORING)336 1776 A
(0x20)168 2448 A
2784(/*)S
(w_identify)420 2910 A
(failed)252 3372 A
(once)168 3666 A
3876(*/)S
1935 V
(12237)210 1122 A
2025 V
(12238)210 1122 A
1440(/*)S
(Timeouts)336 1566 A
(and)126 1944 A
(max)126 2112 A
(retries.)336 2280 A
2658(*/)S
2115 V
(12239)210 1122 A
(int)126 1440 A
(timeout_ticks)546 1608 A
2196(=)S
(DEF_TIMEOUT_TICKS,)756 2280 A
(max_errors)420 3078 A
3540(=)S
(MAX_ERRORS;)462 3624 A
2205 V
(12240)210 1122 A
(int)126 1440 A
(wakeup_ticks)504 1608 A
2154(=)S
(WAKEUP;)294 2238 A
2295 V
(12241)210 1122 A
(long)168 1440 A
(w_standard_timeouts)798 1650 A
2490(=)S
2574(0,)S
(w_pci_debug)462 2700 A
3204(=)S
3288(0,)S
(w_instance)420 3414 A
3876(=)S
3960(0,)S
2385 V
(12242)210 1122 A
(w_lba48)294 1482 A
1818(=)S
1902(0,)S
(atapi_debug)462 2028 A
2532(=)S
2616(0;)S
2475 V
(12243)210 1122 A
2565 V
(12244)210 1122 A
(int)126 1440 A
(w_testing)378 1608 A
2028(=)S
2112(0,)S
(w_silent)336 2238 A
2616(=)S
2700(0;)S
2655 V
(12245)210 1122 A
2745 V
(12246)210 1122 A
(int)126 1440 A
(w_next_drive)504 1608 A
2154(=)S
2238(0;)S
2835 V
(12247)210 1122 A
2925 V
(12248)210 1122 A
1440(/*)S
(Variables.)420 1566 A
2028(*/)S
3015 V
(12249)210 1122 A
3105 V
(12250)210 1122 A
1440(/*)S
(wini)168 1566 A
1776(is)S
(indexed)294 1902 A
2238(by)S
(controller)420 2364 A
(first,)252 2826 A
(then)168 3120 A
(drive)210 3330 A
(\(0-3\).)252 3582 A
3195 V
(12251)210 1122 A
1482(*)S
(controller)420 1566 A
2028(0)S
2112(is)S
(always)252 2238 A
(the)126 2532 A
('compatability')630 2700 A
(ide)126 3372 A
(controller,)462 3540 A
4044(at)S
3285 V
(12252)210 1122 A
1482(*)S
(the)126 1566 A
(fixed)210 1734 A
(locations,)420 1986 A
(whether)294 2448 A
(present)294 2784 A
3120(or)S
(not.)168 3246 A
3375 V
(12253)210 1122 A
1482(*/)S
3465 V
(12254)210 1122 A
(PRIVATE)294 1440 A
(struct)252 1776 A
(wini)168 2070 A
2280({)S
2784(/*)S
(main)168 2910 A
(drive)210 3120 A
(struct,)294 3372 A
(one)126 3708 A
(entry)210 3876 A
(per)126 4128 A
(drive)210 4296 A
4548(*/)S
3555 V
(12255)210 1122 A
(unsigned)336 1524 A
(state;)252 1902 A
2784(/*)S
(drive)210 2910 A
(state:)252 3162 A
(deaf,)210 3456 A
(initialized,)504 3708 A
(dead)168 4254 A
4464(*/)S
3645 V
(12256)210 1122 A
(unsigned)336 1524 A
(w_status;)378 1902 A
2784(/*)S
(device)252 2910 A
(status)252 3204 A
(register)336 3498 A
3876(*/)S
3735 V
(12257)210 1122 A
(unsigned)336 1524 A
(base_cmd;)378 1902 A
2784(/*)S
(command)294 2910 A
(base)168 3246 A
(register)336 3456 A
3834(*/)S
3825 V
(12258)210 1122 A
(unsigned)336 1524 A
(base_ctl;)378 1902 A
2784(/*)S
(control)294 2910 A
(base)168 3246 A
(register)336 3456 A
3834(*/)S
3915 V
(12259)210 1122 A
(unsigned)336 1524 A
(irq;)168 1902 A
2784(/*)S
(interrupt)378 2910 A
(request)294 3330 A
(line)168 3666 A
3876(*/)S
4005 V
(12260)210 1122 A
(unsigned)336 1524 A
(irq_mask;)378 1902 A
2784(/*)S
2910(1)S
2994(<<)S
(irq)126 3120 A
3288(*/)S
4095 V
(12261)210 1122 A
(unsigned)336 1524 A
(irq_need_ack;)546 1902 A
2784(/*)S
(irq)126 2910 A
(needs)210 3078 A
3330(to)S
3456(be)S
(acknowledged)504 3582 A
4128(*/)S
4185 V
(12262)210 1122 A
(int)126 1524 A
(irq_hook_id;)504 1692 A
2784(/*)S
2910(id)S
3036(of)S
(irq)126 3162 A
(hook)168 3330 A
3540(at)S
(the)126 3666 A
(kernel)252 3834 A
4128(*/)S
4275 V
(12263)210 1122 A
(int)126 1524 A
(lba48;)252 1692 A
2784(/*)S
(supports)336 2910 A
(lba48)210 3288 A
3540(*/)S
4365 V
(12264)210 1122 A
(unsigned)336 1524 A
(lcylinders;)462 1902 A
2784(/*)S
(logical)294 2910 A
(number)252 3246 A
3540(of)S
(cylinders)378 3666 A
(\(BIOS\))252 4086 A
4380(*/)S
4455 V
(12265)210 1122 A
(unsigned)336 1524 A
(lheads;)294 1902 A
2784(/*)S
(logical)294 2910 A
(number)252 3246 A
3540(of)S
(heads)210 3666 A
3918(*/)S
4545 V
(12266)210 1122 A
(unsigned)336 1524 A
(lsectors;)378 1902 A
2784(/*)S
(logical)294 2910 A
(number)252 3246 A
3540(of)S
(sectors)294 3666 A
(per)126 4002 A
(track)210 4170 A
4422(*/)S
4635 V
(12267)210 1122 A
(unsigned)336 1524 A
(pcylinders;)462 1902 A
2784(/*)S
(physical)336 2910 A
(number)252 3288 A
3582(of)S
(cylinders)378 3708 A
(\(translated\))504 4128 A
4674(*/)S
4725 V
(12268)210 1122 A
(unsigned)336 1524 A
(pheads;)294 1902 A
2784(/*)S
(physical)336 2910 A
(number)252 3288 A
3582(of)S
(heads)210 3708 A
3960(*/)S
4815 V
(12269)210 1122 A
(unsigned)336 1524 A
(psectors;)378 1902 A
2784(/*)S
(physical)336 2910 A
(number)252 3288 A
3582(of)S
(sectors)294 3708 A
(per)126 4044 A
(track)210 4212 A
4464(*/)S
4905 V
(12270)210 1122 A
(unsigned)336 1524 A
(ldhpref;)336 1902 A
2784(/*)S
(top)126 2910 A
(four)168 3078 A
(bytes)210 3288 A
3540(of)S
(the)126 3666 A
(LDH)126 3834 A
(\(head\))252 4002 A
(register)336 4296 A
4674(*/)S
4995 V
(12271)210 1122 A
(unsigned)336 1524 A
(precomp;)336 1902 A
2784(/*)S
(write)210 2910 A
(precompensation)630 3162 A
(cylinder)336 3834 A
4212(/)S
4296(4)S
4380(*/)S
5085 V
(12272)210 1122 A
(unsigned)336 1524 A
(max_count;)420 1902 A
2784(/*)S
(max)126 2910 A
(request)294 3078 A
(for)126 3414 A
(this)168 3582 A
(drive)210 3792 A
4044(*/)S
5175 V
(12273)210 1122 A
(unsigned)336 1524 A
(open_ct;)336 1902 A
2784(/*)S
(in-use)252 2910 A
(count)210 3204 A
3456(*/)S
5265 V
(12274)210 1122 A
(struct)252 1524 A
(device)252 1818 A
(part[DEV_PER_DRIVE];)840 2112 A
3120(/*)S
(disks)210 3246 A
(and)126 3498 A
(partitions)420 3666 A
4128(*/)S
5355 V
(12275)210 1122 A
(struct)252 1524 A
(device)252 1818 A
(subpart[SUB_PER_DRIVE];)966 2112 A
3120(/*)S
(subpartitions)546 3246 A
3834(*/)S
5445 V
(12276)210 1122 A
1440(})S
(wini[MAX_DRIVES],)714 1524 A
(*w_wn;)252 2280 A
5535 V
(12277)210 1122 A
5625 V
(12278)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_device)336 1944 A
2322(=)S
(-1;)126 2406 A
5715 V
(12279)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_controller)504 1944 A
2490(=)S
(-1;)126 2574 A
5805 V
(12280)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_major)294 1944 A
2280(=)S
(-1;)126 2364 A
5895 V
(12281)210 1122 A
(PRIVATE)294 1440 A
(char)168 1776 A
(w_id_string[40];)672 1986 A
5985 V
(12282)210 1122 A
6075 V
(12283)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(win_tasknr;)462 1944 A
3120(/*)S
3246(my)S
(task)168 3372 A
(number)252 3582 A
3876(*/)S
6165 V
(12284)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_command;)420 1944 A
3120(/*)S
(current)294 3246 A
(command)294 3582 A
3918(in)S
(execution)378 4044 A
4464(*/)S
6255 V
(12285)210 1122 A
(PRIVATE)294 1440 A
(u8_t)168 1776 A
(w_byteval;)420 1986 A
3120(/*)S
(used)168 3246 A
(for)126 3456 A
(SYS_IRQCTL)420 3624 A
4086(*/)S
6345 V
(12286)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_drive;)336 1944 A
3120(/*)S
(selected)336 3246 A
(drive)210 3624 A
3876(*/)S
6435 V
(12287)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_controller;)546 1944 A
3120(/*)S
(selected)336 3246 A
(controller)420 3624 A
4086(*/)S
6525 V
(12288)210 1122 A
(PRIVATE)294 1440 A
(struct)252 1776 A
(device)252 2070 A
(*w_dv;)252 2364 A
3120(/*)S
(device's)336 3246 A
(base)168 3624 A
(and)126 3834 A
(size)168 4002 A
4212(*/)S
6615 V
(12289)210 1122 A
6705 V
(12290)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(init_params,)504 2490 A
(\(void\))252 3036 A
4464(\);)S
6795 V
(12291)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(init_drive,)462 2490 A
(\(struct)294 2994 A
(wini)168 3330 A
3540(*,)S
(int,)168 3666 A
(int,)168 3876 A
(int,)168 4086 A
(int,)168 4296 A
(int,)168 4506 A
(int\)\);)252 4716 A
6885 V
(12292)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(init_params_pci,)672 2490 A
(\(int\))210 3204 A
4464(\);)S
6975 V
(12293)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(w_do_open,)420 2448 A
(\(struct)294 2910 A
(driver)252 3246 A
(*dp,)168 3540 A
(message)294 3750 A
(*m_ptr\))294 4086 A
4464(\);)S
7065 V
(12294)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(struct)252 2280 A
(device)252 2574 A
(*w_prepare,)462 2868 A
(\(int)168 3372 A
(dev\))168 3582 A
4464(\);)S
8418 V
EP
%%Page: 153 153
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
12 B
(153)180 4500 A
1755 V
7 LST
(12295)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(w_identify,)462 2448 A
(\(void\))252 2952 A
4464(\);)S
1845 V
(12296)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(char)168 2280 A
(*w_name,)336 2490 A
(\(void\))252 2868 A
4464(\);)S
1935 V
(12297)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(w_specify,)420 2448 A
(\(void\))252 2910 A
4464(\);)S
2025 V
(12298)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(w_io_test,)420 2448 A
(\(void\))252 2910 A
4464(\);)S
2115 V
(12299)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(w_transfer,)462 2448 A
(\(int)168 2952 A
(proc_nr,)336 3162 A
(int)126 3540 A
(opcode,)294 3708 A
(off_t)210 4044 A
(position,)378 4296 A
2205 V
(12300)210 1122 A
(iovec_t)294 3120 A
(*iov,)210 3456 A
(unsigned)336 3708 A
(nr_req\))294 4086 A
4464(\);)S
2295 V
(12301)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(com_out,)336 2448 A
(\(struct)294 2826 A
(command)294 3162 A
(*cmd\))210 3498 A
4464(\);)S
2385 V
(12302)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(w_need_reset,)546 2490 A
(\(void\))252 3078 A
4464(\);)S
2475 V
(12303)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(ack_irqs,)378 2490 A
(\(unsigned)378 2910 A
(int\))168 3330 A
4464(\);)S
2565 V
(12304)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(w_do_close,)462 2448 A
(\(struct)294 2952 A
(driver)252 3288 A
(*dp,)168 3582 A
(message)294 3792 A
(*m_ptr\))294 4128 A
4464(\);)S
2655 V
(12305)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(w_other,)336 2448 A
(\(struct)294 2826 A
(driver)252 3162 A
(*dp,)168 3456 A
(message)294 3666 A
(*m_ptr\))294 4002 A
4464(\);)S
2745 V
(12306)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(w_hw_int,)378 2448 A
(\(struct)294 2868 A
(driver)252 3204 A
(*dp,)168 3498 A
(message)294 3708 A
(*m_ptr\))294 4044 A
4464(\);)S
2835 V
(12307)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(com_simple,)462 2448 A
(\(struct)294 2952 A
(command)294 3288 A
(*cmd\))210 3624 A
4464(\);)S
2925 V
(12308)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(w_timeout,)420 2490 A
(\(void\))252 2952 A
4464(\);)S
3015 V
(12309)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(w_reset,)336 2448 A
(\(void\))252 2826 A
4464(\);)S
3105 V
(12310)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(w_intr_wait,)504 2490 A
(\(void\))252 3036 A
4464(\);)S
3195 V
(12311)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(at_intr_wait,)546 2448 A
(\(void\))252 3036 A
4464(\);)S
3285 V
(12312)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(w_waitfor,)420 2448 A
(\(int)168 2910 A
(mask,)210 3120 A
(int)126 3372 A
(value\))252 3540 A
4464(\);)S
3375 V
(12313)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(w_geometry,)462 2490 A
(\(struct)294 2994 A
(partition)378 3330 A
(*entry\))294 3750 A
4464(\);)S
3465 V
(12314)210 1122 A
3555 V
(12315)210 1122 A
1440(/*)S
(Entry)210 1566 A
(points)252 1818 A
2112(to)S
(this)168 2238 A
(driver.)294 2448 A
2784(*/)S
3645 V
(12316)210 1122 A
(PRIVATE)294 1440 A
(struct)252 1776 A
(driver)252 2070 A
(w_dtab)252 2364 A
2658(=)S
2742({)S
3735 V
(12317)210 1122 A
(w_name,)294 1524 A
2448(/*)S
(current)294 2574 A
(device's)336 2910 A
(name)168 3288 A
3498(*/)S
3825 V
(12318)210 1122 A
(w_do_open,)420 1524 A
2448(/*)S
(open)168 2574 A
2784(or)S
(mount)210 2910 A
(request,)336 3162 A
(initialize)420 3540 A
(device)252 4002 A
4296(*/)S
3915 V
(12319)210 1122 A
(w_do_close,)462 1524 A
2448(/*)S
(release)294 2574 A
(device)252 2910 A
3204(*/)S
4005 V
(12320)210 1122 A
(do_diocntl,)462 1524 A
2448(/*)S
(get)126 2574 A
2742(or)S
(set)126 2868 A
3036(a)S
(partition's)462 3120 A
(geometry)336 3624 A
4002(*/)S
4095 V
(12321)210 1122 A
(w_prepare,)420 1524 A
2448(/*)S
(prepare)294 2574 A
(for)126 2910 A
(I/O)126 3078 A
3246(on)S
3372(a)S
(given)210 3456 A
(minor)210 3708 A
(device)252 3960 A
4254(*/)S
4185 V
(12322)210 1122 A
(w_transfer,)462 1524 A
2448(/*)S
2574(do)S
(the)126 2700 A
(I/O)126 2868 A
3036(*/)S
4275 V
(12323)210 1122 A
(nop_cleanup,)504 1524 A
2448(/*)S
(nothing)294 2574 A
2910(to)S
(clean)210 3036 A
3288(up)S
3414(*/)S
4365 V
(12324)210 1122 A
(w_geometry,)462 1524 A
2448(/*)S
(tell)168 2574 A
(the)126 2784 A
(geometry)336 2952 A
3330(of)S
(the)126 3456 A
(disk)168 3624 A
3834(*/)S
4455 V
(12325)210 1122 A
(nop_signal,)462 1524 A
2448(/*)S
2574(no)S
(cleanup)294 2700 A
(needed)252 3036 A
3330(on)S
(shutdown)336 3456 A
3834(*/)S
4545 V
(12326)210 1122 A
(nop_alarm,)420 1524 A
2448(/*)S
(ignore)252 2574 A
(leftover)336 2868 A
(alarms)252 3246 A
3540(*/)S
4635 V
(12327)210 1122 A
(nop_cancel,)462 1524 A
2448(/*)S
(ignore)252 2574 A
(CANCELs)294 2868 A
3204(*/)S
4725 V
(12328)210 1122 A
(nop_select,)462 1524 A
2448(/*)S
(ignore)252 2574 A
(selects)294 2868 A
3204(*/)S
4815 V
(12329)210 1122 A
(w_other,)336 1524 A
2448(/*)S
(catch-all)378 2574 A
(for)126 2994 A
(unrecognized)504 3162 A
(commands)336 3708 A
(and)126 4086 A
(ioctls)252 4254 A
4548(*/)S
4905 V
(12330)210 1122 A
(w_hw_int)336 1524 A
2448(/*)S
(leftover)336 2574 A
(hardware)336 2952 A
(interrupts)420 3330 A
3792(*/)S
4995 V
(12331)210 1122 A
1440(};)S
5085 V
(12332)210 1122 A
5175 V
(12333)210 1122 A
(/*===========================================================================*)3276 1440 A
5265 V
(12334)210 1122 A
1482(*)S
(at_winchester_task)756 2784 A
4674(*)S
5355 V
(12335)210 1122 A
(*===========================================================================*/)3276 1482 A
5445 V
(12336)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(main\(\))252 1902 A
5535 V
(12337)210 1122 A
1440({)S
5625 V
(12338)210 1122 A
1440(/*)S
(Set)126 1566 A
(special)294 1734 A
(disk)168 2070 A
(parameters)420 2280 A
(then)168 2742 A
(call)168 2952 A
(the)126 3162 A
(generic)294 3330 A
(main)168 3666 A
(loop.)210 3876 A
4128(*/)S
5715 V
(12339)210 1122 A
(init_params\(\);)588 1524 A
5805 V
(12340)210 1122 A
(driver_task\(&w_dtab\);)882 1524 A
5895 V
(12341)210 1122 A
(return\(OK\);)462 1524 A
5985 V
(12342)210 1122 A
1440(})S
6165 V
(12344)210 1122 A
(/*===========================================================================*)3276 1440 A
6255 V
(12345)210 1122 A
1482(*)S
(init_params)462 2784 A
4674(*)S
6345 V
(12346)210 1122 A
(*===========================================================================*/)3276 1482 A
6435 V
(12347)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(init_params\(\))546 1986 A
6525 V
(12348)210 1122 A
1440({)S
6615 V
(12349)210 1122 A
1440(/*)S
(This)168 1566 A
(routine)294 1776 A
2112(is)S
(called)252 2238 A
2532(at)S
(startup)294 2658 A
2994(to)S
(initialize)420 3120 A
(the)126 3582 A
(drive)210 3750 A
(parameters.)462 4002 A
4506(*/)S
6705 V
(12350)210 1122 A
6795 V
(12351)210 1122 A
(u16_t)210 1524 A
(parv[2];)336 1776 A
6885 V
(12352)210 1122 A
(unsigned)336 1524 A
(int)126 1902 A
(vector,)294 2070 A
(size;)210 2406 A
6975 V
(12353)210 1122 A
(int)126 1524 A
(drive,)252 1692 A
(nr_drives;)420 1986 A
7065 V
(12354)210 1122 A
(struct)252 1524 A
(wini)168 1818 A
(*wn;)168 2028 A
8418 V
EP
%%Page: 154 154
BP
/slant 0 def
/height 0 def
1485 V
12 B
(154)180 1080 A
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(12355)210 1122 A
(u8_t)168 1524 A
(params[16];)462 1734 A
1845 V
(12356)210 1122 A
(int)126 1524 A
1692(s;)S
1935 V
(12357)210 1122 A
2025 V
(12358)210 1122 A
1524(/*)S
(Boot)168 1650 A
(variables.)420 1860 A
2322(*/)S
2115 V
(12359)210 1122 A
(env_parse\("ata_std_timeout",)1176 1524 A
("d",)168 2742 A
2952(0,)S
(&w_standard_timeouts,)882 3078 A
4002(0,)S
(1\);)126 4128 A
2205 V
(12360)210 1122 A
(env_parse\("ata_pci_debug",)1092 1524 A
("d",)168 2658 A
2868(0,)S
(&w_pci_debug,)546 2994 A
3582(0,)S
(1\);)126 3708 A
2295 V
(12361)210 1122 A
(env_parse\("ata_instance",)1050 1524 A
("d",)168 2616 A
2826(0,)S
(&w_instance,)504 2952 A
3498(0,)S
(8\);)126 3624 A
2385 V
(12362)210 1122 A
(env_parse\("ata_lba48",)924 1524 A
("d",)168 2490 A
2700(0,)S
(&w_lba48,)378 2826 A
3246(0,)S
(1\);)126 3372 A
2475 V
(12363)210 1122 A
(env_parse\("atapi_debug",)1008 1524 A
("d",)168 2574 A
2784(0,)S
(&atapi_debug,)546 2910 A
3498(0,)S
(1\);)126 3624 A
2565 V
(12364)210 1122 A
2655 V
(12365)210 1122 A
1524(if)S
(\(w_instance)462 1650 A
2154(==)S
2280(0\))S
2406({)S
2745 V
(12366)210 1122 A
1860(/*)S
(Get)126 1986 A
(the)126 2154 A
(number)252 2322 A
2616(of)S
(drives)252 2742 A
(from)168 3036 A
(the)126 3246 A
(BIOS)168 3414 A
(data)168 3624 A
(area)168 3834 A
4044(*/)S
2835 V
(12367)210 1122 A
1860(if)S
(\(\(s=sys_vircopy\(SELF,)882 1986 A
(BIOS_SEG,)378 2910 A
(NR_HD_DRIVES_ADDR,)756 3330 A
2925 V
(12368)210 1122 A
(SELF,)210 2448 A
2700(D,)S
(\(vir_bytes\))462 2826 A
(params,)294 3330 A
(NR_HD_DRIVES_SIZE\)\))798 3666 A
4506(!=)S
(OK\))126 4632 A
3015 V
(12369)210 1122 A
(panic\(w_name\(\),)630 2112 A
("Couldn't)378 2784 A
(read)168 3204 A
(BIOS",)252 3414 A
(s\);)126 3708 A
3105 V
(12370)210 1122 A
1860(if)S
(\(\(nr_drives)462 1986 A
2490(=)S
(params[0]\))420 2574 A
3036(>)S
3120(2\))S
(nr_drives)378 3246 A
3666(=)S
3750(2;)S
3195 V
(12371)210 1122 A
3285 V
(12372)210 1122 A
(for)126 1860 A
(\(drive)252 2028 A
2322(=)S
2406(0,)S
2532(wn)S
2658(=)S
(wini;)210 2742 A
(drive)210 2994 A
3246(<)S
(COMPAT_DRIVES;)588 3330 A
(drive++,)336 3960 A
(wn++\))210 4338 A
4590({)S
3375 V
(12373)210 1122 A
2112(if)S
(\(drive)252 2238 A
2532(<)S
(nr_drives\))420 2616 A
3078({)S
3465 V
(12374)210 1122 A
2280(/*)S
(Copy)168 2406 A
(the)126 2616 A
(BIOS)168 2784 A
(parameter)378 2994 A
(vector)252 3414 A
3708(*/)S
3555 V
(12375)210 1122 A
(vector)252 2280 A
2574(=)S
(\(drive)252 2658 A
2952(==)S
3078(0\))S
3204(?)S
(BIOS_HD0_PARAMS_ADDR:BIOS_HD1_PARAMS_ADDR;)1764 3288 A
3645 V
(12376)210 1122 A
(size)168 2280 A
2490(=)S
(\(drive)252 2574 A
2868(==)S
2994(0\))S
3120(?)S
(BIOS_HD0_PARAMS_SIZE:BIOS_HD1_PARAMS_SIZE;)1764 3204 A
3735 V
(12377)210 1122 A
2280(if)S
(\(\(s=sys_vircopy\(SELF,)882 2406 A
(BIOS_SEG,)378 3330 A
(vector,)294 3750 A
3825 V
(12378)210 1122 A
(SELF,)210 3120 A
3372(D,)S
(\(vir_bytes\))462 3498 A
(parv,)210 4002 A
(size\)\))252 4254 A
4548(!=)S
(OK\))126 4674 A
3915 V
(12379)210 1122 A
(panic\(w_name\(\),)630 2784 A
("Couldn't)378 3456 A
(read)168 3876 A
(BIOS",)252 4086 A
(s\);)126 4380 A
4005 V
(12380)210 1122 A
4095 V
(12381)210 1122 A
2448(/*)S
(Calculate)378 2574 A
(the)126 2994 A
(address)294 3162 A
3498(of)S
(the)126 3624 A
(parameters)420 3792 A
(and)126 4254 A
(copy)168 4422 A
(them)168 4632 A
4842(*/)S
4185 V
(12382)210 1122 A
2448(if)S
(\(\(s=sys_vircopy\()672 2574 A
4275 V
(12383)210 1122 A
(SELF,)210 2784 A
(BIOS_SEG,)378 3036 A
(hclick_to_physb\(parv[1]\))1008 3456 A
4506(+)S
(parv[0],)336 4590 A
4365 V
(12384)210 1122 A
(SELF,)210 2784 A
3036(D,)S
(\(phys_bytes\))504 3162 A
(params,)294 3708 A
(16L\)\)!=OK\))420 4044 A
4455 V
(12385)210 1122 A
(panic\(w_name\(\),"Couldn't)1008 2616 A
(copy)168 3666 A
(parameters",)504 3876 A
(s\);)126 4422 A
4545 V
(12386)210 1122 A
4635 V
(12387)210 1122 A
2448(/*)S
(Copy)168 2574 A
(the)126 2784 A
(parameters)420 2952 A
3414(to)S
(the)126 3540 A
(structures)420 3708 A
4170(of)S
(the)126 4296 A
(drive)210 4464 A
4716(*/)S
4725 V
(12388)210 1122 A
(wn->lcylinders)588 2448 A
3078(=)S
(bp_cylinders\(params\);)882 3162 A
4815 V
(12389)210 1122 A
(wn->lheads)420 2448 A
2910(=)S
(bp_heads\(params\);)714 2994 A
4905 V
(12390)210 1122 A
(wn->lsectors)504 2448 A
2994(=)S
(bp_sectors\(params\);)798 3078 A
4995 V
(12391)210 1122 A
(wn->precomp)462 2448 A
2952(=)S
(bp_precomp\(params\))756 3036 A
3834(>>)S
3960(2;)S
5085 V
(12392)210 1122 A
2112(})S
5175 V
(12393)210 1122 A
5265 V
(12394)210 1122 A
2112(/*)S
(Fill)168 2238 A
2448(in)S
(non-BIOS)336 2574 A
(parameters.)462 2952 A
3456(*/)S
5355 V
(12395)210 1122 A
(init_drive\(wn,)588 2112 A
5445 V
(12396)210 1122 A
(drive)210 2448 A
2700(<)S
2784(2)S
2868(?)S
(REG_CMD_BASE0)546 2952 A
3540(:)S
(REG_CMD_BASE1,)588 3624 A
5535 V
(12397)210 1122 A
(drive)210 2448 A
2700(<)S
2784(2)S
2868(?)S
(REG_CTL_BASE0)546 2952 A
3540(:)S
(REG_CTL_BASE1,)588 3624 A
5625 V
(12398)210 1122 A
(NO_IRQ,)294 2448 A
2784(0,)S
2910(0,)S
(drive\);)294 3036 A
5715 V
(12399)210 1122 A
(w_next_drive++;)630 2112 A
5805 V
(12400)210 1122 A
1776(})S
5895 V
(12401)210 1122 A
1524(})S
5985 V
(12402)210 1122 A
6075 V
(12403)210 1122 A
1524(/*)S
(Look)168 1650 A
(for)126 1860 A
(controllers)462 2028 A
2532(on)S
(the)126 2658 A
(pci)126 2826 A
(bus.)168 2994 A
(Skip)168 3204 A
(none)168 3414 A
(the)126 3624 A
(first)210 3792 A
(instance,)378 4044 A
6165 V
(12404)210 1122 A
1566(*)S
(skip)168 1650 A
(one)126 1860 A
(and)126 2028 A
(then)168 2196 A
2406(2)S
(for)126 2490 A
(every)210 2658 A
(instance,)378 2910 A
(for)126 3330 A
(every)210 3498 A
(next)168 3750 A
(instance.)378 3960 A
6255 V
(12405)210 1122 A
1566(*/)S
6345 V
(12406)210 1122 A
1524(if)S
(\(w_instance)462 1650 A
2154(==)S
2280(0\))S
6435 V
(12407)210 1122 A
(init_params_pci\(0\);)798 1776 A
6525 V
(12408)210 1122 A
(else)168 1524 A
6615 V
(12409)210 1122 A
(init_params_pci\(w_instance*2-1\);)1344 1776 A
6705 V
(12410)210 1122 A
6795 V
(12411)210 1122 A
1440(})S
6975 V
(12413)210 1122 A
(#define)294 1440 A
(ATA_IF_NOTCOMPAT1)714 1776 A
(\(1L)126 2532 A
2700(<<)S
2826(0\))S
7065 V
(12414)210 1122 A
(#define)294 1440 A
(ATA_IF_NOTCOMPAT2)714 1776 A
(\(1L)126 2532 A
2700(<<)S
2826(2\))S
8418 V
EP
%%Page: 155 155
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
12 B
(155)180 4500 A
1755 V
7 LST
(12415)210 1122 A
1845 V
(12416)210 1122 A
(/*===========================================================================*)3276 1440 A
1935 V
(12417)210 1122 A
1482(*)S
(init_drive)420 2784 A
4674(*)S
2025 V
(12418)210 1122 A
(*===========================================================================*/)3276 1482 A
2115 V
(12419)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(init_drive\(struct)714 1986 A
(wini)168 2742 A
(*w,)126 2952 A
(int)126 3120 A
(base_cmd,)378 3288 A
(int)126 3708 A
(base_ctl,)378 3876 A
(int)126 4296 A
(irq,)168 4464 A
(int)126 4674 A
(ack,)168 4842 A
(int)126 5052 A
(hook,)210 5220 A
(int)126 5472 A
(drive\))252 5640 A
2205 V
(12420)210 1122 A
1440({)S
2295 V
(12421)210 1122 A
(w->state)336 1776 A
2154(=)S
2238(0;)S
2385 V
(12422)210 1122 A
(w->w_status)462 1776 A
2280(=)S
2364(0;)S
2475 V
(12423)210 1122 A
(w->base_cmd)462 1776 A
2280(=)S
(base_cmd;)378 2364 A
2565 V
(12424)210 1122 A
(w->base_ctl)462 1776 A
2280(=)S
(base_ctl;)378 2364 A
2655 V
(12425)210 1122 A
(w->irq)252 1776 A
2070(=)S
(irq;)168 2154 A
2745 V
(12426)210 1122 A
(w->irq_mask)462 1776 A
2280(=)S
2364(1)S
2448(<<)S
(irq;)168 2574 A
2835 V
(12427)210 1122 A
(w->irq_need_ack)630 1776 A
2448(=)S
(ack;)168 2532 A
2925 V
(12428)210 1122 A
(w->irq_hook_id)588 1776 A
2406(=)S
(hook;)210 2490 A
3015 V
(12429)210 1122 A
(w->ldhpref)420 1776 A
2238(=)S
(ldh_init\(drive\);)672 2322 A
3105 V
(12430)210 1122 A
(w->max_count)504 1776 A
2322(=)S
(MAX_SECS)336 2406 A
2784(<<)S
(SECTOR_SHIFT;)546 2910 A
3195 V
(12431)210 1122 A
(w->lba48)336 1776 A
2154(=)S
2238(0;)S
3285 V
(12432)210 1122 A
1440(})S
3465 V
(12434)210 1122 A
(/*===========================================================================*)3276 1440 A
3555 V
(12435)210 1122 A
1482(*)S
(init_params_pci)630 2784 A
4674(*)S
3645 V
(12436)210 1122 A
(*===========================================================================*/)3276 1482 A
3735 V
(12437)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(init_params_pci\(int)798 1986 A
(skip\))210 2826 A
3825 V
(12438)210 1122 A
1440({)S
3915 V
(12439)210 1122 A
(int)126 1524 A
1692(r,)S
(devind,)294 1818 A
(drive;)252 2154 A
4005 V
(12440)210 1122 A
(u16_t)210 1524 A
(vid,)168 1776 A
(did;)168 1986 A
4095 V
(12441)210 1122 A
(pci_init\(\);)462 1524 A
4185 V
(12442)210 1122 A
(for\(drive)378 1524 A
1944(=)S
(w_next_drive;)546 2028 A
(drive)210 2616 A
2868(<)S
(MAX_DRIVES;)462 2952 A
(drive++\))336 3456 A
4275 V
(12443)210 1122 A
(wini[drive].state)714 1776 A
2532(=)S
(IGNORING;)378 2616 A
4365 V
(12444)210 1122 A
(for\(r)210 1524 A
1776(=)S
(pci_first_dev\(&devind,)924 1860 A
(&vid,)210 2826 A
(&did\);)252 3078 A
4455 V
(12445)210 1122 A
1776(r)S
1860(!=)S
1986(0)S
2070(&&)S
(w_next_drive)504 2196 A
2742(<)S
(MAX_DRIVES;)462 2826 A
3330(r)S
3414(=)S
(pci_next_dev\(&devind,)882 3498 A
(&vid,)210 4422 A
(&did\)\))252 4674 A
4968({)S
4545 V
(12446)210 1122 A
(int)126 1776 A
(interface,)420 1944 A
(irq,)168 2406 A
(irq_hook;)378 2616 A
4635 V
(12447)210 1122 A
1776(/*)S
(Base)168 1902 A
(class)210 2112 A
(must)168 2364 A
2574(be)S
(01h)126 2700 A
(\(mass)210 2868 A
(storage\),)378 3120 A
(subclass)336 3540 A
(must)168 3918 A
4725 V
(12448)210 1122 A
1818(*)S
1902(be)S
(01h)126 2028 A
(\(ATA\).)252 2196 A
4815 V
(12449)210 1122 A
1818(*/)S
4905 V
(12450)210 1122 A
1776(if)S
(\(pci_attr_r8\(devind,)840 1902 A
(PCI_BCR\))336 2784 A
3162(!=)S
(0x01)168 3288 A
3498(||)S
4995 V
(12451)210 1122 A
(pci_attr_r8\(devind,)798 1902 A
(PCI_SCR\))336 2742 A
3120(!=)S
(0x01\))210 3246 A
3498({)S
5085 V
(12452)210 1122 A
(continue;)378 1902 A
5175 V
(12453)210 1122 A
1776(})S
5265 V
(12454)210 1122 A
1776(/*)S
(Found)210 1902 A
2154(a)S
(controller.)462 2238 A
5355 V
(12455)210 1122 A
1818(*)S
(Programming)462 1902 A
(interface)378 2406 A
(register)336 2826 A
(tells)210 3204 A
3456(us)S
(more.)210 3582 A
5445 V
(12456)210 1122 A
1818(*/)S
5535 V
(12457)210 1122 A
(interface)378 1776 A
2196(=)S
(pci_attr_r8\(devind,)798 2280 A
(PCI_PIFR\);)420 3120 A
5625 V
(12458)210 1122 A
(irq)126 1776 A
1944(=)S
(pci_attr_r8\(devind,)798 2028 A
(PCI_ILR\);)378 2868 A
5715 V
(12459)210 1122 A
5805 V
(12460)210 1122 A
1776(/*)S
(Any)126 1902 A
(non-compat)420 2070 A
(drives?)294 2532 A
2868(*/)S
5895 V
(12461)210 1122 A
1776(if)S
(\(interface)420 1902 A
2364(&)S
(\(ATA_IF_NOTCOMPAT1)756 2448 A
3246(|)S
(ATA_IF_NOTCOMPAT2\)\))798 3330 A
4170({)S
5985 V
(12462)210 1122 A
(int)126 2112 A
2280(s;)S
6075 V
(12463)210 1122 A
(irq_hook)336 2112 A
2490(=)S
(irq;)168 2574 A
6165 V
(12464)210 1122 A
2112(if)S
(\(skip)210 2238 A
2490(>)S
2574(0\))S
2700({)S
6255 V
(12465)210 1122 A
2448(if)S
(\(w_pci_debug\))546 2574 A
(printf\("atapci)588 3162 A
(skipping)336 3792 A
(controller)420 4170 A
(\(remain)294 4632 A
(%d\)\\n",)294 4968 A
(skip\);)252 5304 A
6345 V
(12466)210 1122 A
(skip--;)294 2448 A
6435 V
(12467)210 1122 A
(continue;)378 2448 A
6525 V
(12468)210 1122 A
2112(})S
6615 V
(12469)210 1122 A
2112(if)S
(\(\(s=sys_irqsetpolicy\(irq,)1050 2238 A
3330(0,)S
(&irq_hook\)\))462 3456 A
3960(!=)S
(OK\))126 4086 A
4254({)S
6705 V
(12470)210 1122 A
(printf\("atapci:)630 2448 A
(couldn't)336 3120 A
(set)126 3498 A
(IRQ)126 3666 A
(policy)252 3834 A
(%d\\n",)252 4128 A
(irq\);)210 4422 A
6795 V
(12471)210 1122 A
(continue;)378 2448 A
6885 V
(12472)210 1122 A
2112(})S
6975 V
(12473)210 1122 A
2112(if)S
(\(\(s=sys_irqenable\(&irq_hook\)\))1218 2238 A
3498(!=)S
(OK\))126 3624 A
3792({)S
7065 V
(12474)210 1122 A
(printf\("atapci:)630 2448 A
(couldn't)336 3120 A
(enable)252 3498 A
(IRQ)126 3792 A
(line)168 3960 A
(%d\\n",)252 4170 A
(irq\);)210 4464 A
8418 V
EP
%%Page: 156 156
BP
/slant 0 def
/height 0 def
1485 V
12 B
(156)180 1080 A
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(12475)210 1122 A
(continue;)378 2448 A
1845 V
(12476)210 1122 A
2112(})S
1935 V
(12477)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
2025 V
(12478)210 1122 A
2112(/*)S
2238(If)S
(not..)210 2364 A
(this)168 2616 A
2826(is)S
(not)126 2952 A
(the)126 3120 A
(ata-pci)294 3288 A
(controller)420 3624 A
(we're)210 4086 A
2115 V
(12479)210 1122 A
2154(*)S
(looking)294 2238 A
(for.)168 2574 A
2205 V
(12480)210 1122 A
2154(*/)S
2295 V
(12481)210 1122 A
2112(if)S
(\(w_pci_debug\))546 2238 A
(printf\("atapci)588 2826 A
(skipping)336 3456 A
(compatability)546 3834 A
(controller\\n"\);)630 4422 A
2385 V
(12482)210 1122 A
(continue;)378 2112 A
2475 V
(12483)210 1122 A
1776(})S
2565 V
(12484)210 1122 A
2655 V
(12485)210 1122 A
1776(/*)S
(Primary)294 1902 A
(channel)294 2238 A
(not)126 2574 A
2742(in)S
(compatability)546 2868 A
(mode?)210 3456 A
3708(*/)S
2745 V
(12486)210 1122 A
1776(if)S
(\(interface)420 1902 A
2364(&)S
(ATA_IF_NOTCOMPAT1\))756 2448 A
3246({)S
2835 V
(12487)210 1122 A
(u32_t)210 2112 A
(base_cmd,)378 2364 A
(base_ctl;)378 2784 A
2925 V
(12488)210 1122 A
(base_cmd)336 2112 A
2490(=)S
(pci_attr_r32\(devind,)840 2574 A
(PCI_BAR\))336 3456 A
3834(&)S
(0xffffffe0;)462 3918 A
3015 V
(12489)210 1122 A
(base_ctl)336 2112 A
2490(=)S
(pci_attr_r32\(devind,)840 2574 A
(PCI_BAR_2\))420 3456 A
3918(&)S
(0xffffffe0;)462 4002 A
3105 V
(12490)210 1122 A
2112(if)S
(\(base_cmd)378 2238 A
2658(!=)S
(REG_CMD_BASE0)546 2784 A
3372(&&)S
(base_cmd)336 3498 A
3876(!=)S
(REG_CMD_BASE1\))588 4002 A
4632({)S
3195 V
(12491)210 1122 A
(init_drive\(&wini[w_next_drive],)1302 2448 A
3285 V
(12492)210 1122 A
(base_cmd,)378 2784 A
(base_ctl,)378 3204 A
(irq,)168 3624 A
3834(1,)S
(irq_hook,)378 3960 A
(0\);)126 4380 A
3375 V
(12493)210 1122 A
(init_drive\(&wini[w_next_drive+1],)1386 2448 A
3465 V
(12494)210 1122 A
(base_cmd,)378 2784 A
(base_ctl,)378 3204 A
(irq,)168 3624 A
3834(1,)S
(irq_hook,)378 3960 A
(1\);)126 4380 A
3555 V
(12495)210 1122 A
2448(if)S
(\(w_pci_debug\))546 2574 A
3645 V
(12496)210 1122 A
(printf\("atapci)588 2784 A
(%d:)126 3414 A
(0x%x)168 3582 A
(0x%x)168 3792 A
(irq)126 4002 A
(%d\\n",)252 4170 A
(devind,)294 4464 A
(base_cmd,)378 4800 A
(base_ctl,)378 5220 A
(irq\);)210 5640 A
3735 V
(12497)210 1122 A
2112(})S
(else)168 2196 A
(printf\("atapci:)630 2406 A
(ignored)294 3078 A
(drives)252 3414 A
3708(on)S
(primary)294 3834 A
(channel,)336 4170 A
(base)168 4548 A
(%x\\n",)252 4758 A
(base_cmd\);)420 5052 A
3825 V
(12498)210 1122 A
1776(})S
3915 V
(12499)210 1122 A
4005 V
(12500)210 1122 A
1776(/*)S
(Secondary)378 1902 A
(channel)294 2322 A
(not)126 2658 A
2826(in)S
(compatability)546 2952 A
(mode?)210 3540 A
3792(*/)S
4095 V
(12501)210 1122 A
1776(if)S
(\(interface)420 1902 A
2364(&)S
(ATA_IF_NOTCOMPAT2\))756 2448 A
3246({)S
4185 V
(12502)210 1122 A
(u32_t)210 2112 A
(base_cmd,)378 2364 A
(base_ctl;)378 2784 A
4275 V
(12503)210 1122 A
(base_cmd)336 2112 A
2490(=)S
(pci_attr_r32\(devind,)840 2574 A
(PCI_BAR_3\))420 3456 A
3918(&)S
(0xffffffe0;)462 4002 A
4365 V
(12504)210 1122 A
(base_ctl)336 2112 A
2490(=)S
(pci_attr_r32\(devind,)840 2574 A
(PCI_BAR_4\))420 3456 A
3918(&)S
(0xffffffe0;)462 4002 A
4455 V
(12505)210 1122 A
2112(if)S
(\(base_cmd)378 2238 A
2658(!=)S
(REG_CMD_BASE0)546 2784 A
3372(&&)S
(base_cmd)336 3498 A
3876(!=)S
(REG_CMD_BASE1\))588 4002 A
4632({)S
4545 V
(12506)210 1122 A
(init_drive\(&wini[w_next_drive+2],)1386 2448 A
4635 V
(12507)210 1122 A
(base_cmd,)378 2784 A
(base_ctl,)378 3204 A
(irq,)168 3624 A
3834(1,)S
(irq_hook,)378 3960 A
(2\);)126 4380 A
4725 V
(12508)210 1122 A
(init_drive\(&wini[w_next_drive+3],)1386 2448 A
4815 V
(12509)210 1122 A
(base_cmd,)378 2784 A
(base_ctl,)378 3204 A
(irq,)168 3624 A
3834(1,)S
(irq_hook,)378 3960 A
(3\);)126 4380 A
4905 V
(12510)210 1122 A
2448(if)S
(\(w_pci_debug\))546 2574 A
4995 V
(12511)210 1122 A
(printf\("atapci)588 2784 A
(%d:)126 3414 A
(0x%x)168 3582 A
(0x%x)168 3792 A
(irq)126 4002 A
(%d\\n",)252 4170 A
(devind,)294 4464 A
(base_cmd,)378 4800 A
(base_ctl,)378 5220 A
(irq\);)210 5640 A
5085 V
(12512)210 1122 A
2112(})S
(else)168 2196 A
(printf\("atapci:)630 2406 A
(ignored)294 3078 A
(drives)252 3414 A
3708(on)S
(secondary)378 3834 A
(channel,)336 4254 A
(base)168 4632 A
(%x\\n",)252 4842 A
(base_cmd\);)420 5136 A
5175 V
(12513)210 1122 A
1776(})S
5265 V
(12514)210 1122 A
(w_next_drive)504 1776 A
2322(+=)S
2448(4;)S
5355 V
(12515)210 1122 A
1524(})S
5445 V
(12516)210 1122 A
1440(})S
5625 V
(12518)210 1122 A
(/*===========================================================================*)3276 1440 A
5715 V
(12519)210 1122 A
1482(*)S
(w_do_open)378 2784 A
4674(*)S
5805 V
(12520)210 1122 A
(*===========================================================================*/)3276 1482 A
5895 V
(12521)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_do_open\(dp,)546 1944 A
(m_ptr\))252 2532 A
5985 V
(12522)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dp;)168 2028 A
6075 V
(12523)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
6165 V
(12524)210 1122 A
1440({)S
6255 V
(12525)210 1122 A
1440(/*)S
(Device)252 1566 A
(open:)210 1860 A
(Initialize)420 2112 A
(the)126 2574 A
(controller)420 2742 A
(and)126 3204 A
(read)168 3372 A
(the)126 3582 A
(partition)378 3750 A
(table.)252 4170 A
4464(*/)S
6345 V
(12526)210 1122 A
6435 V
(12527)210 1122 A
(struct)252 1524 A
(wini)168 1818 A
(*wn;)168 2028 A
6525 V
(12528)210 1122 A
6615 V
(12529)210 1122 A
1524(if)S
(\(w_prepare\(m_ptr->DEVICE\))1050 1650 A
2742(==)S
(NIL_DEV\))336 2868 A
(return\(ENXIO\);)588 3246 A
6705 V
(12530)210 1122 A
6795 V
(12531)210 1122 A
1524(wn)S
1650(=)S
(w_wn;)210 1734 A
6885 V
(12532)210 1122 A
6975 V
(12533)210 1122 A
1524(/*)S
1650(If)S
(we've)210 1776 A
(probed)252 2028 A
2322(it)S
(before)252 2448 A
(and)126 2742 A
2910(it)S
(failed,)294 3036 A
(don't)210 3372 A
(probe)210 3624 A
3876(it)S
(again.)252 4002 A
4296(*/)S
7065 V
(12534)210 1122 A
1524(if)S
(\(wn->state)420 1650 A
2112(&)S
(IGNORING\))378 2196 A
(return)252 2616 A
(ENXIO;)252 2910 A
8418 V
EP
%%Page: 157 157
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
12 B
(157)180 4500 A
1755 V
7 LST
(12535)210 1122 A
1845 V
(12536)210 1122 A
1524(/*)S
1650(If)S
1776(we)S
(haven't)294 1902 A
(identified)420 2238 A
2700(it)S
(yet,)168 2826 A
3036(or)S
(it's)168 3162 A
(gone)168 3372 A
(deaf,)210 3582 A
1935 V
(12537)210 1122 A
1566(*)S
(\(re-\)identify)546 1650 A
(it.)126 2238 A
2025 V
(12538)210 1122 A
1566(*/)S
2115 V
(12539)210 1122 A
1524(if)S
(\(!\(wn->state)504 1650 A
2196(&)S
(IDENTIFIED\))462 2280 A
2784(||)S
(\(wn->state)420 2910 A
3372(&)S
(DEAF\)\))252 3456 A
3750({)S
2205 V
(12540)210 1122 A
1776(/*)S
(Try)126 1902 A
2070(to)S
(identify)336 2196 A
(the)126 2574 A
(device.)294 2742 A
3078(*/)S
2295 V
(12541)210 1122 A
1776(if)S
(\(w_identify\(\))546 1902 A
2490(!=)S
(OK\))126 2616 A
2784({)S
2385 V
(12542)210 1122 A
2112(if)S
(\(wn->state)420 2238 A
2700(&)S
(DEAF\))210 2784 A
(w_reset\(\);)420 3036 A
2475 V
(12543)210 1122 A
(wn->state)378 2112 A
2532(=)S
(IGNORING;)378 2616 A
2565 V
(12544)210 1122 A
(return\(ENXIO\);)588 2112 A
2655 V
(12545)210 1122 A
1776(})S
2745 V
(12546)210 1122 A
1860(/*)S
1986(Do)S
2112(a)S
(test)168 2196 A
(transaction)462 2406 A
(unless)252 2910 A
(it's)168 3204 A
3414(a)S
3498(CD)S
(drive)210 3624 A
(\(then)210 3876 A
2835 V
(12547)210 1122 A
1902(*)S
1986(we)S
(can)126 2112 A
(believe)294 2280 A
(the)126 2616 A
(controller,)462 2784 A
(and)126 3288 A
3456(a)S
(test)168 3540 A
(may)126 3750 A
(fail)168 3918 A
2925 V
(12548)210 1122 A
1902(*)S
(due)126 1986 A
2154(to)S
2280(no)S
2406(CD)S
(being)210 2532 A
2784(in)S
(the)126 2910 A
(drive\).)294 3078 A
3414(If)S
3540(it)S
(fails,)252 3666 A
(ignore)252 3960 A
3015 V
(12549)210 1122 A
1902(*)S
(the)126 1986 A
(device)252 2154 A
(forever.)336 2448 A
3105 V
(12550)210 1122 A
1902(*/)S
3195 V
(12551)210 1122 A
1860(if)S
(\(!\(wn->state)504 1986 A
2532(&)S
(ATAPI\))252 2616 A
2910(&&)S
(w_io_test\(\))462 3036 A
3540(!=)S
(OK\))126 3666 A
3834({)S
3285 V
(12552)210 1122 A
(wn->state)378 2112 A
2532(|=)S
(IGNORING;)378 2658 A
3375 V
(12553)210 1122 A
(return\(ENXIO\);)588 2112 A
3465 V
(12554)210 1122 A
1860(})S
3555 V
(12555)210 1122 A
1524(})S
3645 V
(12556)210 1122 A
3735 V
(12557)210 1122 A
1566(/*)S
1692(If)S
(it's)168 1818 A
(not)126 2028 A
2196(an)S
(ATAPI)210 2322 A
(device,)294 2574 A
(then)168 2910 A
(don't)210 3120 A
(open)168 3372 A
(with)168 3582 A
(RO_BIT.)294 3792 A
4128(*/)S
3825 V
(12558)210 1122 A
1566(if)S
(\(!\(wn->state)504 1692 A
2238(&)S
(ATAPI\))252 2322 A
2616(&&)S
(\(m_ptr->COUNT)546 2742 A
3330(&)S
(RO_BIT\)\))336 3414 A
(return)252 3792 A
(EACCES;)294 4086 A
3915 V
(12559)210 1122 A
4005 V
(12560)210 1122 A
1524(/*)S
(Partition)378 1650 A
(the)126 2070 A
(drive)210 2238 A
2490(if)S
(it's)168 2616 A
(being)210 2826 A
(opened)252 3078 A
(for)126 3372 A
(the)126 3540 A
(first)210 3708 A
(time,)210 3960 A
4095 V
(12561)210 1122 A
1566(*)S
1650(or)S
(being)210 1776 A
(opened)252 2028 A
(after)210 2322 A
(being)210 2574 A
(closed.)294 2826 A
4185 V
(12562)210 1122 A
1566(*/)S
4275 V
(12563)210 1122 A
1524(if)S
(\(wn->open_ct)504 1650 A
2196(==)S
2322(0\))S
2448({)S
4365 V
(12564)210 1122 A
4455 V
(12565)210 1122 A
1776(/*)S
(Partition)378 1902 A
(the)126 2322 A
(disk.)210 2490 A
2742(*/)S
4545 V
(12566)210 1122 A
(memset\(wn->part,)672 1776 A
(sizeof\(wn->part\),)714 2490 A
(0\);)126 3246 A
4635 V
(12567)210 1122 A
(memset\(wn->subpart,)798 1776 A
(sizeof\(wn->subpart\),)840 2616 A
(0\);)126 3498 A
4725 V
(12568)210 1122 A
(partition\(&w_dtab,)756 1776 A
(w_drive)294 2574 A
2910(*)S
(DEV_PER_DRIVE,)588 2994 A
(P_PRIMARY,)420 3624 A
(wn->state)378 4086 A
4506(&)S
(ATAPI\);)294 4590 A
4815 V
(12569)210 1122 A
1524(})S
4905 V
(12570)210 1122 A
(wn->open_ct++;)588 1524 A
4995 V
(12571)210 1122 A
(return\(OK\);)462 1524 A
5085 V
(12572)210 1122 A
1440(})S
5265 V
(12574)210 1122 A
(/*===========================================================================*)3276 1440 A
5355 V
(12575)210 1122 A
1482(*)S
(w_prepare)378 2784 A
4674(*)S
5445 V
(12576)210 1122 A
(*===========================================================================*/)3276 1482 A
5535 V
(12577)210 1122 A
(PRIVATE)294 1440 A
(struct)252 1776 A
(device)252 2070 A
(*w_prepare\(int)588 2364 A
(device\))294 2994 A
5625 V
(12578)210 1122 A
1440({)S
5715 V
(12579)210 1122 A
1440(/*)S
(Prepare)294 1566 A
(for)126 1902 A
(I/O)126 2070 A
2238(on)S
2364(a)S
(device.)294 2448 A
2784(*/)S
5805 V
(12580)210 1122 A
(struct)252 1440 A
(wini)168 1734 A
(*prev_wn;)378 1944 A
5895 V
(12581)210 1122 A
(prev_wn)294 1440 A
1776(=)S
(w_wn;)210 1860 A
5985 V
(12582)210 1122 A
(w_device)336 1524 A
1902(=)S
(device;)294 1986 A
6075 V
(12583)210 1122 A
6165 V
(12584)210 1122 A
1524(if)S
(\(device)294 1650 A
1986(<)S
(NR_MINORS\))420 2070 A
2532({)S
3456(/*)S
(d0,)126 3582 A
(d0p[0-3],)378 3750 A
(d1,)126 4170 A
(...)126 4338 A
4506(*/)S
6255 V
(12585)210 1122 A
(w_drive)294 1776 A
2112(=)S
(device)252 2196 A
2490(/)S
(DEV_PER_DRIVE;)588 2574 A
3456(/*)S
(save)168 3582 A
(drive)210 3792 A
(number)252 4044 A
4338(*/)S
6345 V
(12586)210 1122 A
(w_wn)168 1776 A
1986(=)S
(&wini[w_drive];)630 2070 A
6435 V
(12587)210 1122 A
(w_dv)168 1776 A
1986(=)S
(&w_wn->part[device)756 2070 A
2868(%)S
(DEV_PER_DRIVE];)630 2952 A
6525 V
(12588)210 1122 A
1524(})S
(else)168 1608 A
6615 V
(12589)210 1122 A
1524(if)S
(\(\(unsigned\))462 1650 A
(\(device)294 2154 A
2490(-=)S
(MINOR_d0p0s0\))546 2616 A
3204(<)S
(NR_SUBDEVS\))462 3288 A
({/*d[0-7]p[0-3]s[0-3]*/)966 3792 A
6705 V
(12590)210 1122 A
(w_drive)294 1776 A
2112(=)S
(device)252 2196 A
2490(/)S
(SUB_PER_DRIVE;)588 2574 A
6795 V
(12591)210 1122 A
(w_wn)168 1776 A
1986(=)S
(&wini[w_drive];)630 2070 A
6885 V
(12592)210 1122 A
(w_dv)168 1776 A
1986(=)S
(&w_wn->subpart[device)882 2070 A
2994(%)S
(SUB_PER_DRIVE];)630 3078 A
6975 V
(12593)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
7065 V
(12594)210 1122 A
(w_device)336 1776 A
2154(=)S
(-1;)126 2238 A
8418 V
EP
%%Page: 158 158
BP
/slant 0 def
/height 0 def
1485 V
12 B
(158)180 1080 A
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(12595)210 1122 A
(return\(NIL_DEV\);)672 1776 A
1845 V
(12596)210 1122 A
1524(})S
1935 V
(12597)210 1122 A
(return\(w_dv\);)546 1524 A
2025 V
(12598)210 1122 A
1440(})S
2205 V
(12600)210 1122 A
(/*===========================================================================*)3276 1440 A
2295 V
(12601)210 1122 A
1482(*)S
(w_identify)420 2784 A
4674(*)S
2385 V
(12602)210 1122 A
(*===========================================================================*/)3276 1482 A
2475 V
(12603)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_identify\(\))504 1944 A
2565 V
(12604)210 1122 A
1440({)S
2655 V
(12605)210 1122 A
1440(/*)S
(Find)168 1566 A
(out)126 1776 A
1944(if)S
2070(a)S
(device)252 2154 A
(exists,)294 2448 A
2784(if)S
2910(it)S
3036(is)S
3162(an)S
(old)126 3288 A
3456(AT)S
(disk,)210 3582 A
3834(or)S
3960(a)S
(newer)210 4044 A
(ATA)126 4296 A
2745 V
(12606)210 1122 A
1482(*)S
(drive,)252 1566 A
1860(a)S
(removable)378 1944 A
(media)210 2364 A
(device,)294 2616 A
(etc.)168 2952 A
2835 V
(12607)210 1122 A
1482(*/)S
2925 V
(12608)210 1122 A
3015 V
(12609)210 1122 A
(struct)252 1524 A
(wini)168 1818 A
(*wn)126 2028 A
2196(=)S
(w_wn;)210 2280 A
3105 V
(12610)210 1122 A
(struct)252 1524 A
(command)294 1818 A
(cmd;)168 2154 A
3195 V
(12611)210 1122 A
(int)126 1524 A
1692(i,)S
1818(s;)S
3285 V
(12612)210 1122 A
(unsigned)336 1524 A
(long)168 1902 A
(size;)210 2112 A
3375 V
(12613)210 1122 A
(#define)294 1440 A
(id_byte\(n\))420 1776 A
(\(&tmp_buf[2)462 2448 A
2952(*)S
(\(n\)]\))210 3036 A
3465 V
(12614)210 1122 A
(#define)294 1440 A
(id_word\(n\))420 1776 A
(\(\(\(u16_t\))378 2448 A
(id_byte\(n\)[0])546 2868 A
3456(<<)S
3624(0\))S
3750(\\)S
3555 V
(12615)210 1122 A
(|\(\(u16_t\))378 2448 A
(id_byte\(n\)[1])546 2868 A
3456(<<)S
(8\)\))126 3624 A
3645 V
(12616)210 1122 A
(#define)294 1440 A
(id_longword\(n\))588 1776 A
(\(\(\(u32_t\))378 2448 A
(id_byte\(n\)[0])546 2868 A
3456(<<)S
3624(0\))S
3750(\\)S
3735 V
(12617)210 1122 A
(|\(\(u32_t\))378 2448 A
(id_byte\(n\)[1])546 2868 A
3456(<<)S
3624(8\))S
3750(\\)S
3825 V
(12618)210 1122 A
(|\(\(u32_t\))378 2448 A
(id_byte\(n\)[2])546 2868 A
3456(<<)S
(16\))126 3582 A
3750(\\)S
3915 V
(12619)210 1122 A
(|\(\(u32_t\))378 2448 A
(id_byte\(n\)[3])546 2868 A
3456(<<)S
(24\)\))168 3582 A
4005 V
(12620)210 1122 A
4095 V
(12621)210 1122 A
1524(/*)S
(Try)126 1650 A
1818(to)S
(identify)336 1944 A
(the)126 2322 A
(device.)294 2490 A
2826(*/)S
4185 V
(12622)210 1122 A
(cmd.ldh)294 1524 A
2028(=)S
(wn->ldhpref;)504 2112 A
4275 V
(12623)210 1122 A
(cmd.command)462 1524 A
2028(=)S
(ATA_IDENTIFY;)546 2112 A
4365 V
(12624)210 1122 A
1524(if)S
(\(com_simple\(&cmd\))714 1650 A
2406(==)S
(OK\))126 2532 A
2700({)S
4455 V
(12625)210 1122 A
1776(/*)S
(This)168 1902 A
2112(is)S
2238(an)S
(ATA)126 2364 A
(device.)294 2532 A
2868(*/)S
4545 V
(12626)210 1122 A
(wn->state)378 1776 A
2196(|=)S
(SMART;)252 2322 A
4635 V
(12627)210 1122 A
4725 V
(12628)210 1122 A
1776(/*)S
(Device)252 1902 A
(information.)504 2196 A
2742(*/)S
4815 V
(12629)210 1122 A
1776(if)S
(\(\(s=sys_insw\(wn->base_cmd)1050 1902 A
2994(+)S
(REG_DATA,)378 3078 A
(SELF,)210 3498 A
(tmp_buf,)336 3750 A
(SECTOR_SIZE\)\))546 4128 A
4716(!=)S
(OK\))126 4842 A
4905 V
(12630)210 1122 A
(panic\(w_name\(\),"Call)840 2112 A
2994(to)S
(sys_insw\(\))420 3120 A
(failed",)336 3582 A
(s\);)126 3960 A
4995 V
(12631)210 1122 A
5085 V
(12632)210 1122 A
1776(/*)S
(Why)126 1902 A
(are)126 2070 A
(the)126 2238 A
(strings)294 2406 A
(byte)168 2742 A
(swapped???)420 2952 A
3414(*/)S
5175 V
(12633)210 1122 A
(for)126 1776 A
1944(\(i)S
2070(=)S
2154(0;)S
2280(i)S
2364(<)S
(40;)126 2448 A
(i++\))168 2616 A
(w_id_string[i])588 2826 A
3456(=)S
(id_byte\(27\)[i\3031];)714 3540 A
5265 V
(12634)210 1122 A
5355 V
(12635)210 1122 A
1776(/*)S
(Preferred)378 1902 A
(CHS)126 2322 A
(translation)462 2490 A
(mode.)210 2994 A
3246(*/)S
5445 V
(12636)210 1122 A
(wn->pcylinders)588 1776 A
2406(=)S
(id_word\(1\);)462 2490 A
5535 V
(12637)210 1122 A
(wn->pheads)420 1776 A
2238(=)S
(id_word\(3\);)462 2322 A
5625 V
(12638)210 1122 A
(wn->psectors)504 1776 A
2322(=)S
(id_word\(6\);)462 2406 A
5715 V
(12639)210 1122 A
(size)168 1776 A
1986(=)S
(\(u32_t\))294 2070 A
(wn->pcylinders)588 2406 A
3036(*)S
(wn->pheads)420 3120 A
3582(*)S
(wn->psectors;)546 3666 A
5805 V
(12640)210 1122 A
5895 V
(12641)210 1122 A
1776(if)S
(\(\(id_byte\(49\)[1])672 1902 A
2616(&)S
(0x02\))210 2700 A
2952(&&)S
(size)168 3078 A
3288(>)S
(512L*1024*2\))504 3372 A
3918({)S
5985 V
(12642)210 1122 A
2112(/*)S
(Drive)210 2238 A
2490(is)S
(LBA)126 2616 A
(capable)294 2784 A
(and)126 3120 A
3288(is)S
(big)126 3414 A
(enough)252 3582 A
3876(to)S
(trust)210 4002 A
4254(it)S
4380(to)S
6075 V
(12643)210 1122 A
2154(*)S
(not)126 2238 A
(make)168 2406 A
2616(a)S
(mess)168 2700 A
2910(of)S
(it.)126 3036 A
6165 V
(12644)210 1122 A
2154(*/)S
6255 V
(12645)210 1122 A
(wn->ldhpref)462 2112 A
2616(|=)S
(LDH_LBA;)336 2742 A
6345 V
(12646)210 1122 A
(size)168 2112 A
2322(=)S
(id_longword\(60\);)672 2406 A
6435 V
(12647)210 1122 A
6525 V
(12648)210 1122 A
2112(if)S
(\(w_lba48)336 2238 A
2616(&&)S
(\(\(id_word\(83\)\))588 2742 A
3372(&)S
(\(1L)126 3456 A
3624(<<)S
(10\)\)\))210 3750 A
4002({)S
6615 V
(12649)210 1122 A
2448(/*)S
(Drive)210 2574 A
2826(is)S
(LBA48)210 2952 A
(capable)294 3204 A
(\(and)168 3540 A
(LBA48)210 3750 A
4002(is)S
(turned)252 4128 A
(on\).)168 4422 A
4632(*/)S
6705 V
(12650)210 1122 A
2448(if)S
(\(id_word\(102\))546 2574 A
3162(||)S
(id_word\(103\)\))546 3288 A
3876({)S
6795 V
(12651)210 1122 A
2784(/*)S
2910(If)S
(no.)126 3036 A
3204(of)S
(sectors)294 3330 A
(doesn't)294 3666 A
(fit)126 4002 A
4170(in)S
4296(32)S
(bits,)210 4422 A
6885 V
(12652)210 1122 A
2826(*)S
(trunacte)336 2910 A
3288(to)S
(this.)210 3414 A
3666(So)S
(it's)168 3792 A
(LBA32)210 4002 A
(for)126 4254 A
(now.)168 4422 A
6975 V
(12653)210 1122 A
2826(*)S
(This)168 2910 A
(can)126 3120 A
(still)210 3288 A
(address)294 3540 A
(devices)294 3876 A
4212(up)S
4338(to)S
(2TB)126 4464 A
7065 V
(12654)210 1122 A
2826(*)S
(though.)294 2910 A
8418 V
EP
%%Page: 159 159
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
12 B
(159)180 4500 A
1755 V
7 LST
(12655)210 1122 A
2826(*/)S
1845 V
(12656)210 1122 A
(size)168 2784 A
2994(=)S
(ULONG_MAX;)420 3078 A
1935 V
(12657)210 1122 A
2448(})S
(else)168 2532 A
2742({)S
2025 V
(12658)210 1122 A
2784(/*)S
(Actual)252 2910 A
(number)252 3204 A
3498(of)S
(sectors)294 3624 A
(fits)168 3960 A
4170(in)S
4296(32)S
(bits.)210 4422 A
4674(*/)S
2115 V
(12659)210 1122 A
(size)168 2784 A
2994(=)S
(id_longword\(100\);)714 3078 A
2205 V
(12660)210 1122 A
2448(})S
2295 V
(12661)210 1122 A
2385 V
(12662)210 1122 A
(wn->lba48)378 2448 A
2868(=)S
2952(1;)S
2475 V
(12663)210 1122 A
2112(})S
2565 V
(12664)210 1122 A
1776(})S
2655 V
(12665)210 1122 A
2745 V
(12666)210 1122 A
1776(if)S
(\(wn->lcylinders)630 1902 A
2574(==)S
2700(0\))S
2826({)S
2835 V
(12667)210 1122 A
2112(/*)S
2238(No)S
(BIOS)168 2364 A
(parameters?)462 2574 A
(Then)168 3120 A
(make)168 3330 A
(some)168 3540 A
(up.)126 3750 A
3918(*/)S
2925 V
(12668)210 1122 A
(wn->lcylinders)588 2112 A
2742(=)S
(wn->pcylinders;)630 2826 A
3015 V
(12669)210 1122 A
(wn->lheads)420 2112 A
2574(=)S
(wn->pheads;)462 2658 A
3105 V
(12670)210 1122 A
(wn->lsectors)504 2112 A
2658(=)S
(wn->psectors;)546 2742 A
3195 V
(12671)210 1122 A
(while)210 2112 A
(\(wn->lcylinders)630 2364 A
3036(>)S
(1024\))210 3120 A
3372({)S
3285 V
(12672)210 1122 A
(wn->lheads)420 2448 A
2910(*=)S
3036(2;)S
3375 V
(12673)210 1122 A
(wn->lcylinders)588 2448 A
3078(/=)S
3204(2;)S
3465 V
(12674)210 1122 A
2112(})S
3555 V
(12675)210 1122 A
1776(})S
3645 V
(12676)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3735 V
(12677)210 1122 A
1776(/*)S
(Not)126 1902 A
2070(an)S
(ATA)126 2196 A
(device;)294 2364 A
2700(no)S
(translations,)546 2826 A
3414(no)S
(special)294 3540 A
(features.)378 3876 A
(Don't)210 4338 A
3825 V
(12678)210 1122 A
1818(*)S
(touch)210 1902 A
2154(it)S
(unless)252 2280 A
(the)126 2574 A
(BIOS)168 2742 A
(knows)210 2952 A
(about)210 3204 A
(it.)126 3456 A
3915 V
(12679)210 1122 A
1818(*/)S
4005 V
(12680)210 1122 A
1776(if)S
(\(wn->lcylinders)630 1902 A
2574(==)S
2700(0\))S
2826({)S
(return\(ERR\);)504 2910 A
3456(})S
3792(/*)S
3918(no)S
(BIOS)168 4044 A
(parameters)420 4254 A
4716(*/)S
4095 V
(12681)210 1122 A
(wn->pcylinders)588 1776 A
2406(=)S
(wn->lcylinders;)630 2490 A
4185 V
(12682)210 1122 A
(wn->pheads)420 1776 A
2238(=)S
(wn->lheads;)462 2322 A
4275 V
(12683)210 1122 A
(wn->psectors)504 1776 A
2322(=)S
(wn->lsectors;)546 2406 A
4365 V
(12684)210 1122 A
(size)168 1776 A
1986(=)S
(\(u32_t\))294 2070 A
(wn->pcylinders)588 2406 A
3036(*)S
(wn->pheads)420 3120 A
3582(*)S
(wn->psectors;)546 3666 A
4455 V
(12685)210 1122 A
1524(})S
4545 V
(12686)210 1122 A
4635 V
(12687)210 1122 A
1524(/*)S
(Size)168 1650 A
1860(of)S
(the)126 1986 A
(whole)210 2154 A
(drive)210 2406 A
2658(*/)S
4725 V
(12688)210 1122 A
(wn->part[0].dv_size)798 1524 A
2364(=)S
(mul64u\(size,)504 2448 A
(SECTOR_SIZE\);)546 2994 A
4815 V
(12689)210 1122 A
4905 V
(12690)210 1122 A
1524(/*)S
(Reset/calibrate)630 1650 A
(\(where)252 2322 A
(necessary\))420 2616 A
3078(*/)S
4995 V
(12691)210 1122 A
1524(if)S
(\(w_specify\(\))504 1650 A
2196(!=)S
2322(OK)S
2448(&&)S
(w_specify\(\))462 2574 A
3078(!=)S
(OK\))126 3204 A
3372({)S
5085 V
(12692)210 1122 A
(return\(ERR\);)504 1776 A
5175 V
(12693)210 1122 A
1524(})S
5265 V
(12694)210 1122 A
5355 V
(12695)210 1122 A
1524(if)S
(\(wn->irq)336 1650 A
2028(==)S
(NO_IRQ\))294 2154 A
2490({)S
5445 V
(12696)210 1122 A
1860(/*)S
(Everything)420 1986 A
(looks)210 2448 A
(OK;)126 2700 A
(register)336 2868 A
(IRQ)126 3246 A
3414(so)S
3540(we)S
(can)126 3666 A
(stop)168 3834 A
(polling.)336 4044 A
4422(*/)S
5535 V
(12697)210 1122 A
(wn->irq)294 1860 A
2196(=)S
(w_drive)294 2280 A
2616(<)S
2700(2)S
2784(?)S
(AT_WINI_0_IRQ)546 2868 A
3456(:)S
(AT_WINI_1_IRQ;)588 3540 A
5625 V
(12698)210 1122 A
(wn->irq_hook_id)630 1860 A
2532(=)S
(wn->irq;)336 2616 A
3120(/*)S
3246(id)S
3372(to)S
3498(be)S
(returned)336 3624 A
4002(if)S
(interrupt)378 4128 A
(occurs)252 4548 A
4842(*/)S
5715 V
(12699)210 1122 A
1860(if)S
(\(\(s=sys_irqsetpolicy\(wn->irq,)1218 1986 A
(IRQ_REENABLE,)546 3246 A
(&wn->irq_hook_id\)\))756 3834 A
4632(!=)S
(OK\))126 4758 A
5805 V
(12700)210 1122 A
(panic\(w_name\(\),)630 2112 A
("couldn't)378 2784 A
(set)126 3204 A
(IRQ)126 3372 A
(policy",)336 3540 A
(s\);)126 3918 A
5895 V
(12701)210 1122 A
1860(if)S
(\(\(s=sys_irqenable\(&wn->irq_hook_id\)\))1512 1986 A
3540(!=)S
(OK\))126 3666 A
5985 V
(12702)210 1122 A
(panic\(w_name\(\),)630 2112 A
("couldn't)378 2784 A
(enable)252 3204 A
(IRQ)126 3498 A
(line",)252 3666 A
(s\);)126 3960 A
6075 V
(12703)210 1122 A
1524(})S
6165 V
(12704)210 1122 A
(wn->state)378 1524 A
1944(|=)S
(IDENTIFIED;)462 2070 A
6255 V
(12705)210 1122 A
(return\(OK\);)462 1524 A
6345 V
(12706)210 1122 A
1440(})S
6525 V
(12708)210 1122 A
(/*===========================================================================*)3276 1440 A
6615 V
(12709)210 1122 A
1482(*)S
(w_name)252 2784 A
4674(*)S
6705 V
(12710)210 1122 A
(*===========================================================================*/)3276 1482 A
6795 V
(12711)210 1122 A
(PRIVATE)294 1440 A
(char)168 1776 A
(*w_name\(\))378 1986 A
6885 V
(12712)210 1122 A
1440({)S
6975 V
(12713)210 1122 A
1440(/*)S
(Return)252 1566 A
1860(a)S
(name)168 1944 A
(for)126 2154 A
(the)126 2322 A
(current)294 2490 A
(device.)294 2826 A
3162(*/)S
7065 V
(12714)210 1122 A
(static)252 1524 A
(char)168 1818 A
(name[])252 2028 A
2322(=)S
("AT-D0";)336 2406 A
8418 V
EP
%%Page: 160 160
BP
/slant 0 def
/height 0 def
1485 V
12 B
(160)180 1080 A
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(12715)210 1122 A
1845 V
(12716)210 1122 A
(name[4])294 1524 A
1860(=)S
('0')126 1944 A
2112(+)S
(w_drive;)336 2196 A
1935 V
(12717)210 1122 A
(return)252 1524 A
(name;)210 1818 A
2025 V
(12718)210 1122 A
1440(})S
2205 V
(12720)210 1122 A
(/*===========================================================================*)3276 1440 A
2295 V
(12721)210 1122 A
1482(*)S
(w_io_test)378 2784 A
4674(*)S
2385 V
(12722)210 1122 A
(*===========================================================================*/)3276 1482 A
2475 V
(12723)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_io_test\(void\))630 1944 A
2565 V
(12724)210 1122 A
1440({)S
2655 V
(12725)210 1122 A
(int)126 1776 A
1944(r,)S
(save_dev;)378 2070 A
2745 V
(12726)210 1122 A
(int)126 1776 A
(save_timeout,)546 1944 A
(save_errors,)504 2532 A
(save_wakeup;)504 3078 A
2835 V
(12727)210 1122 A
(iovec_t)294 1776 A
(iov;)168 2112 A
2925 V
(12728)210 1122 A
(static)252 1776 A
(char)168 2070 A
(buf[SECTOR_SIZE];)714 2280 A
3015 V
(12729)210 1122 A
(iov.iov_addr)504 1776 A
2322(=)S
(\(vir_bytes\))462 2406 A
(buf;)168 2910 A
3105 V
(12730)210 1122 A
(iov.iov_size)504 1776 A
2322(=)S
(sizeof\(buf\);)504 2406 A
3195 V
(12731)210 1122 A
(save_dev)336 1776 A
2154(=)S
(w_device;)378 2238 A
3285 V
(12732)210 1122 A
3375 V
(12733)210 1122 A
1776(/*)S
(Reduce)252 1902 A
(timeout)294 2196 A
(values)252 2532 A
(for)126 2826 A
(this)168 2994 A
(test)168 3204 A
(transaction.)504 3414 A
3960(*/)S
3465 V
(12734)210 1122 A
(save_timeout)504 1776 A
2322(=)S
(timeout_ticks;)588 2406 A
3555 V
(12735)210 1122 A
(save_errors)462 1776 A
2280(=)S
(max_errors;)462 2364 A
3645 V
(12736)210 1122 A
(save_wakeup)462 1776 A
2280(=)S
(wakeup_ticks;)546 2364 A
3735 V
(12737)210 1122 A
3825 V
(12738)210 1122 A
1776(if)S
(\(!w_standard_timeouts\))924 1902 A
2868({)S
3915 V
(12739)210 1122 A
(timeout_ticks)546 2112 A
2700(=)S
2784(HZ)S
2910(*)S
2994(4;)S
4005 V
(12740)210 1122 A
(wakeup_ticks)504 2112 A
2658(=)S
2742(HZ)S
2868(*)S
2952(6;)S
4095 V
(12741)210 1122 A
(max_errors)420 2112 A
2574(=)S
2658(3;)S
4185 V
(12742)210 1122 A
1776(})S
4275 V
(12743)210 1122 A
4365 V
(12744)210 1122 A
(w_testing)378 1776 A
2196(=)S
2280(1;)S
4455 V
(12745)210 1122 A
4545 V
(12746)210 1122 A
1776(/*)S
(Try)126 1902 A
(I/O)126 2070 A
2238(on)S
(the)126 2364 A
(actual)252 2532 A
(drive)210 2826 A
(\(not)168 3078 A
(any)126 3288 A
(\(sub\)partition\).)672 3456 A
4170(*/)S
4635 V
(12747)210 1122 A
1776(if)S
(\(w_prepare\(w_drive)756 1902 A
2700(*)S
(DEV_PER_DRIVE\))588 2784 A
3414(==)S
(NIL_DEV\))336 3540 A
4725 V
(12748)210 1122 A
(panic\(w_name\(\),)630 2112 A
("Couldn't)378 2784 A
(switch)252 3204 A
(devices",)378 3498 A
(NO_NUM\);)336 3918 A
4815 V
(12749)210 1122 A
4905 V
(12750)210 1122 A
1776(r)S
1860(=)S
(w_transfer\(SELF,)672 1944 A
(DEV_GATHER,)462 2658 A
3162(0,)S
(&iov,)210 3288 A
(1\);)126 3540 A
4995 V
(12751)210 1122 A
5085 V
(12752)210 1122 A
1776(/*)S
(Switch)252 1902 A
(back.)210 2196 A
2448(*/)S
5175 V
(12753)210 1122 A
1776(if)S
(\(w_prepare\(save_dev\))840 1902 A
2784(==)S
(NIL_DEV\))336 2910 A
5265 V
(12754)210 1122 A
(panic\(w_name\(\),)630 2112 A
("Couldn't)378 2784 A
(switch)252 3204 A
(back)168 3498 A
(devices",)378 3708 A
(NO_NUM\);)336 4128 A
5355 V
(12755)210 1122 A
5445 V
(12756)210 1122 A
1776(/*)S
(Restore)294 1902 A
(parameters.)462 2238 A
2742(*/)S
5535 V
(12757)210 1122 A
(timeout_ticks)546 1776 A
2364(=)S
(save_timeout;)546 2448 A
5625 V
(12758)210 1122 A
(max_errors)420 1776 A
2238(=)S
(save_errors;)504 2322 A
5715 V
(12759)210 1122 A
(wakeup_ticks)504 1776 A
2322(=)S
(save_wakeup;)504 2406 A
5805 V
(12760)210 1122 A
(w_testing)378 1776 A
2196(=)S
2280(0;)S
5895 V
(12761)210 1122 A
5985 V
(12762)210 1122 A
1776(/*)S
(Test)168 1902 A
2112(if)S
(everything)420 2238 A
(worked.)294 2700 A
3036(*/)S
6075 V
(12763)210 1122 A
1776(if)S
1902(\(r)S
2028(!=)S
2154(OK)S
2280(||)S
(iov.iov_size)504 2406 A
2952(!=)S
3078(0\))S
3204({)S
6165 V
(12764)210 1122 A
(return)252 2112 A
(ERR;)168 2406 A
6255 V
(12765)210 1122 A
1776(})S
6345 V
(12766)210 1122 A
6435 V
(12767)210 1122 A
1776(/*)S
(Everything)420 1902 A
(worked.)294 2364 A
2700(*/)S
6525 V
(12768)210 1122 A
6615 V
(12769)210 1122 A
(return)252 1776 A
(OK;)126 2070 A
6705 V
(12770)210 1122 A
1440(})S
8418 V
EP
%%Page: 161 161
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
12 B
(161)180 4500 A
1755 V
7 LST
(12772)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(12773)210 1122 A
1482(*)S
(w_specify)378 2784 A
4674(*)S
1935 V
(12774)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(12775)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_specify\(\))462 1944 A
2115 V
(12776)210 1122 A
1440({)S
2205 V
(12777)210 1122 A
1440(/*)S
(Routine)294 1566 A
1902(to)S
(initialize)420 2028 A
(the)126 2490 A
(drive)210 2658 A
(after)210 2910 A
(boot)168 3162 A
3372(or)S
(when)168 3498 A
3708(a)S
(reset)210 3792 A
4044(is)S
(needed.)294 4170 A
4506(*/)S
2295 V
(12778)210 1122 A
2385 V
(12779)210 1122 A
(struct)252 1524 A
(wini)168 1818 A
(*wn)126 2028 A
2196(=)S
(w_wn;)210 2280 A
2475 V
(12780)210 1122 A
(struct)252 1524 A
(command)294 1818 A
(cmd;)168 2154 A
2565 V
(12781)210 1122 A
2655 V
(12782)210 1122 A
1524(if)S
(\(\(wn->state)462 1650 A
2154(&)S
(DEAF\))210 2238 A
2490(&&)S
(w_reset\(\))378 2616 A
3036(!=)S
(OK\))126 3162 A
3330({)S
2745 V
(12783)210 1122 A
(return\(ERR\);)504 1776 A
2835 V
(12784)210 1122 A
1524(})S
2925 V
(12785)210 1122 A
3015 V
(12786)210 1122 A
1524(if)S
(\(!\(wn->state)504 1650 A
2196(&)S
(ATAPI\)\))294 2280 A
2616({)S
3105 V
(12787)210 1122 A
1776(/*)S
(Specify)294 1902 A
(parameters:)462 2238 A
(precompensation,)672 2742 A
(number)252 3456 A
3750(of)S
(heads)210 3876 A
(and)126 4128 A
(sectors.)336 4296 A
4674(*/)S
3195 V
(12788)210 1122 A
(cmd.precomp)462 1776 A
2280(=)S
(wn->precomp;)504 2364 A
3285 V
(12789)210 1122 A
(cmd.count)378 1776 A
2280(=)S
(wn->psectors;)546 2364 A
3375 V
(12790)210 1122 A
(cmd.ldh)294 1776 A
2280(=)S
(w_wn->ldhpref)546 2364 A
2952(|)S
(\(wn->pheads)462 3036 A
3540(-)S
(1\);)126 3624 A
3465 V
(12791)210 1122 A
(cmd.command)462 1776 A
2280(=)S
(CMD_SPECIFY;)504 2364 A
3456(/*)S
(Specify)294 3582 A
(some)168 3918 A
(parameters)420 4128 A
4590(*/)S
3555 V
(12792)210 1122 A
3645 V
(12793)210 1122 A
1776(/*)S
(Output)252 1902 A
(command)294 2196 A
(block)210 2532 A
(and)126 2784 A
(see)126 2952 A
3120(if)S
(controller)420 3246 A
(accepts)294 3708 A
(the)126 4044 A
(parameters.)462 4212 A
4716(*/)S
3735 V
(12794)210 1122 A
1776(if)S
(\(com_simple\(&cmd\))714 1902 A
2658(!=)S
(OK\))126 2784 A
(return\(ERR\);)504 2952 A
3825 V
(12795)210 1122 A
3915 V
(12796)210 1122 A
1776(if)S
(\(!\(wn->state)504 1902 A
2448(&)S
(SMART\)\))294 2532 A
2868({)S
4005 V
(12797)210 1122 A
2112(/*)S
(Calibrate)378 2238 A
2658(an)S
(old)126 2784 A
(disk.)210 2952 A
3204(*/)S
4095 V
(12798)210 1122 A
(cmd.sector)420 2112 A
2616(=)S
2700(0;)S
4185 V
(12799)210 1122 A
(cmd.cyl_lo)420 2112 A
2616(=)S
2700(0;)S
4275 V
(12800)210 1122 A
(cmd.cyl_hi)420 2112 A
2616(=)S
2700(0;)S
4365 V
(12801)210 1122 A
(cmd.ldh)294 2112 A
2616(=)S
(w_wn->ldhpref;)588 2700 A
4455 V
(12802)210 1122 A
(cmd.command)462 2112 A
2616(=)S
(CMD_RECALIBRATE;)672 2700 A
4545 V
(12803)210 1122 A
4635 V
(12804)210 1122 A
2112(if)S
(\(com_simple\(&cmd\))714 2238 A
2994(!=)S
(OK\))126 3120 A
(return\(ERR\);)504 3288 A
4725 V
(12805)210 1122 A
1776(})S
4815 V
(12806)210 1122 A
1524(})S
4905 V
(12807)210 1122 A
(wn->state)378 1524 A
1944(|=)S
(INITIALIZED;)504 2070 A
4995 V
(12808)210 1122 A
(return\(OK\);)462 1524 A
5085 V
(12809)210 1122 A
1440(})S
5265 V
(12811)210 1122 A
(/*===========================================================================*)3276 1440 A
5355 V
(12812)210 1122 A
1482(*)S
(do_transfer)462 2784 A
4674(*)S
5445 V
(12813)210 1122 A
(*===========================================================================*/)3276 1482 A
5535 V
(12814)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(do_transfer\(struct)756 1944 A
(wini)168 2742 A
(*wn,)168 2952 A
(unsigned)336 3162 A
(int)126 3540 A
(precomp,)336 3708 A
(unsigned)336 4086 A
(int)126 4464 A
(count,)252 4632 A
5625 V
(12815)210 1122 A
(unsigned)336 1776 A
(int)126 2154 A
(sector,)294 2322 A
(unsigned)336 2658 A
(int)126 3036 A
(opcode\))294 3204 A
5715 V
(12816)210 1122 A
1440({)S
5805 V
(12817)210 1122 A
(struct)252 1776 A
(command)294 2070 A
(cmd;)168 2406 A
5895 V
(12818)210 1122 A
(unsigned)336 1776 A
(secspcyl)336 2154 A
2532(=)S
(wn->pheads)420 2616 A
3078(*)S
(wn->psectors;)546 3162 A
5985 V
(12819)210 1122 A
6075 V
(12820)210 1122 A
(cmd.precomp)462 1776 A
2280(=)S
(precomp;)336 2364 A
6165 V
(12821)210 1122 A
(cmd.count)378 1776 A
2280(=)S
(count;)252 2364 A
6255 V
(12822)210 1122 A
(cmd.command)462 1776 A
2280(=)S
(opcode)252 2364 A
2658(==)S
(DEV_SCATTER)462 2784 A
3288(?)S
(CMD_WRITE)378 3372 A
3792(:)S
(CMD_READ;)378 3876 A
6345 V
(12823)210 1122 A
1776(/*)S
6435 V
(12824)210 1122 A
1776(if)S
(\(w_lba48)336 1902 A
2280(&&)S
(wn->lba48\))420 2406 A
2868({)S
6525 V
(12825)210 1122 A
1776(})S
(else)168 1860 A
2112(*/)S
6615 V
(12826)210 1122 A
1776(if)S
(\(wn->ldhpref)504 1902 A
2448(&)S
(LDH_LBA\))336 2532 A
2910({)S
6705 V
(12827)210 1122 A
(cmd.sector)420 2112 A
2616(=)S
(\(sector)294 2700 A
3036(>>)S
3204(0\))S
3330(&)S
(0xFF;)210 3414 A
6795 V
(12828)210 1122 A
(cmd.cyl_lo)420 2112 A
2616(=)S
(\(sector)294 2700 A
3036(>>)S
3204(8\))S
3330(&)S
(0xFF;)210 3414 A
6885 V
(12829)210 1122 A
(cmd.cyl_hi)420 2112 A
2616(=)S
(\(sector)294 2700 A
3036(>>)S
(16\))126 3162 A
3330(&)S
(0xFF;)210 3414 A
6975 V
(12830)210 1122 A
(cmd.ldh)294 2112 A
2616(=)S
(wn->ldhpref)462 2700 A
3204(|)S
(\(\(sector)336 3288 A
3666(>>)S
(24\))126 3792 A
3960(&)S
(0xF\);)210 4044 A
7065 V
(12831)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
8418 V
EP
%%Page: 162 162
BP
/slant 0 def
/height 0 def
1485 V
12 B
(162)180 1080 A
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(12832)210 1122 A
(int)126 2112 A
(cylinder,)378 2280 A
(head,)210 2700 A
(sec;)168 2952 A
1845 V
(12833)210 1122 A
(cylinder)336 2112 A
2490(=)S
(sector)252 2574 A
2868(/)S
(secspcyl;)378 2952 A
1935 V
(12834)210 1122 A
(head)168 2112 A
2322(=)S
(\(sector)294 2406 A
2742(%)S
(secspcyl\))378 2826 A
3246(/)S
(wn->psectors;)546 3330 A
2025 V
(12835)210 1122 A
(sec)126 2112 A
2280(=)S
(sector)252 2364 A
2658(%)S
(wn->psectors;)546 2742 A
2115 V
(12836)210 1122 A
(cmd.sector)420 2112 A
2616(=)S
(sec)126 2700 A
2868(+)S
2952(1;)S
2205 V
(12837)210 1122 A
(cmd.cyl_lo)420 2112 A
2616(=)S
(cylinder)336 2700 A
3078(&)S
(BYTE;)210 3162 A
2295 V
(12838)210 1122 A
(cmd.cyl_hi)420 2112 A
2616(=)S
(\(cylinder)378 2700 A
3120(>>)S
3246(8\))S
3372(&)S
(BYTE;)210 3456 A
2385 V
(12839)210 1122 A
(cmd.ldh)294 2112 A
2616(=)S
(wn->ldhpref)462 2700 A
3204(|)S
(head;)210 3288 A
2475 V
(12840)210 1122 A
1776(})S
2565 V
(12841)210 1122 A
2655 V
(12842)210 1122 A
(return)252 1776 A
(com_out\(&cmd\);)588 2070 A
2745 V
(12843)210 1122 A
1440(})S
2925 V
(12845)210 1122 A
(/*===========================================================================*)3276 1440 A
3015 V
(12846)210 1122 A
1482(*)S
(w_transfer)420 2784 A
4674(*)S
3105 V
(12847)210 1122 A
(*===========================================================================*/)3276 1482 A
3195 V
(12848)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_transfer\(proc_nr,)798 1944 A
(opcode,)294 2784 A
(position,)378 3120 A
(iov,)168 3540 A
(nr_req\))294 3750 A
3285 V
(12849)210 1122 A
(int)126 1440 A
(proc_nr;)336 1608 A
2784(/*)S
(process)294 2910 A
(doing)210 3246 A
(the)126 3498 A
(request)294 3666 A
4002(*/)S
3375 V
(12850)210 1122 A
(int)126 1440 A
(opcode;)294 1608 A
2784(/*)S
(DEV_GATHER)420 2910 A
3372(or)S
(DEV_SCATTER)462 3498 A
4002(*/)S
3465 V
(12851)210 1122 A
(off_t)210 1440 A
(position;)378 1692 A
2784(/*)S
(offset)252 2910 A
3204(on)S
(device)252 3330 A
3624(to)S
(read)168 3750 A
3960(or)S
(write)210 4086 A
4338(*/)S
3555 V
(12852)210 1122 A
(iovec_t)294 1440 A
(*iov;)210 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(read)168 3372 A
3582(or)S
(write)210 3708 A
(request)294 3960 A
(vector)252 4296 A
4590(*/)S
3645 V
(12853)210 1122 A
(unsigned)336 1440 A
(nr_req;)294 1818 A
2784(/*)S
(length)252 2910 A
3204(of)S
(request)294 3330 A
(vector)252 3666 A
3960(*/)S
3735 V
(12854)210 1122 A
1440({)S
3825 V
(12855)210 1122 A
(struct)252 1524 A
(wini)168 1818 A
(*wn)126 2028 A
2196(=)S
(w_wn;)210 2280 A
3915 V
(12856)210 1122 A
(iovec_t)294 1524 A
(*iop,)210 1860 A
(*iov_end)336 2112 A
2490(=)S
(iov)126 2574 A
2742(+)S
(nr_req;)294 2826 A
4005 V
(12857)210 1122 A
(int)126 1524 A
1692(r,)S
1818(s,)S
(errors;)294 1944 A
4095 V
(12858)210 1122 A
(unsigned)336 1524 A
(long)168 1902 A
(block;)252 2112 A
4185 V
(12859)210 1122 A
(unsigned)336 1524 A
(long)168 1902 A
(dv_size)294 2112 A
2448(=)S
(cv64ul\(w_dv->dv_size\);)924 2532 A
4275 V
(12860)210 1122 A
(unsigned)336 1524 A
(cylinder,)378 1902 A
(head,)210 2322 A
(sector,)294 2574 A
(nbytes;)294 2910 A
4365 V
(12861)210 1122 A
4455 V
(12862)210 1122 A
1524(/*)S
(Check)210 1650 A
(disk)168 1902 A
(address.)336 2112 A
2490(*/)S
4545 V
(12863)210 1122 A
1524(if)S
(\(\(position)420 1650 A
2112(&)S
(SECTOR_MASK\))504 2196 A
2742(!=)S
2868(0\))S
(return\(EINVAL\);)630 2994 A
4635 V
(12864)210 1122 A
4725 V
(12865)210 1122 A
(errors)252 1524 A
1818(=)S
1902(0;)S
4815 V
(12866)210 1122 A
4905 V
(12867)210 1122 A
(while)210 1524 A
(\(nr_req)294 1776 A
2112(>)S
2196(0\))S
2322({)S
4995 V
(12868)210 1122 A
1776(/*)S
(How)126 1902 A
(many)168 2070 A
(bytes)210 2280 A
2532(to)S
(transfer?)378 2658 A
3078(*/)S
5085 V
(12869)210 1122 A
(nbytes)252 1776 A
2070(=)S
2154(0;)S
5175 V
(12870)210 1122 A
(for)126 1776 A
(\(iop)168 1944 A
2154(=)S
(iov;)168 2238 A
(iop)126 2448 A
2616(<)S
(iov_end;)336 2700 A
(iop++\))252 3078 A
(nbytes)252 3372 A
3666(+=)S
(iop->iov_size;)588 3792 A
5265 V
(12871)210 1122 A
1776(if)S
(\(\(nbytes)336 1902 A
2280(&)S
(SECTOR_MASK\))504 2364 A
2910(!=)S
3036(0\))S
(return\(EINVAL\);)630 3162 A
5355 V
(12872)210 1122 A
5445 V
(12873)210 1122 A
1776(/*)S
(Which)210 1902 A
(block)210 2154 A
2406(on)S
(disk)168 2532 A
(and)126 2742 A
(how)126 2910 A
(close)210 3078 A
3330(to)S
(EOF?)168 3456 A
3666(*/)S
5535 V
(12874)210 1122 A
1776(if)S
(\(position)378 1902 A
2322(>=)S
(dv_size\))336 2448 A
(return\(OK\);)462 2826 A
3792(/*)S
3918(At)S
(EOF)126 4044 A
4212(*/)S
5625 V
(12875)210 1122 A
1776(if)S
(\(position)378 1902 A
2322(+)S
(nbytes)252 2406 A
2700(>)S
(dv_size\))336 2784 A
(nbytes)252 3162 A
3456(=)S
(dv_size)294 3540 A
3876(-)S
(position;)378 3960 A
5715 V
(12876)210 1122 A
(block)210 1776 A
2028(=)S
(div64u\(add64ul\(w_dv->dv_base,)1218 2112 A
(position\),)420 3372 A
(SECTOR_SIZE\);)546 3834 A
5805 V
(12877)210 1122 A
5895 V
(12878)210 1122 A
1776(if)S
(\(nbytes)294 1902 A
2238(>=)S
(wn->max_count\))588 2364 A
2994({)S
5985 V
(12879)210 1122 A
2112(/*)S
(The)126 2238 A
(drive)210 2406 A
(can't)210 2658 A
2910(do)S
(more)168 3036 A
(then)168 3246 A
(max_count)378 3456 A
3876(at)S
(once.)210 4002 A
4254(*/)S
6075 V
(12880)210 1122 A
(nbytes)252 2112 A
2406(=)S
(wn->max_count;)588 2490 A
6165 V
(12881)210 1122 A
1776(})S
6255 V
(12882)210 1122 A
6345 V
(12883)210 1122 A
1776(/*)S
(First)210 1902 A
(check)210 2154 A
2406(to)S
(see)126 2532 A
2700(if)S
2826(a)S
(reinitialization)672 2910 A
3624(is)S
(needed.)294 3750 A
4086(*/)S
6435 V
(12884)210 1122 A
1776(if)S
(\(!\(wn->state)504 1902 A
2448(&)S
(INITIALIZED\))504 2532 A
3078(&&)S
(w_specify\(\))462 3204 A
3708(!=)S
(OK\))126 3834 A
(return\(EIO\);)504 4002 A
6525 V
(12885)210 1122 A
6615 V
(12886)210 1122 A
1776(/*)S
(Tell)168 1902 A
(the)126 2112 A
(controller)420 2280 A
2742(to)S
(transfer)336 2868 A
(nbytes)252 3246 A
(bytes.)252 3540 A
3834(*/)S
6705 V
(12887)210 1122 A
1776(r)S
1860(=)S
(do_transfer\(wn,)630 1944 A
(wn->precomp,)504 2616 A
(\(\(nbytes)336 3162 A
3540(>>)S
(SECTOR_SHIFT\))546 3666 A
4254(&)S
(BYTE\),)252 4338 A
6795 V
(12888)210 1122 A
(block,)252 2112 A
(opcode\);)336 2406 A
6885 V
(12889)210 1122 A
6975 V
(12890)210 1122 A
(while)210 1776 A
2028(\(r)S
2154(==)S
2280(OK)S
2406(&&)S
(nbytes)252 2532 A
2826(>)S
2910(0\))S
3036({)S
7065 V
(12891)210 1122 A
2112(/*)S
(For)126 2238 A
(each)168 2406 A
(sector,)294 2616 A
(wait)168 2952 A
(for)126 3162 A
3330(an)S
(interrupt)378 3456 A
(and)126 3876 A
(fetch)210 4044 A
(the)126 4296 A
(data)168 4464 A
8418 V
EP
%%Page: 163 163
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
12 B
(163)180 4500 A
1755 V
7 LST
(12892)210 1122 A
2154(*)S
(\(read\),)294 2238 A
2574(or)S
(supply)252 2700 A
(data)168 2994 A
3204(to)S
(the)126 3330 A
(controller)420 3498 A
(and)126 3960 A
(wait)168 4128 A
(for)126 4338 A
4506(an)S
1845 V
(12893)210 1122 A
2154(*)S
(interrupt)378 2238 A
(\(write\).)336 2658 A
1935 V
(12894)210 1122 A
2154(*/)S
2025 V
(12895)210 1122 A
2115 V
(12896)210 1122 A
2112(if)S
(\(opcode)294 2238 A
2574(==)S
(DEV_GATHER\))462 2700 A
3204({)S
2205 V
(12897)210 1122 A
2448(/*)S
(First)210 2574 A
2826(an)S
(interrupt,)420 2952 A
(then)168 3414 A
(data.)210 3624 A
3876(*/)S
2295 V
(12898)210 1122 A
2448(if)S
(\(\(r)126 2574 A
2742(=)S
(at_intr_wait\(\)\))630 2826 A
3498(!=)S
(OK\))126 3624 A
3792({)S
2385 V
(12899)210 1122 A
2784(/*)S
2910(An)S
(error,)252 3036 A
(send)168 3330 A
(data)168 3540 A
3750(to)S
(the)126 3876 A
(bit)126 4044 A
(bucket.)294 4212 A
4548(*/)S
2475 V
(12900)210 1122 A
2784(if)S
(\(w_wn->w_status)630 2910 A
3582(&)S
(STATUS_DRQ\))462 3666 A
4170({)S
2565 V
(12901)210 1122 A
1776(if)S
(\(\(s=sys_insw\(wn->base_cmd)1050 1902 A
2994(+)S
(REG_DATA,)378 3078 A
(SELF,)210 3498 A
(tmp_buf,)336 3750 A
(SECTOR_SIZE\)\))546 4128 A
4716(!=)S
(OK\))126 4842 A
2655 V
(12902)210 1122 A
(panic\(w_name\(\),"Call)840 2112 A
2994(to)S
(sys_insw\(\))420 3120 A
(failed",)336 3582 A
(s\);)126 3960 A
2745 V
(12903)210 1122 A
2784(})S
2835 V
(12904)210 1122 A
(break;)252 2784 A
2925 V
(12905)210 1122 A
2448(})S
3015 V
(12906)210 1122 A
2112(})S
3105 V
(12907)210 1122 A
3195 V
(12908)210 1122 A
2112(/*)S
(Wait)168 2238 A
(for)126 2448 A
(data)168 2616 A
(transfer)336 2826 A
(requested.)420 3204 A
3666(*/)S
3285 V
(12909)210 1122 A
2112(if)S
(\(!w_waitfor\(STATUS_DRQ,)966 2238 A
(STATUS_DRQ\)\))504 3246 A
3792({)S
3876(r)S
3960(=)S
(ERR;)168 4044 A
(break;)252 4254 A
4548(})S
3375 V
(12910)210 1122 A
3465 V
(12911)210 1122 A
2112(/*)S
(Copy)168 2238 A
(bytes)210 2448 A
2700(to)S
2826(or)S
(from)168 2952 A
(the)126 3162 A
(device's)336 3330 A
(buffer.)294 3708 A
4044(*/)S
3555 V
(12912)210 1122 A
2112(if)S
(\(opcode)294 2238 A
2574(==)S
(DEV_GATHER\))462 2700 A
3204({)S
3645 V
(12913)210 1122 A
1776(if)S
(\(\(s=sys_insw\(wn->base_cmd)1050 1902 A
2994(+)S
(REG_DATA,)378 3078 A
(proc_nr,)336 3498 A
(\(void)210 3876 A
4128(*\))S
(iov->iov_addr,)588 4254 A
(SECTOR_SIZE\)\))546 4884 A
5472(!=)S
(OK\))126 5598 A
3735 V
(12914)210 1122 A
(panic\(w_name\(\),"Call)840 2112 A
2994(to)S
(sys_insw\(\))420 3120 A
(failed",)336 3582 A
(s\);)126 3960 A
3825 V
(12915)210 1122 A
2112(})S
(else)168 2196 A
2406({)S
3915 V
(12916)210 1122 A
1776(if)S
(\(\(s=sys_outsw\(wn->base_cmd)1092 1902 A
3036(+)S
(REG_DATA,)378 3120 A
(proc_nr,)336 3540 A
(\(void)210 3918 A
4170(*\))S
(iov->iov_addr,)588 4296 A
(SECTOR_SIZE\)\))546 4926 A
5514(!=)S
(OK\))126 5640 A
4005 V
(12917)210 1122 A
(panic\(w_name\(\),"Call)840 2112 A
2994(to)S
(sys_insw\(\))420 3120 A
(failed",)336 3582 A
(s\);)126 3960 A
4095 V
(12918)210 1122 A
4185 V
(12919)210 1122 A
2448(/*)S
(Data)168 2574 A
(sent,)210 2784 A
(wait)168 3036 A
(for)126 3246 A
3414(an)S
(interrupt.)420 3540 A
4002(*/)S
4275 V
(12920)210 1122 A
2448(if)S
(\(\(r)126 2574 A
2742(=)S
(at_intr_wait\(\)\))630 2826 A
3498(!=)S
(OK\))126 3624 A
(break;)252 3792 A
4365 V
(12921)210 1122 A
2112(})S
4455 V
(12922)210 1122 A
4545 V
(12923)210 1122 A
2112(/*)S
(Book)168 2238 A
(the)126 2448 A
(bytes)210 2616 A
(successfully)504 2868 A
(transferred.)504 3414 A
3960(*/)S
4635 V
(12924)210 1122 A
(nbytes)252 2112 A
2406(-=)S
(SECTOR_SIZE;)504 2532 A
4725 V
(12925)210 1122 A
(position)336 2112 A
2490(+=)S
(SECTOR_SIZE;)504 2616 A
4815 V
(12926)210 1122 A
(iov->iov_addr)546 2112 A
2700(+=)S
(SECTOR_SIZE;)504 2826 A
4905 V
(12927)210 1122 A
2112(if)S
(\(\(iov->iov_size)630 2238 A
2910(-=)S
(SECTOR_SIZE\))504 3036 A
3582(==)S
3708(0\))S
3834({)S
(iov++;)252 3918 A
(nr_req--;)378 4212 A
4632(})S
4995 V
(12928)210 1122 A
1776(})S
5085 V
(12929)210 1122 A
5175 V
(12930)210 1122 A
1776(/*)S
(Any)126 1902 A
(errors?)294 2070 A
2406(*/)S
5265 V
(12931)210 1122 A
1776(if)S
1902(\(r)S
2028(!=)S
(OK\))126 2154 A
2322({)S
5355 V
(12932)210 1122 A
2112(/*)S
(Don't)210 2238 A
(retry)210 2490 A
2742(if)S
(sector)252 2868 A
(marked)252 3162 A
(bad)126 3456 A
3624(or)S
(too)126 3750 A
(many)168 3918 A
(errors.)294 4128 A
4464(*/)S
5445 V
(12933)210 1122 A
2112(if)S
2238(\(r)S
2364(==)S
(ERR_BAD_SECTOR)588 2490 A
3120(||)S
(++errors)336 3246 A
3624(==)S
(max_errors\))462 3750 A
4254({)S
5535 V
(12934)210 1122 A
(w_command)378 2448 A
2868(=)S
(CMD_IDLE;)378 2952 A
5625 V
(12935)210 1122 A
(return\(EIO\);)504 2448 A
5715 V
(12936)210 1122 A
2112(})S
5805 V
(12937)210 1122 A
1776(})S
5895 V
(12938)210 1122 A
1524(})S
5985 V
(12939)210 1122 A
6075 V
(12940)210 1122 A
(w_command)378 1524 A
1944(=)S
(CMD_IDLE;)378 2028 A
6165 V
(12941)210 1122 A
(return\(OK\);)462 1524 A
6255 V
(12942)210 1122 A
1440(})S
6435 V
(12944)210 1122 A
(/*===========================================================================*)3276 1440 A
6525 V
(12945)210 1122 A
1482(*)S
(com_out)294 2784 A
4674(*)S
6615 V
(12946)210 1122 A
(*===========================================================================*/)3276 1482 A
6705 V
(12947)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(com_out\(cmd\))504 1944 A
6795 V
(12948)210 1122 A
(struct)252 1440 A
(command)294 1734 A
(*cmd;)210 2070 A
2784(/*)S
(Command)294 2910 A
(block)210 3246 A
3498(*/)S
6885 V
(12949)210 1122 A
1440({)S
6975 V
(12950)210 1122 A
1440(/*)S
(Output)252 1566 A
(the)126 1860 A
(command)294 2028 A
(block)210 2364 A
2616(to)S
(the)126 2742 A
(winchester)420 2910 A
(controller)420 3372 A
(and)126 3834 A
(return)252 4002 A
(status)252 4296 A
4590(*/)S
7065 V
(12951)210 1122 A
8418 V
EP
%%Page: 164 164
BP
/slant 0 def
/height 0 def
1485 V
12 B
(164)180 1080 A
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(12952)210 1122 A
(struct)252 1524 A
(wini)168 1818 A
(*wn)126 2028 A
2196(=)S
(w_wn;)210 2280 A
1845 V
(12953)210 1122 A
(unsigned)336 1524 A
(base_cmd)336 1902 A
2280(=)S
(wn->base_cmd;)546 2364 A
1935 V
(12954)210 1122 A
(unsigned)336 1524 A
(base_ctl)336 1902 A
2280(=)S
(wn->base_ctl;)546 2364 A
2025 V
(12955)210 1122 A
(pvb_pair_t)420 1524 A
(outbyte[7];)462 1986 A
3120(/*)S
(vector)252 3246 A
(for)126 3540 A
(sys_voutb\(\))462 3708 A
4212(*/)S
2115 V
(12956)210 1122 A
(int)126 1524 A
1692(s;)S
3120(/*)S
(status)252 3246 A
(for)126 3540 A
(sys_\(v\)outb\(\))546 3708 A
4296(*/)S
2205 V
(12957)210 1122 A
2295 V
(12958)210 1122 A
1524(if)S
(\(w_wn->state)504 1650 A
2196(&)S
(IGNORING\))378 2280 A
(return)252 2700 A
(ERR;)168 2994 A
2385 V
(12959)210 1122 A
2475 V
(12960)210 1122 A
1524(if)S
(\(!w_waitfor\(STATUS_BSY,)966 1650 A
(0\)\))126 2658 A
2826({)S
2565 V
(12961)210 1122 A
(printf\("%s:)462 1776 A
(controller)420 2280 A
(not)126 2742 A
(ready\\n",)378 2910 A
(w_name\(\)\);)420 3330 A
2655 V
(12962)210 1122 A
(return\(ERR\);)504 1776 A
2745 V
(12963)210 1122 A
1524(})S
2835 V
(12964)210 1122 A
2925 V
(12965)210 1122 A
1524(/*)S
(Select)252 1650 A
(drive.)252 1944 A
2238(*/)S
3015 V
(12966)210 1122 A
1524(if)S
(\(\(s=sys_outb\(base_cmd)882 1650 A
2574(+)S
(REG_LDH,)336 2658 A
(cmd->ldh\)\))420 3036 A
3498(!=)S
(OK\))126 3624 A
3105 V
(12967)210 1122 A
(panic\(w_name\(\),"Couldn't)1008 1776 A
(write)210 2826 A
(register)336 3078 A
3456(to)S
(select)252 3582 A
(drive",s\);)420 3876 A
3195 V
(12968)210 1122 A
3285 V
(12969)210 1122 A
1524(if)S
(\(!w_waitfor\(STATUS_BSY,)966 1650 A
(0\)\))126 2658 A
2826({)S
3375 V
(12970)210 1122 A
(printf\("%s:)462 1776 A
(com_out:)336 2280 A
(drive)210 2658 A
(not)126 2910 A
(ready\\n",)378 3078 A
(w_name\(\)\);)420 3498 A
3465 V
(12971)210 1122 A
(return\(ERR\);)504 1776 A
3555 V
(12972)210 1122 A
1524(})S
3645 V
(12973)210 1122 A
3735 V
(12974)210 1122 A
1524(/*)S
(Schedule)336 1650 A
2028(a)S
(wakeup)252 2112 A
(call,)210 2406 A
(some)168 2658 A
(controllers)462 2868 A
(are)126 3372 A
(flaky.)252 3540 A
(This)168 3834 A
4044(is)S
(done)168 4170 A
(with)168 4380 A
3825 V
(12975)210 1122 A
1566(*)S
1650(a)S
(synchronous)462 1734 A
(alarm.)252 2238 A
2532(If)S
2658(a)S
(timeout)294 2742 A
(occurs)252 3078 A
3372(a)S
(SYN_ALARM)378 3456 A
(message)294 3876 A
4212(is)S
(sent)168 4338 A
3915 V
(12976)210 1122 A
1566(*)S
(from)168 1650 A
(HARDWARE,)378 1860 A
2280(so)S
(that)168 2406 A
(w_intr_wait\(\))546 2616 A
(can)126 3204 A
(call)168 3372 A
(w_timeout\(\))462 3582 A
4086(in)S
(case)168 4212 A
(the)126 4422 A
4005 V
(12977)210 1122 A
1566(*)S
(controller)420 1650 A
(was)126 2112 A
(not)126 2280 A
(able)168 2448 A
2658(to)S
(execute)294 2784 A
(the)126 3120 A
(command.)336 3288 A
(Leftover)336 3666 A
(timeouts)336 4044 A
(are)126 4422 A
4095 V
(12978)210 1122 A
1566(*)S
(simply)252 1650 A
(ignored)294 1944 A
2280(by)S
(the)126 2406 A
(main)168 2574 A
(loop.)210 2784 A
4185 V
(12979)210 1122 A
1566(*/)S
4275 V
(12980)210 1122 A
(sys_setalarm\(wakeup_ticks,)1092 1524 A
(0\);)126 2658 A
4365 V
(12981)210 1122 A
4455 V
(12982)210 1122 A
(wn->w_status)504 1524 A
2070(=)S
(STATUS_ADMBSY;)588 2154 A
4545 V
(12983)210 1122 A
(w_command)378 1524 A
1944(=)S
(cmd->command;)546 2028 A
4635 V
(12984)210 1122 A
(pv_set\(outbyte[0],)756 1524 A
(base_ctl)336 2322 A
2700(+)S
(REG_CTL,)336 2784 A
(wn->pheads)420 3162 A
3624(>=)S
3750(8)S
3834(?)S
(CTL_EIGHTHEADS)588 3918 A
4548(:)S
(0\);)126 4632 A
4725 V
(12985)210 1122 A
(pv_set\(outbyte[1],)756 1524 A
(base_cmd)336 2322 A
2700(+)S
(REG_PRECOMP,)504 2784 A
(cmd->precomp\);)588 3330 A
4815 V
(12986)210 1122 A
(pv_set\(outbyte[2],)756 1524 A
(base_cmd)336 2322 A
2700(+)S
(REG_COUNT,)420 2784 A
(cmd->count\);)504 3246 A
4905 V
(12987)210 1122 A
(pv_set\(outbyte[3],)756 1524 A
(base_cmd)336 2322 A
2700(+)S
(REG_SECTOR,)462 2784 A
(cmd->sector\);)546 3288 A
4995 V
(12988)210 1122 A
(pv_set\(outbyte[4],)756 1524 A
(base_cmd)336 2322 A
2700(+)S
(REG_CYL_LO,)462 2784 A
(cmd->cyl_lo\);)546 3288 A
5085 V
(12989)210 1122 A
(pv_set\(outbyte[5],)756 1524 A
(base_cmd)336 2322 A
2700(+)S
(REG_CYL_HI,)462 2784 A
(cmd->cyl_hi\);)546 3288 A
5175 V
(12990)210 1122 A
(pv_set\(outbyte[6],)756 1524 A
(base_cmd)336 2322 A
2700(+)S
(REG_COMMAND,)504 2784 A
(cmd->command\);)588 3330 A
5265 V
(12991)210 1122 A
1524(if)S
(\(\(s=sys_voutb\(outbyte,7\)\))1050 1650 A
2742(!=)S
(OK\))126 2868 A
5355 V
(12992)210 1122 A
(panic\(w_name\(\),"Couldn't)1008 1776 A
(write)210 2826 A
(registers)378 3078 A
(with)168 3498 A
(sys_voutb\(\)",s\);)672 3708 A
5445 V
(12993)210 1122 A
(return\(OK\);)462 1524 A
5535 V
(12994)210 1122 A
1440(})S
5715 V
(12996)210 1122 A
(/*===========================================================================*)3276 1440 A
5805 V
(12997)210 1122 A
1482(*)S
(w_need_reset)504 2784 A
4674(*)S
5895 V
(12998)210 1122 A
(*===========================================================================*/)3276 1482 A
5985 V
(12999)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(w_need_reset\(\))588 1986 A
6075 V
(13000)210 1122 A
1440({)S
6165 V
(13001)210 1122 A
1440(/*)S
(The)126 1566 A
(controller)420 1734 A
(needs)210 2196 A
2448(to)S
2574(be)S
(reset.)252 2700 A
2994(*/)S
6255 V
(13002)210 1122 A
(struct)252 1524 A
(wini)168 1818 A
(*wn;)168 2028 A
6345 V
(13003)210 1122 A
(int)126 1524 A
1692(dr)S
1818(=)S
1902(0;)S
6435 V
(13004)210 1122 A
6525 V
(13005)210 1122 A
(for)126 1524 A
(\(wn)126 1692 A
1860(=)S
(wini;)210 1944 A
2196(wn)S
2322(<)S
(&wini[MAX_DRIVES];)756 2406 A
(wn++,)210 3204 A
(dr++\))210 3456 A
3708({)S
6615 V
(13006)210 1122 A
1776(if)S
(\(wn->base_cmd)546 1902 A
2490(==)S
(w_wn->base_cmd\))630 2616 A
3288({)S
6705 V
(13007)210 1122 A
(wn->state)378 2112 A
2532(|=)S
(DEAF;)210 2658 A
6795 V
(13008)210 1122 A
(wn->state)378 2112 A
2532(&=)S
(\304INITIALIZED;)546 2658 A
6885 V
(13009)210 1122 A
1776(})S
6975 V
(13010)210 1122 A
1524(})S
7065 V
(13011)210 1122 A
1440(})S
8418 V
EP
%%Page: 165 165
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
12 B
(165)180 4500 A
1845 V
7 LST
(13013)210 1122 A
(/*===========================================================================*)3276 1440 A
1935 V
(13014)210 1122 A
1482(*)S
(w_do_close)420 2784 A
4674(*)S
2025 V
(13015)210 1122 A
(*===========================================================================*/)3276 1482 A
2115 V
(13016)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_do_close\(dp,)588 1944 A
(m_ptr\))252 2574 A
2205 V
(13017)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dp;)168 2028 A
2295 V
(13018)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
2385 V
(13019)210 1122 A
1440({)S
2475 V
(13020)210 1122 A
1440(/*)S
(Device)252 1566 A
(close:)252 1860 A
(Release)294 2154 A
2490(a)S
(device.)294 2574 A
2910(*/)S
2565 V
(13021)210 1122 A
1524(if)S
(\(w_prepare\(m_ptr->DEVICE\))1050 1650 A
2742(==)S
(NIL_DEV\))336 2868 A
2655 V
(13022)210 1122 A
(return\(ENXIO\);)588 1776 A
2745 V
(13023)210 1122 A
(w_wn->open_ct--;)672 1524 A
2835 V
(13024)210 1122 A
(return\(OK\);)462 1524 A
2925 V
(13025)210 1122 A
1440(})S
3105 V
(13027)210 1122 A
(/*===========================================================================*)3276 1440 A
3195 V
(13028)210 1122 A
1482(*)S
(com_simple)420 2784 A
4674(*)S
3285 V
(13029)210 1122 A
(*===========================================================================*/)3276 1482 A
3375 V
(13030)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(com_simple\(cmd\))630 1944 A
3465 V
(13031)210 1122 A
(struct)252 1440 A
(command)294 1734 A
(*cmd;)210 2070 A
2784(/*)S
(Command)294 2910 A
(block)210 3246 A
3498(*/)S
3555 V
(13032)210 1122 A
1440({)S
3645 V
(13033)210 1122 A
1440(/*)S
1566(A)S
(simple)252 1650 A
(controller)420 1944 A
(command,)336 2406 A
(only)168 2784 A
(one)126 2994 A
(interrupt)378 3162 A
(and)126 3582 A
3750(no)S
(data-out)336 3876 A
(phase.)252 4254 A
4548(*/)S
3735 V
(13034)210 1122 A
(int)126 1524 A
1692(r;)S
3825 V
(13035)210 1122 A
3915 V
(13036)210 1122 A
1524(if)S
(\(w_wn->state)504 1650 A
2196(&)S
(IGNORING\))378 2280 A
(return)252 2700 A
(ERR;)168 2994 A
4005 V
(13037)210 1122 A
4095 V
(13038)210 1122 A
1524(if)S
(\(\(r)126 1650 A
1818(=)S
(com_out\(cmd\)\))546 1902 A
2490(==)S
(OK\))126 2616 A
2784(r)S
2868(=)S
(at_intr_wait\(\);)630 2952 A
4185 V
(13039)210 1122 A
(w_command)378 1524 A
1944(=)S
(CMD_IDLE;)378 2028 A
4275 V
(13040)210 1122 A
(return\(r\);)420 1524 A
4365 V
(13041)210 1122 A
1440(})S
4545 V
(13043)210 1122 A
(/*===========================================================================*)3276 1440 A
4635 V
(13044)210 1122 A
1482(*)S
(w_timeout)378 2784 A
4674(*)S
4725 V
(13045)210 1122 A
(*===========================================================================*/)3276 1482 A
4815 V
(13046)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(w_timeout\(void\))630 1986 A
4905 V
(13047)210 1122 A
1440({)S
4995 V
(13048)210 1122 A
(struct)252 1524 A
(wini)168 1818 A
(*wn)126 2028 A
2196(=)S
(w_wn;)210 2280 A
5085 V
(13049)210 1122 A
5175 V
(13050)210 1122 A
(switch)252 1524 A
(\(w_command\))462 1818 A
2322({)S
5265 V
(13051)210 1122 A
(case)168 1524 A
(CMD_IDLE:)378 1734 A
5355 V
(13052)210 1122 A
(break;)252 1776 A
2448(/*)S
(fine)168 2574 A
2784(*/)S
5445 V
(13053)210 1122 A
(case)168 1524 A
(CMD_READ:)378 1734 A
5535 V
(13054)210 1122 A
(case)168 1524 A
(CMD_WRITE:)420 1734 A
5625 V
(13055)210 1122 A
1776(/*)S
(Impossible,)462 1902 A
(but)126 2406 A
(not)126 2574 A
2742(on)S
(PC's:)210 2868 A
(The)126 3162 A
(controller)420 3330 A
(does)168 3792 A
(not)126 4002 A
(respond.)336 4170 A
4548(*/)S
5715 V
(13056)210 1122 A
5805 V
(13057)210 1122 A
1776(/*)S
(Limiting)336 1902 A
(multisector)462 2280 A
(I/O)126 2784 A
(seems)210 2952 A
3204(to)S
(help.)210 3330 A
3582(*/)S
5895 V
(13058)210 1122 A
1776(if)S
(\(wn->max_count)588 1902 A
2532(>)S
2616(8)S
2700(*)S
(SECTOR_SIZE\))504 2784 A
3330({)S
5985 V
(13059)210 1122 A
(wn->max_count)546 2112 A
2700(=)S
2784(8)S
2868(*)S
(SECTOR_SIZE;)504 2952 A
6075 V
(13060)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
6165 V
(13061)210 1122 A
(wn->max_count)546 2112 A
2700(=)S
(SECTOR_SIZE;)504 2784 A
6255 V
(13062)210 1122 A
1776(})S
6345 V
(13063)210 1122 A
(/*FALL)252 1776 A
(THROUGH*/)378 2070 A
6435 V
(13064)210 1122 A
(default:)336 1524 A
6525 V
(13065)210 1122 A
1776(/*)S
(Some)168 1902 A
(other)210 2112 A
(command.)336 2364 A
2742(*/)S
6615 V
(13066)210 1122 A
1776(if)S
(\(w_testing\))462 1902 A
(wn->state)378 2448 A
2868(|=)S
(IGNORING;)378 2994 A
3456(/*)S
(Kick)168 3582 A
(out)126 3792 A
(this)168 3960 A
(drive.)252 4170 A
4464(*/)S
6705 V
(13067)210 1122 A
(else)168 1776 A
1986(if)S
(\(!w_silent\))462 2112 A
(printf\("%s:)462 2616 A
(timeout)294 3120 A
3456(on)S
(command)294 3582 A
(%02x\\n",)336 3918 A
(w_name\(\),)378 4296 A
(w_command\);)462 4716 A
6795 V
(13068)210 1122 A
(w_need_reset\(\);)630 1776 A
6885 V
(13069)210 1122 A
(wn->w_status)504 1776 A
2322(=)S
2406(0;)S
6975 V
(13070)210 1122 A
1524(})S
7065 V
(13071)210 1122 A
1440(})S
8418 V
EP
%%Page: 166 166
BP
/slant 0 def
/height 0 def
1485 V
12 B
(166)180 1080 A
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1845 V
7 LST
(13073)210 1122 A
(/*===========================================================================*)3276 1440 A
1935 V
(13074)210 1122 A
1482(*)S
(w_reset)294 2784 A
4674(*)S
2025 V
(13075)210 1122 A
(*===========================================================================*/)3276 1482 A
2115 V
(13076)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_reset\(\))378 1944 A
2205 V
(13077)210 1122 A
1440({)S
2295 V
(13078)210 1122 A
1440(/*)S
(Issue)210 1566 A
1818(a)S
(reset)210 1902 A
2154(to)S
(the)126 2280 A
(controller.)462 2448 A
(This)168 2994 A
3204(is)S
(done)168 3330 A
(after)210 3540 A
(any)126 3792 A
(catastrophe,)504 3960 A
2385 V
(13079)210 1122 A
1482(*)S
(like)168 1566 A
(the)126 1776 A
(controller)420 1944 A
(refusing)336 2406 A
2784(to)S
(respond.)336 2910 A
2475 V
(13080)210 1122 A
1482(*/)S
2565 V
(13081)210 1122 A
(int)126 1524 A
1692(s;)S
2655 V
(13082)210 1122 A
(struct)252 1524 A
(wini)168 1818 A
(*wn)126 2028 A
2196(=)S
(w_wn;)210 2280 A
2745 V
(13083)210 1122 A
2835 V
(13084)210 1122 A
1524(/*)S
(Don't)210 1650 A
(bother)252 1902 A
2196(if)S
(this)168 2322 A
(drive)210 2532 A
2784(is)S
(forgotten.)420 2910 A
3372(*/)S
2925 V
(13085)210 1122 A
1524(if)S
(\(w_wn->state)504 1650 A
2196(&)S
(IGNORING\))378 2280 A
(return)252 2700 A
(ERR;)168 2994 A
3015 V
(13086)210 1122 A
3105 V
(13087)210 1122 A
1524(/*)S
(Wait)168 1650 A
(for)126 1860 A
(any)126 2028 A
(internal)336 2196 A
(drive)210 2574 A
(recovery.)378 2826 A
3246(*/)S
3195 V
(13088)210 1122 A
(tickdelay\(RECOVERY_TICKS\);)1092 1524 A
3285 V
(13089)210 1122 A
3375 V
(13090)210 1122 A
1524(/*)S
(Strobe)252 1650 A
(reset)210 1944 A
(bit)126 2196 A
2364(*/)S
3465 V
(13091)210 1122 A
1524(if)S
(\(\(s=sys_outb\(wn->base_ctl)1050 1650 A
2742(+)S
(REG_CTL,)336 2826 A
(CTL_RESET\)\))462 3204 A
3708(!=)S
(OK\))126 3834 A
3555 V
(13092)210 1122 A
(panic\(w_name\(\),"Couldn't)1008 1776 A
(strobe)252 2826 A
(reset)210 3120 A
(bit",s\);)336 3372 A
3645 V
(13093)210 1122 A
(tickdelay\(DELAY_TICKS\);)966 1524 A
3735 V
(13094)210 1122 A
1524(if)S
(\(\(s=sys_outb\(wn->base_ctl)1050 1650 A
2742(+)S
(REG_CTL,)336 2826 A
(0\)\))126 3204 A
3372(!=)S
(OK\))126 3498 A
3825 V
(13095)210 1122 A
(panic\(w_name\(\),"Couldn't)1008 1776 A
(strobe)252 2826 A
(reset)210 3120 A
(bit",s\);)336 3372 A
3915 V
(13096)210 1122 A
(tickdelay\(DELAY_TICKS\);)966 1524 A
4005 V
(13097)210 1122 A
4095 V
(13098)210 1122 A
1524(/*)S
(Wait)168 1650 A
(for)126 1860 A
(controller)420 2028 A
(ready)210 2490 A
2742(*/)S
4185 V
(13099)210 1122 A
1524(if)S
(\(!w_waitfor\(STATUS_BSY,)966 1650 A
(0\)\))126 2658 A
2826({)S
4275 V
(13100)210 1122 A
(printf\("%s:)462 1776 A
(reset)210 2280 A
(failed,)294 2532 A
(drive)210 2868 A
(busy\\n",)336 3120 A
(w_name\(\)\);)420 3498 A
4365 V
(13101)210 1122 A
(return\(ERR\);)504 1776 A
4455 V
(13102)210 1122 A
1524(})S
4545 V
(13103)210 1122 A
4635 V
(13104)210 1122 A
1524(/*)S
(The)126 1650 A
(error)210 1818 A
(register)336 2070 A
(should)252 2448 A
2742(be)S
(checked)294 2868 A
(now,)168 3204 A
(but)126 3414 A
(some)168 3582 A
(drives)252 3792 A
(mess)168 4086 A
4296(it)S
(up.)126 4422 A
4590(*/)S
4725 V
(13105)210 1122 A
4815 V
(13106)210 1122 A
(for)126 1524 A
(\(wn)126 1692 A
1860(=)S
(wini;)210 1944 A
2196(wn)S
2322(<)S
(&wini[MAX_DRIVES];)756 2406 A
(wn++\))210 3204 A
3456({)S
4905 V
(13107)210 1122 A
1776(if)S
(\(wn->base_cmd)546 1902 A
2490(==)S
(w_wn->base_cmd\))630 2616 A
3288({)S
4995 V
(13108)210 1122 A
(wn->state)378 2112 A
2532(&=)S
(\304DEAF;)252 2658 A
5085 V
(13109)210 1122 A
2112(if)S
(\(w_wn->irq_need_ack\))840 2238 A
3120({)S
5175 V
(13110)210 1122 A
2448(/*)S
(Make)168 2574 A
(sure)168 2784 A
(irq)126 2994 A
3162(is)S
(actually)336 3288 A
(enabled..)378 3666 A
4086(*/)S
5265 V
(13111)210 1122 A
(sys_irqenable\(&w_wn->irq_hook_id\);)1428 2448 A
5355 V
(13112)210 1122 A
2112(})S
5445 V
(13113)210 1122 A
1776(})S
5535 V
(13114)210 1122 A
1524(})S
5625 V
(13115)210 1122 A
5715 V
(13116)210 1122 A
5805 V
(13117)210 1122 A
(return\(OK\);)462 1524 A
5895 V
(13118)210 1122 A
1440(})S
6075 V
(13120)210 1122 A
(/*===========================================================================*)3276 1440 A
6165 V
(13121)210 1122 A
1482(*)S
(w_intr_wait)462 2784 A
4674(*)S
6255 V
(13122)210 1122 A
(*===========================================================================*/)3276 1482 A
6345 V
(13123)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(w_intr_wait\(\))546 1986 A
6435 V
(13124)210 1122 A
1440({)S
6525 V
(13125)210 1122 A
1440(/*)S
(Wait)168 1566 A
(for)126 1776 A
1944(a)S
(task)168 2028 A
(completion)420 2238 A
(interrupt.)420 2700 A
3162(*/)S
6615 V
(13126)210 1122 A
6705 V
(13127)210 1122 A
(message)294 1524 A
1860(m;)S
6795 V
(13128)210 1122 A
6885 V
(13129)210 1122 A
1524(if)S
(\(w_wn->irq)420 1650 A
2112(!=)S
(NO_IRQ\))294 2238 A
2574({)S
6975 V
(13130)210 1122 A
1776(/*)S
(Wait)168 1902 A
(for)126 2112 A
2280(an)S
(interrupt)378 2406 A
(that)168 2826 A
(sets)168 3036 A
(w_status)336 3246 A
3624(to)S
("not)168 3750 A
(busy".)252 3960 A
4254(*/)S
7065 V
(13131)210 1122 A
(while)210 1776 A
(\(w_wn->w_status)630 2028 A
2700(&)S
(\(STATUS_ADMBSY|STATUS_BSY\)\))1134 2784 A
3960({)S
8418 V
EP
%%Page: 167 167
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
12 B
(167)180 4500 A
1755 V
7 LST
(13132)210 1122 A
(receive\(ANY,)504 2112 A
(&m\);)168 2658 A
3456(/*)S
(expect)252 3582 A
(HARD_INT)336 3876 A
(message)294 4254 A
4590(*/)S
1845 V
(13133)210 1122 A
2112(if)S
(\(m.m_type)378 2238 A
2658(==)S
(SYN_ALARM\))420 2784 A
3246({)S
3456(/*)S
(but)126 3582 A
(check)210 3750 A
(for)126 4002 A
(timeout)294 4170 A
4506(*/)S
1935 V
(13134)210 1122 A
(w_timeout\(\);)504 2280 A
3456(/*)S
(a.o.)168 3582 A
(set)126 3792 A
(w_status)336 3960 A
4338(*/)S
2025 V
(13135)210 1122 A
2112(})S
(else)168 2196 A
2406(if)S
(\(m.m_type)378 2532 A
2952(==)S
(HARD_INT\))378 3078 A
3498({)S
2115 V
(13136)210 1122 A
(sys_inb\(w_wn->base_cmd)924 2280 A
3246(+)S
(REG_STATUS,)462 3330 A
(&w_wn->w_status\);)714 3834 A
2205 V
(13137)210 1122 A
(ack_irqs\(m.NOTIFY_ARG\);)966 2280 A
2295 V
(13138)210 1122 A
2112(})S
(else)168 2196 A
2406({)S
2385 V
(13139)210 1122 A
(printf\("AT_WINI)630 2448 A
(got)126 3120 A
(unexpected)420 3288 A
(message)294 3750 A
4086(%d)S
(from)168 4212 A
(%d\\n",)252 4422 A
2475 V
(13140)210 1122 A
(m.m_type,)378 2784 A
(m.m_source\);)504 3204 A
2565 V
(13141)210 1122 A
2112(})S
2655 V
(13142)210 1122 A
1776(})S
2745 V
(13143)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
2835 V
(13144)210 1122 A
1776(/*)S
(Interrupt)378 1902 A
(not)126 2322 A
(yet)126 2490 A
(allocated;)420 2658 A
(use)126 3120 A
(polling.)336 3288 A
3666(*/)S
2925 V
(13145)210 1122 A
(\(void\))252 1776 A
(w_waitfor\(STATUS_BSY,)882 2070 A
(0\);)126 2994 A
3015 V
(13146)210 1122 A
1524(})S
3105 V
(13147)210 1122 A
1440(})S
3285 V
(13149)210 1122 A
(/*===========================================================================*)3276 1440 A
3375 V
(13150)210 1122 A
1482(*)S
(at_intr_wait)504 2784 A
4674(*)S
3465 V
(13151)210 1122 A
(*===========================================================================*/)3276 1482 A
3555 V
(13152)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(at_intr_wait\(\))588 1944 A
3645 V
(13153)210 1122 A
1440({)S
3735 V
(13154)210 1122 A
1440(/*)S
(Wait)168 1566 A
(for)126 1776 A
1944(an)S
(interrupt,)420 2070 A
(study)210 2532 A
(the)126 2784 A
(status)252 2952 A
(bits)168 3246 A
(and)126 3456 A
(return)252 3624 A
(error/success.)588 3918 A
4548(*/)S
3825 V
(13155)210 1122 A
(int)126 1524 A
1692(r;)S
3915 V
(13156)210 1122 A
(int)126 1524 A
(s,inbval;)378 1692 A
2448(/*)S
(read)168 2574 A
(value)210 2784 A
(with)168 3036 A
(sys_inb)294 3246 A
3582(*/)S
4005 V
(13157)210 1122 A
4095 V
(13158)210 1122 A
(w_intr_wait\(\);)588 1524 A
4185 V
(13159)210 1122 A
1524(if)S
(\(\(w_wn->w_status)672 1650 A
2364(&)S
(\(STATUS_BSY)462 2448 A
2952(|)S
(STATUS_WF)378 3036 A
3456(|)S
(STATUS_ERR\)\))504 3540 A
4086(==)S
4212(0\))S
4338({)S
4275 V
(13160)210 1122 A
1776(r)S
1860(=)S
(OK;)126 1944 A
4365 V
(13161)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
4455 V
(13162)210 1122 A
1776(if)S
(\(\(s=sys_inb\(w_wn->base_cmd)1092 1902 A
3036(+)S
(REG_ERROR,)420 3120 A
(&inbval\)\))378 3582 A
4002(!=)S
(OK\))126 4128 A
4545 V
(13163)210 1122 A
(panic\(w_name\(\),"Couldn't)1008 2112 A
(read)168 3162 A
(register",s\);)546 3372 A
4635 V
(13164)210 1122 A
1776(if)S
(\(\(w_wn->w_status)672 1902 A
2616(&)S
(STATUS_ERR\))462 2700 A
3204(&&)S
(\(inbval)294 3330 A
3666(&)S
(ERROR_BB\)\))420 3750 A
4212({)S
4725 V
(13165)210 1122 A
2112(r)S
2196(=)S
(ERR_BAD_SECTOR;)630 2280 A
3120(/*)S
(sector)252 3246 A
(marked)252 3540 A
(bad,)168 3834 A
(retries)294 4044 A
(won't)210 4380 A
(help)168 4632 A
4842(*/)S
4815 V
(13166)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
4905 V
(13167)210 1122 A
2112(r)S
2196(=)S
(ERR;)168 2280 A
3120(/*)S
(any)126 3246 A
(other)210 3414 A
(error)210 3666 A
3918(*/)S
4995 V
(13168)210 1122 A
1776(})S
5085 V
(13169)210 1122 A
1524(})S
5175 V
(13170)210 1122 A
(w_wn->w_status)588 1524 A
2154(|=)S
(STATUS_ADMBSY;)588 2280 A
3120(/*)S
(assume)252 3246 A
(still)210 3540 A
(busy)168 3792 A
(with)168 4002 A
(I/O)126 4212 A
4380(*/)S
5265 V
(13171)210 1122 A
(return\(r\);)420 1524 A
5355 V
(13172)210 1122 A
1440(})S
5535 V
(13174)210 1122 A
(/*===========================================================================*)3276 1440 A
5625 V
(13175)210 1122 A
1482(*)S
(w_waitfor)378 2784 A
4674(*)S
5715 V
(13176)210 1122 A
(*===========================================================================*/)3276 1482 A
5805 V
(13177)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_waitfor\(mask,)630 1944 A
(value\))252 2616 A
5895 V
(13178)210 1122 A
(int)126 1440 A
(mask;)210 1608 A
2784(/*)S
(status)252 2910 A
(mask)168 3204 A
3414(*/)S
5985 V
(13179)210 1122 A
(int)126 1440 A
(value;)252 1608 A
2784(/*)S
(required)336 2910 A
(status)252 3288 A
3582(*/)S
6075 V
(13180)210 1122 A
1440({)S
6165 V
(13181)210 1122 A
1440(/*)S
(Wait)168 1566 A
(until)210 1776 A
(controller)420 2028 A
2490(is)S
2616(in)S
(the)126 2742 A
(required)336 2910 A
(state.)252 3288 A
(Return)252 3624 A
(zero)168 3918 A
4128(on)S
(timeout.)336 4254 A
6255 V
(13182)210 1122 A
1482(*)S
1566(An)S
(alarm)210 1692 A
(that)168 1944 A
(set)126 2154 A
2322(a)S
(timeout)294 2406 A
(flag)168 2742 A
2952(is)S
(used.)210 3078 A
(TIMEOUT)294 3330 A
3666(is)S
3792(in)S
(micros,)294 3918 A
4254(we)S
(need)168 4380 A
6345 V
(13183)210 1122 A
1482(*)S
(ticks.)252 1566 A
(Disabling)378 1860 A
(the)126 2280 A
(alarm)210 2448 A
2700(is)S
(not)126 2826 A
(needed,)294 2994 A
(because)294 3330 A
3666(a)S
(static)252 3750 A
(flag)168 4044 A
4254(is)S
(used)168 4380 A
6435 V
(13184)210 1122 A
1482(*)S
(and)126 1566 A
1734(a)S
(leftover)336 1818 A
(timeout)294 2196 A
(cannot)252 2532 A
2826(do)S
(any)126 2952 A
(harm.)210 3120 A
6525 V
(13185)210 1122 A
1482(*/)S
6615 V
(13186)210 1122 A
(clock_t)294 1524 A
(t0,)126 1860 A
(t1;)126 2028 A
6705 V
(13187)210 1122 A
(int)126 1524 A
1692(s;)S
6795 V
(13188)210 1122 A
(getuptime\(&t0\);)630 1524 A
6885 V
(13189)210 1122 A
1524(do)S
1650({)S
6975 V
(13190)210 1122 A
1776(if)S
(\(\(s=sys_inb\(w_wn->base_cmd)1092 1902 A
3036(+)S
(REG_STATUS,)462 3120 A
(&w_wn->w_status\)\))714 3624 A
4380(!=)S
(OK\))126 4506 A
7065 V
(13191)210 1122 A
(panic\(w_name\(\),"Couldn't)1008 2112 A
(read)168 3162 A
(register",s\);)546 3372 A
8418 V
EP
%%Page: 168 168
BP
/slant 0 def
/height 0 def
1485 V
12 B
(168)180 1080 A
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(13192)210 1122 A
1776(if)S
(\(\(w_wn->w_status)672 1902 A
2616(&)S
(mask\))210 2700 A
2952(==)S
(value\))252 3078 A
3372({)S
1845 V
(13193)210 1122 A
(return)252 2112 A
2406(1;)S
1935 V
(13194)210 1122 A
1776(})S
2025 V
(13195)210 1122 A
1524(})S
(while)210 1608 A
(\(\(s=getuptime\(&t1\)\))798 1860 A
2700(==)S
2826(OK)S
2952(&&)S
(\(t1-t0\))294 3078 A
3414(<)S
(timeout_ticks)546 3498 A
4086(\);)S
2115 V
(13196)210 1122 A
1524(if)S
(\(OK)126 1650 A
1818(!=)S
1944(s\))S
(printf\("AT_WINI:)672 2070 A
(warning,)336 2784 A
(get_uptime)420 3162 A
(failed:)294 3624 A
(%d\\n",s\);)378 3960 A
2205 V
(13197)210 1122 A
2295 V
(13198)210 1122 A
(w_need_reset\(\);)630 1524 A
3120(/*)S
(controller)420 3246 A
(gone)168 3708 A
(deaf)168 3918 A
4128(*/)S
2385 V
(13199)210 1122 A
(return\(0\);)420 1524 A
2475 V
(13200)210 1122 A
1440(})S
2655 V
(13202)210 1122 A
(/*===========================================================================*)3276 1440 A
2745 V
(13203)210 1122 A
1482(*)S
(w_geometry)420 2784 A
4674(*)S
2835 V
(13204)210 1122 A
(*===========================================================================*/)3276 1482 A
2925 V
(13205)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(w_geometry\(entry\))714 1986 A
3015 V
(13206)210 1122 A
(struct)252 1440 A
(partition)378 1734 A
(*entry;)294 2154 A
3105 V
(13207)210 1122 A
1440({)S
3195 V
(13208)210 1122 A
(struct)252 1524 A
(wini)168 1818 A
(*wn)126 2028 A
2196(=)S
(w_wn;)210 2280 A
3285 V
(13209)210 1122 A
3375 V
(13210)210 1122 A
1524(if)S
(\(wn->state)420 1650 A
2112(&)S
(ATAPI\))252 2196 A
2490({)S
3120(/*)S
(Make)168 3246 A
3456(up)S
(some)168 3582 A
(numbers.)336 3792 A
4170(*/)S
3465 V
(13211)210 1122 A
(entry->cylinders)672 1776 A
2490(=)S
(div64u\(wn->part[0].dv_size,)1134 2574 A
(SECTOR_SIZE\))504 3750 A
4296(/)S
(\(64*32\);)336 4380 A
3555 V
(13212)210 1122 A
(entry->heads)504 1776 A
2322(=)S
(64;)126 2406 A
3645 V
(13213)210 1122 A
(entry->sectors)588 1776 A
2406(=)S
(32;)126 2490 A
3735 V
(13214)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3120(/*)S
(Return)252 3246 A
(logical)294 3540 A
(geometry.)378 3876 A
4296(*/)S
3825 V
(13215)210 1122 A
(entry->cylinders)672 1776 A
2490(=)S
(wn->lcylinders;)630 2574 A
3915 V
(13216)210 1122 A
(entry->heads)504 1776 A
2322(=)S
(wn->lheads;)462 2406 A
4005 V
(13217)210 1122 A
(entry->sectors)588 1776 A
2406(=)S
(wn->lsectors;)546 2490 A
4095 V
(13218)210 1122 A
1524(})S
4185 V
(13219)210 1122 A
1440(})S
4365 V
(13221)210 1122 A
(/*===========================================================================*)3276 1440 A
4455 V
(13222)210 1122 A
1482(*)S
(w_other)294 2784 A
4674(*)S
4545 V
(13223)210 1122 A
(*===========================================================================*/)3276 1482 A
4635 V
(13224)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_other\(dr,)462 1944 A
2448(m\))S
4725 V
(13225)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dr;)168 2028 A
4815 V
(13226)210 1122 A
(message)294 1440 A
(*m;)126 1776 A
4905 V
(13227)210 1122 A
1440({)S
4995 V
(13228)210 1122 A
(int)126 1776 A
1944(r,)S
(timeout,)336 2070 A
(prev;)210 2448 A
5085 V
(13229)210 1122 A
5175 V
(13230)210 1122 A
1776(if)S
(\(m->m_type)420 1902 A
2364(!=)S
(DEV_IOCTL)378 2490 A
2910(\))S
2994({)S
5265 V
(13231)210 1122 A
(return)252 2112 A
(EINVAL;)294 2406 A
5355 V
(13232)210 1122 A
1776(})S
5445 V
(13233)210 1122 A
5535 V
(13234)210 1122 A
1776(if)S
(\(m->REQUEST)462 1902 A
2406(==)S
(DIOCTIMEOUT\))504 2532 A
3078({)S
5625 V
(13235)210 1122 A
2112(if)S
(\(\(r=sys_datacopy\(m->PROC_NR,)1176 2238 A
(\(vir_bytes\)m->ADDRESS,)924 3456 A
5715 V
(13236)210 1122 A
(SELF,)210 2448 A
(\(vir_bytes\)&timeout,)840 2700 A
(sizeof\(timeout\)\)\))714 3582 A
4338(!=)S
(OK\))126 4464 A
5805 V
(13237)210 1122 A
(return)252 2448 A
2742(r;)S
5895 V
(13238)210 1122 A
5985 V
(13239)210 1122 A
2112(if)S
(\(timeout)336 2238 A
2616(==)S
2742(0\))S
2868({)S
6075 V
(13240)210 1122 A
2448(/*)S
(Restore)294 2574 A
(defaults.)378 2910 A
3330(*/)S
6165 V
(13241)210 1122 A
(timeout_ticks)546 2448 A
3036(=)S
(DEF_TIMEOUT_TICKS;)756 3120 A
6255 V
(13242)210 1122 A
(max_errors)420 2448 A
2910(=)S
(MAX_ERRORS;)462 2994 A
6345 V
(13243)210 1122 A
(wakeup_ticks)504 2448 A
2994(=)S
(WAKEUP;)294 3078 A
6435 V
(13244)210 1122 A
(w_silent)336 2448 A
2826(=)S
2910(0;)S
6525 V
(13245)210 1122 A
2112(})S
(else)168 2196 A
2406(if)S
(\(timeout)336 2532 A
2910(<)S
2994(0\))S
3120({)S
6615 V
(13246)210 1122 A
(return)252 2448 A
(EINVAL;)294 2742 A
6705 V
(13247)210 1122 A
2112(})S
(else)168 2196 A
2448({)S
6795 V
(13248)210 1122 A
(prev)168 2448 A
2658(=)S
(wakeup_ticks;)546 2742 A
6885 V
(13249)210 1122 A
6975 V
(13250)210 1122 A
2448(if)S
(\(!w_standard_timeouts\))924 2574 A
3540({)S
7065 V
(13251)210 1122 A
2784(/*)S
(Set)126 2910 A
(\(lower\))294 3078 A
(timeout,)336 3414 A
(lower)210 3792 A
(error)210 4044 A
8418 V
EP
%%Page: 169 169
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
12 B
(169)180 4500 A
1755 V
7 LST
(13252)210 1122 A
2826(*)S
(tolerance)378 2910 A
(and)126 3330 A
(set)126 3498 A
(silent)252 3666 A
(mode.)210 3960 A
1845 V
(13253)210 1122 A
2826(*/)S
1935 V
(13254)210 1122 A
(wakeup_ticks)504 2784 A
3330(=)S
(timeout;)336 3414 A
2025 V
(13255)210 1122 A
(max_errors)420 2784 A
3246(=)S
3330(3;)S
2115 V
(13256)210 1122 A
(w_silent)336 2784 A
3162(=)S
3246(1;)S
2205 V
(13257)210 1122 A
2295 V
(13258)210 1122 A
2784(if)S
(\(timeout_ticks)588 2910 A
3540(>)S
(timeout\))336 3624 A
2385 V
(13259)210 1122 A
(timeout_ticks)546 3120 A
3708(=)S
(timeout;)336 3792 A
2475 V
(13260)210 1122 A
2448(})S
2565 V
(13261)210 1122 A
2655 V
(13262)210 1122 A
2448(if)S
(\(\(r=sys_datacopy\(SELF,)924 2574 A
(\(vir_bytes\)&prev,)714 3540 A
2745 V
(13263)210 1122 A
(m->PROC_NR,)462 2784 A
(\(vir_bytes\)m->ADDRESS,)924 3288 A
(sizeof\(prev\)\)\))588 4254 A
4884(!=)S
(OK\))126 5010 A
2835 V
(13264)210 1122 A
(return)252 2784 A
3078(r;)S
2925 V
(13265)210 1122 A
2112(})S
3015 V
(13266)210 1122 A
3105 V
(13267)210 1122 A
(return)252 2112 A
(OK;)126 2406 A
3195 V
(13268)210 1122 A
1776(})S
(else)168 1860 A
2112(if)S
(\(m->REQUEST)462 2238 A
2742(==)S
(DIOCOPENCT\))462 2868 A
3372({)S
3285 V
(13269)210 1122 A
(int)126 2112 A
(count;)252 2280 A
3375 V
(13270)210 1122 A
2112(if)S
(\(w_prepare\(m->DEVICE\))882 2238 A
3162(==)S
(NIL_DEV\))336 3288 A
(return)252 3666 A
(ENXIO;)252 3960 A
3465 V
(13271)210 1122 A
(count)210 2112 A
2364(=)S
(w_wn->open_ct;)588 2448 A
3555 V
(13272)210 1122 A
2112(if)S
(\(\(r=sys_datacopy\(SELF,)924 2238 A
(\(vir_bytes\)&count,)756 3204 A
3645 V
(13273)210 1122 A
(m->PROC_NR,)462 2448 A
(\(vir_bytes\)m->ADDRESS,)924 2952 A
(sizeof\(count\)\)\))630 3918 A
4590(!=)S
(OK\))126 4716 A
3735 V
(13274)210 1122 A
(return)252 2448 A
2742(r;)S
3825 V
(13275)210 1122 A
(return)252 2112 A
(OK;)126 2406 A
3915 V
(13276)210 1122 A
1776(})S
4005 V
(13277)210 1122 A
(return)252 1776 A
(EINVAL;)294 2070 A
4095 V
(13278)210 1122 A
1440(})S
4275 V
(13280)210 1122 A
(/*===========================================================================*)3276 1440 A
4365 V
(13281)210 1122 A
1482(*)S
(w_hw_int)336 2784 A
4674(*)S
4455 V
(13282)210 1122 A
(*===========================================================================*/)3276 1482 A
4545 V
(13283)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(w_hw_int\(dr,)504 1944 A
2490(m\))S
4635 V
(13284)210 1122 A
(struct)252 1440 A
(driver)252 1734 A
(*dr;)168 2028 A
4725 V
(13285)210 1122 A
(message)294 1440 A
(*m;)126 1776 A
4815 V
(13286)210 1122 A
1440({)S
4905 V
(13287)210 1122 A
1524(/*)S
(Leftover)336 1650 A
(interrupt\(s\))504 2028 A
(received;)378 2574 A
(ack)126 2994 A
(it/them.)336 3162 A
3540(*/)S
4995 V
(13288)210 1122 A
(ack_irqs\(m->NOTIFY_ARG\);)1008 1524 A
5085 V
(13289)210 1122 A
5175 V
(13290)210 1122 A
(return)252 1524 A
(OK;)126 1818 A
5265 V
(13291)210 1122 A
1440(})S
5535 V
(13294)210 1122 A
(/*===========================================================================*)3276 1440 A
5625 V
(13295)210 1122 A
1482(*)S
(ack_irqs)336 2784 A
4674(*)S
5715 V
(13296)210 1122 A
(*===========================================================================*/)3276 1482 A
5805 V
(13297)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(ack_irqs\(unsigned)714 1986 A
(int)126 2742 A
(irqs\))210 2910 A
5895 V
(13298)210 1122 A
1440({)S
5985 V
(13299)210 1122 A
(unsigned)336 1524 A
(int)126 1902 A
(drive;)252 2070 A
6075 V
(13300)210 1122 A
(for)126 1524 A
(\(drive)252 1692 A
1986(=)S
2070(0;)S
(drive)210 2196 A
2448(<)S
(MAX_DRIVES)420 2532 A
2994(&&)S
(irqs;)210 3120 A
(drive++\))336 3372 A
3750({)S
6165 V
(13301)210 1122 A
1776(if)S
(\(!\(wini[drive].state)840 1902 A
2784(&)S
(IGNORING\))378 2868 A
3288(&&)S
(wini[drive].irq_need_ack)1008 3414 A
4464(&&)S
6255 V
(13302)210 1122 A
(\(wini[drive].irq_mask)882 2112 A
3036(&)S
(irqs\)\))252 3120 A
3414({)S
6345 V
(13303)210 1122 A
2112(if)S
(\(sys_inb\(\(wini[drive].base_cmd)1260 2238 A
3540(+)S
(REG_STATUS\),)504 3624 A
(&wini[drive].w_status\))924 4170 A
5136(!=)S
(OK\))126 5262 A
6435 V
(13304)210 1122 A
(printf\("couldn't)672 2448 A
(ack)126 3162 A
(irq)126 3330 A
3498(on)S
(drive)210 3624 A
(%d\\n",)252 3876 A
(drive\);)294 4170 A
6525 V
(13305)210 1122 A
2112(if)S
(\(sys_irqenable\(&wini[drive].irq_hook_id\))1680 2238 A
3960(!=)S
(OK\))126 4086 A
6615 V
(13306)210 1122 A
(printf\("couldn't)672 2448 A
(re-enable)378 3162 A
(drive)210 3582 A
(%d\\n",)252 3834 A
(drive\);)294 4128 A
6705 V
(13307)210 1122 A
(irqs)168 2112 A
2322(&=)S
(\304wini[drive].irq_mask;)924 2448 A
6795 V
(13308)210 1122 A
1776(})S
6885 V
(13309)210 1122 A
1524(})S
6975 V
(13310)210 1122 A
1440(})S
8418 V
EP
%%Page: 170 170
BP
/slant 0 def
/height 0 def
1485 V
12 B
(170)180 1080 A
11 R
2206(File:)S
2439(drivers/at_wini/at_wini.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1845 V
7 LST
(13313)210 1122 A
(#define)294 1440 A
(STSTR\(a\))336 1776 A
2154(if)S
(\(status)294 2280 A
2616(&)S
(STATUS_)294 2700 A
3036(##)S
3162(a\))S
3288({)S
(strcat\(str,)462 3372 A
(#a\);)168 3876 A
(strcat\(str,)462 4086 A
4590(")S
("\);)126 4674 A
4842(})S
1935 V
(13314)210 1122 A
(#define)294 1440 A
(ERRSTR\(a\))378 1776 A
2196(if)S
2322(\(e)S
2448(&)S
(ERROR_)252 2532 A
2826(##)S
2952(a\))S
3078({)S
(strcat\(str,)462 3162 A
(#a\);)168 3666 A
(strcat\(str,)462 3876 A
4380(")S
("\);)126 4464 A
4632(})S
2025 V
(13315)210 1122 A
(char)168 1440 A
(*strstatus\(int)588 1650 A
(status\))294 2280 A
2115 V
(13316)210 1122 A
1440({)S
2205 V
(13317)210 1122 A
(static)252 1776 A
(char)168 2070 A
(str[200];)378 2280 A
2295 V
(13318)210 1122 A
(str[0])252 1776 A
2070(=)S
('\\0';)210 2154 A
2385 V
(13319)210 1122 A
2475 V
(13320)210 1122 A
(STSTR\(BSY\);)462 1776 A
2565 V
(13321)210 1122 A
(STSTR\(DRDY\);)504 1776 A
2655 V
(13322)210 1122 A
(STSTR\(DMADF\);)546 1776 A
2745 V
(13323)210 1122 A
(STSTR\(SRVCDSC\);)630 1776 A
2835 V
(13324)210 1122 A
(STSTR\(DRQ\);)462 1776 A
2925 V
(13325)210 1122 A
(STSTR\(CORR\);)504 1776 A
3015 V
(13326)210 1122 A
(STSTR\(CHECK\);)546 1776 A
3105 V
(13327)210 1122 A
(return)252 1776 A
(str;)168 2070 A
3195 V
(13328)210 1122 A
1440(})S
3375 V
(13330)210 1122 A
(char)168 1440 A
(*strerr\(int)462 1650 A
2154(e\))S
3465 V
(13331)210 1122 A
1440({)S
3555 V
(13332)210 1122 A
(static)252 1776 A
(char)168 2070 A
(str[200];)378 2280 A
3645 V
(13333)210 1122 A
(str[0])252 1776 A
2070(=)S
('\\0';)210 2154 A
3735 V
(13334)210 1122 A
3825 V
(13335)210 1122 A
(ERRSTR\(BB\);)462 1776 A
3915 V
(13336)210 1122 A
(ERRSTR\(ECC\);)504 1776 A
4005 V
(13337)210 1122 A
(ERRSTR\(ID\);)462 1776 A
4095 V
(13338)210 1122 A
(ERRSTR\(AC\);)462 1776 A
4185 V
(13339)210 1122 A
(ERRSTR\(TK\);)462 1776 A
4275 V
(13340)210 1122 A
(ERRSTR\(DM\);)462 1776 A
4365 V
(13341)210 1122 A
4455 V
(13342)210 1122 A
(return)252 1776 A
(str;)168 2070 A
4545 V
(13343)210 1122 A
1440(})S
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(drivers/tty/tty.h)714 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(13400)210 1122 A
1440(/*)S
(tty.h)210 1776 A
2028(-)S
(Terminals)378 2112 A
2784(*/)S
5445 V
(13401)210 1122 A
5535 V
(13402)210 1122 A
(#include)336 1440 A
(<timers.h>)420 1818 A
5625 V
(13403)210 1122 A
5715 V
(13404)210 1122 A
1440(/*)S
(First)210 1566 A
(minor)210 1818 A
(numbers)294 2070 A
(for)126 2406 A
(the)126 2574 A
(various)294 2742 A
(classes)294 3078 A
3414(of)S
(TTY)126 3540 A
(devices.)336 3708 A
4086(*/)S
5805 V
(13405)210 1122 A
(#define)294 1440 A
(CONS_MINOR)420 1776 A
2574(0)S
5895 V
(13406)210 1122 A
(#define)294 1440 A
(LOG_MINOR)378 1776 A
2532(15)S
5985 V
(13407)210 1122 A
(#define)294 1440 A
(RS232_MINOR)462 1776 A
2532(16)S
6075 V
(13408)210 1122 A
(#define)294 1440 A
(TTYPX_MINOR)462 1776 A
(128)126 2490 A
6165 V
(13409)210 1122 A
(#define)294 1440 A
(PTYPX_MINOR)462 1776 A
(192)126 2490 A
6255 V
(13410)210 1122 A
6345 V
(13411)210 1122 A
(#define)294 1440 A
(LINEWRAP)336 1776 A
2574(1)S
2784(/*)S
(console.c)378 2910 A
3330(-)S
(wrap)168 3414 A
(lines)210 3624 A
3876(at)S
(column)252 4002 A
4296(80)S
4422(*/)S
6435 V
(13412)210 1122 A
6525 V
(13413)210 1122 A
(#define)294 1440 A
(TTY_IN_BYTES)504 1776 A
(256)126 2490 A
2784(/*)S
(tty)126 2910 A
(input)210 3078 A
(queue)210 3330 A
(size)168 3582 A
3792(*/)S
6615 V
(13414)210 1122 A
(#define)294 1440 A
(TAB_SIZE)336 1776 A
2574(8)S
2784(/*)S
(distance)336 2910 A
(between)294 3288 A
(tab)126 3624 A
(stops)210 3792 A
4044(*/)S
6705 V
(13415)210 1122 A
(#define)294 1440 A
(TAB_MASK)336 1776 A
2574(7)S
2784(/*)S
(mask)168 2910 A
3120(to)S
(compute)294 3246 A
3582(a)S
(tab)126 3666 A
(stop)168 3834 A
(position)336 4044 A
4422(*/)S
6795 V
(13416)210 1122 A
6885 V
(13417)210 1122 A
(#define)294 1440 A
(ESC)126 1776 A
('\\33')210 2448 A
2784(/*)S
(escape)252 2910 A
3204(*/)S
6975 V
(13418)210 1122 A
7065 V
(13419)210 1122 A
(#define)294 1440 A
(O_NOCTTY)336 1776 A
(00400)210 2406 A
2784(/*)S
(from)168 2910 A
(<fcntl.h>,)420 3120 A
3582(or)S
3708(cc)S
(will)168 3834 A
(choke)210 4044 A
4296(*/)S
8418 V
EP
%%Page: 171 171
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2420(File:)S
(drivers/tty/tty.h)687 2653 A
12 B
(171)180 4500 A
1755 V
7 LST
(13420)210 1122 A
(#define)294 1440 A
(O_NONBLOCK)420 1776 A
(04000)210 2406 A
1845 V
(13421)210 1122 A
1935 V
(13422)210 1122 A
(struct)252 1440 A
(tty;)168 1734 A
2025 V
(13423)210 1122 A
(typedef)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(\(*devfun_t\),)504 2448 A
(\(struct)294 2994 A
(tty)126 3330 A
(*tp,)168 3498 A
(int)126 3708 A
(try_only\))378 3876 A
4296(\);)S
2115 V
(13424)210 1122 A
(typedef)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(\(*devfunarg_t\),)630 2490 A
(\(struct)294 3162 A
(tty)126 3498 A
(*tp,)168 3666 A
(int)126 3876 A
4044(c\))S
4170(\);)S
2205 V
(13425)210 1122 A
2295 V
(13426)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
(tty)126 2070 A
2238({)S
2385 V
(13427)210 1122 A
(int)126 1524 A
(tty_events;)462 1692 A
2784(/*)S
(set)126 2910 A
(when)168 3078 A
(TTY)126 3288 A
(should)252 3456 A
(inspect)294 3750 A
(this)168 4086 A
(line)168 4296 A
4506(*/)S
2475 V
(13428)210 1122 A
(int)126 1524 A
(tty_index;)420 1692 A
2784(/*)S
(index)210 2910 A
(into)168 3162 A
(TTY)126 3372 A
(table)210 3540 A
3792(*/)S
2565 V
(13429)210 1122 A
(int)126 1524 A
(tty_minor;)420 1692 A
2784(/*)S
(device)252 2910 A
(minor)210 3204 A
(number)252 3456 A
3750(*/)S
2655 V
(13430)210 1122 A
2745 V
(13431)210 1122 A
1524(/*)S
(Input)210 1650 A
(queue.)252 1902 A
(Typed)210 2238 A
(characters)420 2490 A
(are)126 2952 A
(stored)252 3120 A
(here)168 3414 A
(until)210 3624 A
(read)168 3876 A
4086(by)S
4212(a)S
(program.)336 4296 A
4674(*/)S
2835 V
(13432)210 1122 A
(u16_t)210 1524 A
(*tty_inhead;)504 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(place)210 3372 A
(where)210 3624 A
(next)168 3876 A
(char)168 4086 A
(goes)168 4296 A
4506(*/)S
2925 V
(13433)210 1122 A
(u16_t)210 1524 A
(*tty_intail;)504 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(next)168 3372 A
(char)168 3582 A
3792(to)S
3918(be)S
(given)210 4044 A
4296(to)S
(prog)168 4422 A
4632(*/)S
3015 V
(13434)210 1122 A
(int)126 1524 A
(tty_incount;)504 1692 A
2784(/*)S
2910(#)S
(chars)210 2994 A
3246(in)S
(the)126 3372 A
(input)210 3540 A
(queue)210 3792 A
4044(*/)S
3105 V
(13435)210 1122 A
(int)126 1524 A
(tty_eotct;)420 1692 A
2784(/*)S
(number)252 2910 A
3204(of)S
("line)210 3330 A
(breaks")294 3582 A
3918(in)S
(input)210 4044 A
(queue)210 4296 A
4548(*/)S
3195 V
(13436)210 1122 A
(devfun_t)336 1524 A
(tty_devread;)504 1902 A
2784(/*)S
(routine)294 2910 A
3246(to)S
(read)168 3372 A
(from)168 3582 A
(low)126 3792 A
(level)210 3960 A
(buffers)294 4212 A
4548(*/)S
3285 V
(13437)210 1122 A
(devfun_t)336 1524 A
(tty_icancel;)504 1902 A
2784(/*)S
(cancel)252 2910 A
(any)126 3204 A
(device)252 3372 A
(input)210 3666 A
3918(*/)S
3375 V
(13438)210 1122 A
(int)126 1524 A
(tty_min;)336 1692 A
2784(/*)S
(minimum)294 2910 A
(requested)378 3246 A
(#chars)252 3666 A
3960(in)S
(input)210 4086 A
(queue)210 4338 A
4590(*/)S
3465 V
(13439)210 1122 A
(timer_t)294 1524 A
(tty_tmr;)336 1860 A
2784(/*)S
(the)126 2910 A
(timer)210 3078 A
(for)126 3330 A
(this)168 3498 A
(tty)126 3708 A
3876(*/)S
3555 V
(13440)210 1122 A
3645 V
(13441)210 1122 A
1524(/*)S
(Output)252 1650 A
(section.)336 1944 A
2322(*/)S
3735 V
(13442)210 1122 A
(devfun_t)336 1524 A
(tty_devwrite;)546 1902 A
2784(/*)S
(routine)294 2910 A
3246(to)S
(start)210 3372 A
(actual)252 3624 A
(device)252 3918 A
(output)252 4212 A
4506(*/)S
3825 V
(13443)210 1122 A
(devfunarg_t)462 1524 A
(tty_echo;)378 2028 A
2784(/*)S
(routine)294 2910 A
3246(to)S
(echo)168 3372 A
(characters)420 3582 A
(input)210 4044 A
4296(*/)S
3915 V
(13444)210 1122 A
(devfun_t)336 1524 A
(tty_ocancel;)504 1902 A
2784(/*)S
(cancel)252 2910 A
(any)126 3204 A
(ongoing)294 3372 A
(device)252 3708 A
(output)252 4002 A
4296(*/)S
4005 V
(13445)210 1122 A
(devfun_t)336 1524 A
(tty_break;)420 1902 A
2784(/*)S
(let)126 2910 A
(the)126 3078 A
(device)252 3246 A
(send)168 3540 A
3750(a)S
(break)210 3834 A
4086(*/)S
4095 V
(13446)210 1122 A
4185 V
(13447)210 1122 A
1524(/*)S
(Terminal)336 1650 A
(parameters)420 2028 A
(and)126 2490 A
(status.)294 2658 A
2994(*/)S
4275 V
(13448)210 1122 A
(int)126 1524 A
(tty_position;)546 1692 A
2784(/*)S
(current)294 2910 A
(position)336 3246 A
3624(on)S
(the)126 3750 A
(screen)252 3918 A
(for)126 4212 A
(echoing)294 4380 A
4716(*/)S
4365 V
(13449)210 1122 A
(char)168 1524 A
(tty_reprint;)504 1734 A
2784(/*)S
2910(1)S
(when)168 2994 A
(echoed)252 3204 A
(input)210 3498 A
(messed)252 3750 A
(up,)126 4044 A
(else)168 4212 A
4422(0)S
4506(*/)S
4455 V
(13450)210 1122 A
(char)168 1524 A
(tty_escaped;)504 1734 A
2784(/*)S
2910(1)S
(when)168 2994 A
(LNEXT)210 3204 A
(\(\303V\))168 3456 A
(just)168 3666 A
(seen,)210 3876 A
(else)168 4128 A
4338(0)S
4422(*/)S
4545 V
(13451)210 1122 A
(char)168 1524 A
(tty_inhibited;)588 1734 A
2784(/*)S
2910(1)S
(when)168 2994 A
(STOP)168 3204 A
(\(\303S\))168 3414 A
(just)168 3624 A
(seen)168 3834 A
(\(stops)252 4044 A
(output\))294 4338 A
4674(*/)S
4635 V
(13452)210 1122 A
(char)168 1524 A
(tty_pgrp;)378 1734 A
2784(/*)S
(slot)168 2910 A
(number)252 3120 A
3414(of)S
(controlling)462 3540 A
(process)294 4044 A
4380(*/)S
4725 V
(13453)210 1122 A
(char)168 1524 A
(tty_openct;)462 1734 A
2784(/*)S
(count)210 2910 A
3162(of)S
(number)252 3288 A
3582(of)S
(opens)210 3708 A
3960(of)S
(this)168 4086 A
(tty)126 4296 A
4464(*/)S
4815 V
(13454)210 1122 A
4905 V
(13455)210 1122 A
1524(/*)S
(Information)462 1650 A
(about)210 2154 A
(incomplete)420 2406 A
(I/O)126 2868 A
(requests)336 3036 A
3414(is)S
(stored)252 3540 A
(here.)210 3834 A
4086(*/)S
4995 V
(13456)210 1122 A
(char)168 1524 A
(tty_inrepcode;)588 1734 A
2784(/*)S
(reply)210 2910 A
(code,)210 3162 A
(TASK_REPLY)420 3414 A
3876(or)S
(REVIVE)252 4002 A
4296(*/)S
5085 V
(13457)210 1122 A
(char)168 1524 A
(tty_inrevived;)588 1734 A
2784(/*)S
(set)126 2910 A
3078(to)S
3204(1)S
3288(if)S
(revive)252 3414 A
(callback)336 3708 A
4086(is)S
(pending)294 4212 A
4548(*/)S
5175 V
(13458)210 1122 A
(char)168 1524 A
(tty_incaller;)546 1734 A
2784(/*)S
(process)294 2910 A
(that)168 3246 A
(made)168 3456 A
(the)126 3666 A
(call)168 3834 A
(\(usually)336 4044 A
(FS\))126 4422 A
4590(*/)S
5265 V
(13459)210 1122 A
(char)168 1524 A
(tty_inproc;)462 1734 A
2784(/*)S
(process)294 2910 A
(that)168 3246 A
(wants)210 3456 A
3708(to)S
(read)168 3834 A
(from)168 4044 A
(tty)126 4254 A
4422(*/)S
5355 V
(13460)210 1122 A
(vir_bytes)378 1524 A
(tty_in_vir;)462 1944 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
(where)210 3582 A
(data)168 3834 A
4044(is)S
4170(to)S
4296(go)S
4422(*/)S
5445 V
(13461)210 1122 A
(int)126 1524 A
(tty_inleft;)462 1692 A
2784(/*)S
(how)126 2910 A
(many)168 3078 A
(chars)210 3288 A
(are)126 3540 A
(still)210 3708 A
(needed)252 3960 A
4254(*/)S
5535 V
(13462)210 1122 A
(int)126 1524 A
(tty_incum;)420 1692 A
2784(/*)S
2910(#)S
(chars)210 2994 A
(input)210 3246 A
3498(so)S
(far)126 3624 A
3792(*/)S
5625 V
(13463)210 1122 A
(char)168 1524 A
(tty_outrepcode;)630 1734 A
2784(/*)S
(reply)210 2910 A
(code,)210 3162 A
(TASK_REPLY)420 3414 A
3876(or)S
(REVIVE)252 4002 A
4296(*/)S
5715 V
(13464)210 1122 A
(char)168 1524 A
(tty_outrevived;)630 1734 A
2784(/*)S
(set)126 2910 A
3078(to)S
3204(1)S
3288(if)S
(revive)252 3414 A
(callback)336 3708 A
4086(is)S
(pending)294 4212 A
4548(*/)S
5805 V
(13465)210 1122 A
(char)168 1524 A
(tty_outcaller;)588 1734 A
2784(/*)S
(process)294 2910 A
(that)168 3246 A
(made)168 3456 A
(the)126 3666 A
(call)168 3834 A
(\(usually)336 4044 A
(FS\))126 4422 A
4590(*/)S
5895 V
(13466)210 1122 A
(char)168 1524 A
(tty_outproc;)504 1734 A
2784(/*)S
(process)294 2910 A
(that)168 3246 A
(wants)210 3456 A
3708(to)S
(write)210 3834 A
4086(to)S
(tty)126 4212 A
4380(*/)S
5985 V
(13467)210 1122 A
(vir_bytes)378 1524 A
(tty_out_vir;)504 1944 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
(where)210 3582 A
(data)168 3834 A
(comes)210 4044 A
(from)168 4296 A
4506(*/)S
6075 V
(13468)210 1122 A
(int)126 1524 A
(tty_outleft;)504 1692 A
2784(/*)S
2910(#)S
(chars)210 2994 A
(yet)126 3246 A
3414(to)S
3540(be)S
(output)252 3666 A
3960(*/)S
6165 V
(13469)210 1122 A
(int)126 1524 A
(tty_outcum;)462 1692 A
2784(/*)S
2910(#)S
(chars)210 2994 A
(output)252 3246 A
3540(so)S
(far)126 3666 A
3834(*/)S
6255 V
(13470)210 1122 A
(char)168 1524 A
(tty_iocaller;)546 1734 A
2784(/*)S
(process)294 2910 A
(that)168 3246 A
(made)168 3456 A
(the)126 3666 A
(call)168 3834 A
(\(usually)336 4044 A
(FS\))126 4422 A
4590(*/)S
6345 V
(13471)210 1122 A
(char)168 1524 A
(tty_ioproc;)462 1734 A
2784(/*)S
(process)294 2910 A
(that)168 3246 A
(wants)210 3456 A
3708(to)S
3834(do)S
3960(an)S
(ioctl)210 4086 A
4338(*/)S
6435 V
(13472)210 1122 A
(int)126 1524 A
(tty_ioreq;)420 1692 A
2784(/*)S
(ioctl)210 2910 A
(request)294 3162 A
(code)168 3498 A
3708(*/)S
6525 V
(13473)210 1122 A
(vir_bytes)378 1524 A
(tty_iovir;)420 1944 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
3582(of)S
(ioctl)210 3708 A
(buffer)252 3960 A
4254(*/)S
6615 V
(13474)210 1122 A
6705 V
(13475)210 1122 A
1524(/*)S
(select\(\))336 1650 A
(data)168 2028 A
2238(*/)S
6795 V
(13476)210 1122 A
(int)126 1524 A
(tty_select_ops;)630 1692 A
2784(/*)S
(which)210 2910 A
(operations)420 3162 A
(are)126 3624 A
(interesting)462 3792 A
4296(*/)S
6885 V
(13477)210 1122 A
(int)126 1524 A
(tty_select_proc;)672 1692 A
2784(/*)S
(which)210 2910 A
(process)294 3162 A
(wants)210 3498 A
(notification)504 3750 A
4296(*/)S
6975 V
(13478)210 1122 A
7065 V
(13479)210 1122 A
1524(/*)S
(Miscellaneous.)588 1650 A
2280(*/)S
8418 V
EP
%%Page: 172 172
BP
/slant 0 def
/height 0 def
1485 V
12 B
(172)180 1080 A
11 R
2420(File:)S
(drivers/tty/tty.h)687 2653 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(13480)210 1122 A
(devfun_t)336 1524 A
(tty_ioctl;)420 1902 A
2784(/*)S
(set)126 2910 A
(line)168 3078 A
(speed,)252 3288 A
(etc.)168 3582 A
3792(at)S
(the)126 3918 A
(device)252 4086 A
(level)210 4380 A
4632(*/)S
1845 V
(13481)210 1122 A
(devfun_t)336 1524 A
(tty_close;)420 1902 A
2784(/*)S
(tell)168 2910 A
(the)126 3120 A
(device)252 3288 A
(that)168 3582 A
(the)126 3792 A
(tty)126 3960 A
4128(is)S
(closed)252 4254 A
4548(*/)S
1935 V
(13482)210 1122 A
(void)168 1524 A
(*tty_priv;)420 1734 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(per)126 3372 A
(device)252 3540 A
(private)294 3834 A
(data)168 4170 A
4380(*/)S
2025 V
(13483)210 1122 A
(struct)252 1524 A
(termios)294 1818 A
(tty_termios;)504 2154 A
2784(/*)S
(terminal)336 2910 A
(attributes)420 3288 A
3750(*/)S
2115 V
(13484)210 1122 A
(struct)252 1524 A
(winsize)294 1818 A
(tty_winsize;)504 2154 A
2784(/*)S
(window)252 2910 A
(size)168 3204 A
(\(#lines)294 3414 A
(and)126 3750 A
(#columns\))378 3918 A
4338(*/)S
2205 V
(13485)210 1122 A
2295 V
(13486)210 1122 A
(u16_t)210 1524 A
(tty_inbuf[TTY_IN_BYTES];/*)1092 1776 A
(tty)126 2910 A
(input)210 3078 A
(buffer)252 3330 A
3624(*/)S
2385 V
(13487)210 1122 A
2475 V
(13488)210 1122 A
1440(})S
(tty_t;)252 1524 A
2565 V
(13489)210 1122 A
2655 V
(13490)210 1122 A
1440(/*)S
(Memory)252 1566 A
(allocated)378 1860 A
2280(in)S
(tty.c,)252 2406 A
2700(so)S
(extern)252 2826 A
(here.)210 3120 A
3372(*/)S
2745 V
(13491)210 1122 A
(extern)252 1440 A
(tty_t)210 1734 A
(tty_table[NR_CONS+NR_RS_LINES+NR_PTYS];)1638 1986 A
2835 V
(13492)210 1122 A
(extern)252 1440 A
(int)126 1734 A
(ccurrent;)378 1902 A
2784(/*)S
(currently)378 2910 A
(visible)294 3330 A
(console)294 3666 A
4002(*/)S
2925 V
(13493)210 1122 A
(extern)252 1440 A
(int)126 1734 A
(irq_hook_id;)504 1902 A
2784(/*)S
(hook)168 2910 A
3120(id)S
(for)126 3246 A
(keyboard)336 3414 A
(irq)126 3792 A
3960(*/)S
3015 V
(13494)210 1122 A
3105 V
(13495)210 1122 A
(extern)252 1440 A
(unsigned)336 1734 A
(long)168 2112 A
(kbd_irq_set;)504 2322 A
3195 V
(13496)210 1122 A
(extern)252 1440 A
(unsigned)336 1734 A
(long)168 2112 A
(rs_irq_set;)462 2322 A
3285 V
(13497)210 1122 A
3375 V
(13498)210 1122 A
1440(/*)S
(Values)252 1566 A
(for)126 1860 A
(the)126 2028 A
(fields.)294 2196 A
2532(*/)S
3465 V
(13499)210 1122 A
(#define)294 1440 A
(NOT_ESCAPED)462 1776 A
2574(0)S
2784(/*)S
(previous)336 2910 A
(character)378 3288 A
3708(is)S
(not)126 3834 A
(LNEXT)210 4002 A
(\(\303V\))168 4254 A
4464(*/)S
3555 V
(13500)210 1122 A
(#define)294 1440 A
(ESCAPED)294 1776 A
2574(1)S
2784(/*)S
(previous)336 2910 A
(character)378 3288 A
(was)126 3708 A
(LNEXT)210 3876 A
(\(\303V\))168 4128 A
4338(*/)S
3645 V
(13501)210 1122 A
(#define)294 1440 A
(RUNNING)294 1776 A
2574(0)S
2784(/*)S
2910(no)S
(STOP)168 3036 A
(\(\303S\))168 3246 A
(has)126 3456 A
(been)168 3624 A
(typed)210 3834 A
4086(to)S
(stop)168 4212 A
(output)252 4422 A
4716(*/)S
3735 V
(13502)210 1122 A
(#define)294 1440 A
(STOPPED)294 1776 A
2574(1)S
2784(/*)S
(STOP)168 2910 A
(\(\303S\))168 3120 A
(has)126 3330 A
(been)168 3498 A
(typed)210 3708 A
3960(to)S
(stop)168 4086 A
(output)252 4296 A
4590(*/)S
3825 V
(13503)210 1122 A
3915 V
(13504)210 1122 A
1440(/*)S
(Fields)252 1566 A
(and)126 1860 A
(flags)210 2028 A
2280(on)S
(characters)420 2406 A
2868(in)S
(the)126 2994 A
(input)210 3162 A
(queue.)252 3414 A
3708(*/)S
4005 V
(13505)210 1122 A
(#define)294 1440 A
(IN_CHAR)294 1776 A
(0x00FF)252 2364 A
2784(/*)S
(low)126 2910 A
3078(8)S
(bits)168 3162 A
(are)126 3372 A
(the)126 3540 A
(character)378 3708 A
(itself)252 4128 A
4422(*/)S
4095 V
(13506)210 1122 A
(#define)294 1440 A
(IN_LEN)252 1776 A
(0x0F00)252 2364 A
2784(/*)S
(length)252 2910 A
3204(of)S
(char)168 3330 A
3540(if)S
3666(it)S
(has)126 3792 A
(been)168 3960 A
(echoed)252 4170 A
4464(*/)S
4185 V
(13507)210 1122 A
(#define)294 1440 A
(IN_LSHIFT)378 1776 A
2574(8)S
2784(/*)S
(length)252 2910 A
3204(=)S
3288(\(c)S
3414(&)S
(IN_LEN\))294 3498 A
3834(>>)S
(IN_LSHIFT)378 3960 A
4380(*/)S
4275 V
(13508)210 1122 A
(#define)294 1440 A
(IN_EOT)252 1776 A
(0x1000)252 2364 A
2784(/*)S
(char)168 2910 A
3120(is)S
3246(a)S
(line)168 3330 A
(break)210 3540 A
(\(\303D,)168 3792 A
(LF\))126 4002 A
4170(*/)S
4365 V
(13509)210 1122 A
(#define)294 1440 A
(IN_EOF)252 1776 A
(0x2000)252 2364 A
2784(/*)S
(char)168 2910 A
3120(is)S
(EOF)126 3246 A
(\(\303D\),)210 3414 A
3666(do)S
(not)126 3792 A
(return)252 3960 A
4254(to)S
(user)168 4380 A
4590(*/)S
4455 V
(13510)210 1122 A
(#define)294 1440 A
(IN_ESC)252 1776 A
(0x4000)252 2364 A
2784(/*)S
(escaped)294 2910 A
3246(by)S
(LNEXT)210 3372 A
(\(\303V\),)210 3624 A
3876(no)S
(interpretation)588 4002 A
4632(*/)S
4545 V
(13511)210 1122 A
4635 V
(13512)210 1122 A
1440(/*)S
(Times)210 1566 A
(and)126 1818 A
(timeouts.)378 1986 A
2406(*/)S
4725 V
(13513)210 1122 A
(#define)294 1440 A
(force_timeout\(\))630 1776 A
(\(\(void\))294 2448 A
(\(0\)\))168 2784 A
4815 V
(13514)210 1122 A
4905 V
(13515)210 1122 A
1440(/*)S
(Memory)252 1566 A
(allocated)378 1860 A
2280(in)S
(tty.c,)252 2406 A
2700(so)S
(extern)252 2826 A
(here.)210 3120 A
3372(*/)S
4995 V
(13516)210 1122 A
(extern)252 1440 A
(timer_t)294 1734 A
(*tty_timers;)504 2070 A
3120(/*)S
(queue)210 3246 A
3498(of)S
(TTY)126 3624 A
(timers)252 3792 A
4086(*/)S
5085 V
(13517)210 1122 A
(extern)252 1440 A
(clock_t)294 1734 A
(tty_next_timeout;)714 2070 A
3120(/*)S
(next)168 3246 A
(TTY)126 3456 A
(timeout)294 3624 A
3960(*/)S
5175 V
(13518)210 1122 A
5265 V
(13519)210 1122 A
1440(/*)S
(Number)252 1566 A
1860(of)S
(elements)336 1986 A
(and)126 2364 A
(limit)210 2532 A
2784(of)S
2910(a)S
(buffer.)294 2994 A
3330(*/)S
5355 V
(13520)210 1122 A
(#define)294 1440 A
(buflen\(buf\))462 1776 A
(\(sizeof\(buf\))504 2448 A
2994(/)S
(sizeof\(\(buf\)[0]\)\))714 3078 A
5445 V
(13521)210 1122 A
(#define)294 1440 A
(bufend\(buf\))462 1776 A
(\(\(buf\))252 2448 A
2742(+)S
(buflen\(buf\)\))504 2826 A
5535 V
(13522)210 1122 A
5625 V
(13523)210 1122 A
1440(/*)S
(Memory)252 1566 A
(allocated)378 1860 A
2280(in)S
(tty.c,)252 2406 A
2700(so)S
(extern)252 2826 A
(here.)210 3120 A
3372(*/)S
5715 V
(13524)210 1122 A
(extern)252 1440 A
(struct)252 1734 A
(machine)294 2028 A
(machine;)336 2364 A
2784(/*)S
(machine)294 2910 A
(information)462 3246 A
(\(a.o.:)252 3750 A
(pc_at,)252 4044 A
(ega\))168 4338 A
4548(*/)S
5805 V
(13525)210 1122 A
5895 V
(13526)210 1122 A
1440(/*)S
(Function)336 1566 A
(prototypes)420 1944 A
(for)126 2406 A
(TTY)126 2574 A
(driver.)294 2742 A
3078(*/)S
5985 V
(13527)210 1122 A
1440(/*)S
(tty.c)210 1566 A
1818(*/)S
6075 V
(13528)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(handle_events,)588 2154 A
(\(struct)294 2784 A
(tty)126 3120 A
(*tp\))168 3288 A
4464(\);)S
6165 V
(13529)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(sigchar,)336 2154 A
(\(struct)294 2532 A
(tty)126 2868 A
(*tp,)168 3036 A
(int)126 3246 A
(sig\))168 3414 A
4464(\);)S
6255 V
(13530)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(tty_task,)378 2154 A
(\(void\))252 2574 A
4464(\);)S
6345 V
(13531)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(in_process,)462 2112 A
(\(struct)294 2616 A
(tty)126 2952 A
(*tp,)168 3120 A
(char)168 3330 A
(*buf,)210 3540 A
(int)126 3792 A
(count\))252 3960 A
4464(\);)S
6435 V
(13532)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(out_process,)504 2154 A
(\(struct)294 2700 A
(tty)126 3036 A
(*tp,)168 3204 A
(char)168 3414 A
(*bstart,)336 3624 A
(char)168 4002 A
(*bpos,)252 4212 A
6525 V
(13533)210 1122 A
(char)168 2784 A
(*bend,)252 2994 A
(int)126 3288 A
(*icount,)336 3456 A
(int)126 3834 A
(*ocount\))336 4002 A
4464(\);)S
6615 V
(13534)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(tty_wakeup,)462 2154 A
(\(clock_t)336 2658 A
(now\))168 3036 A
4464(\);)S
6705 V
(13535)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(tty_reply,)420 2154 A
(\(int)168 2616 A
(code,)210 2826 A
(int)126 3078 A
(replyee,)336 3246 A
(int)126 3624 A
(proc_nr,)336 3792 A
6795 V
(13536)210 1122 A
(int)126 3792 A
(status\))294 3960 A
4464(\);)S
6885 V
(13537)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(tty_devnop,)462 2112 A
(\(struct)294 2616 A
(tty)126 2952 A
(*tp,)168 3120 A
(int)126 3330 A
(try\))168 3498 A
4464(\);)S
6975 V
(13538)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(select_try,)462 2112 A
(\(struct)294 2616 A
(tty)126 2952 A
(*tp,)168 3120 A
(int)126 3330 A
(ops\))168 3498 A
4464(\);)S
7065 V
(13539)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(select_retry,)546 2112 A
(\(struct)294 2700 A
(tty)126 3036 A
(*tp\))168 3204 A
4464(\);)S
8418 V
EP
%%Page: 173 173
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2420(File:)S
(drivers/tty/tty.h)687 2653 A
12 B
(173)180 4500 A
1755 V
7 LST
(13540)210 1122 A
1845 V
(13541)210 1122 A
1440(/*)S
(console.c)378 1566 A
1986(*/)S
1935 V
(13542)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(kputc,)252 2154 A
(\(int)168 2448 A
2658(c\))S
4464(\);)S
2025 V
(13543)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(cons_stop,)420 2154 A
(\(void\))252 2616 A
4464(\);)S
2115 V
(13544)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(do_new_kmess,)546 2154 A
(\(message)336 2742 A
(*m\))126 3120 A
4464(\);)S
2205 V
(13545)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(do_diagnostics,)630 2154 A
(\(message)336 2826 A
(*m\))126 3204 A
4464(\);)S
2295 V
(13546)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(scr_init,)378 2154 A
(\(struct)294 2574 A
(tty)126 2910 A
(*tp\))168 3078 A
4464(\);)S
2385 V
(13547)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(toggle_scroll,)588 2154 A
(\(void\))252 2784 A
4464(\);)S
2475 V
(13548)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(con_loadfont,)546 2112 A
(\(message)336 2700 A
(*m\))126 3078 A
4464(\);)S
2565 V
(13549)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(select_console,)630 2154 A
(\(int)168 2826 A
(cons_line\))420 3036 A
4464(\);)S
2655 V
(13550)210 1122 A
2745 V
(13551)210 1122 A
1440(/*)S
(keyboard.c)420 1566 A
2028(*/)S
2835 V
(13552)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(kb_init,)336 2154 A
(\(struct)294 2532 A
(tty)126 2868 A
(*tp\))168 3036 A
4464(\);)S
2925 V
(13553)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(kb_init_once,)546 2154 A
(\(void\))252 2742 A
4464(\);)S
3015 V
(13554)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(kbd_loadmap,)504 2112 A
(\(message)336 2658 A
(*m\))126 3036 A
4464(\);)S
3105 V
(13555)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(do_panic_dumps,)630 2154 A
(\(message)336 2826 A
(*m\))126 3204 A
4464(\);)S
3195 V
(13556)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(do_fkey_ctl,)504 2154 A
(\(message)336 2700 A
(*m\))126 3078 A
4464(\);)S
3285 V
(13557)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(kbd_interrupt,)588 2154 A
(\(message)336 2784 A
(*m\))126 3162 A
4464(\);)S
3375 V
(13558)210 1122 A
3465 V
(13559)210 1122 A
1440(/*)S
(vidcopy.s)378 1566 A
1986(*/)S
3555 V
(13560)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(vid_vid_copy,)546 2154 A
(\(unsigned)378 2742 A
(src,)168 3162 A
(unsigned)336 3372 A
(dst,)168 3750 A
(unsigned)336 3960 A
(count\)\);)336 4338 A
3645 V
(13561)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(mem_vid_copy,)546 2154 A
(\(u16_t)252 2742 A
(*src,)210 3036 A
(unsigned)336 3288 A
(dst,)168 3666 A
(unsigned)336 3876 A
(count\)\);)336 4254 A
4095 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4185 V
(drivers/tty/tty.c)714 2676 A
4275 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4455 V
(13600)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(terminal)336 2532 A
(driver,)294 2910 A
(both)168 3246 A
(for)126 3456 A
(the)126 3624 A
(IBM)126 3792 A
(console)294 3960 A
(and)126 4296 A
(regular)294 4464 A
4545 V
(13601)210 1122 A
1482(*)S
(ASCII)210 1566 A
(terminals.)420 1818 A
2322(It)S
(handles)294 2448 A
(only)168 2784 A
(the)126 2994 A
(device-independent)756 3162 A
(part)168 3960 A
4170(of)S
4296(a)S
(TTY,)168 4380 A
(the)126 4590 A
4635 V
(13602)210 1122 A
1482(*)S
(device)252 1566 A
(dependent)378 1860 A
(parts)210 2280 A
(are)126 2532 A
2700(in)S
(console.c,)420 2826 A
(rs232.c,)336 3288 A
(etc.)168 3666 A
(This)168 3918 A
(file)168 4128 A
(contains)336 4338 A
4725 V
(13603)210 1122 A
1482(*)S
(two)126 1566 A
(main)168 1734 A
(entry)210 1944 A
(points,)294 2196 A
(tty_task\(\))420 2532 A
(and)126 2994 A
(tty_wakeup\(\),)546 3162 A
(and)126 3750 A
(several)294 3918 A
(minor)210 4254 A
(entry)210 4506 A
4815 V
(13604)210 1122 A
1482(*)S
(points)252 1566 A
(for)126 1860 A
(use)126 2028 A
2196(by)S
(the)126 2322 A
(device-dependent)672 2490 A
(code.)210 3204 A
4905 V
(13605)210 1122 A
1482(*)S
4995 V
(13606)210 1122 A
1482(*)S
(The)126 1566 A
(device-independent)756 1734 A
(part)168 2532 A
(accepts)294 2742 A
("keyboard")420 3078 A
(input)210 3540 A
(from)168 3792 A
(the)126 4002 A
(device-)294 4170 A
5085 V
(13607)210 1122 A
1482(*)S
(dependent)378 1566 A
(part,)210 1986 A
(performs)336 2238 A
(input)210 2616 A
(processing)420 2868 A
(\(special)336 3330 A
(key)126 3708 A
(interpretation\),)672 3876 A
5175 V
(13608)210 1122 A
1482(*)S
(and)126 1566 A
(sends)210 1734 A
(the)126 1986 A
(input)210 2154 A
2406(to)S
2532(a)S
(process)294 2616 A
(reading)294 2952 A
(from)168 3288 A
(the)126 3498 A
(TTY.)168 3666 A
(Output)252 3918 A
4212(to)S
4338(a)S
(TTY)126 4422 A
5265 V
(13609)210 1122 A
1482(*)S
1566(is)S
(sent)168 1692 A
1902(to)S
(the)126 2028 A
(device-dependent)672 2196 A
(code)168 2910 A
(for)126 3120 A
(output)252 3288 A
(processing)420 3582 A
(and)126 4044 A
("screen")336 4212 A
5355 V
(13610)210 1122 A
1482(*)S
(display.)336 1566 A
(Input)210 1986 A
(processing)420 2238 A
2700(is)S
(done)168 2826 A
3036(by)S
(the)126 3162 A
(device)252 3330 A
3624(by)S
(calling)294 3750 A
('in_process')504 4086 A
5445 V
(13611)210 1122 A
1482(*)S
1566(on)S
(the)126 1692 A
(input)210 1860 A
(characters,)462 2112 A
(output)252 2616 A
(processing)420 2910 A
(may)126 3372 A
3540(be)S
(done)168 3666 A
3876(by)S
(the)126 4002 A
(device)252 4170 A
(itself)252 4464 A
5535 V
(13612)210 1122 A
1482(*)S
1566(or)S
1692(by)S
(calling)294 1818 A
('out_process'.)588 2154 A
(The)126 2826 A
(TTY)126 2994 A
(takes)210 3162 A
(care)168 3414 A
3624(of)S
(input)210 3750 A
(queuing,)336 4002 A
(the)126 4380 A
5625 V
(13613)210 1122 A
1482(*)S
(device)252 1566 A
(does)168 1860 A
(the)126 2070 A
(output)252 2238 A
(queuing.)336 2532 A
2952(If)S
3078(a)S
(device)252 3162 A
(receives)336 3456 A
3834(an)S
(external)336 3960 A
(signal,)294 4338 A
5715 V
(13614)210 1122 A
1482(*)S
(like)168 1566 A
1776(an)S
(interrupt,)420 1902 A
(then)168 2364 A
2574(it)S
(causes)252 2700 A
(tty_wakeup\(\))504 2994 A
3540(to)S
3666(be)S
(run)126 3792 A
3960(by)S
(the)126 4086 A
(CLOCK)210 4254 A
(task)168 4506 A
5805 V
(13615)210 1122 A
1482(*)S
(to,)126 1566 A
(you)126 1734 A
(guessed)294 1902 A
(it,)126 2238 A
(wake)168 2406 A
2616(up)S
(the)126 2742 A
(TTY)126 2910 A
3078(to)S
(check)210 3204 A
3456(if)S
(input)210 3582 A
3834(or)S
(output)252 3960 A
(can)126 4254 A
5895 V
(13616)210 1122 A
1482(*)S
(continue.)378 1566 A
5985 V
(13617)210 1122 A
1482(*)S
6075 V
(13618)210 1122 A
1482(*)S
(The)126 1566 A
(valid)210 1734 A
(messages)336 1986 A
(and)126 2364 A
(their)210 2532 A
(parameters)420 2784 A
(are:)168 3246 A
6165 V
(13619)210 1122 A
1482(*)S
6255 V
(13620)210 1122 A
1482(*)S
(HARD_INT:)378 1650 A
(output)252 2322 A
(has)126 2616 A
(been)168 2784 A
(completed)378 2994 A
3414(or)S
(input)210 3540 A
(has)126 3792 A
(arrived)294 3960 A
6345 V
(13621)210 1122 A
1482(*)S
(SYS_SIG:)336 1650 A
(e.g.,)210 2238 A
(MINIX)210 2490 A
(wants)210 2742 A
2994(to)S
(shutdown;)378 3120 A
(run)126 3540 A
(code)168 3708 A
3918(to)S
(cleanly)294 4044 A
(stop)168 4380 A
6435 V
(13622)210 1122 A
1482(*)S
(DEV_READ:)378 1650 A
2322(a)S
(process)294 2406 A
(wants)210 2742 A
2994(to)S
(read)168 3120 A
(from)168 3330 A
3540(a)S
(terminal)336 3624 A
6525 V
(13623)210 1122 A
1482(*)S
(DEV_WRITE:)420 1650 A
2322(a)S
(process)294 2406 A
(wants)210 2742 A
2994(to)S
(write)210 3120 A
3372(on)S
3498(a)S
(terminal)336 3582 A
6615 V
(13624)210 1122 A
1482(*)S
(DEV_IOCTL:)420 1650 A
2322(a)S
(process)294 2406 A
(wants)210 2742 A
2994(to)S
(change)252 3120 A
3414(a)S
(terminal's)420 3498 A
(parameters)420 3960 A
6705 V
(13625)210 1122 A
1482(*)S
(DEV_OPEN:)378 1650 A
2322(a)S
(tty)126 2406 A
(line)168 2574 A
(has)126 2784 A
(been)168 2952 A
(opened)252 3162 A
6795 V
(13626)210 1122 A
1482(*)S
(DEV_CLOSE:)420 1650 A
2322(a)S
(tty)126 2406 A
(line)168 2574 A
(has)126 2784 A
(been)168 2952 A
(closed)252 3162 A
6885 V
(13627)210 1122 A
1482(*)S
(DEV_SELECT:)462 1650 A
(start)210 2322 A
(select)252 2574 A
(notification)504 2868 A
(request)294 3414 A
6975 V
(13628)210 1122 A
1482(*)S
(DEV_STATUS:)462 1650 A
2322(FS)S
(wants)210 2448 A
2700(to)S
(know)168 2826 A
(status)252 3036 A
(for)126 3330 A
(SELECT)252 3498 A
3792(or)S
(REVIVE)252 3918 A
7065 V
(13629)210 1122 A
1482(*)S
(CANCEL:)294 1650 A
(terminate)378 2322 A
2742(a)S
(previous)336 2826 A
(incomplete)420 3204 A
(system)252 3666 A
(call)168 3960 A
(immediately)462 4170 A
8418 V
EP
%%Page: 174 174
BP
/slant 0 def
/height 0 def
1485 V
12 B
(174)180 1080 A
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(13630)210 1122 A
1482(*)S
1845 V
(13631)210 1122 A
1482(*)S
(m_type)252 1692 A
(TTY_LINE)336 2196 A
(PROC_NR)294 2658 A
(COUNT)210 3120 A
(TTY_SPEK)336 3456 A
(TTY_FLAGS)378 3876 A
(ADDRESS)294 4338 A
1935 V
(13632)210 1122 A
1482(*)S
(---------------------------------------------------------------------------)3150 1566 A
2025 V
(13633)210 1122 A
1482(*)S
1566(|)S
(HARD_INT)336 1650 A
2154(|)S
2574(|)S
2994(|)S
3414(|)S
3834(|)S
4254(|)S
4674(|)S
2115 V
(13634)210 1122 A
1482(*)S
(|-------------+---------+---------+---------+---------+---------+---------|)3150 1566 A
2205 V
(13635)210 1122 A
1482(*)S
1566(|)S
(SYS_SIG)294 1650 A
2154(|)S
(sig)126 2238 A
(set)126 2406 A
2574(|)S
2994(|)S
3414(|)S
3834(|)S
4254(|)S
4674(|)S
2295 V
(13636)210 1122 A
1482(*)S
(|-------------+---------+---------+---------+---------+---------+---------|)3150 1566 A
2385 V
(13637)210 1122 A
1482(*)S
1566(|)S
(DEV_READ)336 1650 A
(|minor)252 2154 A
(dev|)168 2448 A
(proc)168 2658 A
2868(nr)S
2994(|)S
(count)210 3120 A
3414(|)S
(O_NONBLOCK|)462 3834 A
(buf)126 4338 A
(ptr)126 4506 A
4674(|)S
2475 V
(13638)210 1122 A
1482(*)S
(|-------------+---------+---------+---------+---------+---------+---------|)3150 1566 A
2565 V
(13639)210 1122 A
1482(*)S
1566(|)S
(DEV_WRITE)378 1650 A
(|minor)252 2154 A
(dev|)168 2448 A
(proc)168 2658 A
2868(nr)S
2994(|)S
(count)210 3120 A
3414(|)S
3834(|)S
4254(|)S
(buf)126 4338 A
(ptr)126 4506 A
4674(|)S
2655 V
(13640)210 1122 A
1482(*)S
(|-------------+---------+---------+---------+---------+---------+---------|)3150 1566 A
2745 V
(13641)210 1122 A
1482(*)S
1566(|)S
(DEV_IOCTL)378 1650 A
(|minor)252 2154 A
(dev|)168 2448 A
(proc)168 2658 A
2868(nr)S
(|func)210 2994 A
(code|erase)420 3246 A
(etc|)168 3708 A
(flags)210 3960 A
4254(|)S
4674(|)S
2835 V
(13642)210 1122 A
1482(*)S
(|-------------+---------+---------+---------+---------+---------+---------|)3150 1566 A
2925 V
(13643)210 1122 A
1482(*)S
1566(|)S
(DEV_OPEN)336 1650 A
(|minor)252 2154 A
(dev|)168 2448 A
(proc)168 2658 A
2868(nr)S
2994(|)S
(O_NOCTTY|)378 3078 A
3834(|)S
4254(|)S
4674(|)S
3015 V
(13644)210 1122 A
1482(*)S
(|-------------+---------+---------+---------+---------+---------+---------|)3150 1566 A
3105 V
(13645)210 1122 A
1482(*)S
1566(|)S
(DEV_CLOSE)378 1650 A
(|minor)252 2154 A
(dev|)168 2448 A
(proc)168 2658 A
2868(nr)S
2994(|)S
3414(|)S
3834(|)S
4254(|)S
4674(|)S
3195 V
(13646)210 1122 A
1482(*)S
(|-------------+---------+---------+---------+---------+---------+---------|)3150 1566 A
3285 V
(13647)210 1122 A
1482(*)S
1566(|)S
(DEV_STATUS)420 1650 A
2154(|)S
2574(|)S
2994(|)S
3414(|)S
3834(|)S
4254(|)S
4674(|)S
3375 V
(13648)210 1122 A
1482(*)S
(|-------------+---------+---------+---------+---------+---------+---------|)3150 1566 A
3465 V
(13649)210 1122 A
1482(*)S
1566(|)S
(CANCEL)252 1650 A
(|minor)252 2154 A
(dev|)168 2448 A
(proc)168 2658 A
2868(nr)S
2994(|)S
3414(|)S
3834(|)S
4254(|)S
4674(|)S
3555 V
(13650)210 1122 A
1482(*)S
(---------------------------------------------------------------------------)3150 1566 A
3645 V
(13651)210 1122 A
1482(*)S
3735 V
(13652)210 1122 A
1482(*)S
(Changes:)336 1566 A
3825 V
(13653)210 1122 A
1482(*)S
(Jan)126 1650 A
(20,)126 1818 A
(2004)168 1986 A
(moved)210 2280 A
(TTY)126 2532 A
(driver)252 2700 A
2994(to)S
(user-space)420 3120 A
(\(Jorrit)294 3624 A
3960(N.)S
(Herder\))294 4086 A
3915 V
(13654)210 1122 A
1482(*)S
(Sep)126 1650 A
(20,)126 1818 A
(2004)168 1986 A
(local)210 2280 A
(timer)210 2532 A
(management/)462 2784 A
(sync)168 3288 A
(alarms)252 3498 A
(\(Jorrit)294 3834 A
4170(N.)S
(Herder\))294 4296 A
4005 V
(13655)210 1122 A
1482(*)S
(Jul)126 1650 A
(13,)126 1818 A
(2004)168 1986 A
(support)294 2280 A
(for)126 2616 A
(function)336 2784 A
(key)126 3162 A
(observers)378 3330 A
(\(Jorrit)294 3792 A
4128(N.)S
(Herder\))294 4254 A
4095 V
(13656)210 1122 A
1482(*/)S
4185 V
(13657)210 1122 A
4275 V
(13658)210 1122 A
(#include)336 1440 A
("../drivers.h")588 1818 A
4365 V
(13659)210 1122 A
(#include)336 1440 A
("../drivers.h")588 1818 A
4455 V
(13660)210 1122 A
(#include)336 1440 A
(<termios.h>)462 1818 A
4545 V
(13661)210 1122 A
(#include)336 1440 A
(<sys/ioc_tty.h>)630 1818 A
4635 V
(13662)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
4725 V
(13663)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
4815 V
(13664)210 1122 A
(#include)336 1440 A
(<minix/keymap.h>)672 1818 A
4905 V
(13665)210 1122 A
(#include)336 1440 A
("tty.h")294 1818 A
4995 V
(13666)210 1122 A
5085 V
(13667)210 1122 A
(#include)336 1440 A
(<sys/time.h>)504 1818 A
5175 V
(13668)210 1122 A
(#include)336 1440 A
(<sys/select.h>)588 1818 A
5265 V
(13669)210 1122 A
5355 V
(13670)210 1122 A
(extern)252 1440 A
(int)126 1734 A
(irq_hook_id;)504 1902 A
5445 V
(13671)210 1122 A
5535 V
(13672)210 1122 A
(unsigned)336 1440 A
(long)168 1818 A
(kbd_irq_set)462 2028 A
2532(=)S
2616(0;)S
5625 V
(13673)210 1122 A
(unsigned)336 1440 A
(long)168 1818 A
(rs_irq_set)420 2028 A
2490(=)S
2574(0;)S
5715 V
(13674)210 1122 A
5805 V
(13675)210 1122 A
1440(/*)S
(Address)294 1566 A
1902(of)S
2028(a)S
(tty)126 2112 A
(structure.)420 2280 A
2742(*/)S
5895 V
(13676)210 1122 A
(#define)294 1440 A
(tty_addr\(line\))588 1776 A
(\(&tty_table[line]\))756 2448 A
5985 V
(13677)210 1122 A
6075 V
(13678)210 1122 A
1440(/*)S
(Macros)252 1566 A
(for)126 1860 A
(magic)210 2028 A
(tty)126 2280 A
(types.)252 2448 A
2742(*/)S
6165 V
(13679)210 1122 A
(#define)294 1440 A
(isconsole\(tp\))546 1776 A
(\(\(tp\))210 2448 A
2700(<)S
(tty_addr\(NR_CONS\)\))756 2784 A
6255 V
(13680)210 1122 A
(#define)294 1440 A
(ispty\(tp\))378 1776 A
(\(\(tp\))210 2448 A
2700(>=)S
(tty_addr\(NR_CONS+NR_RS_LINES\)\))1260 2826 A
6345 V
(13681)210 1122 A
6435 V
(13682)210 1122 A
1440(/*)S
(Macros)252 1566 A
(for)126 1860 A
(magic)210 2028 A
(tty)126 2280 A
(structure)378 2448 A
(pointers.)378 2868 A
3288(*/)S
6525 V
(13683)210 1122 A
(#define)294 1440 A
(FIRST_TTY)378 1776 A
(tty_addr\(0\))462 2448 A
6615 V
(13684)210 1122 A
(#define)294 1440 A
(END_TTY)294 1776 A
(tty_addr\(sizeof\(tty_table\))1092 2448 A
3582(/)S
(sizeof\(tty_table[0]\)\))882 3666 A
6705 V
(13685)210 1122 A
6795 V
(13686)210 1122 A
1440(/*)S
1566(A)S
(device)252 1650 A
(exists)252 1944 A
2238(if)S
2364(at)S
(least)210 2490 A
(its)126 2742 A
('devread')378 2910 A
(function)336 3330 A
3708(is)S
(defined.)336 3834 A
4212(*/)S
6885 V
(13687)210 1122 A
(#define)294 1440 A
(tty_active\(tp\))588 1776 A
(\(\(tp\)->tty_devread)756 2448 A
3246(!=)S
(NULL\))210 3372 A
6975 V
(13688)210 1122 A
7065 V
(13689)210 1122 A
1440(/*)S
(RS232)210 1566 A
(lines)210 1818 A
2070(or)S
(pseudo)252 2196 A
(terminals)378 2490 A
(can)126 2910 A
3078(be)S
(completely)420 3204 A
(configured)420 3666 A
(out.)168 4128 A
4338(*/)S
8418 V
EP
%%Page: 175 175
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
12 B
(175)180 4500 A
1755 V
7 LST
(13690)210 1122 A
(#if)126 1440 A
(NR_RS_LINES)462 1608 A
2112(==)S
2238(0)S
1845 V
(13691)210 1122 A
(#define)294 1440 A
(rs_init\(tp\))462 1776 A
(\(\(void\))294 2448 A
2784(0\))S
1935 V
(13692)210 1122 A
(#endif)252 1440 A
2025 V
(13693)210 1122 A
(#if)126 1440 A
(NR_PTYS)294 1608 A
1944(==)S
2070(0)S
2115 V
(13694)210 1122 A
(#define)294 1440 A
(pty_init\(tp\))504 1776 A
(\(\(void\))294 2448 A
2784(0\))S
2205 V
(13695)210 1122 A
(#define)294 1440 A
(do_pty\(tp,)420 1776 A
(mp\))126 2238 A
(\(\(void\))294 2448 A
2784(0\))S
2295 V
(13696)210 1122 A
(#endif)252 1440 A
2385 V
(13697)210 1122 A
2475 V
(13698)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(tty_timed_out,)588 2490 A
(\(timer_t)336 3120 A
(*tp\))168 3498 A
4464(\);)S
2565 V
(13699)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(expire_timers,)588 2490 A
(\(void\))252 3120 A
4464(\);)S
2655 V
(13700)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(settimer,)378 2490 A
(\(tty_t)252 2910 A
(*tty_ptr,)378 3204 A
(int)126 3624 A
(enable\))294 3792 A
4464(\);)S
2745 V
(13701)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(do_cancel,)420 2490 A
(\(tty_t)252 2952 A
(*tp,)168 3246 A
(message)294 3456 A
(*m_ptr\))294 3792 A
4464(\);)S
2835 V
(13702)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(do_ioctl,)378 2490 A
(\(tty_t)252 2910 A
(*tp,)168 3204 A
(message)294 3414 A
(*m_ptr\))294 3750 A
4464(\);)S
2925 V
(13703)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(do_open,)336 2490 A
(\(tty_t)252 2868 A
(*tp,)168 3162 A
(message)294 3372 A
(*m_ptr\))294 3708 A
4464(\);)S
3015 V
(13704)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(do_close,)378 2490 A
(\(tty_t)252 2910 A
(*tp,)168 3204 A
(message)294 3414 A
(*m_ptr\))294 3750 A
4464(\);)S
3105 V
(13705)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(do_read,)336 2490 A
(\(tty_t)252 2868 A
(*tp,)168 3162 A
(message)294 3372 A
(*m_ptr\))294 3708 A
4464(\);)S
3195 V
(13706)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(do_write,)378 2490 A
(\(tty_t)252 2910 A
(*tp,)168 3204 A
(message)294 3414 A
(*m_ptr\))294 3750 A
4464(\);)S
3285 V
(13707)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(do_select,)420 2490 A
(\(tty_t)252 2952 A
(*tp,)168 3246 A
(message)294 3456 A
(*m_ptr\))294 3792 A
4464(\);)S
3375 V
(13708)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(do_status,)420 2490 A
(\(message)336 2952 A
(*m_ptr\))294 3330 A
4464(\);)S
3465 V
(13709)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(in_transfer,)504 2490 A
(\(tty_t)252 3036 A
(*tp\))168 3330 A
4464(\);)S
3555 V
(13710)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(tty_echo,)378 2448 A
(\(tty_t)252 2868 A
(*tp,)168 3162 A
(int)126 3372 A
(ch\))126 3540 A
4464(\);)S
3645 V
(13711)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(rawecho,)336 2490 A
(\(tty_t)252 2868 A
(*tp,)168 3162 A
(int)126 3372 A
(ch\))126 3540 A
4464(\);)S
3735 V
(13712)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(back_over,)420 2448 A
(\(tty_t)252 2910 A
(*tp\))168 3204 A
4464(\);)S
3825 V
(13713)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(reprint,)336 2490 A
(\(tty_t)252 2868 A
(*tp\))168 3162 A
4464(\);)S
3915 V
(13714)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(dev_ioctl,)420 2490 A
(\(tty_t)252 2952 A
(*tp\))168 3246 A
4464(\);)S
4005 V
(13715)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(setattr,)336 2490 A
(\(tty_t)252 2868 A
(*tp\))168 3162 A
4464(\);)S
4095 V
(13716)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(tty_icancel,)504 2490 A
(\(tty_t)252 3036 A
(*tp\))168 3330 A
4464(\);)S
4185 V
(13717)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(tty_init,)378 2490 A
(\(void\))252 2910 A
4464(\);)S
4275 V
(13718)210 1122 A
4365 V
(13719)210 1122 A
1440(/*)S
(Default)294 1566 A
(attributes.)462 1902 A
2406(*/)S
4455 V
(13720)210 1122 A
(PRIVATE)294 1440 A
(struct)252 1776 A
(termios)294 2070 A
(termios_defaults)672 2406 A
3120(=)S
3204({)S
4545 V
(13721)210 1122 A
(TINPUT_DEF,)462 1524 A
(TOUTPUT_DEF,)504 2028 A
(TCTRL_DEF,)420 2574 A
(TLOCAL_DEF,)462 3036 A
(TSPEED_DEF,)462 3540 A
(TSPEED_DEF,)462 4044 A
4635 V
(13722)210 1122 A
1524({)S
4725 V
(13723)210 1122 A
(TEOF_DEF,)378 1776 A
(TEOL_DEF,)378 2196 A
(TERASE_DEF,)462 2616 A
(TINTR_DEF,)420 3120 A
(TKILL_DEF,)420 3582 A
(TMIN_DEF,)378 4044 A
4815 V
(13724)210 1122 A
(TQUIT_DEF,)420 1776 A
(TTIME_DEF,)420 2238 A
(TSUSP_DEF,)420 2700 A
(TSTART_DEF,)462 3162 A
(TSTOP_DEF,)420 3666 A
4905 V
(13725)210 1122 A
(TREPRINT_DEF,)546 1776 A
(TLNEXT_DEF,)462 2364 A
(TDISCARD_DEF,)546 2868 A
4995 V
(13726)210 1122 A
1524(},)S
5085 V
(13727)210 1122 A
1440(};)S
5175 V
(13728)210 1122 A
(PRIVATE)294 1440 A
(struct)252 1776 A
(winsize)294 2070 A
(winsize_defaults;)714 2406 A
3456(/*)S
3582(=)S
(all)126 3666 A
(zeroes)252 3834 A
4128(*/)S
5265 V
(13729)210 1122 A
5355 V
(13730)210 1122 A
1440(/*)S
(Global)252 1566 A
(variables)378 1860 A
(for)126 2280 A
(the)126 2448 A
(TTY)126 2616 A
(task)168 2784 A
(\(declared)378 2994 A
(extern)252 3414 A
3708(in)S
(tty.h\).)294 3834 A
4170(*/)S
5445 V
(13731)210 1122 A
(PUBLIC)252 1440 A
(tty_t)210 1734 A
(tty_table[NR_CONS+NR_RS_LINES+NR_PTYS];)1638 1986 A
5535 V
(13732)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(ccurrent;)378 1902 A
3120(/*)S
(currently)378 3246 A
(active)252 3666 A
(console)294 3960 A
4296(*/)S
5625 V
(13733)210 1122 A
(PUBLIC)252 1440 A
(timer_t)294 1734 A
(*tty_timers;)504 2070 A
3120(/*)S
(queue)210 3246 A
3498(of)S
(TTY)126 3624 A
(timers)252 3792 A
4086(*/)S
5715 V
(13734)210 1122 A
(PUBLIC)252 1440 A
(clock_t)294 1734 A
(tty_next_timeout;)714 2070 A
3120(/*)S
(time)168 3246 A
(that)168 3456 A
(the)126 3666 A
(next)168 3834 A
(alarm)210 4044 A
4296(is)S
(due)126 4422 A
4590(*/)S
5805 V
(13735)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(machine)294 2028 A
(machine;)336 2364 A
3120(/*)S
(kernel)252 3246 A
(environment)462 3540 A
(variables)378 4044 A
4464(*/)S
5895 V
(13736)210 1122 A
5985 V
(13737)210 1122 A
(/*===========================================================================*)3276 1440 A
6075 V
(13738)210 1122 A
1482(*)S
(tty_task)336 2784 A
4674(*)S
6165 V
(13739)210 1122 A
(*===========================================================================*/)3276 1482 A
6255 V
(13740)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(main\(void\))420 1944 A
6345 V
(13741)210 1122 A
1440({)S
6435 V
(13742)210 1122 A
1440(/*)S
(Main)168 1566 A
(routine)294 1776 A
2112(of)S
(the)126 2238 A
(terminal)336 2406 A
(task.)210 2784 A
3036(*/)S
6525 V
(13743)210 1122 A
6615 V
(13744)210 1122 A
(message)294 1524 A
(tty_mess;)378 1860 A
2784(/*)S
(buffer)252 2910 A
(for)126 3204 A
(all)126 3372 A
(incoming)336 3540 A
(messages)336 3918 A
4296(*/)S
6705 V
(13745)210 1122 A
(unsigned)336 1524 A
(line;)210 1902 A
6795 V
(13746)210 1122 A
(int)126 1524 A
1692(s;)S
6885 V
(13747)210 1122 A
(char)168 1524 A
(*types[])336 1734 A
2112(=)S
({"task","driver","server",)1092 2196 A
("user"};)336 3330 A
6975 V
(13748)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(proc)168 2196 A
(*rp;)168 2406 A
7065 V
(13749)210 1122 A
(register)336 1524 A
(tty_t)210 1902 A
(*tp;)168 2154 A
8418 V
EP
%%Page: 176 176
BP
/slant 0 def
/height 0 def
1485 V
12 B
(176)180 1080 A
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(13750)210 1122 A
1845 V
(13751)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(the)126 2112 A
(TTY)126 2280 A
(driver.)294 2448 A
2784(*/)S
1935 V
(13752)210 1122 A
(tty_init\(\);)462 1524 A
2025 V
(13753)210 1122 A
2115 V
(13754)210 1122 A
1524(/*)S
(Get)126 1650 A
(kernel)252 1818 A
(environment)462 2112 A
(\(protected_mode,)672 2616 A
(pc_at)210 3330 A
(and)126 3582 A
(ega)126 3750 A
(are)126 3918 A
(needed\).)336 4086 A
4464(*/)S
2205 V
(13755)210 1122 A
1524(if)S
(\(OK)126 1650 A
1818(!=)S
(\(s=sys_getmachine\(&machine\)\)\))1218 1944 A
3204({)S
2295 V
(13756)210 1122 A
(panic\("TTY","Couldn't)882 1608 A
(obtain)252 2532 A
(kernel)252 2826 A
(environment.",)588 3120 A
(s\);)126 3750 A
2385 V
(13757)210 1122 A
1524(})S
2475 V
(13758)210 1122 A
2565 V
(13759)210 1122 A
1524(/*)S
(Final)210 1650 A
(one-time)336 1902 A
(keyboard)336 2280 A
(initialization.)630 2658 A
3330(*/)S
2655 V
(13760)210 1122 A
(kb_init_once\(\);)630 1524 A
2745 V
(13761)210 1122 A
2835 V
(13762)210 1122 A
(printf\("\\n"\);)546 1524 A
2925 V
(13763)210 1122 A
3015 V
(13764)210 1122 A
(while)210 1524 A
(\(TRUE\))252 1776 A
2070({)S
3105 V
(13765)210 1122 A
3195 V
(13766)210 1122 A
1776(/*)S
(Check)210 1902 A
(for)126 2154 A
(and)126 2322 A
(handle)252 2490 A
(any)126 2784 A
(events)252 2952 A
3246(on)S
(any)126 3372 A
3540(of)S
(the)126 3666 A
(ttys.)210 3834 A
4086(*/)S
3285 V
(13767)210 1122 A
(for)126 1776 A
(\(tp)126 1944 A
2112(=)S
(FIRST_TTY;)420 2196 A
2658(tp)S
2784(<)S
(END_TTY;)336 2868 A
(tp++\))210 3246 A
3498({)S
3375 V
(13768)210 1122 A
2112(if)S
(\(tp->tty_events\))672 2238 A
(handle_events\(tp\);)756 2952 A
3465 V
(13769)210 1122 A
1776(})S
3555 V
(13770)210 1122 A
3645 V
(13771)210 1122 A
1776(/*)S
(Get)126 1902 A
2070(a)S
(request)294 2154 A
(message.)336 2490 A
2868(*/)S
3735 V
(13772)210 1122 A
(receive\(ANY,)504 1776 A
(&tty_mess\);)462 2322 A
3825 V
(13773)210 1122 A
3915 V
(13774)210 1122 A
1776(/*)S
(First)210 1902 A
(handle)252 2154 A
(all)126 2448 A
(kernel)252 2616 A
(notification)504 2910 A
(types)210 3456 A
(that)168 3708 A
(the)126 3918 A
(TTY)126 4086 A
(supports.)378 4254 A
4005 V
(13775)210 1122 A
1818(*)S
1944(-)S
2028(An)S
(alarm)210 2154 A
(went)168 2406 A
(off,)168 2616 A
(expire)252 2826 A
(all)126 3120 A
(timers)252 3288 A
(and)126 3582 A
(handle)252 3750 A
(the)126 4044 A
(events.)294 4212 A
4095 V
(13776)210 1122 A
1818(*)S
1944(-)S
2028(A)S
(hardware)336 2112 A
(interrupt)378 2490 A
(also)168 2910 A
3120(is)S
3246(an)S
(invitation)420 3372 A
3834(to)S
(check)210 3960 A
(for)126 4212 A
(events.)294 4380 A
4185 V
(13777)210 1122 A
1818(*)S
1944(-)S
2028(A)S
(new)126 2112 A
(kernel)252 2280 A
(message)294 2574 A
2910(is)S
(available)378 3036 A
(for)126 3456 A
(printing.)378 3624 A
4275 V
(13778)210 1122 A
1818(*)S
1944(-)S
(Reset)210 2028 A
(the)126 2280 A
(console)294 2448 A
2784(on)S
(system)252 2910 A
(shutdown.)378 3204 A
4365 V
(13779)210 1122 A
1818(*)S
(Then)168 1902 A
(see)126 2112 A
2280(if)S
(this)168 2406 A
(message)294 2616 A
2952(is)S
(different)378 3078 A
(from)168 3498 A
3708(a)S
(normal)252 3792 A
(device)252 4086 A
(driver)252 4380 A
4455 V
(13780)210 1122 A
1818(*)S
(request)294 1902 A
(and)126 2238 A
(should)252 2406 A
2700(be)S
(handled)294 2826 A
(separately.)462 3162 A
(These)210 3666 A
(extra)210 3918 A
(functions)378 4170 A
4545 V
(13781)210 1122 A
1818(*)S
1902(do)S
(not)126 2028 A
(operate)294 2196 A
2532(on)S
2658(a)S
(device,)294 2742 A
3078(in)S
(constrast)378 3204 A
3624(to)S
(the)126 3750 A
(driver)252 3918 A
(requests.)378 4212 A
4635 V
(13782)210 1122 A
1818(*/)S
4725 V
(13783)210 1122 A
(switch)252 1776 A
(\(tty_mess.m_type\))714 2070 A
2826({)S
4815 V
(13784)210 1122 A
(case)168 1776 A
(SYN_ALARM:)420 1986 A
3120(/*)S
(fall)168 3246 A
(through)294 3456 A
3792(*/)S
4905 V
(13785)210 1122 A
(expire_timers\(\);)672 2112 A
3120(/*)S
(run)126 3246 A
(watchdogs)378 3414 A
3834(of)S
(expired)294 3960 A
(timers)252 4296 A
4590(*/)S
4995 V
(13786)210 1122 A
(continue;)378 2112 A
3120(/*)S
(contine)294 3246 A
3582(to)S
(check)210 3708 A
(for)126 3960 A
(events)252 4128 A
4422(*/)S
5085 V
(13787)210 1122 A
(case)168 1776 A
(HARD_INT:)378 1986 A
2406({)S
3120(/*)S
(hardware)336 3246 A
(interrupt)378 3624 A
(notification)504 4044 A
4590(*/)S
5175 V
(13788)210 1122 A
2112(if)S
(\(tty_mess.NOTIFY_ARG)840 2238 A
3120(&)S
(kbd_irq_set\))504 3204 A
5265 V
(13789)210 1122 A
(kbd_interrupt\(&tty_mess\);/*)1134 2448 A
(fetch)210 3624 A
(chars)210 3876 A
(from)168 4128 A
(keyboard)336 4338 A
4716(*/)S
5355 V
(13790)210 1122 A
(#if)126 1440 A
(NR_RS_LINES)462 1608 A
2112(>)S
2196(0)S
5445 V
(13791)210 1122 A
2112(if)S
(\(tty_mess.NOTIFY_ARG)840 2238 A
3120(&)S
(rs_irq_set\))462 3204 A
5535 V
(13792)210 1122 A
(rs_interrupt\(&tty_mess\);/*)1092 2448 A
(serial)252 3582 A
(I/O)126 3876 A
4044(*/)S
5625 V
(13793)210 1122 A
(#endif)252 1440 A
5715 V
(13794)210 1122 A
(expire_timers\(\);)672 2112 A
3120(/*)S
(run)126 3246 A
(watchdogs)378 3414 A
3834(of)S
(expired)294 3960 A
(timers)252 4296 A
4590(*/)S
5805 V
(13795)210 1122 A
(continue;)378 2112 A
3120(/*)S
(contine)294 3246 A
3582(to)S
(check)210 3708 A
(for)126 3960 A
(events)252 4128 A
4422(*/)S
5895 V
(13796)210 1122 A
1776(})S
5985 V
(13797)210 1122 A
(case)168 1776 A
(SYS_SIG:)336 1986 A
2364({)S
3120(/*)S
(system)252 3246 A
(signal)252 3540 A
3834(*/)S
6075 V
(13798)210 1122 A
(sigset_t)336 2112 A
(sigset)252 2490 A
2784(=)S
(\(sigset_t\))420 2868 A
(tty_mess.NOTIFY_ARG;)840 3330 A
6165 V
(13799)210 1122 A
6255 V
(13800)210 1122 A
2112(if)S
(\(sigismember\(&sigset,)882 2238 A
(SIGKSTOP\)\))420 3162 A
3624({)S
6345 V
(13801)210 1122 A
(cons_stop\(\);)504 2448 A
3456(/*)S
(switch)252 3582 A
3876(to)S
(primary)294 4002 A
(console)294 4338 A
4674(*/)S
6435 V
(13802)210 1122 A
2448(if)S
(\(irq_hook_id)504 2574 A
3120(!=)S
(-1\))126 3246 A
3414({)S
6525 V
(13803)210 1122 A
(sys_irqdisable\(&irq_hook_id\);)1218 2784 A
6615 V
(13804)210 1122 A
(sys_irqrmpolicy\(KEYBOARD_IRQ,)1218 2784 A
(&irq_hook_id\);)588 4044 A
6705 V
(13805)210 1122 A
2448(})S
6795 V
(13806)210 1122 A
2112(})S
6885 V
(13807)210 1122 A
2112(if)S
(\(sigismember\(&sigset,)882 2238 A
(SIGTERM\)\))378 3162 A
(cons_stop\(\);)504 3582 A
6975 V
(13808)210 1122 A
2112(if)S
(\(sigismember\(&sigset,)882 2238 A
(SIGKMESS\)\))420 3162 A
(do_new_kmess\(&tty_mess\);)1008 3624 A
7065 V
(13809)210 1122 A
(continue;)378 2112 A
8418 V
EP
%%Page: 177 177
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
12 B
(177)180 4500 A
1755 V
7 LST
(13810)210 1122 A
1776(})S
1845 V
(13811)210 1122 A
(case)168 1776 A
(PANIC_DUMPS:)504 1986 A
3120(/*)S
(allow)210 3246 A
(panic)210 3498 A
(dumps)210 3750 A
4002(*/)S
1935 V
(13812)210 1122 A
(cons_stop\(\);)504 2112 A
3120(/*)S
(switch)252 3246 A
3540(to)S
(primary)294 3666 A
(console)294 4002 A
4338(*/)S
2025 V
(13813)210 1122 A
(do_panic_dumps\(&tty_mess\);)1092 2112 A
2115 V
(13814)210 1122 A
(continue;)378 2112 A
2205 V
(13815)210 1122 A
(case)168 1776 A
(DIAGNOSTICS:)504 1986 A
3120(/*)S
3246(a)S
(server)252 3330 A
(wants)210 3624 A
3876(to)S
(print)210 4002 A
(some)168 4254 A
4464(*/)S
2295 V
(13816)210 1122 A
(do_diagnostics\(&tty_mess\);)1092 2112 A
2385 V
(13817)210 1122 A
(continue;)378 2112 A
2475 V
(13818)210 1122 A
(case)168 1776 A
(FKEY_CONTROL:)546 1986 A
3120(/*)S
(\(un\)register)504 3246 A
3792(a)S
(fkey)168 3876 A
(observer)336 4086 A
4464(*/)S
2565 V
(13819)210 1122 A
(do_fkey_ctl\(&tty_mess\);)966 2112 A
2655 V
(13820)210 1122 A
(continue;)378 2112 A
2745 V
(13821)210 1122 A
(default:)336 1776 A
3120(/*)S
(should)252 3246 A
3540(be)S
3666(a)S
(driver)252 3750 A
(request)294 4044 A
4380(*/)S
2835 V
(13822)210 1122 A
2112(;)S
3120(/*)S
3246(do)S
(nothing;)336 3372 A
(end)126 3750 A
(switch)252 3918 A
4212(*/)S
2925 V
(13823)210 1122 A
1776(})S
3015 V
(13824)210 1122 A
3105 V
(13825)210 1122 A
1776(/*)S
(Only)168 1902 A
(device)252 2112 A
(requests)336 2406 A
(should)252 2784 A
(get)126 3078 A
3246(to)S
(this)168 3372 A
(point.)252 3582 A
(All)126 3876 A
(requests,)378 4044 A
3195 V
(13826)210 1122 A
1818(*)S
(except)252 1902 A
(DEV_STATUS,)462 2196 A
(have)168 2700 A
2910(a)S
(minor)210 2994 A
(device)252 3246 A
(number.)294 3540 A
(Check)210 3876 A
(this)168 4128 A
3285 V
(13827)210 1122 A
1818(*)S
(exception)378 1902 A
(and)126 2322 A
(get)126 2490 A
(the)126 2658 A
(minor)210 2826 A
(device)252 3078 A
(number)252 3372 A
(otherwise.)420 3666 A
3375 V
(13828)210 1122 A
1818(*/)S
3465 V
(13829)210 1122 A
1776(if)S
(\(tty_mess.m_type)672 1902 A
2616(==)S
(DEV_STATUS\))462 2742 A
3246({)S
3555 V
(13830)210 1122 A
(do_status\(&tty_mess\);)882 2112 A
3645 V
(13831)210 1122 A
(continue;)378 2112 A
3735 V
(13832)210 1122 A
1776(})S
3825 V
(13833)210 1122 A
(line)168 1776 A
1986(=)S
(tty_mess.TTY_LINE;)756 2070 A
3915 V
(13834)210 1122 A
1776(if)S
(\(\(line)252 1902 A
2196(-)S
(CONS_MINOR\))462 2280 A
2784(<)S
(NR_CONS\))336 2868 A
3246({)S
4005 V
(13835)210 1122 A
2112(tp)S
2238(=)S
(tty_addr\(line)546 2322 A
2910(-)S
(CONS_MINOR\);)504 2994 A
4095 V
(13836)210 1122 A
1776(})S
(else)168 1860 A
2070(if)S
(\(line)210 2196 A
2448(==)S
(LOG_MINOR\))420 2574 A
3036({)S
4185 V
(13837)210 1122 A
2112(tp)S
2238(=)S
(tty_addr\(0\);)504 2322 A
4275 V
(13838)210 1122 A
1776(})S
(else)168 1860 A
2070(if)S
(\(\(line)252 2196 A
2490(-)S
(RS232_MINOR\))504 2574 A
3120(<)S
(NR_RS_LINES\))504 3204 A
3750({)S
4365 V
(13839)210 1122 A
2112(tp)S
2238(=)S
(tty_addr\(line)546 2322 A
2910(-)S
(RS232_MINOR)462 2994 A
3498(+)S
(NR_CONS\);)378 3582 A
4455 V
(13840)210 1122 A
1776(})S
(else)168 1860 A
2070(if)S
(\(\(line)252 2196 A
2490(-)S
(TTYPX_MINOR\))504 2574 A
3120(<)S
(NR_PTYS\))336 3204 A
3582({)S
4545 V
(13841)210 1122 A
2112(tp)S
2238(=)S
(tty_addr\(line)546 2322 A
2910(-)S
(TTYPX_MINOR)462 2994 A
3498(+)S
(NR_CONS)294 3582 A
3918(+)S
(NR_RS_LINES\);)546 4002 A
4635 V
(13842)210 1122 A
1776(})S
(else)168 1860 A
2070(if)S
(\(\(line)252 2196 A
2490(-)S
(PTYPX_MINOR\))504 2574 A
3120(<)S
(NR_PTYS\))336 3204 A
3582({)S
4725 V
(13843)210 1122 A
2112(tp)S
2238(=)S
(tty_addr\(line)546 2322 A
2910(-)S
(PTYPX_MINOR)462 2994 A
3498(+)S
(NR_CONS)294 3582 A
3918(+)S
(NR_RS_LINES\);)546 4002 A
4815 V
(13844)210 1122 A
2112(if)S
(\(tty_mess.m_type)672 2238 A
2952(!=)S
(DEV_IOCTL\))420 3078 A
3540({)S
4905 V
(13845)210 1122 A
(do_pty\(tp,)420 2448 A
(&tty_mess\);)462 2910 A
4995 V
(13846)210 1122 A
(continue;)378 2448 A
5085 V
(13847)210 1122 A
2112(})S
5175 V
(13848)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
5265 V
(13849)210 1122 A
2112(tp)S
2238(=)S
(NULL;)210 2322 A
5355 V
(13850)210 1122 A
1776(})S
5445 V
(13851)210 1122 A
5535 V
(13852)210 1122 A
1776(/*)S
1902(If)S
(the)126 2028 A
(device)252 2196 A
(doesn't)294 2490 A
(exist)210 2826 A
3078(or)S
3204(is)S
(not)126 3330 A
(configured)420 3498 A
(return)252 3960 A
(ENXIO.)252 4254 A
4548(*/)S
5625 V
(13853)210 1122 A
1776(if)S
(\(tp)126 1902 A
2070(==)S
(NULL)168 2196 A
2406(||)S
2532(!)S
(tty_active\(tp\)\))630 2616 A
3288({)S
5715 V
(13854)210 1122 A
(printf\("Warning,)672 2112 A
(TTY)126 2826 A
(got)126 2994 A
(illegal)294 3162 A
(request)294 3498 A
3834(%d)S
(from)168 3960 A
(%d\\n",)252 4170 A
5805 V
(13855)210 1122 A
(tty_mess.m_type,)672 2448 A
(tty_mess.m_source\);)798 3162 A
5895 V
(13856)210 1122 A
(tty_reply\(TASK_REPLY,)882 2112 A
(tty_mess.m_source,)756 3036 A
5985 V
(13857)210 1122 A
(tty_mess.PROC_NR,)714 3456 A
(ENXIO\);)294 4212 A
6075 V
(13858)210 1122 A
(continue;)378 2112 A
6165 V
(13859)210 1122 A
1776(})S
6255 V
(13860)210 1122 A
6345 V
(13861)210 1122 A
1776(/*)S
(Execute)294 1902 A
(the)126 2238 A
(requested)378 2406 A
(device)252 2826 A
(driver)252 3120 A
(function.)378 3414 A
3834(*/)S
6435 V
(13862)210 1122 A
(switch)252 1776 A
(\(tty_mess.m_type\))714 2070 A
2826({)S
6525 V
(13863)210 1122 A
(case)168 1944 A
(DEV_READ:)378 2154 A
(do_read\(tp,)462 2826 A
(&tty_mess\);)462 3330 A
(break;)252 4212 A
6615 V
(13864)210 1122 A
(case)168 1944 A
(DEV_WRITE:)420 2154 A
(do_write\(tp,)504 2826 A
(&tty_mess\);)462 3372 A
(break;)252 4212 A
6705 V
(13865)210 1122 A
(case)168 1944 A
(DEV_IOCTL:)420 2154 A
(do_ioctl\(tp,)504 2826 A
(&tty_mess\);)462 3372 A
(break;)252 4212 A
6795 V
(13866)210 1122 A
(case)168 1944 A
(DEV_OPEN:)378 2154 A
(do_open\(tp,)462 2826 A
(&tty_mess\);)462 3330 A
(break;)252 4212 A
6885 V
(13867)210 1122 A
(case)168 1944 A
(DEV_CLOSE:)420 2154 A
(do_close\(tp,)504 2826 A
(&tty_mess\);)462 3372 A
(break;)252 4212 A
6975 V
(13868)210 1122 A
(case)168 1944 A
(DEV_SELECT:)462 2154 A
(do_select\(tp,)546 2826 A
(&tty_mess\);)462 3414 A
(break;)252 4212 A
7065 V
(13869)210 1122 A
(case)168 1944 A
(CANCEL:)294 2154 A
(do_cancel\(tp,)546 2826 A
(&tty_mess\);)462 3414 A
(break;)252 4212 A
8418 V
EP
%%Page: 178 178
BP
/slant 0 def
/height 0 def
1485 V
12 B
(178)180 1080 A
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(13870)210 1122 A
(default:)336 1944 A
1845 V
(13871)210 1122 A
(printf\("Warning,)672 2112 A
(TTY)126 2826 A
(got)126 2994 A
(unexpected)420 3162 A
(request)294 3624 A
3960(%d)S
(from)168 4086 A
(%d\\n",)252 4296 A
1935 V
(13872)210 1122 A
(tty_mess.m_type,)672 2448 A
(tty_mess.m_source\);)798 3162 A
2025 V
(13873)210 1122 A
(tty_reply\(TASK_REPLY,)882 1944 A
(tty_mess.m_source,)756 2868 A
2115 V
(13874)210 1122 A
(tty_mess.PROC_NR,)714 3456 A
(EINVAL\);)336 4212 A
2205 V
(13875)210 1122 A
1776(})S
2295 V
(13876)210 1122 A
1524(})S
2385 V
(13877)210 1122 A
1440(})S
2565 V
(13879)210 1122 A
(/*===========================================================================*)3276 1440 A
2655 V
(13880)210 1122 A
1482(*)S
(do_status)378 2784 A
4674(*)S
2745 V
(13881)210 1122 A
(*===========================================================================*/)3276 1482 A
2835 V
(13882)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(do_status\(m_ptr\))672 1986 A
2925 V
(13883)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
3015 V
(13884)210 1122 A
1440({)S
3105 V
(13885)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(tty)126 2196 A
(*tp;)168 2364 A
3195 V
(13886)210 1122 A
(int)126 1524 A
(event_found;)504 1692 A
3285 V
(13887)210 1122 A
(int)126 1524 A
(status;)294 1692 A
3375 V
(13888)210 1122 A
(int)126 1524 A
(ops;)168 1692 A
3465 V
(13889)210 1122 A
3555 V
(13890)210 1122 A
1524(/*)S
(Check)210 1650 A
(for)126 1902 A
(select)252 2070 A
2364(or)S
(revive)252 2490 A
(events)252 2784 A
3078(on)S
(any)126 3204 A
3372(of)S
(the)126 3498 A
(ttys.)210 3666 A
3918(If)S
4044(we)S
(found)210 4170 A
(an,)126 4422 A
3645 V
(13891)210 1122 A
1566(*)S
(event)210 1650 A
(return)252 1902 A
2196(a)S
(single)252 2280 A
(status)252 2574 A
(message)294 2868 A
(for)126 3204 A
(it.)126 3372 A
(The)126 3540 A
3708(FS)S
(will)168 3834 A
(make)168 4044 A
(another)294 4254 A
3735 V
(13892)210 1122 A
1566(*)S
(call)168 1650 A
1860(to)S
(see)126 1986 A
2154(if)S
(there)210 2280 A
2532(is)S
(more.)210 2658 A
3825 V
(13893)210 1122 A
1566(*/)S
3915 V
(13894)210 1122 A
(event_found)462 1524 A
2028(=)S
2112(0;)S
4005 V
(13895)210 1122 A
(for)126 1524 A
(\(tp)126 1692 A
1860(=)S
(FIRST_TTY;)420 1944 A
2406(tp)S
2532(<)S
(END_TTY;)336 2616 A
(tp++\))210 2994 A
3246({)S
4095 V
(13896)210 1122 A
1776(if)S
(\(\(ops)210 1902 A
2154(=)S
(select_try\(tp,)588 2238 A
(tp->tty_select_ops\)\))840 2868 A
3750(&&)S
4185 V
(13897)210 1122 A
(tp->tty_select_proc)798 2448 A
3288(==)S
(m_ptr->m_source\))672 3414 A
4128({)S
4275 V
(13898)210 1122 A
4365 V
(13899)210 1122 A
2112(/*)S
(I/O)126 2238 A
(for)126 2406 A
2574(a)S
(selected)336 2658 A
(minor)210 3036 A
(device)252 3288 A
3582(is)S
(ready.)252 3708 A
4002(*/)S
4455 V
(13900)210 1122 A
(m_ptr->m_type)546 2112 A
2700(=)S
(DEV_IO_READY;)546 2784 A
4545 V
(13901)210 1122 A
(m_ptr->DEV_MINOR)672 2112 A
2826(=)S
(tp->tty_index;)588 2910 A
4635 V
(13902)210 1122 A
(m_ptr->DEV_SEL_OPS)756 2112 A
2910(=)S
(ops;)168 2994 A
4725 V
(13903)210 1122 A
4815 V
(13904)210 1122 A
(tp->tty_select_ops)756 2112 A
2910(&=)S
(\304ops;)210 3036 A
3456(/*)S
(unmark)252 3582 A
(select)252 3876 A
(event)210 4170 A
4422(*/)S
4905 V
(13905)210 1122 A
(event_found)462 2112 A
2616(=)S
2700(1;)S
4995 V
(13906)210 1122 A
(break;)252 2112 A
5085 V
(13907)210 1122 A
1776(})S
5175 V
(13908)210 1122 A
(else)168 1776 A
1986(if)S
(\(tp->tty_inrevived)756 2112 A
2910(&&)S
(tp->tty_incaller)672 3036 A
3750(==)S
(m_ptr->m_source\))672 3876 A
4590({)S
5265 V
(13909)210 1122 A
5355 V
(13910)210 1122 A
2112(/*)S
(Suspended)378 2238 A
(request)294 2658 A
(finished.)378 2994 A
(Send)168 3414 A
3624(a)S
(REVIVE.)294 3708 A
4044(*/)S
5445 V
(13911)210 1122 A
(m_ptr->m_type)546 2112 A
2700(=)S
(DEV_REVIVE;)462 2784 A
5535 V
(13912)210 1122 A
(m_ptr->REP_PROC_NR)756 2112 A
2910(=)S
(tp->tty_inproc;)630 2994 A
5625 V
(13913)210 1122 A
(m_ptr->REP_STATUS)714 2112 A
2868(=)S
(tp->tty_incum;)588 2952 A
5715 V
(13914)210 1122 A
5805 V
(13915)210 1122 A
(tp->tty_inleft)588 2112 A
2742(=)S
(tp->tty_incum)546 2826 A
3414(=)S
3498(0;)S
5895 V
(13916)210 1122 A
(tp->tty_inrevived)714 2112 A
2868(=)S
2952(0;)S
3456(/*)S
(unmark)252 3582 A
(revive)252 3876 A
(event)210 4170 A
4422(*/)S
5985 V
(13917)210 1122 A
(event_found)462 2112 A
2616(=)S
2700(1;)S
6075 V
(13918)210 1122 A
(break;)252 2112 A
6165 V
(13919)210 1122 A
1776(})S
6255 V
(13920)210 1122 A
(else)168 1776 A
1986(if)S
(\(tp->tty_outrevived)798 2112 A
2952(&&)S
(tp->tty_outcaller)714 3078 A
3834(==)S
(m_ptr->m_source\))672 3960 A
4674({)S
6345 V
(13921)210 1122 A
6435 V
(13922)210 1122 A
2112(/*)S
(Suspended)378 2238 A
(request)294 2658 A
(finished.)378 2994 A
(Send)168 3414 A
3624(a)S
(REVIVE.)294 3708 A
4044(*/)S
6525 V
(13923)210 1122 A
(m_ptr->m_type)546 2112 A
2700(=)S
(DEV_REVIVE;)462 2784 A
6615 V
(13924)210 1122 A
(m_ptr->REP_PROC_NR)756 2112 A
2910(=)S
(tp->tty_outproc;)672 2994 A
6705 V
(13925)210 1122 A
(m_ptr->REP_STATUS)714 2112 A
2868(=)S
(tp->tty_outcum;)630 2952 A
6795 V
(13926)210 1122 A
6885 V
(13927)210 1122 A
(tp->tty_outcum)588 2112 A
2742(=)S
2826(0;)S
6975 V
(13928)210 1122 A
(tp->tty_outrevived)756 2112 A
2910(=)S
2994(0;)S
3456(/*)S
(unmark)252 3582 A
(revive)252 3876 A
(event)210 4170 A
4422(*/)S
7065 V
(13929)210 1122 A
(event_found)462 2112 A
2616(=)S
2700(1;)S
8418 V
EP
%%Page: 179 179
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
12 B
(179)180 4500 A
1755 V
7 LST
(13930)210 1122 A
(break;)252 2112 A
1845 V
(13931)210 1122 A
1776(})S
1935 V
(13932)210 1122 A
1524(})S
2025 V
(13933)210 1122 A
2115 V
(13934)210 1122 A
(#if)126 1440 A
(NR_PTYS)294 1608 A
1944(>)S
2028(0)S
2205 V
(13935)210 1122 A
1524(if)S
(\(!event_found\))588 1650 A
2295 V
(13936)210 1122 A
(event_found)462 1776 A
2280(=)S
(pty_status\(m_ptr\);)756 2364 A
2385 V
(13937)210 1122 A
(#endif)252 1440 A
2475 V
(13938)210 1122 A
2565 V
(13939)210 1122 A
1524(if)S
1650(\(!)S
(event_found\))504 1776 A
2322({)S
2655 V
(13940)210 1122 A
1776(/*)S
1902(No)S
(events)252 2028 A
2322(of)S
(interest)336 2448 A
(were)168 2826 A
(found.)252 3036 A
(Return)252 3330 A
3624(an)S
(empty)210 3750 A
(message.)336 4002 A
4380(*/)S
2745 V
(13941)210 1122 A
(m_ptr->m_type)546 1776 A
2364(=)S
(DEV_NO_STATUS;)588 2448 A
2835 V
(13942)210 1122 A
1524(})S
2925 V
(13943)210 1122 A
3015 V
(13944)210 1122 A
1524(/*)S
(Almost)252 1650 A
(done.)210 1944 A
(Send)168 2196 A
(back)168 2406 A
(the)126 2616 A
(reply)210 2784 A
(message)294 3036 A
3372(to)S
(the)126 3498 A
(caller.)294 3666 A
4002(*/)S
3105 V
(13945)210 1122 A
1524(if)S
(\(\(status)336 1650 A
2028(=)S
(send\(m_ptr->m_source,)882 2112 A
(m_ptr\)\))294 3036 A
3372(!=)S
(OK\))126 3498 A
3666({)S
3195 V
(13946)210 1122 A
(panic\("TTY","send)714 1776 A
2532(in)S
(do_status)378 2658 A
(failed,)294 3078 A
(status\\n",)420 3414 A
(status\);)336 3876 A
3285 V
(13947)210 1122 A
1524(})S
3375 V
(13948)210 1122 A
1440(})S
3555 V
(13950)210 1122 A
(/*===========================================================================*)3276 1440 A
3645 V
(13951)210 1122 A
1482(*)S
(do_read)294 2784 A
4674(*)S
3735 V
(13952)210 1122 A
(*===========================================================================*/)3276 1482 A
3825 V
(13953)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(do_read\(tp,)462 1986 A
(m_ptr\))252 2490 A
3915 V
(13954)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(tty)126 3372 A
(struct)252 3540 A
3834(*/)S
4005 V
(13955)210 1122 A
(register)336 1440 A
(message)294 1818 A
(*m_ptr;)294 2154 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(message)294 3372 A
(sent)168 3708 A
3918(to)S
(the)126 4044 A
(task)168 4212 A
4422(*/)S
4095 V
(13956)210 1122 A
1440({)S
4185 V
(13957)210 1122 A
1440(/*)S
1566(A)S
(process)294 1650 A
(wants)210 1986 A
2238(to)S
(read)168 2364 A
(from)168 2574 A
2784(a)S
(terminal.)378 2868 A
3288(*/)S
4275 V
(13958)210 1122 A
(int)126 1524 A
1692(r,)S
(status;)294 1818 A
4365 V
(13959)210 1122 A
(phys_bytes)420 1524 A
(phys_addr;)420 1986 A
4455 V
(13960)210 1122 A
4545 V
(13961)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(if)S
(there)210 2028 A
2280(is)S
(already)294 2406 A
2742(a)S
(process)294 2826 A
(hanging)294 3162 A
3498(in)S
3624(a)S
(read,)210 3708 A
(check)210 3960 A
4212(if)S
(the)126 4338 A
4635 V
(13962)210 1122 A
1566(*)S
(parameters)420 1650 A
(are)126 2112 A
(correct,)336 2280 A
2658(do)S
(I/O.)168 2784 A
4725 V
(13963)210 1122 A
1566(*/)S
4815 V
(13964)210 1122 A
1524(if)S
(\(tp->tty_inleft)630 1650 A
2322(>)S
2406(0\))S
2532({)S
4905 V
(13965)210 1122 A
1776(r)S
1860(=)S
(EIO;)168 1944 A
4995 V
(13966)210 1122 A
1524(})S
(else)168 1608 A
5085 V
(13967)210 1122 A
1524(if)S
(\(m_ptr->COUNT)546 1650 A
2238(<=)S
2364(0\))S
2490({)S
5175 V
(13968)210 1122 A
1776(r)S
1860(=)S
(EINVAL;)294 1944 A
5265 V
(13969)210 1122 A
1524(})S
(else)168 1608 A
5355 V
(13970)210 1122 A
1524(if)S
(\(sys_umap\(m_ptr->PROC_NR,)1050 1650 A
2742(D,)S
(\(vir_bytes\))462 2868 A
(m_ptr->ADDRESS,)630 3372 A
(m_ptr->COUNT,)546 4044 A
5445 V
(13971)210 1122 A
(&phys_addr\))462 2112 A
2616(!=)S
(OK\))126 2742 A
2910({)S
5535 V
(13972)210 1122 A
1776(r)S
1860(=)S
(EFAULT;)294 1944 A
5625 V
(13973)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
5715 V
(13974)210 1122 A
1776(/*)S
(Copy)168 1902 A
(information)462 2112 A
(from)168 2616 A
(the)126 2826 A
(message)294 2994 A
3330(to)S
(the)126 3456 A
(tty)126 3624 A
(struct.)294 3792 A
4128(*/)S
5805 V
(13975)210 1122 A
(tp->tty_inrepcode)714 1776 A
2532(=)S
(TASK_REPLY;)462 2616 A
5895 V
(13976)210 1122 A
(tp->tty_incaller)672 1776 A
2490(=)S
(m_ptr->m_source;)672 2574 A
5985 V
(13977)210 1122 A
(tp->tty_inproc)588 1776 A
2406(=)S
(m_ptr->PROC_NR;)630 2490 A
6075 V
(13978)210 1122 A
(tp->tty_in_vir)588 1776 A
2406(=)S
(\(vir_bytes\))462 2490 A
(m_ptr->ADDRESS;)630 2994 A
6165 V
(13979)210 1122 A
(tp->tty_inleft)588 1776 A
2406(=)S
(m_ptr->COUNT;)546 2490 A
6255 V
(13980)210 1122 A
6345 V
(13981)210 1122 A
1776(if)S
(\(!\(tp->tty_termios.c_lflag)1092 1902 A
3036(&)S
(ICANON\))294 3120 A
6435 V
(13982)210 1122 A
3120(&&)S
(tp->tty_termios.c_cc[VTIME])1134 3246 A
4422(>)S
4506(0\))S
4632({)S
6525 V
(13983)210 1122 A
2112(if)S
(\(tp->tty_termios.c_cc[VMIN])1134 2238 A
3414(==)S
3540(0\))S
3666({)S
6615 V
(13984)210 1122 A
2448(/*)S
(MIN)126 2574 A
2742(&)S
(TIME)168 2826 A
(specify)294 3036 A
3372(a)S
(read)168 3456 A
(timer)210 3666 A
(that)168 3918 A
(finishes)336 4128 A
(the)126 4506 A
6705 V
(13985)210 1122 A
2490(*)S
(read)168 2574 A
2784(in)S
(TIME/10)294 2910 A
(seconds)294 3246 A
3582(if)S
3708(no)S
(bytes)210 3834 A
(are)126 4086 A
(available.)420 4254 A
6795 V
(13986)210 1122 A
2490(*/)S
6885 V
(13987)210 1122 A
(settimer\(tp,)504 2448 A
(TRUE\);)252 2994 A
6975 V
(13988)210 1122 A
(tp->tty_min)462 2448 A
2952(=)S
3036(1;)S
7065 V
(13989)210 1122 A
2112(})S
(else)168 2196 A
2406({)S
8418 V
EP
%%Page: 180 180
BP
/slant 0 def
/height 0 def
1485 V
12 B
(180)180 1080 A
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(13990)210 1122 A
2448(/*)S
(MIN)126 2574 A
2742(&)S
(TIME)168 2826 A
(specify)294 3036 A
3372(an)S
(inter-byte)420 3498 A
(timer)210 3960 A
(that)168 4212 A
(may)126 4422 A
1845 V
(13991)210 1122 A
2490(*)S
(have)168 2574 A
2784(to)S
2910(be)S
(cancelled)378 3036 A
3456(if)S
(there)210 3582 A
(are)126 3834 A
4002(no)S
(bytes)210 4128 A
(yet.)168 4380 A
1935 V
(13992)210 1122 A
2490(*/)S
2025 V
(13993)210 1122 A
2448(if)S
(\(tp->tty_eotct)588 2574 A
3204(==)S
3330(0\))S
3456({)S
2115 V
(13994)210 1122 A
(settimer\(tp,)504 2784 A
(FALSE\);)294 3330 A
2205 V
(13995)210 1122 A
(tp->tty_min)462 2784 A
3288(=)S
(tp->tty_termios.c_cc[VMIN];)1134 3372 A
2295 V
(13996)210 1122 A
2448(})S
2385 V
(13997)210 1122 A
2112(})S
2475 V
(13998)210 1122 A
1776(})S
2565 V
(13999)210 1122 A
2655 V
(14000)210 1122 A
1776(/*)S
(Anything)336 1902 A
(waiting)294 2280 A
2616(in)S
(the)126 2742 A
(input)210 2910 A
(buffer?)294 3162 A
(Clear)210 3498 A
3750(it)S
(out...)252 3876 A
4170(*/)S
2745 V
(14001)210 1122 A
(in_transfer\(tp\);)672 1776 A
2835 V
(14002)210 1122 A
1776(/*)S
(...then)294 1902 A
2238(go)S
(back)168 2364 A
(for)126 2574 A
(more.)210 2742 A
2994(*/)S
2925 V
(14003)210 1122 A
(handle_events\(tp\);)756 1776 A
3015 V
(14004)210 1122 A
1776(if)S
(\(tp->tty_inleft)630 1902 A
2574(==)S
2700(0\))S
2868({)S
3105 V
(14005)210 1122 A
2112(if)S
(\(tp->tty_select_ops\))840 2238 A
3195 V
(14006)210 1122 A
(select_retry\(tp\);)714 2448 A
3285 V
(14007)210 1122 A
(return;)294 2112 A
3120(/*)S
(already)294 3246 A
(done)168 3582 A
3792(*/)S
3375 V
(14008)210 1122 A
1776(})S
3465 V
(14009)210 1122 A
3555 V
(14010)210 1122 A
1776(/*)S
(There)210 1902 A
(were)168 2154 A
2364(no)S
(bytes)210 2490 A
2742(in)S
(the)126 2868 A
(input)210 3036 A
(queue)210 3288 A
(available,)420 3540 A
4002(so)S
(either)252 4128 A
(suspend)294 4422 A
3645 V
(14011)210 1122 A
1818(*)S
(the)126 1902 A
(caller)252 2070 A
2364(or)S
(break)210 2490 A
(off)126 2742 A
(the)126 2910 A
(read)168 3078 A
3288(if)S
(nonblocking.)504 3414 A
3735 V
(14012)210 1122 A
1818(*/)S
3825 V
(14013)210 1122 A
1776(if)S
(\(m_ptr->TTY_FLAGS)714 1902 A
2658(&)S
(O_NONBLOCK\))462 2742 A
3246({)S
3915 V
(14014)210 1122 A
2112(r)S
2196(=)S
(EAGAIN;)294 2280 A
3792(/*)S
(cancel)252 3918 A
(the)126 4212 A
(read)168 4380 A
4590(*/)S
4005 V
(14015)210 1122 A
(tp->tty_inleft)588 2112 A
2742(=)S
(tp->tty_incum)546 2826 A
3414(=)S
3498(0;)S
4095 V
(14016)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
4185 V
(14017)210 1122 A
2112(r)S
2196(=)S
(SUSPEND;)336 2280 A
3792(/*)S
(suspend)294 3918 A
(the)126 4254 A
(caller)252 4422 A
4716(*/)S
4275 V
(14018)210 1122 A
(tp->tty_inrepcode)714 2112 A
2868(=)S
(REVIVE;)294 2952 A
4365 V
(14019)210 1122 A
1776(})S
4455 V
(14020)210 1122 A
1524(})S
4545 V
(14021)210 1122 A
(tty_reply\(TASK_REPLY,)882 1524 A
(m_ptr->m_source,)672 2448 A
(m_ptr->PROC_NR,)630 3162 A
(r\);)126 3834 A
4635 V
(14022)210 1122 A
1524(if)S
(\(tp->tty_select_ops\))840 1650 A
4725 V
(14023)210 1122 A
(select_retry\(tp\);)714 1776 A
4815 V
(14024)210 1122 A
1440(})S
4995 V
(14026)210 1122 A
(/*===========================================================================*)3276 1440 A
5085 V
(14027)210 1122 A
1482(*)S
(do_write)336 2784 A
4674(*)S
5175 V
(14028)210 1122 A
(*===========================================================================*/)3276 1482 A
5265 V
(14029)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(do_write\(tp,)504 1986 A
(m_ptr\))252 2532 A
5355 V
(14030)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
5445 V
(14031)210 1122 A
(register)336 1440 A
(message)294 1818 A
(*m_ptr;)294 2154 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(message)294 3372 A
(sent)168 3708 A
3918(to)S
(the)126 4044 A
(task)168 4212 A
4422(*/)S
5535 V
(14032)210 1122 A
1440({)S
5625 V
(14033)210 1122 A
1440(/*)S
1566(A)S
(process)294 1650 A
(wants)210 1986 A
2238(to)S
(write)210 2364 A
2616(on)S
2742(a)S
(terminal.)378 2826 A
3246(*/)S
5715 V
(14034)210 1122 A
(int)126 1524 A
1692(r;)S
5805 V
(14035)210 1122 A
(phys_bytes)420 1524 A
(phys_addr;)420 1986 A
5895 V
(14036)210 1122 A
5985 V
(14037)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(if)S
(there)210 2028 A
2280(is)S
(already)294 2406 A
2742(a)S
(process)294 2826 A
(hanging)294 3162 A
3498(in)S
3624(a)S
(write,)252 3708 A
(check)210 4002 A
4254(if)S
(the)126 4380 A
6075 V
(14038)210 1122 A
1566(*)S
(parameters)420 1650 A
(are)126 2112 A
(correct,)336 2280 A
2658(do)S
(I/O.)168 2784 A
6165 V
(14039)210 1122 A
1566(*/)S
6255 V
(14040)210 1122 A
1524(if)S
(\(tp->tty_outleft)672 1650 A
2364(>)S
2448(0\))S
2574({)S
6345 V
(14041)210 1122 A
1776(r)S
1860(=)S
(EIO;)168 1944 A
6435 V
(14042)210 1122 A
1524(})S
(else)168 1608 A
6525 V
(14043)210 1122 A
1524(if)S
(\(m_ptr->COUNT)546 1650 A
2238(<=)S
2364(0\))S
2490({)S
6615 V
(14044)210 1122 A
1776(r)S
1860(=)S
(EINVAL;)294 1944 A
6705 V
(14045)210 1122 A
1524(})S
(else)168 1608 A
6795 V
(14046)210 1122 A
1524(if)S
(\(sys_umap\(m_ptr->PROC_NR,)1050 1650 A
2742(D,)S
(\(vir_bytes\))462 2868 A
(m_ptr->ADDRESS,)630 3372 A
(m_ptr->COUNT,)546 4044 A
6885 V
(14047)210 1122 A
(&phys_addr\))462 2112 A
2616(!=)S
(OK\))126 2742 A
2910({)S
6975 V
(14048)210 1122 A
1776(r)S
1860(=)S
(EFAULT;)294 1944 A
7065 V
(14049)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
8418 V
EP
%%Page: 181 181
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
12 B
(181)180 4500 A
1755 V
7 LST
(14050)210 1122 A
1776(/*)S
(Copy)168 1902 A
(message)294 2112 A
(parameters)420 2448 A
2910(to)S
(the)126 3036 A
(tty)126 3204 A
(structure.)420 3372 A
3834(*/)S
1845 V
(14051)210 1122 A
(tp->tty_outrepcode)756 1776 A
2574(=)S
(TASK_REPLY;)462 2658 A
1935 V
(14052)210 1122 A
(tp->tty_outcaller)714 1776 A
2532(=)S
(m_ptr->m_source;)672 2616 A
2025 V
(14053)210 1122 A
(tp->tty_outproc)630 1776 A
2448(=)S
(m_ptr->PROC_NR;)630 2532 A
2115 V
(14054)210 1122 A
(tp->tty_out_vir)630 1776 A
2448(=)S
(\(vir_bytes\))462 2532 A
(m_ptr->ADDRESS;)630 3036 A
2205 V
(14055)210 1122 A
(tp->tty_outleft)630 1776 A
2448(=)S
(m_ptr->COUNT;)546 2532 A
2295 V
(14056)210 1122 A
2385 V
(14057)210 1122 A
1776(/*)S
(Try)126 1902 A
2070(to)S
(write.)252 2196 A
2490(*/)S
2475 V
(14058)210 1122 A
(handle_events\(tp\);)756 1776 A
2565 V
(14059)210 1122 A
1776(if)S
(\(tp->tty_outleft)672 1902 A
2616(==)S
2742(0\))S
2655 V
(14060)210 1122 A
(return;)294 2112 A
2448(/*)S
(already)294 2574 A
(done)168 2910 A
3120(*/)S
2745 V
(14061)210 1122 A
2835 V
(14062)210 1122 A
1776(/*)S
(None)168 1902 A
2112(or)S
(not)126 2238 A
(all)126 2406 A
(the)126 2574 A
(bytes)210 2742 A
(could)210 2994 A
3246(be)S
(written,)336 3372 A
3750(so)S
(either)252 3876 A
(suspend)294 4170 A
(the)126 4506 A
2925 V
(14063)210 1122 A
1818(*)S
(caller)252 1902 A
2196(or)S
(break)210 2322 A
(off)126 2574 A
(the)126 2742 A
(write)210 2910 A
3162(if)S
(nonblocking.)504 3288 A
3015 V
(14064)210 1122 A
1818(*/)S
3105 V
(14065)210 1122 A
1776(if)S
(\(m_ptr->TTY_FLAGS)714 1902 A
2658(&)S
(O_NONBLOCK\))462 2742 A
3246({)S
3792(/*)S
(cancel)252 3918 A
(the)126 4212 A
(write)210 4380 A
4632(*/)S
3195 V
(14066)210 1122 A
2112(r)S
2196(=)S
(tp->tty_outcum)588 2280 A
2910(>)S
2994(0)S
3078(?)S
(tp->tty_outcum)588 3162 A
3792(:)S
(EAGAIN;)294 3876 A
3285 V
(14067)210 1122 A
(tp->tty_outleft)630 2112 A
2784(=)S
(tp->tty_outcum)588 2868 A
3498(=)S
3582(0;)S
3375 V
(14068)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
3465 V
(14069)210 1122 A
2112(r)S
2196(=)S
(SUSPEND;)336 2280 A
3792(/*)S
(suspend)294 3918 A
(the)126 4254 A
(caller)252 4422 A
4716(*/)S
3555 V
(14070)210 1122 A
(tp->tty_outrepcode)756 2112 A
2910(=)S
(REVIVE;)294 2994 A
3645 V
(14071)210 1122 A
1776(})S
3735 V
(14072)210 1122 A
1524(})S
3825 V
(14073)210 1122 A
(tty_reply\(TASK_REPLY,)882 1524 A
(m_ptr->m_source,)672 2448 A
(m_ptr->PROC_NR,)630 3162 A
(r\);)126 3834 A
3915 V
(14074)210 1122 A
1440(})S
4095 V
(14076)210 1122 A
(/*===========================================================================*)3276 1440 A
4185 V
(14077)210 1122 A
1482(*)S
(do_ioctl)336 2784 A
4674(*)S
4275 V
(14078)210 1122 A
(*===========================================================================*/)3276 1482 A
4365 V
(14079)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(do_ioctl\(tp,)504 1986 A
(m_ptr\))252 2532 A
4455 V
(14080)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
4545 V
(14081)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(message)294 3372 A
(sent)168 3708 A
3918(to)S
(task)168 4044 A
4254(*/)S
4635 V
(14082)210 1122 A
1440({)S
4725 V
(14083)210 1122 A
1440(/*)S
(Perform)294 1566 A
1902(an)S
(IOCTL)210 2028 A
2280(on)S
(this)168 2406 A
(terminal.)378 2616 A
(Posix)210 3036 A
(termios)294 3288 A
(calls)210 3624 A
(are)126 3876 A
(handled)294 4044 A
4815 V
(14084)210 1122 A
1482(*)S
1566(by)S
(the)126 1692 A
(IOCTL)210 1860 A
(system)252 2112 A
(call)168 2406 A
4905 V
(14085)210 1122 A
1482(*/)S
4995 V
(14086)210 1122 A
5085 V
(14087)210 1122 A
(int)126 1524 A
1692(r;)S
5175 V
(14088)210 1122 A
(union)210 1524 A
1776({)S
5265 V
(14089)210 1122 A
(int)126 1776 A
1944(i;)S
5355 V
(14090)210 1122 A
1524(})S
(param;)252 1608 A
5445 V
(14091)210 1122 A
(size_t)252 1524 A
(size;)210 1818 A
5535 V
(14092)210 1122 A
5625 V
(14093)210 1122 A
1524(/*)S
(Size)168 1650 A
1860(of)S
(the)126 1986 A
(ioctl)210 2154 A
(parameter.)420 2406 A
2868(*/)S
5715 V
(14094)210 1122 A
(switch)252 1524 A
(\(m_ptr->TTY_REQUEST\))840 1818 A
2700({)S
5805 V
(14095)210 1122 A
(case)168 1608 A
(TCGETS:)294 1818 A
2448(/*)S
(Posix)210 2574 A
(tcgetattr)378 2826 A
(function)336 3246 A
3624(*/)S
5895 V
(14096)210 1122 A
(case)168 1608 A
(TCSETS:)294 1818 A
2448(/*)S
(Posix)210 2574 A
(tcsetattr)378 2826 A
(function,)378 3246 A
(TCSANOW)294 3666 A
(option)252 4002 A
4296(*/)S
5985 V
(14097)210 1122 A
(case)168 1608 A
(TCSETSW:)336 1818 A
2448(/*)S
(Posix)210 2574 A
(tcsetattr)378 2826 A
(function,)378 3246 A
(TCSADRAIN)378 3666 A
(option)252 4086 A
4380(*/)S
6075 V
(14098)210 1122 A
(case)168 1608 A
(TCSETSF:)336 1818 A
2448(/*)S
(Posix)210 2574 A
(tcsetattr)378 2826 A
(function,)378 3246 A
(TCSAFLUSH)378 3666 A
(option)252 4086 A
4380(*/)S
6165 V
(14099)210 1122 A
(size)168 1776 A
1986(=)S
(sizeof\(struct)546 2070 A
(termios\);)378 2658 A
6255 V
(14100)210 1122 A
(break;)252 1776 A
6345 V
(14101)210 1122 A
6435 V
(14102)210 1122 A
(case)168 1608 A
(TCSBRK:)294 1818 A
2448(/*)S
(Posix)210 2574 A
(tcsendbreak)462 2826 A
(function)336 3330 A
3708(*/)S
6525 V
(14103)210 1122 A
(case)168 1608 A
(TCFLOW:)294 1818 A
2448(/*)S
(Posix)210 2574 A
(tcflow)252 2826 A
(function)336 3120 A
3498(*/)S
6615 V
(14104)210 1122 A
(case)168 1608 A
(TCFLSH:)294 1818 A
2448(/*)S
(Posix)210 2574 A
(tcflush)294 2826 A
(function)336 3162 A
3540(*/)S
6705 V
(14105)210 1122 A
(case)168 1608 A
(TIOCGPGRP:)420 1818 A
2448(/*)S
(Posix)210 2574 A
(tcgetpgrp)378 2826 A
(function)336 3246 A
3624(*/)S
6795 V
(14106)210 1122 A
(case)168 1608 A
(TIOCSPGRP:)420 1818 A
2448(/*)S
(Posix)210 2574 A
(tcsetpgrp)378 2826 A
(function)336 3246 A
3624(*/)S
6885 V
(14107)210 1122 A
(size)168 1776 A
1986(=)S
(sizeof\(int\);)504 2070 A
6975 V
(14108)210 1122 A
(break;)252 1776 A
7065 V
(14109)210 1122 A
8418 V
EP
%%Page: 182 182
BP
/slant 0 def
/height 0 def
1485 V
12 B
(182)180 1080 A
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(14110)210 1122 A
(case)168 1608 A
(TIOCGWINSZ:)462 1818 A
2448(/*)S
(get)126 2574 A
(window)252 2742 A
(size)168 3036 A
(\(not)168 3246 A
(Posix\))252 3456 A
3750(*/)S
1845 V
(14111)210 1122 A
(case)168 1608 A
(TIOCSWINSZ:)462 1818 A
2448(/*)S
(set)126 2574 A
(window)252 2742 A
(size)168 3036 A
(\(not)168 3246 A
(Posix\))252 3456 A
3750(*/)S
1935 V
(14112)210 1122 A
(size)168 1776 A
1986(=)S
(sizeof\(struct)546 2070 A
(winsize\);)378 2658 A
2025 V
(14113)210 1122 A
(break;)252 1776 A
2115 V
(14114)210 1122 A
2205 V
(14115)210 1122 A
(case)168 1608 A
(KIOCSMAP:)378 1818 A
2448(/*)S
(load)168 2574 A
(keymap)252 2784 A
(\(Minix)252 3078 A
(extension\))420 3372 A
3834(*/)S
2295 V
(14116)210 1122 A
(size)168 1776 A
1986(=)S
(sizeof\(keymap_t\);)714 2070 A
2385 V
(14117)210 1122 A
(break;)252 1776 A
2475 V
(14118)210 1122 A
2565 V
(14119)210 1122 A
(case)168 1608 A
(TIOCSFON:)378 1818 A
2448(/*)S
(load)168 2574 A
(font)168 2784 A
(\(Minix)252 2994 A
(extension\))420 3288 A
3750(*/)S
2655 V
(14120)210 1122 A
(size)168 1776 A
1986(=)S
(sizeof\(u8_t)462 2070 A
([8192]\);)336 2574 A
2745 V
(14121)210 1122 A
(break;)252 1776 A
2835 V
(14122)210 1122 A
2925 V
(14123)210 1122 A
(case)168 1608 A
(TCDRAIN:)336 1818 A
2448(/*)S
(Posix)210 2574 A
(tcdrain)294 2826 A
(function)336 3162 A
3540(--)S
3666(no)S
(parameter)378 3792 A
4212(*/)S
3015 V
(14124)210 1122 A
(default:)336 1608 A
(size)168 2448 A
2658(=)S
2742(0;)S
3105 V
(14125)210 1122 A
1524(})S
3195 V
(14126)210 1122 A
3285 V
(14127)210 1122 A
1524(r)S
1608(=)S
(OK;)126 1692 A
3375 V
(14128)210 1122 A
(switch)252 1524 A
(\(m_ptr->TTY_REQUEST\))840 1818 A
2700({)S
3465 V
(14129)210 1122 A
(case)168 1608 A
(TCGETS:)294 1818 A
3555 V
(14130)210 1122 A
1776(/*)S
(Get)126 1902 A
(the)126 2070 A
(termios)294 2238 A
(attributes.)462 2574 A
3078(*/)S
3645 V
(14131)210 1122 A
1776(r)S
1860(=)S
(sys_vircopy\(SELF,)714 1944 A
2700(D,)S
(\(vir_bytes\))462 2826 A
(&tp->tty_termios,)714 3330 A
3735 V
(14132)210 1122 A
(m_ptr->PROC_NR,)630 2112 A
2784(D,)S
(\(vir_bytes\))462 2910 A
(m_ptr->ADDRESS,)630 3414 A
3825 V
(14133)210 1122 A
(\(vir_bytes\))462 2112 A
(size\);)252 2616 A
3915 V
(14134)210 1122 A
(break;)252 1776 A
4005 V
(14135)210 1122 A
4095 V
(14136)210 1122 A
(case)168 1608 A
(TCSETSW:)336 1818 A
4185 V
(14137)210 1122 A
(case)168 1608 A
(TCSETSF:)336 1818 A
4275 V
(14138)210 1122 A
(case)168 1608 A
(TCDRAIN:)336 1818 A
4365 V
(14139)210 1122 A
1776(if)S
(\(tp->tty_outleft)672 1902 A
2616(>)S
2700(0\))S
2826({)S
4455 V
(14140)210 1122 A
2112(/*)S
(Wait)168 2238 A
(for)126 2448 A
(all)126 2616 A
(ongoing)294 2784 A
(output)252 3120 A
(processing)420 3414 A
3876(to)S
(finish.)294 4002 A
4338(*/)S
4545 V
(14141)210 1122 A
(tp->tty_iocaller)672 2112 A
2826(=)S
(m_ptr->m_source;)672 2910 A
4635 V
(14142)210 1122 A
(tp->tty_ioproc)588 2112 A
2742(=)S
(m_ptr->PROC_NR;)630 2826 A
4725 V
(14143)210 1122 A
(tp->tty_ioreq)546 2112 A
2700(=)S
(m_ptr->REQUEST;)630 2784 A
4815 V
(14144)210 1122 A
(tp->tty_iovir)546 2112 A
2700(=)S
(\(vir_bytes\))462 2784 A
(m_ptr->ADDRESS;)630 3288 A
4905 V
(14145)210 1122 A
2112(r)S
2196(=)S
(SUSPEND;)336 2280 A
4995 V
(14146)210 1122 A
(break;)252 2112 A
5085 V
(14147)210 1122 A
1776(})S
5175 V
(14148)210 1122 A
1776(if)S
(\(m_ptr->TTY_REQUEST)798 1902 A
2742(==)S
(TCDRAIN\))336 2868 A
(break;)252 3246 A
5265 V
(14149)210 1122 A
1776(if)S
(\(m_ptr->TTY_REQUEST)798 1902 A
2742(==)S
(TCSETSF\))336 2868 A
(tty_icancel\(tp\);)672 3246 A
5355 V
(14150)210 1122 A
(/*FALL)252 1776 A
(THROUGH*/)378 2070 A
5445 V
(14151)210 1122 A
(case)168 1608 A
(TCSETS:)294 1818 A
5535 V
(14152)210 1122 A
1776(/*)S
(Set)126 1902 A
(the)126 2070 A
(termios)294 2238 A
(attributes.)462 2574 A
3078(*/)S
5625 V
(14153)210 1122 A
1776(r)S
1860(=)S
(sys_vircopy\()504 1944 A
(m_ptr->PROC_NR,)630 2490 A
3162(D,)S
(\(vir_bytes\))462 3288 A
(m_ptr->ADDRESS,)630 3792 A
5715 V
(14154)210 1122 A
(SELF,)210 2112 A
2364(D,)S
(\(vir_bytes\))462 2490 A
(&tp->tty_termios,)714 2994 A
(\(vir_bytes\))462 3750 A
(size\);)252 4254 A
5805 V
(14155)210 1122 A
1776(if)S
1902(\(r)S
2028(!=)S
(OK\))126 2154 A
(break;)252 2322 A
5895 V
(14156)210 1122 A
(setattr\(tp\);)504 1776 A
5985 V
(14157)210 1122 A
(break;)252 1776 A
6075 V
(14158)210 1122 A
6165 V
(14159)210 1122 A
(case)168 1608 A
(TCFLSH:)294 1818 A
6255 V
(14160)210 1122 A
1776(r)S
1860(=)S
(sys_vircopy\()504 1944 A
(m_ptr->PROC_NR,)630 2490 A
3162(D,)S
(\(vir_bytes\))462 3288 A
(m_ptr->ADDRESS,)630 3792 A
6345 V
(14161)210 1122 A
(SELF,)210 2112 A
2364(D,)S
(\(vir_bytes\))462 2490 A
(&param.i,)378 2994 A
(\(vir_bytes\))462 3414 A
(size\);)252 3918 A
6435 V
(14162)210 1122 A
1776(if)S
1902(\(r)S
2028(!=)S
(OK\))126 2154 A
(break;)252 2322 A
6525 V
(14163)210 1122 A
(switch)252 1776 A
(\(param.i\))378 2070 A
2490({)S
6615 V
(14164)210 1122 A
(case)168 1944 A
(TCIFLUSH:)378 2154 A
(tty_icancel\(tp\);)672 2784 A
(break;)252 4632 A
6705 V
(14165)210 1122 A
(case)168 1944 A
(TCOFLUSH:)378 2154 A
(\(*tp->tty_ocancel\)\(tp,)924 2784 A
(0\);)126 3750 A
(break;)252 4632 A
6795 V
(14166)210 1122 A
(case)168 1944 A
(TCIOFLUSH:)420 2154 A
(tty_icancel\(tp\);)672 2784 A
(\(*tp->tty_ocancel\)\(tp,)924 3498 A
(0\);)126 4464 A
(break;)252 4632 A
6885 V
(14167)210 1122 A
(default:)336 1944 A
2784(r)S
2868(=)S
(EINVAL;)294 2952 A
6975 V
(14168)210 1122 A
1776(})S
7065 V
(14169)210 1122 A
(break;)252 1776 A
8418 V
EP
%%Page: 183 183
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
12 B
(183)180 4500 A
1755 V
7 LST
(14170)210 1122 A
1845 V
(14171)210 1122 A
(case)168 1608 A
(TCFLOW:)294 1818 A
1935 V
(14172)210 1122 A
1776(r)S
1860(=)S
(sys_vircopy\()504 1944 A
(m_ptr->PROC_NR,)630 2490 A
3162(D,)S
(\(vir_bytes\))462 3288 A
(m_ptr->ADDRESS,)630 3792 A
2025 V
(14173)210 1122 A
(SELF,)210 2112 A
2364(D,)S
(\(vir_bytes\))462 2490 A
(&param.i,)378 2994 A
(\(vir_bytes\))462 3414 A
(size\);)252 3918 A
2115 V
(14174)210 1122 A
1776(if)S
1902(\(r)S
2028(!=)S
(OK\))126 2154 A
(break;)252 2322 A
2205 V
(14175)210 1122 A
(switch)252 1776 A
(\(param.i\))378 2070 A
2490({)S
2295 V
(14176)210 1122 A
(case)168 1944 A
(TCOOFF:)294 2154 A
2385 V
(14177)210 1122 A
(case)168 1944 A
(TCOON:)252 2154 A
2475 V
(14178)210 1122 A
(tp->tty_inhibited)714 2112 A
2868(=)S
(\(param.i)336 2952 A
3330(==)S
(TCOOFF\);)336 3456 A
2565 V
(14179)210 1122 A
(tp->tty_events)588 2112 A
2742(=)S
2826(1;)S
2655 V
(14180)210 1122 A
(break;)252 2112 A
2745 V
(14181)210 1122 A
(case)168 1944 A
(TCIOFF:)294 2154 A
2835 V
(14182)210 1122 A
(\(*tp->tty_echo\)\(tp,)798 2112 A
(tp->tty_termios.c_cc[VSTOP]\);)1218 2952 A
2925 V
(14183)210 1122 A
(break;)252 2112 A
3015 V
(14184)210 1122 A
(case)168 1944 A
(TCION:)252 2154 A
3105 V
(14185)210 1122 A
(\(*tp->tty_echo\)\(tp,)798 2112 A
(tp->tty_termios.c_cc[VSTART]\);)1260 2952 A
3195 V
(14186)210 1122 A
(break;)252 2112 A
3285 V
(14187)210 1122 A
(default:)336 1944 A
3375 V
(14188)210 1122 A
2112(r)S
2196(=)S
(EINVAL;)294 2280 A
3465 V
(14189)210 1122 A
1776(})S
3555 V
(14190)210 1122 A
(break;)252 1776 A
3645 V
(14191)210 1122 A
3735 V
(14192)210 1122 A
(case)168 1608 A
(TCSBRK:)294 1818 A
3825 V
(14193)210 1122 A
1776(if)S
(\(tp->tty_break)588 1902 A
2532(!=)S
(NULL\))210 2658 A
(\(*tp->tty_break\)\(tp,0\);)966 2910 A
3915 V
(14194)210 1122 A
(break;)252 1776 A
4005 V
(14195)210 1122 A
4095 V
(14196)210 1122 A
(case)168 1608 A
(TIOCGWINSZ:)462 1818 A
4185 V
(14197)210 1122 A
1776(r)S
1860(=)S
(sys_vircopy\(SELF,)714 1944 A
2700(D,)S
(\(vir_bytes\))462 2826 A
(&tp->tty_winsize,)714 3330 A
4275 V
(14198)210 1122 A
(m_ptr->PROC_NR,)630 2112 A
2784(D,)S
(\(vir_bytes\))462 2910 A
(m_ptr->ADDRESS,)630 3414 A
4365 V
(14199)210 1122 A
(\(vir_bytes\))462 2112 A
(size\);)252 2616 A
4455 V
(14200)210 1122 A
(break;)252 1776 A
4545 V
(14201)210 1122 A
4635 V
(14202)210 1122 A
(case)168 1608 A
(TIOCSWINSZ:)462 1818 A
4725 V
(14203)210 1122 A
1776(r)S
1860(=)S
(sys_vircopy\()504 1944 A
(m_ptr->PROC_NR,)630 2490 A
3162(D,)S
(\(vir_bytes\))462 3288 A
(m_ptr->ADDRESS,)630 3792 A
4815 V
(14204)210 1122 A
(SELF,)210 2112 A
2364(D,)S
(\(vir_bytes\))462 2490 A
(&tp->tty_winsize,)714 2994 A
(\(vir_bytes\))462 3750 A
(size\);)252 4254 A
4905 V
(14205)210 1122 A
1776(/*)S
(SIGWINCH...)462 1902 A
2406(*/)S
4995 V
(14206)210 1122 A
(break;)252 1776 A
5085 V
(14207)210 1122 A
5175 V
(14208)210 1122 A
(case)168 1608 A
(KIOCSMAP:)378 1818 A
5265 V
(14209)210 1122 A
1776(/*)S
(Load)168 1902 A
2112(a)S
(new)126 2196 A
(keymap)252 2364 A
(\(only)210 2658 A
(/dev/console\).)588 2910 A
3540(*/)S
5355 V
(14210)210 1122 A
1776(if)S
(\(isconsole\(tp\)\))630 1902 A
2574(r)S
2658(=)S
(kbd_loadmap\(m_ptr\);)798 2742 A
5445 V
(14211)210 1122 A
(break;)252 1776 A
5535 V
(14212)210 1122 A
5625 V
(14213)210 1122 A
(case)168 1608 A
(TIOCSFON:)378 1818 A
5715 V
(14214)210 1122 A
1776(/*)S
(Load)168 1902 A
2112(a)S
(font)168 2196 A
(into)168 2406 A
2616(an)S
(EGA)126 2742 A
2910(or)S
(VGA)126 3036 A
(card)168 3204 A
(\(hs@hck.hr\))462 3414 A
3918(*/)S
5805 V
(14215)210 1122 A
1776(if)S
(\(isconsole\(tp\)\))630 1902 A
2574(r)S
2658(=)S
(con_loadfont\(m_ptr\);)840 2742 A
5895 V
(14216)210 1122 A
(break;)252 1776 A
5985 V
(14217)210 1122 A
6075 V
(14218)210 1122 A
1440(/*)S
(These)210 1566 A
(Posix)210 1818 A
(functions)378 2070 A
(are)126 2490 A
(allowed)294 2658 A
2994(to)S
(fail)168 3120 A
3330(if)S
(_POSIX_JOB_CONTROL)756 3456 A
4254(is)S
6165 V
(14219)210 1122 A
1482(*)S
(not)126 1566 A
(defined.)336 1734 A
6255 V
(14220)210 1122 A
1482(*/)S
6345 V
(14221)210 1122 A
(case)168 1608 A
(TIOCGPGRP:)420 1818 A
6435 V
(14222)210 1122 A
(case)168 1608 A
(TIOCSPGRP:)420 1818 A
6525 V
(14223)210 1122 A
(default:)336 1608 A
6615 V
(14224)210 1122 A
1776(r)S
1860(=)S
(ENOTTY;)294 1944 A
6705 V
(14225)210 1122 A
1524(})S
6795 V
(14226)210 1122 A
6885 V
(14227)210 1122 A
1524(/*)S
(Send)168 1650 A
(the)126 1860 A
(reply.)252 2028 A
2322(*/)S
6975 V
(14228)210 1122 A
(tty_reply\(TASK_REPLY,)882 1524 A
(m_ptr->m_source,)672 2448 A
(m_ptr->PROC_NR,)630 3162 A
(r\);)126 3834 A
7065 V
(14229)210 1122 A
1440(})S
8418 V
EP
%%Page: 184 184
BP
/slant 0 def
/height 0 def
1485 V
12 B
(184)180 1080 A
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1845 V
7 LST
(14231)210 1122 A
(/*===========================================================================*)3276 1440 A
1935 V
(14232)210 1122 A
1482(*)S
(do_open)294 2784 A
4674(*)S
2025 V
(14233)210 1122 A
(*===========================================================================*/)3276 1482 A
2115 V
(14234)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(do_open\(tp,)462 1986 A
(m_ptr\))252 2490 A
2205 V
(14235)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
2295 V
(14236)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(message)294 3372 A
(sent)168 3708 A
3918(to)S
(task)168 4044 A
4254(*/)S
2385 V
(14237)210 1122 A
1440({)S
2475 V
(14238)210 1122 A
1440(/*)S
1566(A)S
(tty)126 1650 A
(line)168 1818 A
(has)126 2028 A
(been)168 2196 A
(opened.)294 2406 A
(Make)168 2784 A
2994(it)S
(the)126 3120 A
(callers)294 3288 A
(controlling)462 3624 A
(tty)126 4128 A
4296(if)S
2565 V
(14239)210 1122 A
1482(*)S
(O_NOCTTY)336 1566 A
1944(is)S
(*not*)210 2070 A
(set)126 2322 A
(and)126 2490 A
2658(it)S
2784(is)S
(not)126 2910 A
(the)126 3078 A
(log)126 3246 A
(device.)294 3414 A
3792(1)S
3876(is)S
(returned)336 4002 A
4380(if)S
2655 V
(14240)210 1122 A
1482(*)S
(the)126 1566 A
(tty)126 1734 A
1902(is)S
(made)168 2028 A
(the)126 2238 A
(controlling)462 2406 A
(tty,)168 2910 A
(otherwise)378 3120 A
3540(OK)S
3666(or)S
3792(an)S
(error)210 3918 A
(code.)210 4170 A
2745 V
(14241)210 1122 A
1482(*/)S
2835 V
(14242)210 1122 A
(int)126 1524 A
1692(r)S
1776(=)S
(OK;)126 1860 A
2925 V
(14243)210 1122 A
3015 V
(14244)210 1122 A
1524(if)S
(\(m_ptr->TTY_LINE)672 1650 A
2364(==)S
(LOG_MINOR\))420 2490 A
2952({)S
3105 V
(14245)210 1122 A
1776(/*)S
(The)126 1902 A
(log)126 2070 A
(device)252 2238 A
2532(is)S
2658(a)S
(write-only)420 2742 A
(diagnostics)462 3204 A
(device.)294 3708 A
4044(*/)S
3195 V
(14246)210 1122 A
1776(if)S
(\(m_ptr->COUNT)546 1902 A
2490(&)S
(R_BIT\))252 2574 A
2868(r)S
2952(=)S
(EACCES;)294 3036 A
3285 V
(14247)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3375 V
(14248)210 1122 A
1776(if)S
(\(!\(m_ptr->COUNT)630 1902 A
2574(&)S
(O_NOCTTY\)\))420 2658 A
3120({)S
3465 V
(14249)210 1122 A
(tp->tty_pgrp)504 2112 A
2658(=)S
(m_ptr->PROC_NR;)630 2742 A
3555 V
(14250)210 1122 A
2112(r)S
2196(=)S
2280(1;)S
3645 V
(14251)210 1122 A
1776(})S
3735 V
(14252)210 1122 A
(tp->tty_openct++;)714 1776 A
3825 V
(14253)210 1122 A
1524(})S
3915 V
(14254)210 1122 A
(tty_reply\(TASK_REPLY,)882 1524 A
(m_ptr->m_source,)672 2448 A
(m_ptr->PROC_NR,)630 3162 A
(r\);)126 3834 A
4005 V
(14255)210 1122 A
1440(})S
4185 V
(14257)210 1122 A
(/*===========================================================================*)3276 1440 A
4275 V
(14258)210 1122 A
1482(*)S
(do_close)336 2784 A
4674(*)S
4365 V
(14259)210 1122 A
(*===========================================================================*/)3276 1482 A
4455 V
(14260)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(do_close\(tp,)504 1986 A
(m_ptr\))252 2532 A
4545 V
(14261)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
4635 V
(14262)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(message)294 3372 A
(sent)168 3708 A
3918(to)S
(task)168 4044 A
4254(*/)S
4725 V
(14263)210 1122 A
1440({)S
4815 V
(14264)210 1122 A
1440(/*)S
1566(A)S
(tty)126 1650 A
(line)168 1818 A
(has)126 2028 A
(been)168 2196 A
(closed.)294 2406 A
(Clean)210 2784 A
3036(up)S
(the)126 3162 A
(line)168 3330 A
3540(if)S
3666(it)S
3792(is)S
(the)126 3918 A
(last)168 4086 A
(close.)252 4296 A
4590(*/)S
4905 V
(14265)210 1122 A
4995 V
(14266)210 1122 A
1524(if)S
(\(m_ptr->TTY_LINE)672 1650 A
2364(!=)S
(LOG_MINOR)378 2490 A
2910(&&)S
(--tp->tty_openct)672 3036 A
3750(==)S
3876(0\))S
4002({)S
5085 V
(14267)210 1122 A
(tp->tty_pgrp)504 1776 A
2322(=)S
2406(0;)S
5175 V
(14268)210 1122 A
(tty_icancel\(tp\);)672 1776 A
5265 V
(14269)210 1122 A
(\(*tp->tty_ocancel\)\(tp,)924 1776 A
(0\);)126 2742 A
5355 V
(14270)210 1122 A
(\(*tp->tty_close\)\(tp,)840 1776 A
(0\);)126 2658 A
5445 V
(14271)210 1122 A
(tp->tty_termios)630 1776 A
2448(=)S
(termios_defaults;)714 2532 A
5535 V
(14272)210 1122 A
(tp->tty_winsize)630 1776 A
2448(=)S
(winsize_defaults;)714 2532 A
5625 V
(14273)210 1122 A
(setattr\(tp\);)504 1776 A
5715 V
(14274)210 1122 A
1524(})S
5805 V
(14275)210 1122 A
(tty_reply\(TASK_REPLY,)882 1524 A
(m_ptr->m_source,)672 2448 A
(m_ptr->PROC_NR,)630 3162 A
(OK\);)168 3834 A
5895 V
(14276)210 1122 A
1440(})S
6075 V
(14278)210 1122 A
(/*===========================================================================*)3276 1440 A
6165 V
(14279)210 1122 A
1482(*)S
(do_cancel)378 2784 A
4674(*)S
6255 V
(14280)210 1122 A
(*===========================================================================*/)3276 1482 A
6345 V
(14281)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(do_cancel\(tp,)546 1986 A
(m_ptr\))252 2574 A
6435 V
(14282)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
6525 V
(14283)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(message)294 3372 A
(sent)168 3708 A
3918(to)S
(task)168 4044 A
4254(*/)S
6615 V
(14284)210 1122 A
1440({)S
6705 V
(14285)210 1122 A
1440(/*)S
1566(A)S
(signal)252 1650 A
(has)126 1944 A
(been)168 2112 A
(sent)168 2322 A
2532(to)S
2658(a)S
(process)294 2742 A
(that)168 3078 A
3288(is)S
(hanging)294 3414 A
(trying)252 3750 A
4044(to)S
(read)168 4170 A
4380(or)S
(write.)252 4506 A
6795 V
(14286)210 1122 A
1482(*)S
(The)126 1566 A
(pending)294 1734 A
(read)168 2070 A
2280(or)S
(write)210 2406 A
(must)168 2658 A
2868(be)S
(finished)336 2994 A
(off)126 3372 A
(immediately.)504 3540 A
6885 V
(14287)210 1122 A
1482(*/)S
6975 V
(14288)210 1122 A
7065 V
(14289)210 1122 A
(int)126 1524 A
(proc_nr;)336 1692 A
8418 V
EP
%%Page: 185 185
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
12 B
(185)180 4500 A
1755 V
7 LST
(14290)210 1122 A
(int)126 1524 A
(mode;)210 1692 A
1845 V
(14291)210 1122 A
1935 V
(14292)210 1122 A
1524(/*)S
(Check)210 1650 A
(the)126 1902 A
(parameters)420 2070 A
(carefully,)420 2532 A
2994(to)S
(avoid)210 3120 A
(cancelling)420 3372 A
(twice.)252 3834 A
4128(*/)S
2025 V
(14293)210 1122 A
(proc_nr)294 1524 A
1860(=)S
(m_ptr->PROC_NR;)630 1944 A
2115 V
(14294)210 1122 A
(mode)168 1524 A
1734(=)S
(m_ptr->COUNT;)546 1818 A
2205 V
(14295)210 1122 A
1524(if)S
(\(\(mode)252 1650 A
1944(&)S
(R_BIT\))252 2028 A
2322(&&)S
(tp->tty_inleft)588 2448 A
3078(!=)S
3204(0)S
3288(&&)S
(proc_nr)294 3414 A
3750(==)S
(tp->tty_inproc\))630 3876 A
4548({)S
2295 V
(14296)210 1122 A
1776(/*)S
(Process)294 1902 A
(was)126 2238 A
(reading)294 2406 A
(when)168 2742 A
(killed.)294 2952 A
(Clean)210 3330 A
3582(up)S
(input.)252 3708 A
4002(*/)S
2385 V
(14297)210 1122 A
(tty_icancel\(tp\);)672 1776 A
2475 V
(14298)210 1122 A
(tp->tty_inleft)588 1776 A
2406(=)S
(tp->tty_incum)546 2490 A
3078(=)S
3162(0;)S
2565 V
(14299)210 1122 A
1524(})S
2655 V
(14300)210 1122 A
1524(if)S
(\(\(mode)252 1650 A
1944(&)S
(W_BIT\))252 2028 A
2322(&&)S
(tp->tty_outleft)630 2448 A
3120(!=)S
3246(0)S
3330(&&)S
(proc_nr)294 3456 A
3792(==)S
(tp->tty_outproc\))672 3918 A
4632({)S
2745 V
(14301)210 1122 A
1776(/*)S
(Process)294 1902 A
(was)126 2238 A
(writing)294 2406 A
(when)168 2742 A
(killed.)294 2952 A
(Clean)210 3330 A
3582(up)S
(output.)294 3708 A
4044(*/)S
2835 V
(14302)210 1122 A
(\(*tp->tty_ocancel\)\(tp,)924 1776 A
(0\);)126 2742 A
2925 V
(14303)210 1122 A
(tp->tty_outleft)630 1776 A
2448(=)S
(tp->tty_outcum)588 2532 A
3162(=)S
3246(0;)S
3015 V
(14304)210 1122 A
1524(})S
3105 V
(14305)210 1122 A
1524(if)S
(\(tp->tty_ioreq)588 1650 A
2280(!=)S
2406(0)S
2490(&&)S
(proc_nr)294 2616 A
2952(==)S
(tp->tty_ioproc\))630 3078 A
3750({)S
3195 V
(14306)210 1122 A
1776(/*)S
(Process)294 1902 A
(was)126 2238 A
(waiting)294 2406 A
(for)126 2742 A
(output)252 2910 A
3204(to)S
(drain.)252 3330 A
3624(*/)S
3285 V
(14307)210 1122 A
(tp->tty_ioreq)546 1776 A
2364(=)S
2448(0;)S
3375 V
(14308)210 1122 A
1524(})S
3465 V
(14309)210 1122 A
(tp->tty_events)588 1524 A
2154(=)S
2238(1;)S
3555 V
(14310)210 1122 A
(tty_reply\(TASK_REPLY,)882 1524 A
(m_ptr->m_source,)672 2448 A
(proc_nr,)336 3162 A
(EINTR\);)294 3540 A
3645 V
(14311)210 1122 A
1440(})S
3825 V
(14313)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(select_try\(struct)714 1902 A
(tty)126 2658 A
(*tp,)168 2826 A
(int)126 3036 A
(ops\))168 3204 A
3915 V
(14314)210 1122 A
1440({)S
4005 V
(14315)210 1122 A
(int)126 1776 A
(ready_ops)378 1944 A
2364(=)S
2448(0;)S
4095 V
(14316)210 1122 A
4185 V
(14317)210 1122 A
1776(/*)S
(Special)294 1902 A
(case.)210 2238 A
2490(If)S
(line)168 2616 A
2826(is)S
(hung)168 2952 A
(up,)126 3162 A
3330(no)S
(operations)420 3456 A
(will)168 3918 A
(block.)252 4128 A
4275 V
(14318)210 1122 A
1818(*)S
(\(and)168 1902 A
2112(it)S
(can)126 2238 A
2406(be)S
(seen)168 2532 A
2742(as)S
2868(an)S
(exceptional)462 2994 A
(condition.\))462 3498 A
4365 V
(14319)210 1122 A
1818(*/)S
4455 V
(14320)210 1122 A
1776(if)S
(\(tp->tty_termios.c_ospeed)1050 1902 A
2994(==)S
(B0\))126 3120 A
3288({)S
4545 V
(14321)210 1122 A
(ready_ops)378 2112 A
2532(|=)S
(ops;)168 2658 A
4635 V
(14322)210 1122 A
1776(})S
4725 V
(14323)210 1122 A
4815 V
(14324)210 1122 A
1776(if)S
(\(ops)168 1902 A
2112(&)S
(SEL_RD\))294 2196 A
2532({)S
4905 V
(14325)210 1122 A
2112(/*)S
(will)168 2238 A
(i/o)126 2448 A
(not)126 2616 A
(block)210 2784 A
3036(on)S
(read?)210 3162 A
3414(*/)S
4995 V
(14326)210 1122 A
2112(if)S
(\(tp->tty_inleft)630 2238 A
2910(>)S
2994(0\))S
3120({)S
5085 V
(14327)210 1122 A
(ready_ops)378 2448 A
2868(|=)S
(SEL_RD;)294 2994 A
3456(/*)S
(EIO)126 3582 A
3750(-)S
3834(no)S
(blocking)336 3960 A
4338(*/)S
5175 V
(14328)210 1122 A
2112(})S
(else)168 2196 A
2406(if)S
(\(tp->tty_incount)672 2532 A
3246(>)S
3330(0\))S
3456({)S
5265 V
(14329)210 1122 A
2448(/*)S
2574(Is)S
2700(a)S
(regular)294 2784 A
(read)168 3120 A
(possible?)378 3330 A
(tty_incount)462 3750 A
5355 V
(14330)210 1122 A
2490(*)S
(says)168 2574 A
(there)210 2784 A
3036(is)S
(data.)210 3162 A
(But)126 3414 A
3582(a)S
(read)168 3666 A
(will)168 3876 A
(only)168 4086 A
(succeed)294 4296 A
5445 V
(14331)210 1122 A
2490(*)S
2574(in)S
(canonical)378 2700 A
(mode)168 3120 A
3330(if)S
3456(a)S
(newline)294 3540 A
(has)126 3876 A
(been)168 4044 A
(seen.)210 4254 A
5535 V
(14332)210 1122 A
2490(*/)S
5625 V
(14333)210 1122 A
2448(if)S
(\(!\(tp->tty_termios.c_lflag)1092 2574 A
3708(&)S
(ICANON\))294 3792 A
4128(||)S
5715 V
(14334)210 1122 A
(tp->tty_eotct)546 2784 A
3372(>)S
3456(0\))S
3582({)S
5805 V
(14335)210 1122 A
(ready_ops)378 2784 A
3204(|=)S
(SEL_RD;)294 3330 A
5895 V
(14336)210 1122 A
2448(})S
5985 V
(14337)210 1122 A
2112(})S
6075 V
(14338)210 1122 A
1776(})S
6165 V
(14339)210 1122 A
6255 V
(14340)210 1122 A
1776(if)S
(\(ops)168 1902 A
2112(&)S
(SEL_WR\))294 2196 A
2574({)S
6345 V
(14341)210 1122 A
2112(if)S
(\(tp->tty_outleft)672 2238 A
2952(>)S
3036(0\))S
(ready_ops)378 3204 A
3624(|=)S
(SEL_WR;)294 3750 A
6435 V
(14342)210 1122 A
(else)168 2112 A
2322(if)S
(\(\(*tp->tty_devwrite\)\(tp,)1008 2448 A
(1\)\))126 3498 A
(ready_ops)378 3666 A
4086(|=)S
(SEL_WR;)294 4212 A
6525 V
(14343)210 1122 A
1776(})S
6615 V
(14344)210 1122 A
6705 V
(14345)210 1122 A
(return)252 1776 A
(ready_ops;)420 2070 A
6795 V
(14346)210 1122 A
1440(})S
6975 V
(14348)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(select_retry\(struct)798 1902 A
(tty)126 2742 A
(*tp\))168 2910 A
7065 V
(14349)210 1122 A
1440({)S
8418 V
EP
%%Page: 186 186
BP
/slant 0 def
/height 0 def
1485 V
12 B
(186)180 1080 A
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(14350)210 1122 A
1776(if)S
(\(select_try\(tp,)630 1902 A
(tp->tty_select_ops\)\))840 2574 A
1845 V
(14351)210 1122 A
(notify\(tp->tty_select_proc\);)1176 2112 A
1935 V
(14352)210 1122 A
(return)252 1776 A
(OK;)126 2070 A
2025 V
(14353)210 1122 A
1440(})S
2205 V
(14355)210 1122 A
(/*===========================================================================*)3276 1440 A
2295 V
(14356)210 1122 A
1482(*)S
(handle_events)546 2784 A
4674(*)S
2385 V
(14357)210 1122 A
(*===========================================================================*/)3276 1482 A
2475 V
(14358)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(handle_events\(tp\))714 1944 A
2565 V
(14359)210 1122 A
(tty_t)210 1440 A
(*tp;)168 1692 A
2784(/*)S
(TTY)126 2910 A
3078(to)S
(check)210 3204 A
(for)126 3456 A
(events.)294 3624 A
3960(*/)S
2655 V
(14360)210 1122 A
1440({)S
2745 V
(14361)210 1122 A
1440(/*)S
(Handle)252 1566 A
(any)126 1860 A
(events)252 2028 A
(pending)294 2322 A
2658(on)S
2784(a)S
(TTY.)168 2868 A
(These)210 3120 A
(events)252 3372 A
(are)126 3666 A
(usually)294 3834 A
(device)252 4170 A
2835 V
(14362)210 1122 A
1482(*)S
(interrupts.)462 1566 A
2925 V
(14363)210 1122 A
1482(*)S
3015 V
(14364)210 1122 A
1482(*)S
(Two)126 1566 A
(kinds)210 1734 A
1986(of)S
(events)252 2112 A
(are)126 2406 A
(prominent:)420 2574 A
3105 V
(14365)210 1122 A
1482(*)S
1776(-)S
1860(a)S
(character)378 1944 A
(has)126 2364 A
(been)168 2532 A
(received)336 2742 A
(from)168 3120 A
(the)126 3330 A
(console)294 3498 A
3834(or)S
3960(an)S
(RS232)210 4086 A
(line.)210 4338 A
3195 V
(14366)210 1122 A
1482(*)S
1776(-)S
1860(an)S
(RS232)210 1986 A
(line)168 2238 A
(has)126 2448 A
(completed)378 2616 A
3036(a)S
(write)210 3120 A
(request)294 3372 A
(\(on)126 3708 A
(behalf)252 3876 A
4170(of)S
4296(a)S
(user\).)252 4380 A
3285 V
(14367)210 1122 A
1482(*)S
(The)126 1566 A
(interrupt)378 1734 A
(handler)294 2154 A
(may)126 2490 A
(delay)210 2658 A
(the)126 2910 A
(interrupt)378 3078 A
(message)294 3498 A
3834(at)S
(its)126 3960 A
(discretion)420 4128 A
3375 V
(14368)210 1122 A
1482(*)S
1566(to)S
(avoid)210 1692 A
(swamping)336 1944 A
(the)126 2322 A
(TTY)126 2490 A
(task.)210 2658 A
(Messages)336 2952 A
(may)126 3330 A
3498(be)S
(overwritten)462 3624 A
(when)168 4128 A
(the)126 4338 A
3465 V
(14369)210 1122 A
1482(*)S
(lines)210 1566 A
(are)126 1818 A
(fast)168 1986 A
2196(or)S
(when)168 2322 A
(there)210 2532 A
(are)126 2784 A
(races)210 2952 A
(between)294 3204 A
(different)378 3540 A
(lines,)252 3960 A
(input)210 4254 A
3555 V
(14370)210 1122 A
1482(*)S
(and)126 1566 A
(output,)294 1734 A
(because)294 2070 A
(MINIX)210 2406 A
(only)168 2658 A
(provides)336 2868 A
(single)252 3246 A
(buffering)378 3540 A
(for)126 3960 A
(interrupt)378 4128 A
3645 V
(14371)210 1122 A
1482(*)S
(messages)336 1566 A
(\(in)126 1944 A
(proc.c\).)336 2112 A
(This)168 2532 A
2742(is)S
(handled)294 2868 A
3204(by)S
(explicitly)420 3330 A
(checking)336 3792 A
(each)168 4170 A
(line)168 4380 A
3735 V
(14372)210 1122 A
1482(*)S
(for)126 1566 A
(fresh)210 1734 A
(input)210 1986 A
(and)126 2238 A
(completed)378 2406 A
(output)252 2826 A
3120(on)S
(each)168 3246 A
(interrupt.)420 3456 A
3825 V
(14373)210 1122 A
1482(*/)S
3915 V
(14374)210 1122 A
(char)168 1524 A
(*buf;)210 1734 A
4005 V
(14375)210 1122 A
(unsigned)336 1524 A
(count;)252 1902 A
4095 V
(14376)210 1122 A
(int)126 1524 A
(status;)294 1692 A
4185 V
(14377)210 1122 A
4275 V
(14378)210 1122 A
1524(do)S
1650({)S
4365 V
(14379)210 1122 A
(tp->tty_events)588 1776 A
2406(=)S
2490(0;)S
4455 V
(14380)210 1122 A
4545 V
(14381)210 1122 A
1776(/*)S
(Read)168 1902 A
(input)210 2112 A
(and)126 2364 A
(perform)294 2532 A
(input)210 2868 A
(processing.)462 3120 A
3624(*/)S
4635 V
(14382)210 1122 A
(\(*tp->tty_devread\)\(tp,)924 1776 A
(0\);)126 2742 A
4725 V
(14383)210 1122 A
4815 V
(14384)210 1122 A
1776(/*)S
(Perform)294 1902 A
(output)252 2238 A
(processing)420 2532 A
(and)126 2994 A
(write)210 3162 A
(output.)294 3414 A
3750(*/)S
4905 V
(14385)210 1122 A
(\(*tp->tty_devwrite\)\(tp,)966 1776 A
(0\);)126 2784 A
4995 V
(14386)210 1122 A
5085 V
(14387)210 1122 A
1776(/*)S
(Ioctl)210 1902 A
(waiting)294 2154 A
(for)126 2490 A
(some)168 2658 A
(event?)252 2868 A
3162(*/)S
5175 V
(14388)210 1122 A
1776(if)S
(\(tp->tty_ioreq)588 1902 A
2532(!=)S
2658(0\))S
(dev_ioctl\(tp\);)588 2784 A
5265 V
(14389)210 1122 A
1524(})S
(while)210 1608 A
(\(tp->tty_events\);)714 1860 A
5355 V
(14390)210 1122 A
5445 V
(14391)210 1122 A
1524(/*)S
(Transfer)336 1650 A
(characters)420 2028 A
(from)168 2490 A
(the)126 2700 A
(input)210 2868 A
(queue)210 3120 A
3372(to)S
3498(a)S
(waiting)294 3582 A
(process.)336 3918 A
4296(*/)S
5535 V
(14392)210 1122 A
(in_transfer\(tp\);)672 1524 A
5625 V
(14393)210 1122 A
5715 V
(14394)210 1122 A
1524(/*)S
(Reply)210 1650 A
1902(if)S
(enough)252 2028 A
(bytes)210 2322 A
(are)126 2574 A
(available.)420 2742 A
3204(*/)S
5805 V
(14395)210 1122 A
1524(if)S
(\(tp->tty_incum)588 1650 A
2280(>=)S
(tp->tty_min)462 2406 A
2910(&&)S
(tp->tty_inleft)588 3036 A
3666(>)S
3750(0\))S
3876({)S
5895 V
(14396)210 1122 A
1776(if)S
(\(tp->tty_inrepcode)756 1902 A
2700(==)S
(REVIVE\))294 2826 A
3162({)S
5985 V
(14397)210 1122 A
(notify\(tp->tty_incaller\);)1050 2112 A
6075 V
(14398)210 1122 A
(tp->tty_inrevived)714 2112 A
2868(=)S
2952(1;)S
6165 V
(14399)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
6255 V
(14400)210 1122 A
(tty_reply\(tp->tty_inrepcode,)1176 2112 A
(tp->tty_incaller,)714 3330 A
6345 V
(14401)210 1122 A
(tp->tty_inproc,)630 2448 A
(tp->tty_incum\);)630 3120 A
6435 V
(14402)210 1122 A
(tp->tty_inleft)588 2112 A
2742(=)S
(tp->tty_incum)546 2826 A
3414(=)S
3498(0;)S
6525 V
(14403)210 1122 A
1776(})S
6615 V
(14404)210 1122 A
1524(})S
6705 V
(14405)210 1122 A
1524(if)S
(\(tp->tty_select_ops\))840 1650 A
6795 V
(14406)210 1122 A
(select_retry\(tp\);)714 1776 A
6885 V
(14407)210 1122 A
(#if)126 1440 A
(NR_PTYS)294 1608 A
1944(>)S
2028(0)S
6975 V
(14408)210 1122 A
1524(if)S
(\(ispty\(tp\)\))462 1650 A
7065 V
(14409)210 1122 A
(select_retry_pty\(tp\);)882 1776 A
8418 V
EP
%%Page: 187 187
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
12 B
(187)180 4500 A
1755 V
7 LST
(14410)210 1122 A
(#endif)252 1440 A
1845 V
(14411)210 1122 A
1440(})S
2025 V
(14413)210 1122 A
(/*===========================================================================*)3276 1440 A
2115 V
(14414)210 1122 A
1482(*)S
(in_transfer)462 2784 A
4674(*)S
2205 V
(14415)210 1122 A
(*===========================================================================*/)3276 1482 A
2295 V
(14416)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(in_transfer\(tp\))630 1986 A
2385 V
(14417)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(terminal)336 3372 A
3750(to)S
(read)168 3876 A
(from)168 4086 A
4296(*/)S
2475 V
(14418)210 1122 A
1440({)S
2565 V
(14419)210 1122 A
1440(/*)S
(Transfer)336 1566 A
(bytes)210 1944 A
(from)168 2196 A
(the)126 2406 A
(input)210 2574 A
(queue)210 2826 A
3078(to)S
3204(a)S
(process)294 3288 A
(reading)294 3624 A
(from)168 3960 A
4170(a)S
(terminal.)378 4254 A
4674(*/)S
2655 V
(14420)210 1122 A
2745 V
(14421)210 1122 A
(int)126 1524 A
(ch;)126 1692 A
2835 V
(14422)210 1122 A
(int)126 1524 A
(count;)252 1692 A
2925 V
(14423)210 1122 A
(char)168 1524 A
(buf[64],)336 1734 A
(*bp;)168 2112 A
3015 V
(14424)210 1122 A
3105 V
(14425)210 1122 A
1524(/*)S
(Force)210 1650 A
(read)168 1902 A
2112(to)S
(succeed)294 2238 A
2574(if)S
(the)126 2700 A
(line)168 2868 A
3078(is)S
(hung)168 3204 A
(up,)126 3414 A
(looks)210 3582 A
(like)168 3834 A
(EOF)126 4044 A
4212(to)S
(reader.)294 4338 A
4674(*/)S
3195 V
(14426)210 1122 A
1524(if)S
(\(tp->tty_termios.c_ospeed)1050 1650 A
2742(==)S
(B0\))126 2868 A
(tp->tty_min)462 3036 A
3540(=)S
3624(0;)S
3285 V
(14427)210 1122 A
3375 V
(14428)210 1122 A
1524(/*)S
(Anything)336 1650 A
2028(to)S
(do?)126 2154 A
2322(*/)S
3465 V
(14429)210 1122 A
1524(if)S
(\(tp->tty_inleft)630 1650 A
2322(==)S
2448(0)S
2532(||)S
(tp->tty_eotct)546 2658 A
3246(<)S
(tp->tty_min\))504 3330 A
(return;)294 3876 A
3555 V
(14430)210 1122 A
3645 V
(14431)210 1122 A
1524(bp)S
1650(=)S
(buf;)168 1734 A
3735 V
(14432)210 1122 A
(while)210 1524 A
(\(tp->tty_inleft)630 1776 A
2448(>)S
2532(0)S
2616(&&)S
(tp->tty_eotct)546 2742 A
3330(>)S
3414(0\))S
3540({)S
3825 V
(14433)210 1122 A
1776(ch)S
1902(=)S
(*tp->tty_intail;)672 1986 A
3915 V
(14434)210 1122 A
4005 V
(14435)210 1122 A
1776(if)S
(\(!\(ch)210 1902 A
2154(&)S
(IN_EOF\)\))336 2238 A
2616({)S
4095 V
(14436)210 1122 A
2112(/*)S
(One)126 2238 A
(character)378 2406 A
2826(to)S
2952(be)S
(delivered)378 3078 A
3498(to)S
(the)126 3624 A
(user.)210 3792 A
4044(*/)S
4185 V
(14437)210 1122 A
(*bp)126 2112 A
2280(=)S
2364(ch)S
2490(&)S
(IN_CHAR;)336 2574 A
4275 V
(14438)210 1122 A
(tp->tty_inleft--;)714 2112 A
4365 V
(14439)210 1122 A
2112(if)S
(\(++bp)210 2238 A
2490(==)S
(bufend\(buf\)\))504 2616 A
3162({)S
4455 V
(14440)210 1122 A
2448(/*)S
(Temp)168 2574 A
(buffer)252 2784 A
(full,)210 3078 A
(copy)168 3330 A
3540(to)S
(user)168 3666 A
(space.)252 3876 A
4170(*/)S
4545 V
(14441)210 1122 A
(sys_vircopy\(SELF,)714 2448 A
3204(D,)S
(\(vir_bytes\))462 3330 A
(buf,)168 3834 A
4635 V
(14442)210 1122 A
(tp->tty_inproc,)630 2784 A
3456(D,)S
(tp->tty_in_vir,)630 3582 A
4725 V
(14443)210 1122 A
(\(vir_bytes\))462 2784 A
(buflen\(buf\)\);)546 3288 A
4815 V
(14444)210 1122 A
(tp->tty_in_vir)588 2448 A
3078(+=)S
(buflen\(buf\);)504 3204 A
4905 V
(14445)210 1122 A
(tp->tty_incum)546 2448 A
3036(+=)S
(buflen\(buf\);)504 3162 A
4995 V
(14446)210 1122 A
2448(bp)S
2574(=)S
(buf;)168 2658 A
5085 V
(14447)210 1122 A
2112(})S
5175 V
(14448)210 1122 A
1776(})S
5265 V
(14449)210 1122 A
5355 V
(14450)210 1122 A
1776(/*)S
(Remove)252 1902 A
(the)126 2196 A
(character)378 2364 A
(from)168 2784 A
(the)126 2994 A
(input)210 3162 A
(queue.)252 3414 A
3708(*/)S
5445 V
(14451)210 1122 A
1776(if)S
(\(++tp->tty_intail)714 1902 A
2658(==)S
(bufend\(tp->tty_inbuf\)\))924 2784 A
5535 V
(14452)210 1122 A
(tp->tty_intail)588 2112 A
2742(=)S
(tp->tty_inbuf;)588 2826 A
5625 V
(14453)210 1122 A
(tp->tty_incount--;)756 1776 A
5715 V
(14454)210 1122 A
1776(if)S
(\(ch)126 1902 A
2070(&)S
(IN_EOT\))294 2154 A
2490({)S
5805 V
(14455)210 1122 A
(tp->tty_eotct--;)672 2112 A
5895 V
(14456)210 1122 A
2112(/*)S
(Don't)210 2238 A
(read)168 2490 A
(past)168 2700 A
2910(a)S
(line)168 2994 A
(break)210 3204 A
3456(in)S
(canonical)378 3582 A
(mode.)210 4002 A
4254(*/)S
5985 V
(14457)210 1122 A
2112(if)S
(\(tp->tty_termios.c_lflag)1008 2238 A
3288(&)S
(ICANON\))294 3372 A
(tp->tty_inleft)588 3708 A
4338(=)S
4422(0;)S
6075 V
(14458)210 1122 A
1776(})S
6165 V
(14459)210 1122 A
1524(})S
6255 V
(14460)210 1122 A
6345 V
(14461)210 1122 A
1524(if)S
(\(bp)126 1650 A
1818(>)S
(buf\))168 1902 A
2112({)S
6435 V
(14462)210 1122 A
1776(/*)S
(Leftover)336 1902 A
(characters)420 2280 A
2742(in)S
(the)126 2868 A
(buffer.)294 3036 A
3372(*/)S
6525 V
(14463)210 1122 A
(count)210 1776 A
2028(=)S
2112(bp)S
2238(-)S
(buf;)168 2322 A
6615 V
(14464)210 1122 A
(sys_vircopy\(SELF,)714 1776 A
2532(D,)S
(\(vir_bytes\))462 2658 A
(buf,)168 3162 A
6705 V
(14465)210 1122 A
(tp->tty_inproc,)630 2112 A
2784(D,)S
(tp->tty_in_vir,)630 2910 A
(\(vir_bytes\))462 3582 A
(count\);)294 4086 A
6795 V
(14466)210 1122 A
(tp->tty_in_vir)588 1776 A
2406(+=)S
(count;)252 2532 A
6885 V
(14467)210 1122 A
(tp->tty_incum)546 1776 A
2364(+=)S
(count;)252 2490 A
6975 V
(14468)210 1122 A
1524(})S
7065 V
(14469)210 1122 A
8418 V
EP
%%Page: 188 188
BP
/slant 0 def
/height 0 def
1485 V
12 B
(188)180 1080 A
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(14470)210 1122 A
1524(/*)S
(Usually)294 1650 A
(reply)210 1986 A
2238(to)S
(the)126 2364 A
(reader,)294 2532 A
(possibly)336 2868 A
(even)168 3246 A
3456(if)S
(incum)210 3582 A
3834(==)S
3960(0)S
(\(EOF\).)252 4044 A
4338(*/)S
1845 V
(14471)210 1122 A
1524(if)S
(\(tp->tty_inleft)630 1650 A
2322(==)S
2448(0\))S
2574({)S
1935 V
(14472)210 1122 A
1776(if)S
(\(tp->tty_inrepcode)756 1902 A
2700(==)S
(REVIVE\))294 2826 A
3162({)S
2025 V
(14473)210 1122 A
(notify\(tp->tty_incaller\);)1050 2112 A
2115 V
(14474)210 1122 A
(tp->tty_inrevived)714 2112 A
2868(=)S
2952(1;)S
2205 V
(14475)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
2295 V
(14476)210 1122 A
(tty_reply\(tp->tty_inrepcode,)1176 2112 A
(tp->tty_incaller,)714 3330 A
2385 V
(14477)210 1122 A
(tp->tty_inproc,)630 2448 A
(tp->tty_incum\);)630 3120 A
2475 V
(14478)210 1122 A
(tp->tty_inleft)588 2112 A
2742(=)S
(tp->tty_incum)546 2826 A
3414(=)S
3498(0;)S
2565 V
(14479)210 1122 A
1776(})S
2655 V
(14480)210 1122 A
1524(})S
2745 V
(14481)210 1122 A
1440(})S
2925 V
(14483)210 1122 A
(/*===========================================================================*)3276 1440 A
3015 V
(14484)210 1122 A
1482(*)S
(in_process)420 2784 A
4674(*)S
3105 V
(14485)210 1122 A
(*===========================================================================*/)3276 1482 A
3195 V
(14486)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(in_process\(tp,)588 1902 A
(buf,)168 2532 A
(count\))252 2742 A
3285 V
(14487)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
2784(/*)S
(terminal)336 2910 A
3288(on)S
(which)210 3414 A
(character)378 3666 A
(has)126 4086 A
(arrived)294 4254 A
4590(*/)S
3375 V
(14488)210 1122 A
(char)168 1440 A
(*buf;)210 1650 A
2784(/*)S
(buffer)252 2910 A
(with)168 3204 A
(input)210 3414 A
(characters)420 3666 A
4128(*/)S
3465 V
(14489)210 1122 A
(int)126 1440 A
(count;)252 1608 A
2784(/*)S
(number)252 2910 A
3204(of)S
(input)210 3330 A
(characters)420 3582 A
4044(*/)S
3555 V
(14490)210 1122 A
1440({)S
3645 V
(14491)210 1122 A
1440(/*)S
(Characters)420 1566 A
(have)168 2028 A
(just)168 2238 A
(been)168 2448 A
(typed)210 2658 A
(in.)126 2910 A
(Process,)336 3120 A
(save,)210 3498 A
(and)126 3750 A
(echo)168 3918 A
(them.)210 4128 A
(Return)252 4422 A
3735 V
(14492)210 1122 A
1482(*)S
(the)126 1566 A
(number)252 1734 A
2028(of)S
(characters)420 2154 A
(processed.)420 2616 A
3825 V
(14493)210 1122 A
1482(*/)S
3915 V
(14494)210 1122 A
4005 V
(14495)210 1122 A
(int)126 1524 A
(ch,)126 1692 A
(sig,)168 1860 A
(ct;)126 2070 A
4095 V
(14496)210 1122 A
(int)126 1524 A
(timeset)294 1692 A
2028(=)S
(FALSE;)252 2112 A
4185 V
(14497)210 1122 A
(static)252 1524 A
(unsigned)336 1818 A
(char)168 2196 A
(csize_mask[])504 2406 A
2952(=)S
3036({)S
(0x1F,)210 3120 A
(0x3F,)210 3372 A
(0x7F,)210 3624 A
(0xFF)168 3876 A
4086(};)S
4275 V
(14498)210 1122 A
4365 V
(14499)210 1122 A
(for)126 1524 A
(\(ct)126 1692 A
1860(=)S
1944(0;)S
2070(ct)S
2196(<)S
(count;)252 2280 A
(ct++\))210 2574 A
2826({)S
4455 V
(14500)210 1122 A
1776(/*)S
(Take)168 1902 A
(one)126 2112 A
(character.)420 2280 A
2742(*/)S
4545 V
(14501)210 1122 A
1776(ch)S
1902(=)S
(*buf++)252 1986 A
2280(&)S
(BYTE;)210 2364 A
4635 V
(14502)210 1122 A
4725 V
(14503)210 1122 A
1776(/*)S
(Strip)210 1902 A
2154(to)S
(seven)210 2280 A
(bits?)210 2532 A
2784(*/)S
4815 V
(14504)210 1122 A
1776(if)S
(\(tp->tty_termios.c_iflag)1008 1902 A
2952(&)S
(ISTRIP\))294 3036 A
3372(ch)S
3498(&=)S
(0x7F;)210 3624 A
4905 V
(14505)210 1122 A
4995 V
(14506)210 1122 A
1776(/*)S
(Input)210 1902 A
(extensions?)462 2154 A
2658(*/)S
5085 V
(14507)210 1122 A
1776(if)S
(\(tp->tty_termios.c_lflag)1008 1902 A
2952(&)S
(IEXTEN\))294 3036 A
3372({)S
5175 V
(14508)210 1122 A
5265 V
(14509)210 1122 A
2112(/*)S
(Previous)336 2238 A
(character)378 2616 A
(was)126 3036 A
3204(a)S
(character)378 3288 A
(escape?)294 3708 A
4044(*/)S
5355 V
(14510)210 1122 A
2112(if)S
(\(tp->tty_escaped\))714 2238 A
2994({)S
5445 V
(14511)210 1122 A
(tp->tty_escaped)630 2448 A
3120(=)S
(NOT_ESCAPED;)504 3204 A
5535 V
(14512)210 1122 A
2448(ch)S
2574(|=)S
(IN_ESC;)294 2700 A
3120(/*)S
(protect)294 3246 A
(character)378 3582 A
4002(*/)S
5625 V
(14513)210 1122 A
2112(})S
5715 V
(14514)210 1122 A
5805 V
(14515)210 1122 A
2112(/*)S
(LNEXT)210 2238 A
(\(\303V\))168 2490 A
2700(to)S
(escape)252 2826 A
(the)126 3120 A
(next)168 3288 A
(character?)420 3498 A
3960(*/)S
5895 V
(14516)210 1122 A
2112(if)S
(\(ch)126 2238 A
2406(==)S
(tp->tty_termios.c_cc[VLNEXT]\))1218 2532 A
3792({)S
5985 V
(14517)210 1122 A
(tp->tty_escaped)630 2448 A
3120(=)S
(ESCAPED;)336 3204 A
6075 V
(14518)210 1122 A
(rawecho\(tp,)462 2448 A
('\303'\);)210 2952 A
6165 V
(14519)210 1122 A
(rawecho\(tp,)462 2448 A
('\\b'\);)252 2952 A
6255 V
(14520)210 1122 A
(continue;)378 2448 A
3120(/*)S
3246(do)S
(not)126 3372 A
(store)210 3540 A
(the)126 3792 A
(escape)252 3960 A
4254(*/)S
6345 V
(14521)210 1122 A
2112(})S
6435 V
(14522)210 1122 A
6525 V
(14523)210 1122 A
2112(/*)S
(REPRINT)294 2238 A
(\(\303R\))168 2574 A
2784(to)S
(reprint)294 2910 A
(echoed)252 3246 A
(characters?)462 3540 A
4044(*/)S
6615 V
(14524)210 1122 A
2112(if)S
(\(ch)126 2238 A
2406(==)S
(tp->tty_termios.c_cc[VREPRINT]\))1302 2532 A
3876({)S
6705 V
(14525)210 1122 A
(reprint\(tp\);)504 2448 A
6795 V
(14526)210 1122 A
(continue;)378 2448 A
6885 V
(14527)210 1122 A
2112(})S
6975 V
(14528)210 1122 A
1776(})S
7065 V
(14529)210 1122 A
8418 V
EP
%%Page: 189 189
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
12 B
(189)180 4500 A
1755 V
7 LST
(14530)210 1122 A
1776(/*)S
(_POSIX_VDISABLE)630 1902 A
2574(is)S
2700(a)S
(normal)252 2784 A
(character)378 3078 A
(value,)252 3498 A
3792(so)S
(better)252 3918 A
(escape)252 4212 A
(it.)126 4506 A
4674(*/)S
1845 V
(14531)210 1122 A
1776(if)S
(\(ch)126 1902 A
2070(==)S
(_POSIX_VDISABLE\))672 2196 A
2910(ch)S
3036(|=)S
(IN_ESC;)294 3162 A
1935 V
(14532)210 1122 A
2025 V
(14533)210 1122 A
1776(/*)S
(Map)126 1902 A
2070(CR)S
2196(to)S
(LF,)126 2322 A
(ignore)252 2490 A
(CR,)126 2784 A
2952(or)S
(map)126 3078 A
3246(LF)S
3372(to)S
(CR.)126 3498 A
3666(*/)S
2115 V
(14534)210 1122 A
1776(if)S
(\(ch)126 1902 A
2070(==)S
('\\r'\))210 2196 A
2448({)S
2205 V
(14535)210 1122 A
2112(if)S
(\(tp->tty_termios.c_iflag)1008 2238 A
3288(&)S
(IGNCR\))252 3372 A
(continue;)378 3666 A
2295 V
(14536)210 1122 A
2112(if)S
(\(tp->tty_termios.c_iflag)1008 2238 A
3288(&)S
(ICRNL\))252 3372 A
3666(ch)S
3792(=)S
('\\n';)210 3876 A
2385 V
(14537)210 1122 A
1776(})S
(else)168 1860 A
2475 V
(14538)210 1122 A
1776(if)S
(\(ch)126 1902 A
2070(==)S
('\\n'\))210 2196 A
2448({)S
2565 V
(14539)210 1122 A
2112(if)S
(\(tp->tty_termios.c_iflag)1008 2238 A
3288(&)S
(INLCR\))252 3372 A
3666(ch)S
3792(=)S
('\\r';)210 3876 A
2655 V
(14540)210 1122 A
1776(})S
2745 V
(14541)210 1122 A
2835 V
(14542)210 1122 A
1776(/*)S
(Canonical)378 1902 A
(mode?)210 2322 A
2574(*/)S
2925 V
(14543)210 1122 A
1776(if)S
(\(tp->tty_termios.c_lflag)1008 1902 A
2952(&)S
(ICANON\))294 3036 A
3372({)S
3015 V
(14544)210 1122 A
3105 V
(14545)210 1122 A
2112(/*)S
(Erase)210 2238 A
(processing)420 2490 A
(\(rub)168 2952 A
(out)126 3162 A
3330(of)S
(last)168 3456 A
(character\).)462 3666 A
4170(*/)S
3195 V
(14546)210 1122 A
2112(if)S
(\(ch)126 2238 A
2406(==)S
(tp->tty_termios.c_cc[VERASE]\))1218 2532 A
3792({)S
3285 V
(14547)210 1122 A
(\(void\))252 2448 A
(back_over\(tp\);)588 2742 A
3375 V
(14548)210 1122 A
2448(if)S
(\(!\(tp->tty_termios.c_lflag)1092 2574 A
3708(&)S
(ECHOE\)\))294 3792 A
4128({)S
3465 V
(14549)210 1122 A
(\(void\))252 2784 A
(tty_echo\(tp,)504 3078 A
(ch\);)168 3624 A
3555 V
(14550)210 1122 A
2448(})S
3645 V
(14551)210 1122 A
(continue;)378 2448 A
3735 V
(14552)210 1122 A
2112(})S
3825 V
(14553)210 1122 A
3915 V
(14554)210 1122 A
2112(/*)S
(Kill)168 2238 A
(processing)420 2448 A
(\(remove)294 2910 A
(current)294 3246 A
(line\).)252 3582 A
3876(*/)S
4005 V
(14555)210 1122 A
2112(if)S
(\(ch)126 2238 A
2406(==)S
(tp->tty_termios.c_cc[VKILL]\))1176 2532 A
3750({)S
4095 V
(14556)210 1122 A
(while)210 2448 A
(\(back_over\(tp\)\))630 2700 A
3372({})S
4185 V
(14557)210 1122 A
2448(if)S
(\(!\(tp->tty_termios.c_lflag)1092 2574 A
3708(&)S
(ECHOE\)\))294 3792 A
4128({)S
4275 V
(14558)210 1122 A
(\(void\))252 2784 A
(tty_echo\(tp,)504 3078 A
(ch\);)168 3624 A
4365 V
(14559)210 1122 A
2784(if)S
(\(tp->tty_termios.c_lflag)1008 2910 A
3960(&)S
(ECHOK\))252 4044 A
4455 V
(14560)210 1122 A
(rawecho\(tp,)462 3120 A
('\\n'\);)252 3624 A
4545 V
(14561)210 1122 A
2448(})S
4635 V
(14562)210 1122 A
(continue;)378 2448 A
4725 V
(14563)210 1122 A
2112(})S
4815 V
(14564)210 1122 A
4905 V
(14565)210 1122 A
2112(/*)S
(EOF)126 2238 A
(\(\303D\))168 2406 A
(means)210 2616 A
(end-of-file,)504 2868 A
3414(an)S
(invisible)378 3540 A
("line)210 3960 A
(break".)294 4212 A
4548(*/)S
4995 V
(14566)210 1122 A
2112(if)S
(\(ch)126 2238 A
2406(==)S
(tp->tty_termios.c_cc[VEOF]\))1134 2532 A
3708(ch)S
3834(|=)S
(IN_EOT)252 3960 A
4254(|)S
(IN_EOF;)294 4338 A
5085 V
(14567)210 1122 A
5175 V
(14568)210 1122 A
2112(/*)S
(The)126 2238 A
(line)168 2406 A
(may)126 2616 A
2784(be)S
(returned)336 2910 A
3288(to)S
(the)126 3414 A
(user)168 3582 A
(after)210 3792 A
4044(an)S
(LF.)126 4170 A
4338(*/)S
5265 V
(14569)210 1122 A
2112(if)S
(\(ch)126 2238 A
2406(==)S
('\\n'\))210 2532 A
2784(ch)S
2910(|=)S
(IN_EOT;)294 3036 A
5355 V
(14570)210 1122 A
5445 V
(14571)210 1122 A
2112(/*)S
(Same)168 2238 A
(thing)210 2448 A
(with)168 2700 A
(EOL,)168 2910 A
(whatever)336 3120 A
3498(it)S
(may)126 3624 A
(be.)126 3792 A
3960(*/)S
5535 V
(14572)210 1122 A
2112(if)S
(\(ch)126 2238 A
2406(==)S
(tp->tty_termios.c_cc[VEOL]\))1134 2532 A
3708(ch)S
3834(|=)S
(IN_EOT;)294 3960 A
5625 V
(14573)210 1122 A
1776(})S
5715 V
(14574)210 1122 A
5805 V
(14575)210 1122 A
1776(/*)S
(Start/stop)420 1902 A
(input)210 2364 A
(control?)336 2616 A
2994(*/)S
5895 V
(14576)210 1122 A
1776(if)S
(\(tp->tty_termios.c_iflag)1008 1902 A
2952(&)S
(IXON\))210 3036 A
3288({)S
5985 V
(14577)210 1122 A
6075 V
(14578)210 1122 A
2112(/*)S
(Output)252 2238 A
(stops)210 2532 A
2784(on)S
(STOP)168 2910 A
(\(\303S\).)210 3120 A
3372(*/)S
6165 V
(14579)210 1122 A
2112(if)S
(\(ch)126 2238 A
2406(==)S
(tp->tty_termios.c_cc[VSTOP]\))1176 2532 A
3750({)S
6255 V
(14580)210 1122 A
(tp->tty_inhibited)714 2448 A
3204(=)S
(STOPPED;)336 3288 A
6345 V
(14581)210 1122 A
(tp->tty_events)588 2448 A
3078(=)S
3162(1;)S
6435 V
(14582)210 1122 A
(continue;)378 2448 A
6525 V
(14583)210 1122 A
2112(})S
6615 V
(14584)210 1122 A
6705 V
(14585)210 1122 A
2112(/*)S
(Output)252 2238 A
(restarts)336 2532 A
2910(on)S
(START)210 3036 A
(\(\303Q\))168 3288 A
3498(or)S
(any)126 3624 A
(character)378 3792 A
4212(if)S
(IXANY.)252 4338 A
4632(*/)S
6795 V
(14586)210 1122 A
2112(if)S
(\(tp->tty_inhibited\))798 2238 A
3078({)S
6885 V
(14587)210 1122 A
2448(if)S
(\(ch)126 2574 A
2742(==)S
(tp->tty_termios.c_cc[VSTART])1176 2868 A
6975 V
(14588)210 1122 A
3120(||)S
(\(tp->tty_termios.c_iflag)1008 3246 A
4296(&)S
(IXANY\)\))294 4380 A
4716({)S
7065 V
(14589)210 1122 A
(tp->tty_inhibited)714 2784 A
3540(=)S
(RUNNING;)336 3624 A
8418 V
EP
%%Page: 190 190
BP
/slant 0 def
/height 0 def
1485 V
12 B
(190)180 1080 A
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(14590)210 1122 A
(tp->tty_events)588 2784 A
3414(=)S
3498(1;)S
1845 V
(14591)210 1122 A
2784(if)S
(\(ch)126 2910 A
3078(==)S
(tp->tty_termios.c_cc[VSTART]\))1218 3204 A
1935 V
(14592)210 1122 A
(continue;)378 3120 A
2025 V
(14593)210 1122 A
2448(})S
2115 V
(14594)210 1122 A
2112(})S
2205 V
(14595)210 1122 A
1776(})S
2295 V
(14596)210 1122 A
2385 V
(14597)210 1122 A
1776(if)S
(\(tp->tty_termios.c_lflag)1008 1902 A
2952(&)S
(ISIG\))210 3036 A
3288({)S
2475 V
(14598)210 1122 A
2112(/*)S
(Check)210 2238 A
(for)126 2490 A
(INTR)168 2658 A
(\(\303?\))168 2868 A
(and)126 3078 A
(QUIT)168 3246 A
(\(\303\\\))168 3456 A
(characters.)462 3666 A
4170(*/)S
2565 V
(14599)210 1122 A
2112(if)S
(\(ch)126 2238 A
2406(==)S
(tp->tty_termios.c_cc[VINTR])1134 2532 A
2655 V
(14600)210 1122 A
3120(||)S
3246(ch)S
3372(==)S
(tp->tty_termios.c_cc[VQUIT]\))1176 3498 A
4716({)S
2745 V
(14601)210 1122 A
(sig)126 2448 A
2616(=)S
(SIGINT;)294 2700 A
2835 V
(14602)210 1122 A
2448(if)S
(\(ch)126 2574 A
2742(==)S
(tp->tty_termios.c_cc[VQUIT]\))1176 2868 A
(sig)126 4086 A
4254(=)S
(SIGQUIT;)336 4338 A
2925 V
(14603)210 1122 A
(sigchar\(tp,)462 2448 A
(sig\);)210 2952 A
3015 V
(14604)210 1122 A
(\(void\))252 2448 A
(tty_echo\(tp,)504 2742 A
(ch\);)168 3288 A
3105 V
(14605)210 1122 A
(continue;)378 2448 A
3195 V
(14606)210 1122 A
2112(})S
3285 V
(14607)210 1122 A
1776(})S
3375 V
(14608)210 1122 A
3465 V
(14609)210 1122 A
1776(/*)S
1902(Is)S
(there)210 2028 A
(space)210 2280 A
2532(in)S
(the)126 2658 A
(input)210 2826 A
(buffer?)294 3078 A
3414(*/)S
3555 V
(14610)210 1122 A
1776(if)S
(\(tp->tty_incount)672 1902 A
2616(==)S
(buflen\(tp->tty_inbuf\)\))924 2742 A
3708({)S
3645 V
(14611)210 1122 A
2112(/*)S
2238(No)S
(space;)252 2364 A
(discard)294 2658 A
2994(in)S
(canonical)378 3120 A
(mode,)210 3540 A
(keep)168 3792 A
4002(in)S
(raw)126 4128 A
(mode.)210 4296 A
4548(*/)S
3735 V
(14612)210 1122 A
2112(if)S
(\(tp->tty_termios.c_lflag)1008 2238 A
3288(&)S
(ICANON\))294 3372 A
(continue;)378 3708 A
3825 V
(14613)210 1122 A
(break;)252 2112 A
3915 V
(14614)210 1122 A
1776(})S
4005 V
(14615)210 1122 A
4095 V
(14616)210 1122 A
1776(if)S
(\(!\(tp->tty_termios.c_lflag)1092 1902 A
3036(&)S
(ICANON\)\))336 3120 A
3498({)S
4185 V
(14617)210 1122 A
2112(/*)S
2238(In)S
(raw)126 2364 A
(mode)168 2532 A
(all)126 2742 A
(characters)420 2910 A
(are)126 3372 A
("line)210 3540 A
(breaks".)336 3792 A
4170(*/)S
4275 V
(14618)210 1122 A
2112(ch)S
2238(|=)S
(IN_EOT;)294 2364 A
4365 V
(14619)210 1122 A
4455 V
(14620)210 1122 A
2112(/*)S
(Start)210 2238 A
2490(an)S
(inter-byte)420 2616 A
(timer?)252 3078 A
3372(*/)S
4545 V
(14621)210 1122 A
2112(if)S
(\(!timeset)378 2238 A
2658(&&)S
(tp->tty_termios.c_cc[VMIN])1092 2784 A
3918(>)S
4002(0)S
4635 V
(14622)210 1122 A
2784(&&)S
(tp->tty_termios.c_cc[VTIME])1134 2910 A
4086(>)S
4170(0\))S
4296({)S
4725 V
(14623)210 1122 A
(settimer\(tp,)504 2448 A
(TRUE\);)252 2994 A
4815 V
(14624)210 1122 A
(timeset)294 2448 A
2784(=)S
(TRUE;)210 2868 A
4905 V
(14625)210 1122 A
2112(})S
4995 V
(14626)210 1122 A
1776(})S
5085 V
(14627)210 1122 A
5175 V
(14628)210 1122 A
1776(/*)S
(Perform)294 1902 A
(the)126 2238 A
(intricate)378 2406 A
(function)336 2826 A
3204(of)S
(echoing.)336 3330 A
3708(*/)S
5265 V
(14629)210 1122 A
1776(if)S
(\(tp->tty_termios.c_lflag)1008 1902 A
2952(&)S
(\(ECHO|ECHONL\)\))588 3036 A
3666(ch)S
3792(=)S
(tty_echo\(tp,)504 3876 A
(ch\);)168 4422 A
5355 V
(14630)210 1122 A
5445 V
(14631)210 1122 A
1776(/*)S
(Save)168 1902 A
(the)126 2112 A
(character)378 2280 A
2700(in)S
(the)126 2826 A
(input)210 2994 A
(queue.)252 3246 A
3540(*/)S
5535 V
(14632)210 1122 A
(*tp->tty_inhead++)714 1776 A
2532(=)S
(ch;)126 2616 A
5625 V
(14633)210 1122 A
1776(if)S
(\(tp->tty_inhead)630 1902 A
2574(==)S
(bufend\(tp->tty_inbuf\)\))924 2700 A
5715 V
(14634)210 1122 A
(tp->tty_inhead)588 2112 A
2742(=)S
(tp->tty_inbuf;)588 2826 A
5805 V
(14635)210 1122 A
(tp->tty_incount++;)756 1776 A
5895 V
(14636)210 1122 A
1776(if)S
(\(ch)126 1902 A
2070(&)S
(IN_EOT\))294 2154 A
(tp->tty_eotct++;)672 2490 A
5985 V
(14637)210 1122 A
6075 V
(14638)210 1122 A
1776(/*)S
(Try)126 1902 A
2070(to)S
(finish)252 2196 A
(input)210 2490 A
2742(if)S
(the)126 2868 A
(queue)210 3036 A
(threatens)378 3288 A
3708(to)S
(overflow.)378 3834 A
4254(*/)S
6165 V
(14639)210 1122 A
1776(if)S
(\(tp->tty_incount)672 1902 A
2616(==)S
(buflen\(tp->tty_inbuf\)\))924 2742 A
(in_transfer\(tp\);)672 3708 A
6255 V
(14640)210 1122 A
1524(})S
6345 V
(14641)210 1122 A
(return)252 1524 A
(ct;)126 1818 A
6435 V
(14642)210 1122 A
1440(})S
6615 V
(14644)210 1122 A
(/*===========================================================================*)3276 1440 A
6705 V
(14645)210 1122 A
1482(*)S
(echo)168 2784 A
4674(*)S
6795 V
(14646)210 1122 A
(*===========================================================================*/)3276 1482 A
6885 V
(14647)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(tty_echo\(tp,)504 1944 A
(ch\))126 2490 A
6975 V
(14648)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
2784(/*)S
(terminal)336 2910 A
3288(on)S
(which)210 3414 A
3666(to)S
(echo)168 3792 A
4002(*/)S
7065 V
(14649)210 1122 A
(register)336 1440 A
(int)126 1818 A
(ch;)126 1986 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(character)378 3372 A
3792(to)S
(echo)168 3918 A
4128(*/)S
8418 V
EP
%%Page: 191 191
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
12 B
(191)180 4500 A
1755 V
7 LST
(14650)210 1122 A
1440({)S
1845 V
(14651)210 1122 A
1440(/*)S
(Echo)168 1566 A
(the)126 1776 A
(character)378 1944 A
2364(if)S
(echoing)294 2490 A
2826(is)S
(on.)126 2952 A
(Some)168 3162 A
(control)294 3372 A
(characters)420 3708 A
(are)126 4170 A
(echoed)252 4338 A
1935 V
(14652)210 1122 A
1482(*)S
(with)168 1566 A
(their)210 1776 A
(normal)252 2028 A
(effect,)294 2322 A
(other)210 2658 A
(control)294 2910 A
(characters)420 3246 A
(are)126 3708 A
(echoed)252 3876 A
4170(as)S
("\303X",)210 4296 A
2025 V
(14653)210 1122 A
1482(*)S
(normal)252 1566 A
(characters)420 1860 A
(are)126 2322 A
(echoed)252 2490 A
(normally.)378 2784 A
(EOF)126 3246 A
(\(\303D\))168 3414 A
3624(is)S
(echoed,)294 3750 A
(but)126 4086 A
(immediately)462 4254 A
2115 V
(14654)210 1122 A
1482(*)S
(backspaced)420 1566 A
(over.)210 2028 A
(Return)252 2322 A
(the)126 2616 A
(character)378 2784 A
(with)168 3204 A
(the)126 3414 A
(echoed)252 3582 A
(length)252 3876 A
(added)210 4170 A
4422(to)S
(its)126 4548 A
2205 V
(14655)210 1122 A
1482(*)S
(attributes.)462 1566 A
2295 V
(14656)210 1122 A
1482(*/)S
2385 V
(14657)210 1122 A
(int)126 1524 A
(len,)168 1692 A
(rp;)126 1902 A
2475 V
(14658)210 1122 A
2565 V
(14659)210 1122 A
1524(ch)S
1650(&=)S
(\304IN_LEN;)336 1776 A
2655 V
(14660)210 1122 A
1524(if)S
(\(!\(tp->tty_termios.c_lflag)1092 1650 A
2784(&)S
(ECHO\)\))252 2868 A
3162({)S
2745 V
(14661)210 1122 A
1776(if)S
(\(ch)126 1902 A
2070(==)S
(\('\\n')210 2196 A
2448(|)S
(IN_EOT\))294 2532 A
2868(&&)S
(\(tp->tty_termios.c_lflag)1008 2994 A
2835 V
(14662)210 1122 A
3120(&)S
(\(ICANON|ECHONL\)\))672 3204 A
3918(==)S
(\(ICANON|ECHONL\)\))672 4044 A
2925 V
(14663)210 1122 A
(\(*tp->tty_echo\)\(tp,)798 2112 A
('\\n'\);)252 2952 A
3015 V
(14664)210 1122 A
(return\(ch\);)462 1776 A
3105 V
(14665)210 1122 A
1524(})S
3195 V
(14666)210 1122 A
3285 V
(14667)210 1122 A
1524(/*)S
("Reprint")378 1650 A
(tells)210 2070 A
2322(if)S
(the)126 2448 A
(echo)168 2616 A
(output)252 2826 A
(has)126 3120 A
(been)168 3288 A
(messed)252 3498 A
3792(up)S
3918(by)S
(other)210 4044 A
(output.)294 4296 A
4632(*/)S
3375 V
(14668)210 1122 A
1524(rp)S
1650(=)S
(tp->tty_incount)630 1734 A
2406(==)S
2532(0)S
2616(?)S
(FALSE)210 2700 A
2952(:)S
(tp->tty_reprint;)672 3036 A
3465 V
(14669)210 1122 A
3555 V
(14670)210 1122 A
1524(if)S
(\(\(ch)168 1650 A
1860(&)S
(IN_CHAR\))336 1944 A
2322(<)S
2406(')S
2490('\))S
2616({)S
3645 V
(14671)210 1122 A
(switch)252 1776 A
(\(ch)126 2070 A
2238(&)S
(\(IN_ESC|IN_EOF|IN_EOT|IN_CHAR\)\))1302 2322 A
3666({)S
3735 V
(14672)210 1122 A
(case)168 1944 A
('\\t':)210 2154 A
3825 V
(14673)210 1122 A
(len)126 2112 A
2280(=)S
2364(0;)S
3915 V
(14674)210 1122 A
2112(do)S
2238({)S
4005 V
(14675)210 1122 A
(\(*tp->tty_echo\)\(tp,)798 2448 A
3288(')S
('\);)126 3372 A
4095 V
(14676)210 1122 A
(len++;)252 2448 A
4185 V
(14677)210 1122 A
2112(})S
(while)210 2196 A
(\(len)168 2448 A
2658(<)S
(TAB_SIZE)336 2742 A
3120(&&)S
(\(tp->tty_position)714 3246 A
4002(&)S
(TAB_MASK\))378 4086 A
4506(!=)S
(0\);)126 4632 A
4275 V
(14678)210 1122 A
(break;)252 2112 A
4365 V
(14679)210 1122 A
(case)168 1944 A
('\\r')168 2154 A
2364(|)S
(IN_EOT:)294 2448 A
4455 V
(14680)210 1122 A
(case)168 1944 A
('\\n')168 2154 A
2364(|)S
(IN_EOT:)294 2448 A
4545 V
(14681)210 1122 A
(\(*tp->tty_echo\)\(tp,)798 2112 A
2952(ch)S
3078(&)S
(IN_CHAR\);)378 3162 A
4635 V
(14682)210 1122 A
(len)126 2112 A
2280(=)S
2364(0;)S
4725 V
(14683)210 1122 A
(break;)252 2112 A
4815 V
(14684)210 1122 A
(default:)336 1944 A
4905 V
(14685)210 1122 A
(\(*tp->tty_echo\)\(tp,)798 2112 A
('\303'\);)210 2952 A
4995 V
(14686)210 1122 A
(\(*tp->tty_echo\)\(tp,)798 2112 A
('@')126 2952 A
3120(+)S
(\(ch)126 3204 A
3372(&)S
(IN_CHAR\)\);)420 3456 A
5085 V
(14687)210 1122 A
(len)126 2112 A
2280(=)S
2364(2;)S
5175 V
(14688)210 1122 A
1776(})S
5265 V
(14689)210 1122 A
1524(})S
(else)168 1608 A
5355 V
(14690)210 1122 A
1524(if)S
(\(\(ch)168 1650 A
1860(&)S
(IN_CHAR\))336 1944 A
2322(==)S
('\\177'\))294 2448 A
2784({)S
5445 V
(14691)210 1122 A
1776(/*)S
1902(A)S
(DEL)126 1986 A
(prints)252 2154 A
2448(as)S
("\303?".)210 2574 A
2826(*/)S
5535 V
(14692)210 1122 A
(\(*tp->tty_echo\)\(tp,)798 1776 A
('\303'\);)210 2616 A
5625 V
(14693)210 1122 A
(\(*tp->tty_echo\)\(tp,)798 1776 A
('?'\);)210 2616 A
5715 V
(14694)210 1122 A
(len)126 1776 A
1944(=)S
2028(2;)S
5805 V
(14695)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
5895 V
(14696)210 1122 A
(\(*tp->tty_echo\)\(tp,)798 1776 A
2616(ch)S
2742(&)S
(IN_CHAR\);)378 2826 A
5985 V
(14697)210 1122 A
(len)126 1776 A
1944(=)S
2028(1;)S
6075 V
(14698)210 1122 A
1524(})S
6165 V
(14699)210 1122 A
1524(if)S
(\(ch)126 1650 A
1818(&)S
(IN_EOF\))294 1902 A
(while)210 2238 A
(\(len)168 2490 A
2700(>)S
2784(0\))S
2910({)S
(\(*tp->tty_echo\)\(tp,)798 2994 A
('\\b'\);)252 3834 A
(len--;)252 4128 A
4422(})S
6255 V
(14700)210 1122 A
6345 V
(14701)210 1122 A
(tp->tty_reprint)630 1524 A
2196(=)S
(rp;)126 2280 A
6435 V
(14702)210 1122 A
(return\(ch)378 1524 A
1944(|)S
(\(len)168 2028 A
2238(<<)S
(IN_LSHIFT\)\);)504 2364 A
6525 V
(14703)210 1122 A
1440(})S
6705 V
(14705)210 1122 A
(/*===========================================================================*)3276 1440 A
6795 V
(14706)210 1122 A
1482(*)S
(rawecho)294 2784 A
4674(*)S
6885 V
(14707)210 1122 A
(*===========================================================================*/)3276 1482 A
6975 V
(14708)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(rawecho\(tp,)462 1986 A
(ch\))126 2490 A
7065 V
(14709)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
8418 V
EP
%%Page: 192 192
BP
/slant 0 def
/height 0 def
1485 V
12 B
(192)180 1080 A
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(14710)210 1122 A
(int)126 1440 A
(ch;)126 1608 A
1845 V
(14711)210 1122 A
1440({)S
1935 V
(14712)210 1122 A
1440(/*)S
(Echo)168 1566 A
(without)294 1776 A
(interpretation)588 2112 A
2742(if)S
(ECHO)168 2868 A
3078(is)S
(set.)168 3204 A
3414(*/)S
2025 V
(14713)210 1122 A
(int)126 1524 A
1692(rp)S
1818(=)S
(tp->tty_reprint;)672 1902 A
2115 V
(14714)210 1122 A
1524(if)S
(\(tp->tty_termios.c_lflag)1008 1650 A
2700(&)S
(ECHO\))210 2784 A
(\(*tp->tty_echo\)\(tp,)798 3036 A
(ch\);)168 3876 A
2205 V
(14715)210 1122 A
(tp->tty_reprint)630 1524 A
2196(=)S
(rp;)126 2280 A
2295 V
(14716)210 1122 A
1440(})S
2475 V
(14718)210 1122 A
(/*===========================================================================*)3276 1440 A
2565 V
(14719)210 1122 A
1482(*)S
(back_over)378 2784 A
4674(*)S
2655 V
(14720)210 1122 A
(*===========================================================================*/)3276 1482 A
2745 V
(14721)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(back_over\(tp\))546 1944 A
2835 V
(14722)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
2925 V
(14723)210 1122 A
1440({)S
3015 V
(14724)210 1122 A
1440(/*)S
(Backspace)378 1566 A
1986(to)S
(previous)336 2112 A
(character)378 2490 A
2910(on)S
(screen)252 3036 A
(and)126 3330 A
(erase)210 3498 A
(it.)126 3750 A
3918(*/)S
3105 V
(14725)210 1122 A
(u16_t)210 1524 A
(*head;)252 1776 A
3195 V
(14726)210 1122 A
(int)126 1524 A
(len;)168 1692 A
3285 V
(14727)210 1122 A
3375 V
(14728)210 1122 A
1524(if)S
(\(tp->tty_incount)672 1650 A
2364(==)S
2490(0\))S
(return\(0\);)420 2616 A
3120(/*)S
(queue)210 3246 A
(empty)210 3498 A
3750(*/)S
3465 V
(14729)210 1122 A
(head)168 1524 A
1734(=)S
(tp->tty_inhead;)630 1818 A
3555 V
(14730)210 1122 A
1524(if)S
(\(head)210 1650 A
1902(==)S
(tp->tty_inbuf\))588 2028 A
(head)168 2658 A
2868(=)S
(bufend\(tp->tty_inbuf\);)924 2952 A
3645 V
(14731)210 1122 A
1524(if)S
(\(*--head)336 1650 A
2028(&)S
(IN_EOT\))294 2112 A
(return\(0\);)420 2448 A
3456(/*)S
(can't)210 3582 A
(erase)210 3834 A
("line)210 4086 A
(breaks")294 4338 A
4674(*/)S
3735 V
(14732)210 1122 A
1524(if)S
(\(tp->tty_reprint\))714 1650 A
(reprint\(tp\);)504 2406 A
3456(/*)S
(reprint)294 3582 A
3918(if)S
(messed)252 4044 A
4338(up)S
4464(*/)S
3825 V
(14733)210 1122 A
(tp->tty_inhead)588 1524 A
2154(=)S
(head;)210 2238 A
3915 V
(14734)210 1122 A
(tp->tty_incount--;)756 1524 A
4005 V
(14735)210 1122 A
1524(if)S
(\(tp->tty_termios.c_lflag)1008 1650 A
2700(&)S
(ECHOE\))252 2784 A
3078({)S
4095 V
(14736)210 1122 A
(len)126 1776 A
1944(=)S
(\(*head)252 2028 A
2322(&)S
(IN_LEN\))294 2406 A
2742(>>)S
(IN_LSHIFT;)420 2868 A
4185 V
(14737)210 1122 A
(while)210 1776 A
(\(len)168 2028 A
2238(>)S
2322(0\))S
2448({)S
4275 V
(14738)210 1122 A
(rawecho\(tp,)462 2112 A
('\\b'\);)252 2616 A
4365 V
(14739)210 1122 A
(rawecho\(tp,)462 2112 A
2616(')S
('\);)126 2700 A
4455 V
(14740)210 1122 A
(rawecho\(tp,)462 2112 A
('\\b'\);)252 2616 A
4545 V
(14741)210 1122 A
(len--;)252 2112 A
4635 V
(14742)210 1122 A
1776(})S
4725 V
(14743)210 1122 A
1524(})S
4815 V
(14744)210 1122 A
(return\(1\);)420 1524 A
3120(/*)S
(one)126 3246 A
(character)378 3414 A
(erased)252 3834 A
4128(*/)S
4905 V
(14745)210 1122 A
1440(})S
5085 V
(14747)210 1122 A
(/*===========================================================================*)3276 1440 A
5175 V
(14748)210 1122 A
1482(*)S
(reprint)294 2784 A
4674(*)S
5265 V
(14749)210 1122 A
(*===========================================================================*/)3276 1482 A
5355 V
(14750)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(reprint\(tp\))462 1986 A
5445 V
(14751)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(tty)126 3372 A
(struct)252 3540 A
3834(*/)S
5535 V
(14752)210 1122 A
1440({)S
5625 V
(14753)210 1122 A
1440(/*)S
(Restore)294 1566 A
(what)168 1902 A
(has)126 2112 A
(been)168 2280 A
(echoed)252 2490 A
2784(to)S
(screen)252 2910 A
(before)252 3204 A
3498(if)S
(the)126 3624 A
(user)168 3792 A
(input)210 4002 A
(has)126 4254 A
(been)168 4422 A
5715 V
(14754)210 1122 A
1482(*)S
(messed)252 1566 A
1860(up)S
1986(by)S
(output,)294 2112 A
2448(or)S
2574(if)S
(REPRINT)294 2700 A
(\(\303R\))168 3036 A
3246(is)S
(typed.)252 3372 A
5805 V
(14755)210 1122 A
1482(*/)S
5895 V
(14756)210 1122 A
(int)126 1524 A
(count;)252 1692 A
5985 V
(14757)210 1122 A
(u16_t)210 1524 A
(*head;)252 1776 A
6075 V
(14758)210 1122 A
6165 V
(14759)210 1122 A
(tp->tty_reprint)630 1524 A
2196(=)S
(FALSE;)252 2280 A
6255 V
(14760)210 1122 A
6345 V
(14761)210 1122 A
1524(/*)S
(Find)168 1650 A
(the)126 1860 A
(last)168 2028 A
(line)168 2238 A
(break)210 2448 A
2700(in)S
(the)126 2826 A
(input.)252 2994 A
3288(*/)S
6435 V
(14762)210 1122 A
(head)168 1524 A
1734(=)S
(tp->tty_inhead;)630 1818 A
6525 V
(14763)210 1122 A
(count)210 1524 A
1776(=)S
(tp->tty_incount;)672 1860 A
6615 V
(14764)210 1122 A
(while)210 1524 A
(\(count)252 1776 A
2070(>)S
2154(0\))S
2280({)S
6705 V
(14765)210 1122 A
1776(if)S
(\(head)210 1902 A
2154(==)S
(tp->tty_inbuf\))588 2280 A
(head)168 2910 A
3120(=)S
(bufend\(tp->tty_inbuf\);)924 3204 A
6795 V
(14766)210 1122 A
1776(if)S
(\(head[-1])378 1902 A
2322(&)S
(IN_EOT\))294 2406 A
(break;)252 2742 A
6885 V
(14767)210 1122 A
(head--;)294 1776 A
6975 V
(14768)210 1122 A
(count--;)336 1776 A
7065 V
(14769)210 1122 A
1524(})S
8418 V
EP
%%Page: 193 193
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
12 B
(193)180 4500 A
1755 V
7 LST
(14770)210 1122 A
1524(if)S
(\(count)252 1650 A
1944(==)S
(tp->tty_incount\))672 2070 A
(return;)294 2784 A
3456(/*)S
3582(no)S
(reason)252 3708 A
4002(to)S
(reprint)294 4128 A
4464(*/)S
1845 V
(14771)210 1122 A
1935 V
(14772)210 1122 A
1524(/*)S
(Show)168 1650 A
(REPRINT)294 1860 A
(\(\303R\))168 2196 A
(and)126 2406 A
(move)168 2574 A
2784(to)S
2910(a)S
(new)126 2994 A
(line.)210 3162 A
3414(*/)S
2025 V
(14773)210 1122 A
(\(void\))252 1524 A
(tty_echo\(tp,)504 1818 A
(tp->tty_termios.c_cc[VREPRINT])1260 2364 A
3666(|)S
(IN_ESC\);)336 3750 A
2115 V
(14774)210 1122 A
(rawecho\(tp,)462 1524 A
('\\r'\);)252 2028 A
2205 V
(14775)210 1122 A
(rawecho\(tp,)462 1524 A
('\\n'\);)252 2028 A
2295 V
(14776)210 1122 A
2385 V
(14777)210 1122 A
1524(/*)S
(Reprint)294 1650 A
(from)168 1986 A
(the)126 2196 A
(last)168 2364 A
(break)210 2574 A
(onwards.)336 2826 A
3204(*/)S
2475 V
(14778)210 1122 A
1524(do)S
1650({)S
2565 V
(14779)210 1122 A
1776(if)S
(\(head)210 1902 A
2154(==)S
(bufend\(tp->tty_inbuf\)\))924 2280 A
(head)168 3246 A
3456(=)S
(tp->tty_inbuf;)588 3540 A
2655 V
(14780)210 1122 A
(*head)210 1776 A
2028(=)S
(tty_echo\(tp,)504 2112 A
(*head\);)294 2658 A
2745 V
(14781)210 1122 A
(head++;)294 1776 A
2835 V
(14782)210 1122 A
(count++;)336 1776 A
2925 V
(14783)210 1122 A
1524(})S
(while)210 1608 A
(\(count)252 1860 A
2154(<)S
(tp->tty_incount\);)714 2238 A
3015 V
(14784)210 1122 A
1440(})S
3195 V
(14786)210 1122 A
(/*===========================================================================*)3276 1440 A
3285 V
(14787)210 1122 A
1482(*)S
(out_process)462 2784 A
4674(*)S
3375 V
(14788)210 1122 A
(*===========================================================================*/)3276 1482 A
3465 V
(14789)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(out_process\(tp,)630 1944 A
(bstart,)294 2616 A
(bpos,)210 2952 A
(bend,)210 3204 A
(icount,)294 3456 A
(ocount\))294 3792 A
3555 V
(14790)210 1122 A
(tty_t)210 1440 A
(*tp;)168 1692 A
3645 V
(14791)210 1122 A
(char)168 1440 A
(*bstart,)336 1650 A
(*bpos,)252 2028 A
(*bend;)252 2322 A
2784(/*)S
(start/pos/end)546 2910 A
3498(of)S
(circular)336 3624 A
(buffer)252 4002 A
4296(*/)S
3735 V
(14792)210 1122 A
(int)126 1440 A
(*icount;)336 1608 A
2784(/*)S
2910(#)S
(input)210 2994 A
(chars)210 3246 A
3498(/)S
(input)210 3582 A
(chars)210 3834 A
(used)168 4086 A
4296(*/)S
3825 V
(14793)210 1122 A
(int)126 1440 A
(*ocount;)336 1608 A
2784(/*)S
(max)126 2910 A
(output)252 3078 A
(chars)210 3372 A
3624(/)S
(output)252 3708 A
(chars)210 4002 A
(used)168 4254 A
4464(*/)S
3915 V
(14794)210 1122 A
1440({)S
4005 V
(14795)210 1122 A
1440(/*)S
(Perform)294 1566 A
(output)252 1902 A
(processing)420 2196 A
2658(on)S
2784(a)S
(circular)336 2868 A
(buffer.)294 3246 A
(*icount)294 3624 A
3960(is)S
(the)126 4086 A
(number)252 4254 A
4548(of)S
4095 V
(14796)210 1122 A
1482(*)S
(bytes)210 1566 A
1818(to)S
(process,)336 1944 A
(and)126 2322 A
(the)126 2490 A
(number)252 2658 A
2952(of)S
(bytes)210 3078 A
(actually)336 3330 A
(processed)378 3708 A
4128(on)S
(return.)294 4254 A
4185 V
(14797)210 1122 A
1482(*)S
(*ocount)294 1566 A
1902(is)S
(the)126 2028 A
(space)210 2196 A
(available)378 2448 A
2868(on)S
(input)210 2994 A
(and)126 3246 A
(the)126 3414 A
(space)210 3582 A
(used)168 3834 A
4044(on)S
(output.)294 4170 A
4275 V
(14798)210 1122 A
1482(*)S
(\(Naturally)420 1566 A
(*icount)294 2028 A
2364(<)S
(*ocount.\))378 2448 A
(The)126 2910 A
(column)252 3078 A
(position)336 3372 A
3750(is)S
(updated)294 3876 A
(modulo)252 4212 A
4365 V
(14799)210 1122 A
1482(*)S
(the)126 1566 A
(TAB)126 1734 A
(size,)210 1902 A
(because)294 2154 A
2490(we)S
(really)252 2616 A
(only)168 2910 A
(need)168 3120 A
3330(it)S
(for)126 3456 A
(tabs.)210 3624 A
4455 V
(14800)210 1122 A
1482(*/)S
4545 V
(14801)210 1122 A
4635 V
(14802)210 1122 A
(int)126 1524 A
(tablen;)294 1692 A
4725 V
(14803)210 1122 A
(int)126 1524 A
(ict)126 1692 A
1860(=)S
(*icount;)336 1944 A
4815 V
(14804)210 1122 A
(int)126 1524 A
(oct)126 1692 A
1860(=)S
(*ocount;)336 1944 A
4905 V
(14805)210 1122 A
(int)126 1524 A
(pos)126 1692 A
1860(=)S
(tp->tty_position;)714 1944 A
4995 V
(14806)210 1122 A
5085 V
(14807)210 1122 A
(while)210 1524 A
(\(ict)168 1776 A
1986(>)S
2070(0\))S
2196({)S
5175 V
(14808)210 1122 A
(switch)252 1776 A
(\(*bpos\))294 2070 A
2406({)S
5265 V
(14809)210 1122 A
(case)168 1776 A
('\\7':)210 1986 A
5355 V
(14810)210 1122 A
(break;)252 2112 A
5445 V
(14811)210 1122 A
(case)168 1776 A
('\\b':)210 1986 A
5535 V
(14812)210 1122 A
(pos--;)252 2112 A
5625 V
(14813)210 1122 A
(break;)252 2112 A
5715 V
(14814)210 1122 A
(case)168 1776 A
('\\r':)210 1986 A
5805 V
(14815)210 1122 A
(pos)126 2112 A
2280(=)S
2364(0;)S
5895 V
(14816)210 1122 A
(break;)252 2112 A
5985 V
(14817)210 1122 A
(case)168 1776 A
('\\n':)210 1986 A
6075 V
(14818)210 1122 A
2112(if)S
(\(\(tp->tty_termios.c_oflag)1050 2238 A
3330(&)S
(\(OPOST|ONLCR\)\))588 3414 A
6165 V
(14819)210 1122 A
3792(==)S
(\(OPOST|ONLCR\)\))588 3918 A
4548({)S
6255 V
(14820)210 1122 A
2448(/*)S
(Map)126 2574 A
2742(LF)S
2868(to)S
(CR+LF)210 2994 A
3246(if)S
(there)210 3372 A
3624(is)S
(space.)252 3750 A
(Note)168 4086 A
(that)168 4296 A
(the)126 4506 A
6345 V
(14821)210 1122 A
2490(*)S
(next)168 2574 A
(character)378 2784 A
3204(in)S
(the)126 3330 A
(buffer)252 3498 A
3792(is)S
(overwritten,)504 3918 A
4464(so)S
6435 V
(14822)210 1122 A
2490(*)S
2574(we)S
(stop)168 2700 A
2910(at)S
(this)168 3036 A
(point.)252 3246 A
6525 V
(14823)210 1122 A
2490(*/)S
6615 V
(14824)210 1122 A
2448(if)S
(\(oct)168 2574 A
2784(>=)S
2910(2\))S
3036({)S
6705 V
(14825)210 1122 A
(*bpos)210 2784 A
3036(=)S
('\\r';)210 3120 A
6795 V
(14826)210 1122 A
2784(if)S
(\(++bpos)294 2910 A
3246(==)S
(bend\))210 3372 A
(bpos)168 3624 A
3834(=)S
(bstart;)294 3918 A
6885 V
(14827)210 1122 A
(*bpos)210 2784 A
3036(=)S
('\\n';)210 3120 A
6975 V
(14828)210 1122 A
(pos)126 2784 A
2952(=)S
3036(0;)S
7065 V
(14829)210 1122 A
(ict--;)252 2784 A
8418 V
EP
%%Page: 194 194
BP
/slant 0 def
/height 0 def
1485 V
12 B
(194)180 1080 A
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(14830)210 1122 A
(oct)126 2784 A
2952(-=)S
3078(2;)S
1845 V
(14831)210 1122 A
2448(})S
1935 V
(14832)210 1122 A
(goto)168 2448 A
(out_done;)378 2658 A
3120(/*)S
3246(no)S
(space)210 3372 A
3624(or)S
(buffer)252 3750 A
(got)126 4044 A
(changed)294 4212 A
4548(*/)S
2025 V
(14833)210 1122 A
2112(})S
2115 V
(14834)210 1122 A
(break;)252 2112 A
2205 V
(14835)210 1122 A
(case)168 1776 A
('\\t':)210 1986 A
2295 V
(14836)210 1122 A
2112(/*)S
(Best)168 2238 A
(guess)210 2448 A
(for)126 2700 A
(the)126 2868 A
(tab)126 3036 A
(length.)294 3204 A
3540(*/)S
2385 V
(14837)210 1122 A
(tablen)252 2112 A
2406(=)S
(TAB_SIZE)336 2490 A
2868(-)S
(\(pos)168 2952 A
3162(&)S
(TAB_MASK\);)420 3246 A
2475 V
(14838)210 1122 A
2565 V
(14839)210 1122 A
2112(if)S
(\(\(tp->tty_termios.c_oflag)1050 2238 A
3330(&)S
(\(OPOST|XTABS\)\))588 3414 A
2655 V
(14840)210 1122 A
3792(==)S
(\(OPOST|XTABS\)\))588 3918 A
4548({)S
2745 V
(14841)210 1122 A
2448(/*)S
(Tabs)168 2574 A
(must)168 2784 A
2994(be)S
(expanded.)378 3120 A
3540(*/)S
2835 V
(14842)210 1122 A
2448(if)S
(\(oct)168 2574 A
2784(>=)S
(tablen\))294 2910 A
3246({)S
2925 V
(14843)210 1122 A
(pos)126 2784 A
2952(+=)S
(tablen;)294 3078 A
3015 V
(14844)210 1122 A
(ict--;)252 2784 A
3105 V
(14845)210 1122 A
(oct)126 2784 A
2952(-=)S
(tablen;)294 3078 A
3195 V
(14846)210 1122 A
2784(do)S
2910({)S
3285 V
(14847)210 1122 A
(*bpos)210 3120 A
3372(=)S
3456(')S
3540(';)S
3375 V
(14848)210 1122 A
3120(if)S
(\(++bpos)294 3246 A
3582(==)S
(bend\))210 3708 A
(bpos)168 3960 A
4170(=)S
(bstart;)294 4254 A
3465 V
(14849)210 1122 A
2784(})S
(while)210 2868 A
(\(--tablen)378 3120 A
3540(!=)S
(0\);)126 3666 A
3555 V
(14850)210 1122 A
2448(})S
3645 V
(14851)210 1122 A
(goto)168 2448 A
(out_done;)378 2658 A
3735 V
(14852)210 1122 A
2112(})S
3825 V
(14853)210 1122 A
2112(/*)S
(Tabs)168 2238 A
(are)126 2448 A
(output)252 2616 A
(directly.)378 2910 A
3330(*/)S
3915 V
(14854)210 1122 A
(pos)126 2112 A
2280(+=)S
(tablen;)294 2406 A
4005 V
(14855)210 1122 A
(break;)252 2112 A
4095 V
(14856)210 1122 A
(default:)336 1776 A
4185 V
(14857)210 1122 A
2112(/*)S
(Assume)252 2238 A
(any)126 2532 A
(other)210 2700 A
(character)378 2952 A
(prints)252 3372 A
3666(as)S
(one)126 3792 A
(character.)420 3960 A
4422(*/)S
4275 V
(14858)210 1122 A
(pos++;)252 2112 A
4365 V
(14859)210 1122 A
1776(})S
4455 V
(14860)210 1122 A
1776(if)S
(\(++bpos)294 1902 A
2238(==)S
(bend\))210 2364 A
(bpos)168 2616 A
2826(=)S
(bstart;)294 2910 A
4545 V
(14861)210 1122 A
(ict--;)252 1776 A
4635 V
(14862)210 1122 A
(oct--;)252 1776 A
4725 V
(14863)210 1122 A
1524(})S
4815 V
(14864)210 1122 A
(out_done:)378 1440 A
4905 V
(14865)210 1122 A
(tp->tty_position)672 1524 A
2238(=)S
(pos)126 2322 A
2490(&)S
(TAB_MASK;)378 2574 A
4995 V
(14866)210 1122 A
5085 V
(14867)210 1122 A
(*icount)294 1524 A
1860(-=)S
(ict;)168 1986 A
2448(/*)S
([io]ct)252 2574 A
(are)126 2868 A
(the)126 3036 A
(number)252 3204 A
3498(of)S
(chars)210 3624 A
(not)126 3876 A
(used)168 4044 A
4254(*/)S
5175 V
(14868)210 1122 A
(*ocount)294 1524 A
1860(-=)S
(oct;)168 1986 A
2448(/*)S
(*[io]count)420 2574 A
(are)126 3036 A
(the)126 3204 A
(number)252 3372 A
3666(of)S
(chars)210 3792 A
(that)168 4044 A
(are)126 4254 A
(used)168 4422 A
4632(*/)S
5265 V
(14869)210 1122 A
1440(})S
5445 V
(14871)210 1122 A
(/*===========================================================================*)3276 1440 A
5535 V
(14872)210 1122 A
1482(*)S
(dev_ioctl)378 2784 A
4674(*)S
5625 V
(14873)210 1122 A
(*===========================================================================*/)3276 1482 A
5715 V
(14874)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(dev_ioctl\(tp\))546 1986 A
5805 V
(14875)210 1122 A
(tty_t)210 1440 A
(*tp;)168 1692 A
5895 V
(14876)210 1122 A
1440({)S
5985 V
(14877)210 1122 A
1440(/*)S
(The)126 1566 A
(ioctl's)294 1734 A
(TCSETSW,)336 2070 A
(TCSETSF)294 2448 A
(and)126 2784 A
(TCDRAIN)294 2952 A
(wait)168 3288 A
(for)126 3498 A
(output)252 3666 A
3960(to)S
(finish)252 4086 A
4380(to)S
(make)168 4506 A
6075 V
(14878)210 1122 A
1482(*)S
(sure)168 1566 A
(that)168 1776 A
1986(an)S
(attribute)378 2112 A
(change)252 2532 A
(doesn't)294 2826 A
(affect)252 3162 A
(the)126 3456 A
(processing)420 3624 A
4086(of)S
(current)294 4212 A
6165 V
(14879)210 1122 A
1482(*)S
(output.)294 1566 A
(Once)168 1944 A
(output)252 2154 A
(finishes)336 2448 A
(the)126 2826 A
(ioctl)210 2994 A
3246(is)S
(executed)336 3372 A
3750(as)S
3876(in)S
(do_ioctl\(\).)462 4002 A
6255 V
(14880)210 1122 A
1482(*/)S
6345 V
(14881)210 1122 A
(int)126 1524 A
(result;)294 1692 A
6435 V
(14882)210 1122 A
6525 V
(14883)210 1122 A
1524(if)S
(\(tp->tty_outleft)672 1650 A
2364(>)S
2448(0\))S
(return;)294 2574 A
3456(/*)S
(output)252 3582 A
(not)126 3876 A
(finished)336 4044 A
4422(*/)S
6615 V
(14884)210 1122 A
6705 V
(14885)210 1122 A
1524(if)S
(\(tp->tty_ioreq)588 1650 A
2280(!=)S
(TCDRAIN\))336 2406 A
2784({)S
6795 V
(14886)210 1122 A
1776(if)S
(\(tp->tty_ioreq)588 1902 A
2532(==)S
(TCSETSF\))336 2658 A
(tty_icancel\(tp\);)672 3036 A
6885 V
(14887)210 1122 A
(result)252 1776 A
2070(=)S
(sys_vircopy\(tp->tty_ioproc,)1134 2154 A
3330(D,)S
(tp->tty_iovir,)588 3456 A
6975 V
(14888)210 1122 A
(SELF,)210 2448 A
2700(D,)S
(\(vir_bytes\))462 2826 A
(&tp->tty_termios,)714 3330 A
7065 V
(14889)210 1122 A
(\(vir_bytes\))462 2448 A
(sizeof\(tp->tty_termios\)\);)1050 2952 A
8418 V
EP
%%Page: 195 195
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
12 B
(195)180 4500 A
1755 V
7 LST
(14890)210 1122 A
(setattr\(tp\);)504 1776 A
1845 V
(14891)210 1122 A
1524(})S
1935 V
(14892)210 1122 A
(tp->tty_ioreq)546 1524 A
2112(=)S
2196(0;)S
2025 V
(14893)210 1122 A
(tty_reply\(REVIVE,)714 1524 A
(tp->tty_iocaller,)714 2280 A
(tp->tty_ioproc,)630 3036 A
(result\);)336 3708 A
2115 V
(14894)210 1122 A
1440(})S
2295 V
(14896)210 1122 A
(/*===========================================================================*)3276 1440 A
2385 V
(14897)210 1122 A
1482(*)S
(setattr)294 2784 A
4674(*)S
2475 V
(14898)210 1122 A
(*===========================================================================*/)3276 1482 A
2565 V
(14899)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(setattr\(tp\))462 1986 A
2655 V
(14900)210 1122 A
(tty_t)210 1440 A
(*tp;)168 1692 A
2745 V
(14901)210 1122 A
1440({)S
2835 V
(14902)210 1122 A
1440(/*)S
(Apply)210 1566 A
(the)126 1818 A
(new)126 1986 A
(line)168 2154 A
(attributes)420 2364 A
(\(raw/canonical,)630 2826 A
(line)168 3498 A
(speed,)252 3708 A
(etc.\))210 4002 A
4254(*/)S
2925 V
(14903)210 1122 A
(u16_t)210 1524 A
(*inp;)210 1776 A
3015 V
(14904)210 1122 A
(int)126 1524 A
(count;)252 1692 A
3105 V
(14905)210 1122 A
3195 V
(14906)210 1122 A
1524(if)S
(\(!\(tp->tty_termios.c_lflag)1092 1650 A
2784(&)S
(ICANON\)\))336 2868 A
3246({)S
3285 V
(14907)210 1122 A
1776(/*)S
(Raw)126 1902 A
(mode;)210 2070 A
(put)126 2322 A
2490(a)S
("line)210 2574 A
(break")252 2826 A
3120(on)S
(all)126 3246 A
(characters)420 3414 A
3876(in)S
(the)126 4002 A
(input)210 4170 A
(queue.)252 4422 A
3375 V
(14908)210 1122 A
1818(*)S
1902(It)S
2028(is)S
(undefined)378 2154 A
(what)168 2574 A
(happens)294 2784 A
3120(to)S
(the)126 3246 A
(input)210 3414 A
(queue)210 3666 A
(when)168 3918 A
(ICANON)252 4128 A
4422(is)S
3465 V
(14909)210 1122 A
1818(*)S
(switched)336 1902 A
(off,)168 2280 A
2490(a)S
(process)294 2574 A
(should)252 2910 A
(use)126 3204 A
(TCSAFLUSH)378 3372 A
3792(to)S
(flush)210 3918 A
(the)126 4170 A
(queue.)252 4338 A
3555 V
(14910)210 1122 A
1818(*)S
(Keeping)294 1902 A
(the)126 2238 A
(queue)210 2406 A
2658(to)S
(preserve)336 2784 A
(typeahead)378 3162 A
3582(is)S
(the)126 3708 A
(Right)210 3876 A
(Thing,)252 4128 A
(however)294 4422 A
3645 V
(14911)210 1122 A
1818(*)S
(when)168 1902 A
2112(a)S
(process)294 2196 A
(does)168 2532 A
(use)126 2742 A
(TCSANOW)294 2910 A
3246(to)S
(switch)252 3372 A
3666(to)S
(raw)126 3792 A
(mode.)210 3960 A
3735 V
(14912)210 1122 A
1818(*/)S
3825 V
(14913)210 1122 A
(count)210 1776 A
2028(=)S
(tp->tty_eotct)546 2112 A
2700(=)S
(tp->tty_incount;)672 2784 A
3915 V
(14914)210 1122 A
(inp)126 1776 A
1944(=)S
(tp->tty_intail;)630 2028 A
4005 V
(14915)210 1122 A
(while)210 1776 A
(\(count)252 2028 A
2322(>)S
2406(0\))S
2532({)S
4095 V
(14916)210 1122 A
(*inp)168 2112 A
2322(|=)S
(IN_EOT;)294 2448 A
4185 V
(14917)210 1122 A
2112(if)S
(\(++inp)252 2238 A
2532(==)S
(bufend\(tp->tty_inbuf\)\))924 2658 A
(inp)126 3624 A
3792(=)S
(tp->tty_inbuf;)588 3876 A
4275 V
(14918)210 1122 A
(--count;)336 2112 A
4365 V
(14919)210 1122 A
1776(})S
4455 V
(14920)210 1122 A
1524(})S
4545 V
(14921)210 1122 A
4635 V
(14922)210 1122 A
1524(/*)S
(Inspect)294 1650 A
(MIN)126 1986 A
(and)126 2154 A
(TIME.)210 2322 A
2574(*/)S
4725 V
(14923)210 1122 A
(settimer\(tp,)504 1524 A
(FALSE\);)294 2070 A
4815 V
(14924)210 1122 A
1524(if)S
(\(tp->tty_termios.c_lflag)1008 1650 A
2700(&)S
(ICANON\))294 2784 A
3120({)S
4905 V
(14925)210 1122 A
1776(/*)S
1902(No)S
(MIN)126 2028 A
2196(&)S
(TIME)168 2280 A
2490(in)S
(canonical)378 2616 A
(mode.)210 3036 A
3288(*/)S
4995 V
(14926)210 1122 A
(tp->tty_min)462 1776 A
2280(=)S
2364(1;)S
5085 V
(14927)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
5175 V
(14928)210 1122 A
1776(/*)S
1902(In)S
(raw)126 2028 A
(mode)168 2196 A
(MIN)126 2406 A
2574(is)S
(the)126 2700 A
(number)252 2868 A
3162(of)S
(chars)210 3288 A
(wanted,)294 3540 A
(and)126 3876 A
(TIME)168 4044 A
(how)126 4254 A
(long)168 4422 A
5265 V
(14929)210 1122 A
1818(*)S
1902(to)S
(wait)168 2028 A
(for)126 2238 A
(them.)210 2406 A
(With)168 2700 A
(interesting)462 2910 A
(exceptions)420 3414 A
3876(if)S
(either)252 4002 A
4296(is)S
(zero.)210 4422 A
5355 V
(14930)210 1122 A
1818(*/)S
5445 V
(14931)210 1122 A
(tp->tty_min)462 1776 A
2280(=)S
(tp->tty_termios.c_cc[VMIN];)1134 2364 A
5535 V
(14932)210 1122 A
1776(if)S
(\(tp->tty_min)504 1902 A
2448(==)S
2574(0)S
2658(&&)S
(tp->tty_termios.c_cc[VTIME])1134 2784 A
3960(>)S
4044(0\))S
5625 V
(14933)210 1122 A
(tp->tty_min)462 2112 A
2616(=)S
2700(1;)S
5715 V
(14934)210 1122 A
1524(})S
5805 V
(14935)210 1122 A
5895 V
(14936)210 1122 A
1524(if)S
(\(!\(tp->tty_termios.c_iflag)1092 1650 A
2784(&)S
(IXON\)\))252 2868 A
3162({)S
5985 V
(14937)210 1122 A
1776(/*)S
1902(No)S
(start/stop)420 2028 A
(output)252 2490 A
(control,)336 2784 A
3162(so)S
(don't)210 3288 A
(leave)210 3540 A
(output)252 3792 A
(inhibited.)420 4086 A
4548(*/)S
6075 V
(14938)210 1122 A
(tp->tty_inhibited)714 1776 A
2532(=)S
(RUNNING;)336 2616 A
6165 V
(14939)210 1122 A
(tp->tty_events)588 1776 A
2406(=)S
2490(1;)S
6255 V
(14940)210 1122 A
1524(})S
6345 V
(14941)210 1122 A
6435 V
(14942)210 1122 A
1524(/*)S
(Setting)294 1650 A
(the)126 1986 A
(output)252 2154 A
(speed)210 2448 A
2700(to)S
(zero)168 2826 A
(hangs)210 3036 A
3288(up)S
(the)126 3414 A
(phone.)252 3582 A
3876(*/)S
6525 V
(14943)210 1122 A
1524(if)S
(\(tp->tty_termios.c_ospeed)1050 1650 A
2742(==)S
(B0\))126 2868 A
(sigchar\(tp,)462 3036 A
(SIGHUP\);)336 3540 A
6615 V
(14944)210 1122 A
6705 V
(14945)210 1122 A
1524(/*)S
(Set)126 1650 A
(new)126 1818 A
(line)168 1986 A
(speed,)252 2196 A
(character)378 2490 A
(size,)210 2910 A
(etc)126 3162 A
3330(at)S
(the)126 3456 A
(device)252 3624 A
(level.)252 3918 A
4212(*/)S
6795 V
(14946)210 1122 A
(\(*tp->tty_ioctl\)\(tp,)840 1524 A
(0\);)126 2406 A
6885 V
(14947)210 1122 A
1440(})S
8418 V
EP
%%Page: 196 196
BP
/slant 0 def
/height 0 def
1485 V
12 B
(196)180 1080 A
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(14949)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(14950)210 1122 A
1482(*)S
(tty_reply)378 2784 A
4674(*)S
1935 V
(14951)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(14952)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(tty_reply\(code,)630 1944 A
(replyee,)336 2616 A
(proc_nr,)336 2994 A
(status\))294 3372 A
2115 V
(14953)210 1122 A
(int)126 1440 A
(code;)210 1608 A
2784(/*)S
(TASK_REPLY)420 2910 A
3372(or)S
(REVIVE)252 3498 A
3792(*/)S
2205 V
(14954)210 1122 A
(int)126 1440 A
(replyee;)336 1608 A
2784(/*)S
(destination)462 2910 A
(address)294 3414 A
(for)126 3750 A
(the)126 3918 A
(reply)210 4086 A
4338(*/)S
2295 V
(14955)210 1122 A
(int)126 1440 A
(proc_nr;)336 1608 A
2784(/*)S
2910(to)S
(whom)168 3036 A
(should)252 3246 A
(the)126 3540 A
(reply)210 3708 A
(go?)126 3960 A
4128(*/)S
2385 V
(14956)210 1122 A
(int)126 1440 A
(status;)294 1608 A
2784(/*)S
(reply)210 2910 A
(code)168 3162 A
3372(*/)S
2475 V
(14957)210 1122 A
1440({)S
2565 V
(14958)210 1122 A
1440(/*)S
(Send)168 1566 A
1776(a)S
(reply)210 1860 A
2112(to)S
2238(a)S
(process)294 2322 A
(that)168 2658 A
(wanted)252 2868 A
3162(to)S
(read)168 3288 A
3498(or)S
(write)210 3624 A
(data.)210 3876 A
4128(*/)S
2655 V
(14959)210 1122 A
(message)294 1524 A
(tty_mess;)378 1860 A
2745 V
(14960)210 1122 A
2835 V
(14961)210 1122 A
(tty_mess.m_type)630 1524 A
2196(=)S
(code;)210 2280 A
2925 V
(14962)210 1122 A
(tty_mess.REP_PROC_NR)840 1524 A
2406(=)S
(proc_nr;)336 2490 A
3015 V
(14963)210 1122 A
(tty_mess.REP_STATUS)798 1524 A
2364(=)S
(status;)294 2448 A
3105 V
(14964)210 1122 A
3195 V
(14965)210 1122 A
1524(if)S
(\(\(status)336 1650 A
2028(=)S
(send\(replyee,)546 2112 A
(&tty_mess\)\))462 2700 A
3204(!=)S
(OK\))126 3330 A
3498({)S
3285 V
(14966)210 1122 A
(panic\("TTY","tty_reply)924 1776 A
(failed,)294 2742 A
(status\\n",)420 3078 A
(status\);)336 3540 A
3375 V
(14967)210 1122 A
1524(})S
3465 V
(14968)210 1122 A
1440(})S
3645 V
(14970)210 1122 A
(/*===========================================================================*)3276 1440 A
3735 V
(14971)210 1122 A
1482(*)S
(sigchar)294 2784 A
4674(*)S
3825 V
(14972)210 1122 A
(*===========================================================================*/)3276 1482 A
3915 V
(14973)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(sigchar\(tp,)462 1944 A
(sig\))168 2448 A
4005 V
(14974)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
4095 V
(14975)210 1122 A
(int)126 1440 A
(sig;)168 1608 A
2784(/*)S
(SIGINT,)294 2910 A
(SIGQUIT,)336 3246 A
(SIGKILL)294 3624 A
3960(or)S
(SIGHUP)252 4086 A
4380(*/)S
4185 V
(14976)210 1122 A
1440({)S
4275 V
(14977)210 1122 A
1440(/*)S
(Process)294 1566 A
1902(a)S
(SIGINT,)294 1986 A
(SIGQUIT)294 2322 A
2658(or)S
(SIGKILL)294 2784 A
(char)168 3120 A
(from)168 3330 A
(the)126 3540 A
(keyboard)336 3708 A
4086(or)S
(SIGHUP)252 4212 A
(from)168 4506 A
4365 V
(14978)210 1122 A
1482(*)S
1566(a)S
(tty)126 1650 A
(close,)252 1818 A
("stty)210 2112 A
(0",)126 2364 A
2532(or)S
2658(a)S
(real)168 2742 A
(RS-232)252 2952 A
(hangup.)294 3246 A
3624(MM)S
(will)168 3750 A
(send)168 3960 A
(the)126 4170 A
(signal)252 4338 A
4632(to)S
4455 V
(14979)210 1122 A
1482(*)S
(the)126 1566 A
(process)294 1734 A
(group)210 2070 A
(\(INT,)210 2322 A
(QUIT\),)252 2574 A
(all)126 2868 A
(processes)378 3036 A
(\(KILL\),)294 3456 A
3792(or)S
(the)126 3918 A
(session)294 4086 A
(leader)252 4422 A
4545 V
(14980)210 1122 A
1482(*)S
(\(HUP\).)252 1566 A
4635 V
(14981)210 1122 A
1482(*/)S
4725 V
(14982)210 1122 A
(int)126 1524 A
(status;)294 1692 A
4815 V
(14983)210 1122 A
4905 V
(14984)210 1122 A
1524(if)S
(\(tp->tty_pgrp)546 1650 A
2238(!=)S
2364(0\))S
4995 V
(14985)210 1122 A
1692(if)S
(\(OK)126 1818 A
1986(!=)S
(\(status)294 2112 A
2448(=)S
(sys_kill\(tp->tty_pgrp,)924 2532 A
(sig\)\)\))252 3498 A
5085 V
(14986)210 1122 A
(panic\("TTY","Error,)798 1776 A
(call)168 2616 A
2826(to)S
(sys_kill)336 2952 A
(failed",)336 3330 A
(status\);)336 3708 A
5175 V
(14987)210 1122 A
5265 V
(14988)210 1122 A
1524(if)S
(\(!\(tp->tty_termios.c_lflag)1092 1650 A
2784(&)S
(NOFLSH\)\))336 2868 A
3246({)S
5355 V
(14989)210 1122 A
(tp->tty_incount)630 1776 A
2448(=)S
(tp->tty_eotct)546 2532 A
3120(=)S
3204(0;)S
3456(/*)S
(kill)168 3582 A
(earlier)294 3792 A
(input)210 4128 A
4380(*/)S
5445 V
(14990)210 1122 A
(tp->tty_intail)588 1776 A
2406(=)S
(tp->tty_inhead;)630 2490 A
5535 V
(14991)210 1122 A
(\(*tp->tty_ocancel\)\(tp,)924 1776 A
(0\);)126 2742 A
3792(/*)S
(kill)168 3918 A
(all)126 4128 A
(output)252 4296 A
4590(*/)S
5625 V
(14992)210 1122 A
(tp->tty_inhibited)714 1776 A
2532(=)S
(RUNNING;)336 2616 A
5715 V
(14993)210 1122 A
(tp->tty_events)588 1776 A
2406(=)S
2490(1;)S
5805 V
(14994)210 1122 A
1524(})S
5895 V
(14995)210 1122 A
1440(})S
6075 V
(14997)210 1122 A
(/*===========================================================================*)3276 1440 A
6165 V
(14998)210 1122 A
1482(*)S
(tty_icancel)462 2784 A
4674(*)S
6255 V
(14999)210 1122 A
(*===========================================================================*/)3276 1482 A
6345 V
(15000)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(tty_icancel\(tp\))630 1986 A
6435 V
(15001)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
6525 V
(15002)210 1122 A
1440({)S
6615 V
(15003)210 1122 A
1440(/*)S
(Discard)294 1566 A
(all)126 1902 A
(pending)294 2070 A
(input,)252 2406 A
(tty)126 2700 A
(buffer)252 2868 A
3162(or)S
(device.)294 3288 A
3624(*/)S
6705 V
(15004)210 1122 A
6795 V
(15005)210 1122 A
(tp->tty_incount)630 1524 A
2196(=)S
(tp->tty_eotct)546 2280 A
2868(=)S
2952(0;)S
6885 V
(15006)210 1122 A
(tp->tty_intail)588 1524 A
2154(=)S
(tp->tty_inhead;)630 2238 A
6975 V
(15007)210 1122 A
(\(*tp->tty_icancel\)\(tp,)924 1524 A
(0\);)126 2490 A
7065 V
(15008)210 1122 A
1440(})S
8418 V
EP
%%Page: 197 197
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
12 B
(197)180 4500 A
1845 V
7 LST
(15010)210 1122 A
(/*===========================================================================*)3276 1440 A
1935 V
(15011)210 1122 A
1482(*)S
(tty_init)336 2784 A
4674(*)S
2025 V
(15012)210 1122 A
(*===========================================================================*/)3276 1482 A
2115 V
(15013)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(tty_init\(\))420 1986 A
2205 V
(15014)210 1122 A
1440({)S
2295 V
(15015)210 1122 A
1440(/*)S
(Initialize)420 1566 A
(tty)126 2028 A
(structure)378 2196 A
(and)126 2616 A
(call)168 2784 A
(device)252 2994 A
(initialization)588 3288 A
(routines.)378 3918 A
4338(*/)S
2385 V
(15016)210 1122 A
2475 V
(15017)210 1122 A
(register)336 1524 A
(tty_t)210 1902 A
(*tp;)168 2154 A
2565 V
(15018)210 1122 A
(int)126 1524 A
1692(s;)S
2655 V
(15019)210 1122 A
(struct)252 1524 A
(sigaction)378 1818 A
(sigact;)294 2238 A
2745 V
(15020)210 1122 A
2835 V
(15021)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(the)126 2112 A
(terminal)336 2280 A
(lines.)252 2658 A
2952(*/)S
2925 V
(15022)210 1122 A
(for)126 1524 A
(\(tp)126 1692 A
1860(=)S
(FIRST_TTY,s=0;)588 1944 A
2574(tp)S
2700(<)S
(END_TTY;)336 2784 A
(tp++,s++\))378 3162 A
3582({)S
3015 V
(15023)210 1122 A
3105 V
(15024)210 1122 A
(tp->tty_index)546 1776 A
2364(=)S
2448(s;)S
3195 V
(15025)210 1122 A
3285 V
(15026)210 1122 A
(tmr_inittimer\(&tp->tty_tmr\);)1176 1776 A
3375 V
(15027)210 1122 A
3465 V
(15028)210 1122 A
(tp->tty_intail)588 1776 A
2406(=)S
(tp->tty_inhead)588 2490 A
3120(=)S
(tp->tty_inbuf;)588 3204 A
3555 V
(15029)210 1122 A
(tp->tty_min)462 1776 A
2280(=)S
2364(1;)S
3645 V
(15030)210 1122 A
(tp->tty_termios)630 1776 A
2448(=)S
(termios_defaults;)714 2532 A
3735 V
(15031)210 1122 A
(tp->tty_icancel)630 1776 A
2448(=)S
(tp->tty_ocancel)630 2532 A
3204(=)S
(tp->tty_ioctl)546 3288 A
3876(=)S
(tp->tty_close)546 3960 A
4548(=)S
3825 V
(15032)210 1122 A
(tty_devnop;)462 4128 A
3915 V
(15033)210 1122 A
1776(if)S
(\(tp)126 1902 A
2070(<)S
(tty_addr\(NR_CONS\)\))756 2154 A
2952({)S
4005 V
(15034)210 1122 A
(scr_init\(tp\);)546 2112 A
4095 V
(15035)210 1122 A
(tp->tty_minor)546 2112 A
2700(=)S
(CONS_MINOR)420 2784 A
3246(+)S
3330(s;)S
4185 V
(15036)210 1122 A
1776(})S
(else)168 1860 A
4275 V
(15037)210 1122 A
1776(if)S
(\(tp)126 1902 A
2070(<)S
(tty_addr\(NR_CONS+NR_RS_LINES\)\))1260 2154 A
3456({)S
4365 V
(15038)210 1122 A
(rs_init\(tp\);)504 2112 A
4455 V
(15039)210 1122 A
(tp->tty_minor)546 2112 A
2700(=)S
(RS232_MINOR)462 2784 A
3288(+)S
(s-NR_CONS;)420 3372 A
4545 V
(15040)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
4635 V
(15041)210 1122 A
(pty_init\(tp\);)546 2112 A
4725 V
(15042)210 1122 A
(tp->tty_minor)546 2112 A
2700(=)S
2784(s)S
2868(-)S
(\(NR_CONS+NR_RS_LINES\))882 2952 A
3876(+)S
(TTYPX_MINOR;)504 3960 A
4815 V
(15043)210 1122 A
1776(})S
4905 V
(15044)210 1122 A
1524(})S
4995 V
(15045)210 1122 A
1440(})S
5175 V
(15047)210 1122 A
(/*===========================================================================*)3276 1440 A
5265 V
(15048)210 1122 A
1482(*)S
(tty_timed_out)546 2784 A
4674(*)S
5355 V
(15049)210 1122 A
(*===========================================================================*/)3276 1482 A
5445 V
(15050)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(tty_timed_out\(timer_t)882 1986 A
(*tp\))168 2910 A
5535 V
(15051)210 1122 A
1440({)S
5625 V
(15052)210 1122 A
1440(/*)S
(This)168 1566 A
(timer)210 1776 A
(has)126 2028 A
(expired.)336 2196 A
(Set)126 2574 A
(the)126 2742 A
(events)252 2910 A
(flag,)210 3204 A
3456(to)S
(force)210 3582 A
(processing.)462 3834 A
4338(*/)S
5715 V
(15053)210 1122 A
(tty_t)210 1524 A
(*tty_ptr;)378 1776 A
5805 V
(15054)210 1122 A
(tty_ptr)294 1524 A
1860(=)S
(&tty_table[tmr_arg\(tp\)->ta_int];)1344 1944 A
5895 V
(15055)210 1122 A
(tty_ptr->tty_min)672 1524 A
2238(=)S
2322(0;)S
3120(/*)S
(force)210 3246 A
(read)168 3498 A
3708(to)S
(succeed)294 3834 A
4170(*/)S
5985 V
(15056)210 1122 A
(tty_ptr->tty_events)798 1524 A
2364(=)S
2448(1;)S
6075 V
(15057)210 1122 A
1440(})S
6255 V
(15059)210 1122 A
(/*===========================================================================*)3276 1440 A
6345 V
(15060)210 1122 A
1482(*)S
(expire_timers)546 2784 A
4674(*)S
6435 V
(15061)210 1122 A
(*===========================================================================*/)3276 1482 A
6525 V
(15062)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(expire_timers\(void\))798 1986 A
6615 V
(15063)210 1122 A
1440({)S
6705 V
(15064)210 1122 A
1440(/*)S
1566(A)S
(synchronous)462 1650 A
(alarm)210 2154 A
(message)294 2406 A
(was)126 2742 A
(received.)378 2910 A
(Check)210 3330 A
3582(if)S
(there)210 3708 A
(are)126 3960 A
(any)126 4128 A
(expired)294 4296 A
6795 V
(15065)210 1122 A
1482(*)S
(timers.)294 1566 A
(Possibly)336 1902 A
(set)126 2280 A
(the)126 2448 A
(event)210 2616 A
(flag)168 2868 A
(and)126 3078 A
(reschedule)420 3246 A
(another)294 3708 A
(alarm.)252 4044 A
6885 V
(15066)210 1122 A
1482(*/)S
6975 V
(15067)210 1122 A
(clock_t)294 1524 A
(now;)168 1860 A
3120(/*)S
(current)294 3246 A
(time)168 3582 A
3792(*/)S
7065 V
(15068)210 1122 A
(int)126 1524 A
1692(s;)S
8418 V
EP
%%Page: 198 198
BP
/slant 0 def
/height 0 def
1485 V
12 B
(198)180 1080 A
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(15069)210 1122 A
1845 V
(15070)210 1122 A
1524(/*)S
(Get)126 1650 A
(the)126 1818 A
(current)294 1986 A
(time)168 2322 A
2532(to)S
(compare)294 2658 A
(the)126 2994 A
(timers)252 3162 A
(against.)336 3456 A
3834(*/)S
1935 V
(15071)210 1122 A
1524(if)S
(\(\(s=getuptime\(&now\)\))840 1650 A
2532(!=)S
(OK\))126 2658 A
2025 V
(15072)210 1122 A
(panic\("TTY","Couldn't)882 1776 A
(get)126 2700 A
(uptime)252 2868 A
(from)168 3162 A
(clock.",)336 3372 A
(s\);)126 3750 A
2115 V
(15073)210 1122 A
2205 V
(15074)210 1122 A
1524(/*)S
(Scan)168 1650 A
(the)126 1860 A
(queue)210 2028 A
2280(of)S
(timers)252 2406 A
(for)126 2700 A
(expired)294 2868 A
(timers.)294 3204 A
(This)168 3540 A
(dispatch)336 3750 A
(the)126 4128 A
(watchdog)336 4296 A
2295 V
(15075)210 1122 A
1566(*)S
(functions)378 1650 A
2070(of)S
(expired)294 2196 A
(timers.)294 2532 A
(Possibly)336 2868 A
3246(a)S
(new)126 3330 A
(alarm)210 3498 A
(call)168 3750 A
(must)168 3960 A
4170(be)S
(scheduled.)420 4296 A
2385 V
(15076)210 1122 A
1566(*/)S
2475 V
(15077)210 1122 A
(tmrs_exptimers\(&tty_timers,)1134 1524 A
(now,)168 2700 A
(NULL\);)252 2910 A
2565 V
(15078)210 1122 A
1524(if)S
(\(tty_timers)462 1650 A
2154(==)S
(NULL\))210 2280 A
(tty_next_timeout)672 2532 A
3246(=)S
(TMR_NEVER;)420 3330 A
2655 V
(15079)210 1122 A
(else)168 1524 A
1734({)S
3540(/*)S
(set)126 3666 A
(new)126 3834 A
(sync)168 4002 A
(alarm)210 4212 A
4464(*/)S
2745 V
(15080)210 1122 A
(tty_next_timeout)672 1776 A
2490(=)S
(tty_timers->tmr_exp_time;)1050 2574 A
2835 V
(15081)210 1122 A
1776(if)S
(\(\(s=sys_setalarm\(tty_next_timeout,)1428 1902 A
(1\)\))126 3372 A
3540(!=)S
(OK\))126 3666 A
2925 V
(15082)210 1122 A
(panic\("TTY","Couldn't)882 2112 A
(set)126 3036 A
(synchronous)462 3204 A
(alarm.",)336 3708 A
(s\);)126 4086 A
3015 V
(15083)210 1122 A
1524(})S
3105 V
(15084)210 1122 A
1440(})S
3285 V
(15086)210 1122 A
(/*===========================================================================*)3276 1440 A
3375 V
(15087)210 1122 A
1482(*)S
(settimer)336 2784 A
4674(*)S
3465 V
(15088)210 1122 A
(*===========================================================================*/)3276 1482 A
3555 V
(15089)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(settimer\(tty_ptr,)714 1986 A
(enable\))294 2742 A
3645 V
(15090)210 1122 A
(tty_t)210 1440 A
(*tty_ptr;)378 1692 A
2784(/*)S
(line)168 2910 A
3120(to)S
(set)126 3246 A
3414(or)S
(unset)210 3540 A
3792(a)S
(timer)210 3876 A
4128(on)S
4254(*/)S
3735 V
(15091)210 1122 A
(int)126 1440 A
(enable;)294 1608 A
2784(/*)S
(set)126 2910 A
(timer)210 3078 A
3330(if)S
(true,)210 3456 A
(otherwise)378 3708 A
(unset)210 4128 A
4380(*/)S
3825 V
(15092)210 1122 A
1440({)S
3915 V
(15093)210 1122 A
(clock_t)294 1524 A
(now;)168 1860 A
3120(/*)S
(current)294 3246 A
(time)168 3582 A
3792(*/)S
4005 V
(15094)210 1122 A
(clock_t)294 1524 A
(exp_time;)378 1860 A
4095 V
(15095)210 1122 A
(int)126 1524 A
1692(s;)S
4185 V
(15096)210 1122 A
4275 V
(15097)210 1122 A
1524(/*)S
(Get)126 1650 A
(the)126 1818 A
(current)294 1986 A
(time)168 2322 A
2532(to)S
(calculate)378 2658 A
(the)126 3078 A
(timeout)294 3246 A
(time.)210 3582 A
3834(*/)S
4365 V
(15098)210 1122 A
1524(if)S
(\(\(s=getuptime\(&now\)\))840 1650 A
2532(!=)S
(OK\))126 2658 A
4455 V
(15099)210 1122 A
(panic\("TTY","Couldn't)882 1776 A
(get)126 2700 A
(uptime)252 2868 A
(from)168 3162 A
(clock.",)336 3372 A
(s\);)126 3750 A
4545 V
(15100)210 1122 A
1524(if)S
(\(enable\))336 1650 A
2028({)S
4635 V
(15101)210 1122 A
(exp_time)336 1776 A
2154(=)S
(now)126 2238 A
2406(+)S
(tty_ptr->tty_termios.c_cc[VTIME])1344 2490 A
3876(*)S
(\(HZ/10\);)336 3960 A
4725 V
(15102)210 1122 A
1776(/*)S
(Set)126 1902 A
2070(a)S
(new)126 2154 A
(timer)210 2322 A
(for)126 2574 A
(enabling)336 2742 A
(the)126 3120 A
(TTY)126 3288 A
(events)252 3456 A
(flags.)252 3750 A
4044(*/)S
4815 V
(15103)210 1122 A
(tmrs_settimer\(&tty_timers,)1092 1776 A
(&tty_ptr->tty_tmr,)756 2910 A
4905 V
(15104)210 1122 A
(exp_time,)378 2112 A
(tty_timed_out,)588 2532 A
(NULL\);)252 3162 A
4995 V
(15105)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
5085 V
(15106)210 1122 A
1776(/*)S
(Remove)252 1902 A
(the)126 2196 A
(timer)210 2364 A
(from)168 2616 A
(the)126 2826 A
(active)252 2994 A
(and)126 3288 A
(expired)294 3456 A
(lists.)252 3792 A
4086(*/)S
5175 V
(15107)210 1122 A
(tmrs_clrtimer\(&tty_timers,)1092 1776 A
(&tty_ptr->tty_tmr,)756 2910 A
(NULL\);)252 3708 A
5265 V
(15108)210 1122 A
1524(})S
5355 V
(15109)210 1122 A
5445 V
(15110)210 1122 A
1524(/*)S
(Now)126 1650 A
(check)210 1818 A
2070(if)S
2196(a)S
(new)126 2280 A
(alarm)210 2448 A
(must)168 2700 A
2910(be)S
(scheduled.)420 3036 A
(This)168 3498 A
(happens)294 3708 A
(when)168 4044 A
(the)126 4254 A
(front)210 4422 A
5535 V
(15111)210 1122 A
1566(*)S
1650(of)S
(the)126 1776 A
(timers)252 1944 A
(queue)210 2238 A
(was)126 2490 A
(disabled)336 2658 A
3036(or)S
(reinserted)420 3162 A
3624(at)S
(another)294 3750 A
(position,)378 4086 A
4506(or)S
5625 V
(15112)210 1122 A
1566(*)S
(when)168 1650 A
1860(a)S
(new)126 1944 A
(timer)210 2112 A
(was)126 2364 A
(added)210 2532 A
2784(to)S
(the)126 2910 A
(front.)252 3078 A
5715 V
(15113)210 1122 A
1566(*/)S
5805 V
(15114)210 1122 A
1524(if)S
(\(tty_timers)462 1650 A
2154(==)S
(NULL\))210 2280 A
(tty_next_timeout)672 2532 A
3246(=)S
(TMR_NEVER;)420 3330 A
5895 V
(15115)210 1122 A
(else)168 1524 A
1734(if)S
(\(tty_timers->tmr_exp_time)1050 1860 A
2952(!=)S
(tty_next_timeout\))714 3078 A
3834({)S
5985 V
(15116)210 1122 A
(tty_next_timeout)672 1776 A
2490(=)S
(tty_timers->tmr_exp_time;)1050 2574 A
6075 V
(15117)210 1122 A
1776(if)S
(\(\(s=sys_setalarm\(tty_next_timeout,)1428 1902 A
(1\)\))126 3372 A
3540(!=)S
(OK\))126 3666 A
6165 V
(15118)210 1122 A
(panic\("TTY","Couldn't)882 2112 A
(set)126 3036 A
(synchronous)462 3204 A
(alarm.",)336 3708 A
(s\);)126 4086 A
6255 V
(15119)210 1122 A
1524(})S
6345 V
(15120)210 1122 A
1440(})S
6525 V
(15122)210 1122 A
(/*===========================================================================*)3276 1440 A
6615 V
(15123)210 1122 A
1482(*)S
(tty_devnop)420 2784 A
4674(*)S
6705 V
(15124)210 1122 A
(*===========================================================================*/)3276 1482 A
6795 V
(15125)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(tty_devnop\(tp,)588 1902 A
(try\))168 2532 A
6885 V
(15126)210 1122 A
(tty_t)210 1440 A
(*tp;)168 1692 A
6975 V
(15127)210 1122 A
(int)126 1440 A
(try;)168 1608 A
7065 V
(15128)210 1122 A
1440({)S
8418 V
EP
%%Page: 199 199
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2422(File:)S
(drivers/tty/tty.c)682 2655 A
12 B
(199)180 4500 A
1755 V
7 LST
(15129)210 1122 A
1524(/*)S
(Some)168 1650 A
(functions)378 1860 A
(need)168 2280 A
(not)126 2490 A
2658(be)S
(implemented)462 2784 A
3288(at)S
(the)126 3414 A
(device)252 3582 A
(level.)252 3876 A
4170(*/)S
1845 V
(15130)210 1122 A
1440(})S
2025 V
(15132)210 1122 A
(/*===========================================================================*)3276 1440 A
2115 V
(15133)210 1122 A
1482(*)S
(do_select)378 2784 A
4674(*)S
2205 V
(15134)210 1122 A
(*===========================================================================*/)3276 1482 A
2295 V
(15135)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(do_select\(tp,)546 1986 A
(m_ptr\))252 2574 A
2385 V
(15136)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(tty)126 3372 A
(struct)252 3540 A
3834(*/)S
2475 V
(15137)210 1122 A
(register)336 1440 A
(message)294 1818 A
(*m_ptr;)294 2154 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(message)294 3372 A
(sent)168 3708 A
3918(to)S
(the)126 4044 A
(task)168 4212 A
4422(*/)S
2565 V
(15138)210 1122 A
1440({)S
2655 V
(15139)210 1122 A
(int)126 1776 A
(ops,)168 1944 A
(ready_ops)378 2154 A
2574(=)S
2658(0,)S
(watch;)252 2784 A
2745 V
(15140)210 1122 A
2835 V
(15141)210 1122 A
(ops)126 1776 A
1944(=)S
(m_ptr->PROC_NR)588 2028 A
2658(&)S
(\(SEL_RD|SEL_WR|SEL_ERR\);)1008 2742 A
2925 V
(15142)210 1122 A
(watch)210 1776 A
2028(=)S
(\(m_ptr->PROC_NR)630 2112 A
2784(&)S
(SEL_NOTIFY\))462 2868 A
3372(?)S
3456(1)S
3540(:)S
3624(0;)S
3015 V
(15143)210 1122 A
3105 V
(15144)210 1122 A
(ready_ops)378 1776 A
2196(=)S
(select_try\(tp,)588 2280 A
(ops\);)210 2910 A
3195 V
(15145)210 1122 A
3285 V
(15146)210 1122 A
1776(if)S
(\(!ready_ops)462 1902 A
2406(&&)S
(ops)126 2532 A
2700(&&)S
(watch\))252 2826 A
3120({)S
3375 V
(15147)210 1122 A
(tp->tty_select_ops)756 2112 A
2910(|=)S
(ops;)168 3036 A
3465 V
(15148)210 1122 A
(tp->tty_select_proc)798 2112 A
2952(=)S
(m_ptr->m_source;)672 3036 A
3555 V
(15149)210 1122 A
1776(})S
3645 V
(15150)210 1122 A
3735 V
(15151)210 1122 A
(tty_reply\(TASK_REPLY,)882 1776 A
(m_ptr->m_source,)672 2700 A
(m_ptr->PROC_NR,)630 3414 A
(ready_ops\);)462 4086 A
3825 V
(15152)210 1122 A
3915 V
(15153)210 1122 A
(return;)294 1776 A
4005 V
(15154)210 1122 A
1440(})S
4545 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4635 V
(drivers/tty/keyboard.c)924 2676 A
4725 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4905 V
(15200)210 1122 A
1440(/*)S
(Keyboard)336 1566 A
(driver)252 1944 A
(for)126 2238 A
(PC's)168 2406 A
(and)126 2616 A
(AT's.)210 2784 A
4995 V
(15201)210 1122 A
1482(*)S
5085 V
(15202)210 1122 A
1482(*)S
(Changes:)336 1566 A
5175 V
(15203)210 1122 A
1482(*)S
(Jul)126 1650 A
(13,)126 1818 A
(2004)168 1986 A
(processes)378 2280 A
(can)126 2700 A
(observe)294 2868 A
(function)336 3204 A
(keys)168 3582 A
(\(Jorrit)294 3834 A
4170(N.)S
(Herder\))294 4296 A
5265 V
(15204)210 1122 A
1482(*)S
(Jun)126 1650 A
(15,)126 1818 A
(2004)168 1986 A
(removed)294 2280 A
(wreboot\(\),)420 2616 A
(except)252 3078 A
(panic)210 3372 A
(dumps)210 3624 A
(\(Jorrit)294 3876 A
4212(N.)S
(Herder\))294 4338 A
5355 V
(15205)210 1122 A
1482(*)S
(Feb)126 1650 A
(04,)126 1818 A
(1994)168 1986 A
(loadable)336 2280 A
(keymaps)294 2658 A
(\(Marcus)294 3036 A
(Hampel\))294 3372 A
5445 V
(15206)210 1122 A
1482(*/)S
5535 V
(15207)210 1122 A
5625 V
(15208)210 1122 A
(#include)336 1440 A
("../drivers.h")588 1818 A
5715 V
(15209)210 1122 A
(#include)336 1440 A
(<sys/time.h>)504 1818 A
5805 V
(15210)210 1122 A
(#include)336 1440 A
(<sys/select.h>)588 1818 A
5895 V
(15211)210 1122 A
(#include)336 1440 A
(<termios.h>)462 1818 A
5985 V
(15212)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
6075 V
(15213)210 1122 A
(#include)336 1440 A
(<unistd.h>)420 1818 A
6165 V
(15214)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
6255 V
(15215)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
6345 V
(15216)210 1122 A
(#include)336 1440 A
(<minix/keymap.h>)672 1818 A
6435 V
(15217)210 1122 A
(#include)336 1440 A
("tty.h")294 1818 A
6525 V
(15218)210 1122 A
(#include)336 1440 A
("keymaps/us-std.src")840 1818 A
6615 V
(15219)210 1122 A
(#include)336 1440 A
("../../kernel/const.h")924 1818 A
6705 V
(15220)210 1122 A
(#include)336 1440 A
("../../kernel/config.h")966 1818 A
6795 V
(15221)210 1122 A
(#include)336 1440 A
("../../kernel/type.h")882 1818 A
6885 V
(15222)210 1122 A
(#include)336 1440 A
("../../kernel/proc.h")882 1818 A
6975 V
(15223)210 1122 A
7065 V
(15224)210 1122 A
(int)126 1440 A
(irq_hook_id)462 1608 A
2112(=)S
(-1;)126 2196 A
8418 V
EP
%%Page: 200 200
BP
/slant 0 def
/height 0 def
1485 V
12 B
(200)180 1080 A
11 R
2275(File:)S
(drivers/tty/keyboard.c)977 2508 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(15225)210 1122 A
1845 V
(15226)210 1122 A
1440(/*)S
(Standard)336 1566 A
(and)126 1944 A
2112(AT)S
(keyboard.)378 2238 A
(\(PS/2)210 2700 A
(MCA)126 2952 A
(implies)294 3120 A
3456(AT)S
(throughout.\))504 3582 A
4128(*/)S
1935 V
(15227)210 1122 A
(#define)294 1440 A
(KEYBD)210 1776 A
(0x60)168 2448 A
2784(/*)S
(I/O)126 2910 A
(port)168 3078 A
(for)126 3288 A
(keyboard)336 3456 A
(data)168 3834 A
4044(*/)S
2025 V
(15228)210 1122 A
2115 V
(15229)210 1122 A
1440(/*)S
1566(AT)S
(keyboard.)378 1692 A
2112(*/)S
2205 V
(15230)210 1122 A
(#define)294 1440 A
(KB_COMMAND)420 1776 A
(0x64)168 2448 A
2784(/*)S
(I/O)126 2910 A
(port)168 3078 A
(for)126 3288 A
(commands)336 3456 A
3834(on)S
3960(AT)S
4086(*/)S
2295 V
(15231)210 1122 A
(#define)294 1440 A
(KB_STATUS)378 1776 A
(0x64)168 2448 A
2784(/*)S
(I/O)126 2910 A
(port)168 3078 A
(for)126 3288 A
(status)252 3456 A
3750(on)S
3876(AT)S
4002(*/)S
2385 V
(15232)210 1122 A
(#define)294 1440 A
(KB_ACK)252 1776 A
(0xFA)168 2448 A
2784(/*)S
(keyboard)336 2910 A
(ack)126 3288 A
(response)336 3456 A
3834(*/)S
2475 V
(15233)210 1122 A
(#define)294 1440 A
(KB_OUT_FULL)462 1776 A
(0x01)168 2448 A
2784(/*)S
(status)252 2910 A
(bit)126 3204 A
(set)126 3372 A
(when)168 3540 A
(keypress)336 3750 A
(char)168 4128 A
(pending)294 4338 A
4674(*/)S
2565 V
(15234)210 1122 A
(#define)294 1440 A
(KB_IN_FULL)420 1776 A
(0x02)168 2448 A
2784(/*)S
(status)252 2910 A
(bit)126 3204 A
(set)126 3372 A
(when)168 3540 A
(not)126 3750 A
(ready)210 3918 A
4170(to)S
(receive)294 4296 A
4632(*/)S
2655 V
(15235)210 1122 A
(#define)294 1440 A
(LED_CODE)336 1776 A
(0xED)168 2448 A
2784(/*)S
(command)294 2910 A
3246(to)S
(keyboard)336 3372 A
3750(to)S
(set)126 3876 A
(LEDs)168 4044 A
4254(*/)S
2745 V
(15236)210 1122 A
(#define)294 1440 A
(MAX_KB_ACK_RETRIES)756 1776 A
(0x1000)252 2574 A
3120(/*)S
(max)126 3246 A
(#times)252 3414 A
3708(to)S
(wait)168 3834 A
(for)126 4044 A
4212(kb)S
(ack)126 4338 A
4506(*/)S
2835 V
(15237)210 1122 A
(#define)294 1440 A
(MAX_KB_BUSY_RETRIES)798 1776 A
(0x1000)252 2616 A
3120(/*)S
(max)126 3246 A
(#times)252 3414 A
3708(to)S
(loop)168 3834 A
(while)210 4044 A
4296(kb)S
(busy)168 4422 A
4632(*/)S
2925 V
(15238)210 1122 A
(#define)294 1440 A
(KBIT)168 1776 A
(0x80)168 2448 A
2784(/*)S
(bit)126 2910 A
(used)168 3078 A
3288(to)S
(ack)126 3414 A
(characters)420 3582 A
4044(to)S
(keyboard)336 4170 A
4548(*/)S
3015 V
(15239)210 1122 A
3105 V
(15240)210 1122 A
1440(/*)S
(Miscellaneous.)588 1566 A
2196(*/)S
3195 V
(15241)210 1122 A
(#define)294 1440 A
(ESC_SCAN)336 1776 A
(0x01)168 2448 A
2784(/*)S
(reboot)252 2910 A
(key)126 3204 A
(when)168 3372 A
(panicking)378 3582 A
4002(*/)S
3285 V
(15242)210 1122 A
(#define)294 1440 A
(SLASH_SCAN)420 1776 A
(0x35)168 2448 A
2784(/*)S
2910(to)S
(recognize)378 3036 A
(numeric)294 3456 A
(slash)210 3792 A
4044(*/)S
3375 V
(15243)210 1122 A
(#define)294 1440 A
(RSHIFT_SCAN)462 1776 A
(0x36)168 2448 A
2784(/*)S
2910(to)S
(distinguish)462 3036 A
(left)168 3540 A
(and)126 3750 A
(right)210 3918 A
(shift)210 4170 A
4422(*/)S
3465 V
(15244)210 1122 A
(#define)294 1440 A
(HOME_SCAN)378 1776 A
(0x47)168 2448 A
2784(/*)S
(first)210 2910 A
(key)126 3162 A
3330(on)S
(the)126 3456 A
(numeric)294 3624 A
(keypad)252 3960 A
4254(*/)S
3555 V
(15245)210 1122 A
(#define)294 1440 A
(INS_SCAN)336 1776 A
(0x52)168 2448 A
2784(/*)S
(INS)126 2910 A
(for)126 3078 A
(use)126 3246 A
3414(in)S
(CTRL-ALT-INS)504 3540 A
(reboot)252 4086 A
4380(*/)S
3645 V
(15246)210 1122 A
(#define)294 1440 A
(DEL_SCAN)336 1776 A
(0x53)168 2448 A
2784(/*)S
(DEL)126 2910 A
(for)126 3078 A
(use)126 3246 A
3414(in)S
(CTRL-ALT-DEL)504 3540 A
(reboot)252 4086 A
4380(*/)S
3735 V
(15247)210 1122 A
3825 V
(15248)210 1122 A
(#define)294 1440 A
(CONSOLE)294 1776 A
2574(0)S
2784(/*)S
(line)168 2910 A
(number)252 3120 A
(for)126 3414 A
(console)294 3582 A
3918(*/)S
3915 V
(15249)210 1122 A
(#define)294 1440 A
(KB_IN_BYTES)462 1776 A
2532(32)S
2784(/*)S
(size)168 2910 A
3120(of)S
(keyboard)336 3246 A
(input)210 3624 A
(buffer)252 3876 A
4170(*/)S
4005 V
(15250)210 1122 A
(PRIVATE)294 1440 A
(char)168 1776 A
(ibuf[KB_IN_BYTES];)756 1986 A
2784(/*)S
(input)210 2910 A
(buffer)252 3162 A
3456(*/)S
4095 V
(15251)210 1122 A
(PRIVATE)294 1440 A
(char)168 1776 A
(*ihead)252 1986 A
2280(=)S
(ibuf;)210 2364 A
2784(/*)S
(next)168 2910 A
(free)168 3120 A
(spot)168 3330 A
3540(in)S
(input)210 3666 A
(buffer)252 3918 A
4212(*/)S
4185 V
(15252)210 1122 A
(PRIVATE)294 1440 A
(char)168 1776 A
(*itail)252 1986 A
2280(=)S
(ibuf;)210 2364 A
2784(/*)S
(scan)168 2910 A
(code)168 3120 A
3330(to)S
(return)252 3456 A
3750(to)S
(TTY)126 3876 A
4044(*/)S
4275 V
(15253)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(icount;)294 1944 A
2784(/*)S
2910(#)S
(codes)210 2994 A
3246(in)S
(buffer)252 3372 A
3666(*/)S
4365 V
(15254)210 1122 A
4455 V
(15255)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(esc;)168 1944 A
2784(/*)S
(escape)252 2910 A
(scan)168 3204 A
(code)168 3414 A
(detected?)378 3624 A
4044(*/)S
4545 V
(15256)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(alt_l;)252 1944 A
2784(/*)S
(left)168 2910 A
(alt)126 3120 A
(key)126 3288 A
(state)210 3456 A
3708(*/)S
4635 V
(15257)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(alt_r;)252 1944 A
2784(/*)S
(right)210 2910 A
(alt)126 3162 A
(key)126 3330 A
(state)210 3498 A
3750(*/)S
4725 V
(15258)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(alt;)168 1944 A
2784(/*)S
(either)252 2910 A
(alt)126 3204 A
(key)126 3372 A
3540(*/)S
4815 V
(15259)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(ctrl_l;)294 1944 A
2784(/*)S
(left)168 2910 A
(control)294 3120 A
(key)126 3456 A
(state)210 3624 A
3876(*/)S
4905 V
(15260)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(ctrl_r;)294 1944 A
2784(/*)S
(right)210 2910 A
(control)294 3162 A
(key)126 3498 A
(state)210 3666 A
3918(*/)S
4995 V
(15261)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(ctrl;)210 1944 A
2784(/*)S
(either)252 2910 A
(control)294 3204 A
(key)126 3540 A
3708(*/)S
5085 V
(15262)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(shift_l;)336 1944 A
2784(/*)S
(left)168 2910 A
(shift)210 3120 A
(key)126 3372 A
(state)210 3540 A
3792(*/)S
5175 V
(15263)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(shift_r;)336 1944 A
2784(/*)S
(right)210 2910 A
(shift)210 3162 A
(key)126 3414 A
(state)210 3582 A
3834(*/)S
5265 V
(15264)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(shift;)252 1944 A
2784(/*)S
(either)252 2910 A
(shift)210 3204 A
(key)126 3456 A
3624(*/)S
5355 V
(15265)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(num_down;)378 1944 A
2784(/*)S
(num)126 2910 A
(lock)168 3078 A
(key)126 3288 A
(depressed)378 3456 A
3876(*/)S
5445 V
(15266)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(caps_down;)420 1944 A
2784(/*)S
(caps)168 2910 A
(lock)168 3120 A
(key)126 3330 A
(depressed)378 3498 A
3918(*/)S
5535 V
(15267)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(scroll_down;)504 1944 A
2784(/*)S
(scroll)252 2910 A
(lock)168 3204 A
(key)126 3414 A
(depressed)378 3582 A
4002(*/)S
5625 V
(15268)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(locks[NR_CONS];)630 1944 A
2784(/*)S
(per)126 2910 A
(console)294 3078 A
(lock)168 3414 A
(keys)168 3624 A
(state)210 3834 A
4086(*/)S
5715 V
(15269)210 1122 A
5805 V
(15270)210 1122 A
1440(/*)S
(Lock)168 1566 A
(key)126 1776 A
(active)252 1944 A
(bits.)210 2238 A
(Chosen)252 2532 A
2826(to)S
2952(be)S
(equal)210 3078 A
3330(to)S
(the)126 3456 A
(keyboard)336 3624 A
(LED)126 4002 A
(bits.)210 4170 A
4422(*/)S
5895 V
(15271)210 1122 A
(#define)294 1440 A
(SCROLL_LOCK)462 1776 A
(0x01)168 2448 A
5985 V
(15272)210 1122 A
(#define)294 1440 A
(NUM_LOCK)336 1776 A
(0x02)168 2448 A
6075 V
(15273)210 1122 A
(#define)294 1440 A
(CAPS_LOCK)378 1776 A
(0x04)168 2448 A
6165 V
(15274)210 1122 A
6255 V
(15275)210 1122 A
(PRIVATE)294 1440 A
(char)168 1776 A
(numpad_map[])504 1986 A
2532(=)S
6345 V
(15276)210 1122 A
({'H',)210 2112 A
('Y',)168 2364 A
('A',)168 2574 A
('B',)168 2784 A
('D',)168 2994 A
('C',)168 3204 A
('V',)168 3414 A
('U',)168 3624 A
('G',)168 3834 A
('S',)168 4044 A
('T',)168 4254 A
('@'};)210 4464 A
6435 V
(15277)210 1122 A
6525 V
(15278)210 1122 A
1440(/*)S
(Variables)378 1566 A
(and)126 1986 A
(definition)420 2154 A
(for)126 2616 A
(observed)336 2784 A
(function)336 3162 A
(keys.)210 3540 A
3792(*/)S
6615 V
(15279)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
(observer)336 2070 A
2448({)S
(int)126 2532 A
(proc_nr;)336 2700 A
(int)126 3078 A
(events;)294 3246 A
3582(})S
(obs_t;)252 3666 A
6705 V
(15280)210 1122 A
(PRIVATE)294 1440 A
(obs_t)210 1776 A
(fkey_obs[12];)546 2070 A
2784(/*)S
(observers)378 2910 A
(for)126 3330 A
(F1-F12)252 3498 A
3792(*/)S
6795 V
(15281)210 1122 A
(PRIVATE)294 1440 A
(obs_t)210 1776 A
(sfkey_obs[12];)588 2028 A
2784(/*)S
(observers)378 2910 A
(for)126 3330 A
(SHIFT)210 3498 A
(F1-F12)252 3750 A
4044(*/)S
6885 V
(15282)210 1122 A
6975 V
(15283)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(kb_ack,)294 2448 A
(\(void\))252 2784 A
4464(\);)S
7065 V
(15284)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(kb_wait,)336 2448 A
(\(void\))252 2826 A
4464(\);)S
8418 V
EP
%%Page: 201 201
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2275(File:)S
(drivers/tty/keyboard.c)977 2508 A
12 B
(201)180 4500 A
1755 V
7 LST
(15285)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(func_key,)378 2448 A
(\(int)168 2868 A
(scode\))252 3078 A
4464(\);)S
1845 V
(15286)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(scan_keyboard,)588 2448 A
(\(void\))252 3078 A
4464(\);)S
1935 V
(15287)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(unsigned)336 2280 A
(make_break,)462 2658 A
(\(int)168 3162 A
(scode\))252 3372 A
4464(\);)S
2025 V
(15288)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(set_leds,)378 2490 A
(\(void\))252 2910 A
4464(\);)S
2115 V
(15289)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(show_key_mappings,)756 2490 A
(\(void\))252 3288 A
4464(\);)S
2205 V
(15290)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(kb_read,)336 2448 A
(\(struct)294 2826 A
(tty)126 3162 A
(*tp,)168 3330 A
(int)126 3540 A
(try\))168 3708 A
4464(\);)S
2295 V
(15291)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(unsigned)336 2280 A
(map_key,)336 2658 A
(\(int)168 3036 A
(scode\))252 3246 A
4464(\);)S
2385 V
(15292)210 1122 A
2475 V
(15293)210 1122 A
(/*===========================================================================*)3276 1440 A
2565 V
(15294)210 1122 A
1482(*)S
(map_key0)336 2784 A
4674(*)S
2655 V
(15295)210 1122 A
(*===========================================================================*/)3276 1482 A
2745 V
(15296)210 1122 A
1440(/*)S
(Map)126 1566 A
1734(a)S
(scan)168 1818 A
(code)168 2028 A
2238(to)S
2364(an)S
(ASCII)210 2490 A
(code)168 2742 A
(ignoring)336 2952 A
(modifiers.)420 3330 A
3792(*/)S
2835 V
(15297)210 1122 A
(#define)294 1440 A
(map_key0\(scode\))630 1776 A
2490(\\)S
2925 V
(15298)210 1122 A
(\(\(unsigned\))462 1776 A
(keymap[\(scode\))588 2280 A
2910(*)S
(MAP_COLS]\))420 2994 A
3015 V
(15299)210 1122 A
3105 V
(15300)210 1122 A
(/*===========================================================================*)3276 1440 A
3195 V
(15301)210 1122 A
1482(*)S
(map_key)294 2784 A
4674(*)S
3285 V
(15302)210 1122 A
(*===========================================================================*/)3276 1482 A
3375 V
(15303)210 1122 A
(PRIVATE)294 1440 A
(unsigned)336 1776 A
(map_key\(scode\))588 2154 A
3465 V
(15304)210 1122 A
(int)126 1440 A
(scode;)252 1608 A
3555 V
(15305)210 1122 A
1440({)S
3645 V
(15306)210 1122 A
1440(/*)S
(Map)126 1566 A
1734(a)S
(scan)168 1818 A
(code)168 2028 A
2238(to)S
2364(an)S
(ASCII)210 2490 A
(code.)210 2742 A
2994(*/)S
3735 V
(15307)210 1122 A
3825 V
(15308)210 1122 A
(int)126 1524 A
(caps,)210 1692 A
(column,)294 1944 A
(lk;)126 2280 A
3915 V
(15309)210 1122 A
(u16_t)210 1524 A
(*keyrow;)336 1776 A
4005 V
(15310)210 1122 A
4095 V
(15311)210 1122 A
1524(if)S
(\(scode)252 1650 A
1944(==)S
(SLASH_SCAN)420 2070 A
2532(&&)S
(esc\))168 2658 A
(return)252 2868 A
('/';)168 3162 A
3456(/*)S
(don't)210 3582 A
(map)126 3834 A
(numeric)294 4002 A
(slash)210 4338 A
4590(*/)S
4185 V
(15312)210 1122 A
4275 V
(15313)210 1122 A
(keyrow)252 1524 A
1818(=)S
(&keymap[scode)546 1902 A
2490(*)S
(MAP_COLS];)420 2574 A
4365 V
(15314)210 1122 A
4455 V
(15315)210 1122 A
(caps)168 1524 A
1734(=)S
(shift;)252 1818 A
4545 V
(15316)210 1122 A
1524(lk)S
1650(=)S
(locks[ccurrent];)672 1734 A
4635 V
(15317)210 1122 A
1524(if)S
(\(\(lk)168 1650 A
1860(&)S
(NUM_LOCK\))378 1944 A
2364(&&)S
(HOME_SCAN)378 2490 A
2910(<=)S
(scode)210 3036 A
3288(&&)S
(scode)210 3414 A
3666(<=)S
(DEL_SCAN\))378 3792 A
(caps)168 4212 A
4422(=)S
(!caps;)252 4506 A
4725 V
(15318)210 1122 A
1524(if)S
(\(\(lk)168 1650 A
1860(&)S
(CAPS_LOCK\))420 1944 A
2406(&&)S
(\(keyrow[0])420 2532 A
2994(&)S
(HASCAPS\)\))378 3078 A
(caps)168 3498 A
3708(=)S
(!caps;)252 3792 A
4815 V
(15319)210 1122 A
4905 V
(15320)210 1122 A
1524(if)S
(\(alt\))210 1650 A
1902({)S
4995 V
(15321)210 1122 A
(column)252 1776 A
2070(=)S
2154(2;)S
5085 V
(15322)210 1122 A
1776(if)S
(\(ctrl)210 1902 A
2154(||)S
(alt_r\))252 2280 A
(column)252 2574 A
2868(=)S
2952(3;)S
3120(/*)S
(Ctrl)168 3246 A
3456(+)S
(Alt)126 3540 A
3708(==)S
(AltGr)210 3834 A
4086(*/)S
5175 V
(15323)210 1122 A
1776(if)S
(\(caps\))252 1902 A
(column)252 2196 A
2490(=)S
2574(4;)S
5265 V
(15324)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
5355 V
(15325)210 1122 A
(column)252 1776 A
2070(=)S
2154(0;)S
5445 V
(15326)210 1122 A
1776(if)S
(\(caps\))252 1902 A
(column)252 2196 A
2490(=)S
2574(1;)S
5535 V
(15327)210 1122 A
1776(if)S
(\(ctrl\))252 1902 A
(column)252 2196 A
2490(=)S
2574(5;)S
5625 V
(15328)210 1122 A
1524(})S
5715 V
(15329)210 1122 A
(return)252 1524 A
(keyrow[column])588 1818 A
2448(&)S
(\304HASCAPS;)378 2532 A
5805 V
(15330)210 1122 A
1440(})S
5985 V
(15332)210 1122 A
(/*===========================================================================*)3276 1440 A
6075 V
(15333)210 1122 A
1482(*)S
(kbd_interrupt)546 2784 A
4674(*)S
6165 V
(15334)210 1122 A
(*===========================================================================*/)3276 1482 A
6255 V
(15335)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(kbd_interrupt\(m_ptr\))840 1944 A
6345 V
(15336)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
6435 V
(15337)210 1122 A
1440({)S
6525 V
(15338)210 1122 A
1440(/*)S
1566(A)S
(keyboard)336 1650 A
(interrupt)378 2028 A
(has)126 2448 A
(occurred.)378 2616 A
(Process)294 3078 A
(it.)126 3414 A
3582(*/)S
6615 V
(15339)210 1122 A
(int)126 1524 A
(scode;)252 1692 A
6705 V
(15340)210 1122 A
(static)252 1524 A
(timer_t)294 1818 A
(timer;)252 2154 A
2784(/*)S
(timer)210 2910 A
(must)168 3162 A
3372(be)S
(static!)294 3498 A
3834(*/)S
6795 V
(15341)210 1122 A
6885 V
(15342)210 1122 A
1524(/*)S
(Fetch)210 1650 A
(the)126 1902 A
(character)378 2070 A
(from)168 2490 A
(the)126 2700 A
(keyboard)336 2868 A
(hardware)336 3246 A
(and)126 3624 A
(acknowledge)462 3792 A
(it.)126 4296 A
4464(*/)S
6975 V
(15343)210 1122 A
(scode)210 1524 A
1776(=)S
(scan_keyboard\(\);)672 1860 A
7065 V
(15344)210 1122 A
8418 V
EP
%%Page: 202 202
BP
/slant 0 def
/height 0 def
1485 V
12 B
(202)180 1080 A
11 R
2275(File:)S
(drivers/tty/keyboard.c)977 2508 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(15345)210 1122 A
1524(/*)S
(Store)210 1650 A
(the)126 1902 A
(scancode)336 2070 A
2448(in)S
(memory)252 2574 A
2868(so)S
(the)126 2994 A
(task)168 3162 A
(can)126 3372 A
(get)126 3540 A
3708(at)S
3834(it)S
(later.)252 3960 A
4254(*/)S
1845 V
(15346)210 1122 A
1524(if)S
(\(icount)294 1650 A
1986(<)S
(KB_IN_BYTES\))504 2070 A
2616({)S
1935 V
(15347)210 1122 A
(*ihead++)336 1776 A
2154(=)S
(scode;)252 2238 A
2025 V
(15348)210 1122 A
1776(if)S
(\(ihead)252 1902 A
2196(==)S
(ibuf)168 2322 A
2532(+)S
(KB_IN_BYTES\))504 2616 A
(ihead)210 3162 A
3414(=)S
(ibuf;)210 3498 A
2115 V
(15349)210 1122 A
(icount++;)378 1776 A
2205 V
(15350)210 1122 A
(tty_table[ccurrent].tty_events)1260 1776 A
3078(=)S
3162(1;)S
2295 V
(15351)210 1122 A
1776(if)S
(\(tty_table[ccurrent].tty_select_ops)1470 1902 A
3414(&)S
(SEL_RD\))294 3498 A
3834({)S
2385 V
(15352)210 1122 A
(select_retry\(&tty_table[ccurrent]\);)1470 2112 A
2475 V
(15353)210 1122 A
1776(})S
2565 V
(15354)210 1122 A
1524(})S
2655 V
(15355)210 1122 A
1440(})S
2835 V
(15357)210 1122 A
(/*===========================================================================*)3276 1440 A
2925 V
(15358)210 1122 A
1482(*)S
(kb_read)294 2784 A
4674(*)S
3015 V
(15359)210 1122 A
(*===========================================================================*/)3276 1482 A
3105 V
(15360)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(kb_read\(tp,)462 1944 A
(try\))168 2448 A
3195 V
(15361)210 1122 A
(tty_t)210 1440 A
(*tp;)168 1692 A
3285 V
(15362)210 1122 A
(int)126 1440 A
(try;)168 1608 A
3375 V
(15363)210 1122 A
1440({)S
3465 V
(15364)210 1122 A
1440(/*)S
(Process)294 1566 A
(characters)420 1902 A
(from)168 2364 A
(the)126 2574 A
(circular)336 2742 A
(keyboard)336 3120 A
(buffer.)294 3498 A
3834(*/)S
3555 V
(15365)210 1122 A
(char)168 1524 A
(buf[3];)294 1734 A
3645 V
(15366)210 1122 A
(int)126 1524 A
(scode;)252 1692 A
3735 V
(15367)210 1122 A
(unsigned)336 1524 A
(ch;)126 1902 A
3825 V
(15368)210 1122 A
3915 V
(15369)210 1122 A
1524(tp)S
1650(=)S
(&tty_table[ccurrent];)882 1734 A
3120(/*)S
(always)252 3246 A
(use)126 3540 A
(the)126 3708 A
(current)294 3876 A
(console)294 4212 A
4548(*/)S
4005 V
(15370)210 1122 A
4095 V
(15371)210 1122 A
1524(if)S
(\(try\))210 1650 A
1902({)S
4185 V
(15372)210 1122 A
1776(if)S
(\(icount)294 1902 A
2238(>)S
2322(0\))S
(return)252 2448 A
2742(1;)S
4275 V
(15373)210 1122 A
(return)252 1776 A
2070(0;)S
4365 V
(15374)210 1122 A
1524(})S
4455 V
(15375)210 1122 A
4545 V
(15376)210 1122 A
(while)210 1524 A
(\(icount)294 1776 A
2112(>)S
2196(0\))S
2322({)S
4635 V
(15377)210 1122 A
(scode)210 1776 A
2028(=)S
(*itail++;)378 2112 A
3456(/*)S
(take)168 3582 A
(one)126 3792 A
(key)126 3960 A
(scan)168 4128 A
(code)168 4338 A
4548(*/)S
4725 V
(15378)210 1122 A
1776(if)S
(\(itail)252 1902 A
2196(==)S
(ibuf)168 2322 A
2532(+)S
(KB_IN_BYTES\))504 2616 A
(itail)210 3162 A
3414(=)S
(ibuf;)210 3498 A
4815 V
(15379)210 1122 A
(icount--;)378 1776 A
4905 V
(15380)210 1122 A
4995 V
(15381)210 1122 A
1776(/*)S
(Function)336 1902 A
(keys)168 2280 A
(are)126 2490 A
(being)210 2658 A
(used)168 2910 A
(for)126 3120 A
(debug)210 3288 A
(dumps.)252 3540 A
3834(*/)S
5085 V
(15382)210 1122 A
1776(if)S
(\(func_key\(scode\)\))714 1902 A
(continue;)378 2658 A
5175 V
(15383)210 1122 A
5265 V
(15384)210 1122 A
1776(/*)S
(Perform)294 1902 A
(make/break)420 2238 A
(processing.)462 2700 A
3204(*/)S
5355 V
(15385)210 1122 A
1776(ch)S
1902(=)S
(make_break\(scode\);)756 1986 A
5445 V
(15386)210 1122 A
5535 V
(15387)210 1122 A
1776(if)S
(\(ch)126 1902 A
2070(<=)S
(0xFF\))210 2196 A
2448({)S
5625 V
(15388)210 1122 A
2112(/*)S
2238(A)S
(normal)252 2322 A
(character.)420 2616 A
3078(*/)S
5715 V
(15389)210 1122 A
(buf[0])252 2112 A
2406(=)S
(ch;)126 2490 A
5805 V
(15390)210 1122 A
(\(void\))252 2112 A
(in_process\(tp,)588 2406 A
(buf,)168 3036 A
(1\);)126 3246 A
5895 V
(15391)210 1122 A
1776(})S
(else)168 1860 A
5985 V
(15392)210 1122 A
1776(if)S
(\(HOME)210 1902 A
2154(<=)S
2280(ch)S
2406(&&)S
2532(ch)S
2658(<=)S
(INSRT\))252 2784 A
3078({)S
6075 V
(15393)210 1122 A
2112(/*)S
2238(An)S
(ASCII)210 2364 A
(escape)252 2616 A
(sequence)336 2910 A
(generated)378 3288 A
3708(by)S
(the)126 3834 A
(numeric)294 4002 A
(pad.)168 4338 A
4548(*/)S
6165 V
(15394)210 1122 A
(buf[0])252 2112 A
2406(=)S
(ESC;)168 2490 A
6255 V
(15395)210 1122 A
(buf[1])252 2112 A
2406(=)S
('[';)168 2490 A
6345 V
(15396)210 1122 A
(buf[2])252 2112 A
2406(=)S
(numpad_map[ch)546 2490 A
3078(-)S
(HOME];)252 3162 A
6435 V
(15397)210 1122 A
(\(void\))252 2112 A
(in_process\(tp,)588 2406 A
(buf,)168 3036 A
(3\);)126 3246 A
6525 V
(15398)210 1122 A
1776(})S
(else)168 1860 A
6615 V
(15399)210 1122 A
1776(if)S
(\(ch)126 1902 A
2070(==)S
(ALEFT\))252 2196 A
2490({)S
6705 V
(15400)210 1122 A
2112(/*)S
(Choose)252 2238 A
(lower)210 2532 A
(numbered)336 2784 A
(console)294 3162 A
3498(as)S
(current)294 3624 A
(console.)336 3960 A
4338(*/)S
6795 V
(15401)210 1122 A
(select_console\(ccurrent)966 2112 A
3120(-)S
(1\);)126 3204 A
6885 V
(15402)210 1122 A
(set_leds\(\);)462 2112 A
6975 V
(15403)210 1122 A
1776(})S
(else)168 1860 A
7065 V
(15404)210 1122 A
1776(if)S
(\(ch)126 1902 A
2070(==)S
(ARIGHT\))294 2196 A
2532({)S
8418 V
EP
%%Page: 203 203
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2275(File:)S
(drivers/tty/keyboard.c)977 2508 A
12 B
(203)180 4500 A
1755 V
7 LST
(15405)210 1122 A
2112(/*)S
(Choose)252 2238 A
(higher)252 2532 A
(numbered)336 2826 A
(console)294 3204 A
3540(as)S
(current)294 3666 A
(console.)336 4002 A
4380(*/)S
1845 V
(15406)210 1122 A
(select_console\(ccurrent)966 2112 A
3120(+)S
(1\);)126 3204 A
1935 V
(15407)210 1122 A
(set_leds\(\);)462 2112 A
2025 V
(15408)210 1122 A
1776(})S
(else)168 1860 A
2115 V
(15409)210 1122 A
1776(if)S
(\(AF1)168 1902 A
2112(<=)S
2238(ch)S
2364(&&)S
2490(ch)S
2616(<=)S
(AF12\))210 2742 A
2994({)S
2205 V
(15410)210 1122 A
2112(/*)S
(Alt-F1)252 2238 A
2532(is)S
(console,)336 2658 A
(Alt-F2)252 3036 A
3330(is)S
(ttyc1,)252 3456 A
(etc.)168 3750 A
3960(*/)S
2295 V
(15411)210 1122 A
(select_console\(ch)714 2112 A
2868(-)S
(AF1\);)210 2952 A
2385 V
(15412)210 1122 A
(set_leds\(\);)462 2112 A
2475 V
(15413)210 1122 A
1776(})S
(else)168 1860 A
2565 V
(15414)210 1122 A
1776(if)S
(\(CF1)168 1902 A
2112(<=)S
2238(ch)S
2364(&&)S
2490(ch)S
2616(<=)S
(CF12\))210 2742 A
2994({)S
2655 V
(15415)210 1122 A
(switch\(ch\))420 1944 A
2406({)S
2745 V
(15416)210 1122 A
(case)168 2112 A
(CF1:)168 2322 A
(show_key_mappings\(\);)840 2532 A
(break;)252 3414 A
2835 V
(15417)210 1122 A
(case)168 2112 A
(CF3:)168 2322 A
(toggle_scroll\(\);)672 2532 A
(break;)252 3246 A
3540(/*)S
(hardware)336 3666 A
(<->)126 4044 A
(software)336 4212 A
4590(*/)S
2925 V
(15418)210 1122 A
(case)168 2112 A
(CF7:)168 2322 A
(sigchar\(&tty_table[CONSOLE],)1176 2532 A
(SIGQUIT\);)378 3750 A
(break;)252 4170 A
3015 V
(15419)210 1122 A
(case)168 2112 A
(CF8:)168 2322 A
(sigchar\(&tty_table[CONSOLE],)1176 2532 A
(SIGINT\);)336 3750 A
(break;)252 4128 A
3105 V
(15420)210 1122 A
(case)168 2112 A
(CF9:)168 2322 A
(sigchar\(&tty_table[CONSOLE],)1176 2532 A
(SIGKILL\);)378 3750 A
(break;)252 4170 A
3195 V
(15421)210 1122 A
1944(})S
3285 V
(15422)210 1122 A
1776(})S
3375 V
(15423)210 1122 A
1524(})S
3465 V
(15424)210 1122 A
3555 V
(15425)210 1122 A
(return)252 1524 A
1818(1;)S
3645 V
(15426)210 1122 A
1440(})S
3825 V
(15428)210 1122 A
(/*===========================================================================*)3276 1440 A
3915 V
(15429)210 1122 A
1482(*)S
(make_break)420 2784 A
4674(*)S
4005 V
(15430)210 1122 A
(*===========================================================================*/)3276 1482 A
4095 V
(15431)210 1122 A
(PRIVATE)294 1440 A
(unsigned)336 1776 A
(make_break\(scode\))714 2154 A
4185 V
(15432)210 1122 A
(int)126 1440 A
(scode;)252 1608 A
2784(/*)S
(scan)168 2910 A
(code)168 3120 A
3330(of)S
(key)126 3456 A
(just)168 3624 A
(struck)252 3834 A
4128(or)S
(released)336 4254 A
4632(*/)S
4275 V
(15433)210 1122 A
1440({)S
4365 V
(15434)210 1122 A
1440(/*)S
(This)168 1566 A
(routine)294 1776 A
(can)126 2112 A
(handle)252 2280 A
(keyboards)378 2574 A
(that)168 2994 A
(interrupt)378 3204 A
(only)168 3624 A
3834(on)S
(key)126 3960 A
(depression,)462 4128 A
4455 V
(15435)210 1122 A
1482(*)S
1566(as)S
(well)168 1692 A
1902(as)S
(keyboards)378 2028 A
(that)168 2448 A
(interrupt)378 2658 A
3078(on)S
(key)126 3204 A
(depression)420 3372 A
(and)126 3834 A
(key)126 4002 A
(release.)336 4170 A
4545 V
(15436)210 1122 A
1482(*)S
(For)126 1566 A
(efficiency,)462 1734 A
(the)126 2238 A
(interrupt)378 2406 A
(routine)294 2826 A
(filters)294 3162 A
(out)126 3498 A
(most)168 3666 A
(key)126 3876 A
(releases.)378 4044 A
4635 V
(15437)210 1122 A
1482(*/)S
4725 V
(15438)210 1122 A
(int)126 1524 A
(ch,)126 1692 A
(make,)210 1860 A
(escape;)294 2112 A
4815 V
(15439)210 1122 A
(static)252 1524 A
(int)126 1818 A
(CAD_count)378 1986 A
2406(=)S
2490(0;)S
4905 V
(15440)210 1122 A
4995 V
(15441)210 1122 A
1524(/*)S
(Check)210 1650 A
(for)126 1902 A
(CTRL-ALT-DEL,)546 2070 A
(and)126 2658 A
2826(if)S
(found,)252 2952 A
(halt)168 3246 A
(the)126 3456 A
(computer.)378 3624 A
(This)168 4044 A
(would)210 4254 A
5085 V
(15442)210 1122 A
1566(*)S
1650(be)S
(better)252 1776 A
(done)168 2070 A
2280(in)S
(keyboard\(\))420 2406 A
2868(in)S
(case)168 2994 A
(TTY)126 3204 A
3372(is)S
(hung,)210 3498 A
(except)252 3750 A
(control)294 4044 A
(and)126 4380 A
5175 V
(15443)210 1122 A
1566(*)S
(alt)126 1650 A
(are)126 1818 A
(set)126 1986 A
2154(in)S
(the)126 2280 A
(high)168 2448 A
(level)210 2658 A
(code.)210 2910 A
5265 V
(15444)210 1122 A
1566(*/)S
5355 V
(15445)210 1122 A
1524(if)S
(\(ctrl)210 1650 A
1902(&&)S
(alt)126 2028 A
2196(&&)S
(\(scode)252 2322 A
2616(==)S
(DEL_SCAN)336 2742 A
3120(||)S
(scode)210 3246 A
3498(==)S
(INS_SCAN\)\))420 3624 A
5445 V
(15446)210 1122 A
1524({)S
5535 V
(15447)210 1122 A
1776(if)S
(\(++CAD_count)504 1902 A
2448(==)S
2574(3\))S
(sys_abort\(RBT_HALT\);)840 2700 A
5625 V
(15448)210 1122 A
(sys_kill\(INIT_PROC_NR,)924 1776 A
(SIGABRT\);)378 2742 A
5715 V
(15449)210 1122 A
(return)252 1776 A
(-1;)126 2070 A
5805 V
(15450)210 1122 A
1524(})S
5895 V
(15451)210 1122 A
5985 V
(15452)210 1122 A
1524(/*)S
(High-order)420 1650 A
(bit)126 2112 A
(set)126 2280 A
2448(on)S
(key)126 2574 A
(release.)336 2742 A
3120(*/)S
6075 V
(15453)210 1122 A
(make)168 1524 A
1734(=)S
(\(scode)252 1818 A
2112(&)S
(KEY_RELEASE\))504 2196 A
2742(==)S
2868(0;)S
3456(/*)S
(true)168 3582 A
3792(if)S
(pressed)294 3918 A
4254(*/)S
6165 V
(15454)210 1122 A
6255 V
(15455)210 1122 A
1524(ch)S
1650(=)S
(map_key\(scode)546 1734 A
2322(&=)S
(ASCII_MASK\);)504 2448 A
3456(/*)S
(map)126 3582 A
3750(to)S
(ASCII)210 3876 A
4128(*/)S
6345 V
(15456)210 1122 A
6435 V
(15457)210 1122 A
(escape)252 1524 A
1818(=)S
(esc;)168 1902 A
2448(/*)S
(Key)126 2574 A
2742(is)S
(escaped?)336 2868 A
(\(true)210 3288 A
3540(if)S
(added)210 3666 A
(since)210 3918 A
(the)126 4170 A
(XT\))126 4338 A
4506(*/)S
6525 V
(15458)210 1122 A
(esc)126 1524 A
1692(=)S
1776(0;)S
6615 V
(15459)210 1122 A
6705 V
(15460)210 1122 A
(switch)252 1524 A
(\(ch\))168 1818 A
2028({)S
6795 V
(15461)210 1122 A
(case)168 1776 A
(CTRL:)210 1986 A
2784(/*)S
(Left)168 2910 A
3120(or)S
(right)210 3246 A
(control)294 3498 A
(key)126 3834 A
4002(*/)S
6885 V
(15462)210 1122 A
(*\(escape)336 2112 A
2490(?)S
(&ctrl_r)294 2574 A
2910(:)S
(&ctrl_l\))336 2994 A
3372(=)S
(make;)210 3456 A
6975 V
(15463)210 1122 A
(ctrl)168 2112 A
2322(=)S
(ctrl_l)252 2406 A
2700(|)S
(ctrl_r;)294 2784 A
7065 V
(15464)210 1122 A
(break;)252 2112 A
8418 V
EP
%%Page: 204 204
BP
/slant 0 def
/height 0 def
1485 V
12 B
(204)180 1080 A
11 R
2275(File:)S
(drivers/tty/keyboard.c)977 2508 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(15465)210 1122 A
(case)168 1776 A
(SHIFT:)252 1986 A
2784(/*)S
(Left)168 2910 A
3120(or)S
(right)210 3246 A
(shift)210 3498 A
(key)126 3750 A
3918(*/)S
1845 V
(15466)210 1122 A
(*\(scode)294 2112 A
2448(==)S
(RSHIFT_SCAN)462 2574 A
3078(?)S
(&shift_r)336 3162 A
3540(:)S
(&shift_l\))378 3624 A
4044(=)S
(make;)210 4128 A
1935 V
(15467)210 1122 A
(shift)210 2112 A
2364(=)S
(shift_l)294 2448 A
2784(|)S
(shift_r;)336 2868 A
2025 V
(15468)210 1122 A
(break;)252 2112 A
2115 V
(15469)210 1122 A
(case)168 1776 A
(ALT:)168 1986 A
2784(/*)S
(Left)168 2910 A
3120(or)S
(right)210 3246 A
(alt)126 3498 A
(key)126 3666 A
3834(*/)S
2205 V
(15470)210 1122 A
(*\(escape)336 2112 A
2490(?)S
(&alt_r)252 2574 A
2868(:)S
(&alt_l\))294 2952 A
3288(=)S
(make;)210 3372 A
2295 V
(15471)210 1122 A
(alt)126 2112 A
2280(=)S
(alt_l)210 2364 A
2616(|)S
(alt_r;)252 2700 A
2385 V
(15472)210 1122 A
(break;)252 2112 A
2475 V
(15473)210 1122 A
(case)168 1776 A
(CALOCK:)294 1986 A
2784(/*)S
(Caps)168 2910 A
(lock)168 3120 A
3330(-)S
(toggle)252 3414 A
3708(on)S
3834(0)S
3918(->)S
4044(1)S
(transition)420 4128 A
4590(*/)S
2565 V
(15474)210 1122 A
2112(if)S
(\(caps_down)420 2238 A
2700(<)S
(make\))210 2784 A
3036({)S
2655 V
(15475)210 1122 A
(locks[ccurrent])630 2448 A
3120(\303=)S
(CAPS_LOCK;)420 3246 A
2745 V
(15476)210 1122 A
(set_leds\(\);)462 2448 A
2835 V
(15477)210 1122 A
2112(})S
2925 V
(15478)210 1122 A
(caps_down)378 2112 A
2532(=)S
(make;)210 2616 A
3015 V
(15479)210 1122 A
(break;)252 2112 A
3105 V
(15480)210 1122 A
(case)168 1776 A
(NLOCK:)252 1986 A
2784(/*)S
(Num)126 2910 A
(lock)168 3078 A
3288(*/)S
3195 V
(15481)210 1122 A
2112(if)S
(\(num_down)378 2238 A
2658(<)S
(make\))210 2742 A
2994({)S
3285 V
(15482)210 1122 A
(locks[ccurrent])630 2448 A
3120(\303=)S
(NUM_LOCK;)378 3246 A
3375 V
(15483)210 1122 A
(set_leds\(\);)462 2448 A
3465 V
(15484)210 1122 A
2112(})S
3555 V
(15485)210 1122 A
(num_down)336 2112 A
2490(=)S
(make;)210 2574 A
3645 V
(15486)210 1122 A
(break;)252 2112 A
3735 V
(15487)210 1122 A
(case)168 1776 A
(SLOCK:)252 1986 A
2784(/*)S
(Scroll)252 2910 A
(lock)168 3204 A
3414(*/)S
3825 V
(15488)210 1122 A
2112(if)S
(\(scroll_down)504 2238 A
2784(<)S
(make\))210 2868 A
3120({)S
3915 V
(15489)210 1122 A
(locks[ccurrent])630 2448 A
3120(\303=)S
(SCROLL_LOCK;)504 3246 A
4005 V
(15490)210 1122 A
(set_leds\(\);)462 2448 A
4095 V
(15491)210 1122 A
2112(})S
4185 V
(15492)210 1122 A
(scroll_down)462 2112 A
2616(=)S
(make;)210 2700 A
4275 V
(15493)210 1122 A
(break;)252 2112 A
4365 V
(15494)210 1122 A
(case)168 1776 A
(EXTKEY:)294 1986 A
2784(/*)S
(Escape)252 2910 A
(keycode)294 3204 A
3540(*/)S
4455 V
(15495)210 1122 A
(esc)126 2112 A
2280(=)S
2364(1;)S
3120(/*)S
(Next)168 3246 A
(key)126 3456 A
3624(is)S
(escaped)294 3750 A
4086(*/)S
4545 V
(15496)210 1122 A
(return\(-1\);)462 2112 A
4635 V
(15497)210 1122 A
(default:)336 1776 A
2784(/*)S
2910(A)S
(normal)252 2994 A
(key)126 3288 A
3456(*/)S
4725 V
(15498)210 1122 A
2112(if)S
(\(make\))252 2238 A
(return\(ch\);)462 2532 A
4815 V
(15499)210 1122 A
1524(})S
4905 V
(15500)210 1122 A
4995 V
(15501)210 1122 A
1524(/*)S
(Key)126 1650 A
(release,)336 1818 A
2196(or)S
2322(a)S
(shift)210 2406 A
(type)168 2658 A
(key.)168 2868 A
3078(*/)S
5085 V
(15502)210 1122 A
(return\(-1\);)462 1524 A
5175 V
(15503)210 1122 A
1440(})S
5355 V
(15505)210 1122 A
(/*===========================================================================*)3276 1440 A
5445 V
(15506)210 1122 A
1482(*)S
(set_leds)336 2784 A
4674(*)S
5535 V
(15507)210 1122 A
(*===========================================================================*/)3276 1482 A
5625 V
(15508)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(set_leds\(\))420 1986 A
5715 V
(15509)210 1122 A
1440({)S
5805 V
(15510)210 1122 A
1440(/*)S
(Set)126 1566 A
(the)126 1734 A
(LEDs)168 1902 A
2112(on)S
(the)126 2238 A
(caps,)210 2406 A
(num,)168 2658 A
(and)126 2868 A
(scroll)252 3036 A
(lock)168 3330 A
(keys)168 3540 A
3750(*/)S
5895 V
(15511)210 1122 A
(int)126 1524 A
1692(s;)S
5985 V
(15512)210 1122 A
1524(if)S
1650(\(!)S
(machine.pc_at\))588 1776 A
(return;)294 2406 A
2784(/*)S
(PC/XT)210 2910 A
(doesn't)294 3162 A
(have)168 3498 A
(LEDs)168 3708 A
3918(*/)S
6075 V
(15513)210 1122 A
6165 V
(15514)210 1122 A
(kb_wait\(\);)420 1524 A
2784(/*)S
(wait)168 2910 A
(for)126 3120 A
(buffer)252 3288 A
(empty)210 3582 A
3876(*/)S
6255 V
(15515)210 1122 A
1524(if)S
(\(\(s=sys_outb\(KEYBD,)798 1650 A
(LED_CODE\)\))420 2490 A
2952(!=)S
(OK\))126 3078 A
6345 V
(15516)210 1122 A
(printf\("Warning,)672 1692 A
(sys_outb)336 2406 A
(couldn't)336 2784 A
(prepare)294 3162 A
(for)126 3498 A
(LED)126 3666 A
(values:)294 3834 A
(%d\\n",)252 4170 A
(s\);)126 4464 A
6435 V
(15517)210 1122 A
2784(/*)S
(prepare)294 2910 A
(keyboard)336 3246 A
3624(to)S
(accept)252 3750 A
(LED)126 4044 A
(values)252 4212 A
4506(*/)S
6525 V
(15518)210 1122 A
(kb_ack\(\);)378 1524 A
2784(/*)S
(wait)168 2910 A
(for)126 3120 A
(ack)126 3288 A
(response)336 3456 A
3876(*/)S
6615 V
(15519)210 1122 A
6705 V
(15520)210 1122 A
(kb_wait\(\);)420 1524 A
2784(/*)S
(wait)168 2910 A
(for)126 3120 A
(buffer)252 3288 A
(empty)210 3582 A
3876(*/)S
6795 V
(15521)210 1122 A
1524(if)S
(\(\(s=sys_outb\(KEYBD,)798 1650 A
(locks[ccurrent]\)\))714 2490 A
3246(!=)S
(OK\))126 3372 A
6885 V
(15522)210 1122 A
(printf\("Warning,)672 1692 A
(sys_outb)336 2406 A
(couldn't)336 2784 A
(give)168 3162 A
(LED)126 3372 A
(values:)294 3540 A
(%d\\n",)252 3876 A
(s\);)126 4170 A
6975 V
(15523)210 1122 A
2784(/*)S
(give)168 2910 A
(keyboard)336 3120 A
(LED)126 3498 A
(values)252 3666 A
3960(*/)S
7065 V
(15524)210 1122 A
(kb_ack\(\);)378 1524 A
2784(/*)S
(wait)168 2910 A
(for)126 3120 A
(ack)126 3288 A
(response)336 3456 A
3876(*/)S
8418 V
EP
%%Page: 205 205
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2275(File:)S
(drivers/tty/keyboard.c)977 2508 A
12 B
(205)180 4500 A
1755 V
7 LST
(15525)210 1122 A
1440(})S
1935 V
(15527)210 1122 A
(/*===========================================================================*)3276 1440 A
2025 V
(15528)210 1122 A
1482(*)S
(kb_wait)294 2784 A
4674(*)S
2115 V
(15529)210 1122 A
(*===========================================================================*/)3276 1482 A
2205 V
(15530)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(kb_wait\(\))378 1944 A
2295 V
(15531)210 1122 A
1440({)S
2385 V
(15532)210 1122 A
1440(/*)S
(Wait)168 1566 A
(until)210 1776 A
(the)126 2028 A
(controller)420 2196 A
2658(is)S
(ready;)252 2784 A
(return)252 3078 A
(zero)168 3372 A
3582(if)S
(this)168 3708 A
(times)210 3918 A
(out.)168 4170 A
4380(*/)S
2475 V
(15533)210 1122 A
2565 V
(15534)210 1122 A
(int)126 1524 A
(retries,)336 1692 A
(status,)294 2070 A
(temp;)210 2406 A
2655 V
(15535)210 1122 A
(int)126 1524 A
1692(s;)S
2745 V
(15536)210 1122 A
2835 V
(15537)210 1122 A
(retries)294 1524 A
1860(=)S
(MAX_KB_BUSY_RETRIES)798 1944 A
2784(+)S
2868(1;)S
3120(/*)S
(wait)168 3246 A
(until)210 3456 A
(not)126 3708 A
(busy)168 3876 A
4086(*/)S
2925 V
(15538)210 1122 A
1524(do)S
1650({)S
3015 V
(15539)210 1122 A
1692(s)S
1776(=)S
(sys_inb\(KB_STATUS,)756 1860 A
(&status\);)378 2658 A
3105 V
(15540)210 1122 A
1692(if)S
(\(status)294 1818 A
2154(&)S
(KB_OUT_FULL\))504 2238 A
2784({)S
3195 V
(15541)210 1122 A
1860(s)S
1944(=)S
(sys_inb\(KEYBD,)588 2028 A
(&temp\);)294 2658 A
3120(/*)S
(discard)294 3246 A
(value)210 3582 A
3834(*/)S
3285 V
(15542)210 1122 A
1692(})S
3375 V
(15543)210 1122 A
1692(if)S
1818(\(!)S
(\(status)294 1944 A
2280(&)S
(\(KB_IN_FULL|KB_OUT_FULL\)\))1050 2364 A
3456(\))S
3465 V
(15544)210 1122 A
(break;)252 1860 A
3120(/*)S
(wait)168 3246 A
(until)210 3456 A
(ready)210 3708 A
3960(*/)S
3555 V
(15545)210 1122 A
1524(})S
(while)210 1608 A
(\(--retries)420 1860 A
2322(!=)S
(0\);)126 2448 A
3120(/*)S
(continue)336 3246 A
(unless)252 3624 A
(timeout)294 3918 A
4254(*/)S
3645 V
(15546)210 1122 A
(return\(retries\);)672 1524 A
2784(/*)S
(zero)168 2910 A
3120(on)S
(timeout,)336 3246 A
(positive)336 3624 A
4002(if)S
(ready)210 4128 A
4380(*/)S
3735 V
(15547)210 1122 A
1440(})S
3915 V
(15549)210 1122 A
(/*===========================================================================*)3276 1440 A
4005 V
(15550)210 1122 A
1482(*)S
(kb_ack)252 2784 A
4674(*)S
4095 V
(15551)210 1122 A
(*===========================================================================*/)3276 1482 A
4185 V
(15552)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(kb_ack\(\))336 1944 A
4275 V
(15553)210 1122 A
1440({)S
4365 V
(15554)210 1122 A
1440(/*)S
(Wait)168 1566 A
(until)210 1776 A
(kbd)126 2028 A
(acknowledges)504 2196 A
(last)168 2742 A
(command;)336 2952 A
(return)252 3330 A
(zero)168 3624 A
3834(if)S
(this)168 3960 A
(times)210 4170 A
(out.)168 4422 A
4632(*/)S
4455 V
(15555)210 1122 A
4545 V
(15556)210 1122 A
(int)126 1524 A
(retries,)336 1692 A
2070(s;)S
4635 V
(15557)210 1122 A
(u8_t)168 1524 A
(u8val;)252 1734 A
4725 V
(15558)210 1122 A
4815 V
(15559)210 1122 A
(retries)294 1524 A
1860(=)S
(MAX_KB_ACK_RETRIES)756 1944 A
2742(+)S
2826(1;)S
4905 V
(15560)210 1122 A
1524(do)S
1650({)S
4995 V
(15561)210 1122 A
1692(s)S
1776(=)S
(sys_inb\(KEYBD,)588 1860 A
(&u8val\);)336 2490 A
5085 V
(15562)210 1122 A
1692(if)S
(\(u8val)252 1818 A
2112(==)S
(KB_ACK\))294 2238 A
5175 V
(15563)210 1122 A
(break;)252 1860 A
2784(/*)S
(wait)168 2910 A
(for)126 3120 A
(ack)126 3288 A
3456(*/)S
5265 V
(15564)210 1122 A
1524(})S
(while\(--retries)630 1608 A
2280(!=)S
(0\);)126 2406 A
2784(/*)S
(continue)336 2910 A
(unless)252 3288 A
(timeout)294 3582 A
3918(*/)S
5355 V
(15565)210 1122 A
5445 V
(15566)210 1122 A
(return\(retries\);)672 1524 A
2784(/*)S
(nonzero)294 2910 A
3246(if)S
(ack)126 3372 A
(received)336 3540 A
3918(*/)S
5535 V
(15567)210 1122 A
1440(})S
5715 V
(15569)210 1122 A
(/*===========================================================================*)3276 1440 A
5805 V
(15570)210 1122 A
1482(*)S
(kb_init)294 2784 A
4674(*)S
5895 V
(15571)210 1122 A
(*===========================================================================*/)3276 1482 A
5985 V
(15572)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(kb_init\(tp\))462 1944 A
6075 V
(15573)210 1122 A
(tty_t)210 1440 A
(*tp;)168 1692 A
6165 V
(15574)210 1122 A
1440({)S
6255 V
(15575)210 1122 A
1440(/*)S
(Initialize)420 1566 A
(the)126 2028 A
(keyboard)336 2196 A
(driver.)294 2574 A
2910(*/)S
6345 V
(15576)210 1122 A
6435 V
(15577)210 1122 A
(tp->tty_devread)630 1524 A
2196(=)S
(kb_read;)336 2280 A
2784(/*)S
(input)210 2910 A
(function)336 3162 A
3540(*/)S
6525 V
(15578)210 1122 A
1440(})S
6705 V
(15580)210 1122 A
(/*===========================================================================*)3276 1440 A
6795 V
(15581)210 1122 A
1482(*)S
(kb_init_once)504 2784 A
4674(*)S
6885 V
(15582)210 1122 A
(*===========================================================================*/)3276 1482 A
6975 V
(15583)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(kb_init_once\(void\))756 1944 A
7065 V
(15584)210 1122 A
1440({)S
8418 V
EP
%%Page: 206 206
BP
/slant 0 def
/height 0 def
1485 V
12 B
(206)180 1080 A
11 R
2275(File:)S
(drivers/tty/keyboard.c)977 2508 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(15585)210 1122 A
(int)126 1524 A
1692(i;)S
1845 V
(15586)210 1122 A
1935 V
(15587)210 1122 A
(set_leds\(\);)462 1524 A
2784(/*)S
(turn)168 2910 A
(off)126 3120 A
(numlock)294 3288 A
(led)126 3624 A
3792(*/)S
2025 V
(15588)210 1122 A
(scan_keyboard\(\);)672 1524 A
2784(/*)S
(discard)294 2910 A
(leftover)336 3246 A
(keystroke)378 3624 A
4044(*/)S
2115 V
(15589)210 1122 A
2205 V
(15590)210 1122 A
1692(/*)S
(Clear)210 1818 A
(the)126 2070 A
(function)336 2238 A
(key)126 2616 A
(observers)378 2784 A
(array.)252 3204 A
(Also)168 3498 A
(see)126 3708 A
(func_key\(\).)462 3876 A
4380(*/)S
2295 V
(15591)210 1122 A
(for)126 1692 A
(\(i=0;)210 1860 A
(i<12;)210 2112 A
(i++\))168 2364 A
2574({)S
2385 V
(15592)210 1122 A
(fkey_obs[i].proc_nr)798 1860 A
2700(=)S
(NONE;)210 2784 A
3120(/*)S
(F1-F12)252 3246 A
(observers)378 3540 A
3960(*/)S
2475 V
(15593)210 1122 A
(fkey_obs[i].events)756 1860 A
2658(=)S
2742(0;)S
3120(/*)S
(F1-F12)252 3246 A
(observers)378 3540 A
3960(*/)S
2565 V
(15594)210 1122 A
(sfkey_obs[i].proc_nr)840 1860 A
2742(=)S
(NONE;)210 2826 A
3120(/*)S
(Shift)210 3246 A
(F1-F12)252 3498 A
(observers)378 3792 A
4212(*/)S
2655 V
(15595)210 1122 A
(sfkey_obs[i].events)798 1860 A
2700(=)S
2784(0;)S
3120(/*)S
(Shift)210 3246 A
(F1-F12)252 3498 A
(observers)378 3792 A
4212(*/)S
2745 V
(15596)210 1122 A
1692(})S
2835 V
(15597)210 1122 A
2925 V
(15598)210 1122 A
1692(/*)S
(Set)126 1818 A
(interrupt)378 1986 A
(handler)294 2406 A
(and)126 2742 A
(enable)252 2910 A
(keyboard)336 3204 A
(IRQ.)168 3582 A
3792(*/)S
3015 V
(15599)210 1122 A
(irq_hook_id)462 1692 A
2196(=)S
(KEYBOARD_IRQ;)546 2280 A
3120(/*)S
3246(id)S
3372(to)S
3498(be)S
(returned)336 3624 A
4002(on)S
(interrupt)378 4128 A
4548(*/)S
3105 V
(15600)210 1122 A
1692(if)S
(\(\(i=sys_irqsetpolicy\(KEYBOARD_IRQ,)1428 1818 A
(IRQ_REENABLE,)546 3288 A
(&irq_hook_id\)\))588 3876 A
4506(!=)S
(OK\))126 4632 A
3195 V
(15601)210 1122 A
(panic\("TTY",)504 1860 A
("Couldn't)378 2448 A
(set)126 2868 A
(keyboard)336 3036 A
(IRQ)126 3414 A
(policy",)336 3582 A
(i\);)126 3960 A
3285 V
(15602)210 1122 A
1692(if)S
(\(\(i=sys_irqenable\(&irq_hook_id\)\))1344 1818 A
3204(!=)S
(OK\))126 3330 A
3375 V
(15603)210 1122 A
(panic\("TTY",)504 1860 A
("Couldn't)378 2406 A
(enable)252 2826 A
(keyboard)336 3120 A
(IRQs",)252 3498 A
(i\);)126 3792 A
3465 V
(15604)210 1122 A
(kbd_irq_set)462 1692 A
2196(|=)S
2322(\(1)S
2448(<<)S
(KEYBOARD_IRQ\);)588 2574 A
3555 V
(15605)210 1122 A
1440(})S
3735 V
(15607)210 1122 A
(/*===========================================================================*)3276 1440 A
3825 V
(15608)210 1122 A
1482(*)S
(kbd_loadmap)462 2784 A
4674(*)S
3915 V
(15609)210 1122 A
(*===========================================================================*/)3276 1482 A
4005 V
(15610)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(kbd_loadmap\(m\))588 1902 A
4095 V
(15611)210 1122 A
(message)294 1440 A
(*m;)126 1776 A
4185 V
(15612)210 1122 A
1440({)S
4275 V
(15613)210 1122 A
1440(/*)S
(Load)168 1566 A
1776(a)S
(new)126 1860 A
(keymap.)294 2028 A
2364(*/)S
4365 V
(15614)210 1122 A
(int)126 1524 A
(result;)294 1692 A
4455 V
(15615)210 1122 A
(result)252 1524 A
1818(=)S
(sys_vircopy\(m->PROC_NR,)966 1902 A
2910(D,)S
(\(vir_bytes\))462 3036 A
(m->ADDRESS,)462 3540 A
4545 V
(15616)210 1122 A
(SELF,)210 1776 A
2028(D,)S
(\(vir_bytes\))462 2154 A
(keymap,)294 2658 A
4635 V
(15617)210 1122 A
(\(vir_bytes\))462 1776 A
(sizeof\(keymap\)\);)672 2280 A
4725 V
(15618)210 1122 A
(return\(result\);)630 1524 A
4815 V
(15619)210 1122 A
1440(})S
4995 V
(15621)210 1122 A
(/*===========================================================================*)3276 1440 A
5085 V
(15622)210 1122 A
1482(*)S
(do_fkey_ctl)462 2784 A
4674(*)S
5175 V
(15623)210 1122 A
(*===========================================================================*/)3276 1482 A
5265 V
(15624)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(do_fkey_ctl\(m_ptr\))756 1944 A
5355 V
(15625)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(the)126 3372 A
(request)294 3540 A
(message)294 3876 A
4212(*/)S
5445 V
(15626)210 1122 A
1440({)S
5535 V
(15627)210 1122 A
1440(/*)S
(This)168 1566 A
(procedure)378 1776 A
(allows)252 2196 A
(processes)378 2490 A
2910(to)S
(register)336 3036 A
3414(a)S
(function)336 3498 A
(key)126 3876 A
4044(to)S
(receive)294 4170 A
5625 V
(15628)210 1122 A
1482(*)S
(notifications)546 1566 A
2154(if)S
2280(it)S
2406(is)S
(pressed.)336 2532 A
2910(At)S
(most)168 3036 A
(one)126 3246 A
(binding)294 3414 A
(per)126 3750 A
(key)126 3918 A
(can)126 4086 A
(exist.)252 4254 A
5715 V
(15629)210 1122 A
1482(*/)S
5805 V
(15630)210 1122 A
(int)126 1524 A
1692(i;)S
5895 V
(15631)210 1122 A
(int)126 1524 A
(result;)294 1692 A
5985 V
(15632)210 1122 A
6075 V
(15633)210 1122 A
(switch)252 1524 A
(\(m_ptr->FKEY_REQUEST\))882 1818 A
2742({)S
3120(/*)S
(see)126 3246 A
(what)168 3414 A
3624(we)S
(must)168 3750 A
3960(do)S
4086(*/)S
6165 V
(15634)210 1122 A
(case)168 1524 A
(FKEY_MAP:)378 1734 A
3120(/*)S
(request)294 3246 A
(for)126 3582 A
(new)126 3750 A
(mapping)294 3918 A
4254(*/)S
6255 V
(15635)210 1122 A
(result)252 1692 A
1986(=)S
(OK;)126 2070 A
3120(/*)S
(assume)252 3246 A
(everything)420 3540 A
(will)168 4002 A
4212(be)S
(ok*/)168 4338 A
6345 V
(15636)210 1122 A
(for)126 1692 A
(\(i=0;)210 1860 A
2112(i)S
2196(<)S
(12;)126 2280 A
(i++\))168 2448 A
2658({)S
3120(/*)S
(check)210 3246 A
(F1-F12)252 3498 A
(keys)168 3792 A
4002(*/)S
6435 V
(15637)210 1122 A
1860(if)S
(\(bit_isset\(m_ptr->FKEY_FKEYS,)1218 1986 A
(i+1\))168 3246 A
3456(\))S
3540({)S
6525 V
(15638)210 1122 A
2028(if)S
(\(fkey_obs[i].proc_nr)840 2154 A
3036(==)S
(NONE\))210 3162 A
3414({)S
6615 V
(15639)210 1122 A
(fkey_obs[i].proc_nr)798 2196 A
3036(=)S
(m_ptr->m_source;)672 3120 A
6705 V
(15640)210 1122 A
(fkey_obs[i].events)756 2196 A
2994(=)S
3078(0;)S
6795 V
(15641)210 1122 A
(bit_unset\(m_ptr->FKEY_FKEYS,)1176 2196 A
(i+1\);)210 3414 A
6885 V
(15642)210 1122 A
2028(})S
(else)168 2112 A
2322({)S
6975 V
(15643)210 1122 A
(printf\("WARNING,)672 2196 A
(fkey_map)336 2910 A
(failed)252 3288 A
(F%d\\n",)294 3582 A
(i+1\);)210 3918 A
7065 V
(15644)210 1122 A
(result)252 2196 A
2490(=)S
(EBUSY;)252 2574 A
3120(/*)S
(report)252 3246 A
(failure,)336 3540 A
(but)126 3918 A
(try)126 4086 A
(rest)168 4254 A
4464(*/)S
8418 V
EP
%%Page: 207 207
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2275(File:)S
(drivers/tty/keyboard.c)977 2508 A
12 B
(207)180 4500 A
1755 V
7 LST
(15645)210 1122 A
2028(})S
1845 V
(15646)210 1122 A
1860(})S
1935 V
(15647)210 1122 A
1692(})S
2025 V
(15648)210 1122 A
(for)126 1692 A
(\(i=0;)210 1860 A
2112(i)S
2196(<)S
(12;)126 2280 A
(i++\))168 2448 A
2658({)S
3120(/*)S
(check)210 3246 A
(Shift+F1-F12)504 3498 A
(keys)168 4044 A
4254(*/)S
2115 V
(15649)210 1122 A
1860(if)S
(\(bit_isset\(m_ptr->FKEY_SFKEYS,)1260 1986 A
(i+1\))168 3288 A
3498(\))S
3582({)S
2205 V
(15650)210 1122 A
2028(if)S
(\(sfkey_obs[i].proc_nr)882 2154 A
3078(==)S
(NONE\))210 3204 A
3456({)S
2295 V
(15651)210 1122 A
(sfkey_obs[i].proc_nr)840 2196 A
3078(=)S
(m_ptr->m_source;)672 3162 A
2385 V
(15652)210 1122 A
(sfkey_obs[i].events)798 2196 A
3036(=)S
3120(0;)S
2475 V
(15653)210 1122 A
(bit_unset\(m_ptr->FKEY_SFKEYS,)1218 2196 A
(i+1\);)210 3456 A
2565 V
(15654)210 1122 A
2028(})S
(else)168 2112 A
2322({)S
2655 V
(15655)210 1122 A
(printf\("WARNING,)672 2196 A
(fkey_map)336 2910 A
(failed)252 3288 A
(Shift)210 3582 A
(F%d\\n",)294 3834 A
(i+1\);)210 4170 A
2745 V
(15656)210 1122 A
(result)252 2196 A
2490(=)S
(EBUSY;)252 2574 A
3120(/*)S
(report)252 3246 A
(failure)294 3540 A
(but)126 3876 A
(try)126 4044 A
(rest)168 4212 A
4422(*/)S
2835 V
(15657)210 1122 A
2028(})S
2925 V
(15658)210 1122 A
1860(})S
3015 V
(15659)210 1122 A
1692(})S
3105 V
(15660)210 1122 A
(break;)252 1692 A
3195 V
(15661)210 1122 A
(case)168 1524 A
(FKEY_UNMAP:)462 1734 A
3285 V
(15662)210 1122 A
(result)252 1692 A
1986(=)S
(OK;)126 2070 A
3120(/*)S
(assume)252 3246 A
(everything)420 3540 A
(will)168 4002 A
4212(be)S
(ok*/)168 4338 A
3375 V
(15663)210 1122 A
(for)126 1692 A
(\(i=0;)210 1860 A
2112(i)S
2196(<)S
(12;)126 2280 A
(i++\))168 2448 A
2658({)S
3120(/*)S
(check)210 3246 A
(F1-F12)252 3498 A
(keys)168 3792 A
4002(*/)S
3465 V
(15664)210 1122 A
1860(if)S
(\(bit_isset\(m_ptr->FKEY_FKEYS,)1218 1986 A
(i+1\))168 3246 A
3456(\))S
3540({)S
3555 V
(15665)210 1122 A
2028(if)S
(\(fkey_obs[i].proc_nr)840 2154 A
3036(==)S
(m_ptr->m_source\))672 3162 A
3876({)S
3645 V
(15666)210 1122 A
(fkey_obs[i].proc_nr)798 2196 A
3036(=)S
(NONE;)210 3120 A
3735 V
(15667)210 1122 A
(fkey_obs[i].events)756 2196 A
2994(=)S
3078(0;)S
3825 V
(15668)210 1122 A
(bit_unset\(m_ptr->FKEY_FKEYS,)1176 2196 A
(i+1\);)210 3414 A
3915 V
(15669)210 1122 A
2028(})S
(else)168 2112 A
2322({)S
4005 V
(15670)210 1122 A
(result)252 2196 A
2490(=)S
(EPERM;)252 2574 A
3120(/*)S
(report)252 3246 A
(failure,)336 3540 A
(but)126 3918 A
(try)126 4086 A
(rest)168 4254 A
4464(*/)S
4095 V
(15671)210 1122 A
2028(})S
4185 V
(15672)210 1122 A
1860(})S
4275 V
(15673)210 1122 A
1692(})S
4365 V
(15674)210 1122 A
(for)126 1692 A
(\(i=0;)210 1860 A
2112(i)S
2196(<)S
(12;)126 2280 A
(i++\))168 2448 A
2658({)S
3120(/*)S
(check)210 3246 A
(Shift+F1-F12)504 3498 A
(keys)168 4044 A
4254(*/)S
4455 V
(15675)210 1122 A
1860(if)S
(\(bit_isset\(m_ptr->FKEY_SFKEYS,)1260 1986 A
(i+1\))168 3288 A
3498(\))S
3582({)S
4545 V
(15676)210 1122 A
2028(if)S
(\(sfkey_obs[i].proc_nr)882 2154 A
3078(==)S
(m_ptr->m_source\))672 3204 A
3918({)S
4635 V
(15677)210 1122 A
(sfkey_obs[i].proc_nr)840 2196 A
3078(=)S
(NONE;)210 3162 A
4725 V
(15678)210 1122 A
(sfkey_obs[i].events)798 2196 A
3036(=)S
3120(0;)S
4815 V
(15679)210 1122 A
(bit_unset\(m_ptr->FKEY_SFKEYS,)1218 2196 A
(i+1\);)210 3456 A
4905 V
(15680)210 1122 A
2028(})S
(else)168 2112 A
2322({)S
4995 V
(15681)210 1122 A
(result)252 2196 A
2490(=)S
(EPERM;)252 2574 A
3120(/*)S
(report)252 3246 A
(failure,)336 3540 A
(but)126 3918 A
(try)126 4086 A
(rest)168 4254 A
4464(*/)S
5085 V
(15682)210 1122 A
2028(})S
5175 V
(15683)210 1122 A
1860(})S
5265 V
(15684)210 1122 A
1692(})S
5355 V
(15685)210 1122 A
(break;)252 1692 A
5445 V
(15686)210 1122 A
(case)168 1524 A
(FKEY_EVENTS:)504 1734 A
5535 V
(15687)210 1122 A
(m_ptr->FKEY_FKEYS)714 1692 A
2448(=)S
(m_ptr->FKEY_SFKEYS)756 2532 A
3330(=)S
3414(0;)S
5625 V
(15688)210 1122 A
(for)126 1692 A
(\(i=0;)210 1860 A
2112(i)S
2196(<)S
(12;)126 2280 A
(i++\))168 2448 A
2658({)S
3120(/*)S
(check)210 3246 A
(\(Shift+\))336 3498 A
(F1-F12)252 3876 A
(keys)168 4170 A
4380(*/)S
5715 V
(15689)210 1122 A
1860(if)S
(\(fkey_obs[i].proc_nr)840 1986 A
2868(==)S
(m_ptr->m_source\))672 2994 A
3708({)S
5805 V
(15690)210 1122 A
2028(if)S
(\(fkey_obs[i].events\))840 2154 A
3036({)S
5895 V
(15691)210 1122 A
(bit_set\(m_ptr->FKEY_FKEYS,)1092 2196 A
(i+1\);)210 3330 A
5985 V
(15692)210 1122 A
(fkey_obs[i].events)756 2196 A
2994(=)S
3078(0;)S
6075 V
(15693)210 1122 A
2028(})S
6165 V
(15694)210 1122 A
1860(})S
6255 V
(15695)210 1122 A
1860(if)S
(\(sfkey_obs[i].proc_nr)882 1986 A
2910(==)S
(m_ptr->m_source\))672 3036 A
3750({)S
6345 V
(15696)210 1122 A
2028(if)S
(\(sfkey_obs[i].events\))882 2154 A
3078({)S
6435 V
(15697)210 1122 A
(bit_set\(m_ptr->FKEY_SFKEYS,)1134 2196 A
(i+1\);)210 3372 A
6525 V
(15698)210 1122 A
(sfkey_obs[i].events)798 2196 A
3036(=)S
3120(0;)S
6615 V
(15699)210 1122 A
2028(})S
6705 V
(15700)210 1122 A
1860(})S
6795 V
(15701)210 1122 A
1692(})S
6885 V
(15702)210 1122 A
(break;)252 1692 A
6975 V
(15703)210 1122 A
(default:)336 1524 A
7065 V
(15704)210 1122 A
(result)252 1860 A
2154(=)S
(EINVAL;)294 2280 A
3120(/*)S
(key)126 3246 A
(cannot)252 3414 A
3708(be)S
(observed)336 3834 A
4212(*/)S
8418 V
EP
%%Page: 208 208
BP
/slant 0 def
/height 0 def
1485 V
12 B
(208)180 1080 A
11 R
2275(File:)S
(drivers/tty/keyboard.c)977 2508 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(15705)210 1122 A
1524(})S
1845 V
(15706)210 1122 A
1935 V
(15707)210 1122 A
1524(/*)S
(Almost)252 1650 A
(done,)210 1944 A
(return)252 2196 A
(result)252 2490 A
2784(to)S
(caller.)294 2910 A
3246(*/)S
2025 V
(15708)210 1122 A
(m_ptr->m_type)546 1524 A
2112(=)S
(result;)294 2196 A
2115 V
(15709)210 1122 A
(send\(m_ptr->m_source,)882 1524 A
(m_ptr\);)294 2448 A
2205 V
(15710)210 1122 A
1440(})S
2385 V
(15712)210 1122 A
(/*===========================================================================*)3276 1440 A
2475 V
(15713)210 1122 A
1482(*)S
(func_key)336 2784 A
4674(*)S
2565 V
(15714)210 1122 A
(*===========================================================================*/)3276 1482 A
2655 V
(15715)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(func_key\(scode\))630 1944 A
2745 V
(15716)210 1122 A
(int)126 1440 A
(scode;)252 1608 A
2784(/*)S
(scan)168 2910 A
(code)168 3120 A
(for)126 3330 A
3498(a)S
(function)336 3582 A
(key)126 3960 A
4128(*/)S
2835 V
(15717)210 1122 A
1440({)S
2925 V
(15718)210 1122 A
1440(/*)S
(This)168 1566 A
(procedure)378 1776 A
(traps)210 2196 A
(function)336 2448 A
(keys)168 2826 A
(for)126 3036 A
(debugging)378 3204 A
(purposes.)378 3624 A
(Observers)378 4044 A
4464(of)S
3015 V
(15719)210 1122 A
1482(*)S
(function)336 1566 A
(keys)168 1944 A
(are)126 2154 A
(kept)168 2322 A
2532(in)S
2658(a)S
(global)252 2742 A
(array.)252 3036 A
3330(If)S
3456(a)S
(subject)294 3540 A
3876(\(a)S
(key\))168 4002 A
4212(is)S
(pressed)294 4338 A
3105 V
(15720)210 1122 A
1482(*)S
(the)126 1566 A
(observer)336 1734 A
2112(is)S
(notified)336 2238 A
2616(of)S
(the)126 2742 A
(event.)252 2910 A
(Initialization)588 3204 A
3834(of)S
(the)126 3960 A
(arrays)252 4128 A
4422(is)S
(done)168 4548 A
3195 V
(15721)210 1122 A
1482(*)S
1566(in)S
(kb_init,)336 1692 A
(where)210 2070 A
(NONE)168 2322 A
2532(is)S
(set)126 2658 A
2826(to)S
(indicate)336 2952 A
(there)210 3330 A
3582(is)S
3708(no)S
(interest)336 3834 A
4212(in)S
(the)126 4338 A
(key.)168 4506 A
3285 V
(15722)210 1122 A
1482(*)S
(Returns)294 1566 A
(FALSE)210 1902 A
2154(on)S
2280(a)S
(key)126 2364 A
(release)294 2532 A
2868(or)S
2994(if)S
(the)126 3120 A
(key)126 3288 A
3456(is)S
(not)126 3582 A
(observable.)462 3750 A
3375 V
(15723)210 1122 A
1482(*/)S
3465 V
(15724)210 1122 A
(message)294 1524 A
1860(m;)S
3555 V
(15725)210 1122 A
(int)126 1524 A
(key;)168 1692 A
3645 V
(15726)210 1122 A
(int)126 1524 A
(proc_nr;)336 1692 A
3735 V
(15727)210 1122 A
(int)126 1524 A
(i,s;)168 1692 A
3825 V
(15728)210 1122 A
3915 V
(15729)210 1122 A
1524(/*)S
(Ignore)252 1650 A
(key)126 1944 A
(releases.)378 2112 A
2532(If)S
(this)168 2658 A
2868(is)S
2994(a)S
(key)126 3078 A
(press,)252 3246 A
(get)126 3540 A
(full)168 3708 A
(key)126 3918 A
(code.)210 4086 A
4338(*/)S
4005 V
(15730)210 1122 A
1524(if)S
(\(scode)252 1650 A
1944(&)S
(KEY_RELEASE\))504 2028 A
(return\(FALSE\);)588 2574 A
3456(/*)S
(key)126 3582 A
(release)294 3750 A
4086(*/)S
4095 V
(15731)210 1122 A
(key)126 1524 A
1692(=)S
(map_key\(scode\);)630 1776 A
3456(/*)S
(include)294 3582 A
(modifiers)378 3918 A
4338(*/)S
4185 V
(15732)210 1122 A
4275 V
(15733)210 1122 A
1524(/*)S
(Key)126 1650 A
(pressed,)336 1818 A
(now)126 2196 A
(see)126 2364 A
2532(if)S
(there)210 2658 A
2910(is)S
3036(an)S
(observer)336 3162 A
(for)126 3540 A
(the)126 3708 A
(pressed)294 3876 A
(key.)168 4212 A
4365 V
(15734)210 1122 A
1566(*)S
(F1-F12)252 2070 A
(observers)378 2448 A
(are)126 2868 A
3036(in)S
(fkey_obs)336 3162 A
(array.)252 3540 A
4455 V
(15735)210 1122 A
1566(*)S
(SHIFT)210 1776 A
(F1-F12)252 2070 A
(observers)378 2448 A
(are)126 2868 A
3036(in)S
(sfkey_req)378 3162 A
(array.)252 3582 A
4545 V
(15736)210 1122 A
1566(*)S
(CTRL)168 1776 A
(F1-F12)252 2070 A
(reserved)336 2448 A
(\(see)168 2826 A
(kb_read\))336 3036 A
4635 V
(15737)210 1122 A
1566(*)S
(ALT)126 1776 A
(F1-F12)252 2070 A
(reserved)336 2448 A
(\(see)168 2826 A
(kb_read\))336 3036 A
4725 V
(15738)210 1122 A
1566(*)S
(Other)210 1650 A
(combinations)504 1902 A
(are)126 2448 A
(not)126 2616 A
2784(in)S
(use.)168 2910 A
(Note)168 3120 A
(that)168 3330 A
(Alt+Shift+F1-F12)672 3540 A
4254(is)S
(yet)126 4380 A
4815 V
(15739)210 1122 A
1566(*)S
(defined)294 1650 A
1986(in)S
(<minix/keymap.h>,)714 2112 A
(and)126 2868 A
(thus)168 3036 A
3246(is)S
(easy)168 3372 A
(for)126 3582 A
(future)252 3750 A
(extensions.)462 4044 A
4905 V
(15740)210 1122 A
1566(*/)S
4995 V
(15741)210 1122 A
1524(if)S
(\(F1)126 1650 A
1818(<=)S
(key)126 1944 A
2112(&&)S
(key)126 2238 A
2406(<=)S
(F12\))168 2532 A
2742({)S
3456(/*)S
(F1-F12)252 3582 A
3876(*/)S
5085 V
(15742)210 1122 A
(proc_nr)294 1692 A
2028(=)S
(fkey_obs[key)504 2112 A
2658(-)S
(F1].proc_nr;)504 2742 A
5175 V
(15743)210 1122 A
(fkey_obs[key)504 1692 A
2238(-)S
(F1].events)420 2322 A
2784(++)S
2910(;)S
5265 V
(15744)210 1122 A
1524(})S
(else)168 1608 A
1818(if)S
(\(SF1)168 1944 A
2154(<=)S
(key)126 2280 A
2448(&&)S
(key)126 2574 A
2742(<=)S
(SF12\))210 2868 A
3120({)S
3456(/*)S
(Shift)210 3582 A
(F2-F12)252 3834 A
4128(*/)S
5355 V
(15745)210 1122 A
(proc_nr)294 1692 A
2028(=)S
(sfkey_obs[key)546 2112 A
2700(-)S
(SF1].proc_nr;)546 2784 A
5445 V
(15746)210 1122 A
(sfkey_obs[key)546 1692 A
2280(-)S
(SF1].events)462 2364 A
(++;)126 2868 A
5535 V
(15747)210 1122 A
1524(})S
5625 V
(15748)210 1122 A
(else)168 1524 A
1734({)S
5715 V
(15749)210 1122 A
(return\(FALSE\);)588 1692 A
3456(/*)S
(not)126 3582 A
(observable)420 3750 A
4212(*/)S
5805 V
(15750)210 1122 A
1524(})S
5895 V
(15751)210 1122 A
5985 V
(15752)210 1122 A
1524(/*)S
(See)126 1650 A
1818(if)S
1944(an)S
(observer)336 2070 A
2448(is)S
(registered)420 2574 A
(and)126 3036 A
(send)168 3204 A
3414(it)S
3540(a)S
(message.)336 3624 A
4002(*/)S
6075 V
(15753)210 1122 A
1524(if)S
(\(proc_nr)336 1650 A
2028(!=)S
(NONE\))210 2154 A
2406({)S
6165 V
(15754)210 1122 A
(m.NOTIFY_TYPE)546 1692 A
2280(=)S
(FKEY_PRESSED;)546 2364 A
6255 V
(15755)210 1122 A
(notify\(proc_nr\);)672 1692 A
6345 V
(15756)210 1122 A
1524(})S
6435 V
(15757)210 1122 A
(return\(TRUE\);)546 1524 A
6525 V
(15758)210 1122 A
1440(})S
6705 V
(15760)210 1122 A
(/*===========================================================================*)3276 1440 A
6795 V
(15761)210 1122 A
1482(*)S
(show_key_mappings)714 2784 A
4674(*)S
6885 V
(15762)210 1122 A
(*===========================================================================*/)3276 1482 A
6975 V
(15763)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(show_key_mappings\(\))798 1986 A
7065 V
(15764)210 1122 A
1440({)S
8418 V
EP
%%Page: 209 209
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2275(File:)S
(drivers/tty/keyboard.c)977 2508 A
12 B
(209)180 4500 A
1755 V
7 LST
(15765)210 1122 A
(int)126 1608 A
(i,s;)168 1776 A
1845 V
(15766)210 1122 A
(struct)252 1608 A
(proc)168 1902 A
(proc;)210 2112 A
1935 V
(15767)210 1122 A
2025 V
(15768)210 1122 A
(printf\("\\n"\);)546 1608 A
2115 V
(15769)210 1122 A
(printf\("System)588 1608 A
(information.)504 2238 A
(Known)210 2868 A
(function)336 3120 A
(key)126 3498 A
(mappings)336 3666 A
4044(to)S
(request)294 4170 A
(debug)210 4506 A
(dumps:\\n"\);)462 4758 A
2205 V
(15770)210 1122 A
(printf\("-------------------------------------------------------------------------\\n"\);)3612 1608 A
2295 V
(15771)210 1122 A
(for)126 1608 A
(\(i=0;)210 1776 A
(i<12;)210 2028 A
(i++\))168 2280 A
2490({)S
2385 V
(15772)210 1122 A
2475 V
(15773)210 1122 A
(printf\(")336 1692 A
(%sF%d:)252 2070 A
2364(",)S
(i+1<10?)294 2490 A
2826(")S
(":"",)210 2910 A
(i+1\);)210 3162 A
2565 V
(15774)210 1122 A
1692(if)S
(\(fkey_obs[i].proc_nr)840 1818 A
2700(!=)S
(NONE\))210 2826 A
3078({)S
2655 V
(15775)210 1122 A
1860(if)S
(\(\(s=sys_getproc\(&proc,)924 1986 A
(fkey_obs[i].proc_nr\)\)!=OK\))1092 2952 A
2745 V
(15776)210 1122 A
(printf\("sys_getproc:)840 2028 A
(%d\\n",)252 2910 A
(s\);)126 3204 A
2835 V
(15777)210 1122 A
(printf\("%-14.14s",)756 1860 A
(proc.p_name\);)546 2658 A
2925 V
(15778)210 1122 A
1692(})S
(else)168 1776 A
1986({)S
3015 V
(15779)210 1122 A
(printf\("%-14.14s",)756 1860 A
("<none>"\);)420 2658 A
3105 V
(15780)210 1122 A
1692(})S
3195 V
(15781)210 1122 A
3285 V
(15782)210 1122 A
(printf\(")336 1692 A
(%sShift-F%d:)504 2196 A
2742(",)S
(i+1<10?)294 2868 A
3204(")S
(":"",)210 3288 A
(i+1\);)210 3540 A
3375 V
(15783)210 1122 A
1692(if)S
(\(sfkey_obs[i].proc_nr)882 1818 A
2742(!=)S
(NONE\))210 2868 A
3120({)S
3465 V
(15784)210 1122 A
1860(if)S
(\(\(s=sys_getproc\(&proc,)924 1986 A
(sfkey_obs[i].proc_nr\)\)!=OK\))1134 2952 A
3555 V
(15785)210 1122 A
(printf\("sys_getproc:)840 2028 A
(%d\\n",)252 2910 A
(s\);)126 3204 A
3645 V
(15786)210 1122 A
(printf\("%-14.14s",)756 1860 A
(proc.p_name\);)546 2658 A
3735 V
(15787)210 1122 A
1692(})S
(else)168 1776 A
1986({)S
3825 V
(15788)210 1122 A
(printf\("%-14.14s",)756 1860 A
("<none>"\);)420 2658 A
3915 V
(15789)210 1122 A
1692(})S
4005 V
(15790)210 1122 A
(printf\("\\n"\);)546 1692 A
4095 V
(15791)210 1122 A
1608(})S
4185 V
(15792)210 1122 A
(printf\("\\n"\);)546 1608 A
4275 V
(15793)210 1122 A
(printf\("Press)546 1608 A
(one)126 2196 A
2364(of)S
(the)126 2490 A
(registered)420 2658 A
(function)336 3120 A
(keys)168 3498 A
3708(to)S
(trigger)294 3834 A
4170(a)S
(debug)210 4254 A
(dump.\\n"\);)420 4506 A
4365 V
(15794)210 1122 A
(printf\("\\n"\);)546 1608 A
4455 V
(15795)210 1122 A
1440(})S
4635 V
(15797)210 1122 A
(/*===========================================================================*)3276 1440 A
4725 V
(15798)210 1122 A
1482(*)S
(scan_keyboard)546 2784 A
4674(*)S
4815 V
(15799)210 1122 A
(*===========================================================================*/)3276 1482 A
4905 V
(15800)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(scan_keyboard\(\))630 1944 A
4995 V
(15801)210 1122 A
1440({)S
5085 V
(15802)210 1122 A
1440(/*)S
(Fetch)210 1566 A
(the)126 1818 A
(character)378 1986 A
(from)168 2406 A
(the)126 2616 A
(keyboard)336 2784 A
(hardware)336 3162 A
(and)126 3540 A
(acknowledge)462 3708 A
(it.)126 4212 A
4380(*/)S
5175 V
(15803)210 1122 A
(pvb_pair_t)420 1524 A
(byte_in[2],)462 1986 A
(byte_out[2];)504 2490 A
5265 V
(15804)210 1122 A
5355 V
(15805)210 1122 A
(byte_in[0].port)630 1524 A
2196(=)S
(KEYBD;)252 2280 A
2784(/*)S
(get)126 2910 A
(the)126 3078 A
(scan)168 3246 A
(code)168 3456 A
(for)126 3666 A
(the)126 3834 A
(key)126 4002 A
(struck)252 4170 A
4464(*/)S
5445 V
(15806)210 1122 A
(byte_in[1].port)630 1524 A
2196(=)S
(PORT_B;)294 2280 A
2784(/*)S
(strobe)252 2910 A
(the)126 3204 A
(keyboard)336 3372 A
3750(to)S
(ack)126 3876 A
(the)126 4044 A
(char)168 4212 A
4422(*/)S
5535 V
(15807)210 1122 A
(sys_vinb\(byte_in,)714 1524 A
(2\);)126 2280 A
2784(/*)S
(request)294 2910 A
(actual)252 3246 A
(input)210 3540 A
3792(*/)S
5625 V
(15808)210 1122 A
5715 V
(15809)210 1122 A
(pv_set\(byte_out[0],)798 1524 A
(PORT_B,)294 2364 A
(byte_in[1].value)672 2700 A
3414(|)S
(KBIT\);)252 3498 A
3792(/*)S
(strobe)252 3918 A
(bit)126 4212 A
(high)168 4380 A
4590(*/)S
5805 V
(15810)210 1122 A
(pv_set\(byte_out[1],)798 1524 A
(PORT_B,)294 2364 A
(byte_in[1].value\);)756 2700 A
3792(/*)S
(then)168 3918 A
(strobe)252 4128 A
(low)126 4422 A
4590(*/)S
5895 V
(15811)210 1122 A
(sys_voutb\(byte_out,)798 1524 A
(2\);)126 2364 A
2784(/*)S
(request)294 2910 A
(actual)252 3246 A
(output)252 3540 A
3834(*/)S
5985 V
(15812)210 1122 A
6075 V
(15813)210 1122 A
(return\(byte_in[0].value\);)1050 1524 A
3120(/*)S
(return)252 3246 A
(scan)168 3540 A
(code)168 3750 A
3960(*/)S
6165 V
(15814)210 1122 A
1440(})S
6345 V
(15816)210 1122 A
(/*===========================================================================*)3276 1440 A
6435 V
(15817)210 1122 A
1482(*)S
(do_panic_dumps)588 2784 A
4674(*)S
6525 V
(15818)210 1122 A
(*===========================================================================*/)3276 1482 A
6615 V
(15819)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(do_panic_dumps\(m\))714 1944 A
6705 V
(15820)210 1122 A
(message)294 1440 A
(*m;)126 1776 A
2784(/*)S
(request)294 2910 A
(message)294 3246 A
3582(to)S
(TTY)126 3708 A
3876(*/)S
6795 V
(15821)210 1122 A
1440({)S
6885 V
(15822)210 1122 A
1440(/*)S
(Wait)168 1566 A
(for)126 1776 A
(keystrokes)420 1944 A
(for)126 2406 A
(printing)336 2574 A
(debugging)378 2952 A
(info)168 3372 A
(and)126 3582 A
(reboot.)294 3750 A
4086(*/)S
6975 V
(15823)210 1122 A
(int)126 1524 A
(quiet,)252 1692 A
(code;)210 1986 A
7065 V
(15824)210 1122 A
8418 V
EP
%%Page: 210 210
BP
/slant 0 def
/height 0 def
1485 V
12 B
(210)180 1080 A
11 R
2275(File:)S
(drivers/tty/keyboard.c)977 2508 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(15825)210 1122 A
1524(/*)S
1650(A)S
(panic!)252 1734 A
(Allow)210 2028 A
(debug)210 2280 A
(dumps)210 2532 A
(until)210 2784 A
(user)168 3036 A
(wants)210 3246 A
3498(to)S
(shutdown.)378 3624 A
4044(*/)S
1845 V
(15826)210 1122 A
(printf\("\\nHit)546 1524 A
(ESC)126 2112 A
2280(to)S
(reboot,)294 2406 A
(DEL)126 2742 A
2910(to)S
(shutdown,)378 3036 A
(F-keys)252 3456 A
(for)126 3750 A
(debug)210 3918 A
(dumps\\n"\);)420 4170 A
1935 V
(15827)210 1122 A
2025 V
(15828)210 1122 A
(\(void\))252 1524 A
(scan_keyboard\(\);)672 1818 A
2784(/*)S
(ack)126 2910 A
(any)126 3078 A
(old)126 3246 A
(input)210 3414 A
3666(*/)S
2115 V
(15829)210 1122 A
(quiet)210 1524 A
1776(=)S
(scan_keyboard\(\);/*)756 1860 A
(quiescent)378 2658 A
(value)210 3078 A
3330(\(0)S
3456(on)S
(PC,)126 3582 A
(last)168 3750 A
(code)168 3960 A
4170(on)S
(AT\)*/)210 4296 A
2205 V
(15830)210 1122 A
(for)126 1524 A
(\(;;\))168 1692 A
1902({)S
2295 V
(15831)210 1122 A
(tickdelay\(10\);)588 1776 A
2385 V
(15832)210 1122 A
1776(/*)S
(See)126 1902 A
2070(if)S
(there)210 2196 A
(are)126 2448 A
(pending)294 2616 A
(request)294 2952 A
(for)126 3288 A
(output,)294 3456 A
(but)126 3792 A
(don't)210 3960 A
(block.)252 4212 A
2475 V
(15833)210 1122 A
1818(*)S
(Diagnostics)462 1902 A
(can)126 2406 A
(span)168 2574 A
(multiple)336 2784 A
(printf\(\)s,)420 3162 A
3624(so)S
3750(do)S
3876(it)S
4002(in)S
4128(a)S
(loop.)210 4212 A
2565 V
(15834)210 1122 A
1818(*/)S
2655 V
(15835)210 1122 A
(while)210 1776 A
(\(nb_receive\(ANY,)672 2028 A
2742(m\))S
2868(==)S
(OK\))126 2994 A
3162({)S
2745 V
(15836)210 1122 A
(switch\(m->m_type\))714 2112 A
2868({)S
2835 V
(15837)210 1122 A
(case)168 2112 A
(FKEY_CONTROL:)546 2322 A
(do_fkey_ctl\(m\);)630 2910 A
(break;)252 3792 A
2925 V
(15838)210 1122 A
(case)168 2112 A
(SYS_SIG:)336 2322 A
(do_new_kmess\(m\);)672 2910 A
(break;)252 3792 A
3015 V
(15839)210 1122 A
(case)168 2112 A
(DIAGNOSTICS:)504 2322 A
(do_diagnostics\(m\);)756 2910 A
(break;)252 3792 A
3105 V
(15840)210 1122 A
(default:)336 2112 A
2784(;)S
3120(/*)S
3246(do)S
(nothing)294 3372 A
3708(*/)S
3195 V
(15841)210 1122 A
2112(})S
3285 V
(15842)210 1122 A
(tickdelay\(1\);)546 2112 A
3120(/*)S
(allow)210 3246 A
(more)168 3498 A
3708(*/)S
3375 V
(15843)210 1122 A
1776(})S
3465 V
(15844)210 1122 A
(code)168 1776 A
1986(=)S
(scan_keyboard\(\);)672 2070 A
3555 V
(15845)210 1122 A
1776(if)S
(\(code)210 1902 A
2154(!=)S
(quiet\))252 2280 A
2574({)S
3645 V
(15846)210 1122 A
2112(/*)S
2238(A)S
(key)126 2322 A
(has)126 2490 A
(been)168 2658 A
(pressed.)336 2868 A
3246(*/)S
3735 V
(15847)210 1122 A
(switch)252 2112 A
(\(code\))252 2406 A
2700({)S
3456(/*)S
(possibly)336 3582 A
(abort)210 3960 A
(MINIX)210 4212 A
4464(*/)S
3825 V
(15848)210 1122 A
(case)168 2112 A
(ESC_SCAN:)378 2322 A
(sys_abort\(RBT_REBOOT\);)924 2784 A
(return;)294 3792 A
3915 V
(15849)210 1122 A
(case)168 2112 A
(DEL_SCAN:)378 2322 A
(sys_abort\(RBT_HALT\);)840 2784 A
(return;)294 3792 A
4005 V
(15850)210 1122 A
2112(})S
4095 V
(15851)210 1122 A
(\(void\))252 2112 A
(func_key\(code\);)630 2406 A
3456(/*)S
(check)210 3582 A
(for)126 3834 A
(function)336 4002 A
(key)126 4380 A
4548(*/)S
4185 V
(15852)210 1122 A
(quiet)210 2112 A
2364(=)S
(scan_keyboard\(\);)672 2448 A
4275 V
(15853)210 1122 A
1776(})S
4365 V
(15854)210 1122 A
1524(})S
4455 V
(15855)210 1122 A
1440(})S
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(drivers/tty/console.c)882 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(15900)210 1122 A
1440(/*)S
(Code)168 1566 A
(and)126 1776 A
(data)168 1944 A
(for)126 2154 A
(the)126 2322 A
(IBM)126 2490 A
(console)294 2658 A
(driver.)294 2994 A
5445 V
(15901)210 1122 A
1482(*)S
5535 V
(15902)210 1122 A
1482(*)S
(The)126 1566 A
(6845)168 1734 A
(video)210 1944 A
(controller)420 2196 A
(used)168 2658 A
2868(by)S
(the)126 2994 A
(IBM)126 3162 A
3330(PC)S
(shares)252 3456 A
(its)126 3750 A
(video)210 3918 A
(memory)252 4170 A
(with)168 4464 A
5625 V
(15903)210 1122 A
1482(*)S
(the)126 1566 A
(CPU)126 1734 A
(somewhere)378 1902 A
2322(in)S
(the)126 2448 A
(0xB0000)294 2616 A
(memory)252 2952 A
(bank.)210 3246 A
3540(To)S
(the)126 3666 A
(6845)168 3834 A
(this)168 4044 A
(memory)252 4254 A
5715 V
(15904)210 1122 A
1482(*)S
(consists)336 1566 A
1944(of)S
(16-bit)252 2070 A
(words.)252 2364 A
(Each)168 2700 A
(word)168 2910 A
(has)126 3120 A
3288(a)S
(character)378 3372 A
(code)168 3792 A
4002(in)S
(the)126 4128 A
(low)126 4296 A
(byte)168 4464 A
5805 V
(15905)210 1122 A
1482(*)S
(and)126 1566 A
1734(a)S
(so-called)378 1818 A
(attribute)378 2238 A
(byte)168 2658 A
2868(in)S
(the)126 2994 A
(high)168 3162 A
(byte.)210 3372 A
(The)126 3666 A
(CPU)126 3834 A
(directly)336 4002 A
(modifies)336 4380 A
5895 V
(15906)210 1122 A
1482(*)S
(video)210 1566 A
(memory)252 1818 A
2112(to)S
(display)294 2238 A
(characters,)462 2574 A
(and)126 3078 A
(sets)168 3246 A
(two)126 3456 A
(registers)378 3624 A
4044(on)S
(the)126 4170 A
(6845)168 4338 A
(that)168 4548 A
5985 V
(15907)210 1122 A
1482(*)S
(specify)294 1566 A
(the)126 1902 A
(video)210 2070 A
(origin)252 2322 A
(and)126 2616 A
(the)126 2784 A
(cursor)252 2952 A
(position.)378 3246 A
(The)126 3708 A
(video)210 3876 A
(origin)252 4128 A
4422(is)S
(the)126 4548 A
6075 V
(15908)210 1122 A
1482(*)S
(place)210 1566 A
1818(in)S
(video)210 1944 A
(memory)252 2196 A
(where)210 2490 A
(the)126 2742 A
(first)210 2910 A
(character)378 3162 A
(\(upper)252 3582 A
(left)168 3876 A
(corner\))294 4086 A
(can)126 4422 A
6165 V
(15909)210 1122 A
1482(*)S
1566(be)S
(found.)252 1692 A
(Moving)252 2028 A
(the)126 2322 A
(origin)252 2490 A
2784(is)S
2910(a)S
(fast)168 2994 A
(way)126 3204 A
3372(to)S
(scroll)252 3498 A
(the)126 3792 A
(screen.)294 3960 A
(Some)168 4338 A
6255 V
(15910)210 1122 A
1482(*)S
(video)210 1566 A
(adapters)336 1818 A
(wrap)168 2196 A
(around)252 2406 A
(the)126 2700 A
(top)126 2868 A
3036(of)S
(video)210 3162 A
(memory,)294 3414 A
3750(so)S
(the)126 3876 A
(origin)252 4044 A
(can)126 4338 A
6345 V
(15911)210 1122 A
1482(*)S
(move)168 1566 A
(without)294 1776 A
(bounds.)294 2112 A
(For)126 2490 A
(other)210 2658 A
(adapters)336 2910 A
(screen)252 3288 A
(memory)252 3582 A
(must)168 3876 A
(sometimes)378 4086 A
4506(be)S
6435 V
(15912)210 1122 A
1482(*)S
(moved)210 1566 A
1818(to)S
(reset)210 1944 A
(the)126 2196 A
(origin.)294 2364 A
(All)126 2742 A
(computations)504 2910 A
3456(on)S
(video)210 3582 A
(memory)252 3834 A
(use)126 4128 A
(character)378 4296 A
6525 V
(15913)210 1122 A
1482(*)S
(\(word\))252 1566 A
(addresses)378 1860 A
(for)126 2280 A
(simplicity)420 2448 A
(and)126 2910 A
(assume)252 3078 A
(there)210 3372 A
3624(is)S
3750(no)S
(wrapping.)378 3876 A
(The)126 4338 A
6615 V
(15914)210 1122 A
1482(*)S
(assembly)336 1566 A
(support)294 1944 A
(functions)378 2280 A
(translate)378 2700 A
(the)126 3120 A
(word)168 3288 A
(addresses)378 3498 A
3918(to)S
(byte)168 4044 A
(addresses)378 4254 A
6705 V
(15915)210 1122 A
1482(*)S
(and)126 1566 A
(the)126 1734 A
(scrolling)378 1902 A
(function)336 2322 A
(worries)294 2700 A
(about)210 3036 A
(wrapping.)378 3288 A
6795 V
(15916)210 1122 A
1482(*/)S
6885 V
(15917)210 1122 A
6975 V
(15918)210 1122 A
(#include)336 1440 A
("../drivers.h")588 1818 A
7065 V
(15919)210 1122 A
(#include)336 1440 A
(<termios.h>)462 1818 A
8418 V
EP
%%Page: 211 211
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
12 B
(211)180 4500 A
1755 V
7 LST
(15920)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
1845 V
(15921)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
1935 V
(15922)210 1122 A
(#include)336 1440 A
("tty.h")294 1818 A
2025 V
(15923)210 1122 A
2115 V
(15924)210 1122 A
(#include)336 1440 A
("../../kernel/const.h")924 1818 A
2205 V
(15925)210 1122 A
(#include)336 1440 A
("../../kernel/config.h")966 1818 A
2295 V
(15926)210 1122 A
(#include)336 1440 A
("../../kernel/type.h")882 1818 A
2385 V
(15927)210 1122 A
2475 V
(15928)210 1122 A
1440(/*)S
(Definitions)462 1566 A
(used)168 2070 A
2280(by)S
(the)126 2406 A
(console)294 2574 A
(driver.)294 2910 A
3246(*/)S
2565 V
(15929)210 1122 A
(#define)294 1440 A
(MONO_BASE)378 1776 A
(0xB0000L)336 2322 A
2784(/*)S
(base)168 2910 A
3120(of)S
(mono)168 3246 A
(video)210 3456 A
(memory)252 3708 A
4002(*/)S
2655 V
(15930)210 1122 A
(#define)294 1440 A
(COLOR_BASE)420 1776 A
(0xB8000L)336 2322 A
2784(/*)S
(base)168 2910 A
3120(of)S
(color)210 3246 A
(video)210 3498 A
(memory)252 3750 A
4044(*/)S
2745 V
(15931)210 1122 A
(#define)294 1440 A
(MONO_SIZE)378 1776 A
(0x1000)252 2364 A
2784(/*)S
2910(4K)S
(mono)168 3036 A
(video)210 3246 A
(memory)252 3498 A
3792(*/)S
2835 V
(15932)210 1122 A
(#define)294 1440 A
(COLOR_SIZE)420 1776 A
(0x4000)252 2364 A
2784(/*)S
(16K)126 2910 A
(color)210 3078 A
(video)210 3330 A
(memory)252 3582 A
3876(*/)S
2925 V
(15933)210 1122 A
(#define)294 1440 A
(EGA_SIZE)336 1776 A
(0x8000)252 2364 A
2784(/*)S
(EGA)126 2910 A
3078(&)S
(VGA)126 3162 A
(have)168 3330 A
3540(at)S
(least)210 3666 A
(32K)126 3918 A
4086(*/)S
3015 V
(15934)210 1122 A
(#define)294 1440 A
(BLANK_COLOR)462 1776 A
(0x0700)252 2364 A
2784(/*)S
(determines)420 2910 A
(cursor)252 3372 A
(color)210 3666 A
3918(on)S
(blank)210 4044 A
(screen)252 4296 A
4590(*/)S
3105 V
(15935)210 1122 A
(#define)294 1440 A
(SCROLL_UP)378 1776 A
2574(0)S
2784(/*)S
(scroll)252 2910 A
(forward)294 3204 A
3540(*/)S
3195 V
(15936)210 1122 A
(#define)294 1440 A
(SCROLL_DOWN)462 1776 A
2574(1)S
2784(/*)S
(scroll)252 2910 A
(backward)336 3204 A
3582(*/)S
3285 V
(15937)210 1122 A
(#define)294 1440 A
(BLANK_MEM)378 1776 A
(\(\(u16_t)294 2196 A
2532(*\))S
2658(0\))S
2784(/*)S
(tells)210 2910 A
(mem_vid_copy\(\))588 3162 A
3792(to)S
(blank)210 3918 A
(the)126 4170 A
(screen)252 4338 A
4632(*/)S
3375 V
(15938)210 1122 A
(#define)294 1440 A
(CONS_RAM_WORDS)588 1776 A
2532(80)S
2784(/*)S
(video)210 2910 A
(ram)126 3162 A
(buffer)252 3330 A
(size)168 3624 A
3834(*/)S
3465 V
(15939)210 1122 A
(#define)294 1440 A
(MAX_ESC_PARMS)546 1776 A
2574(4)S
2784(/*)S
(number)252 2910 A
3204(of)S
(escape)252 3330 A
(sequence)336 3624 A
(params)252 4002 A
(allowed)294 4296 A
4632(*/)S
3555 V
(15940)210 1122 A
3645 V
(15941)210 1122 A
1440(/*)S
(Constants)378 1566 A
(relating)336 1986 A
2364(to)S
(the)126 2490 A
(controller)420 2658 A
(chips.)252 3120 A
3414(*/)S
3735 V
(15942)210 1122 A
(#define)294 1440 A
(M_6845)252 1776 A
(0x3B4)210 2406 A
2784(/*)S
(port)168 2910 A
(for)126 3120 A
(6845)168 3288 A
(mono)168 3498 A
3708(*/)S
3825 V
(15943)210 1122 A
(#define)294 1440 A
(C_6845)252 1776 A
(0x3D4)210 2406 A
2784(/*)S
(port)168 2910 A
(for)126 3120 A
(6845)168 3288 A
(color)210 3498 A
3750(*/)S
3915 V
(15944)210 1122 A
(#define)294 1440 A
(INDEX)210 1776 A
2574(0)S
2784(/*)S
(6845's)252 2910 A
(index)210 3204 A
(register)336 3456 A
3834(*/)S
4005 V
(15945)210 1122 A
(#define)294 1440 A
(DATA)168 1776 A
2574(1)S
2784(/*)S
(6845's)252 2910 A
(data)168 3204 A
(register)336 3414 A
3792(*/)S
4095 V
(15946)210 1122 A
(#define)294 1440 A
(STATUS)252 1776 A
2574(6)S
2784(/*)S
(6845's)252 2910 A
(status)252 3204 A
(register)336 3498 A
3876(*/)S
4185 V
(15947)210 1122 A
(#define)294 1440 A
(VID_ORG)294 1776 A
2532(12)S
2784(/*)S
(6845's)252 2910 A
(origin)252 3204 A
(register)336 3498 A
3876(*/)S
4275 V
(15948)210 1122 A
(#define)294 1440 A
(CURSOR)252 1776 A
2532(14)S
2784(/*)S
(6845's)252 2910 A
(cursor)252 3204 A
(register)336 3498 A
3876(*/)S
4365 V
(15949)210 1122 A
4455 V
(15950)210 1122 A
1440(/*)S
(Beeper.)294 1566 A
1902(*/)S
4545 V
(15951)210 1122 A
(#define)294 1440 A
(BEEP_FREQ)378 1776 A
(0x0533)252 2364 A
2784(/*)S
(value)210 2910 A
3162(to)S
(put)126 3288 A
(into)168 3456 A
(timer)210 3666 A
3918(to)S
(set)126 4044 A
(beep)168 4212 A
(freq)168 4422 A
4632(*/)S
4635 V
(15952)210 1122 A
(#define)294 1440 A
(B_TIME)252 1776 A
2574(3)S
2784(/*)S
(length)252 2910 A
3204(of)S
(CTRL-G)252 3330 A
(beep)168 3624 A
3834(is)S
(ticks)210 3960 A
4212(*/)S
4725 V
(15953)210 1122 A
4815 V
(15954)210 1122 A
1440(/*)S
(definitions)462 1566 A
(used)168 2070 A
(for)126 2280 A
(font)168 2448 A
(management)420 2658 A
3120(*/)S
4905 V
(15955)210 1122 A
(#define)294 1440 A
(GA_SEQUENCER_INDEX)756 1776 A
(0x3C4)210 2784 A
4995 V
(15956)210 1122 A
(#define)294 1440 A
(GA_SEQUENCER_DATA)714 1776 A
(0x3C5)210 2784 A
5085 V
(15957)210 1122 A
(#define)294 1440 A
(GA_GRAPHICS_INDEX)714 1776 A
(0x3CE)210 2784 A
5175 V
(15958)210 1122 A
(#define)294 1440 A
(GA_GRAPHICS_DATA)672 1776 A
(0x3CF)210 2784 A
5265 V
(15959)210 1122 A
(#define)294 1440 A
(GA_VIDEO_ADDRESS)672 1776 A
(0xA0000L)336 2784 A
5355 V
(15960)210 1122 A
(#define)294 1440 A
(GA_FONT_SIZE)504 1776 A
(8192)168 2784 A
5445 V
(15961)210 1122 A
5535 V
(15962)210 1122 A
1440(/*)S
(Global)252 1566 A
(variables)378 1860 A
(used)168 2280 A
2490(by)S
(the)126 2616 A
(console)294 2784 A
(driver)252 3120 A
(and)126 3414 A
(assembly)336 3582 A
(support.)336 3960 A
4338(*/)S
5625 V
(15963)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(vid_index;)420 1902 A
2784(/*)S
(index)210 2910 A
3162(of)S
(video)210 3288 A
(segment)294 3540 A
3876(in)S
(remote)252 4002 A
(mem)126 4296 A
(map)126 4464 A
4632(*/)S
5715 V
(15964)210 1122 A
(PUBLIC)252 1440 A
(u16_t)210 1734 A
(vid_seg;)336 1986 A
5805 V
(15965)210 1122 A
(PUBLIC)252 1440 A
(vir_bytes)378 1734 A
(vid_off;)336 2154 A
2784(/*)S
(video)210 2910 A
(ram)126 3162 A
3330(is)S
(found)210 3456 A
3708(at)S
(vid_seg:vid_off)630 3834 A
4506(*/)S
5895 V
(15966)210 1122 A
(PUBLIC)252 1440 A
(unsigned)336 1734 A
(vid_size;)378 2112 A
2784(/*)S
(0x2000)252 2910 A
(for)126 3204 A
(color)210 3372 A
3624(or)S
(0x0800)252 3750 A
(for)126 4044 A
(mono)168 4212 A
4422(*/)S
5985 V
(15967)210 1122 A
(PUBLIC)252 1440 A
(unsigned)336 1734 A
(vid_mask;)378 2112 A
2784(/*)S
(0x1FFF)252 2910 A
(for)126 3204 A
(color)210 3372 A
3624(or)S
(0x07FF)252 3750 A
(for)126 4044 A
(mono)168 4212 A
4422(*/)S
6075 V
(15968)210 1122 A
(PUBLIC)252 1440 A
(unsigned)336 1734 A
(blank_color)462 2112 A
2616(=)S
(BLANK_COLOR;)504 2700 A
3246(/*)S
(display)294 3372 A
(code)168 3708 A
(for)126 3918 A
(blank)210 4086 A
4338(*/)S
6165 V
(15969)210 1122 A
6255 V
(15970)210 1122 A
1440(/*)S
(Private)294 1566 A
(variables)378 1902 A
(used)168 2322 A
2532(by)S
(the)126 2658 A
(console)294 2826 A
(driver.)294 3162 A
3498(*/)S
6345 V
(15971)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(vid_port;)378 1944 A
2784(/*)S
(I/O)126 2910 A
(port)168 3078 A
(for)126 3288 A
(accessing)378 3456 A
(6845)168 3876 A
4086(*/)S
6435 V
(15972)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(wrap;)210 1944 A
2784(/*)S
(hardware)336 2910 A
(can)126 3288 A
(wrap?)210 3456 A
3708(*/)S
6525 V
(15973)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(softscroll;)462 1944 A
2784(/*)S
2910(1)S
2994(=)S
(software)336 3078 A
(scrolling,)420 3456 A
3918(0)S
4002(=)S
(hardware)336 4086 A
4464(*/)S
6615 V
(15974)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(beeping;)336 1944 A
2784(/*)S
(speaker)294 2910 A
3246(is)S
(beeping?)336 3372 A
3750(*/)S
6705 V
(15975)210 1122 A
(PRIVATE)294 1440 A
(unsigned)336 1776 A
(font_lines;)462 2154 A
2784(/*)S
(font)168 2910 A
(lines)210 3120 A
(per)126 3372 A
(character)378 3540 A
3960(*/)S
6795 V
(15976)210 1122 A
(PRIVATE)294 1440 A
(unsigned)336 1776 A
(scr_width;)420 2154 A
2784(/*)S
2910(#)S
(characters)420 2994 A
3456(on)S
3582(a)S
(line)168 3666 A
3876(*/)S
6885 V
(15977)210 1122 A
(PRIVATE)294 1440 A
(unsigned)336 1776 A
(scr_lines;)420 2154 A
2784(/*)S
2910(#)S
(lines)210 2994 A
3246(on)S
(the)126 3372 A
(screen)252 3540 A
3834(*/)S
6975 V
(15978)210 1122 A
(PRIVATE)294 1440 A
(unsigned)336 1776 A
(scr_size;)378 2154 A
2784(/*)S
2910(#)S
(characters)420 2994 A
3456(on)S
(the)126 3582 A
(screen)252 3750 A
4044(*/)S
7065 V
(15979)210 1122 A
8418 V
EP
%%Page: 212 212
BP
/slant 0 def
/height 0 def
1485 V
12 B
(212)180 1080 A
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(15980)210 1122 A
1440(/*)S
(Per)126 1566 A
(console)294 1734 A
(data.)210 2070 A
2322(*/)S
1845 V
(15981)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
(console)294 2070 A
2406({)S
1935 V
(15982)210 1122 A
(tty_t)210 1524 A
(*c_tty;)294 1776 A
2784(/*)S
(associated)420 2910 A
(TTY)126 3372 A
(struct)252 3540 A
3834(*/)S
2025 V
(15983)210 1122 A
(int)126 1524 A
(c_column;)378 1692 A
2784(/*)S
(current)294 2910 A
(column)252 3246 A
(number)252 3540 A
(\(0-origin\))420 3834 A
4296(*/)S
2115 V
(15984)210 1122 A
(int)126 1524 A
(c_row;)252 1692 A
2784(/*)S
(current)294 2910 A
(row)126 3246 A
3414(\(0)S
3540(at)S
(top)126 3666 A
3834(of)S
(screen\))294 3960 A
4296(*/)S
2205 V
(15985)210 1122 A
(int)126 1524 A
(c_rwords;)378 1692 A
2784(/*)S
(number)252 2910 A
3204(of)S
(WORDS)210 3330 A
(\(not)168 3582 A
(bytes\))252 3792 A
4086(in)S
(outqueue)336 4212 A
4590(*/)S
2295 V
(15986)210 1122 A
(unsigned)336 1524 A
(c_start;)336 1902 A
2784(/*)S
(start)210 2910 A
3162(of)S
(video)210 3288 A
(memory)252 3540 A
3834(of)S
(this)168 3960 A
(console)294 4170 A
4506(*/)S
2385 V
(15987)210 1122 A
(unsigned)336 1524 A
(c_limit;)336 1902 A
2784(/*)S
(limit)210 2910 A
3162(of)S
(this)168 3288 A
(console's)378 3498 A
(video)210 3918 A
(memory)252 4170 A
4464(*/)S
2475 V
(15988)210 1122 A
(unsigned)336 1524 A
(c_org;)252 1902 A
2784(/*)S
(location)336 2910 A
3288(in)S
(RAM)126 3414 A
(where)210 3582 A
(6845)168 3834 A
(base)168 4044 A
(points)252 4254 A
4548(*/)S
2565 V
(15989)210 1122 A
(unsigned)336 1524 A
(c_cur;)252 1902 A
2784(/*)S
(current)294 2910 A
(position)336 3246 A
3624(of)S
(cursor)252 3750 A
4044(in)S
(video)210 4170 A
(RAM)126 4422 A
4590(*/)S
2655 V
(15990)210 1122 A
(unsigned)336 1524 A
(c_attr;)294 1902 A
2784(/*)S
(character)378 2910 A
(attribute)378 3330 A
3750(*/)S
2745 V
(15991)210 1122 A
(unsigned)336 1524 A
(c_blank;)336 1902 A
2784(/*)S
(blank)210 2910 A
(attribute)378 3162 A
3582(*/)S
2835 V
(15992)210 1122 A
(char)168 1524 A
(c_reverse;)420 1734 A
2784(/*)S
(reverse)294 2910 A
(video)210 3246 A
3498(*/)S
2925 V
(15993)210 1122 A
(char)168 1524 A
(c_esc_state;)504 1734 A
2784(/*)S
(0=normal,)378 2910 A
(1=ESC,)252 3330 A
(2=ESC[)252 3624 A
3918(*/)S
3015 V
(15994)210 1122 A
(char)168 1524 A
(c_esc_intro;)504 1734 A
2784(/*)S
(Distinguishing)588 2910 A
(character)378 3540 A
(following)378 3960 A
(ESC)126 4380 A
4548(*/)S
3105 V
(15995)210 1122 A
(int)126 1524 A
(*c_esc_parmp;)546 1692 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(current)294 3372 A
(escape)252 3708 A
(parameter)378 4002 A
4422(*/)S
3195 V
(15996)210 1122 A
(int)126 1524 A
(c_esc_parmv[MAX_ESC_PARMS];)1134 1692 A
3120(/*)S
(list)168 3246 A
3456(of)S
(escape)252 3582 A
(parameters)420 3876 A
4338(*/)S
3285 V
(15997)210 1122 A
(u16_t)210 1524 A
(c_ramqueue[CONS_RAM_WORDS];)1134 1776 A
3120(/*)S
(buffer)252 3246 A
(for)126 3540 A
(video)210 3708 A
(RAM)126 3960 A
4128(*/)S
3375 V
(15998)210 1122 A
1440(})S
(console_t;)420 1524 A
3465 V
(15999)210 1122 A
3555 V
(16000)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(nr_cons=)336 1944 A
2322(1;)S
2784(/*)S
(actual)252 2910 A
(number)252 3204 A
3498(of)S
(consoles)336 3624 A
4002(*/)S
3645 V
(16001)210 1122 A
(PRIVATE)294 1440 A
(console_t)378 1776 A
(cons_table[NR_CONS];)840 2196 A
3735 V
(16002)210 1122 A
(PRIVATE)294 1440 A
(console_t)378 1776 A
(*curcons;)378 2196 A
2784(/*)S
(currently)378 2910 A
(visible)294 3330 A
3666(*/)S
3825 V
(16003)210 1122 A
3915 V
(16004)210 1122 A
1440(/*)S
(Color)210 1566 A
1818(if)S
(using)210 1944 A
2196(a)S
(color)210 2280 A
(controller.)462 2532 A
3036(*/)S
4005 V
(16005)210 1122 A
(#define)294 1440 A
(color)210 1776 A
(\(vid_port)378 2112 A
2532(==)S
(C_6845\))294 2658 A
4095 V
(16006)210 1122 A
4185 V
(16007)210 1122 A
1440(/*)S
(Map)126 1566 A
(from)168 1734 A
(ANSI)168 1944 A
(colors)252 2154 A
2448(to)S
(the)126 2574 A
(attributes)420 2742 A
(used)168 3204 A
3414(by)S
(the)126 3540 A
3708(PC)S
3834(*/)S
4275 V
(16008)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(ansi_colors[8])588 1944 A
2574(=)S
({0,)126 2658 A
2826(4,)S
2952(2,)S
3078(6,)S
3204(1,)S
3330(5,)S
3456(3,)S
(7};)126 3582 A
4365 V
(16009)210 1122 A
4455 V
(16010)210 1122 A
1440(/*)S
(Structure)378 1566 A
(used)168 1986 A
(for)126 2196 A
(font)168 2364 A
(management)420 2574 A
3036(*/)S
4545 V
(16011)210 1122 A
(struct)252 1440 A
(sequence)336 1734 A
2112({)S
4635 V
(16012)210 1122 A
(unsigned)336 1776 A
(short)210 2154 A
(index;)252 2406 A
4725 V
(16013)210 1122 A
(unsigned)336 1776 A
(char)168 2154 A
(port;)210 2364 A
4815 V
(16014)210 1122 A
(unsigned)336 1776 A
(char)168 2154 A
(value;)252 2364 A
4905 V
(16015)210 1122 A
1440(};)S
4995 V
(16016)210 1122 A
5085 V
(16017)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(cons_write,)462 2448 A
(\(struct)294 2952 A
(tty)126 3288 A
(*tp,)168 3456 A
(int)126 3666 A
(try\))168 3834 A
4464(\);)S
5175 V
(16018)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(cons_echo,)420 2490 A
(\(tty_t)252 2952 A
(*tp,)168 3246 A
(int)126 3456 A
3624(c\))S
4464(\);)S
5265 V
(16019)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(out_char,)378 2490 A
(\(console_t)420 2910 A
(*cons,)252 3372 A
(int)126 3666 A
3834(c\))S
4464(\);)S
5355 V
(16020)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(putk,)210 2490 A
(\(int)168 2742 A
2952(c\))S
4464(\);)S
5445 V
(16021)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(beep,)210 2490 A
(\(void\))252 2742 A
4464(\);)S
5535 V
(16022)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(do_escape,)420 2490 A
(\(console_t)420 2952 A
(*cons,)252 3414 A
(int)126 3708 A
3876(c\))S
4464(\);)S
5625 V
(16023)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(flush,)252 2490 A
(\(console_t)420 2784 A
(*cons\))252 3246 A
4464(\);)S
5715 V
(16024)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(parse_escape,)546 2490 A
(\(console_t)420 3078 A
(*cons,)252 3540 A
(int)126 3834 A
4002(c\))S
4464(\);)S
5805 V
(16025)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(scroll_screen,)588 2490 A
(\(console_t)420 3120 A
(*cons,)252 3582 A
(int)126 3876 A
(dir\))168 4044 A
4464(\);)S
5895 V
(16026)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(set_6845,)378 2490 A
(\(int)168 2910 A
(reg,)168 3120 A
(unsigned)336 3330 A
(val\))168 3708 A
4464(\);)S
5985 V
(16027)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(get_6845,)378 2490 A
(\(int)168 2910 A
(reg,)168 3120 A
(unsigned)336 3330 A
(*val\))210 3708 A
4464(\);)S
6075 V
(16028)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(stop_beep,)420 2490 A
(\(timer_t)336 2952 A
(*tmrp\))252 3330 A
4464(\);)S
6165 V
(16029)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(cons_org0,)420 2490 A
(\(void\))252 2952 A
4464(\);)S
6255 V
(16030)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(ga_program,)462 2448 A
(\(struct)294 2952 A
(sequence)336 3288 A
(*seq\))210 3666 A
4464(\);)S
6345 V
(16031)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(cons_ioctl,)462 2448 A
(\(tty_t)252 2952 A
(*tp,)168 3246 A
(int\))168 3456 A
4464(\);)S
6435 V
(16032)210 1122 A
6525 V
(16033)210 1122 A
(/*===========================================================================*)3276 1440 A
6615 V
(16034)210 1122 A
1482(*)S
(cons_write)420 2784 A
4674(*)S
6705 V
(16035)210 1122 A
(*===========================================================================*/)3276 1482 A
6795 V
(16036)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(cons_write\(tp,)588 1944 A
(try\))168 2574 A
6885 V
(16037)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(tty)126 2112 A
(*tp;)168 2280 A
2784(/*)S
(tells)210 2910 A
(which)210 3162 A
(terminal)336 3414 A
3792(is)S
3918(to)S
4044(be)S
(used)168 4170 A
4380(*/)S
6975 V
(16038)210 1122 A
(int)126 1440 A
(try;)168 1608 A
7065 V
(16039)210 1122 A
1440({)S
8418 V
EP
%%Page: 213 213
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
12 B
(213)180 4500 A
1755 V
7 LST
(16040)210 1122 A
1440(/*)S
(Copy)168 1566 A
1776(as)S
(much)168 1902 A
(data)168 2112 A
2322(as)S
(possible)336 2448 A
2826(to)S
(the)126 2952 A
(output)252 3120 A
(queue,)252 3414 A
(then)168 3708 A
(start)210 3918 A
(I/O.)168 4170 A
4422(On)S
1845 V
(16041)210 1122 A
1482(*)S
(memory-mapped)546 1566 A
(terminals,)420 2154 A
(such)168 2616 A
2826(as)S
(the)126 2952 A
(IBM)126 3120 A
(console,)336 3288 A
(the)126 3666 A
(I/O)126 3834 A
(will)168 4002 A
(also)168 4212 A
4422(be)S
1935 V
(16042)210 1122 A
1482(*)S
(finished,)378 1566 A
(and)126 1986 A
(the)126 2154 A
(counts)252 2322 A
(updated.)336 2616 A
(Keep)168 3036 A
(repeating)378 3246 A
(until)210 3666 A
(all)126 3918 A
(I/O)126 4086 A
(done.)210 4254 A
2025 V
(16043)210 1122 A
1482(*/)S
2115 V
(16044)210 1122 A
2205 V
(16045)210 1122 A
(int)126 1524 A
(count;)252 1692 A
2295 V
(16046)210 1122 A
(int)126 1524 A
(result;)294 1692 A
2385 V
(16047)210 1122 A
(register)336 1524 A
(char)168 1902 A
(*tbuf;)252 2112 A
2475 V
(16048)210 1122 A
(char)168 1524 A
(buf[64];)336 1734 A
2565 V
(16049)210 1122 A
(console_t)378 1524 A
(*cons)210 1944 A
2196(=)S
(tp->tty_priv;)546 2280 A
2655 V
(16050)210 1122 A
2745 V
(16051)210 1122 A
1524(if)S
(\(try\))210 1650 A
(return)252 1902 A
2196(1;)S
2448(/*)S
2574(we)S
(can)126 2700 A
(always)252 2868 A
(write)210 3162 A
3414(to)S
(console)294 3540 A
3876(*/)S
2835 V
(16052)210 1122 A
2925 V
(16053)210 1122 A
1524(/*)S
(Check)210 1650 A
(quickly)294 1902 A
(for)126 2238 A
(nothing)294 2406 A
2742(to)S
(do,)126 2868 A
3036(so)S
(this)168 3162 A
(can)126 3372 A
3540(be)S
(called)252 3666 A
(often)210 3960 A
(without)294 4212 A
3015 V
(16054)210 1122 A
1566(*)S
(unmodular)378 1650 A
(tests)210 2070 A
(elsewhere.)420 2322 A
3105 V
(16055)210 1122 A
1566(*/)S
3195 V
(16056)210 1122 A
1524(if)S
(\(\(count)294 1650 A
1986(=)S
(tp->tty_outleft\))672 2070 A
2784(==)S
2910(0)S
2994(||)S
(tp->tty_inhibited\))756 3120 A
(return;)294 3918 A
3285 V
(16057)210 1122 A
3375 V
(16058)210 1122 A
1524(/*)S
(Copy)168 1650 A
(the)126 1860 A
(user)168 2028 A
(bytes)210 2238 A
2490(to)S
(buf[])210 2616 A
(for)126 2868 A
(decent)252 3036 A
(addressing.)462 3330 A
(Loop)168 3834 A
(over)168 4044 A
(the)126 4254 A
3465 V
(16059)210 1122 A
1566(*)S
(copies,)294 1650 A
(since)210 1986 A
(the)126 2238 A
(user)168 2406 A
(buffer)252 2616 A
(may)126 2910 A
3078(be)S
(much)168 3204 A
(larger)252 3414 A
(than)168 3708 A
(buf[].)252 3918 A
3555 V
(16060)210 1122 A
1566(*/)S
3645 V
(16061)210 1122 A
1524(do)S
1650({)S
3735 V
(16062)210 1122 A
1776(if)S
(\(count)252 1902 A
2196(>)S
(sizeof\(buf\)\))504 2280 A
(count)210 2826 A
3078(=)S
(sizeof\(buf\);)504 3162 A
3825 V
(16063)210 1122 A
1776(if)S
(\(\(result)336 1902 A
2280(=)S
(sys_vircopy\(tp->tty_outproc,)1176 2364 A
3582(D,)S
(tp->tty_out_vir,)672 3708 A
3915 V
(16064)210 1122 A
(SELF,)210 2448 A
2700(D,)S
(\(vir_bytes\))462 2826 A
(buf,)168 3330 A
(\(vir_bytes\))462 3540 A
(count\)\))294 4044 A
4380(!=)S
(OK\))126 4506 A
4005 V
(16065)210 1122 A
(break;)252 2112 A
4095 V
(16066)210 1122 A
(tbuf)168 1776 A
1986(=)S
(buf;)168 2070 A
4185 V
(16067)210 1122 A
4275 V
(16068)210 1122 A
1776(/*)S
(Update)252 1902 A
(terminal)336 2196 A
(data)168 2574 A
(structure.)420 2784 A
3246(*/)S
4365 V
(16069)210 1122 A
(tp->tty_out_vir)630 1776 A
2448(+=)S
(count;)252 2574 A
4455 V
(16070)210 1122 A
(tp->tty_outcum)588 1776 A
2406(+=)S
(count;)252 2532 A
4545 V
(16071)210 1122 A
(tp->tty_outleft)630 1776 A
2448(-=)S
(count;)252 2574 A
4635 V
(16072)210 1122 A
4725 V
(16073)210 1122 A
1776(/*)S
(Output)252 1902 A
(each)168 2196 A
(byte)168 2406 A
2616(of)S
(the)126 2742 A
(copy)168 2910 A
3120(to)S
(the)126 3246 A
(screen.)294 3414 A
(Avoid)210 3792 A
(calling)294 4044 A
4815 V
(16074)210 1122 A
1818(*)S
(out_char\(\))420 1902 A
(for)126 2364 A
(the)126 2532 A
("easy")252 2700 A
(characters,)462 2994 A
(put)126 3498 A
(them)168 3666 A
(into)168 3876 A
(the)126 4086 A
(buffer)252 4254 A
4905 V
(16075)210 1122 A
1818(*)S
(directly.)378 1902 A
4995 V
(16076)210 1122 A
1818(*/)S
5085 V
(16077)210 1122 A
1776(do)S
1902({)S
5175 V
(16078)210 1122 A
2112(if)S
(\(\(unsigned\))462 2238 A
(*tbuf)210 2742 A
2994(<)S
3078(')S
3162(')S
3246(||)S
(cons->c_esc_state)714 3372 A
4128(>)S
4212(0)S
5265 V
(16079)210 1122 A
2448(||)S
(cons->c_column)588 2574 A
3204(>=)S
(scr_width)378 3330 A
5355 V
(16080)210 1122 A
2448(||)S
(cons->c_rwords)588 2574 A
3204(>=)S
(buflen\(cons->c_ramqueue\)\))1050 3330 A
5445 V
(16081)210 1122 A
2112({)S
5535 V
(16082)210 1122 A
(out_char\(cons,)588 2448 A
(*tbuf++\);)378 3078 A
5625 V
(16083)210 1122 A
2112(})S
(else)168 2196 A
2406({)S
5715 V
(16084)210 1122 A
(cons->c_ramqueue[cons->c_rwords++])1428 2448 A
3918(=)S
5805 V
(16085)210 1122 A
(cons->c_attr)504 3120 A
3666(|)S
(\(*tbuf++)336 3750 A
4128(&)S
(BYTE\);)252 4212 A
5895 V
(16086)210 1122 A
(cons->c_column++;)714 2448 A
5985 V
(16087)210 1122 A
2112(})S
6075 V
(16088)210 1122 A
1776(})S
(while)210 1860 A
(\(--count)336 2112 A
2490(!=)S
(0\);)126 2616 A
6165 V
(16089)210 1122 A
1524(})S
(while)210 1608 A
(\(\(count)294 1860 A
2196(=)S
(tp->tty_outleft\))672 2280 A
2994(!=)S
3120(0)S
3204(&&)S
(!tp->tty_inhibited\);)840 3330 A
6255 V
(16090)210 1122 A
6345 V
(16091)210 1122 A
(flush\(cons\);)504 1524 A
2784(/*)S
(transfer)336 2910 A
(anything)336 3288 A
(buffered)336 3666 A
4044(to)S
(the)126 4170 A
(screen)252 4338 A
4632(*/)S
6435 V
(16092)210 1122 A
6525 V
(16093)210 1122 A
1524(/*)S
(Reply)210 1650 A
1902(to)S
(the)126 2028 A
(writer)252 2196 A
2490(if)S
(all)126 2616 A
(output)252 2784 A
3078(is)S
(finished)336 3204 A
3582(or)S
3708(if)S
3834(an)S
(error)210 3960 A
(occured.)336 4212 A
4590(*/)S
6615 V
(16094)210 1122 A
1524(if)S
(\(tp->tty_outleft)672 1650 A
2364(==)S
2490(0)S
2574(||)S
(result)252 2700 A
2994(!=)S
(OK\))126 3120 A
3288({)S
6705 V
(16095)210 1122 A
1776(/*)S
(REVIVE)252 1902 A
2196(is)S
(not)126 2322 A
(possible.)378 2490 A
(I/O)126 2910 A
3078(on)S
(memory)252 3204 A
(mapped)252 3498 A
(consoles)336 3792 A
(finishes.)378 4170 A
4590(*/)S
6795 V
(16096)210 1122 A
(tty_reply\(tp->tty_outrepcode,)1218 1776 A
(tp->tty_outcaller,)756 3036 A
(tp->tty_outproc,)672 3834 A
6885 V
(16097)210 1122 A
(tp->tty_outcum\);)672 3792 A
6975 V
(16098)210 1122 A
(tp->tty_outcum)588 1776 A
2406(=)S
2490(0;)S
7065 V
(16099)210 1122 A
1524(})S
8418 V
EP
%%Page: 214 214
BP
/slant 0 def
/height 0 def
1485 V
12 B
(214)180 1080 A
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(16100)210 1122 A
1440(})S
1935 V
(16102)210 1122 A
(/*===========================================================================*)3276 1440 A
2025 V
(16103)210 1122 A
1482(*)S
(cons_echo)378 2784 A
4674(*)S
2115 V
(16104)210 1122 A
(*===========================================================================*/)3276 1482 A
2205 V
(16105)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(cons_echo\(tp,)546 1986 A
2574(c\))S
2295 V
(16106)210 1122 A
(register)336 1440 A
(tty_t)210 1818 A
(*tp;)168 2070 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(tty)126 3372 A
(struct)252 3540 A
3834(*/)S
2385 V
(16107)210 1122 A
(int)126 1440 A
1608(c;)S
2784(/*)S
(character)378 2910 A
3330(to)S
3456(be)S
(echoed)252 3582 A
3876(*/)S
2475 V
(16108)210 1122 A
1440({)S
2565 V
(16109)210 1122 A
1440(/*)S
(Echo)168 1566 A
(keyboard)336 1776 A
(input)210 2154 A
(\(print)252 2406 A
2700(&)S
(flush\).)294 2784 A
3120(*/)S
2655 V
(16110)210 1122 A
(console_t)378 1524 A
(*cons)210 1944 A
2196(=)S
(tp->tty_priv;)546 2280 A
2745 V
(16111)210 1122 A
2835 V
(16112)210 1122 A
(out_char\(cons,)588 1524 A
(c\);)126 2154 A
2925 V
(16113)210 1122 A
(flush\(cons\);)504 1524 A
3015 V
(16114)210 1122 A
1440(})S
3195 V
(16116)210 1122 A
(/*===========================================================================*)3276 1440 A
3285 V
(16117)210 1122 A
1482(*)S
(out_char)336 2784 A
4674(*)S
3375 V
(16118)210 1122 A
(*===========================================================================*/)3276 1482 A
3465 V
(16119)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(out_char\(cons,)588 1986 A
2616(c\))S
3555 V
(16120)210 1122 A
(register)336 1440 A
(console_t)378 1818 A
(*cons;)252 2238 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(console)294 3372 A
(struct)252 3708 A
4002(*/)S
3645 V
(16121)210 1122 A
(int)126 1440 A
1608(c;)S
2784(/*)S
(character)378 2910 A
3330(to)S
3456(be)S
(output)252 3582 A
3876(*/)S
3735 V
(16122)210 1122 A
1440({)S
3825 V
(16123)210 1122 A
1440(/*)S
(Output)252 1566 A
1860(a)S
(character)378 1944 A
2364(on)S
(the)126 2490 A
(console.)336 2658 A
(Check)210 3078 A
(for)126 3330 A
(escape)252 3498 A
(sequences)378 3792 A
(first.)252 4212 A
4506(*/)S
3915 V
(16124)210 1122 A
1524(if)S
(\(cons->c_esc_state)756 1650 A
2448(>)S
2532(0\))S
2658({)S
4005 V
(16125)210 1122 A
(parse_escape\(cons,)756 1776 A
(c\);)126 2574 A
4095 V
(16126)210 1122 A
(return;)294 1776 A
4185 V
(16127)210 1122 A
1524(})S
4275 V
(16128)210 1122 A
4365 V
(16129)210 1122 A
(switch\(c\))378 1524 A
1944({)S
4455 V
(16130)210 1122 A
(case)168 1776 A
(000:)168 1986 A
2784(/*)S
(null)168 2910 A
3120(is)S
(typically)378 3246 A
(used)168 3666 A
(for)126 3876 A
(padding)294 4044 A
4380(*/)S
4545 V
(16131)210 1122 A
(return;)294 2112 A
2784(/*)S
(better)252 2910 A
(not)126 3204 A
3372(do)S
(anything)336 3498 A
3876(*/)S
4635 V
(16132)210 1122 A
4725 V
(16133)210 1122 A
(case)168 1776 A
(007:)168 1986 A
2784(/*)S
(ring)168 2910 A
(the)126 3120 A
(bell)168 3288 A
3498(*/)S
4815 V
(16134)210 1122 A
(flush\(cons\);)504 2112 A
2784(/*)S
(print)210 2910 A
(any)126 3162 A
(chars)210 3330 A
(queued)252 3582 A
(for)126 3876 A
(output)252 4044 A
4338(*/)S
4905 V
(16135)210 1122 A
(beep\(\);)294 2112 A
4995 V
(16136)210 1122 A
(return;)294 2112 A
5085 V
(16137)210 1122 A
5175 V
(16138)210 1122 A
(case)168 1776 A
('\\b':)210 1986 A
2784(/*)S
(backspace)378 2910 A
3330(*/)S
5265 V
(16139)210 1122 A
2112(if)S
(\(--cons->c_column)714 2238 A
2994(<)S
3078(0\))S
3204({)S
5355 V
(16140)210 1122 A
2448(if)S
(\(--cons->c_row)588 2574 A
3204(>=)S
3330(0\))S
(cons->c_column)588 3456 A
4086(+=)S
(scr_width;)420 4212 A
5445 V
(16141)210 1122 A
2112(})S
5535 V
(16142)210 1122 A
(flush\(cons\);)504 2112 A
5625 V
(16143)210 1122 A
(return;)294 2112 A
5715 V
(16144)210 1122 A
5805 V
(16145)210 1122 A
(case)168 1776 A
('\\n':)210 1986 A
2784(/*)S
(line)168 2910 A
(feed)168 3120 A
3330(*/)S
5895 V
(16146)210 1122 A
2112(if)S
(\(\(cons->c_tty->tty_termios.c_oflag)1428 2238 A
3708(&)S
(\(OPOST|ONLCR\)\))588 3792 A
5985 V
(16147)210 1122 A
3456(==)S
(\(OPOST|ONLCR\)\))588 3582 A
4212({)S
6075 V
(16148)210 1122 A
(cons->c_column)588 2448 A
3078(=)S
3162(0;)S
6165 V
(16149)210 1122 A
2112(})S
6255 V
(16150)210 1122 A
(/*FALL)252 2112 A
(THROUGH*/)378 2406 A
6345 V
(16151)210 1122 A
(case)168 1776 A
(013:)168 1986 A
2784(/*)S
(CTRL-K)252 2910 A
3204(*/)S
6435 V
(16152)210 1122 A
(case)168 1776 A
(014:)168 1986 A
2784(/*)S
(CTRL-L)252 2910 A
3204(*/)S
6525 V
(16153)210 1122 A
2112(if)S
(\(cons->c_row)504 2238 A
2784(==)S
(scr_lines-1\))504 2910 A
3456({)S
6615 V
(16154)210 1122 A
(scroll_screen\(cons,)798 2448 A
(SCROLL_UP\);)462 3288 A
6705 V
(16155)210 1122 A
2112(})S
(else)168 2196 A
2406({)S
6795 V
(16156)210 1122 A
(cons->c_row++;)588 2448 A
6885 V
(16157)210 1122 A
2112(})S
6975 V
(16158)210 1122 A
(flush\(cons\);)504 2112 A
7065 V
(16159)210 1122 A
(return;)294 2112 A
8418 V
EP
%%Page: 215 215
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
12 B
(215)180 4500 A
1755 V
7 LST
(16160)210 1122 A
1845 V
(16161)210 1122 A
(case)168 1776 A
('\\r':)210 1986 A
2784(/*)S
(carriage)336 2910 A
(return)252 3288 A
3582(*/)S
1935 V
(16162)210 1122 A
(cons->c_column)588 2112 A
2742(=)S
2826(0;)S
2025 V
(16163)210 1122 A
(flush\(cons\);)504 2112 A
2115 V
(16164)210 1122 A
(return;)294 2112 A
2205 V
(16165)210 1122 A
2295 V
(16166)210 1122 A
(case)168 1776 A
('\\t':)210 1986 A
2784(/*)S
(tab)126 2910 A
3078(*/)S
2385 V
(16167)210 1122 A
(cons->c_column)588 2112 A
2742(=)S
(\(cons->c_column)630 2826 A
3498(+)S
(TAB_SIZE\))378 3582 A
4002(&)S
(\304TAB_MASK;)420 4086 A
2475 V
(16168)210 1122 A
2112(if)S
(\(cons->c_column)630 2238 A
2910(>)S
(scr_width\))420 2994 A
3456({)S
2565 V
(16169)210 1122 A
(cons->c_column)588 2448 A
3078(-=)S
(scr_width;)420 3204 A
2655 V
(16170)210 1122 A
2448(if)S
(\(cons->c_row)504 2574 A
3120(==)S
(scr_lines-1\))504 3246 A
3792({)S
2745 V
(16171)210 1122 A
(scroll_screen\(cons,)798 2784 A
(SCROLL_UP\);)462 3624 A
2835 V
(16172)210 1122 A
2448(})S
(else)168 2532 A
2742({)S
2925 V
(16173)210 1122 A
(cons->c_row++;)588 2784 A
3015 V
(16174)210 1122 A
2448(})S
3105 V
(16175)210 1122 A
2112(})S
3195 V
(16176)210 1122 A
(flush\(cons\);)504 2112 A
3285 V
(16177)210 1122 A
(return;)294 2112 A
3375 V
(16178)210 1122 A
3465 V
(16179)210 1122 A
(case)168 1776 A
(033:)168 1986 A
2784(/*)S
(ESC)126 2910 A
3078(-)S
(start)210 3162 A
3414(of)S
3540(an)S
(escape)252 3666 A
(sequence)336 3960 A
4338(*/)S
3555 V
(16180)210 1122 A
(flush\(cons\);)504 2112 A
2784(/*)S
(print)210 2910 A
(any)126 3162 A
(chars)210 3330 A
(queued)252 3582 A
(for)126 3876 A
(output)252 4044 A
4338(*/)S
3645 V
(16181)210 1122 A
(cons->c_esc_state)714 2112 A
2868(=)S
2952(1;)S
3120(/*)S
(mark)168 3246 A
(ESC)126 3456 A
3624(as)S
(seen)168 3750 A
3960(*/)S
3735 V
(16182)210 1122 A
(return;)294 2112 A
3825 V
(16183)210 1122 A
3915 V
(16184)210 1122 A
(default:)336 1776 A
2784(/*)S
(printable)378 2910 A
(chars)210 3330 A
(are)126 3582 A
(stored)252 3750 A
4044(in)S
(ramqueue)336 4170 A
4548(*/)S
4005 V
(16185)210 1122 A
2112(if)S
(\(cons->c_column)630 2238 A
2910(>=)S
(scr_width\))420 3036 A
3498({)S
4095 V
(16186)210 1122 A
2448(if)S
(\(!LINEWRAP\))462 2574 A
(return;)294 3078 A
4185 V
(16187)210 1122 A
2448(if)S
(\(cons->c_row)504 2574 A
3120(==)S
(scr_lines-1\))504 3246 A
3792({)S
4275 V
(16188)210 1122 A
(scroll_screen\(cons,)798 2784 A
(SCROLL_UP\);)462 3624 A
4365 V
(16189)210 1122 A
2448(})S
(else)168 2532 A
2742({)S
4455 V
(16190)210 1122 A
(cons->c_row++;)588 2784 A
4545 V
(16191)210 1122 A
2448(})S
4635 V
(16192)210 1122 A
(cons->c_column)588 2448 A
3078(=)S
3162(0;)S
4725 V
(16193)210 1122 A
(flush\(cons\);)504 2448 A
4815 V
(16194)210 1122 A
2112(})S
4905 V
(16195)210 1122 A
2112(if)S
(\(cons->c_rwords)630 2238 A
2910(==)S
(buflen\(cons->c_ramqueue\)\))1050 3036 A
(flush\(cons\);)504 4128 A
4995 V
(16196)210 1122 A
(cons->c_ramqueue[cons->c_rwords++])1428 2112 A
3582(=)S
(cons->c_attr)504 3666 A
4212(|)S
4296(\(c)S
4422(&)S
(BYTE\);)252 4506 A
5085 V
(16197)210 1122 A
(cons->c_column++;)714 2112 A
3792(/*)S
(next)168 3918 A
(column)252 4128 A
4422(*/)S
5175 V
(16198)210 1122 A
(return;)294 2112 A
5265 V
(16199)210 1122 A
1524(})S
5355 V
(16200)210 1122 A
1440(})S
5535 V
(16202)210 1122 A
(/*===========================================================================*)3276 1440 A
5625 V
(16203)210 1122 A
1482(*)S
(scroll_screen)546 2784 A
4674(*)S
5715 V
(16204)210 1122 A
(*===========================================================================*/)3276 1482 A
5805 V
(16205)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(scroll_screen\(cons,)798 1986 A
(dir\))168 2826 A
5895 V
(16206)210 1122 A
(register)336 1440 A
(console_t)378 1818 A
(*cons;)252 2238 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(console)294 3372 A
(struct)252 3708 A
4002(*/)S
5985 V
(16207)210 1122 A
(int)126 1440 A
(dir;)168 1608 A
2784(/*)S
(SCROLL_UP)378 2910 A
3330(or)S
(SCROLL_DOWN)462 3456 A
3960(*/)S
6075 V
(16208)210 1122 A
1440({)S
6165 V
(16209)210 1122 A
(unsigned)336 1524 A
(new_line,)378 1902 A
(new_org,)336 2322 A
(chars;)252 2700 A
6255 V
(16210)210 1122 A
6345 V
(16211)210 1122 A
(flush\(cons\);)504 1524 A
6435 V
(16212)210 1122 A
(chars)210 1524 A
1776(=)S
(scr_size)336 1860 A
2238(-)S
(scr_width;)420 2322 A
3120(/*)S
(one)126 3246 A
(screen)252 3414 A
(minus)210 3708 A
(one)126 3960 A
(line)168 4128 A
4338(*/)S
6525 V
(16213)210 1122 A
6615 V
(16214)210 1122 A
1524(/*)S
(Scrolling)378 1650 A
(the)126 2070 A
(screen)252 2238 A
2532(is)S
2658(a)S
(real)168 2742 A
(nuisance)336 2952 A
(due)126 3330 A
3498(to)S
(the)126 3624 A
(various)294 3792 A
(incompatible)504 4128 A
6705 V
(16215)210 1122 A
1566(*)S
(video)210 1650 A
(cards.)252 1902 A
(This)168 2238 A
(driver)252 2448 A
(supports)336 2742 A
(software)336 3120 A
(scrolling)378 3498 A
(\(Hercules?\),)504 3918 A
6795 V
(16216)210 1122 A
1566(*)S
(hardware)336 1650 A
(scrolling)378 2028 A
(\(mono)210 2448 A
(and)126 2700 A
(CGA)126 2868 A
(cards\))252 3036 A
(and)126 3330 A
(hardware)336 3498 A
(scrolling)378 3876 A
(without)294 4296 A
6885 V
(16217)210 1122 A
1566(*)S
(wrapping)336 1650 A
(\(EGA)168 2028 A
(cards\).)294 2238 A
2616(In)S
(the)126 2742 A
(latter)252 2910 A
(case)168 3204 A
3414(we)S
(must)168 3540 A
(make)168 3750 A
(sure)168 3960 A
(that)168 4170 A
6975 V
(16218)210 1122 A
1566(*)S
(c_start)294 2112 A
2448(<=)S
(c_org)210 2574 A
2826(&&)S
(c_org)210 2952 A
3204(+)S
(scr_size)336 3288 A
3666(<=)S
(c_limit)294 3792 A
7065 V
(16219)210 1122 A
1566(*)S
(holds,)252 1650 A
(because)294 1944 A
(EGA)126 2280 A
(doesn't)294 2448 A
(wrap)168 2784 A
(around)252 2994 A
(the)126 3288 A
(end)126 3456 A
3624(of)S
(video)210 3750 A
(memory.)294 4002 A
8418 V
EP
%%Page: 216 216
BP
/slant 0 def
/height 0 def
1485 V
12 B
(216)180 1080 A
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(16220)210 1122 A
1566(*/)S
1845 V
(16221)210 1122 A
1524(if)S
(\(dir)168 1650 A
1860(==)S
(SCROLL_UP\))420 1986 A
2448({)S
1935 V
(16222)210 1122 A
1776(/*)S
(Scroll)252 1902 A
(one)126 2196 A
(line)168 2364 A
2574(up)S
2700(in)S
2826(3)S
(ways:)210 2910 A
(soft,)210 3162 A
(avoid)210 3414 A
(wrap,)210 3666 A
(use)126 3918 A
(origin.)294 4086 A
4422(*/)S
2025 V
(16223)210 1122 A
1776(if)S
(\(softscroll\))504 1902 A
2448({)S
2115 V
(16224)210 1122 A
(vid_vid_copy\(cons->c_start)1092 2112 A
3246(+)S
(scr_width,)420 3330 A
(cons->c_start,)588 3792 A
(chars\);)294 4422 A
2205 V
(16225)210 1122 A
1776(})S
(else)168 1860 A
2295 V
(16226)210 1122 A
1776(if)S
(\(!wrap)252 1902 A
2196(&&)S
(cons->c_org)462 2322 A
2826(+)S
(scr_size)336 2910 A
3288(+)S
(scr_width)378 3372 A
3792(>=)S
(cons->c_limit\))588 3918 A
4548({)S
2385 V
(16227)210 1122 A
(vid_vid_copy\(cons->c_org)1008 2112 A
3162(+)S
(scr_width,)420 3246 A
(cons->c_start,)588 3708 A
(chars\);)294 4338 A
2475 V
(16228)210 1122 A
(cons->c_org)462 2112 A
2616(=)S
(cons->c_start;)588 2700 A
2565 V
(16229)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
2655 V
(16230)210 1122 A
(cons->c_org)462 2112 A
2616(=)S
(\(cons->c_org)504 2700 A
3246(+)S
(scr_width\))420 3330 A
3792(&)S
(vid_mask;)378 3876 A
2745 V
(16231)210 1122 A
1776(})S
2835 V
(16232)210 1122 A
(new_line)336 1776 A
2154(=)S
(\(cons->c_org)504 2238 A
2784(+)S
(chars\))252 2868 A
3162(&)S
(vid_mask;)378 3246 A
2925 V
(16233)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3015 V
(16234)210 1122 A
1776(/*)S
(Scroll)252 1902 A
(one)126 2196 A
(line)168 2364 A
(down)168 2574 A
2784(in)S
2910(3)S
(ways:)210 2994 A
(soft,)210 3246 A
(avoid)210 3498 A
(wrap,)210 3750 A
(use)126 4002 A
(origin.)294 4170 A
4506(*/)S
3105 V
(16235)210 1122 A
1776(if)S
(\(softscroll\))504 1902 A
2448({)S
3195 V
(16236)210 1122 A
(vid_vid_copy\(cons->c_start,)1134 2112 A
(cons->c_start)546 3288 A
3876(+)S
(scr_width,)420 3960 A
(chars\);)294 4422 A
3285 V
(16237)210 1122 A
1776(})S
(else)168 1860 A
3375 V
(16238)210 1122 A
1776(if)S
(\(!wrap)252 1902 A
2196(&&)S
(cons->c_org)462 2322 A
2826(<)S
(cons->c_start)546 2910 A
3498(+)S
(scr_width\))420 3582 A
4044({)S
3465 V
(16239)210 1122 A
(new_org)294 2112 A
2448(=)S
(cons->c_limit)546 2532 A
3120(-)S
(scr_size;)378 3204 A
3555 V
(16240)210 1122 A
(vid_vid_copy\(cons->c_org,)1050 2112 A
(new_org)294 3204 A
3540(+)S
(scr_width,)420 3624 A
(chars\);)294 4086 A
3645 V
(16241)210 1122 A
(cons->c_org)462 2112 A
2616(=)S
(new_org;)336 2700 A
3735 V
(16242)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
3825 V
(16243)210 1122 A
(cons->c_org)462 2112 A
2616(=)S
(\(cons->c_org)504 2700 A
3246(-)S
(scr_width\))420 3330 A
3792(&)S
(vid_mask;)378 3876 A
3915 V
(16244)210 1122 A
1776(})S
4005 V
(16245)210 1122 A
(new_line)336 1776 A
2154(=)S
(cons->c_org;)504 2238 A
4095 V
(16246)210 1122 A
1524(})S
4185 V
(16247)210 1122 A
1524(/*)S
(Blank)210 1650 A
(the)126 1902 A
(new)126 2070 A
(line)168 2238 A
2448(at)S
(top)126 2574 A
2742(or)S
(bottom.)294 2868 A
3204(*/)S
4275 V
(16248)210 1122 A
(blank_color)462 1524 A
2028(=)S
(cons->c_blank;)588 2112 A
4365 V
(16249)210 1122 A
(mem_vid_copy\(BLANK_MEM,)966 1524 A
(new_line,)378 2532 A
(scr_width\);)462 2952 A
4455 V
(16250)210 1122 A
4545 V
(16251)210 1122 A
1524(/*)S
(Set)126 1650 A
(the)126 1818 A
(new)126 1986 A
(video)210 2154 A
(origin.)294 2406 A
2742(*/)S
4635 V
(16252)210 1122 A
1524(if)S
(\(cons)210 1650 A
1902(==)S
(curcons\))336 2028 A
(set_6845\(VID_ORG,)714 2406 A
(cons->c_org\);)546 3162 A
4725 V
(16253)210 1122 A
(flush\(cons\);)504 1524 A
4815 V
(16254)210 1122 A
1440(})S
4995 V
(16256)210 1122 A
(/*===========================================================================*)3276 1440 A
5085 V
(16257)210 1122 A
1482(*)S
(flush)210 2784 A
4674(*)S
5175 V
(16258)210 1122 A
(*===========================================================================*/)3276 1482 A
5265 V
(16259)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(flush\(cons\))462 1986 A
5355 V
(16260)210 1122 A
(register)336 1440 A
(console_t)378 1818 A
(*cons;)252 2238 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(console)294 3372 A
(struct)252 3708 A
4002(*/)S
5445 V
(16261)210 1122 A
1440({)S
5535 V
(16262)210 1122 A
1440(/*)S
(Send)168 1566 A
(characters)420 1776 A
(buffered)336 2238 A
2616(in)S
('ramqueue')420 2742 A
3204(to)S
(screen)252 3330 A
(memory,)294 3624 A
(check)210 3960 A
(the)126 4212 A
(new)126 4380 A
5625 V
(16263)210 1122 A
1482(*)S
(cursor)252 1566 A
(position,)378 1860 A
(compute)294 2280 A
(the)126 2616 A
(new)126 2784 A
(hardware)336 2952 A
(cursor)252 3330 A
(position)336 3624 A
(and)126 4002 A
(set)126 4170 A
(it.)126 4338 A
5715 V
(16264)210 1122 A
1482(*/)S
5805 V
(16265)210 1122 A
(unsigned)336 1524 A
(cur;)168 1902 A
5895 V
(16266)210 1122 A
(tty_t)210 1524 A
(*tp)126 1776 A
1944(=)S
(cons->c_tty;)504 2028 A
5985 V
(16267)210 1122 A
6075 V
(16268)210 1122 A
1524(/*)S
(Have)168 1650 A
(the)126 1860 A
(characters)420 2028 A
2490(in)S
('ramqueue')420 2616 A
(transferred)462 3078 A
3582(to)S
(the)126 3708 A
(screen.)294 3876 A
4212(*/)S
6165 V
(16269)210 1122 A
1524(if)S
(\(cons->c_rwords)630 1650 A
2322(>)S
2406(0\))S
2532({)S
6255 V
(16270)210 1122 A
(mem_vid_copy\(cons->c_ramqueue,)1260 1776 A
(cons->c_cur,)504 3078 A
(cons->c_rwords\);)672 3624 A
6345 V
(16271)210 1122 A
(cons->c_rwords)588 1776 A
2406(=)S
2490(0;)S
6435 V
(16272)210 1122 A
6525 V
(16273)210 1122 A
1776(/*)S
(TTY)126 1902 A
(likes)210 2070 A
2322(to)S
(know)168 2448 A
(the)126 2658 A
(current)294 2826 A
(column)252 3162 A
(and)126 3456 A
3624(if)S
(echoing)294 3750 A
(messed)252 4086 A
(up.)126 4380 A
4548(*/)S
6615 V
(16274)210 1122 A
(tp->tty_position)672 1776 A
2490(=)S
(cons->c_column;)630 2574 A
6705 V
(16275)210 1122 A
(tp->tty_reprint)630 1776 A
2448(=)S
(TRUE;)210 2532 A
6795 V
(16276)210 1122 A
1524(})S
6885 V
(16277)210 1122 A
6975 V
(16278)210 1122 A
1524(/*)S
(Check)210 1650 A
(and)126 1902 A
(update)252 2070 A
(the)126 2364 A
(cursor)252 2532 A
(position.)378 2826 A
3246(*/)S
7065 V
(16279)210 1122 A
1524(if)S
(\(cons->c_column)630 1650 A
2322(<)S
2406(0\))S
(cons->c_column)588 2532 A
3162(=)S
3246(0;)S
8418 V
EP
%%Page: 217 217
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
12 B
(217)180 4500 A
1755 V
7 LST
(16280)210 1122 A
1524(if)S
(\(cons->c_column)630 1650 A
2322(>)S
(scr_width\))420 2406 A
(cons->c_column)588 2868 A
3498(=)S
(scr_width;)420 3582 A
1845 V
(16281)210 1122 A
1524(if)S
(\(cons->c_row)504 1650 A
2196(<)S
2280(0\))S
(cons->c_row)462 2406 A
2910(=)S
2994(0;)S
1935 V
(16282)210 1122 A
1524(if)S
(\(cons->c_row)504 1650 A
2196(>=)S
(scr_lines\))420 2322 A
(cons->c_row)462 2784 A
3288(=)S
(scr_lines)378 3372 A
3792(-)S
3876(1;)S
2025 V
(16283)210 1122 A
(cur)126 1524 A
1692(=)S
(cons->c_org)462 1776 A
2280(+)S
(cons->c_row)462 2364 A
2868(*)S
(scr_width)378 2952 A
3372(+)S
(cons->c_column;)630 3456 A
2115 V
(16284)210 1122 A
1524(if)S
(\(cur)168 1650 A
1860(!=)S
(cons->c_cur\))504 1986 A
2532({)S
2205 V
(16285)210 1122 A
1776(if)S
(\(cons)210 1902 A
2154(==)S
(curcons\))336 2280 A
(set_6845\(CURSOR,)672 2658 A
(cur\);)210 3372 A
2295 V
(16286)210 1122 A
(cons->c_cur)462 1776 A
2280(=)S
(cur;)168 2364 A
2385 V
(16287)210 1122 A
1524(})S
2475 V
(16288)210 1122 A
1440(})S
2655 V
(16290)210 1122 A
(/*===========================================================================*)3276 1440 A
2745 V
(16291)210 1122 A
1482(*)S
(parse_escape)504 2784 A
4674(*)S
2835 V
(16292)210 1122 A
(*===========================================================================*/)3276 1482 A
2925 V
(16293)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(parse_escape\(cons,)756 1986 A
2784(c\))S
3015 V
(16294)210 1122 A
(register)336 1440 A
(console_t)378 1818 A
(*cons;)252 2238 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(console)294 3372 A
(struct)252 3708 A
4002(*/)S
3105 V
(16295)210 1122 A
(char)168 1440 A
1650(c;)S
2784(/*)S
(next)168 2910 A
(character)378 3120 A
3540(in)S
(escape)252 3666 A
(sequence)336 3960 A
4338(*/)S
3195 V
(16296)210 1122 A
1440({)S
3285 V
(16297)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(ANSI)168 2154 A
(escape)252 2364 A
(sequences)378 2658 A
(are)126 3078 A
(currently)378 3246 A
(supported.)420 3666 A
3375 V
(16298)210 1122 A
1482(*)S
1566(If)S
1692(n)S
(and/or)252 1776 A
2070(m)S
(are)126 2154 A
(omitted,)336 2322 A
(they)168 2700 A
(default)294 2910 A
3246(to)S
3372(1.)S
3465 V
(16299)210 1122 A
1482(*)S
(ESC)126 1650 A
([nA)126 1818 A
(moves)210 1986 A
2238(up)S
2364(n)S
(lines)210 2448 A
3555 V
(16300)210 1122 A
1482(*)S
(ESC)126 1650 A
([nB)126 1818 A
(moves)210 1986 A
(down)168 2238 A
2448(n)S
(lines)210 2532 A
3645 V
(16301)210 1122 A
1482(*)S
(ESC)126 1650 A
([nC)126 1818 A
(moves)210 1986 A
(right)210 2238 A
2490(n)S
(spaces)252 2574 A
3735 V
(16302)210 1122 A
1482(*)S
(ESC)126 1650 A
([nD)126 1818 A
(moves)210 1986 A
(left)168 2238 A
2448(n)S
(spaces)252 2532 A
3825 V
(16303)210 1122 A
1482(*)S
(ESC)126 1650 A
([m;nH")252 1818 A
(moves)210 2112 A
(cursor)252 2364 A
2658(to)S
(\(m,n\))210 2784 A
3915 V
(16304)210 1122 A
1482(*)S
(ESC)126 1650 A
1818([J)S
(clears)252 1944 A
(screen)252 2238 A
(from)168 2532 A
(cursor)252 2742 A
4005 V
(16305)210 1122 A
1482(*)S
(ESC)126 1650 A
1818([K)S
(clears)252 1944 A
(line)168 2238 A
(from)168 2448 A
(cursor)252 2658 A
4095 V
(16306)210 1122 A
1482(*)S
(ESC)126 1650 A
([nL)126 1818 A
(inserts)294 1986 A
2322(n)S
(lines)210 2406 A
2658(ar)S
(cursor)252 2784 A
4185 V
(16307)210 1122 A
1482(*)S
(ESC)126 1650 A
([nM)126 1818 A
(deletes)294 1986 A
2322(n)S
(lines)210 2406 A
2658(at)S
(cursor)252 2784 A
4275 V
(16308)210 1122 A
1482(*)S
(ESC)126 1650 A
([nP)126 1818 A
(deletes)294 1986 A
2322(n)S
(chars)210 2406 A
2658(at)S
(cursor)252 2784 A
4365 V
(16309)210 1122 A
1482(*)S
(ESC)126 1650 A
([n@)126 1818 A
(inserts)294 1986 A
2322(n)S
(chars)210 2406 A
2658(at)S
(cursor)252 2784 A
4455 V
(16310)210 1122 A
1482(*)S
(ESC)126 1650 A
([nm)126 1818 A
(enables)294 1986 A
(rendition)378 2322 A
2742(n)S
(\(0=normal,)420 2826 A
(4=bold,)294 3288 A
(5=blinking,)462 3624 A
(7=reverse\))420 4128 A
4545 V
(16311)210 1122 A
1482(*)S
(ESC)126 1650 A
1818(M)S
(scrolls)294 1902 A
(the)126 2238 A
(screen)252 2406 A
(backwards)378 2700 A
3120(if)S
(the)126 3246 A
(cursor)252 3414 A
3708(is)S
3834(on)S
(the)126 3960 A
(top)126 4128 A
(line)168 4296 A
4635 V
(16312)210 1122 A
1482(*/)S
4725 V
(16313)210 1122 A
4815 V
(16314)210 1122 A
(switch)252 1524 A
(\(cons->c_esc_state\))798 1818 A
2658({)S
4905 V
(16315)210 1122 A
(case)168 1608 A
1818(1:)S
2784(/*)S
(ESC)126 2910 A
(seen)168 3078 A
3288(*/)S
4995 V
(16316)210 1122 A
(cons->c_esc_intro)714 1776 A
2532(=)S
('\\0';)210 2616 A
5085 V
(16317)210 1122 A
(cons->c_esc_parmp)714 1776 A
2532(=)S
(bufend\(cons->c_esc_parmv\);)1092 2616 A
5175 V
(16318)210 1122 A
1776(do)S
1902({)S
5265 V
(16319)210 1122 A
(*--cons->c_esc_parmp)840 2112 A
2994(=)S
3078(0;)S
5355 V
(16320)210 1122 A
1776(})S
(while)210 1860 A
(\(cons->c_esc_parmp)756 2112 A
2910(>)S
(cons->c_esc_parmv\);)798 2994 A
5445 V
(16321)210 1122 A
(switch)252 1776 A
(\(c\))126 2070 A
2238({)S
5535 V
(16322)210 1122 A
(case)168 1944 A
('[':)168 2154 A
2448(/*)S
(Control)294 2574 A
(Sequence)336 2910 A
(Introducer)420 3288 A
3750(*/)S
5625 V
(16323)210 1122 A
(cons->c_esc_intro)714 2112 A
2868(=)S
2952(c;)S
5715 V
(16324)210 1122 A
(cons->c_esc_state)714 2112 A
2868(=)S
2952(2;)S
5805 V
(16325)210 1122 A
(break;)252 2112 A
5895 V
(16326)210 1122 A
(case)168 1944 A
('M':)168 2154 A
2448(/*)S
(Reverse)294 2574 A
(Index)210 2910 A
3162(*/)S
5985 V
(16327)210 1122 A
(do_escape\(cons,)630 2112 A
(c\);)126 2784 A
6075 V
(16328)210 1122 A
(break;)252 2112 A
6165 V
(16329)210 1122 A
(default:)336 1944 A
6255 V
(16330)210 1122 A
(cons->c_esc_state)714 2112 A
2868(=)S
2952(0;)S
6345 V
(16331)210 1122 A
1776(})S
6435 V
(16332)210 1122 A
(break;)252 1776 A
6525 V
(16333)210 1122 A
6615 V
(16334)210 1122 A
(case)168 1608 A
1818(2:)S
2784(/*)S
(ESC)126 2910 A
3078([)S
(seen)168 3162 A
3372(*/)S
6705 V
(16335)210 1122 A
1776(if)S
1902(\(c)S
2028(>=)S
('0')126 2154 A
2322(&&)S
2448(c)S
2532(<=)S
('9'\))168 2658 A
2868({)S
6795 V
(16336)210 1122 A
2112(if)S
(\(cons->c_esc_parmp)756 2238 A
3036(<)S
(bufend\(cons->c_esc_parmv\)\))1092 3120 A
6885 V
(16337)210 1122 A
(*cons->c_esc_parmp)756 2448 A
3246(=)S
(*cons->c_esc_parmp)756 3330 A
4128(*)S
4212(10)S
4338(+)S
(\(c-'0'\);)336 4422 A
6975 V
(16338)210 1122 A
1776(})S
(else)168 1860 A
7065 V
(16339)210 1122 A
1776(if)S
1902(\(c)S
2028(==)S
(';'\))168 2154 A
2364({)S
8418 V
EP
%%Page: 218 218
BP
/slant 0 def
/height 0 def
1485 V
12 B
(218)180 1080 A
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(16340)210 1122 A
2112(if)S
(\(cons->c_esc_parmp)756 2238 A
3036(<)S
(bufend\(cons->c_esc_parmv\)\))1092 3120 A
1845 V
(16341)210 1122 A
(cons->c_esc_parmp++;)840 2448 A
1935 V
(16342)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
2025 V
(16343)210 1122 A
(do_escape\(cons,)630 2112 A
(c\);)126 2784 A
2115 V
(16344)210 1122 A
1776(})S
2205 V
(16345)210 1122 A
(break;)252 1776 A
2295 V
(16346)210 1122 A
1524(})S
2385 V
(16347)210 1122 A
1440(})S
2565 V
(16349)210 1122 A
(/*===========================================================================*)3276 1440 A
2655 V
(16350)210 1122 A
1482(*)S
(do_escape)378 2784 A
4674(*)S
2745 V
(16351)210 1122 A
(*===========================================================================*/)3276 1482 A
2835 V
(16352)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(do_escape\(cons,)630 1986 A
2658(c\))S
2925 V
(16353)210 1122 A
(register)336 1440 A
(console_t)378 1818 A
(*cons;)252 2238 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(console)294 3372 A
(struct)252 3708 A
4002(*/)S
3015 V
(16354)210 1122 A
(char)168 1440 A
1650(c;)S
2784(/*)S
(next)168 2910 A
(character)378 3120 A
3540(in)S
(escape)252 3666 A
(sequence)336 3960 A
4338(*/)S
3105 V
(16355)210 1122 A
1440({)S
3195 V
(16356)210 1122 A
(int)126 1524 A
(value,)252 1692 A
1986(n;)S
3285 V
(16357)210 1122 A
(unsigned)336 1524 A
(src,)168 1902 A
(dst,)168 2112 A
(count;)252 2322 A
3375 V
(16358)210 1122 A
(int)126 1524 A
(*parmp;)294 1692 A
3465 V
(16359)210 1122 A
3555 V
(16360)210 1122 A
1524(/*)S
(Some)168 1650 A
1860(of)S
(these)210 1986 A
(things)252 2238 A
(hack)168 2532 A
2742(on)S
(screen)252 2868 A
(RAM,)168 3162 A
3372(so)S
3498(it)S
(had)126 3624 A
(better)252 3792 A
4086(be)S
4212(up)S
4338(to)S
(date)168 4464 A
4674(*/)S
3645 V
(16361)210 1122 A
(flush\(cons\);)504 1524 A
3735 V
(16362)210 1122 A
3825 V
(16363)210 1122 A
1524(if)S
(\(cons->c_esc_intro)756 1650 A
2448(==)S
('\\0'\))210 2574 A
2826({)S
3915 V
(16364)210 1122 A
1776(/*)S
(Handle)252 1902 A
2196(a)S
(sequence)336 2280 A
(beginning)378 2658 A
(with)168 3078 A
(just)168 3288 A
(ESC)126 3498 A
3666(*/)S
4005 V
(16365)210 1122 A
(switch)252 1776 A
(\(c\))126 2070 A
2238({)S
4095 V
(16366)210 1122 A
(case)168 1944 A
('M':)168 2154 A
2784(/*)S
(Reverse)294 2910 A
(Index)210 3246 A
3498(*/)S
4185 V
(16367)210 1122 A
2112(if)S
(\(cons->c_row)504 2238 A
2784(==)S
2910(0\))S
3036({)S
4275 V
(16368)210 1122 A
(scroll_screen\(cons,)798 2448 A
(SCROLL_DOWN\);)546 3288 A
4365 V
(16369)210 1122 A
2112(})S
(else)168 2196 A
2406({)S
4455 V
(16370)210 1122 A
(cons->c_row--;)588 2448 A
4545 V
(16371)210 1122 A
2112(})S
4635 V
(16372)210 1122 A
(flush\(cons\);)504 2112 A
4725 V
(16373)210 1122 A
(break;)252 2112 A
4815 V
(16374)210 1122 A
4905 V
(16375)210 1122 A
(default:)336 1944 A
(break;)252 2322 A
4995 V
(16376)210 1122 A
1776(})S
5085 V
(16377)210 1122 A
1524(})S
(else)168 1608 A
5175 V
(16378)210 1122 A
1524(if)S
(\(cons->c_esc_intro)756 1650 A
2448(==)S
('['\))168 2574 A
2784({)S
5265 V
(16379)210 1122 A
1776(/*)S
(Handle)252 1902 A
2196(a)S
(sequence)336 2280 A
(beginning)378 2658 A
(with)168 3078 A
(ESC)126 3288 A
3456([)S
(and)126 3540 A
(parameters)420 3708 A
4170(*/)S
5355 V
(16380)210 1122 A
(value)210 1776 A
2028(=)S
(cons->c_esc_parmv[0];)882 2112 A
5445 V
(16381)210 1122 A
(switch)252 1776 A
(\(c\))126 2070 A
2238({)S
5535 V
(16382)210 1122 A
(case)168 1944 A
('A':)168 2154 A
2784(/*)S
(ESC)126 2910 A
([nA)126 3078 A
(moves)210 3246 A
3498(up)S
3624(n)S
(lines)210 3708 A
3960(*/)S
5625 V
(16383)210 1122 A
2112(n)S
2196(=)S
(\(value)252 2280 A
2574(==)S
2700(0)S
2784(?)S
2868(1)S
2952(:)S
(value\);)294 3036 A
5715 V
(16384)210 1122 A
(cons->c_row)462 2112 A
2616(-=)S
2742(n;)S
5805 V
(16385)210 1122 A
(flush\(cons\);)504 2112 A
5895 V
(16386)210 1122 A
(break;)252 2112 A
5985 V
(16387)210 1122 A
6075 V
(16388)210 1122 A
(case)168 1944 A
('B':)168 2154 A
2784(/*)S
(ESC)126 2910 A
([nB)126 3078 A
(moves)210 3246 A
(down)168 3498 A
3708(n)S
(lines)210 3792 A
4044(*/)S
6165 V
(16389)210 1122 A
2112(n)S
2196(=)S
(\(value)252 2280 A
2574(==)S
2700(0)S
2784(?)S
2868(1)S
2952(:)S
(value\);)294 3036 A
6255 V
(16390)210 1122 A
(cons->c_row)462 2112 A
2616(+=)S
2742(n;)S
6345 V
(16391)210 1122 A
(flush\(cons\);)504 2112 A
6435 V
(16392)210 1122 A
(break;)252 2112 A
6525 V
(16393)210 1122 A
6615 V
(16394)210 1122 A
(case)168 1944 A
('C':)168 2154 A
2784(/*)S
(ESC)126 2910 A
([nC)126 3078 A
(moves)210 3246 A
(right)210 3498 A
3750(n)S
(spaces)252 3834 A
4128(*/)S
6705 V
(16395)210 1122 A
2112(n)S
2196(=)S
(\(value)252 2280 A
2574(==)S
2700(0)S
2784(?)S
2868(1)S
2952(:)S
(value\);)294 3036 A
6795 V
(16396)210 1122 A
(cons->c_column)588 2112 A
2742(+=)S
2868(n;)S
6885 V
(16397)210 1122 A
(flush\(cons\);)504 2112 A
6975 V
(16398)210 1122 A
(break;)252 2112 A
7065 V
(16399)210 1122 A
8418 V
EP
%%Page: 219 219
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
12 B
(219)180 4500 A
1755 V
7 LST
(16400)210 1122 A
(case)168 1944 A
('D':)168 2154 A
2784(/*)S
(ESC)126 2910 A
([nD)126 3078 A
(moves)210 3246 A
(left)168 3498 A
3708(n)S
(spaces)252 3792 A
4086(*/)S
1845 V
(16401)210 1122 A
2112(n)S
2196(=)S
(\(value)252 2280 A
2574(==)S
2700(0)S
2784(?)S
2868(1)S
2952(:)S
(value\);)294 3036 A
1935 V
(16402)210 1122 A
(cons->c_column)588 2112 A
2742(-=)S
2868(n;)S
2025 V
(16403)210 1122 A
(flush\(cons\);)504 2112 A
2115 V
(16404)210 1122 A
(break;)252 2112 A
2205 V
(16405)210 1122 A
2295 V
(16406)210 1122 A
(case)168 1944 A
('H':)168 2154 A
2784(/*)S
(ESC)126 2910 A
([m;nH")252 3078 A
(moves)210 3372 A
(cursor)252 3624 A
3918(to)S
(\(m,n\))210 4044 A
4296(*/)S
2385 V
(16407)210 1122 A
(cons->c_row)462 2112 A
2616(=)S
(cons->c_esc_parmv[0])840 2700 A
3582(-)S
3666(1;)S
2475 V
(16408)210 1122 A
(cons->c_column)588 2112 A
2742(=)S
(cons->c_esc_parmv[1])840 2826 A
3708(-)S
3792(1;)S
2565 V
(16409)210 1122 A
(flush\(cons\);)504 2112 A
2655 V
(16410)210 1122 A
(break;)252 2112 A
2745 V
(16411)210 1122 A
2835 V
(16412)210 1122 A
(case)168 1944 A
('J':)168 2154 A
2784(/*)S
(ESC)126 2910 A
([sJ)126 3078 A
(clears)252 3246 A
3540(in)S
(display)294 3666 A
4002(*/)S
2925 V
(16413)210 1122 A
(switch)252 2112 A
(\(value\))294 2406 A
2742({)S
3015 V
(16414)210 1122 A
(case)168 2280 A
2490(0:)S
2784(/*)S
(Clear)210 2910 A
(from)168 3162 A
(cursor)252 3372 A
3666(to)S
(end)126 3792 A
3960(of)S
(screen)252 4086 A
4380(*/)S
3105 V
(16415)210 1122 A
(count)210 2448 A
2700(=)S
(scr_size)336 2784 A
3162(-)S
(\(cons->c_cur)504 3246 A
3792(-)S
(cons->c_org\);)546 3876 A
3195 V
(16416)210 1122 A
(dst)126 2448 A
2616(=)S
(cons->c_cur;)504 2700 A
3285 V
(16417)210 1122 A
(break;)252 2448 A
3375 V
(16418)210 1122 A
(case)168 2280 A
2490(1:)S
2784(/*)S
(Clear)210 2910 A
(from)168 3162 A
(start)210 3372 A
3624(of)S
(screen)252 3750 A
4044(to)S
(cursor)252 4170 A
4464(*/)S
3465 V
(16419)210 1122 A
(count)210 2448 A
2700(=)S
(cons->c_cur)462 2784 A
3288(-)S
(cons->c_org;)504 3372 A
3555 V
(16420)210 1122 A
(dst)126 2448 A
2616(=)S
(cons->c_org;)504 2700 A
3645 V
(16421)210 1122 A
(break;)252 2448 A
3735 V
(16422)210 1122 A
(case)168 2280 A
2490(2:)S
2784(/*)S
(Clear)210 2910 A
(entire)252 3162 A
(screen)252 3456 A
3750(*/)S
3825 V
(16423)210 1122 A
(count)210 2448 A
2700(=)S
(scr_size;)378 2784 A
3915 V
(16424)210 1122 A
(dst)126 2448 A
2616(=)S
(cons->c_org;)504 2700 A
4005 V
(16425)210 1122 A
(break;)252 2448 A
4095 V
(16426)210 1122 A
(default:)336 2280 A
2784(/*)S
2910(Do)S
(nothing)294 3036 A
3372(*/)S
4185 V
(16427)210 1122 A
(count)210 2448 A
2700(=)S
2784(0;)S
4275 V
(16428)210 1122 A
(dst)126 2448 A
2616(=)S
(cons->c_org;)504 2700 A
4365 V
(16429)210 1122 A
2112(})S
4455 V
(16430)210 1122 A
(blank_color)462 2112 A
2616(=)S
(cons->c_blank;)588 2700 A
4545 V
(16431)210 1122 A
(mem_vid_copy\(BLANK_MEM,)966 2112 A
(dst,)168 3120 A
(count\);)294 3330 A
4635 V
(16432)210 1122 A
(break;)252 2112 A
4725 V
(16433)210 1122 A
4815 V
(16434)210 1122 A
(case)168 1944 A
('K':)168 2154 A
2784(/*)S
(ESC)126 2910 A
([sK)126 3078 A
(clears)252 3246 A
(line)168 3540 A
(from)168 3750 A
(cursor)252 3960 A
4254(*/)S
4905 V
(16435)210 1122 A
(switch)252 2112 A
(\(value\))294 2406 A
2742({)S
4995 V
(16436)210 1122 A
(case)168 2280 A
2490(0:)S
2784(/*)S
(Clear)210 2910 A
(from)168 3162 A
(cursor)252 3372 A
3666(to)S
(end)126 3792 A
3960(of)S
(line)168 4086 A
4296(*/)S
5085 V
(16437)210 1122 A
(count)210 2448 A
2700(=)S
(scr_width)378 2784 A
3204(-)S
(cons->c_column;)630 3288 A
5175 V
(16438)210 1122 A
(dst)126 2448 A
2616(=)S
(cons->c_cur;)504 2700 A
5265 V
(16439)210 1122 A
(break;)252 2448 A
5355 V
(16440)210 1122 A
(case)168 2280 A
2490(1:)S
2784(/*)S
(Clear)210 2910 A
(from)168 3162 A
(beginning)378 3372 A
3792(of)S
(line)168 3918 A
4128(to)S
(cursor)252 4254 A
4548(*/)S
5445 V
(16441)210 1122 A
(count)210 2448 A
2700(=)S
(cons->c_column;)630 2784 A
5535 V
(16442)210 1122 A
(dst)126 2448 A
2616(=)S
(cons->c_cur)462 2700 A
3204(-)S
(cons->c_column;)630 3288 A
5625 V
(16443)210 1122 A
(break;)252 2448 A
5715 V
(16444)210 1122 A
(case)168 2280 A
2490(2:)S
2784(/*)S
(Clear)210 2910 A
(entire)252 3162 A
(line)168 3456 A
3666(*/)S
5805 V
(16445)210 1122 A
(count)210 2448 A
2700(=)S
(scr_width;)420 2784 A
5895 V
(16446)210 1122 A
(dst)126 2448 A
2616(=)S
(cons->c_cur)462 2700 A
3204(-)S
(cons->c_column;)630 3288 A
5985 V
(16447)210 1122 A
(break;)252 2448 A
6075 V
(16448)210 1122 A
(default:)336 2280 A
2784(/*)S
2910(Do)S
(nothing)294 3036 A
3372(*/)S
6165 V
(16449)210 1122 A
(count)210 2448 A
2700(=)S
2784(0;)S
6255 V
(16450)210 1122 A
(dst)126 2448 A
2616(=)S
(cons->c_cur;)504 2700 A
6345 V
(16451)210 1122 A
2112(})S
6435 V
(16452)210 1122 A
(blank_color)462 2112 A
2616(=)S
(cons->c_blank;)588 2700 A
6525 V
(16453)210 1122 A
(mem_vid_copy\(BLANK_MEM,)966 2112 A
(dst,)168 3120 A
(count\);)294 3330 A
6615 V
(16454)210 1122 A
(break;)252 2112 A
6705 V
(16455)210 1122 A
6795 V
(16456)210 1122 A
(case)168 1944 A
('L':)168 2154 A
2784(/*)S
(ESC)126 2910 A
([nL)126 3078 A
(inserts)294 3246 A
3582(n)S
(lines)210 3666 A
3918(at)S
(cursor)252 4044 A
4338(*/)S
6885 V
(16457)210 1122 A
2112(n)S
2196(=)S
(value;)252 2280 A
6975 V
(16458)210 1122 A
2112(if)S
2238(\(n)S
2364(<)S
2448(1\))S
2574(n)S
2658(=)S
2742(1;)S
7065 V
(16459)210 1122 A
2112(if)S
2238(\(n)S
2364(>)S
(\(scr_lines)420 2448 A
2910(-)S
(cons->c_row\)\))546 2994 A
8418 V
EP
%%Page: 220 220
BP
/slant 0 def
/height 0 def
1485 V
12 B
(220)180 1080 A
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(16460)210 1122 A
2448(n)S
2532(=)S
(scr_lines)378 2616 A
3036(-)S
(cons->c_row;)504 3120 A
1845 V
(16461)210 1122 A
1935 V
(16462)210 1122 A
(src)126 2112 A
2280(=)S
(cons->c_org)462 2364 A
2868(+)S
(cons->c_row)462 2952 A
3456(*)S
(scr_width;)420 3540 A
2025 V
(16463)210 1122 A
(dst)126 2112 A
2280(=)S
(src)126 2364 A
2532(+)S
2616(n)S
2700(*)S
(scr_width;)420 2784 A
2115 V
(16464)210 1122 A
(count)210 2112 A
2364(=)S
(\(scr_lines)420 2448 A
2910(-)S
(cons->c_row)462 2994 A
3498(-)S
3582(n\))S
3708(*)S
(scr_width;)420 3792 A
2205 V
(16465)210 1122 A
(vid_vid_copy\(src,)714 2112 A
(dst,)168 2868 A
(count\);)294 3078 A
2295 V
(16466)210 1122 A
(blank_color)462 2112 A
2616(=)S
(cons->c_blank;)588 2700 A
2385 V
(16467)210 1122 A
(mem_vid_copy\(BLANK_MEM,)966 2112 A
(src,)168 3120 A
3330(n)S
3414(*)S
(scr_width\);)462 3498 A
2475 V
(16468)210 1122 A
(break;)252 2112 A
2565 V
(16469)210 1122 A
2655 V
(16470)210 1122 A
(case)168 1944 A
('M':)168 2154 A
2784(/*)S
(ESC)126 2910 A
([nM)126 3078 A
(deletes)294 3246 A
3582(n)S
(lines)210 3666 A
3918(at)S
(cursor)252 4044 A
4338(*/)S
2745 V
(16471)210 1122 A
2112(n)S
2196(=)S
(value;)252 2280 A
2835 V
(16472)210 1122 A
2112(if)S
2238(\(n)S
2364(<)S
2448(1\))S
2574(n)S
2658(=)S
2742(1;)S
2925 V
(16473)210 1122 A
2112(if)S
2238(\(n)S
2364(>)S
(\(scr_lines)420 2448 A
2910(-)S
(cons->c_row\)\))546 2994 A
3015 V
(16474)210 1122 A
2448(n)S
2532(=)S
(scr_lines)378 2616 A
3036(-)S
(cons->c_row;)504 3120 A
3105 V
(16475)210 1122 A
3195 V
(16476)210 1122 A
(dst)126 2112 A
2280(=)S
(cons->c_org)462 2364 A
2868(+)S
(cons->c_row)462 2952 A
3456(*)S
(scr_width;)420 3540 A
3285 V
(16477)210 1122 A
(src)126 2112 A
2280(=)S
(dst)126 2364 A
2532(+)S
2616(n)S
2700(*)S
(scr_width;)420 2784 A
3375 V
(16478)210 1122 A
(count)210 2112 A
2364(=)S
(\(scr_lines)420 2448 A
2910(-)S
(cons->c_row)462 2994 A
3498(-)S
3582(n\))S
3708(*)S
(scr_width;)420 3792 A
3465 V
(16479)210 1122 A
(vid_vid_copy\(src,)714 2112 A
(dst,)168 2868 A
(count\);)294 3078 A
3555 V
(16480)210 1122 A
(blank_color)462 2112 A
2616(=)S
(cons->c_blank;)588 2700 A
3645 V
(16481)210 1122 A
(mem_vid_copy\(BLANK_MEM,)966 2112 A
(dst)126 3120 A
3288(+)S
(count,)252 3372 A
3666(n)S
3750(*)S
(scr_width\);)462 3834 A
3735 V
(16482)210 1122 A
(break;)252 2112 A
3825 V
(16483)210 1122 A
3915 V
(16484)210 1122 A
(case)168 1944 A
('@':)168 2154 A
2784(/*)S
(ESC)126 2910 A
([n@)126 3078 A
(inserts)294 3246 A
3582(n)S
(chars)210 3666 A
3918(at)S
(cursor)252 4044 A
4338(*/)S
4005 V
(16485)210 1122 A
2112(n)S
2196(=)S
(value;)252 2280 A
4095 V
(16486)210 1122 A
2112(if)S
2238(\(n)S
2364(<)S
2448(1\))S
2574(n)S
2658(=)S
2742(1;)S
4185 V
(16487)210 1122 A
2112(if)S
2238(\(n)S
2364(>)S
(\(scr_width)420 2448 A
2910(-)S
(cons->c_column\)\))672 2994 A
4275 V
(16488)210 1122 A
2448(n)S
2532(=)S
(scr_width)378 2616 A
3036(-)S
(cons->c_column;)630 3120 A
4365 V
(16489)210 1122 A
4455 V
(16490)210 1122 A
(src)126 2112 A
2280(=)S
(cons->c_cur;)504 2364 A
4545 V
(16491)210 1122 A
(dst)126 2112 A
2280(=)S
(src)126 2364 A
2532(+)S
2616(n;)S
4635 V
(16492)210 1122 A
(count)210 2112 A
2364(=)S
(scr_width)378 2448 A
2868(-)S
(cons->c_column)588 2952 A
3582(-)S
3666(n;)S
4725 V
(16493)210 1122 A
(vid_vid_copy\(src,)714 2112 A
(dst,)168 2868 A
(count\);)294 3078 A
4815 V
(16494)210 1122 A
(blank_color)462 2112 A
2616(=)S
(cons->c_blank;)588 2700 A
4905 V
(16495)210 1122 A
(mem_vid_copy\(BLANK_MEM,)966 2112 A
(src,)168 3120 A
(n\);)126 3330 A
4995 V
(16496)210 1122 A
(break;)252 2112 A
5085 V
(16497)210 1122 A
5175 V
(16498)210 1122 A
(case)168 1944 A
('P':)168 2154 A
2784(/*)S
(ESC)126 2910 A
([nP)126 3078 A
(deletes)294 3246 A
3582(n)S
(chars)210 3666 A
3918(at)S
(cursor)252 4044 A
4338(*/)S
5265 V
(16499)210 1122 A
2112(n)S
2196(=)S
(value;)252 2280 A
5355 V
(16500)210 1122 A
2112(if)S
2238(\(n)S
2364(<)S
2448(1\))S
2574(n)S
2658(=)S
2742(1;)S
5445 V
(16501)210 1122 A
2112(if)S
2238(\(n)S
2364(>)S
(\(scr_width)420 2448 A
2910(-)S
(cons->c_column\)\))672 2994 A
5535 V
(16502)210 1122 A
2448(n)S
2532(=)S
(scr_width)378 2616 A
3036(-)S
(cons->c_column;)630 3120 A
5625 V
(16503)210 1122 A
5715 V
(16504)210 1122 A
(dst)126 2112 A
2280(=)S
(cons->c_cur;)504 2364 A
5805 V
(16505)210 1122 A
(src)126 2112 A
2280(=)S
(dst)126 2364 A
2532(+)S
2616(n;)S
5895 V
(16506)210 1122 A
(count)210 2112 A
2364(=)S
(scr_width)378 2448 A
2868(-)S
(cons->c_column)588 2952 A
3582(-)S
3666(n;)S
5985 V
(16507)210 1122 A
(vid_vid_copy\(src,)714 2112 A
(dst,)168 2868 A
(count\);)294 3078 A
6075 V
(16508)210 1122 A
(blank_color)462 2112 A
2616(=)S
(cons->c_blank;)588 2700 A
6165 V
(16509)210 1122 A
(mem_vid_copy\(BLANK_MEM,)966 2112 A
(dst)126 3120 A
3288(+)S
(count,)252 3372 A
(n\);)126 3666 A
6255 V
(16510)210 1122 A
(break;)252 2112 A
6345 V
(16511)210 1122 A
6435 V
(16512)210 1122 A
(case)168 1944 A
('m':)168 2154 A
2784(/*)S
(ESC)126 2910 A
([nm)126 3078 A
(enables)294 3246 A
(rendition)378 3582 A
4002(n)S
4086(*/)S
6525 V
(16513)210 1122 A
(for)126 2112 A
(\(parmp)252 2280 A
2574(=)S
(cons->c_esc_parmv;)756 2658 A
(parmp)210 3456 A
3708(<=)S
(cons->c_esc_parmp)714 3834 A
6615 V
(16514)210 1122 A
2784(&&)S
(parmp)210 2910 A
3162(<)S
(bufend\(cons->c_esc_parmv\);)1092 3246 A
(parmp++\))336 4380 A
4758({)S
6705 V
(16515)210 1122 A
2448(if)S
(\(cons->c_reverse\))714 2574 A
3330({)S
6795 V
(16516)210 1122 A
2784(/*)S
(Unswap)252 2910 A
3204(fg)S
(and)126 3330 A
3498(bg)S
(colors)252 3624 A
3918(*/)S
6885 V
(16517)210 1122 A
(cons->c_attr)504 2784 A
3330(=)S
(\(\(cons->c_attr)588 3456 A
4086(&)S
(0x7000\))294 4170 A
4506(>>)S
4632(4\))S
4758(|)S
6975 V
(16518)210 1122 A
(\(\(cons->c_attr)588 3456 A
4086(&)S
(0x0700\))294 4170 A
4506(<<)S
4632(4\))S
4758(|)S
7065 V
(16519)210 1122 A
(\(\(cons->c_attr)588 3456 A
4086(&)S
(0x8800\)\);)378 4170 A
8418 V
EP
%%Page: 221 221
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
12 B
(221)180 4500 A
1755 V
7 LST
(16520)210 1122 A
2448(})S
1845 V
(16521)210 1122 A
(switch)252 2448 A
2742(\(n)S
2868(=)S
(*parmp\))294 2952 A
3288({)S
1935 V
(16522)210 1122 A
(case)168 2616 A
2826(0:)S
3120(/*)S
(NORMAL)252 3246 A
3540(*/)S
2025 V
(16523)210 1122 A
(cons->c_attr)504 2784 A
3330(=)S
(cons->c_blank)546 3414 A
4002(=)S
(BLANK_COLOR;)504 4086 A
2115 V
(16524)210 1122 A
(cons->c_reverse)630 2784 A
3456(=)S
(FALSE;)252 3540 A
2205 V
(16525)210 1122 A
(break;)252 2784 A
2295 V
(16526)210 1122 A
2385 V
(16527)210 1122 A
(case)168 2616 A
2826(1:)S
3120(/*)S
(BOLD)168 3246 A
3498(*/)S
2475 V
(16528)210 1122 A
2784(/*)S
(Set)126 2910 A
(intensity)378 3078 A
(bit)126 3498 A
3666(*/)S
2565 V
(16529)210 1122 A
(cons->c_attr)504 2784 A
3330(|=)S
(0x0800;)294 3456 A
2655 V
(16530)210 1122 A
(break;)252 2784 A
2745 V
(16531)210 1122 A
2835 V
(16532)210 1122 A
(case)168 2616 A
2826(4:)S
3120(/*)S
(UNDERLINE)378 3246 A
3666(*/)S
2925 V
(16533)210 1122 A
2784(if)S
(\(color\))294 2910 A
3246({)S
3015 V
(16534)210 1122 A
3120(/*)S
(Change)252 3246 A
(white)210 3540 A
3792(to)S
(cyan,)210 3918 A
(i.e.)168 4170 A
(lose)168 4380 A
(red)126 4590 A
3105 V
(16535)210 1122 A
3162(*/)S
3195 V
(16536)210 1122 A
(cons->c_attr)504 3120 A
3666(=)S
(\(cons->c_attr)546 3750 A
4338(&)S
(0xBBFF\);)336 4422 A
3285 V
(16537)210 1122 A
2784(})S
(else)168 2868 A
3078({)S
3375 V
(16538)210 1122 A
3120(/*)S
(Set)126 3246 A
(underline)378 3414 A
(attribute)378 3834 A
4254(*/)S
3465 V
(16539)210 1122 A
(cons->c_attr)504 3120 A
3666(=)S
(\(cons->c_attr)546 3750 A
4338(&)S
(0x99FF\);)336 4422 A
3555 V
(16540)210 1122 A
2784(})S
3645 V
(16541)210 1122 A
(break;)252 2784 A
3735 V
(16542)210 1122 A
3825 V
(16543)210 1122 A
(case)168 2616 A
2826(5:)S
3120(/*)S
(BLINKING)336 3246 A
3624(*/)S
3915 V
(16544)210 1122 A
2784(/*)S
(Set)126 2910 A
(the)126 3078 A
(blink)210 3246 A
(bit)126 3498 A
3666(*/)S
4005 V
(16545)210 1122 A
(cons->c_attr)504 2784 A
3330(|=)S
(0x8000;)294 3456 A
4095 V
(16546)210 1122 A
(break;)252 2784 A
4185 V
(16547)210 1122 A
4275 V
(16548)210 1122 A
(case)168 2616 A
2826(7:)S
3120(/*)S
(REVERSE)294 3246 A
3582(*/)S
4365 V
(16549)210 1122 A
(cons->c_reverse)630 2784 A
3456(=)S
(TRUE;)210 3540 A
4455 V
(16550)210 1122 A
(break;)252 2784 A
4545 V
(16551)210 1122 A
4635 V
(16552)210 1122 A
(default:)336 2616 A
3120(/*)S
(COLOR)210 3246 A
3498(*/)S
4725 V
(16553)210 1122 A
2784(if)S
2910(\(n)S
3036(==)S
(39\))126 3162 A
3330(n)S
3414(=)S
(37;)126 3498 A
3792(/*)S
(set)126 3918 A
(default)294 4086 A
(color)210 4422 A
4674(*/)S
4815 V
(16554)210 1122 A
2784(if)S
2910(\(n)S
3036(==)S
(49\))126 3162 A
3330(n)S
3414(=)S
(40;)126 3498 A
4905 V
(16555)210 1122 A
4995 V
(16556)210 1122 A
2784(if)S
(\(!color\))336 2910 A
3288({)S
5085 V
(16557)210 1122 A
3120(/*)S
(Don't)210 3246 A
(mess)168 3498 A
3708(up)S
3834(a)S
(monochrome)420 3918 A
(screen)252 4380 A
4674(*/)S
5175 V
(16558)210 1122 A
2784(})S
(else)168 2868 A
5265 V
(16559)210 1122 A
2784(if)S
(\(30)126 2910 A
3078(<=)S
3204(n)S
3288(&&)S
3414(n)S
3498(<=)S
(37\))126 3624 A
3792({)S
5355 V
(16560)210 1122 A
3120(/*)S
(Foreground)420 3246 A
(color)210 3708 A
3960(*/)S
5445 V
(16561)210 1122 A
(cons->c_attr)504 3120 A
3666(=)S
5535 V
(16562)210 1122 A
(\(cons->c_attr)546 3456 A
4044(&)S
(0xF8FF\))294 4128 A
4464(|)S
5625 V
(16563)210 1122 A
(\(ansi_colors[\(n)630 3456 A
4128(-)S
(30\)])168 4212 A
4422(<<)S
(8\);)126 4548 A
5715 V
(16564)210 1122 A
(cons->c_blank)546 3120 A
3708(=)S
5805 V
(16565)210 1122 A
(\(cons->c_blank)588 3456 A
4086(&)S
(0xF8FF\))294 4170 A
4506(|)S
5895 V
(16566)210 1122 A
(\(ansi_colors[\(n)630 3456 A
4128(-)S
(30\)])168 4212 A
4422(<<)S
(8\);)126 4548 A
5985 V
(16567)210 1122 A
2784(})S
(else)168 2868 A
6075 V
(16568)210 1122 A
2784(if)S
(\(40)126 2910 A
3078(<=)S
3204(n)S
3288(&&)S
3414(n)S
3498(<=)S
(47\))126 3624 A
3792({)S
6165 V
(16569)210 1122 A
3120(/*)S
(Background)420 3246 A
(color)210 3708 A
3960(*/)S
6255 V
(16570)210 1122 A
(cons->c_attr)504 3120 A
3666(=)S
6345 V
(16571)210 1122 A
(\(cons->c_attr)546 3456 A
4044(&)S
(0x8FFF\))294 4128 A
4464(|)S
6435 V
(16572)210 1122 A
(\(ansi_colors[\(n)630 3456 A
4128(-)S
(40\)])168 4212 A
4422(<<)S
(12\);)168 4548 A
6525 V
(16573)210 1122 A
(cons->c_blank)546 3120 A
3708(=)S
6615 V
(16574)210 1122 A
(\(cons->c_blank)588 3456 A
4086(&)S
(0x8FFF\))294 4170 A
4506(|)S
6705 V
(16575)210 1122 A
(\(ansi_colors[\(n)630 3456 A
4128(-)S
(40\)])168 4212 A
4422(<<)S
(12\);)168 4548 A
6795 V
(16576)210 1122 A
2784(})S
6885 V
(16577)210 1122 A
2448(})S
6975 V
(16578)210 1122 A
2448(if)S
(\(cons->c_reverse\))714 2574 A
3330({)S
7065 V
(16579)210 1122 A
2784(/*)S
(Swap)168 2910 A
3120(fg)S
(and)126 3246 A
3414(bg)S
(colors)252 3540 A
3834(*/)S
8418 V
EP
%%Page: 222 222
BP
/slant 0 def
/height 0 def
1485 V
12 B
(222)180 1080 A
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(16580)210 1122 A
(cons->c_attr)504 2784 A
3330(=)S
(\(\(cons->c_attr)588 3456 A
4086(&)S
(0x7000\))294 4170 A
4506(>>)S
4632(4\))S
4758(|)S
1845 V
(16581)210 1122 A
(\(\(cons->c_attr)588 3456 A
4086(&)S
(0x0700\))294 4170 A
4506(<<)S
4632(4\))S
4758(|)S
1935 V
(16582)210 1122 A
(\(\(cons->c_attr)588 3456 A
4086(&)S
(0x8800\)\);)378 4170 A
2025 V
(16583)210 1122 A
2448(})S
2115 V
(16584)210 1122 A
2112(})S
2205 V
(16585)210 1122 A
(break;)252 2112 A
2295 V
(16586)210 1122 A
1776(})S
2385 V
(16587)210 1122 A
1524(})S
2475 V
(16588)210 1122 A
(cons->c_esc_state)714 1524 A
2280(=)S
2364(0;)S
2565 V
(16589)210 1122 A
1440(})S
2745 V
(16591)210 1122 A
(/*===========================================================================*)3276 1440 A
2835 V
(16592)210 1122 A
1482(*)S
(set_6845)336 2784 A
4674(*)S
2925 V
(16593)210 1122 A
(*===========================================================================*/)3276 1482 A
3015 V
(16594)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(set_6845\(reg,)546 1986 A
(val\))168 2574 A
3105 V
(16595)210 1122 A
(int)126 1440 A
(reg;)168 1608 A
2784(/*)S
(which)210 2910 A
(register)336 3162 A
(pair)168 3540 A
3750(to)S
(set)126 3876 A
4044(*/)S
3195 V
(16596)210 1122 A
(unsigned)336 1440 A
(val;)168 1818 A
2784(/*)S
(16-bit)252 2910 A
(value)210 3204 A
3456(to)S
(set)126 3582 A
3750(it)S
3876(to)S
4002(*/)S
3285 V
(16597)210 1122 A
1440({)S
3375 V
(16598)210 1122 A
1440(/*)S
(Set)126 1566 A
1734(a)S
(register)336 1818 A
(pair)168 2196 A
(inside)252 2406 A
(the)126 2700 A
(6845.)210 2868 A
3465 V
(16599)210 1122 A
1482(*)S
(Registers)378 1566 A
(12-13)210 1986 A
(tell)168 2238 A
(the)126 2448 A
(6845)168 2616 A
(where)210 2826 A
3078(in)S
(video)210 3204 A
(ram)126 3456 A
3624(to)S
(start)210 3750 A
3555 V
(16600)210 1122 A
1482(*)S
(Registers)378 1566 A
(14-15)210 1986 A
(tell)168 2238 A
(the)126 2448 A
(6845)168 2616 A
(where)210 2826 A
3078(to)S
(put)126 3204 A
(the)126 3372 A
(cursor)252 3540 A
3645 V
(16601)210 1122 A
1482(*/)S
3735 V
(16602)210 1122 A
(pvb_pair_t)420 1524 A
(char_out[4];)504 1986 A
3825 V
(16603)210 1122 A
(pv_set\(char_out[0],)798 1524 A
(vid_port)336 2364 A
2742(+)S
(INDEX,)252 2826 A
(reg\);)210 3120 A
3456(/*)S
(set)126 3582 A
(index)210 3750 A
(register)336 4002 A
4380(*/)S
3915 V
(16604)210 1122 A
(pv_set\(char_out[1],)798 1524 A
(vid_port)336 2364 A
2742(+)S
(DATA,)210 2826 A
(\(val>>8\))336 3078 A
3456(&)S
(BYTE\);)252 3540 A
3960(/*)S
(high)168 4086 A
(byte)168 4296 A
4506(*/)S
4005 V
(16605)210 1122 A
(pv_set\(char_out[2],)798 1524 A
(vid_port)336 2364 A
2742(+)S
(INDEX,)252 2826 A
(reg)126 3120 A
3288(+)S
(1\);)126 3372 A
3960(/*)S
(again)210 4086 A
4338(*/)S
4095 V
(16606)210 1122 A
(pv_set\(char_out[3],)798 1524 A
(vid_port)336 2364 A
2742(+)S
(DATA,)210 2826 A
(val&BYTE\);)420 3078 A
3960(/*)S
(low)126 4086 A
(byte)168 4254 A
4464(*/)S
4185 V
(16607)210 1122 A
(sys_voutb\(char_out,)798 1524 A
(4\);)126 2364 A
3456(/*)S
3582(do)S
(actual)252 3708 A
(output)252 4002 A
4296(*/)S
4275 V
(16608)210 1122 A
1440(})S
4455 V
(16610)210 1122 A
(/*===========================================================================*)3276 1440 A
4545 V
(16611)210 1122 A
1482(*)S
(get_6845)336 2784 A
4674(*)S
4635 V
(16612)210 1122 A
(*===========================================================================*/)3276 1482 A
4725 V
(16613)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(get_6845\(reg,)546 1986 A
(val\))168 2574 A
4815 V
(16614)210 1122 A
(int)126 1440 A
(reg;)168 1608 A
2784(/*)S
(which)210 2910 A
(register)336 3162 A
(pair)168 3540 A
3750(to)S
(set)126 3876 A
4044(*/)S
4905 V
(16615)210 1122 A
(unsigned)336 1440 A
(*val;)210 1818 A
2784(/*)S
(16-bit)252 2910 A
(value)210 3204 A
3456(to)S
(set)126 3582 A
3750(it)S
3876(to)S
4002(*/)S
4995 V
(16616)210 1122 A
1440({)S
5085 V
(16617)210 1122 A
(char)168 1524 A
(v1,)126 1734 A
(v2;)126 1902 A
5175 V
(16618)210 1122 A
1440(/*)S
(Get)126 1566 A
1734(a)S
(register)336 1818 A
(pair)168 2196 A
(inside)252 2406 A
(the)126 2700 A
(6845.)210 2868 A
3162(*/)S
5265 V
(16619)210 1122 A
(sys_outb\(vid_port)714 1524 A
2280(+)S
(INDEX,)252 2364 A
(reg\);)210 2658 A
5355 V
(16620)210 1122 A
(sys_inb\(vid_port)672 1524 A
2238(+)S
(DATA,)210 2322 A
(&v1\);)210 2574 A
5445 V
(16621)210 1122 A
(sys_outb\(vid_port)714 1524 A
2280(+)S
(INDEX,)252 2364 A
(reg+1\);)294 2658 A
5535 V
(16622)210 1122 A
(sys_inb\(vid_port)672 1524 A
2238(+)S
(DATA,)210 2322 A
(&v2\);)210 2574 A
5625 V
(16623)210 1122 A
(*val)168 1524 A
1734(=)S
(\(v1)126 1818 A
1986(<<)S
2112(8\))S
2238(|)S
(v2;)126 2322 A
5715 V
(16624)210 1122 A
1440(})S
5895 V
(16626)210 1122 A
(/*===========================================================================*)3276 1440 A
5985 V
(16627)210 1122 A
1482(*)S
(beep)168 2784 A
4674(*)S
6075 V
(16628)210 1122 A
(*===========================================================================*/)3276 1482 A
6165 V
(16629)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(beep\(\))252 1986 A
6255 V
(16630)210 1122 A
1440({)S
6345 V
(16631)210 1122 A
1440(/*)S
(Making)252 1566 A
1860(a)S
(beeping)294 1944 A
(sound)210 2280 A
2532(on)S
(the)126 2658 A
(speaker)294 2826 A
(\(output)294 3162 A
(for)126 3498 A
(CRTL-G\).)336 3666 A
6435 V
(16632)210 1122 A
1482(*)S
(This)168 1566 A
(routine)294 1776 A
(works)210 2112 A
2364(by)S
(turning)294 2490 A
2826(on)S
(the)126 2952 A
(bits)168 3120 A
3330(0)S
(and)126 3414 A
3582(1)S
3666(in)S
(port)168 3792 A
4002(B)S
4086(of)S
(the)126 4212 A
(8255)168 4380 A
6525 V
(16633)210 1122 A
1482(*)S
(chip)168 1566 A
(that)168 1776 A
(drive)210 1986 A
(the)126 2238 A
(speaker.)336 2406 A
6615 V
(16634)210 1122 A
1482(*/)S
6705 V
(16635)210 1122 A
(static)252 1524 A
(timer_t)294 1818 A
(tmr_stop_beep;)588 2154 A
6795 V
(16636)210 1122 A
(pvb_pair_t)420 1524 A
(char_out[3];)504 1986 A
6885 V
(16637)210 1122 A
(clock_t)294 1524 A
(now;)168 1860 A
6975 V
(16638)210 1122 A
(int)126 1524 A
(port_b_val,)462 1692 A
2196(s;)S
7065 V
(16639)210 1122 A
8418 V
EP
%%Page: 223 223
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
12 B
(223)180 4500 A
1755 V
7 LST
(16640)210 1122 A
1524(/*)S
(Fetch)210 1650 A
(current)294 1902 A
(time)168 2238 A
2448(in)S
(advance)294 2574 A
2910(to)S
(prevent)294 3036 A
(beeping)294 3372 A
(delay.)252 3708 A
4002(*/)S
1845 V
(16641)210 1122 A
1524(if)S
(\(\(s=getuptime\(&now\)\))840 1650 A
2532(!=)S
(OK\))126 2658 A
1935 V
(16642)210 1122 A
(panic\("TTY","Console)840 1776 A
(couldn't)336 2658 A
(get)126 3036 A
(clock's)294 3204 A
(uptime.",)378 3540 A
(s\);)126 3960 A
2025 V
(16643)210 1122 A
1524(if)S
(\(!beeping\))420 1650 A
2112({)S
2115 V
(16644)210 1122 A
1776(/*)S
(Set)126 1902 A
(timer)210 2070 A
(channel)294 2322 A
2658(2,)S
(square)252 2784 A
(wave,)210 3078 A
(with)168 3330 A
(given)210 3540 A
(frequency.)420 3792 A
4254(*/)S
2205 V
(16645)210 1122 A
(pv_set\(char_out[0],)798 1776 A
(TIMER_MODE,)462 2616 A
(0xB6\);)252 3120 A
2295 V
(16646)210 1122 A
(pv_set\(char_out[1],)798 1776 A
(TIMER2,)294 2616 A
(\(BEEP_FREQ)420 2952 A
3414(>>)S
3540(0\))S
3666(&)S
(BYTE\);)252 3750 A
2385 V
(16647)210 1122 A
(pv_set\(char_out[2],)798 1776 A
(TIMER2,)294 2616 A
(\(BEEP_FREQ)420 2952 A
3414(>>)S
3540(8\))S
3666(&)S
(BYTE\);)252 3750 A
2475 V
(16648)210 1122 A
1776(if)S
(\(sys_voutb\(char_out,)840 1902 A
(3\)==OK\))294 2784 A
3120({)S
2565 V
(16649)210 1122 A
2112(if)S
(\(sys_inb\(PORT_B,)672 2238 A
(&port_b_val\)==OK)672 2952 A
3666(&&)S
2655 V
(16650)210 1122 A
(sys_outb\(PORT_B,)672 2280 A
(\(port_b_val|3\)\)==OK\))840 2994 A
2745 V
(16651)210 1122 A
(beeping)294 2448 A
2784(=)S
(TRUE;)210 2868 A
2835 V
(16652)210 1122 A
1776(})S
2925 V
(16653)210 1122 A
1524(})S
3015 V
(16654)210 1122 A
1524(/*)S
(Add)126 1650 A
1818(a)S
(timer)210 1902 A
2154(to)S
(the)126 2280 A
(timers)252 2448 A
(list.)210 2742 A
(Possibly)336 2994 A
(reschedule)420 3372 A
(the)126 3834 A
(alarm.)252 4002 A
4296(*/)S
3105 V
(16655)210 1122 A
(tmrs_settimer\(&tty_timers,)1092 1524 A
(&tmr_stop_beep,)630 2658 A
(now+B_TIME,)462 3330 A
(stop_beep,)420 3834 A
(NULL\);)252 4296 A
3195 V
(16656)210 1122 A
1524(if)S
(\(tty_timers->tmr_exp_time)1050 1650 A
2742(!=)S
(tty_next_timeout\))714 2868 A
3624({)S
3285 V
(16657)210 1122 A
(tty_next_timeout)672 1776 A
2490(=)S
(tty_timers->tmr_exp_time;)1050 2574 A
3375 V
(16658)210 1122 A
1776(if)S
(\(\(s=sys_setalarm\(tty_next_timeout,)1428 1902 A
(1\)\))126 3372 A
3540(!=)S
(OK\))126 3666 A
3465 V
(16659)210 1122 A
(panic\("TTY","Console)840 2112 A
(couldn't)336 2994 A
(set)126 3372 A
(alarm.",)336 3540 A
(s\);)126 3918 A
3555 V
(16660)210 1122 A
1524(})S
3645 V
(16661)210 1122 A
1440(})S
3825 V
(16663)210 1122 A
(/*===========================================================================*)3276 1440 A
3915 V
(16664)210 1122 A
1482(*)S
(stop_beep)378 2784 A
4674(*)S
4005 V
(16665)210 1122 A
(*===========================================================================*/)3276 1482 A
4095 V
(16666)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(stop_beep\(tmrp\))630 1986 A
4185 V
(16667)210 1122 A
(timer_t)294 1440 A
(*tmrp;)252 1776 A
4275 V
(16668)210 1122 A
1440({)S
4365 V
(16669)210 1122 A
1440(/*)S
(Turn)168 1566 A
(off)126 1776 A
(the)126 1944 A
(beeper)252 2112 A
2406(by)S
(turning)294 2532 A
(off)126 2868 A
(bits)168 3036 A
3246(0)S
(and)126 3330 A
3498(1)S
3582(in)S
(PORT_B.)294 3708 A
4044(*/)S
4455 V
(16670)210 1122 A
(int)126 1524 A
(port_b_val;)462 1692 A
4545 V
(16671)210 1122 A
1524(if)S
(\(sys_inb\(PORT_B,)672 1650 A
(&port_b_val\)==OK)672 2364 A
3078(&&)S
4635 V
(16672)210 1122 A
(sys_outb\(PORT_B,)672 1776 A
(\(port_b_val)462 2490 A
2994(&)S
(\3043\)\)==OK\))378 3078 A
4725 V
(16673)210 1122 A
(beeping)294 2112 A
2448(=)S
(FALSE;)252 2532 A
4815 V
(16674)210 1122 A
1440(})S
4995 V
(16676)210 1122 A
(/*===========================================================================*)3276 1440 A
5085 V
(16677)210 1122 A
1482(*)S
(scr_init)336 2784 A
4674(*)S
5175 V
(16678)210 1122 A
(*===========================================================================*/)3276 1482 A
5265 V
(16679)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(scr_init\(tp\))504 1944 A
5355 V
(16680)210 1122 A
(tty_t)210 1440 A
(*tp;)168 1692 A
5445 V
(16681)210 1122 A
1440({)S
5535 V
(16682)210 1122 A
1440(/*)S
(Initialize)420 1566 A
(the)126 2028 A
(screen)252 2196 A
(driver.)294 2490 A
2826(*/)S
5625 V
(16683)210 1122 A
(console_t)378 1524 A
(*cons;)252 1944 A
5715 V
(16684)210 1122 A
(phys_bytes)420 1524 A
(vid_base;)378 1986 A
5805 V
(16685)210 1122 A
(u16_t)210 1524 A
(bios_columns,)546 1776 A
(bios_crtbase,)546 2364 A
(bios_fontlines;)630 2952 A
5895 V
(16686)210 1122 A
(u8_t)168 1524 A
(bios_rows;)420 1734 A
5985 V
(16687)210 1122 A
(int)126 1524 A
(line;)210 1692 A
6075 V
(16688)210 1122 A
(int)126 1524 A
1692(s;)S
6165 V
(16689)210 1122 A
(static)252 1524 A
(int)126 1818 A
(vdu_initialized)630 1986 A
2658(=)S
2742(0;)S
6255 V
(16690)210 1122 A
(unsigned)336 1524 A
(page_size;)420 1902 A
6345 V
(16691)210 1122 A
6435 V
(16692)210 1122 A
1524(/*)S
(Associate)378 1650 A
(console)294 2070 A
(and)126 2406 A
(TTY.)168 2574 A
2784(*/)S
6525 V
(16693)210 1122 A
(line)168 1524 A
1734(=)S
1818(tp)S
1944(-)S
(&tty_table[0];)588 2028 A
6615 V
(16694)210 1122 A
1524(if)S
(\(line)210 1650 A
1902(>=)S
(nr_cons\))336 2028 A
(return;)294 2406 A
6705 V
(16695)210 1122 A
(cons)168 1524 A
1734(=)S
(&cons_table[line];)756 1818 A
6795 V
(16696)210 1122 A
(cons->c_tty)462 1524 A
2028(=)S
(tp;)126 2112 A
6885 V
(16697)210 1122 A
(tp->tty_priv)504 1524 A
2070(=)S
(cons;)210 2154 A
6975 V
(16698)210 1122 A
7065 V
(16699)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(the)126 2112 A
(keyboard)336 2280 A
(driver.)294 2658 A
2994(*/)S
8418 V
EP
%%Page: 224 224
BP
/slant 0 def
/height 0 def
1485 V
12 B
(224)180 1080 A
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(16700)210 1122 A
(kb_init\(tp\);)504 1524 A
1845 V
(16701)210 1122 A
1935 V
(16702)210 1122 A
1524(/*)S
(Fill)168 1650 A
1860(in)S
(TTY)126 1986 A
(function)336 2154 A
(hooks.)252 2532 A
2826(*/)S
2025 V
(16703)210 1122 A
(tp->tty_devwrite)672 1524 A
2238(=)S
(cons_write;)462 2322 A
2115 V
(16704)210 1122 A
(tp->tty_echo)504 1524 A
2070(=)S
(cons_echo;)420 2154 A
2205 V
(16705)210 1122 A
(tp->tty_ioctl)546 1524 A
2112(=)S
(cons_ioctl;)462 2196 A
2295 V
(16706)210 1122 A
2385 V
(16707)210 1122 A
1524(/*)S
(Get)126 1650 A
(the)126 1818 A
(BIOS)168 1986 A
(parameters)420 2196 A
(that)168 2658 A
(describe)336 2868 A
(the)126 3246 A
(VDU.)168 3414 A
3624(*/)S
2475 V
(16708)210 1122 A
1524(if)S
1650(\(!)S
(vdu_initialized++\))756 1776 A
2574({)S
2565 V
(16709)210 1122 A
2655 V
(16710)210 1122 A
1776(/*)S
(How)126 1902 A
(about)210 2070 A
(error)210 2322 A
(checking?)378 2574 A
(What)168 2994 A
3204(to)S
3330(do)S
3456(on)S
(failure???)420 3582 A
4044(*/)S
2745 V
(16711)210 1122 A
(s=sys_vircopy\(SELF,)798 1776 A
(BIOS_SEG,)378 2616 A
(\(vir_bytes\))462 3036 A
(VDU_SCREEN_COLS_ADDR,)882 3540 A
2835 V
(16712)210 1122 A
(SELF,)210 2112 A
2364(D,)S
(\(vir_bytes\))462 2490 A
(&bios_columns,)588 2994 A
(VDU_SCREEN_COLS_SIZE\);)924 3624 A
2925 V
(16713)210 1122 A
(s=sys_vircopy\(SELF,)798 1776 A
(BIOS_SEG,)378 2616 A
(\(vir_bytes\))462 3036 A
(VDU_CRT_BASE_ADDR,)756 3540 A
3015 V
(16714)210 1122 A
(SELF,)210 2112 A
2364(D,)S
(\(vir_bytes\))462 2490 A
(&bios_crtbase,)588 2994 A
(VDU_CRT_BASE_SIZE\);)798 3624 A
3105 V
(16715)210 1122 A
(s=sys_vircopy\(SELF,)798 1776 A
(BIOS_SEG,)378 2616 A
(\(vir_bytes\))462 3036 A
(VDU_SCREEN_ROWS_ADDR,)882 3540 A
3195 V
(16716)210 1122 A
(SELF,)210 2112 A
2364(D,)S
(\(vir_bytes\))462 2490 A
(&bios_rows,)462 2994 A
(VDU_SCREEN_ROWS_SIZE\);)924 3498 A
3285 V
(16717)210 1122 A
(s=sys_vircopy\(SELF,)798 1776 A
(BIOS_SEG,)378 2616 A
(\(vir_bytes\))462 3036 A
(VDU_FONTLINES_ADDR,)798 3540 A
3375 V
(16718)210 1122 A
(SELF,)210 2112 A
2364(D,)S
(\(vir_bytes\))462 2490 A
(&bios_fontlines,)672 2994 A
(VDU_FONTLINES_SIZE\);)840 3708 A
3465 V
(16719)210 1122 A
3555 V
(16720)210 1122 A
(vid_port)336 1776 A
2154(=)S
(bios_crtbase;)546 2238 A
3645 V
(16721)210 1122 A
(scr_width)378 1776 A
2196(=)S
(bios_columns;)546 2280 A
3735 V
(16722)210 1122 A
(font_lines)420 1776 A
2238(=)S
(bios_fontlines;)630 2322 A
3825 V
(16723)210 1122 A
(scr_lines)378 1776 A
2196(=)S
(machine.vdu_ega)630 2280 A
2952(?)S
(bios_rows+1)462 3036 A
3540(:)S
(25;)126 3624 A
3915 V
(16724)210 1122 A
4005 V
(16725)210 1122 A
1776(if)S
(\(color\))294 1902 A
2238({)S
4095 V
(16726)210 1122 A
(vid_base)336 2112 A
2490(=)S
(COLOR_BASE;)462 2574 A
4185 V
(16727)210 1122 A
(vid_size)336 2112 A
2490(=)S
(COLOR_SIZE;)462 2574 A
4275 V
(16728)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
4365 V
(16729)210 1122 A
(vid_base)336 2112 A
2490(=)S
(MONO_BASE;)420 2574 A
4455 V
(16730)210 1122 A
(vid_size)336 2112 A
2490(=)S
(MONO_SIZE;)420 2574 A
4545 V
(16731)210 1122 A
1776(})S
4635 V
(16732)210 1122 A
1776(if)S
(\(machine.vdu_ega\))714 1902 A
(vid_size)336 2658 A
3036(=)S
(EGA_SIZE;)378 3120 A
4725 V
(16733)210 1122 A
(wrap)168 1776 A
1986(=)S
2070(!)S
(machine.vdu_ega;)672 2154 A
4815 V
(16734)210 1122 A
4905 V
(16735)210 1122 A
1776(s)S
1860(=)S
(sys_segctl\(&vid_index,)924 1944 A
(&vid_seg,)378 2910 A
(&vid_off,)378 3330 A
(vid_base,)378 3750 A
(vid_size\);)420 4170 A
4995 V
(16736)210 1122 A
5085 V
(16737)210 1122 A
(vid_size)336 1776 A
(>>=)126 2154 A
2322(1;)S
2784(/*)S
(word)168 2910 A
(count)210 3120 A
3372(*/)S
5175 V
(16738)210 1122 A
(vid_mask)336 1776 A
2154(=)S
(vid_size)336 2238 A
2616(-)S
2700(1;)S
5265 V
(16739)210 1122 A
5355 V
(16740)210 1122 A
1776(/*)S
(Size)168 1902 A
2112(of)S
(the)126 2238 A
(screen)252 2406 A
(\(number)294 2700 A
3036(of)S
(displayed)378 3162 A
(characters.\))504 3582 A
4128(*/)S
5445 V
(16741)210 1122 A
(scr_size)336 1776 A
2154(=)S
(scr_lines)378 2238 A
2658(*)S
(scr_width;)420 2742 A
5535 V
(16742)210 1122 A
5625 V
(16743)210 1122 A
1776(/*)S
(There)210 1902 A
(can)126 2154 A
2322(be)S
2448(as)S
(many)168 2574 A
(consoles)336 2784 A
3162(as)S
(video)210 3288 A
(memory)252 3540 A
(allows.)294 3834 A
4170(*/)S
5715 V
(16744)210 1122 A
(nr_cons)294 1776 A
2112(=)S
(vid_size)336 2196 A
2574(/)S
(scr_size;)378 2658 A
5805 V
(16745)210 1122 A
1776(if)S
(\(nr_cons)336 1902 A
2280(>)S
(NR_CONS\))336 2364 A
(nr_cons)294 2742 A
3078(=)S
(NR_CONS;)336 3162 A
5895 V
(16746)210 1122 A
1776(if)S
(\(nr_cons)336 1902 A
2280(>)S
2364(1\))S
(wrap)168 2490 A
2700(=)S
2784(0;)S
5985 V
(16747)210 1122 A
(page_size)378 1776 A
2196(=)S
(vid_size)336 2280 A
2658(/)S
(nr_cons;)336 2742 A
6075 V
(16748)210 1122 A
1524(})S
6165 V
(16749)210 1122 A
6255 V
(16750)210 1122 A
(cons->c_start)546 1524 A
2112(=)S
(line)168 2196 A
2406(*)S
(page_size;)420 2490 A
6345 V
(16751)210 1122 A
(cons->c_limit)546 1524 A
2112(=)S
(cons->c_start)546 2196 A
2784(+)S
(page_size;)420 2868 A
6435 V
(16752)210 1122 A
(cons->c_cur)462 1524 A
2028(=)S
(cons->c_org)462 2112 A
2616(=)S
(cons->c_start;)588 2700 A
6525 V
(16753)210 1122 A
(cons->c_attr)504 1524 A
2070(=)S
(cons->c_blank)546 2154 A
2742(=)S
(BLANK_COLOR;)504 2826 A
6615 V
(16754)210 1122 A
6705 V
(16755)210 1122 A
1524(if)S
(\(line)210 1650 A
1902(!=)S
2028(0\))S
2154({)S
6795 V
(16756)210 1122 A
1776(/*)S
(Clear)210 1902 A
(the)126 2154 A
(non-console)462 2322 A
(vtys.)210 2826 A
3078(*/)S
6885 V
(16757)210 1122 A
(blank_color)462 1776 A
2280(=)S
(BLANK_COLOR;)504 2364 A
6975 V
(16758)210 1122 A
(mem_vid_copy\(BLANK_MEM,)966 1776 A
(cons->c_start,)588 2784 A
(scr_size\);)420 3414 A
7065 V
(16759)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
8418 V
EP
%%Page: 225 225
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
12 B
(225)180 4500 A
1755 V
7 LST
(16760)210 1122 A
(int)126 1776 A
1944(i,)S
2070(n;)S
1845 V
(16761)210 1122 A
1776(/*)S
(Set)126 1902 A
(the)126 2070 A
(cursor)252 2238 A
2532(of)S
(the)126 2658 A
(console)294 2826 A
(vty)126 3162 A
3330(at)S
(the)126 3456 A
(bottom.)294 3624 A
(c_cur)210 3960 A
1935 V
(16762)210 1122 A
1818(*)S
1902(is)S
(updated)294 2028 A
(automatically)546 2364 A
(later.)252 2952 A
2025 V
(16763)210 1122 A
1818(*/)S
2115 V
(16764)210 1122 A
(scroll_screen\(cons,)798 1776 A
(SCROLL_UP\);)462 2616 A
2205 V
(16765)210 1122 A
(cons->c_row)462 1776 A
2280(=)S
(scr_lines)378 2364 A
2784(-)S
2868(1;)S
2295 V
(16766)210 1122 A
(cons->c_column)588 1776 A
2406(=)S
2490(0;)S
2385 V
(16767)210 1122 A
1524(})S
2475 V
(16768)210 1122 A
(select_console\(0\);)756 1524 A
2565 V
(16769)210 1122 A
(cons_ioctl\(tp,)588 1524 A
(0\);)126 2154 A
2655 V
(16770)210 1122 A
1440(})S
2835 V
(16772)210 1122 A
(/*===========================================================================*)3276 1440 A
2925 V
(16773)210 1122 A
1482(*)S
(kputc)210 2784 A
4674(*)S
3015 V
(16774)210 1122 A
(*===========================================================================*/)3276 1482 A
3105 V
(16775)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(kputc\(c\))336 1944 A
3195 V
(16776)210 1122 A
(int)126 1440 A
1608(c;)S
3285 V
(16777)210 1122 A
1440({)S
3375 V
(16778)210 1122 A
(putk\(c\);)336 1776 A
3465 V
(16779)210 1122 A
1440(})S
3645 V
(16781)210 1122 A
(/*===========================================================================*)3276 1440 A
3735 V
(16782)210 1122 A
1482(*)S
(do_new_kmess)504 2784 A
4674(*)S
3825 V
(16783)210 1122 A
(*===========================================================================*/)3276 1482 A
3915 V
(16784)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(do_new_kmess\(m\))630 1944 A
4005 V
(16785)210 1122 A
(message)294 1440 A
(*m;)126 1776 A
4095 V
(16786)210 1122 A
1440({)S
4185 V
(16787)210 1122 A
1440(/*)S
(Notification)504 1566 A
(for)126 2112 A
2280(a)S
(new)126 2364 A
(kernel)252 2532 A
(message.)336 2826 A
3204(*/)S
4275 V
(16788)210 1122 A
(struct)252 1524 A
(kmessages)378 1818 A
(kmess;)252 2238 A
3456(/*)S
(kmessages)378 3582 A
(structure)378 4002 A
4422(*/)S
4365 V
(16789)210 1122 A
(static)252 1524 A
(int)126 1818 A
(prev_next)378 1986 A
2406(=)S
2490(0;)S
3456(/*)S
(previous)336 3582 A
(next)168 3960 A
(seen)168 4170 A
4380(*/)S
4455 V
(16790)210 1122 A
(int)126 1524 A
(size,)210 1692 A
(next;)210 1944 A
4545 V
(16791)210 1122 A
(int)126 1524 A
(bytes;)252 1692 A
4635 V
(16792)210 1122 A
(int)126 1524 A
1692(r;)S
4725 V
(16793)210 1122 A
4815 V
(16794)210 1122 A
1524(/*)S
(Try)126 1650 A
1818(to)S
(get)126 1944 A
2112(a)S
(fresh)210 2196 A
(copy)168 2448 A
2658(of)S
(the)126 2784 A
(buffer)252 2952 A
(with)168 3246 A
(kernel)252 3456 A
(messages.)378 3750 A
4170(*/)S
4905 V
(16795)210 1122 A
(sys_getkmessages\(&kmess\);)1050 1524 A
4995 V
(16796)210 1122 A
5085 V
(16797)210 1122 A
1524(/*)S
(Print)210 1650 A
(only)168 1902 A
(the)126 2112 A
(new)126 2280 A
(part.)210 2448 A
(Determine)378 2700 A
(how)126 3120 A
(many)168 3288 A
(new)126 3498 A
(bytes)210 3666 A
(there)210 3918 A
(are)126 4170 A
(with)168 4338 A
5175 V
(16798)210 1122 A
1566(*)S
(help)168 1650 A
1860(of)S
(the)126 1986 A
(current)294 2154 A
(and)126 2490 A
(previous)336 2658 A
('next')252 3036 A
(index.)252 3330 A
(Note)168 3624 A
(that)168 3834 A
(the)126 4044 A
(kernel)252 4212 A
5265 V
(16799)210 1122 A
1566(*)S
(buffer)252 1650 A
1944(is)S
(circular.)378 2070 A
(This)168 2490 A
(works)210 2700 A
(fine)168 2952 A
3162(if)S
(less)168 3288 A
(then)168 3498 A
(KMESS_BUF_SIZE)588 3708 A
(bytes)210 4338 A
5355 V
(16800)210 1122 A
1566(*)S
1650(is)S
(new)126 1776 A
(data;)210 1944 A
(else)168 2196 A
2406(we)S
(miss)168 2532 A
2742(%)S
(KMESS_BUF_SIZE)588 2826 A
(here.)210 3456 A
5445 V
(16801)210 1122 A
1566(*)S
(Check)210 1650 A
(for)126 1902 A
(size)168 2070 A
(being)210 2280 A
(positive,)378 2532 A
(the)126 2952 A
(buffer)252 3120 A
(might)210 3414 A
3666(as)S
(well)168 3792 A
4002(be)S
(emptied!)336 4128 A
5535 V
(16802)210 1122 A
1566(*/)S
5625 V
(16803)210 1122 A
1524(if)S
(\(kmess.km_size)588 1650 A
2280(>)S
2364(0\))S
2490({)S
5715 V
(16804)210 1122 A
(bytes)210 1692 A
1944(=)S
(\(\(kmess.km_next)630 2028 A
2700(+)S
(KMESS_BUF_SIZE\))630 2784 A
3456(-)S
(prev_next\))420 3540 A
4002(%)S
(KMESS_BUF_SIZE;)630 4086 A
5805 V
(16805)210 1122 A
(r=prev_next;)504 1692 A
3456(/*)S
(start)210 3582 A
3834(at)S
(previous)336 3960 A
(old)126 4338 A
4506(*/)S
5895 V
(16806)210 1122 A
(while)210 1692 A
(\(bytes)252 1944 A
2238(>)S
2322(0\))S
2448({)S
5985 V
(16807)210 1122 A
(putk\()210 1860 A
(kmess.km_buf[\(r%KMESS_BUF_SIZE\)])1344 2112 A
3498(\);)S
6075 V
(16808)210 1122 A
(bytes)210 1860 A
(--;)126 2112 A
6165 V
(16809)210 1122 A
1860(r)S
(++;)126 1944 A
6255 V
(16810)210 1122 A
1692(})S
6345 V
(16811)210 1122 A
(putk\(0\);)336 1692 A
2784(/*)S
(terminate)378 2910 A
3330(to)S
(flush)210 3456 A
(output)252 3708 A
4002(*/)S
6435 V
(16812)210 1122 A
1524(})S
6525 V
(16813)210 1122 A
6615 V
(16814)210 1122 A
1524(/*)S
(Almost)252 1650 A
(done,)210 1944 A
(store)210 2196 A
('next')252 2448 A
2742(so)S
(that)168 2868 A
3078(we)S
(can)126 3204 A
(determine)378 3372 A
(what)168 3792 A
(part)168 4002 A
4212(of)S
(the)126 4338 A
6705 V
(16815)210 1122 A
1566(*)S
(kernel)252 1650 A
(messages)336 1944 A
(buffer)252 2322 A
2616(to)S
(print)210 2742 A
(next)168 2994 A
(time)168 3204 A
3414(a)S
(notification)504 3498 A
(arrives.)336 4044 A
6795 V
(16816)210 1122 A
1566(*/)S
6885 V
(16817)210 1122 A
(prev_next)378 1524 A
1944(=)S
(kmess.km_next;)588 2028 A
6975 V
(16818)210 1122 A
1440(})S
8418 V
EP
%%Page: 226 226
BP
/slant 0 def
/height 0 def
1485 V
12 B
(226)180 1080 A
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(16820)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(16821)210 1122 A
1482(*)S
(do_diagnostics)588 2784 A
4674(*)S
1935 V
(16822)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(16823)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(do_diagnostics\(m_ptr\))882 1944 A
2115 V
(16824)210 1122 A
(message)294 1440 A
(*m_ptr;)294 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(request)294 3372 A
(message)294 3708 A
4044(*/)S
2205 V
(16825)210 1122 A
1440({)S
2295 V
(16826)210 1122 A
1440(/*)S
(Print)210 1566 A
1818(a)S
(string)252 1902 A
(for)126 2196 A
2364(a)S
(server.)294 2448 A
2784(*/)S
2385 V
(16827)210 1122 A
(char)168 1524 A
1734(c;)S
2475 V
(16828)210 1122 A
(vir_bytes)378 1524 A
(src;)168 1944 A
2565 V
(16829)210 1122 A
(int)126 1524 A
(count;)252 1692 A
2655 V
(16830)210 1122 A
(int)126 1524 A
(result)252 1692 A
1986(=)S
(OK;)126 2070 A
2745 V
(16831)210 1122 A
(int)126 1524 A
(proc_nr)294 1692 A
2028(=)S
(m_ptr->DIAG_PROC_NR;)840 2112 A
2835 V
(16832)210 1122 A
1524(if)S
(\(proc_nr)336 1650 A
2028(==)S
(SELF\))210 2154 A
(proc_nr)294 2406 A
2742(=)S
(m_ptr->m_source;)672 2826 A
2925 V
(16833)210 1122 A
3015 V
(16834)210 1122 A
(src)126 1524 A
1692(=)S
(\(vir_bytes\))462 1776 A
(m_ptr->DIAG_PRINT_BUF;)924 2280 A
3105 V
(16835)210 1122 A
(for)126 1524 A
(\(count)252 1692 A
1986(=)S
(m_ptr->DIAG_BUF_COUNT;)924 2070 A
(count)210 3036 A
3288(>)S
3372(0;)S
(count--\))336 3498 A
3876({)S
3195 V
(16836)210 1122 A
1776(if)S
(\(sys_vircopy\(proc_nr,)882 1902 A
2826(D,)S
(src++,)252 2952 A
(SELF,)210 3246 A
3498(D,)S
(\(vir_bytes\))462 3624 A
(&c,)126 4128 A
4296(1\))S
4422(!=)S
(OK\))126 4548 A
4716({)S
3285 V
(16837)210 1122 A
(result)252 2112 A
2406(=)S
(EFAULT;)294 2490 A
3375 V
(16838)210 1122 A
(break;)252 2112 A
3465 V
(16839)210 1122 A
1776(})S
3555 V
(16840)210 1122 A
(putk\(c\);)336 1776 A
3645 V
(16841)210 1122 A
1524(})S
3735 V
(16842)210 1122 A
(putk\(0\);)336 1524 A
2784(/*)S
(always)252 2910 A
(terminate,)420 3204 A
(even)168 3666 A
(with)168 3876 A
(EFAULT)252 4086 A
4380(*/)S
3825 V
(16843)210 1122 A
(m_ptr->m_type)546 1524 A
2112(=)S
(result;)294 2196 A
3915 V
(16844)210 1122 A
(send\(m_ptr->m_source,)882 1524 A
(m_ptr\);)294 2448 A
4005 V
(16845)210 1122 A
1440(})S
4185 V
(16847)210 1122 A
(/*===========================================================================*)3276 1440 A
4275 V
(16848)210 1122 A
1482(*)S
(putk)168 2784 A
4674(*)S
4365 V
(16849)210 1122 A
(*===========================================================================*/)3276 1482 A
4455 V
(16850)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(putk\(c\))294 1986 A
4545 V
(16851)210 1122 A
(int)126 1440 A
1608(c;)S
2784(/*)S
(character)378 2910 A
3330(to)S
(print)210 3456 A
3708(*/)S
4635 V
(16852)210 1122 A
1440({)S
4725 V
(16853)210 1122 A
1440(/*)S
(This)168 1566 A
(procedure)378 1776 A
2196(is)S
(used)168 2322 A
2532(by)S
(the)126 2658 A
(version)294 2826 A
3162(of)S
(printf\(\))336 3288 A
(that)168 3666 A
3876(is)S
(linked)252 4002 A
(with)168 4296 A
4815 V
(16854)210 1122 A
1482(*)S
(the)126 1566 A
(TTY)126 1734 A
(driver.)294 1902 A
(The)126 2280 A
(one)126 2448 A
2616(in)S
(the)126 2742 A
(library)294 2910 A
(sends)210 3246 A
3498(a)S
(message)294 3582 A
3918(to)S
(FS,)126 4044 A
(which)210 4212 A
4464(is)S
4905 V
(16855)210 1122 A
1482(*)S
(not)126 1566 A
(what)168 1734 A
1944(is)S
(needed)252 2070 A
(for)126 2364 A
(printing)336 2532 A
(within)252 2910 A
(the)126 3204 A
(TTY.)168 3372 A
(This)168 3582 A
(version)294 3792 A
(just)168 4128 A
(queues)252 4338 A
4995 V
(16856)210 1122 A
1482(*)S
(the)126 1566 A
(character)378 1734 A
(and)126 2154 A
(starts)252 2322 A
(the)126 2616 A
(output.)294 2784 A
5085 V
(16857)210 1122 A
1482(*/)S
5175 V
(16858)210 1122 A
1524(if)S
1650(\(c)S
1776(!=)S
1902(0\))S
2028({)S
5265 V
(16859)210 1122 A
1776(if)S
1902(\(c)S
2028(==)S
('\\n'\))210 2154 A
(putk\('\\r'\);)462 2406 A
5355 V
(16860)210 1122 A
(out_char\(&cons_table[0],)1008 1776 A
(\(int\))210 2826 A
(c\);)126 3078 A
5445 V
(16861)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
5535 V
(16862)210 1122 A
(flush\(&cons_table[0]\);)924 1776 A
5625 V
(16863)210 1122 A
1524(})S
5715 V
(16864)210 1122 A
1440(})S
5895 V
(16866)210 1122 A
(/*===========================================================================*)3276 1440 A
5985 V
(16867)210 1122 A
1482(*)S
(toggle_scroll)546 2784 A
4674(*)S
6075 V
(16868)210 1122 A
(*===========================================================================*/)3276 1482 A
6165 V
(16869)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(toggle_scroll\(\))630 1944 A
6255 V
(16870)210 1122 A
1440({)S
6345 V
(16871)210 1122 A
1440(/*)S
(Toggle)252 1566 A
(between)294 1860 A
(hardware)336 2196 A
(and)126 2574 A
(software)336 2742 A
(scroll.)294 3120 A
3456(*/)S
6435 V
(16872)210 1122 A
6525 V
(16873)210 1122 A
(cons_org0\(\);)504 1524 A
6615 V
(16874)210 1122 A
(softscroll)420 1524 A
1986(=)S
(!softscroll;)504 2070 A
6705 V
(16875)210 1122 A
(printf\("%sware)588 1524 A
(scrolling)378 2154 A
(enabled.\\n",)504 2574 A
(softscroll)420 3120 A
3582(?)S
("Soft")252 3666 A
3960(:)S
("Hard"\);)336 4044 A
6795 V
(16876)210 1122 A
1440(})S
8418 V
EP
%%Page: 227 227
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
12 B
(227)180 4500 A
1755 V
7 LST
(16878)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(16879)210 1122 A
1482(*)S
(cons_stop)378 2784 A
4674(*)S
1935 V
(16880)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(16881)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(cons_stop\(\))462 1944 A
2115 V
(16882)210 1122 A
1440({)S
2205 V
(16883)210 1122 A
1440(/*)S
(Prepare)294 1566 A
(for)126 1902 A
(halt)168 2070 A
2280(or)S
(reboot.)294 2406 A
2742(*/)S
2295 V
(16884)210 1122 A
(cons_org0\(\);)504 1524 A
2385 V
(16885)210 1122 A
(softscroll)420 1524 A
1986(=)S
2070(1;)S
2475 V
(16886)210 1122 A
(select_console\(0\);)756 1524 A
2565 V
(16887)210 1122 A
(cons_table[0].c_attr)840 1524 A
2406(=)S
(cons_table[0].c_blank)882 2490 A
3414(=)S
(BLANK_COLOR;)504 3498 A
2655 V
(16888)210 1122 A
1440(})S
2835 V
(16890)210 1122 A
(/*===========================================================================*)3276 1440 A
2925 V
(16891)210 1122 A
1482(*)S
(cons_org0)378 2784 A
4674(*)S
3015 V
(16892)210 1122 A
(*===========================================================================*/)3276 1482 A
3105 V
(16893)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(cons_org0\(\))462 1986 A
3195 V
(16894)210 1122 A
1440({)S
3285 V
(16895)210 1122 A
1440(/*)S
(Scroll)252 1566 A
(video)210 1860 A
(memory)252 2112 A
(back)168 2406 A
2616(to)S
(put)126 2742 A
(the)126 2910 A
(origin)252 3078 A
3372(at)S
3498(0.)S
3624(*/)S
3375 V
(16896)210 1122 A
(int)126 1524 A
(cons_line;)420 1692 A
3465 V
(16897)210 1122 A
(console_t)378 1524 A
(*cons;)252 1944 A
3555 V
(16898)210 1122 A
(unsigned)336 1524 A
1902(n;)S
3645 V
(16899)210 1122 A
3735 V
(16900)210 1122 A
(for)126 1524 A
(\(cons_line)420 1692 A
2154(=)S
2238(0;)S
(cons_line)378 2364 A
2784(<)S
(nr_cons;)336 2868 A
(cons_line++\))504 3246 A
3792({)S
3825 V
(16901)210 1122 A
(cons)168 1776 A
1986(=)S
(&cons_table[cons_line];)966 2070 A
3915 V
(16902)210 1122 A
(while)210 1776 A
(\(cons->c_org)504 2028 A
2574(>)S
(cons->c_start\))588 2658 A
3288({)S
4005 V
(16903)210 1122 A
2112(n)S
2196(=)S
(vid_size)336 2280 A
2658(-)S
(scr_size;)378 2742 A
3456(/*)S
(amount)252 3582 A
3876(of)S
(unused)252 4002 A
(memory)252 4296 A
4590(*/)S
4095 V
(16904)210 1122 A
2112(if)S
2238(\(n)S
2364(>)S
(cons->c_org)462 2448 A
2952(-)S
(cons->c_start\))588 3036 A
4185 V
(16905)210 1122 A
2448(n)S
2532(=)S
(cons->c_org)462 2616 A
3120(-)S
(cons->c_start;)588 3204 A
4275 V
(16906)210 1122 A
(vid_vid_copy\(cons->c_org,)1050 2112 A
(cons->c_org)462 3204 A
3708(-)S
3792(n,)S
(scr_size\);)420 3918 A
4365 V
(16907)210 1122 A
(cons->c_org)462 2112 A
2616(-=)S
2742(n;)S
4455 V
(16908)210 1122 A
1776(})S
4545 V
(16909)210 1122 A
(flush\(cons\);)504 1776 A
4635 V
(16910)210 1122 A
1524(})S
4725 V
(16911)210 1122 A
(select_console\(ccurrent\);)1050 1524 A
4815 V
(16912)210 1122 A
1440(})S
4995 V
(16914)210 1122 A
(/*===========================================================================*)3276 1440 A
5085 V
(16915)210 1122 A
1482(*)S
(select_console)588 2784 A
4674(*)S
5175 V
(16916)210 1122 A
(*===========================================================================*/)3276 1482 A
5265 V
(16917)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(select_console\(int)756 1944 A
(cons_line\))420 2742 A
5355 V
(16918)210 1122 A
1440({)S
5445 V
(16919)210 1122 A
1440(/*)S
(Set)126 1566 A
(the)126 1734 A
(current)294 1902 A
(console)294 2238 A
2574(to)S
(console)294 2700 A
(number)252 3036 A
('cons_line'.)504 3330 A
3876(*/)S
5535 V
(16920)210 1122 A
5625 V
(16921)210 1122 A
1524(if)S
(\(cons_line)420 1650 A
2112(<)S
2196(0)S
2280(||)S
(cons_line)378 2406 A
2826(>=)S
(nr_cons\))336 2952 A
(return;)294 3330 A
5715 V
(16922)210 1122 A
(ccurrent)336 1524 A
1902(=)S
(cons_line;)420 1986 A
5805 V
(16923)210 1122 A
(curcons)294 1524 A
1860(=)S
(&cons_table[cons_line];)966 1944 A
5895 V
(16924)210 1122 A
(set_6845\(VID_ORG,)714 1524 A
(curcons->c_org\);)672 2280 A
5985 V
(16925)210 1122 A
(set_6845\(CURSOR,)672 1524 A
(curcons->c_cur\);)672 2238 A
6075 V
(16926)210 1122 A
1440(})S
6255 V
(16928)210 1122 A
(/*===========================================================================*)3276 1440 A
6345 V
(16929)210 1122 A
1482(*)S
(con_loadfont)504 2784 A
4674(*)S
6435 V
(16930)210 1122 A
(*===========================================================================*/)3276 1482 A
6525 V
(16931)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(con_loadfont\(m\))630 1902 A
6615 V
(16932)210 1122 A
(message)294 1440 A
(*m;)126 1776 A
6705 V
(16933)210 1122 A
1440({)S
6795 V
(16934)210 1122 A
1440(/*)S
(Load)168 1566 A
1776(a)S
(font)168 1860 A
(into)168 2070 A
(the)126 2280 A
(EGA)126 2448 A
2616(or)S
(VGA)126 2742 A
(adapter.)336 2910 A
3288(*/)S
6885 V
(16935)210 1122 A
(int)126 1524 A
(result;)294 1692 A
6975 V
(16936)210 1122 A
(static)252 1524 A
(struct)252 1818 A
(sequence)336 2112 A
(seq1[7])294 2490 A
2826(=)S
2910({)S
7065 V
(16937)210 1122 A
1776({)S
(GA_SEQUENCER_INDEX,)798 1860 A
(0x00,)210 2700 A
(0x01)168 2952 A
3162(},)S
8418 V
EP
%%Page: 228 228
BP
/slant 0 def
/height 0 def
1485 V
12 B
(228)180 1080 A
11 R
2311(File:)S
(drivers/tty/console.c)904 2544 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(16938)210 1122 A
1776({)S
(GA_SEQUENCER_INDEX,)798 1860 A
(0x02,)210 2700 A
(0x04)168 2952 A
3162(},)S
1845 V
(16939)210 1122 A
1776({)S
(GA_SEQUENCER_INDEX,)798 1860 A
(0x04,)210 2700 A
(0x07)168 2952 A
3162(},)S
1935 V
(16940)210 1122 A
1776({)S
(GA_SEQUENCER_INDEX,)798 1860 A
(0x00,)210 2700 A
(0x03)168 2952 A
3162(},)S
2025 V
(16941)210 1122 A
1776({)S
(GA_GRAPHICS_INDEX,)756 1860 A
(0x04,)210 2658 A
(0x02)168 2910 A
3120(},)S
2115 V
(16942)210 1122 A
1776({)S
(GA_GRAPHICS_INDEX,)756 1860 A
(0x05,)210 2658 A
(0x00)168 2910 A
3120(},)S
2205 V
(16943)210 1122 A
1776({)S
(GA_GRAPHICS_INDEX,)756 1860 A
(0x06,)210 2658 A
(0x00)168 2910 A
3120(},)S
2295 V
(16944)210 1122 A
1524(};)S
2385 V
(16945)210 1122 A
(static)252 1524 A
(struct)252 1818 A
(sequence)336 2112 A
(seq2[7])294 2490 A
2826(=)S
2910({)S
2475 V
(16946)210 1122 A
1776({)S
(GA_SEQUENCER_INDEX,)798 1860 A
(0x00,)210 2700 A
(0x01)168 2952 A
3162(},)S
2565 V
(16947)210 1122 A
1776({)S
(GA_SEQUENCER_INDEX,)798 1860 A
(0x02,)210 2700 A
(0x03)168 2952 A
3162(},)S
2655 V
(16948)210 1122 A
1776({)S
(GA_SEQUENCER_INDEX,)798 1860 A
(0x04,)210 2700 A
(0x03)168 2952 A
3162(},)S
2745 V
(16949)210 1122 A
1776({)S
(GA_SEQUENCER_INDEX,)798 1860 A
(0x00,)210 2700 A
(0x03)168 2952 A
3162(},)S
2835 V
(16950)210 1122 A
1776({)S
(GA_GRAPHICS_INDEX,)756 1860 A
(0x04,)210 2658 A
(0x00)168 2910 A
3120(},)S
2925 V
(16951)210 1122 A
1776({)S
(GA_GRAPHICS_INDEX,)756 1860 A
(0x05,)210 2658 A
(0x10)168 2910 A
3120(},)S
3015 V
(16952)210 1122 A
1776({)S
(GA_GRAPHICS_INDEX,)756 1860 A
(0x06,)210 2658 A
3036(0)S
3120(},)S
3105 V
(16953)210 1122 A
1524(};)S
3195 V
(16954)210 1122 A
3285 V
(16955)210 1122 A
(seq2[6].value=)588 1524 A
(color)210 2154 A
2406(?)S
(0x0E)168 2490 A
2700(:)S
(0x0A;)210 2784 A
3375 V
(16956)210 1122 A
3465 V
(16957)210 1122 A
1524(if)S
(\(!machine.vdu_ega\))756 1650 A
(return\(ENOTTY\);)630 2448 A
3555 V
(16958)210 1122 A
(result)252 1524 A
1818(=)S
(ga_program\(seq1\);)714 1902 A
2784(/*)S
(bring)210 2910 A
(font)168 3162 A
(memory)252 3372 A
(into)168 3666 A
(view)168 3876 A
4086(*/)S
3645 V
(16959)210 1122 A
3735 V
(16960)210 1122 A
(result)252 1524 A
1818(=)S
(sys_physcopy\(m->PROC_NR,)1008 1902 A
2952(D,)S
(\(vir_bytes\))462 3078 A
(m->ADDRESS,)462 3582 A
3825 V
(16961)210 1122 A
(NONE,)210 1776 A
(PHYS_SEG,)378 2028 A
(\(phys_bytes\))504 2448 A
(GA_VIDEO_ADDRESS,)714 2994 A
(\(phys_bytes\)GA_FONT_SIZE\);)1092 3750 A
3915 V
(16962)210 1122 A
4005 V
(16963)210 1122 A
(result)252 1524 A
1818(=)S
(ga_program\(seq2\);)714 1902 A
2784(/*)S
(restore)294 2910 A
3246(*/)S
4095 V
(16964)210 1122 A
4185 V
(16965)210 1122 A
(return\(result\);)630 1524 A
4275 V
(16966)210 1122 A
1440(})S
4455 V
(16968)210 1122 A
(/*===========================================================================*)3276 1440 A
4545 V
(16969)210 1122 A
1482(*)S
(ga_program)420 2784 A
4674(*)S
4635 V
(16970)210 1122 A
(*===========================================================================*/)3276 1482 A
4725 V
(16971)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(ga_program\(seq\))630 1944 A
4815 V
(16972)210 1122 A
(struct)252 1440 A
(sequence)336 1734 A
(*seq;)210 2112 A
4905 V
(16973)210 1122 A
1440({)S
4995 V
(16974)210 1122 A
(pvb_pair_t)420 1524 A
(char_out[14];)546 1986 A
5085 V
(16975)210 1122 A
(int)126 1524 A
1692(i;)S
5175 V
(16976)210 1122 A
(for)126 1524 A
(\(i=0;)210 1692 A
(i<7;)168 1944 A
(i++\))168 2154 A
2364({)S
5265 V
(16977)210 1122 A
(pv_set\(char_out[2*i],)882 1692 A
(seq->index,)462 2616 A
(seq->port\);)462 3120 A
5355 V
(16978)210 1122 A
(pv_set\(char_out[2*i+1],)966 1692 A
(seq->index+1,)546 2700 A
(seq->value\);)504 3288 A
5445 V
(16979)210 1122 A
(seq++;)252 1692 A
5535 V
(16980)210 1122 A
1524(})S
5625 V
(16981)210 1122 A
(return)252 1524 A
(sys_voutb\(char_out,)798 1818 A
(14\);)168 2658 A
5715 V
(16982)210 1122 A
1440(})S
5895 V
(16984)210 1122 A
(/*===========================================================================*)3276 1440 A
5985 V
(16985)210 1122 A
1482(*)S
(cons_ioctl)420 2784 A
4674(*)S
6075 V
(16986)210 1122 A
(*===========================================================================*/)3276 1482 A
6165 V
(16987)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(cons_ioctl\(tp,)588 1944 A
(try\))168 2574 A
6255 V
(16988)210 1122 A
(tty_t)210 1440 A
(*tp;)168 1692 A
6345 V
(16989)210 1122 A
(int)126 1440 A
(try;)168 1608 A
6435 V
(16990)210 1122 A
1440({)S
6525 V
(16991)210 1122 A
1440(/*)S
(Set)126 1566 A
(the)126 1734 A
(screen)252 1902 A
(dimensions.)462 2196 A
2700(*/)S
6615 V
(16992)210 1122 A
6705 V
(16993)210 1122 A
(tp->tty_winsize.ws_row=)966 1524 A
(scr_lines;)420 2532 A
6795 V
(16994)210 1122 A
(tp->tty_winsize.ws_col=)966 1524 A
(scr_width;)420 2532 A
6885 V
(16995)210 1122 A
(tp->tty_winsize.ws_xpixel=)1092 1524 A
(scr_width)378 2658 A
3078(*)S
3162(8;)S
6975 V
(16996)210 1122 A
(tp->tty_winsize.ws_ypixel=)1092 1524 A
(scr_lines)378 2658 A
3078(*)S
(font_lines;)462 3162 A
7065 V
(16997)210 1122 A
1440(})S
8418 V
EP
%%Page: 229 229
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2392(File:)S
2625(servers/pm/pm.h)S
12 B
(229)180 4500 A
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(servers/pm/pm.h)630 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(17000)210 1122 A
1440(/*)S
(This)168 1566 A
1776(is)S
(the)126 1902 A
(master)252 2070 A
(header)252 2364 A
(for)126 2658 A
(PM.)126 2826 A
3036(It)S
(includes)336 3162 A
(some)168 3540 A
(other)210 3750 A
(files)210 4002 A
2295 V
(17001)210 1122 A
1482(*)S
(and)126 1566 A
(defines)294 1734 A
(the)126 2070 A
(principal)378 2238 A
(constants.)420 2658 A
2385 V
(17002)210 1122 A
1482(*/)S
2475 V
(17003)210 1122 A
(#define)294 1440 A
(_POSIX_SOURCE)546 1776 A
2574(1)S
2784(/*)S
(tell)168 2910 A
(headers)294 3120 A
3456(to)S
(include)294 3582 A
(POSIX)210 3918 A
(stuff)210 4170 A
4422(*/)S
2565 V
(17004)210 1122 A
(#define)294 1440 A
(_MINIX)252 1776 A
2574(1)S
2784(/*)S
(tell)168 2910 A
(headers)294 3120 A
3456(to)S
(include)294 3582 A
(MINIX)210 3918 A
(stuff)210 4170 A
4422(*/)S
2655 V
(17005)210 1122 A
(#define)294 1440 A
(_SYSTEM)294 1776 A
2574(1)S
2784(/*)S
(tell)168 2910 A
(headers)294 3120 A
(that)168 3456 A
(this)168 3666 A
3876(is)S
(the)126 4002 A
(kernel)252 4170 A
4464(*/)S
2745 V
(17006)210 1122 A
2835 V
(17007)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(are)126 2154 A
2322(so)S
(basic,)252 2448 A
(all)126 2742 A
(the)126 2910 A
(*.c)126 3078 A
(files)210 3246 A
(get)126 3498 A
(them)168 3666 A
(automatically.)588 3876 A
4506(*/)S
2925 V
(17008)210 1122 A
(#include)336 1440 A
(<minix/config.h>)672 1818 A
2784(/*)S
(MUST)168 2910 A
3120(be)S
(first)210 3246 A
3498(*/)S
3015 V
(17009)210 1122 A
(#include)336 1440 A
(<ansi.h>)336 1818 A
2784(/*)S
(MUST)168 2910 A
3120(be)S
(second)252 3246 A
3540(*/)S
3105 V
(17010)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
3195 V
(17011)210 1122 A
(#include)336 1440 A
(<minix/const.h>)630 1818 A
3285 V
(17012)210 1122 A
(#include)336 1440 A
(<minix/type.h>)588 1818 A
3375 V
(17013)210 1122 A
3465 V
(17014)210 1122 A
(#include)336 1440 A
(<fcntl.h>)378 1818 A
3555 V
(17015)210 1122 A
(#include)336 1440 A
(<unistd.h>)420 1818 A
3645 V
(17016)210 1122 A
(#include)336 1440 A
(<minix/syslib.h>)672 1818 A
3735 V
(17017)210 1122 A
(#include)336 1440 A
(<minix/sysutil.h>)714 1818 A
3825 V
(17018)210 1122 A
3915 V
(17019)210 1122 A
(#include)336 1440 A
(<limits.h>)420 1818 A
4005 V
(17020)210 1122 A
(#include)336 1440 A
(<errno.h>)378 1818 A
4095 V
(17021)210 1122 A
4185 V
(17022)210 1122 A
(#include)336 1440 A
("const.h")378 1818 A
4275 V
(17023)210 1122 A
(#include)336 1440 A
("type.h")336 1818 A
4365 V
(17024)210 1122 A
(#include)336 1440 A
("proto.h")378 1818 A
4455 V
(17025)210 1122 A
(#include)336 1440 A
("glo.h")294 1818 A
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(servers/pm/const.h)756 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(17100)210 1122 A
1440(/*)S
(Constants)378 1566 A
(used)168 1986 A
2196(by)S
(the)126 2322 A
(Process)294 2490 A
(Manager.)336 2826 A
3204(*/)S
5445 V
(17101)210 1122 A
5535 V
(17102)210 1122 A
(#define)294 1440 A
(NO_MEM)252 1776 A
(\(\(phys_clicks\))588 2070 A
2700(0\))S
2868(/*)S
(returned)336 2994 A
3372(by)S
(alloc_mem\(\))462 3498 A
(with)168 4002 A
(mem)126 4212 A
4380(is)S
4506(up)S
4632(*/)S
5625 V
(17103)210 1122 A
5715 V
(17104)210 1122 A
(#define)294 1440 A
(NR_PIDS)294 1776 A
(30000)210 2406 A
2784(/*)S
(process)294 2910 A
(ids)126 3246 A
(range)210 3414 A
(from)168 3666 A
3876(0)S
3960(to)S
(NR_PIDS-1.)420 4086 A
5805 V
(17105)210 1122 A
2826(*)S
(\(magic)252 2910 A
(constant:)378 3204 A
(some)168 3624 A
(old)126 3834 A
(applications)504 4002 A
(use)126 4548 A
5895 V
(17106)210 1122 A
2826(*)S
2910(a)S
('short')294 2994 A
(instead)294 3330 A
3666(of)S
(pid_t.\))294 3792 A
5985 V
(17107)210 1122 A
2826(*/)S
6075 V
(17108)210 1122 A
6165 V
(17109)210 1122 A
(#define)294 1440 A
(PM_PID)252 1776 A
2574(0)S
2784(/*)S
(PM's)168 2910 A
(process)294 3120 A
3456(id)S
(number)252 3582 A
3876(*/)S
6255 V
(17110)210 1122 A
(#define)294 1440 A
(INIT_PID)336 1776 A
2574(1)S
2784(/*)S
(INIT's)252 2910 A
(process)294 3204 A
3540(id)S
(number)252 3666 A
3960(*/)S
6345 V
(17111)210 1122 A
8418 V
EP
%%Page: 230 230
BP
/slant 0 def
/height 0 def
1485 V
12 B
(230)180 1080 A
11 R
2367(File:)S
2600(servers/pm/type.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(servers/pm/type.h)714 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(17200)210 1122 A
1440(/*)S
1566(If)S
(there)210 1692 A
(were)168 1944 A
(any)126 2154 A
(type)168 2322 A
(definitions)462 2532 A
(local)210 3036 A
3288(to)S
(the)126 3414 A
(Process)294 3582 A
(Manager,)336 3918 A
(they)168 4296 A
(would)210 4506 A
2295 V
(17201)210 1122 A
1482(*)S
1566(be)S
(here.)210 1692 A
(This)168 1986 A
(file)168 2196 A
2406(is)S
(included)336 2532 A
(only)168 2910 A
(for)126 3120 A
(symmetry)336 3288 A
(with)168 3666 A
(the)126 3876 A
(kernel)252 4044 A
(and)126 4338 A
(File)168 4506 A
2385 V
(17202)210 1122 A
1482(*)S
(System,)294 1566 A
(which)210 1902 A
2154(do)S
(have)168 2280 A
(some)168 2490 A
(local)210 2700 A
(type)168 2952 A
(definitions.)504 3162 A
2475 V
(17203)210 1122 A
1482(*/)S
2565 V
(17204)210 1122 A
2745 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2835 V
(servers/pm/proto.h)756 2676 A
2925 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3105 V
(17300)210 1122 A
1440(/*)S
(Function)336 1566 A
(prototypes.)462 1944 A
2448(*/)S
3195 V
(17301)210 1122 A
3285 V
(17302)210 1122 A
(struct)252 1440 A
(mproc;)252 1734 A
3375 V
(17303)210 1122 A
(struct)252 1440 A
(stat;)210 1734 A
3465 V
(17304)210 1122 A
(struct)252 1440 A
(mem_map;)336 1734 A
3555 V
(17305)210 1122 A
(struct)252 1440 A
(memory;)294 1734 A
3645 V
(17306)210 1122 A
3735 V
(17307)210 1122 A
(#include)336 1440 A
(<timers.h>)420 1818 A
3825 V
(17308)210 1122 A
3915 V
(17309)210 1122 A
1440(/*)S
(alloc.c)294 1566 A
1902(*/)S
4005 V
(17310)210 1122 A
(_PROTOTYPE\()462 1440 A
(phys_clicks)462 1944 A
(alloc_mem,)420 2448 A
(\(phys_clicks)504 2910 A
(clicks\))294 3456 A
4464(\);)S
4095 V
(17311)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(free_mem,)378 2154 A
(\(phys_clicks)504 2574 A
(base,)210 3120 A
(phys_clicks)462 3372 A
(clicks\))294 3876 A
4464(\);)S
4185 V
(17312)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(mem_init,)378 2154 A
(\(struct)294 2574 A
(memory)252 2910 A
(*chunks,)336 3204 A
(phys_clicks)462 3582 A
(*free\))252 4086 A
4464(\);)S
4275 V
(17313)210 1122 A
(#define)294 1440 A
(swap_in\(\))378 1776 A
(\(\(void\)0\))378 3120 A
4365 V
(17314)210 1122 A
(#define)294 1440 A
(swap_inqueue\(rmp\))714 1776 A
(\(\(void\)0\))378 3120 A
4455 V
(17315)210 1122 A
4545 V
(17316)210 1122 A
1440(/*)S
(break.c)294 1566 A
1902(*/)S
4635 V
(17317)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(adjust,)294 2112 A
(\(struct)294 2448 A
(mproc)210 2784 A
(*rmp,)210 3036 A
4725 V
(17318)210 1122 A
(vir_clicks)420 2448 A
(data_clicks,)504 2910 A
(vir_bytes)378 3456 A
(sp\))126 3876 A
4464(\);)S
4815 V
(17319)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_brk,)294 2112 A
(\(void\))252 2448 A
4464(\);)S
4905 V
(17320)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(size_ok,)336 2112 A
(\(int)168 2490 A
(file_type,)420 2700 A
(vir_clicks)420 3162 A
(tc,)126 3624 A
(vir_clicks)420 3792 A
(dc,)126 4254 A
4995 V
(17321)210 1122 A
(vir_clicks)420 2448 A
(sc,)126 2910 A
(vir_clicks)420 3078 A
(dvir,)210 3540 A
(vir_clicks)420 3792 A
(s_vir\))252 4254 A
4548(\);)S
5085 V
(17322)210 1122 A
5175 V
(17323)210 1122 A
1440(/*)S
(devio.c)294 1566 A
1902(*/)S
5265 V
(17324)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_dev_io,)420 2112 A
(\(void\))252 2574 A
2868(\);)S
5355 V
(17325)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_dev_io,)420 2112 A
(\(void\))252 2574 A
2868(\);)S
5445 V
(17326)210 1122 A
5535 V
(17327)210 1122 A
1440(/*)S
(dmp.c)210 1566 A
1818(*/)S
5625 V
(17328)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_fkey_pressed,)672 2112 A
(\(void\))252 2826 A
4800(\);)S
5715 V
(17329)210 1122 A
5805 V
(17330)210 1122 A
1440(/*)S
(exec.c)252 1566 A
1860(*/)S
5895 V
(17331)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_exec,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
5985 V
(17332)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(rw_seg,)294 2154 A
(\(int)168 2490 A
(rw,)126 2700 A
(int)126 2868 A
(fd,)126 3036 A
(int)126 3204 A
(proc,)210 3372 A
(int)126 3624 A
(seg,)168 3792 A
6075 V
(17333)210 1122 A
(phys_bytes)420 3456 A
(seg_bytes\))420 3918 A
4464(\);)S
6165 V
(17334)210 1122 A
(_PROTOTYPE\()462 1440 A
(struct)252 1944 A
(mproc)210 2238 A
(*find_share,)504 2490 A
(\(struct)294 3036 A
(mproc)210 3372 A
(*mp_ign,)336 3624 A
(Ino_t)210 4002 A
(ino,)168 4254 A
6255 V
(17335)210 1122 A
(Dev_t)210 2448 A
(dev,)168 2700 A
(time_t)252 2910 A
(ctime\))252 3204 A
4464(\);)S
6345 V
(17336)210 1122 A
6435 V
(17337)210 1122 A
1440(/*)S
(forkexit.c)420 1566 A
2028(*/)S
6525 V
(17338)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_fork,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
6615 V
(17339)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_pm_exit,)462 2112 A
(\(void\))252 2616 A
4464(\);)S
6705 V
(17340)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_waitpid,)462 2112 A
(\(void\))252 2616 A
4464(\);)S
6795 V
(17341)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(pm_exit,)336 2154 A
(\(struct)294 2532 A
(mproc)210 2868 A
(*rmp,)210 3120 A
(int)126 3372 A
(exit_status\))504 3540 A
4464(\);)S
6885 V
(17342)210 1122 A
6975 V
(17343)210 1122 A
1440(/*)S
(getset.c)336 1566 A
1944(*/)S
7065 V
(17344)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_getset,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
8418 V
EP
%%Page: 231 231
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2346(File:)S
2579(servers/pm/proto.h)S
12 B
(231)180 4500 A
1755 V
7 LST
(17345)210 1122 A
1845 V
(17346)210 1122 A
1440(/*)S
(main.c)252 1566 A
1860(*/)S
1935 V
(17347)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(main,)210 2112 A
(\(void\))252 2364 A
4464(\);)S
2025 V
(17348)210 1122 A
2115 V
(17349)210 1122 A
1440(/*)S
(misc.c)252 1566 A
1860(*/)S
2205 V
(17350)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_reboot,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
2295 V
(17351)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_getsysinfo,)588 2112 A
(\(void\))252 2742 A
4464(\);)S
2385 V
(17352)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_getprocnr,)546 2112 A
(\(void\))252 2700 A
4464(\);)S
2475 V
(17353)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_svrctl,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
2565 V
(17354)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_allocmem,)504 2112 A
(\(void\))252 2658 A
4464(\);)S
2655 V
(17355)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_freemem,)462 2112 A
(\(void\))252 2616 A
4464(\);)S
2745 V
(17356)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_getsetpriority,)756 2112 A
(\(void\))252 2910 A
4800(\);)S
2835 V
(17357)210 1122 A
2925 V
(17358)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(setreply,)378 2154 A
(\(int)168 2574 A
(proc_nr,)336 2784 A
(int)126 3162 A
(result\))294 3330 A
4464(\);)S
3015 V
(17359)210 1122 A
3105 V
(17360)210 1122 A
1440(/*)S
(signal.c)336 1566 A
1944(*/)S
3195 V
(17361)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_alarm,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
3285 V
(17362)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_kill,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
3375 V
(17363)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(ksig_pending,)546 2112 A
(\(void\))252 2700 A
4464(\);)S
3465 V
(17364)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_pause,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
3555 V
(17365)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(set_alarm,)420 2112 A
(\(int)168 2574 A
(proc_nr,)336 2784 A
(int)126 3162 A
(sec\))168 3330 A
4464(\);)S
3645 V
(17366)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(check_sig,)420 2112 A
(\(pid_t)252 2574 A
(proc_id,)336 2868 A
(int)126 3246 A
(signo\))252 3414 A
4464(\);)S
3735 V
(17367)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(sig_proc,)378 2154 A
(\(struct)294 2574 A
(mproc)210 2910 A
(*rmp,)210 3162 A
(int)126 3414 A
(sig_nr\))294 3582 A
4464(\);)S
3825 V
(17368)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_sigaction,)546 2112 A
(\(void\))252 2700 A
4464(\);)S
3915 V
(17369)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_sigpending,)588 2112 A
(\(void\))252 2742 A
4464(\);)S
4005 V
(17370)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_sigprocmask,)630 2112 A
(\(void\))252 2784 A
4464(\);)S
4095 V
(17371)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_sigreturn,)546 2112 A
(\(void\))252 2700 A
4464(\);)S
4185 V
(17372)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_sigsuspend,)588 2112 A
(\(void\))252 2742 A
4464(\);)S
4275 V
(17373)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(check_pending,)588 2154 A
(\(struct)294 2784 A
(mproc)210 3120 A
(*rmp\))210 3372 A
4464(\);)S
4365 V
(17374)210 1122 A
4455 V
(17375)210 1122 A
1440(/*)S
(time.c)252 1566 A
1860(*/)S
4545 V
(17376)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_stime,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
4635 V
(17377)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_time,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
4725 V
(17378)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_times,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
4815 V
(17379)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_gettimeofday,)672 2112 A
(\(void\))252 2826 A
4464(\);)S
4905 V
(17380)210 1122 A
4995 V
(17381)210 1122 A
1440(/*)S
(timers.c)336 1566 A
1944(*/)S
5085 V
(17382)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(pm_set_timer,)546 2154 A
(\(timer_t)336 2742 A
(*tp,)168 3120 A
(int)126 3330 A
(delta,)252 3498 A
5175 V
(17383)210 1122 A
(tmr_func_t)420 1776 A
(watchdog,)378 2238 A
(int)126 2658 A
(arg\)\);)252 2826 A
5265 V
(17384)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(pm_expire_timers,)714 2154 A
(\(clock_t)336 2910 A
(now\)\);)252 3288 A
5355 V
(17385)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(pm_cancel_timer,)672 2154 A
(\(timer_t)336 2868 A
(*tp\)\);)252 3246 A
5445 V
(17386)210 1122 A
5535 V
(17387)210 1122 A
1440(/*)S
(trace.c)294 1566 A
1902(*/)S
5625 V
(17388)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_trace,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
5715 V
(17389)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(stop_proc,)420 2154 A
(\(struct)294 2616 A
(mproc)210 2952 A
(*rmp,)210 3204 A
(int)126 3456 A
(sig_nr\))294 3624 A
4464(\);)S
5805 V
(17390)210 1122 A
5895 V
(17391)210 1122 A
1440(/*)S
(utility.c)378 1566 A
1986(*/)S
5985 V
(17392)210 1122 A
(_PROTOTYPE\()462 1440 A
(pid_t)210 1944 A
(get_free_pid,)546 2196 A
(\(void\))252 2784 A
4464(\);)S
6075 V
(17393)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(allowed,)336 2112 A
(\(char)210 2490 A
(*name_buf,)420 2742 A
(struct)252 3204 A
(stat)168 3498 A
(*s_buf,)294 3708 A
(int)126 4044 A
(mask\))210 4212 A
4464(\);)S
6165 V
(17394)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(no_sys,)294 2112 A
(\(void\))252 2448 A
4464(\);)S
6255 V
(17395)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(panic,)252 2154 A
(\(char)210 2448 A
(*who,)210 2700 A
(char)168 2952 A
(*mess,)252 3162 A
(int)126 3456 A
(num\))168 3624 A
4464(\);)S
6345 V
(17396)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(tell_fs,)336 2154 A
(\(int)168 2532 A
(what,)210 2742 A
(int)126 2994 A
(p1,)126 3162 A
(int)126 3330 A
(p2,)126 3498 A
(int)126 3666 A
(p3\))126 3834 A
4464(\);)S
6435 V
(17397)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(get_stack_ptr,)588 2112 A
(\(int)168 2742 A
(proc_nr,)336 2952 A
(vir_bytes)378 3330 A
(*sp\))168 3750 A
4464(\);)S
6525 V
(17398)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(get_mem_map,)504 2112 A
(\(int)168 2658 A
(proc_nr,)336 2868 A
(struct)252 3246 A
(mem_map)294 3540 A
(*mem_map\))378 3876 A
4464(\);)S
6615 V
(17399)210 1122 A
(_PROTOTYPE\()462 1440 A
(char)168 1944 A
(*find_param,)504 2154 A
(\(const)252 2700 A
(char)168 2994 A
(*key\)\);)294 3204 A
6705 V
(17400)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(proc_from_pid,)588 2112 A
(\(pid_t)252 2742 A
(p\)\);)168 3036 A
8418 V
EP
%%Page: 232 232
BP
/slant 0 def
/height 0 def
1485 V
12 B
(232)180 1080 A
11 R
2392(File:)S
2625(servers/pm/glo.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(servers/pm/glo.h)672 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(17500)210 1122 A
1440(/*)S
(EXTERN)252 1566 A
(should)252 1860 A
2154(be)S
(extern)252 2280 A
(except)252 2574 A
2868(in)S
(table.c)294 2994 A
3330(*/)S
2295 V
(17501)210 1122 A
(#ifdef)252 1440 A
(_TABLE)252 1734 A
2385 V
(17502)210 1122 A
(#undef)252 1440 A
(EXTERN)252 1734 A
2475 V
(17503)210 1122 A
(#define)294 1440 A
(EXTERN)252 1776 A
2565 V
(17504)210 1122 A
(#endif)252 1440 A
2655 V
(17505)210 1122 A
2745 V
(17506)210 1122 A
1440(/*)S
(Global)252 1566 A
(variables.)420 1860 A
2322(*/)S
2835 V
(17507)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(mproc)210 2028 A
(*mp;)168 2280 A
2784(/*)S
(ptr)126 2910 A
3078(to)S
('mproc')294 3204 A
(slot)168 3540 A
3750(of)S
(current)294 3876 A
(process)294 4212 A
4548(*/)S
2925 V
(17508)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(procs_in_use;)546 1902 A
2784(/*)S
(how)126 2910 A
(many)168 3078 A
(processes)378 3288 A
(are)126 3708 A
(marked)252 3876 A
4170(as)S
(IN_USE)252 4296 A
4590(*/)S
3015 V
(17509)210 1122 A
(EXTERN)252 1440 A
(char)168 1734 A
(monitor_params[128*sizeof\(char)1260 1944 A
(*\)];)168 3246 A
3456(/*)S
(boot)168 3582 A
(monitor)294 3792 A
(parameters)420 4128 A
4590(*/)S
3105 V
(17510)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(kinfo)210 2028 A
(kinfo;)252 2280 A
3456(/*)S
(kernel)252 3582 A
(information)462 3876 A
4380(*/)S
3195 V
(17511)210 1122 A
3285 V
(17512)210 1122 A
1440(/*)S
(The)126 1566 A
(parameters)420 1734 A
2196(of)S
(the)126 2322 A
(call)168 2490 A
(are)126 2700 A
(kept)168 2868 A
(here.)210 3078 A
3330(*/)S
3375 V
(17513)210 1122 A
(EXTERN)252 1440 A
(message)294 1734 A
(m_in;)210 2070 A
2784(/*)S
(the)126 2910 A
(incoming)336 3078 A
(message)294 3456 A
(itself)252 3792 A
4086(is)S
(kept)168 4212 A
(here.)210 4422 A
4674(*/)S
3465 V
(17514)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(who;)168 1902 A
2784(/*)S
(caller's)336 2910 A
(proc)168 3288 A
(number)252 3498 A
3792(*/)S
3555 V
(17515)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(call_nr;)336 1902 A
2784(/*)S
(system)252 2910 A
(call)168 3204 A
(number)252 3414 A
3708(*/)S
3645 V
(17516)210 1122 A
3735 V
(17517)210 1122 A
(extern)252 1440 A
(_PROTOTYPE)420 1734 A
(\(int)168 2196 A
(\(*call_vec[]\),)588 2406 A
(\(void\))252 3036 A
3330(\);)S
3456(/*)S
(system)252 3582 A
(call)168 3876 A
(handlers)336 4086 A
4464(*/)S
3825 V
(17518)210 1122 A
(extern)252 1440 A
(char)168 1734 A
(core_name[];)504 1944 A
2784(/*)S
(file)168 2910 A
(name)168 3120 A
(where)210 3330 A
(core)168 3582 A
(images)252 3792 A
(are)126 4086 A
(produced)336 4254 A
4632(*/)S
3915 V
(17519)210 1122 A
(EXTERN)252 1440 A
(sigset_t)336 1734 A
(core_sset;)420 2112 A
2784(/*)S
(which)210 2910 A
(signals)294 3162 A
(cause)210 3498 A
(core)168 3750 A
(images)252 3960 A
4254(*/)S
4005 V
(17520)210 1122 A
(EXTERN)252 1440 A
(sigset_t)336 1734 A
(ign_sset;)378 2112 A
2784(/*)S
(which)210 2910 A
(signals)294 3162 A
(are)126 3498 A
3666(by)S
(default)294 3792 A
(ignored)294 4128 A
4464(*/)S
4095 V
(17521)210 1122 A
4545 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4635 V
(servers/pm/mproc.h)756 2676 A
4725 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4905 V
(17600)210 1122 A
1440(/*)S
(This)168 1566 A
(table)210 1776 A
(has)126 2028 A
(one)126 2196 A
(slot)168 2364 A
(per)126 2574 A
(process.)336 2742 A
3162(It)S
(contains)336 3288 A
(all)126 3666 A
(the)126 3834 A
(process)294 4002 A
(management)420 4338 A
4995 V
(17601)210 1122 A
1482(*)S
(information)462 1566 A
(for)126 2070 A
(each)168 2238 A
(process.)336 2448 A
(Among)210 2868 A
(other)210 3120 A
(things,)294 3372 A
3708(it)S
(defines)294 3834 A
(the)126 4170 A
(text,)210 4338 A
(data)168 4590 A
5085 V
(17602)210 1122 A
1482(*)S
(and)126 1566 A
(stack)210 1734 A
(segments,)378 1986 A
(uids)168 2406 A
(and)126 2616 A
(gids,)210 2784 A
(and)126 3036 A
(various)294 3204 A
(flags.)252 3540 A
(The)126 3876 A
(kernel)252 4044 A
(and)126 4338 A
(file)168 4506 A
5175 V
(17603)210 1122 A
1482(*)S
(systems)294 1566 A
(have)168 1902 A
(tables)252 2112 A
(that)168 2406 A
(are)126 2616 A
(also)168 2784 A
(indexed)294 2994 A
3330(by)S
(process,)336 3456 A
(with)168 3834 A
(the)126 4044 A
(contents)336 4212 A
5265 V
(17604)210 1122 A
1482(*)S
1566(of)S
(corresponding)546 1692 A
(slots)210 2280 A
(referring)378 2532 A
2952(to)S
(the)126 3078 A
(same)168 3246 A
(process)294 3456 A
3792(in)S
(all)126 3918 A
(three.)252 4086 A
5355 V
(17605)210 1122 A
1482(*/)S
5445 V
(17606)210 1122 A
(#include)336 1440 A
(<timers.h>)420 1818 A
5535 V
(17607)210 1122 A
5625 V
(17608)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(mproc)210 2028 A
2280({)S
5715 V
(17609)210 1122 A
(struct)252 1524 A
(mem_map)294 1818 A
(mp_seg[NR_LOCAL_SEGS];)924 2154 A
3120(/*)S
(points)252 3246 A
3540(to)S
(text,)210 3666 A
(data,)210 3918 A
(stack)210 4170 A
4422(*/)S
5805 V
(17610)210 1122 A
(char)168 1524 A
(mp_exitstatus;)588 1734 A
2784(/*)S
(storage)294 2910 A
(for)126 3246 A
(status)252 3414 A
(when)168 3708 A
(process)294 3918 A
(exits)210 4254 A
4506(*/)S
5895 V
(17611)210 1122 A
(char)168 1524 A
(mp_sigstatus;)546 1734 A
2784(/*)S
(storage)294 2910 A
(for)126 3246 A
(signal)252 3414 A
3708(#)S
(for)126 3792 A
(killed)252 3960 A
(procs)210 4254 A
4506(*/)S
5985 V
(17612)210 1122 A
(pid_t)210 1524 A
(mp_pid;)294 1776 A
2784(/*)S
(process)294 2910 A
3246(id)S
3372(*/)S
6075 V
(17613)210 1122 A
(pid_t)210 1524 A
(mp_procgrp;)462 1776 A
2784(/*)S
(pid)126 2910 A
3078(of)S
(process)294 3204 A
(group)210 3540 A
(\(used)210 3792 A
(for)126 4044 A
(signals\))336 4212 A
4590(*/)S
6165 V
(17614)210 1122 A
(pid_t)210 1524 A
(mp_wpid;)336 1776 A
2784(/*)S
(pid)126 2910 A
(this)168 3078 A
(process)294 3288 A
3624(is)S
(waiting)294 3750 A
(for)126 4086 A
4254(*/)S
6255 V
(17615)210 1122 A
(int)126 1524 A
(mp_parent;)420 1692 A
2784(/*)S
(index)210 2910 A
3162(of)S
(parent)252 3288 A
(process)294 3582 A
3918(*/)S
6345 V
(17616)210 1122 A
6435 V
(17617)210 1122 A
1524(/*)S
(Child)210 1650 A
(user)168 1902 A
(and)126 2112 A
(system)252 2280 A
(times.)252 2574 A
(Accounting)420 2868 A
(done)168 3330 A
3540(on)S
(child)210 3666 A
(exit.)210 3918 A
4170(*/)S
6525 V
(17618)210 1122 A
(clock_t)294 1524 A
(mp_child_utime;)630 1860 A
2784(/*)S
(cumulative)420 2910 A
(user)168 3372 A
(time)168 3582 A
3792(of)S
(children)336 3918 A
4296(*/)S
6615 V
(17619)210 1122 A
(clock_t)294 1524 A
(mp_child_stime;)630 1860 A
2784(/*)S
(cumulative)420 2910 A
(sys)126 3372 A
(time)168 3540 A
3750(of)S
(children)336 3876 A
4254(*/)S
6705 V
(17620)210 1122 A
6795 V
(17621)210 1122 A
1524(/*)S
(Real)168 1650 A
(and)126 1860 A
(effective)378 2028 A
(uids)168 2448 A
(and)126 2658 A
(gids.)210 2826 A
3078(*/)S
6885 V
(17622)210 1122 A
(uid_t)210 1524 A
(mp_realuid;)462 1776 A
2784(/*)S
(process')336 2910 A
(real)168 3288 A
(uid)126 3498 A
3666(*/)S
6975 V
(17623)210 1122 A
(uid_t)210 1524 A
(mp_effuid;)420 1776 A
2784(/*)S
(process')336 2910 A
(effective)378 3288 A
(uid)126 3708 A
3876(*/)S
7065 V
(17624)210 1122 A
(gid_t)210 1524 A
(mp_realgid;)462 1776 A
2784(/*)S
(process')336 2910 A
(real)168 3288 A
(gid)126 3498 A
3666(*/)S
8418 V
EP
%%Page: 233 233
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2321(File:)S
2554(servers/pm/mproc.h)S
12 B
(233)180 4500 A
1755 V
7 LST
(17625)210 1122 A
(gid_t)210 1524 A
(mp_effgid;)420 1776 A
2784(/*)S
(process')336 2910 A
(effective)378 3288 A
(gid)126 3708 A
3876(*/)S
1845 V
(17626)210 1122 A
1935 V
(17627)210 1122 A
1524(/*)S
(File)168 1650 A
(identification)588 1860 A
(for)126 2490 A
(sharing.)336 2658 A
3036(*/)S
2025 V
(17628)210 1122 A
(ino_t)210 1524 A
(mp_ino;)294 1776 A
2784(/*)S
(inode)210 2910 A
(number)252 3162 A
3456(of)S
(file)168 3582 A
3792(*/)S
2115 V
(17629)210 1122 A
(dev_t)210 1524 A
(mp_dev;)294 1776 A
2784(/*)S
(device)252 2910 A
(number)252 3204 A
3498(of)S
(file)168 3624 A
(system)252 3834 A
4128(*/)S
2205 V
(17630)210 1122 A
(time_t)252 1524 A
(mp_ctime;)378 1818 A
2784(/*)S
(inode)210 2910 A
(changed)294 3162 A
(time)168 3498 A
3708(*/)S
2295 V
(17631)210 1122 A
2385 V
(17632)210 1122 A
1524(/*)S
(Signal)252 1650 A
(handling)336 1944 A
(information.)504 2322 A
2868(*/)S
2475 V
(17633)210 1122 A
(sigset_t)336 1524 A
(mp_ignore;)420 1902 A
2784(/*)S
2910(1)S
(means)210 2994 A
(ignore)252 3246 A
(the)126 3540 A
(signal,)294 3708 A
4044(0)S
(means)210 4128 A
(don't)210 4380 A
4632(*/)S
2565 V
(17634)210 1122 A
(sigset_t)336 1524 A
(mp_catch;)378 1902 A
2784(/*)S
2910(1)S
(means)210 2994 A
(catch)210 3246 A
(the)126 3498 A
(signal,)294 3666 A
4002(0)S
(means)210 4086 A
(don't)210 4338 A
4590(*/)S
2655 V
(17635)210 1122 A
(sigset_t)336 1524 A
(mp_sig2mess;)504 1902 A
2784(/*)S
2910(1)S
(means)210 2994 A
(transform)378 3246 A
(into)168 3666 A
(notify)252 3876 A
(message)294 4170 A
4506(*/)S
2745 V
(17636)210 1122 A
(sigset_t)336 1524 A
(mp_sigmask;)462 1902 A
2784(/*)S
(signals)294 2910 A
3246(to)S
3372(be)S
(blocked)294 3498 A
3834(*/)S
2835 V
(17637)210 1122 A
(sigset_t)336 1524 A
(mp_sigmask2;)504 1902 A
2784(/*)S
(saved)210 2910 A
(copy)168 3162 A
3372(of)S
(mp_sigmask)420 3498 A
3960(*/)S
2925 V
(17638)210 1122 A
(sigset_t)336 1524 A
(mp_sigpending;)588 1902 A
2784(/*)S
(pending)294 2910 A
(signals)294 3246 A
3582(to)S
3708(be)S
(handled)294 3834 A
4170(*/)S
3015 V
(17639)210 1122 A
(struct)252 1524 A
(sigaction)378 1818 A
(mp_sigact[_NSIG)630 2238 A
2910(+)S
(1];)126 2994 A
3162(/*)S
3288(as)S
3414(in)S
(sigaction\(2\))504 3540 A
4086(*/)S
3105 V
(17640)210 1122 A
(vir_bytes)378 1524 A
(mp_sigreturn;)546 1944 A
2784(/*)S
(address)294 2910 A
3246(of)S
3372(C)S
(library)294 3456 A
(__sigreturn)462 3792 A
(function)336 4296 A
4674(*/)S
3195 V
(17641)210 1122 A
(struct)252 1524 A
(timer)210 1818 A
(mp_timer;)378 2070 A
2784(/*)S
(watchdog)336 2910 A
(timer)210 3288 A
(for)126 3540 A
(alarm\(2\))336 3708 A
4086(*/)S
3285 V
(17642)210 1122 A
3375 V
(17643)210 1122 A
1524(/*)S
(Backwards)378 1650 A
(compatibility)546 2070 A
(for)126 2658 A
(signals.)336 2826 A
3204(*/)S
3465 V
(17644)210 1122 A
(sighandler_t)504 1524 A
(mp_func;)336 2070 A
2784(/*)S
(all)126 2910 A
(sigs)168 3078 A
(vectored)336 3288 A
3666(to)S
3792(a)S
(single)252 3876 A
(user)168 4170 A
(fcn)126 4380 A
4548(*/)S
3555 V
(17645)210 1122 A
3645 V
(17646)210 1122 A
(unsigned)336 1524 A
(mp_flags;)378 1902 A
2784(/*)S
(flag)168 2910 A
(bits)168 3120 A
3330(*/)S
3735 V
(17647)210 1122 A
(vir_bytes)378 1524 A
(mp_procargs;)504 1944 A
2784(/*)S
(ptr)126 2910 A
3078(to)S
(proc's)252 3204 A
(initial)294 3498 A
(stack)210 3834 A
(arguments)378 4086 A
4506(*/)S
3825 V
(17648)210 1122 A
(struct)252 1524 A
(mproc)210 1818 A
(*mp_swapq;)420 2070 A
2784(/*)S
(queue)210 2910 A
3162(of)S
(procs)210 3288 A
(waiting)294 3540 A
3876(to)S
4002(be)S
(swapped)294 4128 A
4464(in)S
4590(*/)S
3915 V
(17649)210 1122 A
(message)294 1524 A
(mp_reply;)378 1860 A
2784(/*)S
(reply)210 2910 A
(message)294 3162 A
3498(to)S
3624(be)S
(sent)168 3750 A
3960(to)S
(one)126 4086 A
4254(*/)S
4005 V
(17650)210 1122 A
4095 V
(17651)210 1122 A
1524(/*)S
(Scheduling)420 1650 A
(priority.)378 2112 A
2532(*/)S
4185 V
(17652)210 1122 A
(signed)252 1524 A
(int)126 1818 A
(mp_nice;)336 1986 A
2784(/*)S
(nice)168 2910 A
3120(is)S
(PRIO_MIN..PRIO_MAX,)798 3246 A
(standard)336 4086 A
4464(0.)S
4590(*/)S
4275 V
(17653)210 1122 A
4365 V
(17654)210 1122 A
(char)168 1524 A
(mp_name[PROC_NAME_LEN];)966 1734 A
2784(/*)S
(process)294 2910 A
(name)168 3246 A
3456(*/)S
4455 V
(17655)210 1122 A
1440(})S
(mproc[NR_PROCS];)672 1524 A
4545 V
(17656)210 1122 A
4635 V
(17657)210 1122 A
1440(/*)S
(Flag)168 1566 A
(values)252 1776 A
2070(*/)S
4725 V
(17658)210 1122 A
(#define)294 1440 A
(IN_USE)252 1776 A
(0x001)210 2448 A
2784(/*)S
(set)126 2910 A
(when)168 3078 A
('mproc')294 3288 A
(slot)168 3624 A
3834(in)S
(use)126 3960 A
4128(*/)S
4815 V
(17659)210 1122 A
(#define)294 1440 A
(WAITING)294 1776 A
(0x002)210 2448 A
2784(/*)S
(set)126 2910 A
3078(by)S
(WAIT)168 3204 A
(system)252 3414 A
(call)168 3708 A
3918(*/)S
4905 V
(17660)210 1122 A
(#define)294 1440 A
(ZOMBIE)252 1776 A
(0x004)210 2448 A
2784(/*)S
(set)126 2910 A
3078(by)S
(EXIT,)210 3204 A
(cleared)294 3456 A
3792(by)S
(WAIT)168 3918 A
4128(*/)S
4995 V
(17661)210 1122 A
(#define)294 1440 A
(PAUSED)252 1776 A
(0x008)210 2448 A
2784(/*)S
(set)126 2910 A
3078(by)S
(PAUSE)210 3204 A
(system)252 3456 A
(call)168 3750 A
3960(*/)S
5085 V
(17662)210 1122 A
(#define)294 1440 A
(ALARM_ON)336 1776 A
(0x010)210 2448 A
2784(/*)S
(set)126 2910 A
(when)168 3078 A
(SIGALRM)294 3288 A
(timer)210 3624 A
(started)294 3876 A
4212(*/)S
5175 V
(17663)210 1122 A
(#define)294 1440 A
(SEPARATE)336 1776 A
(0x020)210 2448 A
2784(/*)S
(set)126 2910 A
3078(if)S
(file)168 3204 A
3414(is)S
(separate)336 3540 A
3918(I)S
4002(&)S
4086(D)S
(space)210 4170 A
4422(*/)S
5265 V
(17664)210 1122 A
(#define)294 1440 A
(TRACED)252 1776 A
(0x040)210 2448 A
2784(/*)S
(set)126 2910 A
3078(if)S
(process)294 3204 A
3540(is)S
3666(to)S
3792(be)S
(traced)252 3918 A
4212(*/)S
5355 V
(17665)210 1122 A
(#define)294 1440 A
(STOPPED)294 1776 A
(0x080)210 2448 A
2784(/*)S
(set)126 2910 A
3078(if)S
(process)294 3204 A
(stopped)294 3540 A
(for)126 3876 A
(tracing)294 4044 A
4380(*/)S
5445 V
(17666)210 1122 A
(#define)294 1440 A
(SIGSUSPENDED)504 1776 A
(0x100)210 2448 A
2784(/*)S
(set)126 2910 A
3078(by)S
(SIGSUSPEND)420 3204 A
(system)252 3666 A
(call)168 3960 A
4170(*/)S
5535 V
(17667)210 1122 A
(#define)294 1440 A
(REPLY)210 1776 A
(0x200)210 2448 A
2784(/*)S
(set)126 2910 A
3078(if)S
3204(a)S
(reply)210 3288 A
(message)294 3540 A
3876(is)S
(pending)294 4002 A
4338(*/)S
5625 V
(17668)210 1122 A
(#define)294 1440 A
(ONSWAP)252 1776 A
(0x400)210 2448 A
2784(/*)S
(set)126 2910 A
3078(if)S
(data)168 3204 A
(segment)294 3414 A
3750(is)S
(swapped)294 3876 A
(out)126 4212 A
4380(*/)S
5715 V
(17669)210 1122 A
(#define)294 1440 A
(SWAPIN)252 1776 A
(0x800)210 2448 A
2784(/*)S
(set)126 2910 A
3078(if)S
3204(on)S
(the)126 3330 A
("swap)210 3498 A
(this)168 3750 A
(in")126 3960 A
(queue)210 4128 A
4380(*/)S
5805 V
(17670)210 1122 A
(#define)294 1440 A
(DONT_SWAP)378 1776 A
(0x1000)252 2406 A
2784(/*)S
(never)210 2910 A
(swap)168 3162 A
(out)126 3372 A
(this)168 3540 A
(process)294 3750 A
4086(*/)S
5895 V
(17671)210 1122 A
(#define)294 1440 A
(PRIV_PROC)378 1776 A
(0x2000)252 2406 A
2784(/*)S
(system)252 2910 A
(process,)336 3204 A
(special)294 3582 A
(privileges)420 3918 A
4380(*/)S
5985 V
(17672)210 1122 A
6075 V
(17673)210 1122 A
(#define)294 1440 A
(NIL_MPROC)378 1776 A
(\(\(struct)336 2196 A
(mproc)210 2574 A
2826(*\))S
2952(0\))S
6165 V
(17674)210 1122 A
6345 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6435 V
(servers/pm/param.h)756 2676 A
6525 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6705 V
(17700)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(names)210 2154 A
(are)126 2406 A
(synonyms)336 2574 A
(for)126 2952 A
(the)126 3120 A
(variables)378 3288 A
3708(in)S
(the)126 3834 A
(input)210 4002 A
(message.)336 4254 A
4632(*/)S
6795 V
(17701)210 1122 A
(#define)294 1440 A
(addr)168 1776 A
(m1_p1)210 2448 A
6885 V
(17702)210 1122 A
(#define)294 1440 A
(exec_name)378 1776 A
(m1_p1)210 2448 A
6975 V
(17703)210 1122 A
(#define)294 1440 A
(exec_len)336 1776 A
(m1_i1)210 2448 A
7065 V
(17704)210 1122 A
(#define)294 1440 A
(func)168 1776 A
(m6_f1)210 2448 A
8418 V
EP
%%Page: 234 234
BP
/slant 0 def
/height 0 def
1485 V
12 B
(234)180 1080 A
11 R
2324(File:)S
2557(servers/pm/param.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(17705)210 1122 A
(#define)294 1440 A
(grp_id)252 1776 A
(m1_i1)210 2448 A
1845 V
(17706)210 1122 A
(#define)294 1440 A
(namelen)294 1776 A
(m1_i2)210 2448 A
1935 V
(17707)210 1122 A
(#define)294 1440 A
(pid)126 1776 A
(m1_i1)210 2448 A
2025 V
(17708)210 1122 A
(#define)294 1440 A
(procnr)252 1776 A
(m1_i1)210 2448 A
2115 V
(17709)210 1122 A
(#define)294 1440 A
(seconds)294 1776 A
(m1_i1)210 2448 A
2205 V
(17710)210 1122 A
(#define)294 1440 A
(sig)126 1776 A
(m6_i1)210 2448 A
2295 V
(17711)210 1122 A
(#define)294 1440 A
(stack_bytes)462 1776 A
(m1_i2)210 2448 A
2385 V
(17712)210 1122 A
(#define)294 1440 A
(stack_ptr)378 1776 A
(m1_p2)210 2448 A
2475 V
(17713)210 1122 A
(#define)294 1440 A
(status)252 1776 A
(m1_i1)210 2448 A
2565 V
(17714)210 1122 A
(#define)294 1440 A
(usr_id)252 1776 A
(m1_i1)210 2448 A
2655 V
(17715)210 1122 A
(#define)294 1440 A
(request)294 1776 A
(m2_i2)210 2448 A
2745 V
(17716)210 1122 A
(#define)294 1440 A
(taddr)210 1776 A
(m2_l1)210 2448 A
2835 V
(17717)210 1122 A
(#define)294 1440 A
(data)168 1776 A
(m2_l2)210 2448 A
2925 V
(17718)210 1122 A
(#define)294 1440 A
(sig_nr)252 1776 A
(m1_i2)210 2448 A
3015 V
(17719)210 1122 A
(#define)294 1440 A
(sig_nsa)294 1776 A
(m1_p1)210 2448 A
3105 V
(17720)210 1122 A
(#define)294 1440 A
(sig_osa)294 1776 A
(m1_p2)210 2448 A
3195 V
(17721)210 1122 A
(#define)294 1440 A
(sig_ret)294 1776 A
(m1_p3)210 2448 A
3285 V
(17722)210 1122 A
(#define)294 1440 A
(sig_set)294 1776 A
(m2_l1)210 2448 A
3375 V
(17723)210 1122 A
(#define)294 1440 A
(sig_how)294 1776 A
(m2_i1)210 2448 A
3465 V
(17724)210 1122 A
(#define)294 1440 A
(sig_flags)378 1776 A
(m2_i2)210 2448 A
3555 V
(17725)210 1122 A
(#define)294 1440 A
(sig_context)462 1776 A
(m2_p1)210 2448 A
3645 V
(17726)210 1122 A
(#define)294 1440 A
(info_what)378 1776 A
(m1_i1)210 2448 A
3735 V
(17727)210 1122 A
(#define)294 1440 A
(info_where)420 1776 A
(m1_p1)210 2448 A
3825 V
(17728)210 1122 A
(#define)294 1440 A
(reboot_flag)462 1776 A
(m1_i1)210 2448 A
3915 V
(17729)210 1122 A
(#define)294 1440 A
(reboot_code)462 1776 A
(m1_p1)210 2448 A
4005 V
(17730)210 1122 A
(#define)294 1440 A
(reboot_strlen)546 1776 A
(m1_i2)210 2448 A
4095 V
(17731)210 1122 A
(#define)294 1440 A
(svrctl_req)420 1776 A
(m2_i1)210 2448 A
4185 V
(17732)210 1122 A
(#define)294 1440 A
(svrctl_argp)462 1776 A
(m2_p1)210 2448 A
4275 V
(17733)210 1122 A
(#define)294 1440 A
(stime)210 1776 A
(m2_l1)210 2448 A
4365 V
(17734)210 1122 A
(#define)294 1440 A
(memsize)294 1776 A
(m4_l1)210 2448 A
4455 V
(17735)210 1122 A
(#define)294 1440 A
(membase)294 1776 A
(m4_l2)210 2448 A
4545 V
(17736)210 1122 A
4635 V
(17737)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(names)210 2154 A
(are)126 2406 A
(synonyms)336 2574 A
(for)126 2952 A
(the)126 3120 A
(variables)378 3288 A
3708(in)S
3834(a)S
(reply)210 3918 A
(message.)336 4170 A
4548(*/)S
4725 V
(17738)210 1122 A
(#define)294 1440 A
(reply_res)378 1776 A
(m_type)252 2448 A
4815 V
(17739)210 1122 A
(#define)294 1440 A
(reply_res2)420 1776 A
(m2_i1)210 2448 A
4905 V
(17740)210 1122 A
(#define)294 1440 A
(reply_ptr)378 1776 A
(m2_p1)210 2448 A
4995 V
(17741)210 1122 A
(#define)294 1440 A
(reply_mask)420 1776 A
(m2_l1)210 2448 A
5085 V
(17742)210 1122 A
(#define)294 1440 A
(reply_trace)462 1776 A
(m2_l2)210 2448 A
5175 V
(17743)210 1122 A
(#define)294 1440 A
(reply_time)420 1776 A
(m2_l1)210 2448 A
5265 V
(17744)210 1122 A
(#define)294 1440 A
(reply_utime)462 1776 A
(m2_l2)210 2448 A
5355 V
(17745)210 1122 A
(#define)294 1440 A
(reply_t1)336 1776 A
(m4_l1)210 2448 A
5445 V
(17746)210 1122 A
(#define)294 1440 A
(reply_t2)336 1776 A
(m4_l2)210 2448 A
5535 V
(17747)210 1122 A
(#define)294 1440 A
(reply_t3)336 1776 A
(m4_l3)210 2448 A
5625 V
(17748)210 1122 A
(#define)294 1440 A
(reply_t4)336 1776 A
(m4_l4)210 2448 A
5715 V
(17749)210 1122 A
(#define)294 1440 A
(reply_t5)336 1776 A
(m4_l5)210 2448 A
5805 V
(17750)210 1122 A
5895 V
(17751)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(names)210 2154 A
(are)126 2406 A
(used)168 2574 A
2784(to)S
(inform)252 2910 A
(the)126 3204 A
3372(FS)S
(about)210 3498 A
(certain)294 3750 A
(events.)294 4086 A
4422(*/)S
5985 V
(17752)210 1122 A
(#define)294 1440 A
(tell_fs_arg1)504 1776 A
(m1_i1)210 2448 A
6075 V
(17753)210 1122 A
(#define)294 1440 A
(tell_fs_arg2)504 1776 A
(m1_i2)210 2448 A
6165 V
(17754)210 1122 A
(#define)294 1440 A
(tell_fs_arg3)504 1776 A
(m1_i3)210 2448 A
6255 V
(17755)210 1122 A
8418 V
EP
%%Page: 235 235
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2357(File:)S
2590(servers/pm/table.c)S
12 B
(235)180 4500 A
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(servers/pm/table.c)756 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(17800)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(table)210 2532 A
(used)168 2784 A
2994(to)S
(map)126 3120 A
(system)252 3288 A
(call)168 3582 A
(numbers)294 3792 A
(onto)168 4128 A
(the)126 4338 A
2295 V
(17801)210 1122 A
1482(*)S
(routines)336 1566 A
(that)168 1944 A
(perform)294 2154 A
(them.)210 2490 A
2385 V
(17802)210 1122 A
1482(*/)S
2475 V
(17803)210 1122 A
2565 V
(17804)210 1122 A
(#define)294 1440 A
(_TABLE)252 1776 A
2655 V
(17805)210 1122 A
2745 V
(17806)210 1122 A
(#include)336 1440 A
("pm.h")252 1818 A
2835 V
(17807)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
2925 V
(17808)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
3015 V
(17809)210 1122 A
(#include)336 1440 A
("mproc.h")378 1818 A
3105 V
(17810)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
3195 V
(17811)210 1122 A
3285 V
(17812)210 1122 A
1440(/*)S
(Miscellaneous)546 1566 A
2154(*/)S
3375 V
(17813)210 1122 A
(char)168 1440 A
(core_name[])462 1650 A
2154(=)S
("core";)294 2238 A
2784(/*)S
(file)168 2910 A
(name)168 3120 A
(where)210 3330 A
(core)168 3582 A
(images)252 3792 A
(are)126 4086 A
(produced)336 4254 A
4632(*/)S
3465 V
(17814)210 1122 A
3555 V
(17815)210 1122 A
(_PROTOTYPE)420 1440 A
(\(int)168 1902 A
(\(*call_vec[NCALLS]\),)840 2112 A
(\(void\))252 2994 A
3288(\))S
3372(=)S
3456({)S
3645 V
(17816)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2616(0)S
2700(=)S
(unused)252 2784 A
3120(*/)S
3735 V
(17817)210 1122 A
(do_pm_exit,)462 1776 A
2448(/*)S
2616(1)S
2700(=)S
(exit)168 2784 A
3120(*/)S
3825 V
(17818)210 1122 A
(do_fork,)336 1776 A
2448(/*)S
2616(2)S
2700(=)S
(fork)168 2784 A
3120(*/)S
3915 V
(17819)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2616(3)S
2700(=)S
(read)168 2784 A
3120(*/)S
4005 V
(17820)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2616(4)S
2700(=)S
(write)210 2784 A
3120(*/)S
4095 V
(17821)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2616(5)S
2700(=)S
(open)168 2784 A
3120(*/)S
4185 V
(17822)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2616(6)S
2700(=)S
(close)210 2784 A
3120(*/)S
4275 V
(17823)210 1122 A
(do_waitpid,)462 1776 A
2448(/*)S
2616(7)S
2700(=)S
(wait)168 2784 A
3120(*/)S
4365 V
(17824)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2616(8)S
2700(=)S
(creat)210 2784 A
3120(*/)S
4455 V
(17825)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2616(9)S
2700(=)S
(link)168 2784 A
3120(*/)S
4545 V
(17826)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(10)S
2700(=)S
(unlink)252 2784 A
3120(*/)S
4635 V
(17827)210 1122 A
(do_waitpid,)462 1776 A
2448(/*)S
2574(11)S
2700(=)S
(waitpid)294 2784 A
3120(*/)S
4725 V
(17828)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(12)S
2700(=)S
(chdir)210 2784 A
3120(*/)S
4815 V
(17829)210 1122 A
(do_time,)336 1776 A
2448(/*)S
2574(13)S
2700(=)S
(time)168 2784 A
3120(*/)S
4905 V
(17830)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(14)S
2700(=)S
(mknod)210 2784 A
3120(*/)S
4995 V
(17831)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(15)S
2700(=)S
(chmod)210 2784 A
3120(*/)S
5085 V
(17832)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(16)S
2700(=)S
(chown)210 2784 A
3120(*/)S
5175 V
(17833)210 1122 A
(do_brk,)294 1776 A
2448(/*)S
2574(17)S
2700(=)S
(break)210 2784 A
3120(*/)S
5265 V
(17834)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(18)S
2700(=)S
(stat)168 2784 A
3120(*/)S
5355 V
(17835)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(19)S
2700(=)S
(lseek)210 2784 A
3120(*/)S
5445 V
(17836)210 1122 A
(do_getset,)420 1776 A
2448(/*)S
2574(20)S
2700(=)S
(getpid)252 2784 A
3120(*/)S
5535 V
(17837)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(21)S
2700(=)S
(mount)210 2784 A
3120(*/)S
5625 V
(17838)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(22)S
2700(=)S
(umount)252 2784 A
3120(*/)S
5715 V
(17839)210 1122 A
(do_getset,)420 1776 A
2448(/*)S
2574(23)S
2700(=)S
(setuid)252 2784 A
3120(*/)S
5805 V
(17840)210 1122 A
(do_getset,)420 1776 A
2448(/*)S
2574(24)S
2700(=)S
(getuid)252 2784 A
3120(*/)S
5895 V
(17841)210 1122 A
(do_stime,)378 1776 A
2448(/*)S
2574(25)S
2700(=)S
(stime)210 2784 A
3120(*/)S
5985 V
(17842)210 1122 A
(do_trace,)378 1776 A
2448(/*)S
2574(26)S
2700(=)S
(ptrace)252 2784 A
3120(*/)S
6075 V
(17843)210 1122 A
(do_alarm,)378 1776 A
2448(/*)S
2574(27)S
2700(=)S
(alarm)210 2784 A
3120(*/)S
6165 V
(17844)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(28)S
2700(=)S
(fstat)210 2784 A
3120(*/)S
6255 V
(17845)210 1122 A
(do_pause,)378 1776 A
2448(/*)S
2574(29)S
2700(=)S
(pause)210 2784 A
3120(*/)S
6345 V
(17846)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(30)S
2700(=)S
(utime)210 2784 A
3120(*/)S
6435 V
(17847)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(31)S
2700(=)S
(\(stty\))252 2784 A
3120(*/)S
6525 V
(17848)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(32)S
2700(=)S
(\(gtty\))252 2784 A
3120(*/)S
6615 V
(17849)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(33)S
2700(=)S
(access)252 2784 A
3120(*/)S
6705 V
(17850)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(34)S
2700(=)S
(\(nice\))252 2784 A
3120(*/)S
6795 V
(17851)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(35)S
2700(=)S
(\(ftime\))294 2784 A
3120(*/)S
6885 V
(17852)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(36)S
2700(=)S
(sync)168 2784 A
3120(*/)S
6975 V
(17853)210 1122 A
(do_kill,)336 1776 A
2448(/*)S
2574(37)S
2700(=)S
(kill)168 2784 A
3120(*/)S
7065 V
(17854)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(38)S
2700(=)S
(rename)252 2784 A
3120(*/)S
8418 V
EP
%%Page: 236 236
BP
/slant 0 def
/height 0 def
1485 V
12 B
(236)180 1080 A
11 R
2357(File:)S
2590(servers/pm/table.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(17855)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(39)S
2700(=)S
(mkdir)210 2784 A
3120(*/)S
1845 V
(17856)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(40)S
2700(=)S
(rmdir)210 2784 A
3120(*/)S
1935 V
(17857)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(41)S
2700(=)S
(dup)126 2784 A
3120(*/)S
2025 V
(17858)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(42)S
2700(=)S
(pipe)168 2784 A
3120(*/)S
2115 V
(17859)210 1122 A
(do_times,)378 1776 A
2448(/*)S
2574(43)S
2700(=)S
(times)210 2784 A
3120(*/)S
2205 V
(17860)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(44)S
2700(=)S
(\(prof\))252 2784 A
3120(*/)S
2295 V
(17861)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(45)S
2700(=)S
(unused)252 2784 A
3120(*/)S
2385 V
(17862)210 1122 A
(do_getset,)420 1776 A
2448(/*)S
2574(46)S
2700(=)S
(setgid)252 2784 A
3120(*/)S
2475 V
(17863)210 1122 A
(do_getset,)420 1776 A
2448(/*)S
2574(47)S
2700(=)S
(getgid)252 2784 A
3120(*/)S
2565 V
(17864)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(48)S
2700(=)S
(\(signal\)*/)420 2784 A
2655 V
(17865)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(49)S
2700(=)S
(unused)252 2784 A
3120(*/)S
2745 V
(17866)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(50)S
2700(=)S
(unused)252 2784 A
3120(*/)S
2835 V
(17867)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(51)S
2700(=)S
(\(acct\))252 2784 A
3120(*/)S
2925 V
(17868)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(52)S
2700(=)S
(\(phys\))252 2784 A
3120(*/)S
3015 V
(17869)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(53)S
2700(=)S
(\(lock\))252 2784 A
3120(*/)S
3105 V
(17870)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(54)S
2700(=)S
(ioctl)210 2784 A
3120(*/)S
3195 V
(17871)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(55)S
2700(=)S
(fcntl)210 2784 A
3120(*/)S
3285 V
(17872)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(56)S
2700(=)S
(\(mpx\))210 2784 A
3120(*/)S
3375 V
(17873)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(57)S
2700(=)S
(unused)252 2784 A
3120(*/)S
3465 V
(17874)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(58)S
2700(=)S
(unused)252 2784 A
3120(*/)S
3555 V
(17875)210 1122 A
(do_exec,)336 1776 A
2448(/*)S
2574(59)S
2700(=)S
(execve)252 2784 A
3120(*/)S
3645 V
(17876)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(60)S
2700(=)S
(umask)210 2784 A
3120(*/)S
3735 V
(17877)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(61)S
2700(=)S
(chroot)252 2784 A
3120(*/)S
3825 V
(17878)210 1122 A
(do_getset,)420 1776 A
2448(/*)S
2574(62)S
2700(=)S
(setsid)252 2784 A
3120(*/)S
3915 V
(17879)210 1122 A
(do_getset,)420 1776 A
2448(/*)S
2574(63)S
2700(=)S
(getpgrp)294 2784 A
3120(*/)S
4005 V
(17880)210 1122 A
4095 V
(17881)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(64)S
2700(=)S
(unused)252 2784 A
3078(*/)S
4185 V
(17882)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(65)S
2700(=)S
(UNPAUSE)294 2784 A
3120(*/)S
4275 V
(17883)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(66)S
2700(=)S
(unused)252 2784 A
3120(*/)S
4365 V
(17884)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(67)S
2700(=)S
(REVIVE)252 2784 A
3120(*/)S
4455 V
(17885)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(68)S
2700(=)S
(TASK_REPLY)420 2784 A
3288(*/)S
4545 V
(17886)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(69)S
2700(=)S
(unused)252 2784 A
3120(*/)S
4635 V
(17887)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(70)S
2700(=)S
(unused)252 2784 A
3120(*/)S
4725 V
(17888)210 1122 A
(do_sigaction,)546 1776 A
2448(/*)S
2574(71)S
2700(=)S
(sigaction)378 2784 A
3288(*/)S
4815 V
(17889)210 1122 A
(do_sigsuspend,)588 1776 A
2448(/*)S
2574(72)S
2700(=)S
(sigsuspend)420 2784 A
3288(*/)S
4905 V
(17890)210 1122 A
(do_sigpending,)588 1776 A
2448(/*)S
2574(73)S
2700(=)S
(sigpending)420 2784 A
3288(*/)S
4995 V
(17891)210 1122 A
(do_sigprocmask,)630 1776 A
2448(/*)S
2574(74)S
2700(=)S
(sigprocmask)462 2784 A
3288(*/)S
5085 V
(17892)210 1122 A
(do_sigreturn,)546 1776 A
2448(/*)S
2574(75)S
2700(=)S
(sigreturn)378 2784 A
3288(*/)S
5175 V
(17893)210 1122 A
(do_reboot,)420 1776 A
2448(/*)S
2574(76)S
2700(=)S
(reboot)252 2784 A
3120(*/)S
5265 V
(17894)210 1122 A
(do_svrctl,)420 1776 A
2448(/*)S
2574(77)S
2700(=)S
(svrctl)252 2784 A
3120(*/)S
5355 V
(17895)210 1122 A
5445 V
(17896)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(78)S
2700(=)S
(unused)252 2784 A
3078(*/)S
5535 V
(17897)210 1122 A
(do_getsysinfo,)588 1776 A
2448(/*)S
2574(79)S
2700(=)S
(getsysinfo)420 2784 A
3246(*/)S
5625 V
(17898)210 1122 A
(do_getprocnr,)546 1776 A
2448(/*)S
2574(80)S
2700(=)S
(getprocnr)378 2784 A
3204(*/)S
5715 V
(17899)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(81)S
2700(=)S
(unused)252 2784 A
3078(*/)S
5805 V
(17900)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(82)S
2700(=)S
(fstatfs)294 2784 A
3120(*/)S
5895 V
(17901)210 1122 A
(do_allocmem,)504 1776 A
2448(/*)S
2574(83)S
2700(=)S
(memalloc)336 2784 A
3162(*/)S
5985 V
(17902)210 1122 A
(do_freemem,)462 1776 A
2448(/*)S
2574(84)S
2700(=)S
(memfree)294 2784 A
3120(*/)S
6075 V
(17903)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(85)S
2700(=)S
(select)252 2784 A
3078(*/)S
6165 V
(17904)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(86)S
2700(=)S
(fchdir)252 2784 A
3078(*/)S
6255 V
(17905)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(87)S
2700(=)S
(fsync)210 2784 A
3036(*/)S
6345 V
(17906)210 1122 A
(do_getsetpriority,)756 1776 A
2784(/*)S
2910(88)S
3036(=)S
(getpriority)462 3120 A
3624(*/)S
6435 V
(17907)210 1122 A
(do_getsetpriority,)756 1776 A
2784(/*)S
2910(89)S
3036(=)S
(setpriority)462 3120 A
3624(*/)S
6525 V
(17908)210 1122 A
(do_time,)336 1776 A
2448(/*)S
2574(90)S
2700(=)S
(gettimeofday)504 2784 A
3330(*/)S
6615 V
(17909)210 1122 A
1440(};)S
6705 V
(17910)210 1122 A
1440(/*)S
(This)168 1566 A
(should)252 1776 A
(not)126 2070 A
(fail)168 2238 A
(with)168 2448 A
("array)252 2658 A
(size)168 2952 A
3162(is)S
(negative":)420 3288 A
3750(*/)S
6795 V
(17911)210 1122 A
(extern)252 1440 A
(int)126 1734 A
(dummy[sizeof\(call_vec\))924 1902 A
2868(==)S
(NCALLS)252 2994 A
3288(*)S
(sizeof\(call_vec[0]\))798 3372 A
4212(?)S
4296(1)S
4380(:)S
(-1];)168 4464 A
8418 V
EP
%%Page: 237 237
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2354(File:)S
2587(servers/pm/main.c)S
12 B
(237)180 4500 A
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(servers/pm/main.c)714 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(18000)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(main)168 2532 A
(program)294 2742 A
3078(of)S
(the)126 3204 A
(process)294 3372 A
(manager)294 3708 A
(and)126 4044 A
(some)168 4212 A
(related)294 4422 A
2295 V
(18001)210 1122 A
1482(*)S
(procedures.)462 1566 A
(When)168 2112 A
(MINIX)210 2322 A
(starts)252 2574 A
(up,)126 2868 A
(the)126 3036 A
(kernel)252 3204 A
(runs)168 3498 A
(for)126 3708 A
3876(a)S
(little)252 3960 A
(while,)252 4254 A
2385 V
(18002)210 1122 A
1482(*)S
(initializing)504 1566 A
(itself)252 2112 A
(and)126 2406 A
(its)126 2574 A
(tasks,)252 2742 A
(and)126 3036 A
(then)168 3204 A
3414(it)S
(runs)168 3540 A
3750(PM)S
(and)126 3876 A
(FS.)126 4044 A
(Both)168 4254 A
4464(PM)S
2475 V
(18003)210 1122 A
1482(*)S
(and)126 1566 A
1734(FS)S
(initialize)420 1860 A
(themselves)420 2322 A
2784(as)S
(far)126 2910 A
3078(as)S
(they)168 3204 A
(can.)168 3414 A
3624(PM)S
(asks)168 3750 A
(the)126 3960 A
(kernel)252 4128 A
(for)126 4422 A
2565 V
(18004)210 1122 A
1482(*)S
(all)126 1566 A
(free)168 1734 A
(memory)252 1944 A
(and)126 2238 A
(starts)252 2406 A
(serving)294 2700 A
(requests.)378 3036 A
2655 V
(18005)210 1122 A
1482(*)S
2745 V
(18006)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are:)168 2910 A
2835 V
(18007)210 1122 A
1482(*)S
(main:)210 1650 A
(starts)252 2112 A
2406(PM)S
(running)294 2532 A
2925 V
(18008)210 1122 A
1482(*)S
(setreply:)378 1650 A
(set)126 2112 A
(the)126 2280 A
(reply)210 2448 A
2700(to)S
2826(be)S
(sent)168 2952 A
3162(to)S
(process)294 3288 A
(making)252 3624 A
3918(an)S
4044(PM)S
(system)252 4170 A
(call)168 4464 A
3015 V
(18009)210 1122 A
1482(*/)S
3105 V
(18010)210 1122 A
3195 V
(18011)210 1122 A
(#include)336 1440 A
("pm.h")252 1818 A
3285 V
(18012)210 1122 A
(#include)336 1440 A
(<minix/keymap.h>)672 1818 A
3375 V
(18013)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
3465 V
(18014)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
3555 V
(18015)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
3645 V
(18016)210 1122 A
(#include)336 1440 A
(<stdlib.h>)420 1818 A
3735 V
(18017)210 1122 A
(#include)336 1440 A
(<fcntl.h>)378 1818 A
3825 V
(18018)210 1122 A
(#include)336 1440 A
(<sys/resource.h>)672 1818 A
3915 V
(18019)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
4005 V
(18020)210 1122 A
(#include)336 1440 A
("mproc.h")378 1818 A
4095 V
(18021)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
4185 V
(18022)210 1122 A
4275 V
(18023)210 1122 A
(#include)336 1440 A
("../../kernel/const.h")924 1818 A
4365 V
(18024)210 1122 A
(#include)336 1440 A
("../../kernel/config.h")966 1818 A
4455 V
(18025)210 1122 A
(#include)336 1440 A
("../../kernel/type.h")882 1818 A
4545 V
(18026)210 1122 A
(#include)336 1440 A
("../../kernel/proc.h")882 1818 A
4635 V
(18027)210 1122 A
4725 V
(18028)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(get_work,)378 2490 A
(\(void\))252 2910 A
4464(\);)S
4815 V
(18029)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(pm_init,)336 2490 A
(\(void\))252 2868 A
4464(\);)S
4905 V
(18030)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(get_nice_value,)630 2448 A
(\(int)168 3120 A
(queue\))252 3330 A
4464(\);)S
4995 V
(18031)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(get_mem_chunks,)630 2490 A
(\(struct)294 3162 A
(memory)252 3498 A
(*mem_chunks\))504 3792 A
4464(\);)S
5085 V
(18032)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(patch_mem_chunks,)714 2490 A
(\(struct)294 3246 A
(memory)252 3582 A
(*mem_chunks,)504 3876 A
5175 V
(18033)210 1122 A
(struct)252 1776 A
(mem_map)294 2070 A
(*map_ptr\))378 2406 A
3120(\);)S
5265 V
(18034)210 1122 A
5355 V
(18035)210 1122 A
(#define)294 1440 A
(click_to_round_k\(n\))798 1776 A
2616(\\)S
5445 V
(18036)210 1122 A
(\(\(unsigned\))462 1776 A
(\(\(\(\(unsigned)504 2280 A
(long\))210 2826 A
(\(n\))126 3078 A
3246(<<)S
(CLICK_SHIFT\))504 3372 A
3918(+)S
(512\))168 4002 A
4212(/)S
(1024\)\))252 4296 A
5535 V
(18037)210 1122 A
5625 V
(18038)210 1122 A
(/*===========================================================================*)3276 1440 A
5715 V
(18039)210 1122 A
1482(*)S
(main)168 2784 A
4674(*)S
5805 V
(18040)210 1122 A
(*===========================================================================*/)3276 1482 A
5895 V
(18041)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(main\(\))252 1902 A
5985 V
(18042)210 1122 A
1440({)S
6075 V
(18043)210 1122 A
1440(/*)S
(Main)168 1566 A
(routine)294 1776 A
2112(of)S
(the)126 2238 A
(process)294 2406 A
(manager.)336 2742 A
3120(*/)S
6165 V
(18044)210 1122 A
(int)126 1524 A
(result,)294 1692 A
2028(s,)S
(proc_nr;)336 2154 A
6255 V
(18045)210 1122 A
(struct)252 1524 A
(mproc)210 1818 A
(*rmp;)210 2070 A
6345 V
(18046)210 1122 A
(sigset_t)336 1524 A
(sigset;)294 1902 A
6435 V
(18047)210 1122 A
6525 V
(18048)210 1122 A
(pm_init\(\);)420 1524 A
2784(/*)S
(initialize)420 2910 A
(process)294 3372 A
(manager)294 3708 A
(tables)252 4044 A
4338(*/)S
6615 V
(18049)210 1122 A
6705 V
(18050)210 1122 A
1524(/*)S
(This)168 1650 A
1860(is)S
(PM's)168 1986 A
(main)168 2196 A
(loop-)210 2406 A
(get)126 2700 A
(work)168 2868 A
(and)126 3078 A
3246(do)S
(it,)126 3372 A
(forever)294 3540 A
(and)126 3876 A
(forever.)336 4044 A
4422(*/)S
6795 V
(18051)210 1122 A
(while)210 1524 A
(\(TRUE\))252 1776 A
2070({)S
6885 V
(18052)210 1122 A
(get_work\(\);)462 1776 A
2784(/*)S
(wait)168 2910 A
(for)126 3120 A
3288(an)S
3414(PM)S
(system)252 3540 A
(call)168 3834 A
4044(*/)S
6975 V
(18053)210 1122 A
7065 V
(18054)210 1122 A
1776(/*)S
(Check)210 1902 A
(for)126 2154 A
(system)252 2322 A
(notifications)546 2616 A
(first.)252 3204 A
(Special)294 3498 A
(cases.)252 3834 A
4128(*/)S
8418 V
EP
%%Page: 238 238
BP
/slant 0 def
/height 0 def
1485 V
12 B
(238)180 1080 A
11 R
2354(File:)S
2587(servers/pm/main.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(18055)210 1122 A
1776(if)S
(\(call_nr)336 1902 A
2280(==)S
(SYN_ALARM\))420 2406 A
2868({)S
1845 V
(18056)210 1122 A
(pm_expire_timers\(m_in.NOTIFY_TIMESTAMP\);)1680 2112 A
1935 V
(18057)210 1122 A
(result)252 2112 A
2406(=)S
(SUSPEND;)336 2490 A
3456(/*)S
(don't)210 3582 A
(reply)210 3834 A
4086(*/)S
2025 V
(18058)210 1122 A
1776(})S
(else)168 1860 A
2070(if)S
(\(call_nr)336 2196 A
2574(==)S
(SYS_SIG\))336 2700 A
3078({)S
3456(/*)S
(signals)294 3582 A
(pending)294 3918 A
4254(*/)S
2115 V
(18059)210 1122 A
(sigset)252 2112 A
2406(=)S
(m_in.NOTIFY_ARG;)672 2490 A
2205 V
(18060)210 1122 A
2112(if)S
(\(sigismember\(&sigset,)882 2238 A
(SIGKSIG\)\))378 3162 A
(\(void\))252 3624 A
(ksig_pending\(\);)630 3918 A
2295 V
(18061)210 1122 A
(result)252 2112 A
2406(=)S
(SUSPEND;)336 2490 A
3456(/*)S
(don't)210 3582 A
(reply)210 3834 A
4086(*/)S
2385 V
(18062)210 1122 A
1776(})S
2475 V
(18063)210 1122 A
1776(/*)S
(Else,)210 1902 A
2154(if)S
(the)126 2280 A
(system)252 2448 A
(call)168 2742 A
(number)252 2952 A
3246(is)S
(valid,)252 3372 A
(perform)294 3666 A
(the)126 4002 A
(call.)210 4170 A
4422(*/)S
2565 V
(18064)210 1122 A
(else)168 1776 A
1986(if)S
(\(\(unsigned\))462 2112 A
(call_nr)294 2616 A
2952(>=)S
(NCALLS\))294 3078 A
3414({)S
2655 V
(18065)210 1122 A
(result)252 2112 A
2406(=)S
(ENOSYS;)294 2490 A
2745 V
(18066)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
2835 V
(18067)210 1122 A
(result)252 2112 A
2406(=)S
(\(*call_vec[call_nr]\)\(\);)966 2490 A
2925 V
(18068)210 1122 A
1776(})S
3015 V
(18069)210 1122 A
3105 V
(18070)210 1122 A
1776(/*)S
(Send)168 1902 A
(the)126 2112 A
(results)294 2280 A
(back)168 2616 A
2826(to)S
(the)126 2952 A
(user)168 3120 A
3330(to)S
(indicate)336 3456 A
(completion.)462 3834 A
4338(*/)S
3195 V
(18071)210 1122 A
1776(if)S
(\(result)294 1902 A
2238(!=)S
(SUSPEND\))336 2364 A
(setreply\(who,)546 2742 A
(result\);)336 3330 A
3285 V
(18072)210 1122 A
3375 V
(18073)210 1122 A
(swap_in\(\);)420 1776 A
2784(/*)S
(maybe)210 2910 A
3162(a)S
(process)294 3246 A
(can)126 3582 A
3750(be)S
(swapped)294 3876 A
(in?)126 4212 A
4380(*/)S
3465 V
(18074)210 1122 A
3555 V
(18075)210 1122 A
1776(/*)S
(Send)168 1902 A
(out)126 2112 A
(all)126 2280 A
(pending)294 2448 A
(reply)210 2784 A
(messages,)378 3036 A
(including)378 3456 A
(the)126 3876 A
(answer)252 4044 A
4338(to)S
3645 V
(18076)210 1122 A
1818(*)S
(the)126 1902 A
(call)168 2070 A
(just)168 2280 A
(made)168 2490 A
(above.)252 2700 A
(The)126 3036 A
(processes)378 3204 A
(must)168 3624 A
(not)126 3834 A
4002(be)S
(swapped)294 4128 A
(out.)168 4464 A
3735 V
(18077)210 1122 A
1818(*/)S
3825 V
(18078)210 1122 A
(for)126 1776 A
(\(proc_nr=0,)462 1944 A
(rmp=mproc;)420 2448 A
(proc_nr)294 2910 A
3246(<)S
(NR_PROCS;)378 3330 A
(proc_nr++,)420 3750 A
(rmp++\))252 4212 A
4506({)S
3915 V
(18079)210 1122 A
2112(/*)S
2238(In)S
(the)126 2364 A
(meantime,)378 2532 A
(the)126 2952 A
(process)294 3120 A
(may)126 3456 A
(have)168 3624 A
(been)168 3834 A
(killed)252 4044 A
4338(by)S
4464(a)S
4005 V
(18080)210 1122 A
2154(*)S
(signal)252 2238 A
(\(e.g.)210 2532 A
2784(if)S
2910(a)S
(lethal)252 2994 A
(pending)294 3288 A
(signal)252 3624 A
(was)126 3918 A
(unblocked\))420 4086 A
4095 V
(18081)210 1122 A
2154(*)S
(without)294 2238 A
(the)126 2574 A
2742(PM)S
(realizing)378 2868 A
(it.)126 3288 A
3456(If)S
(the)126 3582 A
(slot)168 3750 A
3960(is)S
4086(no)S
(longer)252 4212 A
4506(in)S
4185 V
(18082)210 1122 A
2154(*)S
(use)126 2238 A
2406(or)S
(just)168 2532 A
2742(a)S
(zombie,)294 2826 A
(don't)210 3162 A
(try)126 3414 A
3582(to)S
(reply.)252 3708 A
4275 V
(18083)210 1122 A
2154(*/)S
4365 V
(18084)210 1122 A
2112(if)S
(\(\(rmp->mp_flags)630 2238 A
2910(&)S
(\(REPLY)252 2994 A
3288(|)S
(ONSWAP)252 3372 A
3666(|)S
(IN_USE)252 3750 A
4044(|)S
(ZOMBIE\)\))336 4128 A
4506(==)S
4455 V
(18085)210 1122 A
(\(REPLY)252 2238 A
2532(|)S
(IN_USE\)\))336 2616 A
2994({)S
4545 V
(18086)210 1122 A
2448(if)S
(\(\(s=send\(proc_nr,)714 2574 A
(&rmp->mp_reply\)\))672 3330 A
4044(!=)S
(OK\))126 4170 A
4338({)S
4635 V
(18087)210 1122 A
(panic\(__FILE__,"PM)756 2784 A
(can't)210 3582 A
(reply)210 3834 A
(to",)168 4086 A
(proc_nr\);)378 4296 A
4725 V
(18088)210 1122 A
2448(})S
4815 V
(18089)210 1122 A
(rmp->mp_flags)546 2448 A
3036(&=)S
(\304REPLY;)294 3162 A
4905 V
(18090)210 1122 A
2112(})S
4995 V
(18091)210 1122 A
1776(})S
5085 V
(18092)210 1122 A
1524(})S
5175 V
(18093)210 1122 A
(return\(OK\);)462 1524 A
5265 V
(18094)210 1122 A
1440(})S
5445 V
(18096)210 1122 A
(/*===========================================================================*)3276 1440 A
5535 V
(18097)210 1122 A
1482(*)S
(get_work)336 2784 A
4674(*)S
5625 V
(18098)210 1122 A
(*===========================================================================*/)3276 1482 A
5715 V
(18099)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(get_work\(\))420 1986 A
5805 V
(18100)210 1122 A
1440({)S
5895 V
(18101)210 1122 A
1440(/*)S
(Wait)168 1566 A
(for)126 1776 A
(the)126 1944 A
(next)168 2112 A
(message)294 2322 A
(and)126 2658 A
(extract)294 2826 A
(useful)252 3162 A
(information)462 3456 A
(from)168 3960 A
(it.)126 4170 A
4338(*/)S
5985 V
(18102)210 1122 A
1524(if)S
(\(receive\(ANY,)546 1650 A
(&m_in\))252 2238 A
2532(!=)S
(OK\))126 2658 A
(panic\(__FILE__,"PM)756 2826 A
(receive)294 3624 A
(error",)294 3960 A
(NO_NUM\);)336 4296 A
6075 V
(18103)210 1122 A
(who)126 1524 A
1692(=)S
(m_in.m_source;)588 1776 A
2784(/*)S
(who)126 2910 A
(sent)168 3078 A
(the)126 3288 A
(message)294 3456 A
3792(*/)S
6165 V
(18104)210 1122 A
(call_nr)294 1524 A
1860(=)S
(m_in.m_type;)504 1944 A
2784(/*)S
(system)252 2910 A
(call)168 3204 A
(number)252 3414 A
3708(*/)S
6255 V
(18105)210 1122 A
6345 V
(18106)210 1122 A
1524(/*)S
(Process)294 1650 A
(slot)168 1986 A
2196(of)S
(caller.)294 2322 A
(Misuse)252 2658 A
(PM's)168 2952 A
(own)126 3162 A
(process)294 3330 A
(slot)168 3666 A
3876(if)S
(the)126 4002 A
(kernel)252 4170 A
4464(is)S
6435 V
(18107)210 1122 A
1566(*)S
(calling.)336 1650 A
(This)168 2028 A
(can)126 2238 A
(happen)252 2406 A
2700(in)S
(case)168 2826 A
3036(of)S
(synchronous)462 3162 A
(alarms)252 3666 A
(\(CLOCK\))294 3960 A
4296(or)S
4422(or)S
6525 V
(18108)210 1122 A
1566(*)S
(event)210 1650 A
(like)168 1902 A
(pending)294 2112 A
(kernel)252 2448 A
(signals)294 2742 A
(\(SYSTEM\).)378 3078 A
6615 V
(18109)210 1122 A
1566(*/)S
6705 V
(18110)210 1122 A
1524(mp)S
1650(=)S
(&mproc[who)420 1734 A
2196(<)S
2280(0)S
2364(?)S
(PM_PROC_NR)420 2448 A
2910(:)S
(who];)210 2994 A
6795 V
(18111)210 1122 A
1440(})S
8418 V
EP
%%Page: 239 239
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2354(File:)S
2587(servers/pm/main.c)S
12 B
(239)180 4500 A
1755 V
7 LST
(18113)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(18114)210 1122 A
1482(*)S
(setreply)336 2784 A
4674(*)S
1935 V
(18115)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(18116)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(setreply\(proc_nr,)714 1944 A
(result\))294 2700 A
2115 V
(18117)210 1122 A
(int)126 1440 A
(proc_nr;)336 1608 A
2784(/*)S
(process)294 2910 A
3246(to)S
(reply)210 3372 A
3624(to)S
3750(*/)S
2205 V
(18118)210 1122 A
(int)126 1440 A
(result;)294 1608 A
2784(/*)S
(result)252 2910 A
3204(of)S
(call)168 3330 A
(\(usually)336 3540 A
3918(OK)S
4044(or)S
(error)210 4170 A
4422(#\))S
4548(*/)S
2295 V
(18119)210 1122 A
1440({)S
2385 V
(18120)210 1122 A
1440(/*)S
(Fill)168 1566 A
1776(in)S
1902(a)S
(reply)210 1986 A
(message)294 2238 A
2574(to)S
2700(be)S
(sent)168 2826 A
(later)210 3036 A
3288(to)S
3414(a)S
(user)168 3498 A
(process.)336 3708 A
(System)252 4128 A
(calls)210 4422 A
2475 V
(18121)210 1122 A
1482(*)S
(may)126 1566 A
(occasionally)504 1734 A
(fill)168 2280 A
2490(in)S
(other)210 2616 A
(fields,)294 2868 A
(this)168 3204 A
3414(is)S
(only)168 3540 A
(for)126 3750 A
(the)126 3918 A
(main)168 4086 A
(return)252 4296 A
2565 V
(18122)210 1122 A
1482(*)S
(value,)252 1566 A
(and)126 1860 A
(for)126 2028 A
(setting)294 2196 A
(the)126 2532 A
("must)210 2700 A
(send)168 2952 A
(reply")252 3162 A
(flag.)210 3456 A
2655 V
(18123)210 1122 A
1482(*/)S
2745 V
(18124)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rmp)168 2448 A
2658(=)S
(&mproc[proc_nr];)672 2742 A
2835 V
(18125)210 1122 A
2925 V
(18126)210 1122 A
(rmp->mp_reply.reply_res)966 1524 A
2532(=)S
(result;)294 2616 A
3015 V
(18127)210 1122 A
(rmp->mp_flags)546 1524 A
2112(|=)S
(REPLY;)252 2238 A
2784(/*)S
(reply)210 2910 A
(pending)294 3162 A
3498(*/)S
3105 V
(18128)210 1122 A
3195 V
(18129)210 1122 A
1524(if)S
(\(rmp->mp_flags)588 1650 A
2280(&)S
(ONSWAP\))294 2364 A
3285 V
(18130)210 1122 A
(swap_inqueue\(rmp\);)756 1776 A
2784(/*)S
(must)168 2910 A
(swap)168 3120 A
(this)168 3330 A
(process)294 3540 A
(back)168 3876 A
4086(in)S
4212(*/)S
3375 V
(18131)210 1122 A
1440(})S
3555 V
(18133)210 1122 A
(/*===========================================================================*)3276 1440 A
3645 V
(18134)210 1122 A
1482(*)S
(pm_init)294 2784 A
4674(*)S
3735 V
(18135)210 1122 A
(*===========================================================================*/)3276 1482 A
3825 V
(18136)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(pm_init\(\))378 1986 A
3915 V
(18137)210 1122 A
1440({)S
4005 V
(18138)210 1122 A
1440(/*)S
(Initialize)420 1566 A
(the)126 2028 A
(process)294 2196 A
(manager.)336 2532 A
4095 V
(18139)210 1122 A
1482(*)S
(Memory)252 1566 A
(use)126 1860 A
(info)168 2028 A
2238(is)S
(collected)378 2364 A
(from)168 2784 A
(the)126 2994 A
(boot)168 3162 A
(monitor,)336 3372 A
(the)126 3750 A
(kernel,)294 3918 A
(and)126 4254 A
4185 V
(18140)210 1122 A
1482(*)S
(all)126 1566 A
(processes)378 1734 A
(compiled)336 2154 A
(into)168 2532 A
(the)126 2742 A
(system)252 2910 A
(image.)252 3204 A
(Initially)378 3498 A
(this)168 3918 A
(information)462 4128 A
4275 V
(18141)210 1122 A
1482(*)S
1566(is)S
(put)126 1692 A
(into)168 1860 A
2070(an)S
(array)210 2196 A
(mem_chunks.)462 2448 A
(Elements)336 2952 A
3330(of)S
(mem_chunks)420 3456 A
(are)126 3918 A
(struct)252 4086 A
(memory,)294 4380 A
4365 V
(18142)210 1122 A
1482(*)S
(and)126 1566 A
(hold)168 1734 A
(base,)210 1944 A
(size)168 2196 A
(pairs)210 2406 A
2658(in)S
(units)210 2784 A
3036(of)S
(clicks.)294 3162 A
(This)168 3498 A
(array)210 3708 A
3960(is)S
(small,)252 4086 A
(there)210 4380 A
4455 V
(18143)210 1122 A
1482(*)S
(should)252 1566 A
1860(be)S
1986(no)S
(more)168 2112 A
(than)168 2322 A
2532(8)S
(chunks.)294 2616 A
(After)210 2952 A
(the)126 3204 A
(array)210 3372 A
3624(of)S
(chunks)252 3750 A
(has)126 4044 A
(been)168 4212 A
(built)210 4422 A
4545 V
(18144)210 1122 A
1482(*)S
(the)126 1566 A
(contents)336 1734 A
(are)126 2112 A
(used)168 2280 A
2490(to)S
(initialize)420 2616 A
(the)126 3078 A
(hole)168 3246 A
(list.)210 3456 A
(Space)210 3708 A
(for)126 3960 A
(the)126 4128 A
(hole)168 4296 A
(list)168 4506 A
4635 V
(18145)210 1122 A
1482(*)S
1566(is)S
(reserved)336 1692 A
2070(as)S
2196(an)S
(array)210 2322 A
(with)168 2574 A
(twice)210 2784 A
3036(as)S
(many)168 3162 A
(elements)336 3372 A
3750(as)S
(the)126 3876 A
(maximum)294 4044 A
(number)252 4380 A
4725 V
(18146)210 1122 A
1482(*)S
1566(of)S
(processes)378 1692 A
(allowed.)336 2112 A
2490(It)S
2616(is)S
(managed)294 2742 A
3078(as)S
3204(a)S
(linked)252 3288 A
(list,)210 3582 A
(and)126 3834 A
(elements)336 4002 A
4380(of)S
(the)126 4506 A
4815 V
(18147)210 1122 A
1482(*)S
(array)210 1566 A
(are)126 1818 A
(struct)252 1986 A
(hole,)210 2280 A
(which,)252 2532 A
2826(in)S
(addition)336 2952 A
3330(to)S
(storage)294 3456 A
(for)126 3792 A
3960(a)S
(base)168 4044 A
(and)126 4254 A
(size)168 4422 A
4632(in)S
4905 V
(18148)210 1122 A
1482(*)S
(click)210 1566 A
(units)210 1818 A
(also)168 2070 A
(contain)294 2280 A
(space)210 2616 A
(for)126 2868 A
3036(a)S
(link,)210 3120 A
3372(a)S
(pointer)294 3456 A
3792(to)S
(another)294 3918 A
(element.)336 4254 A
4995 V
(18149)210 1122 A
1440(*/)S
5085 V
(18150)210 1122 A
(int)126 1524 A
1692(s;)S
5175 V
(18151)210 1122 A
(static)252 1524 A
(struct)252 1818 A
(boot_image)420 2112 A
(image[NR_BOOT_PROCS];)882 2574 A
5265 V
(18152)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(boot_image)420 2196 A
(*ip;)168 2658 A
5355 V
(18153)210 1122 A
(static)252 1524 A
(char)168 1818 A
(core_sigs[])462 2028 A
2532(=)S
2616({)S
(SIGQUIT,)336 2700 A
(SIGILL,)294 3078 A
(SIGTRAP,)336 3414 A
(SIGABRT,)336 3792 A
5445 V
(18154)210 1122 A
(SIGEMT,)294 2448 A
(SIGFPE,)294 2784 A
(SIGUSR1,)336 3120 A
(SIGSEGV,)336 3498 A
(SIGUSR2)294 3876 A
4212(};)S
5535 V
(18155)210 1122 A
(static)252 1524 A
(char)168 1818 A
(ign_sigs[])420 2028 A
2490(=)S
2574({)S
(SIGCHLD)294 2658 A
2994(};)S
5625 V
(18156)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rmp;)210 2448 A
5715 V
(18157)210 1122 A
(register)336 1524 A
(char)168 1902 A
(*sig_ptr;)378 2112 A
5805 V
(18158)210 1122 A
(phys_clicks)462 1524 A
(total_clicks,)546 2028 A
(minix_clicks,)546 2616 A
(free_clicks;)504 3204 A
5895 V
(18159)210 1122 A
(message)294 1524 A
(mess;)210 1860 A
5985 V
(18160)210 1122 A
(struct)252 1524 A
(mem_map)294 1818 A
(mem_map[NR_LOCAL_SEGS];)966 2154 A
6075 V
(18161)210 1122 A
(struct)252 1524 A
(memory)252 1818 A
(mem_chunks[NR_MEMS];)840 2112 A
6165 V
(18162)210 1122 A
6255 V
(18163)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(process)294 2112 A
(table,)252 2448 A
(including)378 2742 A
(timers.)294 3162 A
3498(*/)S
6345 V
(18164)210 1122 A
(for)126 1524 A
(\(rmp=&mproc[0];)630 1692 A
(rmp<&mproc[NR_PROCS];)882 2364 A
(rmp++\))252 3288 A
3582({)S
6435 V
(18165)210 1122 A
(tmr_inittimer\(&rmp->mp_timer\);)1260 1776 A
6525 V
(18166)210 1122 A
1524(})S
6615 V
(18167)210 1122 A
6705 V
(18168)210 1122 A
1524(/*)S
(Build)210 1650 A
(the)126 1902 A
(set)126 2070 A
2238(of)S
(signals)294 2364 A
(which)210 2700 A
(cause)210 2952 A
(core)168 3204 A
(dumps,)252 3414 A
(and)126 3708 A
(the)126 3876 A
(set)126 4044 A
4212(of)S
(signals)294 4338 A
6795 V
(18169)210 1122 A
1566(*)S
(that)168 1650 A
(are)126 1860 A
2028(by)S
(default)294 2154 A
(ignored.)336 2490 A
6885 V
(18170)210 1122 A
1566(*/)S
6975 V
(18171)210 1122 A
(sigemptyset\(&core_sset\);)1008 1524 A
7065 V
(18172)210 1122 A
(for)126 1524 A
(\(sig_ptr)336 1692 A
2070(=)S
(core_sigs;)420 2154 A
(sig_ptr)294 2616 A
2952(<)S
(core_sigs+sizeof\(core_sigs\);)1176 3036 A
(sig_ptr++\))420 4254 A
8418 V
EP
%%Page: 240 240
BP
/slant 0 def
/height 0 def
1485 V
12 B
(240)180 1080 A
11 R
2354(File:)S
2587(servers/pm/main.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(18173)210 1122 A
(sigaddset\(&core_sset,)882 1776 A
(*sig_ptr\);)420 2700 A
1845 V
(18174)210 1122 A
(sigemptyset\(&ign_sset\);)966 1524 A
1935 V
(18175)210 1122 A
(for)126 1524 A
(\(sig_ptr)336 1692 A
2070(=)S
(ign_sigs;)378 2154 A
(sig_ptr)294 2574 A
2910(<)S
(ign_sigs+sizeof\(ign_sigs\);)1092 2994 A
(sig_ptr++\))420 4128 A
2025 V
(18176)210 1122 A
(sigaddset\(&ign_sset,)840 1776 A
(*sig_ptr\);)420 2658 A
2115 V
(18177)210 1122 A
2205 V
(18178)210 1122 A
1524(/*)S
(Obtain)252 1650 A
1944(a)S
(copy)168 2028 A
2238(of)S
(the)126 2364 A
(boot)168 2532 A
(monitor)294 2742 A
(parameters)420 3078 A
(and)126 3540 A
(the)126 3708 A
(kernel)252 3876 A
(info)168 4170 A
(struct.)294 4380 A
2295 V
(18179)210 1122 A
1566(*)S
(Parse)210 1650 A
(the)126 1902 A
(list)168 2070 A
2280(of)S
(free)168 2406 A
(memory)252 2616 A
(chunks.)294 2910 A
(This)168 3246 A
(list)168 3456 A
3666(is)S
(what)168 3792 A
(the)126 4002 A
(boot)168 4170 A
(monitor)294 4380 A
2385 V
(18180)210 1122 A
1566(*)S
(reported,)378 1650 A
(but)126 2070 A
2238(it)S
(must)168 2364 A
2574(be)S
(corrected)378 2700 A
(for)126 3120 A
(the)126 3288 A
(kernel)252 3456 A
(and)126 3750 A
(system)252 3918 A
(processes.)420 4212 A
2475 V
(18181)210 1122 A
1566(*/)S
2565 V
(18182)210 1122 A
1524(if)S
(\(\(s=sys_getmonparams\(monitor_params,)1512 1650 A
(sizeof\(monitor_params\)\)\))1008 3204 A
4254(!=)S
(OK\))126 4380 A
2655 V
(18183)210 1122 A
(panic\(__FILE__,"get)798 1692 A
(monitor)294 2532 A
(params)252 2868 A
(failed",s\);)462 3162 A
2745 V
(18184)210 1122 A
(get_mem_chunks\(mem_chunks\);)1134 1524 A
2835 V
(18185)210 1122 A
1524(if)S
(\(\(s=sys_getkinfo\(&kinfo\)\))1050 1650 A
2742(!=)S
(OK\))126 2868 A
2925 V
(18186)210 1122 A
(panic\(__FILE__,"get)798 1692 A
(kernel)252 2532 A
(info)168 2826 A
(failed",s\);)462 3036 A
3015 V
(18187)210 1122 A
3105 V
(18188)210 1122 A
1524(/*)S
(Get)126 1650 A
(the)126 1818 A
(memory)252 1986 A
(map)126 2280 A
2448(of)S
(the)126 2574 A
(kernel)252 2742 A
3036(to)S
(see)126 3162 A
(how)126 3330 A
(much)168 3498 A
(memory)252 3708 A
4002(it)S
(uses.)210 4128 A
4380(*/)S
3195 V
(18189)210 1122 A
1524(if)S
(\(\(s=get_mem_map\(SYSTASK,)1008 1650 A
(mem_map\)\))378 2700 A
3120(!=)S
(OK\))126 3246 A
3285 V
(18190)210 1122 A
(panic\(__FILE__,"couldn't)1008 1776 A
(get)126 2826 A
(memory)252 2994 A
(map)126 3288 A
3456(of)S
(SYSTASK",s\);)504 3582 A
3375 V
(18191)210 1122 A
(minix_clicks)504 1524 A
2070(=)S
(\(mem_map[S].mem_phys+mem_map[S].mem_len\)-mem_map[T].mem_phys;)2562 2154 A
3465 V
(18192)210 1122 A
(patch_mem_chunks\(mem_chunks,)1176 1524 A
(mem_map\);)378 2742 A
3555 V
(18193)210 1122 A
3645 V
(18194)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(PM's)168 2112 A
(process)294 2322 A
(table.)252 2658 A
(Request)294 2952 A
3288(a)S
(copy)168 3372 A
3582(of)S
(the)126 3708 A
(system)252 3876 A
(image)210 4170 A
(table)210 4422 A
3735 V
(18195)210 1122 A
1566(*)S
(that)168 1650 A
1860(is)S
(defined)294 1986 A
2322(at)S
(the)126 2448 A
(kernel)252 2616 A
(level)210 2910 A
3162(to)S
(see)126 3288 A
(which)210 3456 A
(slots)210 3708 A
3960(to)S
(fill)168 4086 A
(in.)126 4296 A
3825 V
(18196)210 1122 A
1566(*/)S
3915 V
(18197)210 1122 A
1524(if)S
(\(OK)126 1650 A
1818(!=)S
(\(s=sys_getimage\(image\)\)\))1008 1944 A
4005 V
(18198)210 1122 A
(panic\(__FILE__,"couldn't)1008 1776 A
(get)126 2826 A
(image)210 2994 A
(table:)252 3246 A
(%d\\n",)252 3540 A
(s\);)126 3834 A
4095 V
(18199)210 1122 A
(procs_in_use)504 1524 A
2070(=)S
2154(0;)S
3456(/*)S
(start)210 3582 A
(populating)420 3834 A
(table)210 4296 A
4548(*/)S
4185 V
(18200)210 1122 A
(printf\("Building)672 1524 A
(process)294 2238 A
(table:"\);)378 2574 A
3456(/*)S
(show)168 3582 A
(what's)252 3792 A
(happening)378 4086 A
4506(*/)S
4275 V
(18201)210 1122 A
(for)126 1524 A
(\(ip)126 1692 A
1860(=)S
(&image[0];)420 1944 A
2406(ip)S
2532(<)S
(&image[NR_BOOT_PROCS];)924 2616 A
(ip++\))210 3582 A
3834({)S
4365 V
(18202)210 1122 A
1776(if)S
(\(ip->proc_nr)504 1902 A
2448(>=)S
2574(0\))S
2700({)S
3456(/*)S
(task)168 3582 A
(have)168 3792 A
(negative)336 4002 A
(nrs)126 4380 A
4548(*/)S
4455 V
(18203)210 1122 A
(procs_in_use)504 2112 A
2658(+=)S
2784(1;)S
3456(/*)S
(found)210 3582 A
(user)168 3834 A
(process)294 4044 A
4380(*/)S
4545 V
(18204)210 1122 A
4635 V
(18205)210 1122 A
2112(/*)S
(Set)126 2238 A
(process)294 2406 A
(details)294 2742 A
(found)210 3078 A
3330(in)S
(the)126 3456 A
(image)210 3624 A
(table.)252 3876 A
4170(*/)S
4725 V
(18206)210 1122 A
(rmp)126 2112 A
2280(=)S
(&mproc[ip->proc_nr];)840 2364 A
4815 V
(18207)210 1122 A
(strncpy\(rmp->mp_name,)882 2112 A
(ip->proc_name,)588 3036 A
(PROC_NAME_LEN\);)630 3666 A
4905 V
(18208)210 1122 A
(rmp->mp_parent)588 2112 A
2742(=)S
(RS_PROC_NR;)462 2826 A
4995 V
(18209)210 1122 A
(rmp->mp_nice)504 2112 A
2658(=)S
(get_nice_value\(ip->priority\);)1218 2742 A
5085 V
(18210)210 1122 A
2112(if)S
(\(ip->proc_nr)504 2238 A
2784(==)S
(INIT_PROC_NR\))546 2910 A
3498({)S
3792(/*)S
(user)168 3918 A
(process)294 4128 A
4464(*/)S
5175 V
(18211)210 1122 A
(rmp->mp_pid)462 2448 A
2952(=)S
(INIT_PID;)378 3036 A
5265 V
(18212)210 1122 A
(rmp->mp_flags)546 2448 A
3036(|=)S
(IN_USE;)294 3162 A
5355 V
(18213)210 1122 A
(sigemptyset\(&rmp->mp_ignore\);)1218 2448 A
5445 V
(18214)210 1122 A
2112(})S
5535 V
(18215)210 1122 A
(else)168 2112 A
2322({)S
3792(/*)S
(system)252 3918 A
(process)294 4212 A
4548(*/)S
5625 V
(18216)210 1122 A
(rmp->mp_pid)462 2448 A
2952(=)S
(get_free_pid\(\);)630 3036 A
5715 V
(18217)210 1122 A
(rmp->mp_flags)546 2448 A
3036(|=)S
(IN_USE)252 3162 A
3456(|)S
(DONT_SWAP)378 3540 A
3960(|)S
(PRIV_PROC;)420 4044 A
5805 V
(18218)210 1122 A
(sigfillset\(&rmp->mp_ignore\);)1176 2448 A
5895 V
(18219)210 1122 A
2112(})S
5985 V
(18220)210 1122 A
(sigemptyset\(&rmp->mp_sigmask\);)1260 2112 A
6075 V
(18221)210 1122 A
(sigemptyset\(&rmp->mp_catch\);)1176 2112 A
6165 V
(18222)210 1122 A
(sigemptyset\(&rmp->mp_sig2mess\);)1302 2112 A
6255 V
(18223)210 1122 A
6345 V
(18224)210 1122 A
2112(/*)S
(Get)126 2238 A
(memory)252 2406 A
(map)126 2700 A
(for)126 2868 A
(this)168 3036 A
(process)294 3246 A
(from)168 3582 A
(the)126 3792 A
(kernel.)294 3960 A
4296(*/)S
6435 V
(18225)210 1122 A
2112(if)S
(\(\(s=get_mem_map\(ip->proc_nr,)1176 2238 A
(rmp->mp_seg\)\))546 3456 A
4044(!=)S
(OK\))126 4170 A
6525 V
(18226)210 1122 A
(panic\(__FILE__,"couldn't)1008 2448 A
(get)126 3498 A
(process)294 3666 A
(entry",s\);)420 4002 A
6615 V
(18227)210 1122 A
2112(if)S
(\(rmp->mp_seg[T].mem_len)966 2238 A
3246(!=)S
3372(0\))S
(rmp->mp_flags)546 3498 A
4086(|=)S
(SEPARATE;)378 4212 A
6705 V
(18228)210 1122 A
(minix_clicks)504 2112 A
2658(+=)S
(rmp->mp_seg[S].mem_phys)966 2784 A
3792(+)S
6795 V
(18229)210 1122 A
(rmp->mp_seg[S].mem_len)924 2448 A
3414(-)S
(rmp->mp_seg[T].mem_phys;)1008 3498 A
6885 V
(18230)210 1122 A
(patch_mem_chunks\(mem_chunks,)1176 2112 A
(rmp->mp_seg\);)546 3330 A
6975 V
(18231)210 1122 A
7065 V
(18232)210 1122 A
2112(/*)S
(Tell)168 2238 A
2448(FS)S
(about)210 2574 A
(this)168 2826 A
(system)252 3036 A
(process.)336 3330 A
3708(*/)S
8418 V
EP
%%Page: 241 241
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2354(File:)S
2587(servers/pm/main.c)S
12 B
(241)180 4500 A
1755 V
7 LST
(18233)210 1122 A
(mess.PR_PROC_NR)630 2112 A
2784(=)S
(ip->proc_nr;)504 2868 A
1845 V
(18234)210 1122 A
(mess.PR_PID)462 2112 A
2616(=)S
(rmp->mp_pid;)504 2700 A
1935 V
(18235)210 1122 A
2112(if)S
(\(OK)126 2238 A
2406(!=)S
(\(s=send\(FS_PROC_NR,)798 2532 A
(&mess\)\)\))336 3372 A
2025 V
(18236)210 1122 A
(panic\(__FILE__,"can't)882 2448 A
(sync)168 3372 A
3582(up)S
(with)168 3708 A
(FS",)168 3918 A
(s\);)126 4128 A
2115 V
(18237)210 1122 A
(printf\(")336 2112 A
(%s",)168 2490 A
(ip->proc_name\);)630 2700 A
3456(/*)S
(display)294 3582 A
(process)294 3918 A
(name)168 4254 A
4464(*/)S
2205 V
(18238)210 1122 A
1776(})S
2295 V
(18239)210 1122 A
1524(})S
2385 V
(18240)210 1122 A
(printf\(".\\n"\);)588 1524 A
3456(/*)S
(last)168 3582 A
(process)294 3792 A
(done)168 4128 A
4338(*/)S
2475 V
(18241)210 1122 A
2565 V
(18242)210 1122 A
1524(/*)S
(Override)336 1650 A
(some)168 2028 A
(details.)336 2238 A
2616(PM)S
2742(is)S
(somewhat)336 2868 A
(special.)336 3246 A
3624(*/)S
2655 V
(18243)210 1122 A
(mproc[PM_PROC_NR].mp_pid)1008 1524 A
2574(=)S
(PM_PID;)294 2658 A
3456(/*)S
(magically)378 3582 A
(override)336 4002 A
(pid)126 4380 A
4548(*/)S
2745 V
(18244)210 1122 A
(mproc[PM_PROC_NR].mp_parent)1134 1524 A
2700(=)S
(PM_PROC_NR;)462 2784 A
3456(/*)S
3582(PM)S
(doesn't)294 3708 A
(have)168 4044 A
(parent)252 4254 A
4548(*/)S
2835 V
(18245)210 1122 A
2925 V
(18246)210 1122 A
1524(/*)S
(Tell)168 1650 A
1860(FS)S
(that)168 1986 A
2196(no)S
(more)168 2322 A
(system)252 2532 A
(processes)378 2826 A
(follow)252 3246 A
(and)126 3540 A
(synchronize.)504 3708 A
4254(*/)S
3015 V
(18247)210 1122 A
(mess.PR_PROC_NR)630 1524 A
2196(=)S
(NONE;)210 2280 A
3105 V
(18248)210 1122 A
1524(if)S
(\(sendrec\(FS_PROC_NR,)840 1650 A
(&mess\))252 2532 A
2826(!=)S
2952(OK)S
3078(||)S
(mess.m_type)462 3204 A
3708(!=)S
(OK\))126 3834 A
3195 V
(18249)210 1122 A
(panic\(__FILE__,"can't)882 1776 A
(sync)168 2700 A
2910(up)S
(with)168 3036 A
(FS",)168 3246 A
(NO_NUM\);)336 3456 A
3285 V
(18250)210 1122 A
3375 V
(18251)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(tables)252 2112 A
2406(to)S
(all)126 2532 A
(physical)336 2700 A
(memory)252 3078 A
(and)126 3372 A
(print)210 3540 A
(memory)252 3792 A
(information.)504 4086 A
4632(*/)S
3465 V
(18252)210 1122 A
(printf\("Physical)672 1524 A
(memory:"\);)420 2238 A
3555 V
(18253)210 1122 A
(mem_init\(mem_chunks,)840 1524 A
(&free_clicks\);)588 2406 A
3645 V
(18254)210 1122 A
(total_clicks)504 1524 A
2070(=)S
(minix_clicks)504 2154 A
2700(+)S
(free_clicks;)504 2784 A
3735 V
(18255)210 1122 A
(printf\(")336 1524 A
(total)210 1902 A
2154(%u)S
(KB,",)210 2280 A
(click_to_round_k\(total_clicks\)\);)1344 2532 A
3825 V
(18256)210 1122 A
(printf\(")336 1524 A
(system)252 1902 A
2196(%u)S
(KB,",)210 2322 A
(click_to_round_k\(minix_clicks\)\);)1344 2574 A
3915 V
(18257)210 1122 A
(printf\(")336 1524 A
(free)168 1902 A
2112(%u)S
(KB.\\n",)294 2238 A
(click_to_round_k\(free_clicks\)\);)1302 2574 A
4005 V
(18258)210 1122 A
1440(})S
4185 V
(18260)210 1122 A
(/*===========================================================================*)3276 1440 A
4275 V
(18261)210 1122 A
1482(*)S
(get_nice_value)588 2784 A
4674(*)S
4365 V
(18262)210 1122 A
(*===========================================================================*/)3276 1482 A
4455 V
(18263)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(get_nice_value\(queue\))882 1944 A
4545 V
(18264)210 1122 A
(int)126 1440 A
(queue;)252 1608 A
3120(/*)S
(store)210 3246 A
(mem)126 3498 A
(chunks)252 3666 A
(here)168 3960 A
4170(*/)S
4635 V
(18265)210 1122 A
1440({)S
4725 V
(18266)210 1122 A
1440(/*)S
(Processes)378 1566 A
1986(in)S
(the)126 2112 A
(boot)168 2280 A
(image)210 2490 A
(have)168 2742 A
2952(a)S
(priority)336 3036 A
(assigned.)378 3414 A
(The)126 3834 A
4002(PM)S
(doesn't)294 4128 A
(know)168 4464 A
4815 V
(18267)210 1122 A
1482(*)S
(about)210 1566 A
(priorities,)462 1818 A
(but)126 2322 A
(uses)168 2490 A
('nice')252 2700 A
(values)252 2994 A
(instead.)336 3288 A
(The)126 3666 A
(priority)336 3834 A
4212(is)S
(between)294 4338 A
4905 V
(18268)210 1122 A
1482(*)S
(MIN_USER_Q)420 1566 A
(and)126 2028 A
(MAX_USER_Q.)462 2196 A
2700(We)S
(have)168 2826 A
3036(to)S
(scale)210 3162 A
(between)294 3414 A
(PRIO_MIN)336 3750 A
(and)126 4128 A
(PRIO_MAX.)378 4296 A
4995 V
(18269)210 1122 A
1482(*/)S
5085 V
(18270)210 1122 A
(int)126 1524 A
(nice_val)336 1692 A
2070(=)S
(\(queue)252 2154 A
2448(-)S
(USER_Q\))294 2532 A
2868(*)S
(\(PRIO_MAX-PRIO_MIN+1\))882 2952 A
3876(/)S
5175 V
(18271)210 1122 A
(\(MIN_USER_Q-MAX_USER_Q+1\);)1092 1692 A
5265 V
(18272)210 1122 A
1524(if)S
(\(nice_val)378 1650 A
2070(>)S
(PRIO_MAX\))378 2154 A
(nice_val)336 2574 A
2952(=)S
(PRIO_MAX;)378 3036 A
3456(/*)S
(shouldn't)378 3582 A
(happen)252 4002 A
4296(*/)S
5355 V
(18273)210 1122 A
1524(if)S
(\(nice_val)378 1650 A
2070(<)S
(PRIO_MIN\))378 2154 A
(nice_val)336 2574 A
2952(=)S
(PRIO_MIN;)378 3036 A
3456(/*)S
(shouldn't)378 3582 A
(happen)252 4002 A
4296(*/)S
5445 V
(18274)210 1122 A
(return)252 1524 A
(nice_val;)378 1818 A
5535 V
(18275)210 1122 A
1440(})S
5715 V
(18277)210 1122 A
(/*===========================================================================*)3276 1440 A
5805 V
(18278)210 1122 A
1482(*)S
(get_mem_chunks)588 2784 A
4674(*)S
5895 V
(18279)210 1122 A
(*===========================================================================*/)3276 1482 A
5985 V
(18280)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(get_mem_chunks\(mem_chunks\))1092 1986 A
6075 V
(18281)210 1122 A
(struct)252 1440 A
(memory)252 1734 A
(*mem_chunks;)504 2028 A
3456(/*)S
(store)210 3582 A
(mem)126 3834 A
(chunks)252 4002 A
(here)168 4296 A
4506(*/)S
6165 V
(18282)210 1122 A
1440({)S
6255 V
(18283)210 1122 A
1440(/*)S
(Initialize)420 1566 A
(the)126 2028 A
(free)168 2196 A
(memory)252 2406 A
(list)168 2700 A
(from)168 2910 A
(the)126 3120 A
('memory')336 3288 A
(boot)168 3666 A
(variable.)378 3876 A
(Translate)378 4338 A
6345 V
(18284)210 1122 A
1482(*)S
(the)126 1566 A
(byte)168 1734 A
(offsets)294 1944 A
(and)126 2280 A
(sizes)210 2448 A
2700(in)S
(this)168 2826 A
(list)168 3036 A
3246(to)S
(clicks,)294 3372 A
(properly)336 3708 A
(truncated.)420 4086 A
(Also)168 4548 A
6435 V
(18285)210 1122 A
1482(*)S
(make)168 1566 A
(sure)168 1776 A
(that)168 1986 A
2196(we)S
(don't)210 2322 A
(exceed)252 2574 A
(the)126 2868 A
(maximum)294 3036 A
(address)294 3372 A
(space)210 3708 A
3960(of)S
(the)126 4086 A
(286)126 4254 A
4422(or)S
(the)126 4548 A
6525 V
(18286)210 1122 A
1482(*)S
(8086,)210 1566 A
(i.e.)168 1818 A
(when)168 2028 A
(running)294 2238 A
2574(in)S
(16-bit)252 2700 A
(protected)378 2994 A
(mode)168 3414 A
3624(or)S
(real)168 3750 A
(mode.)210 3960 A
6615 V
(18287)210 1122 A
1482(*/)S
6705 V
(18288)210 1122 A
(long)168 1524 A
(base,)210 1734 A
(size,)210 1986 A
(limit;)252 2238 A
6795 V
(18289)210 1122 A
(char)168 1524 A
(*s,)126 1734 A
(*end;)210 1902 A
3120(/*)S
(use)126 3246 A
3414(to)S
(parse)210 3540 A
(boot)168 3792 A
(variable)336 4002 A
4380(*/)S
6885 V
(18290)210 1122 A
(int)126 1524 A
1692(i,)S
(done)168 1818 A
2028(=)S
2112(0;)S
6975 V
(18291)210 1122 A
(struct)252 1524 A
(memory)252 1818 A
(*memp;)252 2112 A
7065 V
(18292)210 1122 A
8418 V
EP
%%Page: 242 242
BP
/slant 0 def
/height 0 def
1485 V
12 B
(242)180 1080 A
11 R
2354(File:)S
2587(servers/pm/main.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(18293)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(everything)420 2112 A
2574(to)S
(zero.)210 2700 A
2952(*/)S
1845 V
(18294)210 1122 A
(for)126 1524 A
1692(\(i)S
1818(=)S
1902(0;)S
2028(i)S
2112(<)S
(NR_MEMS;)336 2196 A
(i++\))168 2574 A
2784({)S
1935 V
(18295)210 1122 A
(memp)168 1776 A
1986(=)S
(&mem_chunks[i];)630 2070 A
3120(/*)S
(next)168 3246 A
(mem)126 3456 A
(chunk)210 3624 A
3876(is)S
(stored)252 4002 A
(here)168 4296 A
4506(*/)S
2025 V
(18296)210 1122 A
(memp->base)420 1776 A
2238(=)S
(memp->size)420 2322 A
2784(=)S
2868(0;)S
2115 V
(18297)210 1122 A
1524(})S
2205 V
(18298)210 1122 A
2295 V
(18299)210 1122 A
1524(/*)S
(The)126 1650 A
(available)378 1818 A
(memory)252 2238 A
2532(is)S
(determined)420 2658 A
3120(by)S
(MINIX')252 3246 A
(boot)168 3540 A
(loader)252 3750 A
4044(as)S
4170(a)S
(list)168 4254 A
4464(of)S
2385 V
(18300)210 1122 A
1566(*)S
(\(base:size\)-pairs)714 1650 A
2406(in)S
(boothead.s.)462 2532 A
(The)126 3036 A
('memory')336 3204 A
(boot)168 3582 A
(variable)336 3792 A
4170(is)S
(set)126 4296 A
4464(in)S
2475 V
(18301)210 1122 A
1566(*)S
1650(in)S
(boot.s.)294 1776 A
(The)126 2154 A
(format)252 2322 A
2616(is)S
("b0:s0,b1:s1,b2:s2",)840 2742 A
(where)210 3624 A
(b0:s0)210 3876 A
4128(is)S
(low)126 4254 A
(mem,)168 4422 A
2565 V
(18302)210 1122 A
1566(*)S
(b1:s1)210 1650 A
1902(is)S
(mem)126 2028 A
(between)294 2196 A
2532(1M)S
(and)126 2658 A
(16M,)168 2826 A
(b2:s2)210 3036 A
3288(is)S
(mem)126 3414 A
(above)210 3582 A
(16M.)168 3834 A
(Pairs)210 4044 A
(b1:s1)210 4296 A
2655 V
(18303)210 1122 A
1566(*)S
(and)126 1650 A
(b2:s2)210 1818 A
(are)126 2070 A
(combined)336 2238 A
2616(if)S
(the)126 2742 A
(memory)252 2910 A
3204(is)S
(adjacent.)378 3330 A
2745 V
(18304)210 1122 A
1566(*/)S
2835 V
(18305)210 1122 A
1524(s)S
1608(=)S
(find_param\("memory"\);)882 1692 A
3120(/*)S
(get)126 3246 A
(memory)252 3414 A
(boot)168 3708 A
(variable)336 3918 A
4296(*/)S
2925 V
(18306)210 1122 A
(for)126 1524 A
1692(\(i)S
1818(=)S
1902(0;)S
2028(i)S
2112(<)S
(NR_MEMS)294 2196 A
2532(&&)S
(!done;)252 2658 A
(i++\))168 2952 A
3162({)S
3015 V
(18307)210 1122 A
(memp)168 1776 A
1986(=)S
(&mem_chunks[i];)630 2070 A
3120(/*)S
(next)168 3246 A
(mem)126 3456 A
(chunk)210 3624 A
3876(is)S
(stored)252 4002 A
(here)168 4296 A
4506(*/)S
3105 V
(18308)210 1122 A
(base)168 1776 A
1986(=)S
(size)168 2070 A
2280(=)S
2364(0;)S
3120(/*)S
(initialize)420 3246 A
(next)168 3708 A
(base:size)378 3918 A
(pair)168 4338 A
4548(*/)S
3195 V
(18309)210 1122 A
1776(if)S
(\(*s)126 1902 A
2070(!=)S
2196(0\))S
2322({)S
3120(/*)S
(get)126 3246 A
(fresh)210 3414 A
(data,)210 3666 A
(unless)252 3918 A
4212(at)S
(end)126 4338 A
4506(*/)S
3285 V
(18310)210 1122 A
3375 V
(18311)210 1122 A
1944(/*)S
(Read)168 2070 A
(fresh)210 2280 A
(base)168 2532 A
(and)126 2742 A
(expect)252 2910 A
(colon)210 3204 A
3456(as)S
(next)168 3582 A
(char.)210 3792 A
4044(*/)S
3465 V
(18312)210 1122 A
(base)168 1944 A
2154(=)S
(strtoul\(s,)420 2238 A
(&end,)210 2700 A
(0x10\);)252 2952 A
3792(/*)S
(get)126 3918 A
(number)252 4086 A
4380(*/)S
3555 V
(18313)210 1122 A
1944(if)S
(\(end)168 2070 A
2280(!=)S
2406(s)S
2490(&&)S
(*end)168 2616 A
2826(==)S
(':'\))168 2952 A
3162(s)S
3246(=)S
(++end;)252 3330 A
3792(/*)S
(skip)168 3918 A
(':')126 4128 A
4296(*/)S
3645 V
(18314)210 1122 A
(else)168 1944 A
(*s=0;)210 2154 A
3120(/*)S
(terminate,)420 3246 A
(should)252 3708 A
(not)126 4002 A
(happen)252 4170 A
4464(*/)S
3735 V
(18315)210 1122 A
3825 V
(18316)210 1122 A
1944(/*)S
(Read)168 2070 A
(fresh)210 2280 A
(size)168 2532 A
(and)126 2742 A
(expect)252 2910 A
(comma)210 3204 A
3456(or)S
(assume)252 3582 A
(end.)168 3876 A
4086(*/)S
3915 V
(18317)210 1122 A
(size)168 1944 A
2154(=)S
(strtoul\(s,)420 2238 A
(&end,)210 2700 A
(0x10\);)252 2952 A
3792(/*)S
(get)126 3918 A
(number)252 4086 A
4380(*/)S
4005 V
(18318)210 1122 A
1944(if)S
(\(end)168 2070 A
2280(!=)S
2406(s)S
2490(&&)S
(*end)168 2616 A
2826(==)S
(','\))168 2952 A
3162(s)S
3246(=)S
(++end;)252 3330 A
3792(/*)S
(skip)168 3918 A
(',')126 4128 A
4296(*/)S
4095 V
(18319)210 1122 A
(else)168 1944 A
(done)168 2154 A
2364(=)S
2448(1;)S
4185 V
(18320)210 1122 A
1776(})S
4275 V
(18321)210 1122 A
(limit)210 1776 A
2028(=)S
(base)168 2112 A
2322(+)S
(size;)210 2406 A
4365 V
(18322)210 1122 A
(base)168 1776 A
1986(=)S
(\(base)210 2070 A
2322(+)S
(CLICK_SIZE-1\))546 2406 A
2994(&)S
(\304\(long\)\(CLICK_SIZE-1\);)924 3078 A
4455 V
(18323)210 1122 A
(limit)210 1776 A
2028(&=)S
(\304\(long\)\(CLICK_SIZE-1\);)924 2154 A
4545 V
(18324)210 1122 A
1776(if)S
(\(limit)252 1902 A
2196(<=)S
(base\))210 2322 A
(continue;)378 2574 A
4635 V
(18325)210 1122 A
(memp->base)420 1776 A
2238(=)S
(base)168 2322 A
2532(>>)S
(CLICK_SHIFT;)504 2658 A
4725 V
(18326)210 1122 A
(memp->size)420 1776 A
2238(=)S
(\(limit)252 2322 A
2616(-)S
(base\))210 2700 A
2952(>>)S
(CLICK_SHIFT;)504 3078 A
4815 V
(18327)210 1122 A
1524(})S
4905 V
(18328)210 1122 A
1440(})S
5085 V
(18330)210 1122 A
(/*===========================================================================*)3276 1440 A
5175 V
(18331)210 1122 A
1482(*)S
(patch_mem_chunks)672 2784 A
4674(*)S
5265 V
(18332)210 1122 A
(*===========================================================================*/)3276 1482 A
5355 V
(18333)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(patch_mem_chunks\(mem_chunks,)1176 1986 A
(map_ptr\))336 3204 A
5445 V
(18334)210 1122 A
(struct)252 1440 A
(memory)252 1734 A
(*mem_chunks;)504 2028 A
3456(/*)S
(store)210 3582 A
(mem)126 3834 A
(chunks)252 4002 A
(here)168 4296 A
4506(*/)S
5535 V
(18335)210 1122 A
(struct)252 1440 A
(mem_map)294 1734 A
(*map_ptr;)378 2070 A
3456(/*)S
(memory)252 3582 A
3876(to)S
(remove)252 4002 A
4296(*/)S
5625 V
(18336)210 1122 A
1440({)S
5715 V
(18337)210 1122 A
1440(/*)S
(Remove)252 1566 A
(server)252 1860 A
(memory)252 2154 A
(from)168 2448 A
(the)126 2658 A
(free)168 2826 A
(memory)252 3036 A
(list.)210 3330 A
(The)126 3582 A
(boot)168 3750 A
(monitor)294 3960 A
5805 V
(18338)210 1122 A
1482(*)S
(promises)336 1566 A
1944(to)S
(put)126 2070 A
(processes)378 2238 A
2658(at)S
(the)126 2784 A
(start)210 2952 A
3204(of)S
(memory)252 3330 A
(chunks.)294 3624 A
(The)126 3960 A
5895 V
(18339)210 1122 A
1482(*)S
(tasks)210 1566 A
(all)126 1818 A
(use)126 1986 A
(same)168 2154 A
(base)168 2364 A
(address,)336 2574 A
2952(so)S
(only)168 3078 A
(the)126 3288 A
(first)210 3456 A
(task)168 3708 A
(changes)294 3918 A
5985 V
(18340)210 1122 A
1482(*)S
(the)126 1566 A
(memory)252 1734 A
(lists.)252 2028 A
(The)126 2322 A
(servers)294 2490 A
(and)126 2826 A
(init)168 2994 A
(have)168 3204 A
(their)210 3414 A
(own)126 3666 A
(memory)252 3834 A
6075 V
(18341)210 1122 A
1482(*)S
(spaces)252 1566 A
(and)126 1860 A
(their)210 2028 A
(memory)252 2280 A
(will)168 2574 A
2784(be)S
(removed)294 2910 A
(from)168 3246 A
(the)126 3456 A
(list.)210 3624 A
6165 V
(18342)210 1122 A
1482(*/)S
6255 V
(18343)210 1122 A
(struct)252 1524 A
(memory)252 1818 A
(*memp;)252 2112 A
6345 V
(18344)210 1122 A
(for)126 1524 A
(\(memp)210 1692 A
1944(=)S
(mem_chunks;)462 2028 A
(memp)168 2532 A
2742(<)S
(&mem_chunks[NR_MEMS];)882 2826 A
(memp++\))294 3750 A
4086({)S
6435 V
(18345)210 1122 A
1776(if)S
(\(memp->base)462 1902 A
2406(==)S
(map_ptr[T].mem_phys\))840 2532 A
3414({)S
6525 V
(18346)210 1122 A
(memp->base)420 2112 A
2574(+=)S
(map_ptr[T].mem_len)756 2700 A
3498(+)S
(map_ptr[D].mem_len;)798 3582 A
6615 V
(18347)210 1122 A
(memp->size)420 2112 A
2574(-=)S
(map_ptr[T].mem_len)756 2700 A
3498(+)S
(map_ptr[D].mem_len;)798 3582 A
6705 V
(18348)210 1122 A
1776(})S
6795 V
(18349)210 1122 A
1524(})S
6885 V
(18350)210 1122 A
1440(})S
8418 V
EP
%%Page: 243 243
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2290(File:)S
2523(servers/pm/forkexit.c)S
12 B
(243)180 4500 A
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(servers/pm/forkexit.c)882 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(18400)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(deals)210 1986 A
(with)168 2238 A
(creating)336 2448 A
(processes)378 2826 A
(\(via)168 3246 A
(FORK\))210 3456 A
(and)126 3708 A
(deleting)336 3876 A
(them)168 4254 A
(\(via)168 4464 A
2295 V
(18401)210 1122 A
1482(*)S
(EXIT/WAIT\).)462 1566 A
(When)168 2112 A
2322(a)S
(process)294 2406 A
(forks,)252 2742 A
3036(a)S
(new)126 3120 A
(slot)168 3288 A
3498(in)S
(the)126 3624 A
('mproc')294 3792 A
(table)210 4128 A
4380(is)S
2385 V
(18402)210 1122 A
1482(*)S
(allocated)378 1566 A
(for)126 1986 A
(it,)126 2154 A
(and)126 2322 A
2490(a)S
(copy)168 2574 A
2784(of)S
(the)126 2910 A
(parent's)336 3078 A
(core)168 3456 A
(image)210 3666 A
3918(is)S
(made)168 4044 A
(for)126 4254 A
(the)126 4422 A
2475 V
(18403)210 1122 A
1482(*)S
(child.)252 1566 A
(Then)168 1902 A
(the)126 2112 A
(kernel)252 2280 A
(and)126 2574 A
(file)168 2742 A
(system)252 2952 A
(are)126 3246 A
(informed.)378 3414 A
3876(A)S
(process)294 3960 A
4296(is)S
(removed)294 4422 A
2565 V
(18404)210 1122 A
1482(*)S
(from)168 1566 A
(the)126 1776 A
('mproc')294 1944 A
(table)210 2280 A
(when)168 2532 A
(two)126 2742 A
(events)252 2910 A
(have)168 3204 A
(occurred:)378 3414 A
(\(1\))126 3834 A
4002(it)S
(has)126 4128 A
(exited)252 4296 A
4590(or)S
2655 V
(18405)210 1122 A
1482(*)S
(been)168 1566 A
(killed)252 1776 A
2070(by)S
2196(a)S
(signal,)294 2280 A
(and)126 2616 A
(\(2\))126 2784 A
(the)126 2952 A
(parent)252 3120 A
(has)126 3414 A
(done)168 3582 A
3792(a)S
(WAIT.)210 3876 A
4170(If)S
(the)126 4296 A
(process)294 4464 A
2745 V
(18406)210 1122 A
1482(*)S
(exits)210 1566 A
(first,)252 1818 A
2112(it)S
(continues)378 2238 A
2658(to)S
(occupy)252 2784 A
3078(a)S
(slot)168 3162 A
(until)210 3372 A
(the)126 3624 A
(parent)252 3792 A
(does)168 4086 A
4296(a)S
(WAIT.)210 4380 A
2835 V
(18407)210 1122 A
1482(*)S
2925 V
(18408)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are:)168 2910 A
3015 V
(18409)210 1122 A
1482(*)S
(do_fork:)336 1650 A
(perform)294 2154 A
(the)126 2490 A
(FORK)168 2658 A
(system)252 2868 A
(call)168 3162 A
3105 V
(18410)210 1122 A
1482(*)S
(do_pm_exit:)462 1650 A
(perform)294 2154 A
(the)126 2490 A
(EXIT)168 2658 A
(system)252 2868 A
(call)168 3162 A
(\(by)126 3372 A
(calling)294 3540 A
(pm_exit\(\)\))420 3876 A
3195 V
(18411)210 1122 A
1482(*)S
(pm_exit:)336 1650 A
(actually)336 2154 A
2532(do)S
(the)126 2658 A
(exiting)294 2826 A
3285 V
(18412)210 1122 A
1482(*)S
(do_wait:)336 1650 A
(perform)294 2154 A
(the)126 2490 A
(WAITPID)294 2658 A
2994(or)S
(WAIT)168 3120 A
(system)252 3330 A
(call)168 3624 A
3375 V
(18413)210 1122 A
1482(*/)S
3465 V
(18414)210 1122 A
3555 V
(18415)210 1122 A
(#include)336 1440 A
("pm.h")252 1818 A
3645 V
(18416)210 1122 A
(#include)336 1440 A
(<sys/wait.h>)504 1818 A
3735 V
(18417)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
3825 V
(18418)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
3915 V
(18419)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
4005 V
(18420)210 1122 A
(#include)336 1440 A
("mproc.h")378 1818 A
4095 V
(18421)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
4185 V
(18422)210 1122 A
4275 V
(18423)210 1122 A
(#define)294 1440 A
(LAST_FEW)336 1776 A
2616(2)S
2784(/*)S
(last)168 2910 A
(few)126 3120 A
(slots)210 3288 A
(reserved)336 3540 A
(for)126 3918 A
(superuser)378 4086 A
4506(*/)S
4365 V
(18424)210 1122 A
4455 V
(18425)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE)420 1776 A
(\(void)210 2238 A
(cleanup,)336 2490 A
(\(register)378 2868 A
(struct)252 3288 A
(mproc)210 3582 A
(*child\))294 3834 A
4170(\);)S
4545 V
(18426)210 1122 A
4635 V
(18427)210 1122 A
(/*===========================================================================*)3276 1440 A
4725 V
(18428)210 1122 A
1482(*)S
(do_fork)294 2784 A
4674(*)S
4815 V
(18429)210 1122 A
(*===========================================================================*/)3276 1482 A
4905 V
(18430)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_fork\(\))378 1902 A
4995 V
(18431)210 1122 A
1440({)S
5085 V
(18432)210 1122 A
1440(/*)S
(The)126 1566 A
(process)294 1734 A
(pointed)294 2070 A
2406(to)S
2532(by)S
('mp')168 2658 A
(has)126 2868 A
(forked.)294 3036 A
(Create)252 3414 A
3708(a)S
(child)210 3792 A
(process.)336 4044 A
4422(*/)S
5175 V
(18433)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rmp;)210 2448 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(parent)252 3372 A
3666(*/)S
5265 V
(18434)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rmc;)210 2448 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(child)210 3372 A
3624(*/)S
5355 V
(18435)210 1122 A
(int)126 1524 A
(child_nr,)378 1692 A
2112(s;)S
5445 V
(18436)210 1122 A
(phys_clicks)462 1524 A
(prog_clicks,)504 2028 A
(child_base;)462 2574 A
5535 V
(18437)210 1122 A
(phys_bytes)420 1524 A
(prog_bytes,)462 1986 A
(parent_abs,)462 2490 A
(child_abs;)420 2994 A
3456(/*)S
(Intel)210 3582 A
(only)168 3834 A
4044(*/)S
5625 V
(18438)210 1122 A
(pid_t)210 1524 A
(new_pid;)336 1776 A
5715 V
(18439)210 1122 A
5805 V
(18440)210 1122 A
1482(/*)S
1608(If)S
(tables)252 1734 A
(might)210 2028 A
(fill)168 2280 A
2490(up)S
(during)252 2616 A
(FORK,)210 2910 A
(don't)210 3162 A
(even)168 3414 A
(start)210 3624 A
(since)210 3876 A
(recovery)336 4128 A
(half)168 4506 A
5895 V
(18441)210 1122 A
1524(*)S
(way)126 1608 A
(through)294 1776 A
2112(is)S
(such)168 2238 A
2448(a)S
(nuisance.)378 2532 A
5985 V
(18442)210 1122 A
1524(*/)S
6075 V
(18443)210 1122 A
(rmp)126 1524 A
1692(=)S
(mp;)126 1776 A
6165 V
(18444)210 1122 A
1524(if)S
(\(\(procs_in_use)588 1650 A
2280(==)S
(NR_PROCS\))378 2406 A
2826(||)S
6255 V
(18445)210 1122 A
(\(procs_in_use)546 2112 A
2700(>=)S
(NR_PROCS-LAST_FEW)714 2826 A
3582(&&)S
(rmp->mp_effuid)588 3708 A
4338(!=)S
(0\)\))126 4464 A
6345 V
(18446)210 1122 A
1524({)S
6435 V
(18447)210 1122 A
(printf\("PM:)462 1776 A
(warning,)336 2280 A
(process)294 2658 A
(table)210 2994 A
3246(is)S
(full!\\n"\);)420 3372 A
6525 V
(18448)210 1122 A
(return\(EAGAIN\);)630 1776 A
6615 V
(18449)210 1122 A
1524(})S
6705 V
(18450)210 1122 A
6795 V
(18451)210 1122 A
1524(/*)S
(Determine)378 1650 A
(how)126 2070 A
(much)168 2238 A
(memory)252 2448 A
2742(to)S
(allocate.)378 2868 A
(Only)168 3330 A
(the)126 3540 A
(data)168 3708 A
(and)126 3918 A
(stack)210 4086 A
(need)168 4338 A
4548(to)S
6885 V
(18452)210 1122 A
1566(*)S
1650(be)S
(copied,)294 1776 A
(because)294 2112 A
(the)126 2448 A
(text)168 2616 A
(segment)294 2826 A
3162(is)S
(either)252 3288 A
(shared)252 3582 A
3876(or)S
4002(of)S
(zero)168 4128 A
(length.)294 4338 A
6975 V
(18453)210 1122 A
1566(*/)S
7065 V
(18454)210 1122 A
(prog_clicks)462 1524 A
2028(=)S
(\(phys_clicks\))546 2112 A
(rmp->mp_seg[S].mem_len;)966 2700 A
8418 V
EP
%%Page: 244 244
BP
/slant 0 def
/height 0 def
1485 V
12 B
(244)180 1080 A
11 R
2290(File:)S
2523(servers/pm/forkexit.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(18455)210 1122 A
(prog_clicks)462 1524 A
2028(+=)S
(\(rmp->mp_seg[S].mem_vir)966 2154 A
3162(-)S
(rmp->mp_seg[D].mem_vir\);)1008 3246 A
1845 V
(18456)210 1122 A
(prog_bytes)420 1524 A
1986(=)S
(\(phys_bytes\))504 2070 A
(prog_clicks)462 2616 A
3120(<<)S
(CLICK_SHIFT;)504 3246 A
1935 V
(18457)210 1122 A
1524(if)S
1650(\()S
(\(child_base)462 1734 A
2238(=)S
(alloc_mem\(prog_clicks\)\))966 2322 A
3330(==)S
(NO_MEM\))294 3456 A
(return\(ENOMEM\);)630 3792 A
2025 V
(18458)210 1122 A
2115 V
(18459)210 1122 A
1524(/*)S
(Create)252 1650 A
1944(a)S
(copy)168 2028 A
2238(of)S
(the)126 2364 A
(parent's)336 2532 A
(core)168 2910 A
(image)210 3120 A
(for)126 3372 A
(the)126 3540 A
(child.)252 3708 A
4002(*/)S
2205 V
(18460)210 1122 A
(child_abs)378 1524 A
1944(=)S
(\(phys_bytes\))504 2028 A
(child_base)420 2574 A
3036(<<)S
(CLICK_SHIFT;)504 3162 A
2295 V
(18461)210 1122 A
(parent_abs)420 1524 A
1986(=)S
(\(phys_bytes\))504 2070 A
(rmp->mp_seg[D].mem_phys)966 2616 A
3624(<<)S
(CLICK_SHIFT;)504 3750 A
2385 V
(18462)210 1122 A
1524(s)S
1608(=)S
(sys_abscopy\(parent_abs,)966 1692 A
(child_abs,)420 2700 A
(prog_bytes\);)504 3162 A
2475 V
(18463)210 1122 A
1524(if)S
1650(\(s)S
1776(<)S
1860(0\))S
(panic\(__FILE__,"do_fork)966 1986 A
(can't)210 2994 A
(copy",)252 3246 A
(s\);)126 3540 A
2565 V
(18464)210 1122 A
2655 V
(18465)210 1122 A
1524(/*)S
(Find)168 1650 A
1860(a)S
(slot)168 1944 A
2154(in)S
('mproc')294 2280 A
(for)126 2616 A
(the)126 2784 A
(child)210 2952 A
(process.)336 3204 A
3624(A)S
(slot)168 3708 A
(must)168 3918 A
(exist.)252 4128 A
4422(*/)S
2745 V
(18466)210 1122 A
(for)126 1524 A
(\(rmc)168 1692 A
1902(=)S
(&mproc[0];)420 1986 A
(rmc)126 2448 A
2616(<)S
(&mproc[NR_PROCS];)714 2700 A
(rmc++\))252 3456 A
2835 V
(18467)210 1122 A
1776(if)S
1902(\()S
(\(rmc->mp_flags)588 1986 A
2616(&)S
(IN_USE\))294 2700 A
3036(==)S
3162(0\))S
(break;)252 3288 A
2925 V
(18468)210 1122 A
3015 V
(18469)210 1122 A
1524(/*)S
(Set)126 1650 A
1818(up)S
(the)126 1944 A
(child)210 2112 A
(and)126 2364 A
(its)126 2532 A
(memory)252 2700 A
(map;)168 2994 A
(copy)168 3204 A
(its)126 3414 A
('mproc')294 3582 A
(slot)168 3918 A
(from)168 4128 A
(parent.)294 4338 A
4674(*/)S
3105 V
(18470)210 1122 A
(child_nr)336 1524 A
1902(=)S
(\(int\)\(rmc)378 1986 A
2406(-)S
(mproc\);)294 2490 A
3120(/*)S
(slot)168 3246 A
(number)252 3456 A
3750(of)S
(the)126 3876 A
(child)210 4044 A
4296(*/)S
3195 V
(18471)210 1122 A
(procs_in_use++;)630 1524 A
3285 V
(18472)210 1122 A
(*rmc)168 1524 A
1734(=)S
(*rmp;)210 1818 A
2784(/*)S
(copy)168 2910 A
(parent's)336 3120 A
(process)294 3498 A
(slot)168 3834 A
4044(to)S
(child's)294 4170 A
4506(*/)S
3375 V
(18473)210 1122 A
(rmc->mp_parent)588 1524 A
2154(=)S
(who;)168 2238 A
3120(/*)S
(record)252 3246 A
(child's)294 3540 A
(parent)252 3876 A
4170(*/)S
3465 V
(18474)210 1122 A
1524(/*)S
(inherit)294 1650 A
(only)168 1986 A
(these)210 2196 A
(flags)210 2448 A
2700(*/)S
3555 V
(18475)210 1122 A
(rmc->mp_flags)546 1524 A
2112(&=)S
(\(IN_USE|SEPARATE|PRIV_PROC|DONT_SWAP\);)1596 2238 A
3645 V
(18476)210 1122 A
(rmc->mp_child_utime)798 1524 A
2364(=)S
2448(0;)S
3120(/*)S
(reset)210 3246 A
(administration)588 3498 A
4128(*/)S
3735 V
(18477)210 1122 A
(rmc->mp_child_stime)798 1524 A
2364(=)S
2448(0;)S
3120(/*)S
(reset)210 3246 A
(administration)588 3498 A
4128(*/)S
3825 V
(18478)210 1122 A
3915 V
(18479)210 1122 A
1524(/*)S
1650(A)S
(separate)336 1734 A
(I&D)126 2112 A
(child)210 2280 A
(keeps)210 2532 A
(the)126 2784 A
(parents)294 2952 A
(text)168 3288 A
(segment.)336 3498 A
(The)126 3918 A
(data)168 4086 A
(and)126 4296 A
(stack)210 4464 A
4005 V
(18480)210 1122 A
1566(*)S
(segments)336 1650 A
(must)168 2028 A
(refer)210 2238 A
2490(to)S
(the)126 2616 A
(new)126 2784 A
(copy.)210 2952 A
4095 V
(18481)210 1122 A
1566(*/)S
4185 V
(18482)210 1122 A
1524(if)S
(\(!\(rmc->mp_flags)672 1650 A
2364(&)S
(SEPARATE\)\))420 2448 A
(rmc->mp_seg[T].mem_phys)966 2910 A
3918(=)S
(child_base;)462 4002 A
4275 V
(18483)210 1122 A
(rmc->mp_seg[D].mem_phys)966 1524 A
2532(=)S
(child_base;)462 2616 A
4365 V
(18484)210 1122 A
(rmc->mp_seg[S].mem_phys)966 1524 A
2532(=)S
(rmc->mp_seg[D].mem_phys)966 2616 A
3624(+)S
4455 V
(18485)210 1122 A
(\(rmp->mp_seg[S].mem_vir)966 2448 A
3456(-)S
(rmp->mp_seg[D].mem_vir\);)1008 3540 A
4545 V
(18486)210 1122 A
(rmc->mp_exitstatus)756 1524 A
2322(=)S
2406(0;)S
4635 V
(18487)210 1122 A
(rmc->mp_sigstatus)714 1524 A
2280(=)S
2364(0;)S
4725 V
(18488)210 1122 A
4815 V
(18489)210 1122 A
1524(/*)S
(Find)168 1650 A
1860(a)S
(free)168 1944 A
(pid)126 2154 A
(for)126 2322 A
(the)126 2490 A
(child)210 2658 A
(and)126 2910 A
(put)126 3078 A
3246(it)S
3372(in)S
(the)126 3498 A
(table.)252 3666 A
3960(*/)S
4905 V
(18490)210 1122 A
(new_pid)294 1524 A
1860(=)S
(get_free_pid\(\);)630 1944 A
4995 V
(18491)210 1122 A
(rmc->mp_pid)462 1524 A
2028(=)S
(new_pid;)336 2112 A
2784(/*)S
(assign)252 2910 A
(pid)126 3204 A
3372(to)S
(child)210 3498 A
3750(*/)S
5085 V
(18492)210 1122 A
5175 V
(18493)210 1122 A
1524(/*)S
(Tell)168 1650 A
(kernel)252 1860 A
(and)126 2154 A
(file)168 2322 A
(system)252 2532 A
(about)210 2826 A
(the)126 3078 A
(\(now)168 3246 A
(successful\))462 3456 A
(FORK.)210 3960 A
4212(*/)S
5265 V
(18494)210 1122 A
(sys_fork\(who,)546 1524 A
(child_nr\);)420 2112 A
5355 V
(18495)210 1122 A
(tell_fs\(FORK,)546 1524 A
(who,)168 2112 A
(child_nr,)378 2322 A
(rmc->mp_pid\);)546 2742 A
5445 V
(18496)210 1122 A
5535 V
(18497)210 1122 A
1524(/*)S
(Report)252 1650 A
(child's)294 1944 A
(memory)252 2280 A
(map)126 2574 A
2742(to)S
(kernel.)294 2868 A
3204(*/)S
5625 V
(18498)210 1122 A
(sys_newmap\(child_nr,)840 1524 A
(rmc->mp_seg\);)546 2406 A
5715 V
(18499)210 1122 A
5805 V
(18500)210 1122 A
1524(/*)S
(Reply)210 1650 A
1902(to)S
(child)210 2028 A
2280(to)S
(wake)168 2406 A
2616(it)S
(up.)126 2742 A
2910(*/)S
5895 V
(18501)210 1122 A
(setreply\(child_nr,)756 1524 A
(0\);)126 2322 A
3120(/*)S
(only)168 3246 A
(parent)252 3456 A
(gets)168 3750 A
(details)294 3960 A
4296(*/)S
5985 V
(18502)210 1122 A
(rmp->mp_reply.procnr)840 1524 A
2406(=)S
(child_nr;)378 2490 A
3120(/*)S
(child's)294 3246 A
(process)294 3582 A
(number)252 3918 A
4212(*/)S
6075 V
(18503)210 1122 A
(return\(new_pid\);)672 1524 A
3120(/*)S
(child's)294 3246 A
(pid)126 3582 A
3750(*/)S
6165 V
(18504)210 1122 A
1440(})S
6345 V
(18506)210 1122 A
(/*===========================================================================*)3276 1440 A
6435 V
(18507)210 1122 A
1482(*)S
(do_pm_exit)420 2784 A
4674(*)S
6525 V
(18508)210 1122 A
(*===========================================================================*/)3276 1482 A
6615 V
(18509)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_pm_exit\(\))504 1902 A
6705 V
(18510)210 1122 A
1440({)S
6795 V
(18511)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(exit\(status\))504 2070 A
(system)252 2616 A
(call.)210 2910 A
(The)126 3162 A
(real)168 3330 A
(work)168 3540 A
3750(is)S
(done)168 3876 A
4086(by)S
(pm_exit\(\),)420 4212 A
6885 V
(18512)210 1122 A
1482(*)S
(which)210 1566 A
1818(is)S
(also)168 1944 A
(called)252 2154 A
(when)168 2448 A
2658(a)S
(process)294 2742 A
3078(is)S
(killed)252 3204 A
3498(by)S
3624(a)S
(signal.)294 3708 A
6975 V
(18513)210 1122 A
1482(*/)S
7065 V
(18514)210 1122 A
(pm_exit\(mp,)462 1524 A
(m_in.status\);)546 2028 A
8418 V
EP
%%Page: 245 245
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2290(File:)S
2523(servers/pm/forkexit.c)S
12 B
(245)180 4500 A
1755 V
7 LST
(18515)210 1122 A
(return\(SUSPEND\);)672 1524 A
2784(/*)S
(can't)210 2910 A
(communicate)462 3162 A
(from)168 3666 A
(beyond)252 3876 A
(the)126 4170 A
(grave)210 4338 A
4590(*/)S
1845 V
(18516)210 1122 A
1440(})S
2025 V
(18518)210 1122 A
(/*===========================================================================*)3276 1440 A
2115 V
(18519)210 1122 A
1482(*)S
(pm_exit)294 2784 A
4674(*)S
2205 V
(18520)210 1122 A
(*===========================================================================*/)3276 1482 A
2295 V
(18521)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(pm_exit\(rmp,)504 1944 A
(exit_status\))504 2490 A
2385 V
(18522)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(mproc)210 2112 A
(*rmp;)210 2364 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(the)126 3372 A
(process)294 3540 A
3876(to)S
4002(be)S
(terminated)420 4128 A
4590(*/)S
2475 V
(18523)210 1122 A
(int)126 1440 A
(exit_status;)504 1608 A
2784(/*)S
(the)126 2910 A
(process')336 3078 A
(exit)168 3456 A
(status)252 3666 A
(\(for)168 3960 A
(parent\))294 4170 A
4506(*/)S
2565 V
(18524)210 1122 A
1440({)S
2655 V
(18525)210 1122 A
1440(/*)S
1566(A)S
(process)294 1650 A
1986(is)S
(done.)210 2112 A
(Release)294 2406 A
(most)168 2742 A
2952(of)S
(the)126 3078 A
(process')336 3246 A
(possessions.)504 3624 A
4212(If)S
(its)126 4338 A
2745 V
(18526)210 1122 A
1482(*)S
(parent)252 1566 A
1860(is)S
(waiting,)336 1986 A
(release)294 2364 A
(the)126 2700 A
(rest,)210 2868 A
(else)168 3120 A
(keep)168 3330 A
(the)126 3540 A
(process)294 3708 A
(slot)168 4044 A
(and)126 4254 A
2835 V
(18527)210 1122 A
1482(*)S
(become)252 1566 A
1860(a)S
(zombie.)294 1944 A
2925 V
(18528)210 1122 A
1482(*/)S
3015 V
(18529)210 1122 A
(register)336 1524 A
(int)126 1902 A
(proc_nr;)336 2070 A
3105 V
(18530)210 1122 A
(int)126 1524 A
(parent_waiting,)630 1692 A
(right_child;)504 2364 A
3195 V
(18531)210 1122 A
(pid_t)210 1524 A
(pidarg,)294 1776 A
(procgrp;)336 2112 A
3285 V
(18532)210 1122 A
(struct)252 1524 A
(mproc)210 1818 A
(*p_mp;)252 2070 A
3375 V
(18533)210 1122 A
(clock_t)294 1524 A
(t[5];)210 1860 A
3465 V
(18534)210 1122 A
3555 V
(18535)210 1122 A
(proc_nr)294 1524 A
1860(=)S
(\(int\))210 1944 A
(\(rmp)168 2196 A
2406(-)S
(mproc\);)294 2490 A
3120(/*)S
(get)126 3246 A
(process)294 3414 A
(slot)168 3750 A
(number)252 3960 A
4254(*/)S
3645 V
(18536)210 1122 A
3735 V
(18537)210 1122 A
1524(/*)S
(Remember)336 1650 A
2028(a)S
(session)294 2112 A
(leader's)336 2448 A
(process)294 2826 A
(group.)252 3162 A
3456(*/)S
3825 V
(18538)210 1122 A
(procgrp)294 1524 A
1860(=)S
(\(rmp->mp_pid)504 1944 A
2490(==)S
(mp->mp_procgrp\))630 2616 A
3288(?)S
(mp->mp_procgrp)588 3372 A
4002(:)S
4086(0;)S
3915 V
(18539)210 1122 A
4005 V
(18540)210 1122 A
1524(/*)S
1650(If)S
(the)126 1776 A
(exited)252 1944 A
(process)294 2238 A
(has)126 2574 A
2742(a)S
(timer)210 2826 A
(pending,)336 3078 A
(kill)168 3456 A
(it.)126 3666 A
3834(*/)S
4095 V
(18541)210 1122 A
1524(if)S
(\(rmp->mp_flags)588 1650 A
2280(&)S
(ALARM_ON\))378 2364 A
(set_alarm\(proc_nr,)756 2784 A
(\(unsigned\))420 3582 A
(0\);)126 4044 A
4185 V
(18542)210 1122 A
4275 V
(18543)210 1122 A
1524(/*)S
1650(Do)S
(accounting:)462 1776 A
(fetch)210 2280 A
(usage)210 2532 A
(times)210 2784 A
(and)126 3036 A
(accumulate)420 3204 A
3666(at)S
(parent.)294 3792 A
4128(*/)S
4365 V
(18544)210 1122 A
(sys_times\(proc_nr,)756 1524 A
(t\);)126 2322 A
4455 V
(18545)210 1122 A
(p_mp)168 1524 A
1734(=)S
(&mproc[rmp->mp_parent];)966 1818 A
3792(/*)S
(process')336 3918 A
(parent)252 4296 A
4590(*/)S
4545 V
(18546)210 1122 A
(p_mp->mp_child_utime)840 1524 A
2406(+=)S
(t[0])168 2532 A
2742(+)S
(rmp->mp_child_utime;)840 2826 A
3792(/*)S
(add)126 3918 A
(user)168 4086 A
(time)168 4296 A
4506(*/)S
4635 V
(18547)210 1122 A
(p_mp->mp_child_stime)840 1524 A
2406(+=)S
(t[1])168 2532 A
2742(+)S
(rmp->mp_child_stime;)840 2826 A
3792(/*)S
(add)126 3918 A
(system)252 4086 A
(time)168 4380 A
4590(*/)S
4725 V
(18548)210 1122 A
4815 V
(18549)210 1122 A
1524(/*)S
(Tell)168 1650 A
(the)126 1860 A
(kernel)252 2028 A
(and)126 2322 A
2490(FS)S
(that)168 2616 A
(the)126 2826 A
(process)294 2994 A
3330(is)S
3456(no)S
(longer)252 3582 A
(runnable.)378 3876 A
4296(*/)S
4905 V
(18550)210 1122 A
(tell_fs\(EXIT,)546 1524 A
(proc_nr,)336 2112 A
2490(0,)S
(0\);)126 2616 A
2826(/*)S
(file)168 2952 A
(system)252 3162 A
(can)126 3456 A
(free)168 3624 A
(the)126 3834 A
(proc)168 4002 A
(slot)168 4212 A
4422(*/)S
4995 V
(18551)210 1122 A
(sys_exit\(proc_nr\);)756 1524 A
5085 V
(18552)210 1122 A
5175 V
(18553)210 1122 A
1524(/*)S
(Pending)294 1650 A
(reply)210 1986 A
(messages)336 2238 A
(for)126 2616 A
(the)126 2784 A
(dead)168 2952 A
(process)294 3162 A
(cannot)252 3498 A
3792(be)S
(delivered.)420 3918 A
4380(*/)S
5265 V
(18554)210 1122 A
(rmp->mp_flags)546 1524 A
2112(&=)S
(\304REPLY;)294 2238 A
5355 V
(18555)210 1122 A
5445 V
(18556)210 1122 A
1524(/*)S
(Release)294 1650 A
(the)126 1986 A
(memory)252 2154 A
(occupied)336 2448 A
2826(by)S
(the)126 2952 A
(child.)252 3120 A
3414(*/)S
5535 V
(18557)210 1122 A
1524(if)S
(\(find_share\(rmp,)672 1650 A
(rmp->mp_ino,)504 2364 A
(rmp->mp_dev,)504 2910 A
(rmp->mp_ctime\))588 3456 A
4086(==)S
(NULL\))210 4212 A
4464({)S
5625 V
(18558)210 1122 A
1776(/*)S
1902(No)S
(other)210 2028 A
(process)294 2280 A
(shares)252 2616 A
(the)126 2910 A
(text)168 3078 A
(segment,)336 3288 A
3666(so)S
(free)168 3792 A
(it.)126 4002 A
4170(*/)S
5715 V
(18559)210 1122 A
(free_mem\(rmp->mp_seg[T].mem_phys,)1386 1776 A
(rmp->mp_seg[T].mem_len\);)1008 3204 A
5805 V
(18560)210 1122 A
1524(})S
5895 V
(18561)210 1122 A
1524(/*)S
(Free)168 1650 A
(the)126 1860 A
(data)168 2028 A
(and)126 2238 A
(stack)210 2406 A
(segments.)378 2658 A
3078(*/)S
5985 V
(18562)210 1122 A
(free_mem\(rmp->mp_seg[D].mem_phys,)1386 1524 A
6075 V
(18563)210 1122 A
(rmp->mp_seg[S].mem_vir)924 1692 A
6165 V
(18564)210 1122 A
1776(+)S
(rmp->mp_seg[S].mem_len)924 1860 A
2826(-)S
(rmp->mp_seg[D].mem_vir\);)1008 2910 A
6255 V
(18565)210 1122 A
6345 V
(18566)210 1122 A
1524(/*)S
(The)126 1650 A
(process)294 1818 A
(slot)168 2154 A
(can)126 2364 A
(only)168 2532 A
2742(be)S
(freed)210 2868 A
3120(if)S
(the)126 3246 A
(parent)252 3414 A
(has)126 3708 A
(done)168 3876 A
4086(a)S
(WAIT.)210 4170 A
4422(*/)S
6435 V
(18567)210 1122 A
(rmp->mp_exitstatus)756 1524 A
2322(=)S
(\(char\))252 2406 A
(exit_status;)504 2700 A
6525 V
(18568)210 1122 A
6615 V
(18569)210 1122 A
(pidarg)252 1524 A
1818(=)S
(p_mp->mp_wpid;)588 1902 A
3120(/*)S
(who's)210 3246 A
(being)210 3498 A
(waited)252 3750 A
(for?)168 4044 A
4254(*/)S
6705 V
(18570)210 1122 A
(parent_waiting)588 1524 A
2154(=)S
(p_mp->mp_flags)588 2238 A
2868(&)S
(WAITING;)336 2952 A
6795 V
(18571)210 1122 A
(right_child)462 1524 A
2028(=)S
3120(/*)S
(child)210 3246 A
(meets)210 3498 A
(one)126 3750 A
3918(of)S
(the)126 4044 A
4212(3)S
(tests?)252 4296 A
4590(*/)S
6885 V
(18572)210 1122 A
(\(pidarg)294 1776 A
2112(==)S
2238(-1)S
2364(||)S
(pidarg)252 2490 A
2784(==)S
(rmp->mp_pid)462 2910 A
3414(||)S
(-pidarg)294 3540 A
3876(==)S
(rmp->mp_procgrp\);)714 4002 A
6975 V
(18573)210 1122 A
7065 V
(18574)210 1122 A
1524(if)S
(\(parent_waiting)630 1650 A
2322(&&)S
(right_child\))504 2448 A
2994({)S
8418 V
EP
%%Page: 246 246
BP
/slant 0 def
/height 0 def
1485 V
12 B
(246)180 1080 A
11 R
2290(File:)S
2523(servers/pm/forkexit.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(18575)210 1122 A
(cleanup\(rmp\);)546 1776 A
3120(/*)S
(tell)168 3246 A
(parent)252 3456 A
(and)126 3750 A
(release)294 3918 A
(child)210 4254 A
(slot)168 4506 A
4716(*/)S
1845 V
(18576)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
1935 V
(18577)210 1122 A
(rmp->mp_flags)546 1776 A
2364(=)S
(IN_USE|ZOMBIE;)588 2448 A
3120(/*)S
(parent)252 3246 A
(not)126 3540 A
(waiting,)336 3708 A
(zombify)294 4086 A
(child)210 4422 A
4674(*/)S
2025 V
(18578)210 1122 A
(sig_proc\(p_mp,)588 1776 A
(SIGCHLD\);)378 2406 A
3120(/*)S
(send)168 3246 A
(parent)252 3456 A
3750(a)S
("child)252 3834 A
(died")210 4128 A
(signal)252 4380 A
4674(*/)S
2115 V
(18579)210 1122 A
1524(})S
2205 V
(18580)210 1122 A
2295 V
(18581)210 1122 A
1524(/*)S
1650(If)S
(the)126 1776 A
(process)294 1944 A
(has)126 2280 A
(children,)378 2448 A
(disinherit)420 2868 A
(them.)210 3330 A
(INIT)168 3624 A
3834(is)S
(the)126 3960 A
(new)126 4128 A
(parent.)294 4296 A
4632(*/)S
2385 V
(18582)210 1122 A
(for)126 1524 A
(\(rmp)168 1692 A
1902(=)S
(&mproc[0];)420 1986 A
(rmp)126 2448 A
2616(<)S
(&mproc[NR_PROCS];)714 2700 A
(rmp++\))252 3456 A
3750({)S
2475 V
(18583)210 1122 A
1776(if)S
(\(rmp->mp_flags)588 1902 A
2532(&)S
(IN_USE)252 2616 A
2910(&&)S
(rmp->mp_parent)588 3036 A
3666(==)S
(proc_nr\))336 3792 A
4170({)S
2565 V
(18584)210 1122 A
2112(/*)S
('rmp')210 2238 A
(now)126 2490 A
(points)252 2658 A
2952(to)S
3078(a)S
(child)210 3162 A
3414(to)S
3540(be)S
(disinherited.)546 3666 A
4254(*/)S
2655 V
(18585)210 1122 A
(rmp->mp_parent)588 2112 A
2742(=)S
(INIT_PROC_NR;)546 2826 A
2745 V
(18586)210 1122 A
(parent_waiting)588 2112 A
2742(=)S
(mproc[INIT_PROC_NR].mp_flags)1176 2826 A
4044(&)S
(WAITING;)336 4128 A
2835 V
(18587)210 1122 A
2112(if)S
(\(parent_waiting)630 2238 A
2910(&&)S
(\(rmp->mp_flags)588 3036 A
3666(&)S
(ZOMBIE\)\))336 3750 A
(cleanup\(rmp\);)546 4128 A
2925 V
(18588)210 1122 A
1776(})S
3015 V
(18589)210 1122 A
1524(})S
3105 V
(18590)210 1122 A
3195 V
(18591)210 1122 A
1524(/*)S
(Send)168 1650 A
1860(a)S
(hangup)252 1944 A
2238(to)S
(the)126 2364 A
(process')336 2532 A
(process)294 2910 A
(group)210 3246 A
3498(if)S
3624(it)S
(was)126 3750 A
3918(a)S
(session)294 4002 A
(leader.)294 4338 A
4674(*/)S
3285 V
(18592)210 1122 A
1524(if)S
(\(procgrp)336 1650 A
2028(!=)S
2154(0\))S
(check_sig\(-procgrp,)798 2280 A
(SIGHUP\);)336 3120 A
3375 V
(18593)210 1122 A
1440(})S
3555 V
(18595)210 1122 A
(/*===========================================================================*)3276 1440 A
3645 V
(18596)210 1122 A
1482(*)S
(do_waitpid)420 2784 A
4674(*)S
3735 V
(18597)210 1122 A
(*===========================================================================*/)3276 1482 A
3825 V
(18598)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_waitpid\(\))504 1902 A
3915 V
(18599)210 1122 A
1440({)S
4005 V
(18600)210 1122 A
1440(/*)S
1566(A)S
(process)294 1650 A
(wants)210 1986 A
2238(to)S
(wait)168 2364 A
(for)126 2574 A
2742(a)S
(child)210 2826 A
3078(to)S
(terminate.)420 3204 A
3666(If)S
3792(a)S
(child)210 3876 A
4128(is)S
(already)294 4254 A
4095 V
(18601)210 1122 A
1482(*)S
(waiting,)336 1566 A
1944(go)S
(clean)210 2070 A
2322(it)S
2448(up)S
(and)126 2574 A
(let)126 2742 A
(this)168 2910 A
(WAIT)168 3120 A
(call)168 3330 A
(terminate.)420 3540 A
(Otherwise,)420 4044 A
4185 V
(18602)210 1122 A
1482(*)S
(really)252 1566 A
(wait.)210 1860 A
4275 V
(18603)210 1122 A
1482(*)S
1566(A)S
(process)294 1650 A
(calling)294 1986 A
(WAIT)168 2322 A
(never)210 2532 A
(gets)168 2784 A
2994(a)S
(reply)210 3078 A
3330(in)S
(the)126 3456 A
(usual)210 3624 A
(way)126 3876 A
4044(at)S
(the)126 4170 A
(end)126 4338 A
4365 V
(18604)210 1122 A
1482(*)S
1566(of)S
(the)126 1692 A
(main)168 1860 A
(loop)168 2070 A
(\(unless)294 2280 A
(WNOHANG)294 2616 A
2952(is)S
(set)126 3078 A
3246(or)S
3372(no)S
(qualifying)420 3498 A
(child)210 3960 A
(exists\).)336 4212 A
4455 V
(18605)210 1122 A
1482(*)S
1566(If)S
1692(a)S
(child)210 1776 A
(has)126 2028 A
(already)294 2196 A
(exited,)294 2532 A
(the)126 2868 A
(routine)294 3036 A
(cleanup\(\))378 3372 A
(sends)210 3792 A
(the)126 4044 A
(reply)210 4212 A
4545 V
(18606)210 1122 A
1482(*)S
1566(to)S
(awaken)252 1692 A
(the)126 1986 A
(caller.)294 2154 A
4635 V
(18607)210 1122 A
1482(*)S
(Both)168 1566 A
(WAIT)168 1776 A
(and)126 1986 A
(WAITPID)294 2154 A
(are)126 2490 A
(handled)294 2658 A
2994(by)S
(this)168 3120 A
(code.)210 3330 A
4725 V
(18608)210 1122 A
1482(*/)S
4815 V
(18609)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rp;)168 2448 A
4905 V
(18610)210 1122 A
(int)126 1524 A
(pidarg,)294 1692 A
(options,)336 2028 A
(children;)378 2406 A
4995 V
(18611)210 1122 A
5085 V
(18612)210 1122 A
1524(/*)S
(Set)126 1650 A
(internal)336 1818 A
(variables,)420 2196 A
(depending)378 2658 A
3078(on)S
(whether)294 3204 A
(this)168 3540 A
3750(is)S
(WAIT)168 3876 A
4086(or)S
(WAITPID.)336 4212 A
4590(*/)S
5175 V
(18613)210 1122 A
(pidarg)252 1524 A
1860(=)S
(\(call_nr)336 1944 A
2322(==)S
(WAIT)168 2448 A
2658(?)S
2742(-1)S
2868(:)S
(m_in.pid\);)420 2952 A
3582(/*)S
(1st)126 3708 A
(param)210 3876 A
4128(of)S
(waitpid)294 4254 A
4590(*/)S
5265 V
(18614)210 1122 A
(options)294 1524 A
1860(=)S
(\(call_nr)336 1944 A
2322(==)S
(WAIT)168 2448 A
2658(?)S
2784(0)S
2868(:)S
(m_in.sig_nr\);)546 2952 A
3582(/*)S
(3rd)126 3708 A
(param)210 3876 A
4128(of)S
(waitpid)294 4254 A
4590(*/)S
5355 V
(18615)210 1122 A
1524(if)S
(\(pidarg)294 1650 A
1986(==)S
2112(0\))S
(pidarg)252 2238 A
2532(=)S
(-mp->mp_procgrp;)672 2616 A
3456(/*)S
(pidarg)252 3582 A
3876(<)S
3960(0)S
(==>)126 4044 A
(proc)168 4212 A
(grp)126 4422 A
4590(*/)S
5445 V
(18616)210 1122 A
5535 V
(18617)210 1122 A
1524(/*)S
1650(Is)S
(there)210 1776 A
2028(a)S
(child)210 2112 A
(waiting)294 2364 A
2700(to)S
2826(be)S
(collected?)420 2952 A
3414(At)S
(this)168 3540 A
(point,)252 3750 A
(pidarg)252 4044 A
4338(!=)S
4464(0:)S
5625 V
(18618)210 1122 A
1566(*)S
(pidarg)252 1776 A
2112(>)S
2238(0)S
(means)210 2322 A
(pidarg)252 2574 A
2868(is)S
(pid)126 2994 A
3162(of)S
3288(a)S
(specific)336 3372 A
(process)294 3750 A
4086(to)S
(wait)168 4212 A
(for)126 4422 A
5715 V
(18619)210 1122 A
1566(*)S
(pidarg)252 1776 A
2070(==)S
2196(-1)S
(means)210 2322 A
(wait)168 2574 A
(for)126 2784 A
(any)126 2952 A
(child)210 3120 A
5805 V
(18620)210 1122 A
1566(*)S
(pidarg)252 1776 A
2112(<)S
2196(-1)S
(means)210 2322 A
(wait)168 2574 A
(for)126 2784 A
(any)126 2952 A
(child)210 3120 A
(whose)210 3372 A
(process)294 3624 A
(group)210 3960 A
4212(=)S
(-pidarg)294 4296 A
5895 V
(18621)210 1122 A
1566(*/)S
5985 V
(18622)210 1122 A
(children)336 1524 A
1902(=)S
1986(0;)S
6075 V
(18623)210 1122 A
(for)126 1524 A
(\(rp)126 1692 A
1860(=)S
(&mproc[0];)420 1944 A
2406(rp)S
2532(<)S
(&mproc[NR_PROCS];)714 2616 A
(rp++\))210 3372 A
3624({)S
6165 V
(18624)210 1122 A
1776(if)S
1902(\()S
(\(rp->mp_flags)546 1986 A
2574(&)S
(IN_USE\))294 2658 A
2994(&&)S
(rp->mp_parent)546 3120 A
3708(==)S
(who\))168 3834 A
4044({)S
6255 V
(18625)210 1122 A
2112(/*)S
(The)126 2238 A
(value)210 2406 A
2658(of)S
(pidarg)252 2784 A
(determines)420 3078 A
(which)210 3540 A
(children)336 3792 A
(qualify.)336 4170 A
4548(*/)S
6345 V
(18626)210 1122 A
2112(if)S
(\(pidarg)294 2238 A
2616(>)S
2700(0)S
2784(&&)S
(pidarg)252 2910 A
3204(!=)S
(rp->mp_pid\))462 3330 A
(continue;)378 3834 A
6435 V
(18627)210 1122 A
2112(if)S
(\(pidarg)294 2238 A
2574(<)S
2658(-1)S
2784(&&)S
(-pidarg)294 2910 A
3246(!=)S
(rp->mp_procgrp\))630 3372 A
(continue;)378 4044 A
6525 V
(18628)210 1122 A
6615 V
(18629)210 1122 A
(children++;)462 2112 A
3120(/*)S
(this)168 3246 A
(child)210 3456 A
3708(is)S
(acceptable)420 3834 A
4296(*/)S
6705 V
(18630)210 1122 A
2112(if)S
(\(rp->mp_flags)546 2238 A
2826(&)S
(ZOMBIE\))294 2910 A
3246({)S
6795 V
(18631)210 1122 A
2448(/*)S
(This)168 2574 A
(child)210 2784 A
(meets)210 3036 A
(the)126 3288 A
(pid)126 3456 A
(test)168 3624 A
(and)126 3834 A
(has)126 4002 A
(exited.)294 4170 A
4506(*/)S
6885 V
(18632)210 1122 A
(cleanup\(rp\);)504 2448 A
3120(/*)S
(this)168 3246 A
(child)210 3456 A
(has)126 3708 A
(already)294 3876 A
(exited)252 4212 A
4506(*/)S
6975 V
(18633)210 1122 A
(return\(SUSPEND\);)672 2448 A
7065 V
(18634)210 1122 A
2112(})S
8418 V
EP
%%Page: 247 247
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2290(File:)S
2523(servers/pm/forkexit.c)S
12 B
(247)180 4500 A
1755 V
7 LST
(18635)210 1122 A
2112(if)S
(\(\(rp->mp_flags)588 2238 A
2868(&)S
(STOPPED\))336 2952 A
3330(&&)S
(rp->mp_sigstatus\))714 3456 A
4212({)S
1845 V
(18636)210 1122 A
2448(/*)S
(This)168 2574 A
(child)210 2784 A
(meets)210 3036 A
(the)126 3288 A
(pid)126 3456 A
(test)168 3624 A
(and)126 3834 A
4002(is)S
(being)210 4128 A
(traced.*/)378 4380 A
1935 V
(18637)210 1122 A
(mp->mp_reply.reply_res2)966 2448 A
3456(=)S
(0177|\(rp->mp_sigstatus)924 3540 A
4506(<<)S
(8\);)126 4632 A
2025 V
(18638)210 1122 A
(rp->mp_sigstatus)672 2448 A
3162(=)S
3246(0;)S
2115 V
(18639)210 1122 A
(return\(rp->mp_pid\);)798 2448 A
2205 V
(18640)210 1122 A
2112(})S
2295 V
(18641)210 1122 A
1776(})S
2385 V
(18642)210 1122 A
1524(})S
2475 V
(18643)210 1122 A
2565 V
(18644)210 1122 A
1524(/*)S
1650(No)S
(qualifying)420 1776 A
(child)210 2238 A
(has)126 2490 A
(exited.)294 2658 A
(Wait)168 3036 A
(for)126 3246 A
(one,)168 3414 A
(unless)252 3624 A
(none)168 3918 A
(exists.)294 4128 A
4464(*/)S
2655 V
(18645)210 1122 A
1524(if)S
(\(children)378 1650 A
2070(>)S
2154(0\))S
2280({)S
2745 V
(18646)210 1122 A
1776(/*)S
1902(At)S
(least)210 2028 A
2280(1)S
(child)210 2364 A
(meets)210 2616 A
(the)126 2868 A
(pid)126 3036 A
(test)168 3204 A
(exists,)294 3414 A
(but)126 3750 A
(has)126 3918 A
(not)126 4086 A
(exited.)294 4254 A
4590(*/)S
2835 V
(18647)210 1122 A
1776(if)S
(\(options)336 1902 A
2280(&)S
(WNOHANG\))336 2364 A
(return\(0\);)420 2742 A
3330(/*)S
(parent)252 3456 A
(does)168 3750 A
(not)126 3960 A
(want)168 4128 A
4338(to)S
(wait)168 4464 A
4674(*/)S
2925 V
(18648)210 1122 A
(mp->mp_flags)504 1776 A
2322(|=)S
(WAITING;)336 2448 A
3330(/*)S
(parent)252 3456 A
(wants)210 3750 A
4002(to)S
(wait)168 4128 A
4338(*/)S
3015 V
(18649)210 1122 A
(mp->mp_wpid)462 1776 A
2280(=)S
(\(pid_t\))294 2364 A
(pidarg;)294 2700 A
3330(/*)S
(save)168 3456 A
(pid)126 3666 A
(for)126 3834 A
(later)210 4002 A
4254(*/)S
3105 V
(18650)210 1122 A
(return\(SUSPEND\);)672 1776 A
3330(/*)S
3456(do)S
(not)126 3582 A
(reply,)252 3750 A
(let)126 4044 A
4212(it)S
(wait)168 4338 A
4548(*/)S
3195 V
(18651)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3285 V
(18652)210 1122 A
1776(/*)S
1902(No)S
(child)210 2028 A
(even)168 2280 A
(meets)210 2490 A
(the)126 2742 A
(pid)126 2910 A
(test.)210 3078 A
(Return)252 3372 A
(error)210 3666 A
(immediately.)504 3918 A
4464(*/)S
3375 V
(18653)210 1122 A
(return\(ECHILD\);)630 1776 A
3330(/*)S
3456(no)S
3582(-)S
(parent)252 3666 A
(has)126 3960 A
4128(no)S
(children)336 4254 A
4632(*/)S
3465 V
(18654)210 1122 A
1524(})S
3555 V
(18655)210 1122 A
1440(})S
3735 V
(18657)210 1122 A
(/*===========================================================================*)3276 1440 A
3825 V
(18658)210 1122 A
1482(*)S
(cleanup)294 2784 A
4674(*)S
3915 V
(18659)210 1122 A
(*===========================================================================*/)3276 1482 A
4005 V
(18660)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(cleanup\(child\))588 1986 A
4095 V
(18661)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(mproc)210 2112 A
(*child;)294 2364 A
2784(/*)S
(tells)210 2910 A
(which)210 3162 A
(process)294 3414 A
3750(is)S
(exiting)294 3876 A
4212(*/)S
4185 V
(18662)210 1122 A
1440({)S
4275 V
(18663)210 1122 A
1440(/*)S
(Finish)252 1566 A
(off)126 1860 A
(the)126 2028 A
(exit)168 2196 A
2406(of)S
2532(a)S
(process.)336 2616 A
(The)126 3036 A
(process)294 3204 A
(has)126 3540 A
(exited)252 3708 A
4002(or)S
(been)168 4128 A
(killed)252 4338 A
4365 V
(18664)210 1122 A
1482(*)S
1566(by)S
1692(a)S
(signal,)294 1776 A
(and)126 2112 A
(its)126 2280 A
(parent)252 2448 A
2742(is)S
(waiting.)336 2868 A
4455 V
(18665)210 1122 A
1482(*/)S
4545 V
(18666)210 1122 A
(struct)252 1524 A
(mproc)210 1818 A
(*parent)294 2070 A
2406(=)S
(&mproc[child->mp_parent];)1050 2490 A
4635 V
(18667)210 1122 A
(int)126 1524 A
(exitstatus;)462 1692 A
4725 V
(18668)210 1122 A
4815 V
(18669)210 1122 A
1524(/*)S
(Wake)168 1650 A
1860(up)S
(the)126 1986 A
(parent)252 2154 A
2448(by)S
(sending)294 2574 A
(the)126 2910 A
(reply)210 3078 A
(message.)336 3330 A
3708(*/)S
4905 V
(18670)210 1122 A
(exitstatus)420 1524 A
1986(=)S
(\(child->mp_exitstatus)882 2070 A
2994(<<)S
3120(8\))S
3246(|)S
(\(child->mp_sigstatus)840 3330 A
4212(&)S
(0377\);)252 4296 A
4995 V
(18671)210 1122 A
(parent->mp_reply.reply_res2)1134 1524 A
2700(=)S
(exitstatus;)462 2784 A
5085 V
(18672)210 1122 A
(setreply\(child->mp_parent,)1092 1524 A
(child->mp_pid\);)630 2658 A
5175 V
(18673)210 1122 A
(parent->mp_flags)672 1524 A
2238(&=)S
(\304WAITING;)378 2364 A
3120(/*)S
(parent)252 3246 A
3540(no)S
(longer)252 3666 A
(waiting)294 3960 A
4296(*/)S
5265 V
(18674)210 1122 A
5355 V
(18675)210 1122 A
1524(/*)S
(Release)294 1650 A
(the)126 1986 A
(process)294 2154 A
(table)210 2490 A
(entry)210 2742 A
(and)126 2994 A
(reinitialize)504 3162 A
(some)168 3708 A
(field.)252 3918 A
4212(*/)S
5445 V
(18676)210 1122 A
(child->mp_pid)546 1524 A
2112(=)S
2196(0;)S
5535 V
(18677)210 1122 A
(child->mp_flags)630 1524 A
2196(=)S
2280(0;)S
5625 V
(18678)210 1122 A
(child->mp_child_utime)882 1524 A
2448(=)S
2532(0;)S
5715 V
(18679)210 1122 A
(child->mp_child_stime)882 1524 A
2448(=)S
2532(0;)S
5805 V
(18680)210 1122 A
(procs_in_use--;)630 1524 A
5895 V
(18681)210 1122 A
1440(})S
6345 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6435 V
(servers/pm/exec.c)714 2676 A
6525 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6705 V
(18700)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(handles)294 1986 A
(the)126 2322 A
(EXEC)168 2490 A
(system)252 2700 A
(call.)210 2994 A
3288(It)S
(performs)336 3414 A
(the)126 3792 A
(work)168 3960 A
4170(as)S
(follows:)336 4296 A
6795 V
(18701)210 1122 A
1482(*)S
1692(-)S
(see)126 1776 A
1944(if)S
(the)126 2070 A
(permissions)462 2238 A
(allow)210 2742 A
(the)126 2994 A
(file)168 3162 A
3372(to)S
3498(be)S
(executed)336 3624 A
6885 V
(18702)210 1122 A
1482(*)S
1692(-)S
(read)168 1776 A
(the)126 1986 A
(header)252 2154 A
(and)126 2448 A
(extract)294 2616 A
(the)126 2952 A
(sizes)210 3120 A
6975 V
(18703)210 1122 A
1482(*)S
1692(-)S
(fetch)210 1776 A
(the)126 2028 A
(initial)294 2196 A
(args)168 2532 A
(and)126 2742 A
(environment)462 2910 A
(from)168 3414 A
(the)126 3624 A
(user)168 3792 A
(space)210 4002 A
7065 V
(18704)210 1122 A
1482(*)S
1692(-)S
(allocate)336 1776 A
(the)126 2154 A
(memory)252 2322 A
(for)126 2616 A
(the)126 2784 A
(new)126 2952 A
(process)294 3120 A
8418 V
EP
%%Page: 248 248
BP
/slant 0 def
/height 0 def
1485 V
12 B
(248)180 1080 A
11 R
2363(File:)S
2596(servers/pm/exec.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(18705)210 1122 A
1482(*)S
1692(-)S
(copy)168 1776 A
(the)126 1986 A
(initial)294 2154 A
(stack)210 2490 A
(from)168 2742 A
2952(PM)S
3078(to)S
(the)126 3204 A
(process)294 3372 A
1845 V
(18706)210 1122 A
1482(*)S
1692(-)S
(read)168 1776 A
1986(in)S
(the)126 2112 A
(text)168 2280 A
(and)126 2490 A
(data)168 2658 A
(segments)336 2868 A
(and)126 3246 A
(copy)168 3414 A
3624(to)S
(the)126 3750 A
(process)294 3918 A
1935 V
(18707)210 1122 A
1482(*)S
1692(-)S
(take)168 1776 A
(care)168 1986 A
2196(of)S
(setuid)252 2322 A
(and)126 2616 A
(setgid)252 2784 A
(bits)168 3078 A
2025 V
(18708)210 1122 A
1482(*)S
1692(-)S
(fix)126 1776 A
1944(up)S
('mproc')294 2070 A
(table)210 2406 A
2115 V
(18709)210 1122 A
1482(*)S
1692(-)S
(tell)168 1776 A
(kernel)252 1986 A
(about)210 2280 A
(EXEC)168 2532 A
2205 V
(18710)210 1122 A
1482(*)S
1692(-)S
(save)168 1776 A
(offset)252 1986 A
2280(to)S
(initial)294 2406 A
(argc)168 2742 A
(\(for)168 2952 A
(ps\))126 3162 A
2295 V
(18711)210 1122 A
1482(*)S
2385 V
(18712)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are:)168 2910 A
2475 V
(18713)210 1122 A
1482(*)S
(do_exec:)336 1650 A
(perform)294 2154 A
(the)126 2490 A
(EXEC)168 2658 A
(system)252 2868 A
(call)168 3162 A
2565 V
(18714)210 1122 A
1482(*)S
(rw_seg:)294 1650 A
(read)168 2154 A
2364(or)S
(write)210 2490 A
2742(a)S
(segment)294 2826 A
(from)168 3162 A
3372(or)S
3498(to)S
3624(a)S
(file)168 3708 A
2655 V
(18715)210 1122 A
1482(*)S
(find_share:)462 1650 A
(find)168 2154 A
2364(a)S
(process)294 2448 A
(whose)210 2784 A
(text)168 3036 A
(segment)294 3246 A
(can)126 3582 A
3750(be)S
(shared)252 3876 A
2745 V
(18716)210 1122 A
1482(*/)S
2835 V
(18717)210 1122 A
2925 V
(18718)210 1122 A
(#include)336 1440 A
("pm.h")252 1818 A
3015 V
(18719)210 1122 A
(#include)336 1440 A
(<sys/stat.h>)504 1818 A
3105 V
(18720)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
3195 V
(18721)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
3285 V
(18722)210 1122 A
(#include)336 1440 A
(<a.out.h>)378 1818 A
3375 V
(18723)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
3465 V
(18724)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
3555 V
(18725)210 1122 A
(#include)336 1440 A
("mproc.h")378 1818 A
3645 V
(18726)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
3735 V
(18727)210 1122 A
3825 V
(18728)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(new_mem,)336 2448 A
(\(struct)294 2826 A
(mproc)210 3162 A
(*sh_mp,)294 3414 A
(vir_bytes)378 3750 A
(text_bytes,)462 4170 A
3915 V
(18729)210 1122 A
(vir_bytes)378 2112 A
(data_bytes,)462 2532 A
(vir_bytes)378 3036 A
(bss_bytes,)420 3456 A
4005 V
(18730)210 1122 A
(vir_bytes)378 2112 A
(stk_bytes,)420 2532 A
(phys_bytes)420 2994 A
(tot_bytes\))420 3456 A
4464(\);)S
4095 V
(18731)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(patch_ptr,)420 2490 A
(\(char)210 2952 A
(stack[ARG_MAX],)630 3204 A
(vir_bytes)378 3876 A
(base\))210 4296 A
4548(\);)S
4185 V
(18732)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(insert_arg,)462 2448 A
(\(char)210 2952 A
(stack[ARG_MAX],)630 3204 A
4275 V
(18733)210 1122 A
(vir_bytes)378 2112 A
(*stk_bytes,)462 2532 A
(char)168 3036 A
(*arg,)210 3246 A
(int)126 3498 A
(replace\))336 3666 A
4464(\);)S
4365 V
(18734)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(char)168 2280 A
(*patch_stack,)546 2490 A
(\(int)168 3078 A
(fd,)126 3288 A
(char)168 3456 A
(stack[ARG_MAX],)630 3666 A
4455 V
(18735)210 1122 A
(vir_bytes)378 2112 A
(*stk_bytes,)462 2532 A
(char)168 3036 A
(*script\))336 3246 A
4464(\);)S
4545 V
(18736)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(read_header,)504 2448 A
(\(int)168 2994 A
(fd,)126 3204 A
(int)126 3372 A
(*ft,)168 3540 A
(vir_bytes)378 3750 A
(*text_bytes,)504 4170 A
4635 V
(18737)210 1122 A
(vir_bytes)378 2112 A
(*data_bytes,)504 2532 A
(vir_bytes)378 3078 A
(*bss_bytes,)462 3498 A
4725 V
(18738)210 1122 A
(phys_bytes)420 2112 A
(*tot_bytes,)462 2574 A
(long)168 3078 A
(*sym_bytes,)462 3288 A
(vir_clicks)420 3792 A
(sc,)126 4254 A
4815 V
(18739)210 1122 A
(vir_bytes)378 2112 A
(*pc\))168 2532 A
4464(\);)S
4905 V
(18740)210 1122 A
4995 V
(18741)210 1122 A
(#define)294 1440 A
(ESCRIPT)294 1776 A
(\(-2000\))294 2112 A
2448(/*)S
(Returned)336 2574 A
2952(by)S
(read_header)462 3078 A
(for)126 3582 A
3750(a)S
3834(#!)S
(script.)294 3960 A
4296(*/)S
5085 V
(18742)210 1122 A
(#define)294 1440 A
(PTRSIZE)294 1776 A
(sizeof\(char)462 2112 A
2616(*\))S
2742(/*)S
(Size)168 2868 A
3078(of)S
(pointers)336 3204 A
3582(in)S
(argv[])252 3708 A
(and)126 4002 A
(envp[].)294 4170 A
4506(*/)S
5175 V
(18743)210 1122 A
5265 V
(18744)210 1122 A
(/*===========================================================================*)3276 1440 A
5355 V
(18745)210 1122 A
1482(*)S
(do_exec)294 2784 A
4674(*)S
5445 V
(18746)210 1122 A
(*===========================================================================*/)3276 1482 A
5535 V
(18747)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_exec\(\))378 1902 A
5625 V
(18748)210 1122 A
1440({)S
5715 V
(18749)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(execve\(name,)504 2070 A
(argv,)210 2616 A
(envp\))210 2868 A
(call.)210 3120 A
(The)126 3414 A
(user)168 3582 A
(library)294 3792 A
(builds)252 4128 A
4422(a)S
5805 V
(18750)210 1122 A
1482(*)S
(complete)336 1566 A
(stack)210 1944 A
(image,)252 2196 A
(including)378 2490 A
(pointers,)378 2910 A
(args,)210 3330 A
(environ,)336 3582 A
(etc.)168 3960 A
(The)126 4212 A
(stack)210 4380 A
5895 V
(18751)210 1122 A
1482(*)S
1566(is)S
(copied)252 1692 A
1986(to)S
2112(a)S
(buffer)252 2196 A
(inside)252 2490 A
(PM,)126 2784 A
(and)126 2952 A
(then)168 3120 A
3330(to)S
(the)126 3456 A
(new)126 3624 A
(core)168 3792 A
(image.)252 4002 A
5985 V
(18752)210 1122 A
1482(*/)S
6075 V
(18753)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rmp;)210 2448 A
6165 V
(18754)210 1122 A
(struct)252 1524 A
(mproc)210 1818 A
(*sh_mp;)294 2070 A
6255 V
(18755)210 1122 A
(int)126 1524 A
1692(m,)S
1818(r,)S
(fd,)126 1944 A
(ft,)126 2112 A
(sn;)126 2280 A
6345 V
(18756)210 1122 A
(static)252 1524 A
(char)168 1818 A
(mbuf[ARG_MAX];)588 2028 A
2784(/*)S
(buffer)252 2910 A
(for)126 3204 A
(stack)210 3372 A
(and)126 3624 A
(zeroes)252 3792 A
4086(*/)S
6435 V
(18757)210 1122 A
(static)252 1524 A
(char)168 1818 A
(name_buf[PATH_MAX];)798 2028 A
2868(/*)S
(the)126 2994 A
(name)168 3162 A
3372(of)S
(the)126 3498 A
(file)168 3666 A
3876(to)S
(exec)168 4002 A
4212(*/)S
6525 V
(18758)210 1122 A
(char)168 1524 A
(*new_sp,)336 1734 A
(*name,)252 2112 A
(*basename;)420 2406 A
6615 V
(18759)210 1122 A
(vir_bytes)378 1524 A
(src,)168 1944 A
(dst,)168 2154 A
(text_bytes,)462 2364 A
(data_bytes,)462 2868 A
(bss_bytes,)420 3372 A
(stk_bytes,)420 3834 A
(vsp;)168 4296 A
6705 V
(18760)210 1122 A
(phys_bytes)420 1524 A
(tot_bytes;)420 1986 A
2784(/*)S
(total)210 2910 A
(space)210 3162 A
(for)126 3414 A
(program,)336 3582 A
(including)378 3960 A
(gap)126 4380 A
4548(*/)S
6795 V
(18761)210 1122 A
(long)168 1524 A
(sym_bytes;)420 1734 A
6885 V
(18762)210 1122 A
(vir_clicks)420 1524 A
(sc;)126 1986 A
6975 V
(18763)210 1122 A
(struct)252 1524 A
(stat)168 1818 A
(s_buf[2],)378 2028 A
(*s_p;)210 2448 A
7065 V
(18764)210 1122 A
(vir_bytes)378 1524 A
(pc;)126 1944 A
8418 V
EP
%%Page: 249 249
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2363(File:)S
2596(servers/pm/exec.c)S
12 B
(249)180 4500 A
1755 V
7 LST
(18765)210 1122 A
1845 V
(18766)210 1122 A
1524(/*)S
1650(Do)S
(some)168 1776 A
(validity)336 1986 A
(checks.)294 2364 A
2700(*/)S
1935 V
(18767)210 1122 A
(rmp)126 1524 A
1692(=)S
(mp;)126 1776 A
2025 V
(18768)210 1122 A
(stk_bytes)378 1524 A
1944(=)S
(\(vir_bytes\))462 2028 A
(m_in.stack_bytes;)714 2532 A
2115 V
(18769)210 1122 A
1524(if)S
(\(stk_bytes)420 1650 A
2112(>)S
(ARG_MAX\))336 2196 A
(return\(ENOMEM\);)630 2574 A
3456(/*)S
(stack)210 3582 A
(too)126 3834 A
(big)126 4002 A
4170(*/)S
2205 V
(18770)210 1122 A
1524(if)S
(\(m_in.exec_len)588 1650 A
2280(<=)S
2406(0)S
2490(||)S
(m_in.exec_len)546 2616 A
3204(>)S
(PATH_MAX\))378 3288 A
(return\(EINVAL\);)630 3708 A
2295 V
(18771)210 1122 A
2385 V
(18772)210 1122 A
1524(/*)S
(Get)126 1650 A
(the)126 1818 A
(exec)168 1986 A
(file)168 2196 A
(name)168 2406 A
(and)126 2616 A
(see)126 2784 A
2952(if)S
(the)126 3078 A
(file)168 3246 A
3456(is)S
(executable.)462 3582 A
4086(*/)S
2475 V
(18773)210 1122 A
(src)126 1524 A
1692(=)S
(\(vir_bytes\))462 1776 A
(m_in.exec_name;)630 2280 A
2565 V
(18774)210 1122 A
(dst)126 1524 A
1692(=)S
(\(vir_bytes\))462 1776 A
(name_buf;)378 2280 A
2655 V
(18775)210 1122 A
1524(r)S
1608(=)S
(sys_datacopy\(who,)714 1692 A
(\(vir_bytes\))462 2448 A
(src,)168 2952 A
2745 V
(18776)210 1122 A
(PM_PROC_NR,)462 2112 A
(\(vir_bytes\))462 2616 A
(dst,)168 3120 A
(\(phys_bytes\))504 3330 A
(m_in.exec_len\);)630 3876 A
2835 V
(18777)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
(return\(r\);)420 2070 A
2784(/*)S
(file)168 2910 A
(name)168 3120 A
(not)126 3330 A
3498(in)S
(user)168 3624 A
(data)168 3834 A
(segment)294 4044 A
4380(*/)S
2925 V
(18778)210 1122 A
3015 V
(18779)210 1122 A
1524(/*)S
(Fetch)210 1650 A
(the)126 1902 A
(stack)210 2070 A
(from)168 2322 A
(the)126 2532 A
(user)168 2700 A
(before)252 2910 A
(destroying)420 3204 A
(the)126 3666 A
(old)126 3834 A
(core)168 4002 A
(image.)252 4212 A
4506(*/)S
3105 V
(18780)210 1122 A
(src)126 1524 A
1692(=)S
(\(vir_bytes\))462 1776 A
(m_in.stack_ptr;)630 2280 A
3195 V
(18781)210 1122 A
(dst)126 1524 A
1692(=)S
(\(vir_bytes\))462 1776 A
(mbuf;)210 2280 A
3285 V
(18782)210 1122 A
1524(r)S
1608(=)S
(sys_datacopy\(who,)714 1692 A
(\(vir_bytes\))462 2448 A
(src,)168 2952 A
3375 V
(18783)210 1122 A
(PM_PROC_NR,)462 2448 A
(\(vir_bytes\))462 2952 A
(dst,)168 3456 A
(\(phys_bytes\)stk_bytes\);)966 3666 A
3465 V
(18784)210 1122 A
1524(/*)S
(can't)210 1650 A
(fetch)210 1902 A
(stack)210 2154 A
(\(e.g.)210 2406 A
(bad)126 2658 A
(virtual)294 2826 A
(addr\))210 3162 A
3414(*/)S
3555 V
(18785)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
(return\(EACCES\);)630 2070 A
3645 V
(18786)210 1122 A
3735 V
(18787)210 1122 A
1524(r)S
1608(=)S
1692(0;)S
2112(/*)S
2238(r)S
2322(=)S
2406(0)S
(\(first)252 2490 A
(attempt\),)378 2784 A
3204(or)S
3330(1)S
(\(interpreted)504 3414 A
(script\))294 3960 A
4296(*/)S
3825 V
(18788)210 1122 A
(name)168 1524 A
1734(=)S
(name_buf;)378 1818 A
2448(/*)S
(name)168 2574 A
2784(of)S
(file)168 2910 A
3120(to)S
(exec.)210 3246 A
3498(*/)S
3915 V
(18789)210 1122 A
1524(do)S
1650({)S
4005 V
(18790)210 1122 A
(s_p)126 1776 A
1944(=)S
(&s_buf[r];)420 2028 A
4095 V
(18791)210 1122 A
(tell_fs\(CHDIR,)588 1776 A
(who,)168 2406 A
(FALSE,)252 2616 A
(0\);)126 2910 A
3120(/*)S
(switch)252 3246 A
3540(to)S
(the)126 3666 A
(user's)252 3834 A
4128(FS)S
(environ)294 4254 A
4590(*/)S
4185 V
(18792)210 1122 A
1776(fd)S
1902(=)S
(allowed\(name,)546 1986 A
(s_p,)168 2574 A
(X_BIT\);)294 2784 A
3120(/*)S
3246(is)S
(file)168 3372 A
(executable?)462 3582 A
4086(*/)S
4275 V
(18793)210 1122 A
1776(if)S
(\(fd)126 1902 A
2070(<)S
2154(0\))S
(return\(fd\);)462 2322 A
3456(/*)S
(file)168 3582 A
(was)126 3792 A
(not)126 3960 A
(executable)420 4128 A
4590(*/)S
4365 V
(18794)210 1122 A
4455 V
(18795)210 1122 A
1776(/*)S
(Read)168 1902 A
(the)126 2112 A
(file)168 2280 A
(header)252 2490 A
(and)126 2784 A
(extract)294 2952 A
(the)126 3288 A
(segment)294 3456 A
(sizes.)252 3792 A
4086(*/)S
4545 V
(18796)210 1122 A
1776(sc)S
1902(=)S
(\(stk_bytes)420 1986 A
2448(+)S
(CLICK_SIZE)420 2532 A
2994(-)S
3078(1\))S
3204(>>)S
(CLICK_SHIFT;)504 3330 A
4635 V
(18797)210 1122 A
4725 V
(18798)210 1122 A
1776(m)S
1860(=)S
(read_header\(fd,)630 1944 A
(&ft,)168 2616 A
(&text_bytes,)504 2826 A
(&data_bytes,)504 3372 A
(&bss_bytes,)462 3918 A
4815 V
(18799)210 1122 A
(&tot_bytes,)462 3120 A
(&sym_bytes,)462 3624 A
(sc,)126 4128 A
(&pc\);)210 4296 A
4905 V
(18800)210 1122 A
1776(if)S
1902(\(m)S
2028(!=)S
(ESCRIPT)294 2154 A
2490(||)S
(++r)126 2616 A
2784(>)S
2868(1\))S
(break;)252 2994 A
4995 V
(18801)210 1122 A
1524(})S
(while)210 1608 A
(\(\(name)252 1860 A
2154(=)S
(patch_stack\(fd,)630 2238 A
(mbuf,)210 2910 A
(&stk_bytes,)462 3162 A
(name_buf\)\))420 3666 A
4128(!=)S
(NULL\);)252 4254 A
5085 V
(18802)210 1122 A
5175 V
(18803)210 1122 A
1524(if)S
1650(\(m)S
1776(<)S
1860(0\))S
1986({)S
5265 V
(18804)210 1122 A
(close\(fd\);)420 1776 A
2784(/*)S
(something)378 2910 A
(wrong)210 3330 A
(with)168 3582 A
(header)252 3792 A
4086(*/)S
5355 V
(18805)210 1122 A
(return\(stk_bytes)672 1776 A
2490(>)S
(ARG_MAX)294 2574 A
2910(?)S
(ENOMEM)252 2994 A
3288(:)S
(ENOEXEC\);)378 3372 A
5445 V
(18806)210 1122 A
1524(})S
5535 V
(18807)210 1122 A
5625 V
(18808)210 1122 A
1524(/*)S
(Can)126 1650 A
(the)126 1818 A
(process')336 1986 A
(text)168 2364 A
2574(be)S
(shared)252 2700 A
(with)168 2994 A
(that)168 3204 A
3414(of)S
(one)126 3540 A
(already)294 3708 A
(running?)336 4044 A
4422(*/)S
5715 V
(18809)210 1122 A
(sh_mp)210 1524 A
1776(=)S
(find_share\(rmp,)630 1860 A
(s_p->st_ino,)504 2532 A
(s_p->st_dev,)504 3078 A
(s_p->st_ctime\);)630 3624 A
5805 V
(18810)210 1122 A
5895 V
(18811)210 1122 A
1524(/*)S
(Allocate)336 1650 A
(new)126 2028 A
(memory)252 2196 A
(and)126 2490 A
(release)294 2658 A
(old)126 2994 A
(memory.)294 3162 A
(Fix)126 3540 A
(map)126 3708 A
(and)126 3876 A
(tell)168 4044 A
(kernel.)294 4254 A
4590(*/)S
5985 V
(18812)210 1122 A
1524(r)S
1608(=)S
(new_mem\(sh_mp,)588 1692 A
(text_bytes,)462 2322 A
(data_bytes,)462 2826 A
(bss_bytes,)420 3330 A
(stk_bytes,)420 3792 A
(tot_bytes\);)462 4254 A
6075 V
(18813)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
2070({)S
6165 V
(18814)210 1122 A
(close\(fd\);)420 1776 A
2784(/*)S
(insufficient)504 2910 A
(core)168 3456 A
3666(or)S
(program)294 3792 A
(too)126 4128 A
(big)126 4296 A
4464(*/)S
6255 V
(18815)210 1122 A
(return\(r\);)420 1776 A
6345 V
(18816)210 1122 A
1524(})S
6435 V
(18817)210 1122 A
6525 V
(18818)210 1122 A
1524(/*)S
(Save)168 1650 A
(file)168 1860 A
(identification)588 2070 A
2700(to)S
(allow)210 2826 A
3078(it)S
3204(to)S
3330(be)S
(shared.)294 3456 A
3792(*/)S
6615 V
(18819)210 1122 A
(rmp->mp_ino)462 1524 A
2028(=)S
(s_p->st_ino;)504 2112 A
6705 V
(18820)210 1122 A
(rmp->mp_dev)462 1524 A
2028(=)S
(s_p->st_dev;)504 2112 A
6795 V
(18821)210 1122 A
(rmp->mp_ctime)546 1524 A
2112(=)S
(s_p->st_ctime;)588 2196 A
6885 V
(18822)210 1122 A
6975 V
(18823)210 1122 A
1524(/*)S
(Patch)210 1650 A
1902(up)S
(stack)210 2028 A
(and)126 2280 A
(copy)168 2448 A
2658(it)S
(from)168 2784 A
2994(PM)S
3120(to)S
(new)126 3246 A
(core)168 3414 A
(image.)252 3624 A
3918(*/)S
7065 V
(18824)210 1122 A
(vsp)126 1524 A
1692(=)S
(\(vir_bytes\))462 1776 A
(rmp->mp_seg[S].mem_vir)924 2280 A
3246(<<)S
(CLICK_SHIFT;)504 3372 A
8418 V
EP
%%Page: 250 250
BP
/slant 0 def
/height 0 def
1485 V
12 B
(250)180 1080 A
11 R
2363(File:)S
2596(servers/pm/exec.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(18825)210 1122 A
(vsp)126 1524 A
1692(+=)S
(\(vir_bytes\))462 1818 A
(rmp->mp_seg[S].mem_len)924 2322 A
3288(<<)S
(CLICK_SHIFT;)504 3414 A
1845 V
(18826)210 1122 A
(vsp)126 1524 A
1692(-=)S
(stk_bytes;)420 1818 A
1935 V
(18827)210 1122 A
(patch_ptr\(mbuf,)630 1524 A
(vsp\);)210 2196 A
2025 V
(18828)210 1122 A
(src)126 1524 A
1692(=)S
(\(vir_bytes\))462 1776 A
(mbuf;)210 2280 A
2115 V
(18829)210 1122 A
1524(r)S
1608(=)S
(sys_datacopy\(PM_PROC_NR,)1008 1692 A
(\(vir_bytes\))462 2742 A
(src,)168 3246 A
2205 V
(18830)210 1122 A
(who,)168 2448 A
(\(vir_bytes\))462 2658 A
(vsp,)168 3162 A
(\(phys_bytes\)stk_bytes\);)966 3372 A
2295 V
(18831)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
(panic\(__FILE__,"do_exec)966 2070 A
(stack)210 3078 A
(copy)168 3330 A
(err)126 3540 A
(on",)168 3708 A
(who\);)210 3918 A
2385 V
(18832)210 1122 A
2475 V
(18833)210 1122 A
1524(/*)S
(Read)168 1650 A
1860(in)S
(text)168 1986 A
(and)126 2196 A
(data)168 2364 A
(segments.)378 2574 A
2994(*/)S
2565 V
(18834)210 1122 A
1524(if)S
(\(sh_mp)252 1650 A
1944(!=)S
(NULL\))210 2070 A
2322({)S
2655 V
(18835)210 1122 A
(lseek\(fd,)378 1776 A
(\(off_t\))294 2196 A
(text_bytes,)462 2532 A
(SEEK_CUR\);)420 3036 A
3540(/*)S
(shared:)294 3666 A
(skip)168 4002 A
(text)168 4212 A
4422(*/)S
2745 V
(18836)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
2835 V
(18837)210 1122 A
(rw_seg\(0,)378 1776 A
(fd,)126 2196 A
(who,)168 2364 A
2574(T,)S
(text_bytes\);)504 2700 A
2925 V
(18838)210 1122 A
1524(})S
3015 V
(18839)210 1122 A
(rw_seg\(0,)378 1524 A
(fd,)126 1944 A
(who,)168 2112 A
2322(D,)S
(data_bytes\);)504 2448 A
3105 V
(18840)210 1122 A
3195 V
(18841)210 1122 A
(close\(fd\);)420 1524 A
2784(/*)S
(don't)210 2910 A
(need)168 3162 A
(exec)168 3372 A
(file)168 3582 A
(any)126 3792 A
(more)168 3960 A
4170(*/)S
3285 V
(18842)210 1122 A
3375 V
(18843)210 1122 A
1524(/*)S
(Take)168 1650 A
(care)168 1860 A
2070(of)S
(setuid/setgid)546 2196 A
(bits.)210 2784 A
3036(*/)S
3465 V
(18844)210 1122 A
1524(if)S
(\(\(rmp->mp_flags)630 1650 A
2322(&)S
(TRACED\))294 2406 A
2742(==)S
2868(0\))S
2994({)S
3078(/*)S
(suppress)336 3204 A
3582(if)S
(tracing)294 3708 A
4044(*/)S
3555 V
(18845)210 1122 A
1776(if)S
(\(s_buf[0].st_mode)714 1902 A
2658(&)S
(I_SET_UID_BIT\))588 2742 A
3372({)S
3645 V
(18846)210 1122 A
(rmp->mp_effuid)588 2112 A
2742(=)S
(s_buf[0].st_uid;)672 2826 A
3735 V
(18847)210 1122 A
(tell_fs\(SETUID,who,)798 2112 A
(\(int\)rmp->mp_realuid,)882 2952 A
(\(int\)rmp->mp_effuid\);)882 3876 A
3825 V
(18848)210 1122 A
1776(})S
3915 V
(18849)210 1122 A
1776(if)S
(\(s_buf[0].st_mode)714 1902 A
2658(&)S
(I_SET_GID_BIT\))588 2742 A
3372({)S
4005 V
(18850)210 1122 A
(rmp->mp_effgid)588 2112 A
2742(=)S
(s_buf[0].st_gid;)672 2826 A
4095 V
(18851)210 1122 A
(tell_fs\(SETGID,who,)798 2112 A
(\(int\)rmp->mp_realgid,)882 2952 A
(\(int\)rmp->mp_effgid\);)882 3876 A
4185 V
(18852)210 1122 A
1776(})S
4275 V
(18853)210 1122 A
1524(})S
4365 V
(18854)210 1122 A
4455 V
(18855)210 1122 A
1524(/*)S
(Save)168 1650 A
(offset)252 1860 A
2154(to)S
(initial)294 2280 A
(argc)168 2616 A
(\(for)168 2826 A
(ps\))126 3036 A
3204(*/)S
4545 V
(18856)210 1122 A
(rmp->mp_procargs)672 1524 A
2238(=)S
(vsp;)168 2322 A
4635 V
(18857)210 1122 A
4725 V
(18858)210 1122 A
1524(/*)S
(Fix)126 1650 A
('mproc')294 1818 A
(fields,)294 2154 A
(tell)168 2490 A
(kernel)252 2700 A
(that)168 2994 A
(exec)168 3204 A
3414(is)S
(done,)210 3540 A
(reset)210 3834 A
(caught)252 4086 A
(sigs.)210 4380 A
4632(*/)S
4815 V
(18859)210 1122 A
(for)126 1524 A
(\(sn)126 1692 A
1860(=)S
1944(1;)S
2070(sn)S
2196(<=)S
(_NSIG;)252 2322 A
(sn++\))210 2616 A
2868({)S
4905 V
(18860)210 1122 A
1776(if)S
(\(sigismember\(&rmp->mp_catch,)1176 1902 A
(sn\)\))168 3120 A
3330({)S
4995 V
(18861)210 1122 A
(sigdelset\(&rmp->mp_catch,)1050 2112 A
(sn\);)168 3204 A
5085 V
(18862)210 1122 A
(rmp->mp_sigact[sn].sa_handler)1218 2112 A
3372(=)S
(SIG_DFL;)336 3456 A
5175 V
(18863)210 1122 A
(sigemptyset\(&rmp->mp_sigact[sn].sa_mask\);)1722 2112 A
5265 V
(18864)210 1122 A
1776(})S
5355 V
(18865)210 1122 A
1524(})S
5445 V
(18866)210 1122 A
5535 V
(18867)210 1122 A
(rmp->mp_flags)546 1524 A
2112(&=)S
(\304SEPARATE;)420 2238 A
2784(/*)S
(turn)168 2910 A
(off)126 3120 A
(SEPARATE)336 3288 A
(bit)126 3666 A
3834(*/)S
5625 V
(18868)210 1122 A
(rmp->mp_flags)546 1524 A
2112(|=)S
(ft;)126 2238 A
2784(/*)S
(turn)168 2910 A
3120(it)S
3246(on)S
(for)126 3372 A
(separate)336 3540 A
3918(I)S
4002(&)S
4086(D)S
(files)210 4170 A
4422(*/)S
5715 V
(18869)210 1122 A
(new_sp)252 1524 A
1818(=)S
(\(char)210 1902 A
2154(*\))S
(vsp;)168 2280 A
5805 V
(18870)210 1122 A
5895 V
(18871)210 1122 A
(tell_fs\(EXEC,)546 1524 A
(who,)168 2112 A
2322(0,)S
(0\);)126 2448 A
2784(/*)S
(allow)210 2910 A
3162(FS)S
3288(to)S
(handle)252 3414 A
(FD_CLOEXEC)420 3708 A
(files)210 4170 A
4422(*/)S
5985 V
(18872)210 1122 A
6075 V
(18873)210 1122 A
1524(/*)S
(System)252 1650 A
(will)168 1944 A
(save)168 2154 A
(command)294 2364 A
(line)168 2700 A
(for)126 2910 A
(debugging,)420 3078 A
(ps\(1\))210 3540 A
(output,)294 3792 A
(etc.)168 4128 A
4338(*/)S
6165 V
(18874)210 1122 A
(basename)336 1524 A
1902(=)S
(strrchr\(name,)546 1986 A
('/'\);)210 2574 A
6255 V
(18875)210 1122 A
1524(if)S
(\(basename)378 1650 A
2070(==)S
(NULL\))210 2196 A
(basename)336 2448 A
2826(=)S
(name;)210 2910 A
(else)168 3162 A
(basename++;)462 3372 A
6345 V
(18876)210 1122 A
(strncpy\(rmp->mp_name,)882 1524 A
(basename,)378 2448 A
(PROC_NAME_LEN-1\);)714 2868 A
6435 V
(18877)210 1122 A
(rmp->mp_name[PROC_NAME_LEN])1134 1524 A
2700(=)S
('\\0';)210 2784 A
6525 V
(18878)210 1122 A
(sys_exec\(who,)546 1524 A
(new_sp,)294 2112 A
(basename,)378 2448 A
(pc\);)168 2868 A
6615 V
(18879)210 1122 A
6705 V
(18880)210 1122 A
1524(/*)S
(Cause)210 1650 A
1902(a)S
(signal)252 1986 A
2280(if)S
(this)168 2406 A
(process)294 2616 A
2952(is)S
(traced.)294 3078 A
3414(*/)S
6795 V
(18881)210 1122 A
1524(if)S
(\(rmp->mp_flags)588 1650 A
2280(&)S
(TRACED\))294 2364 A
(check_sig\(rmp->mp_pid,)924 2700 A
(SIGTRAP\);)378 3666 A
6885 V
(18882)210 1122 A
6975 V
(18883)210 1122 A
(return\(SUSPEND\);)672 1524 A
2784(/*)S
2910(no)S
(reply,)252 3036 A
(new)126 3330 A
(program)294 3498 A
(just)168 3834 A
(runs)168 4044 A
4254(*/)S
7065 V
(18884)210 1122 A
1440(})S
8418 V
EP
%%Page: 251 251
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2363(File:)S
2596(servers/pm/exec.c)S
12 B
(251)180 4500 A
1845 V
7 LST
(18886)210 1122 A
(/*===========================================================================*)3276 1440 A
1935 V
(18887)210 1122 A
1482(*)S
(read_header)462 2784 A
4674(*)S
2025 V
(18888)210 1122 A
(*===========================================================================*/)3276 1482 A
2115 V
(18889)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(read_header\(fd,)630 1944 A
(ft,)126 2616 A
(text_bytes,)462 2784 A
(data_bytes,)462 3288 A
(bss_bytes,)420 3792 A
2205 V
(18890)210 1122 A
(tot_bytes,)420 3456 A
(sym_bytes,)420 3918 A
(sc,)126 4380 A
(pc\))126 4548 A
2295 V
(18891)210 1122 A
(int)126 1440 A
(fd;)126 1608 A
2784(/*)S
(file)168 2910 A
(descriptor)420 3120 A
(for)126 3582 A
(reading)294 3750 A
(exec)168 4086 A
(file)168 4296 A
4506(*/)S
2385 V
(18892)210 1122 A
(int)126 1440 A
(*ft;)168 1608 A
2784(/*)S
(place)210 2910 A
3162(to)S
(return)252 3288 A
3582(ft)S
(number)252 3708 A
4002(*/)S
2475 V
(18893)210 1122 A
(vir_bytes)378 1440 A
(*text_bytes;)504 1860 A
2784(/*)S
(place)210 2910 A
3162(to)S
(return)252 3288 A
(text)168 3582 A
(size)168 3792 A
4002(*/)S
2565 V
(18894)210 1122 A
(vir_bytes)378 1440 A
(*data_bytes;)504 1860 A
2784(/*)S
(place)210 2910 A
3162(to)S
(return)252 3288 A
(initialized)462 3582 A
(data)168 4086 A
(size)168 4296 A
4506(*/)S
2655 V
(18895)210 1122 A
(vir_bytes)378 1440 A
(*bss_bytes;)462 1860 A
2784(/*)S
(place)210 2910 A
3162(to)S
(return)252 3288 A
(bss)126 3582 A
(size)168 3750 A
3960(*/)S
2745 V
(18896)210 1122 A
(phys_bytes)420 1440 A
(*tot_bytes;)462 1902 A
2784(/*)S
(place)210 2910 A
3162(to)S
(return)252 3288 A
(total)210 3582 A
(size)168 3834 A
4044(*/)S
2835 V
(18897)210 1122 A
(long)168 1440 A
(*sym_bytes;)462 1650 A
2784(/*)S
(place)210 2910 A
3162(to)S
(return)252 3288 A
(symbol)252 3582 A
(table)210 3876 A
(size)168 4128 A
4338(*/)S
2925 V
(18898)210 1122 A
(vir_clicks)420 1440 A
(sc;)126 1902 A
2784(/*)S
(stack)210 2910 A
(size)168 3162 A
3372(in)S
(clicks)252 3498 A
3792(*/)S
3015 V
(18899)210 1122 A
(vir_bytes)378 1440 A
(*pc;)168 1860 A
2784(/*)S
(program)294 2910 A
(entry)210 3246 A
(point)210 3498 A
(\(initial)336 3750 A
(PC\))126 4128 A
4296(*/)S
3105 V
(18900)210 1122 A
1440({)S
3195 V
(18901)210 1122 A
1440(/*)S
(Read)168 1566 A
(the)126 1776 A
(header)252 1944 A
(and)126 2238 A
(extract)294 2406 A
(the)126 2742 A
(text,)210 2910 A
(data,)210 3162 A
(bss)126 3414 A
(and)126 3582 A
(total)210 3750 A
(sizes)210 4002 A
(from)168 4254 A
(it.)126 4464 A
4632(*/)S
3285 V
(18902)210 1122 A
3375 V
(18903)210 1122 A
(int)126 1524 A
1692(m,)S
(ct;)126 1818 A
3465 V
(18904)210 1122 A
(vir_clicks)420 1524 A
(tc,)126 1986 A
(dc,)126 2154 A
(s_vir,)252 2322 A
(dvir;)210 2616 A
3555 V
(18905)210 1122 A
(phys_clicks)462 1524 A
(totc;)210 2028 A
3645 V
(18906)210 1122 A
(struct)252 1524 A
(exec)168 1818 A
(hdr;)168 2028 A
2784(/*)S
(a.out)210 2910 A
(header)252 3162 A
3456(is)S
(read)168 3582 A
3792(in)S
(here)168 3918 A
4128(*/)S
3735 V
(18907)210 1122 A
3825 V
(18908)210 1122 A
1524(/*)S
(Read)168 1650 A
(the)126 1860 A
(header)252 2028 A
(and)126 2322 A
(check)210 2490 A
(the)126 2742 A
(magic)210 2910 A
(number.)294 3162 A
(The)126 3540 A
(standard)336 3708 A
(MINIX)210 4086 A
(header)252 4338 A
3915 V
(18909)210 1122 A
1566(*)S
1650(is)S
(defined)294 1776 A
2112(in)S
(<a.out.h>.)420 2238 A
2742(It)S
(consists)336 2868 A
3246(of)S
3372(8)S
(chars)210 3456 A
(followed)336 3708 A
4086(by)S
4212(6)S
(longs.)252 4296 A
4005 V
(18910)210 1122 A
1566(*)S
(Then)168 1650 A
(come)168 1860 A
2070(4)S
(more)168 2154 A
(longs)210 2364 A
(that)168 2616 A
(are)126 2826 A
(not)126 2994 A
(used)168 3162 A
(here.)210 3372 A
4095 V
(18911)210 1122 A
1566(*)S
(Byte)168 1776 A
1986(0:)S
(magic)210 2112 A
(number)252 2364 A
(0x01)168 2658 A
4185 V
(18912)210 1122 A
1566(*)S
(Byte)168 1776 A
1986(1:)S
(magic)210 2112 A
(number)252 2364 A
(0x03)168 2658 A
4275 V
(18913)210 1122 A
1566(*)S
(Byte)168 1776 A
1986(2:)S
(normal)252 2112 A
2406(=)S
(0x10)168 2490 A
(\(not)168 2700 A
(checked,)336 2910 A
3288(0)S
3372(is)S
(OK\),)168 3498 A
(separate)336 3708 A
(I/D)126 4086 A
4254(=)S
(0x20)168 4338 A
4365 V
(18914)210 1122 A
1566(*)S
(Byte)168 1776 A
1986(3:)S
(CPU)126 2112 A
(type,)210 2280 A
(Intel)210 2532 A
2784(16)S
(bit)126 2910 A
3078(=)S
(0x04,)210 3162 A
(Intel)210 3414 A
3666(32)S
(bit)126 3792 A
3960(=)S
(0x10,)210 4044 A
4455 V
(18915)210 1122 A
1566(*)S
(Motorola)336 2112 A
2490(=)S
(0x0B,)210 2574 A
(Sun)126 2826 A
(SPARC)210 2994 A
3246(=)S
(0x17)168 3330 A
4545 V
(18916)210 1122 A
1566(*)S
(Byte)168 1776 A
1986(4:)S
(Header)252 2112 A
(length)252 2406 A
2700(=)S
(0x20)168 2784 A
4635 V
(18917)210 1122 A
1566(*)S
(Bytes)210 1776 A
(5-7)126 2028 A
(are)126 2196 A
(not)126 2364 A
(used.)210 2532 A
4725 V
(18918)210 1122 A
1566(*)S
4815 V
(18919)210 1122 A
1566(*)S
(Now)126 1776 A
(come)168 1944 A
(the)126 2154 A
2322(6)S
(longs)210 2406 A
4905 V
(18920)210 1122 A
1566(*)S
(Bytes)210 1776 A
(8-11:)210 2070 A
(size)168 2322 A
2532(of)S
(text)168 2658 A
(segments)336 2868 A
3246(in)S
(bytes)210 3372 A
4995 V
(18921)210 1122 A
1566(*)S
(Bytes)210 1776 A
(12-15:)252 2028 A
(size)168 2322 A
2532(of)S
(initialized)462 2658 A
(data)168 3162 A
(segment)294 3372 A
3708(in)S
(bytes)210 3834 A
5085 V
(18922)210 1122 A
1566(*)S
(Bytes)210 1776 A
(16-19:)252 2028 A
(size)168 2322 A
2532(of)S
(bss)126 2658 A
2826(in)S
(bytes)210 2952 A
5175 V
(18923)210 1122 A
1566(*)S
(Bytes)210 1776 A
(20-23:)252 2028 A
(program)294 2322 A
(entry)210 2658 A
(point)210 2910 A
5265 V
(18924)210 1122 A
1566(*)S
(Bytes)210 1776 A
(24-27:)252 2028 A
(total)210 2322 A
(memory)252 2574 A
(allocated)378 2868 A
3288(to)S
(program)294 3414 A
(\(text,)252 3750 A
(data)168 4044 A
4254(+)S
(stack\))252 4338 A
5355 V
(18925)210 1122 A
1566(*)S
(Bytes)210 1776 A
(28-31:)252 2028 A
(size)168 2322 A
2532(of)S
(symbol)252 2658 A
(table)210 2952 A
3204(in)S
(bytes)210 3330 A
5445 V
(18926)210 1122 A
1566(*)S
(The)126 1650 A
(longs)210 1818 A
(are)126 2070 A
(represented)462 2238 A
2742(in)S
2868(a)S
(machine)294 2952 A
(dependent)378 3288 A
(order,)252 3708 A
5535 V
(18927)210 1122 A
1566(*)S
(little-endian)546 1650 A
2238(on)S
(the)126 2364 A
(8088,)210 2532 A
(big-endian)420 2784 A
3246(on)S
(the)126 3372 A
(68000.)252 3540 A
5625 V
(18928)210 1122 A
1566(*)S
(The)126 1650 A
(header)252 1818 A
2112(is)S
(followed)336 2238 A
(directly)336 2616 A
2994(by)S
(the)126 3120 A
(text)168 3288 A
(and)126 3498 A
(data)168 3666 A
(segments,)378 3876 A
(and)126 4296 A
(the)126 4464 A
5715 V
(18929)210 1122 A
1566(*)S
(symbol)252 1650 A
(table)210 1944 A
(\(if)126 2196 A
(any\).)210 2364 A
(The)126 2616 A
(sizes)210 2784 A
(are)126 3036 A
(given)210 3204 A
3456(in)S
(the)126 3582 A
(header.)294 3750 A
(Only)168 4086 A
(the)126 4296 A
5805 V
(18930)210 1122 A
1566(*)S
(text)168 1650 A
(and)126 1860 A
(data)168 2028 A
(segments)336 2238 A
(are)126 2616 A
(copied)252 2784 A
(into)168 3078 A
(memory)252 3288 A
3582(by)S
(exec.)210 3708 A
(The)126 3960 A
(header)252 4128 A
4422(is)S
5895 V
(18931)210 1122 A
1566(*)S
(used)168 1650 A
(here)168 1860 A
(only.)210 2070 A
(The)126 2322 A
(symbol)252 2490 A
(table)210 2784 A
3036(is)S
(for)126 3162 A
(the)126 3330 A
(benefit)294 3498 A
3834(of)S
3960(a)S
(debugger)336 4044 A
(and)126 4422 A
5985 V
(18932)210 1122 A
1566(*)S
1650(is)S
(ignored)294 1776 A
(here.)210 2112 A
6075 V
(18933)210 1122 A
1566(*/)S
6165 V
(18934)210 1122 A
6255 V
(18935)210 1122 A
1524(if)S
(\(\(m=)168 1650 A
(read\(fd,)336 1860 A
(&hdr,)210 2238 A
(A_MINHDR\)\))420 2490 A
2952(<)S
3036(2\))S
(return\(ENOEXEC\);)672 3162 A
6345 V
(18936)210 1122 A
6435 V
(18937)210 1122 A
1524(/*)S
(Interpreted)462 1650 A
(script?)294 2154 A
2490(*/)S
6525 V
(18938)210 1122 A
1524(if)S
(\(\(\(char)294 1650 A
1986(*\))S
(&hdr\)[0])336 2112 A
2490(==)S
('#')126 2616 A
2784(&&)S
(\(\(char)252 2910 A
3204(*\))S
(&hdr\)[1])336 3330 A
3708(==)S
('!'\))168 3834 A
(return\(ESCRIPT\);)672 4044 A
6615 V
(18939)210 1122 A
6705 V
(18940)210 1122 A
1524(if)S
1650(\(m)S
1776(!=)S
(A_MINHDR\))378 1902 A
(return\(ENOEXEC\);)672 2322 A
6795 V
(18941)210 1122 A
6885 V
(18942)210 1122 A
1524(/*)S
(Check)210 1650 A
(magic)210 1902 A
(number,)294 2154 A
(cpu)126 2490 A
(type,)210 2658 A
(and)126 2910 A
(flags.)252 3078 A
3372(*/)S
6975 V
(18943)210 1122 A
1524(if)S
(\(BADMAG\(hdr\)\))546 1650 A
(return\(ENOEXEC\);)672 2238 A
7065 V
(18944)210 1122 A
1524(if)S
(\(hdr.a_cpu)420 1650 A
2112(!=)S
(A_I80386\))378 2238 A
(return\(ENOEXEC\);)672 2658 A
8418 V
EP
%%Page: 252 252
BP
/slant 0 def
/height 0 def
1485 V
12 B
(252)180 1080 A
11 R
2363(File:)S
2596(servers/pm/exec.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(18945)210 1122 A
1524(if)S
(\(\(hdr.a_flags)546 1650 A
2238(&)S
(\304\(A_NSYM)336 2322 A
2700(|)S
(A_EXEC)252 2784 A
3078(|)S
(A_SEP\)\))294 3162 A
3498(!=)S
3624(0\))S
(return\(ENOEXEC\);)672 3750 A
1845 V
(18946)210 1122 A
1935 V
(18947)210 1122 A
(*ft)126 1524 A
1692(=)S
1776(\()S
(\(hdr.a_flags)504 1860 A
2406(&)S
(A_SEP\))252 2490 A
2784(?)S
(SEPARATE)336 2868 A
3246(:)S
(0\);)126 3330 A
3624(/*)S
(separate)336 3750 A
4128(I)S
4212(&)S
4296(D)S
4380(or)S
(not)126 4506 A
4674(*/)S
2025 V
(18948)210 1122 A
2115 V
(18949)210 1122 A
1524(/*)S
(Get)126 1650 A
(text)168 1818 A
(and)126 2028 A
(data)168 2196 A
(sizes.)252 2406 A
2700(*/)S
2205 V
(18950)210 1122 A
(*text_bytes)462 1524 A
2028(=)S
(\(vir_bytes\))462 2112 A
(hdr.a_text;)462 2616 A
3120(/*)S
(text)168 3246 A
(size)168 3456 A
3666(in)S
(bytes)210 3792 A
4044(*/)S
2295 V
(18951)210 1122 A
(*data_bytes)462 1524 A
2028(=)S
(\(vir_bytes\))462 2112 A
(hdr.a_data;)462 2616 A
3120(/*)S
(data)168 3246 A
(size)168 3456 A
3666(in)S
(bytes)210 3792 A
4044(*/)S
2385 V
(18952)210 1122 A
(*bss_bytes)420 1524 A
2028(=)S
(\(vir_bytes\))462 2112 A
(hdr.a_bss;)420 2616 A
3120(/*)S
(bss)126 3246 A
(size)168 3414 A
3624(in)S
(bytes)210 3750 A
4002(*/)S
2475 V
(18953)210 1122 A
(*tot_bytes)420 1524 A
2028(=)S
(hdr.a_total;)504 2112 A
3120(/*)S
(total)210 3246 A
(bytes)210 3498 A
3750(to)S
(allocate)336 3876 A
(for)126 4254 A
(prog)168 4422 A
4632(*/)S
2565 V
(18954)210 1122 A
(*sym_bytes)420 1524 A
2028(=)S
(hdr.a_syms;)462 2112 A
3120(/*)S
(symbol)252 3246 A
(table)210 3540 A
(size)168 3792 A
4002(in)S
(bytes)210 4128 A
4380(*/)S
2655 V
(18955)210 1122 A
1524(if)S
(\(*tot_bytes)462 1650 A
2154(==)S
2280(0\))S
(return\(ENOEXEC\);)672 2406 A
2745 V
(18956)210 1122 A
2835 V
(18957)210 1122 A
1524(if)S
(\(*ft)168 1650 A
1860(!=)S
(SEPARATE\))378 1986 A
2406({)S
2925 V
(18958)210 1122 A
1776(/*)S
1902(If)S
2028(I)S
2112(&)S
2196(D)S
(space)210 2280 A
2532(is)S
(not)126 2658 A
(separated,)420 2826 A
3288(it)S
3414(is)S
(all)126 3540 A
(considered)420 3708 A
(data.)210 4170 A
(Text=0*/)336 4422 A
3015 V
(18959)210 1122 A
(*data_bytes)462 1776 A
2280(+=)S
(*text_bytes;)504 2406 A
3105 V
(18960)210 1122 A
(*text_bytes)462 1776 A
2280(=)S
2364(0;)S
3195 V
(18961)210 1122 A
1524(})S
3285 V
(18962)210 1122 A
(*pc)126 1524 A
1692(=)S
(hdr.a_entry;)504 1776 A
2448(/*)S
(initial)294 2574 A
(address)294 2910 A
3246(to)S
(start)210 3372 A
(execution)378 3624 A
4044(*/)S
3375 V
(18963)210 1122 A
3465 V
(18964)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(to)S
(see)126 2028 A
2196(if)S
(segment)294 2322 A
(sizes)210 2658 A
(are)126 2910 A
(feasible.)378 3078 A
3498(*/)S
3555 V
(18965)210 1122 A
1524(tc)S
1650(=)S
(\(\(unsigned)420 1734 A
(long\))210 2196 A
(*text_bytes)462 2448 A
2952(+)S
(CLICK_SIZE)420 3036 A
3498(-)S
3582(1\))S
3708(>>)S
(CLICK_SHIFT;)504 3834 A
3645 V
(18966)210 1122 A
1524(dc)S
1650(=)S
(\(*data_bytes)504 1734 A
2280(+)S
(*bss_bytes)420 2364 A
2826(+)S
(CLICK_SIZE)420 2910 A
3372(-)S
3456(1\))S
3582(>>)S
(CLICK_SHIFT;)504 3708 A
3735 V
(18967)210 1122 A
(totc)168 1524 A
1734(=)S
(\(*tot_bytes)462 1818 A
2322(+)S
(CLICK_SIZE)420 2406 A
2868(-)S
2952(1\))S
3078(>>)S
(CLICK_SHIFT;)504 3204 A
3825 V
(18968)210 1122 A
1524(if)S
(\(dc)126 1650 A
1818(>=)S
(totc\))210 1944 A
(return\(ENOEXEC\);)672 2196 A
3120(/*)S
(stack)210 3246 A
(must)168 3498 A
3708(be)S
3834(at)S
(least)210 3960 A
4212(1)S
(click)210 4296 A
4548(*/)S
3915 V
(18969)210 1122 A
(dvir)168 1524 A
1734(=)S
(\(*ft)168 1818 A
2028(==)S
(SEPARATE)336 2154 A
2532(?)S
2616(0)S
2700(:)S
(tc\);)168 2784 A
4005 V
(18970)210 1122 A
(s_vir)210 1524 A
1776(=)S
(dvir)168 1860 A
2070(+)S
(\(totc)210 2154 A
2406(-)S
(sc\);)168 2490 A
4095 V
(18971)210 1122 A
1524(m)S
1608(=)S
(\(dvir)210 1692 A
1944(+)S
2028(dc)S
2154(>)S
(s_vir\))252 2238 A
2532(?)S
(ENOMEM)252 2616 A
2910(:)S
(OK;)126 2994 A
4185 V
(18972)210 1122 A
1524(ct)S
1650(=)S
(hdr.a_hdrlen)504 1734 A
2280(&)S
(BYTE;)210 2364 A
3120(/*)S
(header)252 3246 A
(length)252 3540 A
3834(*/)S
4275 V
(18973)210 1122 A
1524(if)S
(\(ct)126 1650 A
1818(>)S
(A_MINHDR\))378 1902 A
(lseek\(fd,)378 2322 A
(\(off_t\))294 2742 A
(ct,)126 3078 A
(SEEK_SET\);)420 3246 A
3708(/*)S
(skip)168 3834 A
(unused)252 4044 A
(hdr)126 4338 A
4506(*/)S
4365 V
(18974)210 1122 A
(return\(m\);)420 1524 A
4455 V
(18975)210 1122 A
1440(})S
4635 V
(18977)210 1122 A
(/*===========================================================================*)3276 1440 A
4725 V
(18978)210 1122 A
1482(*)S
(new_mem)294 2784 A
4674(*)S
4815 V
(18979)210 1122 A
(*===========================================================================*/)3276 1482 A
4905 V
(18980)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(new_mem\(sh_mp,)588 1944 A
(text_bytes,)462 2574 A
(data_bytes,)462 3078 A
4995 V
(18981)210 1122 A
(bss_bytes,stk_bytes,tot_bytes\))1260 1776 A
5085 V
(18982)210 1122 A
(struct)252 1440 A
(mproc)210 1734 A
(*sh_mp;)294 1986 A
2784(/*)S
(text)168 2910 A
(can)126 3120 A
3288(be)S
(shared)252 3414 A
(with)168 3708 A
(this)168 3918 A
(process)294 4128 A
4464(*/)S
5175 V
(18983)210 1122 A
(vir_bytes)378 1440 A
(text_bytes;)462 1860 A
2784(/*)S
(text)168 2910 A
(segment)294 3120 A
(size)168 3456 A
3666(in)S
(bytes)210 3792 A
4044(*/)S
5265 V
(18984)210 1122 A
(vir_bytes)378 1440 A
(data_bytes;)462 1860 A
2784(/*)S
(size)168 2910 A
3120(of)S
(initialized)462 3246 A
(data)168 3750 A
3960(in)S
(bytes)210 4086 A
4338(*/)S
5355 V
(18985)210 1122 A
(vir_bytes)378 1440 A
(bss_bytes;)420 1860 A
2784(/*)S
(size)168 2910 A
3120(of)S
(bss)126 3246 A
3414(in)S
(bytes)210 3540 A
3792(*/)S
5445 V
(18986)210 1122 A
(vir_bytes)378 1440 A
(stk_bytes;)420 1860 A
2784(/*)S
(size)168 2910 A
3120(of)S
(initial)294 3246 A
(stack)210 3582 A
(segment)294 3834 A
4170(in)S
(bytes)210 4296 A
4548(*/)S
5535 V
(18987)210 1122 A
(phys_bytes)420 1440 A
(tot_bytes;)420 1902 A
2784(/*)S
(total)210 2910 A
(memory)252 3162 A
3456(to)S
(allocate,)378 3582 A
(including)378 4002 A
(gap)126 4422 A
4590(*/)S
5625 V
(18988)210 1122 A
1440({)S
5715 V
(18989)210 1122 A
1440(/*)S
(Allocate)336 1566 A
(new)126 1944 A
(memory)252 2112 A
(and)126 2406 A
(release)294 2574 A
(the)126 2910 A
(old)126 3078 A
(memory.)294 3246 A
(Change)252 3624 A
(the)126 3918 A
(map)126 4086 A
(and)126 4254 A
(report)252 4422 A
5805 V
(18990)210 1122 A
1482(*)S
(the)126 1566 A
(new)126 1734 A
(map)126 1902 A
2070(to)S
(the)126 2196 A
(kernel.)294 2364 A
(Zero)168 2742 A
(the)126 2952 A
(new)126 3120 A
(core)168 3288 A
(image's)294 3498 A
(bss,)168 3834 A
(gap)126 4044 A
(and)126 4212 A
(stack.)252 4380 A
5895 V
(18991)210 1122 A
1482(*/)S
5985 V
(18992)210 1122 A
6075 V
(18993)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rmp)168 2448 A
2658(=)S
(mp;)126 2742 A
6165 V
(18994)210 1122 A
(vir_clicks)420 1524 A
(text_clicks,)504 1986 A
(data_clicks,)504 2532 A
(gap_clicks,)462 3078 A
(stack_clicks,)546 3582 A
(tot_clicks;)462 4170 A
6255 V
(18995)210 1122 A
(phys_clicks)462 1524 A
(new_base;)378 2028 A
6345 V
(18996)210 1122 A
(phys_bytes)420 1524 A
(bytes,)252 1986 A
(base,)210 2280 A
(bss_offset;)462 2532 A
6435 V
(18997)210 1122 A
(int)126 1524 A
1692(s;)S
6525 V
(18998)210 1122 A
6615 V
(18999)210 1122 A
1524(/*)S
1650(No)S
(need)168 1776 A
1986(to)S
(allocate)336 2112 A
(text)168 2490 A
2700(if)S
2826(it)S
(can)126 2952 A
3120(be)S
(shared.)294 3246 A
3582(*/)S
6705 V
(19000)210 1122 A
1524(if)S
(\(sh_mp)252 1650 A
1944(!=)S
(NULL\))210 2070 A
(text_bytes)420 2322 A
2784(=)S
2868(0;)S
6795 V
(19001)210 1122 A
6885 V
(19002)210 1122 A
1524(/*)S
(Allow)210 1650 A
(the)126 1902 A
(old)126 2070 A
(data)168 2238 A
2448(to)S
2574(be)S
(swapped)294 2700 A
(out)126 3036 A
3204(to)S
(make)168 3330 A
(room.)210 3540 A
(\(Which)252 3834 A
4128(is)S
(really)252 4254 A
4548(a)S
6975 V
(19003)210 1122 A
1566(*)S
(waste)210 1650 A
1902(of)S
(time,)210 2028 A
(because)294 2280 A
2616(we)S
(are)126 2742 A
(going)210 2910 A
3162(to)S
(throw)210 3288 A
3540(it)S
(away)168 3666 A
(anyway.\))336 3876 A
7065 V
(19004)210 1122 A
1566(*/)S
8418 V
EP
%%Page: 253 253
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2363(File:)S
2596(servers/pm/exec.c)S
12 B
(253)180 4500 A
1755 V
7 LST
(19005)210 1122 A
(rmp->mp_flags)546 1524 A
2112(|=)S
(WAITING;)336 2238 A
1845 V
(19006)210 1122 A
1935 V
(19007)210 1122 A
1524(/*)S
(Acquire)294 1650 A
(the)126 1986 A
(new)126 2154 A
(memory.)294 2322 A
(Each)168 2700 A
2910(of)S
(the)126 3036 A
3204(4)S
(parts:)252 3288 A
(text,)210 3582 A
(\(data+bss\),)462 3834 A
(gap,)168 4338 A
2025 V
(19008)210 1122 A
1566(*)S
(and)126 1650 A
(stack)210 1818 A
(occupies)336 2070 A
2448(an)S
(integral)336 2574 A
(number)252 2952 A
3246(of)S
(clicks,)294 3372 A
(starting)336 3708 A
4086(at)S
(click)210 4212 A
2115 V
(19009)210 1122 A
1566(*)S
(boundary.)378 1650 A
(The)126 2112 A
(data)168 2280 A
(and)126 2490 A
(bss)126 2658 A
(parts)210 2826 A
(are)126 3078 A
(run)126 3246 A
(together)336 3414 A
(with)168 3792 A
4002(no)S
(space.)252 4128 A
2205 V
(19010)210 1122 A
1566(*/)S
2295 V
(19011)210 1122 A
(text_clicks)462 1524 A
2028(=)S
(\(\(unsigned)420 2112 A
(long\))210 2574 A
(text_bytes)420 2826 A
3288(+)S
(CLICK_SIZE)420 3372 A
3834(-)S
3918(1\))S
4044(>>)S
(CLICK_SHIFT;)504 4170 A
2385 V
(19012)210 1122 A
(data_clicks)462 1524 A
2028(=)S
(\(data_bytes)462 2112 A
2616(+)S
(bss_bytes)378 2700 A
3120(+)S
(CLICK_SIZE)420 3204 A
3666(-)S
3750(1\))S
3876(>>)S
(CLICK_SHIFT;)504 4002 A
2475 V
(19013)210 1122 A
(stack_clicks)504 1524 A
2070(=)S
(\(stk_bytes)420 2154 A
2616(+)S
(CLICK_SIZE)420 2700 A
3162(-)S
3246(1\))S
3372(>>)S
(CLICK_SHIFT;)504 3498 A
2565 V
(19014)210 1122 A
(tot_clicks)420 1524 A
1986(=)S
(\(tot_bytes)420 2070 A
2532(+)S
(CLICK_SIZE)420 2616 A
3078(-)S
3162(1\))S
3288(>>)S
(CLICK_SHIFT;)504 3414 A
2655 V
(19015)210 1122 A
(gap_clicks)420 1524 A
1986(=)S
(tot_clicks)420 2070 A
2532(-)S
(data_clicks)462 2616 A
3120(-)S
(stack_clicks;)546 3204 A
2745 V
(19016)210 1122 A
1524(if)S
1650(\()S
(\(int\))210 1734 A
(gap_clicks)420 1986 A
2448(<)S
2532(0\))S
(return\(ENOMEM\);)630 2658 A
2835 V
(19017)210 1122 A
2925 V
(19018)210 1122 A
1524(/*)S
(Try)126 1650 A
1818(to)S
(allocate)336 1944 A
(memory)252 2322 A
(for)126 2616 A
(the)126 2784 A
(new)126 2952 A
(process.)336 3120 A
3498(*/)S
3015 V
(19019)210 1122 A
(new_base)336 1524 A
1902(=)S
(alloc_mem\(text_clicks)882 1986 A
2910(+)S
(tot_clicks\);)504 2994 A
3105 V
(19020)210 1122 A
1524(if)S
(\(new_base)378 1650 A
2070(==)S
(NO_MEM\))294 2196 A
(return\(ENOMEM\);)630 2532 A
3195 V
(19021)210 1122 A
3285 V
(19022)210 1122 A
1524(/*)S
(We've)210 1650 A
(got)126 1902 A
(memory)252 2070 A
(for)126 2364 A
(the)126 2532 A
(new)126 2700 A
(core)168 2868 A
(image.)252 3078 A
(Release)294 3414 A
(the)126 3750 A
(old)126 3918 A
(one.)168 4086 A
4296(*/)S
3375 V
(19023)210 1122 A
(rmp)126 1524 A
1692(=)S
(mp;)126 1776 A
3465 V
(19024)210 1122 A
3555 V
(19025)210 1122 A
1524(if)S
(\(find_share\(rmp,)672 1650 A
(rmp->mp_ino,)504 2364 A
(rmp->mp_dev,)504 2910 A
(rmp->mp_ctime\))588 3456 A
4086(==)S
(NULL\))210 4212 A
4464({)S
3645 V
(19026)210 1122 A
1776(/*)S
1902(No)S
(other)210 2028 A
(process)294 2280 A
(shares)252 2616 A
(the)126 2910 A
(text)168 3078 A
(segment,)336 3288 A
3666(so)S
(free)168 3792 A
(it.)126 4002 A
4170(*/)S
3735 V
(19027)210 1122 A
(free_mem\(rmp->mp_seg[T].mem_phys,)1386 1776 A
(rmp->mp_seg[T].mem_len\);)1008 3204 A
3825 V
(19028)210 1122 A
1524(})S
3915 V
(19029)210 1122 A
1524(/*)S
(Free)168 1650 A
(the)126 1860 A
(data)168 2028 A
(and)126 2238 A
(stack)210 2406 A
(segments.)378 2658 A
3078(*/)S
4005 V
(19030)210 1122 A
(free_mem\(rmp->mp_seg[D].mem_phys,)1386 1524 A
4095 V
(19031)210 1122 A
(rmp->mp_seg[S].mem_vir)924 1566 A
2532(+)S
(rmp->mp_seg[S].mem_len)924 2616 A
3582(-)S
(rmp->mp_seg[D].mem_vir\);)1008 3666 A
4185 V
(19032)210 1122 A
4275 V
(19033)210 1122 A
1524(/*)S
1650(We)S
(have)168 1776 A
(now)126 1986 A
(passed)252 2154 A
(the)126 2448 A
(point)210 2616 A
2868(of)S
2994(no)S
(return.)294 3120 A
(The)126 3498 A
(old)126 3666 A
(core)168 3834 A
(image)210 4044 A
(has)126 4296 A
(been)168 4464 A
4365 V
(19034)210 1122 A
1566(*)S
(forever)294 1650 A
(lost,)210 1986 A
(memory)252 2238 A
(for)126 2532 A
2700(a)S
(new)126 2784 A
(core)168 2952 A
(image)210 3162 A
(has)126 3414 A
(been)168 3582 A
(allocated.)420 3792 A
(Set)126 4296 A
4464(up)S
4455 V
(19035)210 1122 A
1566(*)S
(and)126 1650 A
(report)252 1818 A
(new)126 2112 A
(map.)168 2280 A
4545 V
(19036)210 1122 A
1566(*/)S
4635 V
(19037)210 1122 A
1524(if)S
(\(sh_mp)252 1650 A
1944(!=)S
(NULL\))210 2070 A
2322({)S
4725 V
(19038)210 1122 A
1776(/*)S
(Share)210 1902 A
(the)126 2154 A
(text)168 2322 A
(segment.)336 2532 A
2910(*/)S
4815 V
(19039)210 1122 A
(rmp->mp_seg[T])588 1776 A
2406(=)S
(sh_mp->mp_seg[T];)714 2490 A
4905 V
(19040)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
4995 V
(19041)210 1122 A
(rmp->mp_seg[T].mem_phys)966 1776 A
2784(=)S
(new_base;)378 2868 A
5085 V
(19042)210 1122 A
(rmp->mp_seg[T].mem_vir)924 1776 A
2742(=)S
2826(0;)S
5175 V
(19043)210 1122 A
(rmp->mp_seg[T].mem_len)924 1776 A
2742(=)S
(text_clicks;)504 2826 A
5265 V
(19044)210 1122 A
1524(})S
5355 V
(19045)210 1122 A
(rmp->mp_seg[D].mem_phys)966 1524 A
2532(=)S
(new_base)336 2616 A
2994(+)S
(text_clicks;)504 3078 A
5445 V
(19046)210 1122 A
(rmp->mp_seg[D].mem_vir)924 1524 A
2490(=)S
2574(0;)S
5535 V
(19047)210 1122 A
(rmp->mp_seg[D].mem_len)924 1524 A
2490(=)S
(data_clicks;)504 2574 A
5625 V
(19048)210 1122 A
(rmp->mp_seg[S].mem_phys)966 1524 A
2532(=)S
(rmp->mp_seg[D].mem_phys)966 2616 A
3624(+)S
(data_clicks)462 3708 A
4212(+)S
(gap_clicks;)462 4296 A
5715 V
(19049)210 1122 A
(rmp->mp_seg[S].mem_vir)924 1524 A
2490(=)S
(rmp->mp_seg[D].mem_vir)924 2574 A
3540(+)S
(data_clicks)462 3624 A
4128(+)S
(gap_clicks;)462 4212 A
5805 V
(19050)210 1122 A
(rmp->mp_seg[S].mem_len)924 1524 A
2490(=)S
(stack_clicks;)546 2574 A
5895 V
(19051)210 1122 A
5985 V
(19052)210 1122 A
(sys_newmap\(who,)630 1524 A
(rmp->mp_seg\);)546 2196 A
2868(/*)S
(report)252 2994 A
(new)126 3288 A
(map)126 3456 A
3624(to)S
(the)126 3750 A
(kernel)252 3918 A
4212(*/)S
6075 V
(19053)210 1122 A
6165 V
(19054)210 1122 A
1524(/*)S
(The)126 1650 A
(old)126 1818 A
(memory)252 1986 A
(may)126 2280 A
(have)168 2448 A
(been)168 2658 A
(swapped)294 2868 A
(out,)168 3204 A
(but)126 3414 A
(the)126 3582 A
(new)126 3750 A
(memory)252 3918 A
4212(is)S
(real.)210 4338 A
4590(*/)S
6255 V
(19055)210 1122 A
(rmp->mp_flags)546 1524 A
2112(&=)S
(\304\(WAITING|ONSWAP|SWAPIN\);)1050 2238 A
6345 V
(19056)210 1122 A
6435 V
(19057)210 1122 A
1524(/*)S
(Zero)168 1650 A
(the)126 1860 A
(bss,)168 2028 A
(gap,)168 2238 A
(and)126 2448 A
(stack)210 2616 A
(segment.)336 2868 A
3246(*/)S
6525 V
(19058)210 1122 A
(bytes)210 1524 A
1776(=)S
(\(phys_bytes\)\(data_clicks)1008 1860 A
2910(+)S
(gap_clicks)420 2994 A
3456(+)S
(stack_clicks\))546 3540 A
4128(<<)S
(CLICK_SHIFT;)504 4254 A
6615 V
(19059)210 1122 A
(base)168 1524 A
1734(=)S
(\(phys_bytes\))504 1818 A
(rmp->mp_seg[D].mem_phys)966 2364 A
3372(<<)S
(CLICK_SHIFT;)504 3498 A
6705 V
(19060)210 1122 A
(bss_offset)420 1524 A
1986(=)S
(\(data_bytes)462 2070 A
2574(>>)S
(CLICK_SHIFT\))504 2700 A
3246(<<)S
(CLICK_SHIFT;)504 3372 A
6795 V
(19061)210 1122 A
(base)168 1524 A
1734(+=)S
(bss_offset;)462 1860 A
6885 V
(19062)210 1122 A
(bytes)210 1524 A
1776(-=)S
(bss_offset;)462 1902 A
6975 V
(19063)210 1122 A
7065 V
(19064)210 1122 A
1524(if)S
(\(\(s=sys_memset\(0,)714 1650 A
(base,)210 2406 A
(bytes\)\))294 2658 A
2994(!=)S
(OK\))126 3120 A
3288({)S
8418 V
EP
%%Page: 254 254
BP
/slant 0 def
/height 0 def
1485 V
12 B
(254)180 1080 A
11 R
2363(File:)S
2596(servers/pm/exec.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(19065)210 1122 A
(panic\(__FILE__,"new_mem)966 1776 A
(can't)210 2784 A
(zero",)252 3036 A
(s\);)126 3330 A
1845 V
(19066)210 1122 A
1524(})S
1935 V
(19067)210 1122 A
2025 V
(19068)210 1122 A
(return\(OK\);)462 1524 A
2115 V
(19069)210 1122 A
1440(})S
2295 V
(19071)210 1122 A
(/*===========================================================================*)3276 1440 A
2385 V
(19072)210 1122 A
1482(*)S
(patch_ptr)378 2784 A
4674(*)S
2475 V
(19073)210 1122 A
(*===========================================================================*/)3276 1482 A
2565 V
(19074)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(patch_ptr\(stack,)672 1986 A
(base\))210 2700 A
2655 V
(19075)210 1122 A
(char)168 1440 A
(stack[ARG_MAX];)630 1650 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(stack)210 3372 A
(image)210 3624 A
(within)252 3876 A
4170(PM)S
4296(*/)S
2745 V
(19076)210 1122 A
(vir_bytes)378 1440 A
(base;)210 1860 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
3582(of)S
(stack)210 3708 A
(base)168 3960 A
(inside)252 4170 A
(user)168 4464 A
4674(*/)S
2835 V
(19077)210 1122 A
1440({)S
2925 V
(19078)210 1122 A
1440(/*)S
(When)168 1566 A
(doing)210 1776 A
2028(an)S
(exec\(name,)420 2154 A
(argv,)210 2616 A
(envp\))210 2868 A
(call,)210 3120 A
(the)126 3372 A
(user)168 3540 A
(builds)252 3750 A
4044(up)S
4170(a)S
(stack)210 4254 A
3015 V
(19079)210 1122 A
1482(*)S
(image)210 1566 A
(with)168 1818 A
(arg)126 2028 A
(and)126 2196 A
(env)126 2364 A
(pointers)336 2532 A
(relative)336 2910 A
3288(to)S
(the)126 3414 A
(start)210 3582 A
3834(of)S
(the)126 3960 A
(stack.)252 4128 A
(Now)126 4464 A
3105 V
(19080)210 1122 A
1482(*)S
(these)210 1566 A
(pointers)336 1818 A
(must)168 2196 A
2406(be)S
(relocated,)420 2532 A
(since)210 2994 A
(the)126 3246 A
(stack)210 3414 A
3666(is)S
(not)126 3792 A
(positioned)420 3960 A
4422(at)S
3195 V
(19081)210 1122 A
1482(*)S
(address)294 1566 A
1902(0)S
1986(in)S
(the)126 2112 A
(user's)252 2280 A
(address)294 2574 A
(space.)252 2910 A
3285 V
(19082)210 1122 A
1482(*/)S
3375 V
(19083)210 1122 A
3465 V
(19084)210 1122 A
(char)168 1524 A
(**ap,)210 1734 A
(flag;)210 1986 A
3555 V
(19085)210 1122 A
(vir_bytes)378 1524 A
1944(v;)S
3645 V
(19086)210 1122 A
3735 V
(19087)210 1122 A
(flag)168 1524 A
1734(=)S
1818(0;)S
2784(/*)S
(counts)252 2910 A
(number)252 3204 A
3498(of)S
(0-pointers)420 3624 A
(seen)168 4086 A
4296(*/)S
3825 V
(19088)210 1122 A
1524(ap)S
1650(=)S
(\(char)210 1734 A
(**\))126 1986 A
(stack;)252 2154 A
2784(/*)S
(points)252 2910 A
(initially)378 3204 A
3624(to)S
('nargs')294 3750 A
4086(*/)S
3915 V
(19089)210 1122 A
(ap++;)210 1524 A
2784(/*)S
(now)126 2910 A
(points)252 3078 A
3372(to)S
(argv[0])294 3498 A
3834(*/)S
4005 V
(19090)210 1122 A
(while)210 1524 A
(\(flag)210 1776 A
2028(<)S
2112(2\))S
2238({)S
4095 V
(19091)210 1122 A
1776(if)S
(\(ap)126 1902 A
2070(>=)S
(\(char)210 2196 A
(**\))126 2448 A
(&stack[ARG_MAX]\))672 2616 A
(return;)294 3330 A
3792(/*)S
(too)126 3918 A
(bad)126 4086 A
4254(*/)S
4185 V
(19092)210 1122 A
1776(if)S
(\(*ap)168 1902 A
2112(!=)S
(NULL\))210 2238 A
2490({)S
4275 V
(19093)210 1122 A
2112(v)S
2196(=)S
(\(vir_bytes\))462 2280 A
(*ap;)168 2784 A
3120(/*)S
3246(v)S
3330(is)S
(relative)336 3456 A
(pointer)294 3834 A
4170(*/)S
4365 V
(19094)210 1122 A
2112(v)S
2196(+=)S
(base;)210 2322 A
3120(/*)S
(relocate)336 3246 A
3624(it)S
3750(*/)S
4455 V
(19095)210 1122 A
(*ap)126 2112 A
2280(=)S
(\(char)210 2364 A
2616(*\))S
2742(v;)S
3120(/*)S
(put)126 3246 A
3414(it)S
(back)168 3540 A
3750(*/)S
4545 V
(19096)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
4635 V
(19097)210 1122 A
(flag++;)294 2112 A
4725 V
(19098)210 1122 A
1776(})S
4815 V
(19099)210 1122 A
(ap++;)210 1776 A
4905 V
(19100)210 1122 A
1524(})S
4995 V
(19101)210 1122 A
1440(})S
5175 V
(19103)210 1122 A
(/*===========================================================================*)3276 1440 A
5265 V
(19104)210 1122 A
1482(*)S
(insert_arg)420 2784 A
4674(*)S
5355 V
(19105)210 1122 A
(*===========================================================================*/)3276 1482 A
5445 V
(19106)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(insert_arg\(stack,)714 1944 A
(stk_bytes,)420 2700 A
(arg,)168 3162 A
(replace\))336 3372 A
5535 V
(19107)210 1122 A
(char)168 1440 A
(stack[ARG_MAX];)630 1650 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(stack)210 3372 A
(image)210 3624 A
(within)252 3876 A
4170(PM)S
4296(*/)S
5625 V
(19108)210 1122 A
(vir_bytes)378 1440 A
(*stk_bytes;)462 1860 A
2784(/*)S
(size)168 2910 A
3120(of)S
(initial)294 3246 A
(stack)210 3582 A
3834(*/)S
5715 V
(19109)210 1122 A
(char)168 1440 A
(*arg;)210 1650 A
2784(/*)S
(argument)336 2910 A
3288(to)S
(prepend/replace)630 3414 A
4086(as)S
(new)126 4212 A
(argv[0])294 4380 A
4716(*/)S
5805 V
(19110)210 1122 A
(int)126 1440 A
(replace;)336 1608 A
5895 V
(19111)210 1122 A
1440({)S
5985 V
(19112)210 1122 A
1440(/*)S
(Patch)210 1566 A
(the)126 1818 A
(stack)210 1986 A
2238(so)S
(that)168 2364 A
(arg)126 2574 A
(will)168 2742 A
(become)252 2952 A
(argv[0].)336 3246 A
3666(Be)S
(careful,)336 3792 A
(the)126 4170 A
(stack)210 4338 A
(may)126 4590 A
6075 V
(19113)210 1122 A
1482(*)S
1566(be)S
(filled)252 1692 A
(with)168 1986 A
(garbage,)336 2196 A
(although)336 2574 A
2952(it)S
(normally)336 3078 A
(looks)210 3456 A
(like)168 3708 A
(this:)210 3918 A
6165 V
(19114)210 1122 A
1482(*)S
(nargs)210 1776 A
(argv[0])294 2028 A
(...)126 2364 A
(argv[nargs-1])546 2532 A
(NULL)168 3120 A
(envp[0])294 3330 A
(...)126 3666 A
(NULL)168 3834 A
6255 V
(19115)210 1122 A
1482(*)S
(followed)336 1566 A
1944(by)S
(the)126 2070 A
(strings)294 2238 A
("pointed")378 2574 A
2994(to)S
3120(by)S
(the)126 3246 A
(argv[i])294 3414 A
(and)126 3750 A
(the)126 3918 A
(envp[i].)336 4086 A
(The)126 4506 A
6345 V
(19116)210 1122 A
1482(*)S
(pointers)336 1566 A
(are)126 1944 A
(really)252 2112 A
(offsets)294 2406 A
(from)168 2742 A
(the)126 2952 A
(start)210 3120 A
3372(of)S
(stack.)252 3498 A
6435 V
(19117)210 1122 A
1482(*)S
(Return)252 1566 A
(true)168 1860 A
(iff)126 2070 A
(the)126 2238 A
(operation)378 2406 A
(succeeded.)420 2826 A
6525 V
(19118)210 1122 A
1482(*/)S
6615 V
(19119)210 1122 A
(int)126 1524 A
(offset,)294 1692 A
(a0,)126 2028 A
(a1,)126 2196 A
(old_bytes)378 2364 A
2784(=)S
(*stk_bytes;)462 2868 A
6705 V
(19120)210 1122 A
6795 V
(19121)210 1122 A
1524(/*)S
(Prepending)420 1650 A
(arg)126 2112 A
(adds)168 2280 A
2490(at)S
(least)210 2616 A
(one)126 2868 A
(string)252 3036 A
(and)126 3330 A
3498(a)S
(zero)168 3582 A
(byte.)210 3792 A
4044(*/)S
6885 V
(19122)210 1122 A
(offset)252 1524 A
1818(=)S
(strlen\(arg\))462 1902 A
2406(+)S
2490(1;)S
6975 V
(19123)210 1122 A
7065 V
(19124)210 1122 A
1524(a0)S
1650(=)S
(\(int\))210 1734 A
(\(\(char)252 1986 A
(**\))126 2280 A
(stack\)[1];)420 2448 A
3120(/*)S
(argv[0])294 3246 A
3582(*/)S
8418 V
EP
%%Page: 255 255
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2363(File:)S
2596(servers/pm/exec.c)S
12 B
(255)180 4500 A
1755 V
7 LST
(19125)210 1122 A
1524(if)S
(\(a0)126 1650 A
1818(<)S
1902(4)S
1986(*)S
(PTRSIZE)294 2070 A
2406(||)S
2532(a0)S
2658(>=)S
(old_bytes\))420 2784 A
(return\(FALSE\);)588 3246 A
1845 V
(19126)210 1122 A
1935 V
(19127)210 1122 A
1524(a1)S
1650(=)S
(a0;)126 1734 A
2784(/*)S
2910(a1)S
(will)168 3036 A
(point)210 3246 A
3498(to)S
(the)126 3624 A
(strings)294 3792 A
4128(to)S
4254(be)S
(moved)210 4380 A
4632(*/)S
2025 V
(19128)210 1122 A
1524(if)S
(\(replace\))378 1650 A
2070({)S
2115 V
(19129)210 1122 A
1776(/*)S
(Move)168 1902 A
2112(a1)S
2238(to)S
(the)126 2364 A
(end)126 2532 A
2700(of)S
(argv[0][])378 2826 A
(\(argv[1])336 3246 A
3624(if)S
(nargs)210 3750 A
4002(>)S
(1\).)126 4086 A
4254(*/)S
2205 V
(19130)210 1122 A
1776(do)S
1902({)S
2295 V
(19131)210 1122 A
2112(if)S
(\(a1)126 2238 A
2406(==)S
(old_bytes\))420 2532 A
(return\(FALSE\);)588 2994 A
2385 V
(19132)210 1122 A
(--offset;)378 2112 A
2475 V
(19133)210 1122 A
1776(})S
(while)210 1860 A
(\(stack[a1++])504 2112 A
2658(!=)S
(0\);)126 2784 A
2565 V
(19134)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
2655 V
(19135)210 1122 A
(offset)252 1776 A
2070(+=)S
(PTRSIZE;)336 2196 A
2784(/*)S
(new)126 2910 A
(argv[0])294 3078 A
(needs)210 3414 A
(new)126 3666 A
(pointer)294 3834 A
4170(in)S
(argv[])252 4296 A
4590(*/)S
2745 V
(19136)210 1122 A
1776(a0)S
1902(+=)S
(PTRSIZE;)336 2028 A
2784(/*)S
(location)336 2910 A
3288(of)S
(new)126 3414 A
(argv[0][].)420 3582 A
4044(*/)S
2835 V
(19137)210 1122 A
1524(})S
2925 V
(19138)210 1122 A
3015 V
(19139)210 1122 A
1524(/*)S
(stack)210 1650 A
(will)168 1902 A
(grow)168 2112 A
2322(by)S
(offset)252 2448 A
(bytes)210 2742 A
(\(or)126 2994 A
(shrink)252 3162 A
3456(by)S
(-offset)294 3582 A
(bytes\))252 3918 A
4212(*/)S
3105 V
(19140)210 1122 A
1524(if)S
(\(\(*stk_bytes)504 1650 A
2196(+=)S
(offset\))294 2322 A
2658(>)S
(ARG_MAX\))336 2742 A
(return\(FALSE\);)588 3120 A
3195 V
(19141)210 1122 A
3285 V
(19142)210 1122 A
1524(/*)S
(Reposition)420 1650 A
(the)126 2112 A
(strings)294 2280 A
2616(by)S
(offset)252 2742 A
(bytes)210 3036 A
3288(*/)S
3375 V
(19143)210 1122 A
(memmove\(stack)546 1524 A
2112(+)S
2196(a1)S
2322(+)S
(offset,)294 2406 A
(stack)210 2742 A
2994(+)S
(a1,)126 3078 A
(old_bytes)378 3246 A
3666(-)S
(a1\);)168 3750 A
3465 V
(19144)210 1122 A
3555 V
(19145)210 1122 A
(strcpy\(stack)504 1524 A
2070(+)S
(a0,)126 2154 A
(arg\);)210 2322 A
2784(/*)S
(Put)126 2910 A
(arg)126 3078 A
3246(in)S
(the)126 3372 A
(new)126 3540 A
(space.)252 3708 A
4002(*/)S
3645 V
(19146)210 1122 A
3735 V
(19147)210 1122 A
1524(if)S
(\(!replace\))420 1650 A
2112({)S
3825 V
(19148)210 1122 A
1776(/*)S
(Make)168 1902 A
(space)210 2112 A
(for)126 2364 A
2532(a)S
(new)126 2616 A
(argv[0].)336 2784 A
3162(*/)S
3915 V
(19149)210 1122 A
(memmove\(stack)546 1776 A
2364(+)S
2448(2)S
2532(*)S
(PTRSIZE,)336 2616 A
(stack)210 2994 A
3246(+)S
3330(1)S
3414(*)S
(PTRSIZE,)336 3498 A
3876(a0)S
4002(-)S
4086(2)S
4170(*)S
(PTRSIZE\);)378 4254 A
4005 V
(19150)210 1122 A
4095 V
(19151)210 1122 A
(\(\(char)252 1776 A
(**\))126 2070 A
(stack\)[0]++;)504 2238 A
2784(/*)S
(nargs++;)336 2910 A
3288(*/)S
4185 V
(19152)210 1122 A
1524(})S
4275 V
(19153)210 1122 A
1524(/*)S
(Now)126 1650 A
(patch)210 1818 A
2070(up)S
(argv[])252 2196 A
(and)126 2490 A
(envp[])252 2658 A
2952(by)S
(offset.)294 3078 A
3414(*/)S
4365 V
(19154)210 1122 A
(patch_ptr\(stack,)672 1524 A
(\(vir_bytes\))462 2238 A
(offset\);)336 2742 A
4455 V
(19155)210 1122 A
(\(\(char)252 1524 A
(**\))126 1818 A
(stack\)[1])378 1986 A
2406(=)S
(\(char)210 2490 A
2742(*\))S
(a0;)126 2868 A
3120(/*)S
(set)126 3246 A
(argv[0])294 3414 A
(correctly)378 3750 A
4170(*/)S
4545 V
(19156)210 1122 A
(return\(TRUE\);)546 1524 A
4635 V
(19157)210 1122 A
1440(})S
4815 V
(19159)210 1122 A
(/*===========================================================================*)3276 1440 A
4905 V
(19160)210 1122 A
1482(*)S
(patch_stack)462 2784 A
4674(*)S
4995 V
(19161)210 1122 A
(*===========================================================================*/)3276 1482 A
5085 V
(19162)210 1122 A
(PRIVATE)294 1440 A
(char)168 1776 A
(*patch_stack\(fd,)672 1986 A
(stack,)252 2700 A
(stk_bytes,)420 2994 A
(script\))294 3456 A
5175 V
(19163)210 1122 A
(int)126 1440 A
(fd;)126 1608 A
2784(/*)S
(file)168 2910 A
(descriptor)420 3120 A
3582(to)S
(open)168 3708 A
(script)252 3918 A
(file)168 4212 A
4422(*/)S
5265 V
(19164)210 1122 A
(char)168 1440 A
(stack[ARG_MAX];)630 1650 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(stack)210 3372 A
(image)210 3624 A
(within)252 3876 A
4170(PM)S
4296(*/)S
5355 V
(19165)210 1122 A
(vir_bytes)378 1440 A
(*stk_bytes;)462 1860 A
2784(/*)S
(size)168 2910 A
3120(of)S
(initial)294 3246 A
(stack)210 3582 A
3834(*/)S
5445 V
(19166)210 1122 A
(char)168 1440 A
(*script;)336 1650 A
2784(/*)S
(name)168 2910 A
3120(of)S
(script)252 3246 A
3540(to)S
(interpret)378 3666 A
4086(*/)S
5535 V
(19167)210 1122 A
1440({)S
5625 V
(19168)210 1122 A
1440(/*)S
(Patch)210 1566 A
(the)126 1818 A
(argument)336 1986 A
(vector)252 2364 A
2658(to)S
(include)294 2784 A
(the)126 3120 A
(path)168 3288 A
(name)168 3498 A
3708(of)S
(the)126 3834 A
(script)252 4002 A
4296(to)S
4422(be)S
5715 V
(19169)210 1122 A
1482(*)S
(interpreted,)504 1566 A
(and)126 2112 A
(all)126 2280 A
(strings)294 2448 A
2784(on)S
(the)126 2910 A
3078(#!)S
(line.)210 3204 A
(Returns)294 3498 A
(the)126 3834 A
(path)168 4002 A
(name)168 4212 A
4422(of)S
5805 V
(19170)210 1122 A
1482(*)S
(the)126 1566 A
(interpreter.)504 1734 A
5895 V
(19171)210 1122 A
1482(*/)S
5985 V
(19172)210 1122 A
(char)168 1524 A
(*sp,)168 1734 A
(*interp)294 1944 A
2280(=)S
(NULL;)210 2364 A
6075 V
(19173)210 1122 A
(int)126 1524 A
1692(n;)S
6165 V
(19174)210 1122 A
(enum)168 1524 A
1734({)S
(INSERT=FALSE,)546 1818 A
(REPLACE=TRUE)504 2406 A
2952(};)S
6255 V
(19175)210 1122 A
6345 V
(19176)210 1122 A
1524(/*)S
(Make)168 1650 A
(script[])336 1860 A
(the)126 2238 A
(new)126 2406 A
(argv[0].)336 2574 A
2952(*/)S
6435 V
(19177)210 1122 A
1524(if)S
(\(!insert_arg\(stack,)798 1650 A
(stk_bytes,)420 2490 A
(script,)294 2952 A
(REPLACE\)\))378 3288 A
(return\(NULL\);)546 3708 A
6525 V
(19178)210 1122 A
6615 V
(19179)210 1122 A
1524(if)S
(\(lseek\(fd,)420 1650 A
(2L,)126 2112 A
2280(0\))S
2406(==)S
2532(-1)S
3456(/*)S
(just)168 3582 A
(behind)252 3792 A
(the)126 4086 A
4254(#!)S
4380(*/)S
6705 V
(19180)210 1122 A
1608(||)S
(\(n=)126 1734 A
(read\(fd,)336 1902 A
(script,)294 2280 A
(PATH_MAX\)\))420 2616 A
3078(<)S
3162(0)S
3456(/*)S
(read)168 3582 A
(line)168 3792 A
(one)126 4002 A
4170(*/)S
6795 V
(19181)210 1122 A
1608(||)S
(\(sp=)168 1734 A
(memchr\(script,)588 1944 A
('\\n',)210 2574 A
(n\)\))126 2826 A
2994(==)S
(NULL\))210 3120 A
3456(/*)S
(must)168 3582 A
3792(be)S
3918(a)S
(proper)252 4002 A
(line)168 4296 A
4506(*/)S
6885 V
(19182)210 1122 A
(return\(NULL\);)546 1776 A
6975 V
(19183)210 1122 A
7065 V
(19184)210 1122 A
1524(/*)S
(Move)168 1650 A
1860(sp)S
(backwards)378 1986 A
(through)294 2406 A
(script[],)378 2742 A
(prepending)420 3162 A
(each)168 3624 A
(string)252 3834 A
4128(to)S
(stack.)252 4254 A
4548(*/)S
8418 V
EP
%%Page: 256 256
BP
/slant 0 def
/height 0 def
1485 V
12 B
(256)180 1080 A
11 R
2363(File:)S
2596(servers/pm/exec.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(19185)210 1122 A
(for)126 1524 A
(\(;;\))168 1692 A
1902({)S
1845 V
(19186)210 1122 A
1776(/*)S
(skip)168 1902 A
(spaces)252 2112 A
(behind)252 2406 A
(argument.)378 2700 A
3120(*/)S
1935 V
(19187)210 1122 A
(while)210 1776 A
(\(sp)126 2028 A
2196(>)S
(script)252 2280 A
2574(&&)S
(\(*--sp)252 2700 A
2994(==)S
3120(')S
3204(')S
3288(||)S
(*sp)126 3414 A
3582(==)S
('\\t'\)\))252 3708 A
4002({})S
2025 V
(19188)210 1122 A
1776(if)S
(\(sp)126 1902 A
2070(==)S
(script\))294 2196 A
(break;)252 2532 A
2115 V
(19189)210 1122 A
2205 V
(19190)210 1122 A
(sp[1])210 1776 A
2028(=)S
2112(0;)S
2295 V
(19191)210 1122 A
1776(/*)S
(Move)168 1902 A
2112(to)S
(the)126 2238 A
(start)210 2406 A
2658(of)S
(the)126 2784 A
(argument.)378 2952 A
3372(*/)S
2385 V
(19192)210 1122 A
(while)210 1776 A
(\(sp)126 2028 A
2196(>)S
(script)252 2280 A
2574(&&)S
(sp[-1])252 2700 A
2994(!=)S
3120(')S
3204(')S
3288(&&)S
(sp[-1])252 3414 A
3708(!=)S
('\\t'\))210 3834 A
(--sp;)210 4086 A
2475 V
(19193)210 1122 A
2565 V
(19194)210 1122 A
(interp)252 1776 A
2070(=)S
(sp;)126 2154 A
2655 V
(19195)210 1122 A
1776(if)S
(\(!insert_arg\(stack,)798 1902 A
(stk_bytes,)420 2742 A
(sp,)126 3204 A
(INSERT\)\))336 3372 A
(return\(NULL\);)546 3750 A
2745 V
(19196)210 1122 A
1524(})S
2835 V
(19197)210 1122 A
2925 V
(19198)210 1122 A
1524(/*)S
(Round)210 1650 A
(*stk_bytes)420 1902 A
2364(up)S
2490(to)S
(the)126 2616 A
(size)168 2784 A
2994(of)S
3120(a)S
(pointer)294 3204 A
(for)126 3540 A
(alignment)378 3708 A
(contraints.)462 4128 A
4632(*/)S
3015 V
(19199)210 1122 A
(*stk_bytes=)462 1524 A
(\(\(*stk_bytes)504 2028 A
2574(+)S
(PTRSIZE)294 2658 A
2994(-)S
3078(1\))S
3204(/)S
(PTRSIZE\))336 3288 A
3666(*)S
(PTRSIZE;)336 3750 A
3105 V
(19200)210 1122 A
3195 V
(19201)210 1122 A
(close\(fd\);)420 1524 A
3285 V
(19202)210 1122 A
(return\(interp\);)630 1524 A
3375 V
(19203)210 1122 A
1440(})S
3555 V
(19205)210 1122 A
(/*===========================================================================*)3276 1440 A
3645 V
(19206)210 1122 A
1482(*)S
(rw_seg)252 2784 A
4674(*)S
3735 V
(19207)210 1122 A
(*===========================================================================*/)3276 1482 A
3825 V
(19208)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(rw_seg\(rw,)420 1944 A
(fd,)126 2406 A
(proc,)210 2574 A
(seg,)168 2826 A
(seg_bytes0\))462 3036 A
3915 V
(19209)210 1122 A
(int)126 1440 A
(rw;)126 1608 A
2784(/*)S
2910(0)S
2994(=)S
(read,)210 3078 A
3330(1)S
3414(=)S
(write)210 3498 A
3750(*/)S
4005 V
(19210)210 1122 A
(int)126 1440 A
(fd;)126 1608 A
2784(/*)S
(file)168 2910 A
(descriptor)420 3120 A
3582(to)S
(read)168 3708 A
(from)168 3918 A
4128(/)S
(write)210 4212 A
4464(to)S
4590(*/)S
4095 V
(19211)210 1122 A
(int)126 1440 A
(proc;)210 1608 A
2784(/*)S
(process)294 2910 A
(number)252 3246 A
3540(*/)S
4185 V
(19212)210 1122 A
(int)126 1440 A
(seg;)168 1608 A
2784(/*)S
2910(T,)S
3036(D,)S
3162(or)S
3288(S)S
3372(*/)S
4275 V
(19213)210 1122 A
(phys_bytes)420 1440 A
(seg_bytes0;)462 1902 A
2784(/*)S
(how)126 2910 A
(much)168 3078 A
3288(is)S
3414(to)S
3540(be)S
(transferred?)504 3666 A
4212(*/)S
4365 V
(19214)210 1122 A
1440({)S
4455 V
(19215)210 1122 A
1440(/*)S
(Transfer)336 1566 A
(text)168 1944 A
2154(or)S
(data)168 2280 A
(from/to)294 2490 A
2826(a)S
(file)168 2910 A
(and)126 3120 A
(copy)168 3288 A
(to/from)294 3498 A
3834(a)S
(process)294 3918 A
(segment.)336 4254 A
4545 V
(19216)210 1122 A
1482(*)S
(This)168 1566 A
(procedure)378 1776 A
2196(is)S
2322(a)S
(little)252 2406 A
(bit)126 2700 A
(tricky.)294 2868 A
(The)126 3246 A
(logical)294 3414 A
(way)126 3750 A
3918(to)S
(transfer)336 4044 A
4422(a)S
4635 V
(19217)210 1122 A
1482(*)S
(segment)294 1566 A
(would)210 1902 A
2154(be)S
(block)210 2280 A
2532(by)S
(block)210 2658 A
(and)126 2910 A
(copying)294 3078 A
(each)168 3414 A
(block)210 3624 A
(to/from)294 3876 A
(the)126 4212 A
(user)168 4380 A
4725 V
(19218)210 1122 A
1482(*)S
(space)210 1566 A
(one)126 1818 A
1986(at)S
2112(a)S
(time.)210 2196 A
(This)168 2490 A
2700(is)S
(too)126 2826 A
(slow,)210 2994 A
3246(so)S
3372(we)S
3498(do)S
(something)378 3624 A
(dirty)210 4044 A
(here,)210 4296 A
4815 V
(19219)210 1122 A
1482(*)S
(namely)252 1566 A
(send)168 1860 A
(the)126 2070 A
(user)168 2238 A
(space)210 2448 A
(and)126 2700 A
(virtual)294 2868 A
(address)294 3204 A
3540(to)S
(the)126 3666 A
(file)168 3834 A
(system)252 4044 A
4338(in)S
(the)126 4464 A
4905 V
(19220)210 1122 A
1482(*)S
(upper)210 1566 A
1818(10)S
(bits)168 1944 A
2154(of)S
(the)126 2280 A
(file)168 2448 A
(descriptor,)462 2658 A
(and)126 3162 A
(pass)168 3330 A
3540(it)S
(the)126 3666 A
(user)168 3834 A
(virtual)294 4044 A
(address)294 4380 A
4995 V
(19221)210 1122 A
1482(*)S
(instead)294 1566 A
1902(of)S
2028(a)S
2112(PM)S
(address.)336 2238 A
(The)126 2658 A
(file)168 2826 A
(system)252 3036 A
(extracts)336 3330 A
(these)210 3708 A
(parameters)420 3960 A
(when)168 4422 A
5085 V
(19222)210 1122 A
1482(*)S
(gets)168 1566 A
1776(a)S
(read)168 1860 A
2070(or)S
(write)210 2196 A
(call)168 2448 A
(from)168 2658 A
(the)126 2868 A
(process)294 3036 A
(manager,)336 3372 A
(which)210 3750 A
4002(is)S
(the)126 4128 A
(only)168 4296 A
5175 V
(19223)210 1122 A
1482(*)S
(process)294 1566 A
(that)168 1902 A
2112(is)S
(permitted)378 2238 A
2658(to)S
(use)126 2784 A
(this)168 2952 A
(trick.)252 3162 A
(The)126 3498 A
(file)168 3666 A
(system)252 3876 A
(then)168 4170 A
(copies)252 4380 A
5265 V
(19224)210 1122 A
1482(*)S
(the)126 1566 A
(whole)210 1734 A
(segment)294 1986 A
(directly)336 2322 A
(to/from)294 2700 A
(user)168 3036 A
(space,)252 3246 A
(bypassing)378 3540 A
3960(PM)S
(completely.)462 4086 A
5355 V
(19225)210 1122 A
1482(*)S
5445 V
(19226)210 1122 A
1482(*)S
(The)126 1566 A
(byte)168 1734 A
(count)210 1944 A
2196(on)S
(read)168 2322 A
2532(is)S
(usually)294 2658 A
(smaller)294 2994 A
(than)168 3330 A
(the)126 3540 A
(segment)294 3708 A
(count,)252 4044 A
(because)294 4338 A
5535 V
(19227)210 1122 A
1482(*)S
1566(a)S
(segment)294 1650 A
1986(is)S
(padded)252 2112 A
(out)126 2406 A
2574(to)S
2700(a)S
(click)210 2784 A
(multiple,)378 3036 A
(and)126 3456 A
(the)126 3624 A
(data)168 3792 A
(segment)294 4002 A
4338(is)S
(only)168 4464 A
5625 V
(19228)210 1122 A
1482(*)S
(partially)378 1566 A
(initialized.)504 1986 A
5715 V
(19229)210 1122 A
1482(*/)S
5805 V
(19230)210 1122 A
5895 V
(19231)210 1122 A
(int)126 1524 A
(new_fd,)294 1692 A
(bytes,)252 2028 A
2322(r;)S
5985 V
(19232)210 1122 A
(char)168 1524 A
(*ubuf_ptr;)420 1734 A
6075 V
(19233)210 1122 A
(struct)252 1524 A
(mem_map)294 1818 A
(*sp)126 2154 A
2322(=)S
(&mproc[proc].mp_seg[seg];)1050 2406 A
6165 V
(19234)210 1122 A
(phys_bytes)420 1524 A
(seg_bytes)378 1986 A
2406(=)S
(seg_bytes0;)462 2490 A
6255 V
(19235)210 1122 A
6345 V
(19236)210 1122 A
(new_fd)252 1524 A
1818(=)S
(\(proc)210 1902 A
2154(<<)S
2280(7\))S
2406(|)S
(\(seg)168 2490 A
2700(<<)S
2826(5\))S
2952(|)S
(fd;)126 3036 A
6435 V
(19237)210 1122 A
(ubuf_ptr)336 1524 A
1902(=)S
(\(char)210 1986 A
2238(*\))S
(\(\(vir_bytes\))504 2364 A
(sp->mem_vir)462 2910 A
3414(<<)S
(CLICK_SHIFT\);)546 3540 A
6525 V
(19238)210 1122 A
6615 V
(19239)210 1122 A
(while)210 1524 A
(\(seg_bytes)420 1776 A
2238(!=)S
2364(0\))S
2490({)S
6705 V
(19240)210 1122 A
(#define)294 1440 A
(PM_CHUNK_SIZE)546 1776 A
(8192)168 2364 A
6795 V
(19241)210 1122 A
(bytes)210 1776 A
2028(=)S
(MIN\(\(INT_MAX)504 2112 A
2658(/)S
(PM_CHUNK_SIZE\))588 2742 A
3372(*)S
(PM_CHUNK_SIZE,)588 3456 A
(seg_bytes\);)462 4086 A
6885 V
(19242)210 1122 A
1776(if)S
(\(rw)126 1902 A
2070(==)S
2196(0\))S
2322({)S
6975 V
(19243)210 1122 A
2112(r)S
2196(=)S
(read\(new_fd,)504 2280 A
(ubuf_ptr,)378 2826 A
(bytes\);)294 3246 A
7065 V
(19244)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
8418 V
EP
%%Page: 257 257
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2363(File:)S
2596(servers/pm/exec.c)S
12 B
(257)180 4500 A
1755 V
7 LST
(19245)210 1122 A
2112(r)S
2196(=)S
(write\(new_fd,)546 2280 A
(ubuf_ptr,)378 2868 A
(bytes\);)294 3288 A
1845 V
(19246)210 1122 A
1776(})S
1935 V
(19247)210 1122 A
1776(if)S
1902(\(r)S
2028(!=)S
(bytes\))252 2154 A
(break;)252 2448 A
2025 V
(19248)210 1122 A
(ubuf_ptr)336 1776 A
2154(+=)S
(bytes;)252 2280 A
2115 V
(19249)210 1122 A
(seg_bytes)378 1776 A
2196(-=)S
(bytes;)252 2322 A
2205 V
(19250)210 1122 A
1524(})S
2295 V
(19251)210 1122 A
1440(})S
2475 V
(19253)210 1122 A
(/*===========================================================================*)3276 1440 A
2565 V
(19254)210 1122 A
1482(*)S
(find_share)420 2784 A
4674(*)S
2655 V
(19255)210 1122 A
(*===========================================================================*/)3276 1482 A
2745 V
(19256)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(mproc)210 2028 A
(*find_share\(mp_ign,)798 2280 A
(ino,)168 3120 A
(dev,)168 3330 A
(ctime\))252 3540 A
2835 V
(19257)210 1122 A
(struct)252 1440 A
(mproc)210 1734 A
(*mp_ign;)336 1986 A
2784(/*)S
(process)294 2910 A
(that)168 3246 A
(should)252 3456 A
(not)126 3750 A
3918(be)S
(looked)252 4044 A
4338(at)S
4464(*/)S
2925 V
(19258)210 1122 A
(ino_t)210 1440 A
(ino;)168 1692 A
2784(/*)S
(parameters)420 2910 A
(that)168 3372 A
(uniquely)336 3582 A
(identify)336 3960 A
4338(a)S
(file)168 4422 A
4632(*/)S
3015 V
(19259)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
3105 V
(19260)210 1122 A
(time_t)252 1440 A
(ctime;)252 1734 A
3195 V
(19261)210 1122 A
1440({)S
3285 V
(19262)210 1122 A
1440(/*)S
(Look)168 1566 A
(for)126 1776 A
1944(a)S
(process)294 2028 A
(that)168 2364 A
2574(is)S
(the)126 2700 A
(file)168 2868 A
(<ino,)210 3078 A
(dev,)168 3330 A
(ctime>)252 3540 A
3834(in)S
(execution.)420 3960 A
(Don't)210 4464 A
3375 V
(19263)210 1122 A
1482(*)S
(accidentally)504 1566 A
("find")252 2112 A
(mp_ign,)294 2406 A
(because)294 2742 A
3078(it)S
3204(is)S
(the)126 3330 A
(process)294 3498 A
3834(on)S
(whose)210 3960 A
(behalf)252 4212 A
(this)168 4506 A
3465 V
(19264)210 1122 A
1482(*)S
(call)168 1566 A
1776(is)S
(made.)210 1902 A
3555 V
(19265)210 1122 A
1482(*/)S
3645 V
(19266)210 1122 A
(struct)252 1524 A
(mproc)210 1818 A
(*sh_mp;)294 2070 A
3735 V
(19267)210 1122 A
(for)126 1524 A
(\(sh_mp)252 1692 A
1986(=)S
(&mproc[0];)420 2070 A
(sh_mp)210 2532 A
2784(<)S
(&mproc[NR_PROCS];)714 2868 A
(sh_mp++\))336 3624 A
4002({)S
3825 V
(19268)210 1122 A
3915 V
(19269)210 1122 A
1776(if)S
(\(!\(sh_mp->mp_flags)756 1902 A
2700(&)S
(SEPARATE\)\))420 2784 A
(continue;)378 3246 A
4005 V
(19270)210 1122 A
1776(if)S
(\(sh_mp)252 1902 A
2196(==)S
(mp_ign\))294 2322 A
(continue;)378 2658 A
4095 V
(19271)210 1122 A
1776(if)S
(\(sh_mp->mp_ino)588 1902 A
2532(!=)S
(ino\))168 2658 A
(continue;)378 2868 A
4185 V
(19272)210 1122 A
1776(if)S
(\(sh_mp->mp_dev)588 1902 A
2532(!=)S
(dev\))168 2658 A
(continue;)378 2868 A
4275 V
(19273)210 1122 A
1776(if)S
(\(sh_mp->mp_ctime)672 1902 A
2616(!=)S
(ctime\))252 2742 A
(continue;)378 3036 A
4365 V
(19274)210 1122 A
(return)252 1776 A
(sh_mp;)252 2070 A
4455 V
(19275)210 1122 A
1524(})S
4545 V
(19276)210 1122 A
(return\(NULL\);)546 1524 A
4635 V
(19277)210 1122 A
1440(})S
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(servers/pm/break.c)756 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(19300)210 1122 A
1440(/*)S
(The)126 1566 A
(MINIX)210 1734 A
(model)210 1986 A
2238(of)S
(memory)252 2364 A
(allocation)420 2658 A
(reserves)336 3120 A
3498(a)S
(fixed)210 3582 A
(amount)252 3834 A
4128(of)S
(memory)252 4254 A
(for)126 4548 A
5445 V
(19301)210 1122 A
1482(*)S
(the)126 1566 A
(combined)336 1734 A
(text,)210 2112 A
(data,)210 2364 A
(and)126 2616 A
(stack)210 2784 A
(segments.)378 3036 A
(The)126 3498 A
(amount)252 3666 A
(used)168 3960 A
(for)126 4170 A
4338(a)S
(child)210 4422 A
5535 V
(19302)210 1122 A
1482(*)S
(process)294 1566 A
(created)294 1902 A
2238(by)S
(FORK)168 2364 A
2574(is)S
(the)126 2700 A
(same)168 2868 A
3078(as)S
(the)126 3204 A
(parent)252 3372 A
(had.)168 3666 A
3918(If)S
(the)126 4044 A
(child)210 4212 A
(does)168 4464 A
5625 V
(19303)210 1122 A
1482(*)S
1566(an)S
(EXEC)168 1692 A
(later,)252 1902 A
(the)126 2196 A
(new)126 2364 A
(size)168 2532 A
2742(is)S
(taken)210 2868 A
(from)168 3120 A
(the)126 3330 A
(header)252 3498 A
3792(of)S
(the)126 3918 A
(file)168 4086 A
(EXEC'ed.)336 4296 A
5715 V
(19304)210 1122 A
1482(*)S
5805 V
(19305)210 1122 A
1482(*)S
(The)126 1566 A
(layout)252 1734 A
2028(in)S
(memory)252 2154 A
(consists)336 2448 A
2826(of)S
(the)126 2952 A
(text)168 3120 A
(segment,)336 3330 A
(followed)336 3708 A
4086(by)S
(the)126 4212 A
(data)168 4380 A
5895 V
(19306)210 1122 A
1482(*)S
(segment,)336 1566 A
(followed)336 1944 A
2322(by)S
2448(a)S
(gap)126 2532 A
(\(unused)294 2700 A
(memory\),)336 3036 A
(followed)336 3414 A
3792(by)S
(the)126 3918 A
(stack)210 4086 A
(segment.)336 4338 A
5985 V
(19307)210 1122 A
1482(*)S
(The)126 1566 A
(data)168 1734 A
(segment)294 1944 A
(grows)210 2280 A
(upward)252 2532 A
(and)126 2826 A
(the)126 2994 A
(stack)210 3162 A
(grows)210 3414 A
(downward,)378 3666 A
4086(so)S
(each)168 4212 A
(can)126 4422 A
6075 V
(19308)210 1122 A
1482(*)S
(take)168 1566 A
(memory)252 1776 A
(from)168 2070 A
(the)126 2280 A
(gap.)168 2448 A
2700(If)S
(they)168 2826 A
(meet,)210 3036 A
(the)126 3288 A
(process)294 3456 A
(must)168 3792 A
4002(be)S
(killed.)294 4128 A
(The)126 4506 A
6165 V
(19309)210 1122 A
1482(*)S
(procedures)420 1566 A
2028(in)S
(this)168 2154 A
(file)168 2364 A
(deal)168 2574 A
(with)168 2784 A
(the)126 2994 A
(growth)252 3162 A
3456(of)S
(the)126 3582 A
(data)168 3750 A
(and)126 3960 A
(stack)210 4128 A
(segments.)378 4380 A
6255 V
(19310)210 1122 A
1482(*)S
6345 V
(19311)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are:)168 2910 A
6435 V
(19312)210 1122 A
1482(*)S
(do_brk:)294 1650 A
(BRK/SBRK)336 2196 A
(system)252 2574 A
(calls)210 2868 A
3120(to)S
(grow)168 3246 A
3456(or)S
(shrink)252 3582 A
(the)126 3876 A
(data)168 4044 A
(segment)294 4254 A
6525 V
(19313)210 1122 A
1482(*)S
(adjust:)294 1650 A
(see)126 2196 A
2364(if)S
2490(a)S
(proposed)336 2574 A
(segment)294 2952 A
(adjustment)420 3288 A
3750(is)S
(allowed)294 3876 A
6615 V
(19314)210 1122 A
1482(*)S
(size_ok:)336 1650 A
(see)126 2196 A
2364(if)S
(the)126 2490 A
(segment)294 2658 A
(sizes)210 2994 A
(are)126 3246 A
(feasible)336 3414 A
6705 V
(19315)210 1122 A
1482(*/)S
6795 V
(19316)210 1122 A
6885 V
(19317)210 1122 A
(#include)336 1440 A
("pm.h")252 1818 A
6975 V
(19318)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
7065 V
(19319)210 1122 A
(#include)336 1440 A
("mproc.h")378 1818 A
8418 V
EP
%%Page: 258 258
BP
/slant 0 def
/height 0 def
1485 V
12 B
(258)180 1080 A
11 R
2342(File:)S
2575(servers/pm/break.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(19320)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
1845 V
(19321)210 1122 A
1935 V
(19322)210 1122 A
(#define)294 1440 A
(DATA_CHANGED)504 1776 A
2574(1)S
2784(/*)S
(flag)168 2910 A
(value)210 3120 A
(when)168 3372 A
(data)168 3582 A
(segment)294 3792 A
(size)168 4128 A
(changed)294 4338 A
4674(*/)S
2025 V
(19323)210 1122 A
(#define)294 1440 A
(STACK_CHANGED)546 1776 A
2574(2)S
2784(/*)S
(flag)168 2910 A
(value)210 3120 A
(when)168 3372 A
(stack)210 3582 A
(size)168 3834 A
(changed)294 4044 A
4380(*/)S
2115 V
(19324)210 1122 A
2205 V
(19325)210 1122 A
(/*===========================================================================*)3276 1440 A
2295 V
(19326)210 1122 A
1482(*)S
(do_brk)252 2784 A
4674(*)S
2385 V
(19327)210 1122 A
(*===========================================================================*/)3276 1482 A
2475 V
(19328)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_brk\(\))336 1902 A
2565 V
(19329)210 1122 A
1440({)S
2655 V
(19330)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(brk\(addr\))378 2070 A
(system)252 2490 A
(call.)210 2784 A
2745 V
(19331)210 1122 A
1482(*)S
2835 V
(19332)210 1122 A
1482(*)S
(The)126 1566 A
(call)168 1734 A
1944(is)S
(complicated)462 2070 A
2574(by)S
(the)126 2700 A
(fact)168 2868 A
(that)168 3078 A
3288(on)S
(some)168 3414 A
(machines)336 3624 A
(\(e.g.,)252 4002 A
(8088\),)252 4296 A
2925 V
(19333)210 1122 A
1482(*)S
(the)126 1566 A
(stack)210 1734 A
(pointer)294 1986 A
(can)126 2322 A
(grow)168 2490 A
(beyond)252 2700 A
(the)126 2994 A
(base)168 3162 A
3372(of)S
(the)126 3498 A
(stack)210 3666 A
(segment)294 3918 A
(without)294 4254 A
3015 V
(19334)210 1122 A
1482(*)S
(anybody)294 1566 A
(noticing)336 1902 A
(it.)126 2280 A
3105 V
(19335)210 1122 A
1482(*)S
(The)126 1566 A
(parameter,)420 1734 A
('addr')252 2196 A
2490(is)S
(the)126 2616 A
(new)126 2784 A
(virtual)294 2952 A
(address)294 3288 A
3624(in)S
3750(D)S
(space.)252 3834 A
3195 V
(19336)210 1122 A
1482(*/)S
3285 V
(19337)210 1122 A
3375 V
(19338)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rmp;)210 2448 A
3465 V
(19339)210 1122 A
(int)126 1524 A
1692(r;)S
3555 V
(19340)210 1122 A
(vir_bytes)378 1524 A
1944(v,)S
(new_sp;)294 2070 A
3645 V
(19341)210 1122 A
(vir_clicks)420 1524 A
(new_clicks;)462 1986 A
3735 V
(19342)210 1122 A
3825 V
(19343)210 1122 A
(rmp)126 1524 A
1692(=)S
(mp;)126 1776 A
3915 V
(19344)210 1122 A
1524(v)S
1608(=)S
(\(vir_bytes\))462 1692 A
(m_in.addr;)420 2196 A
4005 V
(19345)210 1122 A
(new_clicks)420 1524 A
1986(=)S
(\(vir_clicks\))504 2070 A
2616(\()S
(\(\(long\))294 2700 A
3036(v)S
3120(+)S
(CLICK_SIZE)420 3204 A
3666(-)S
3750(1\))S
3876(>>)S
(CLICK_SHIFT\);)546 4002 A
4095 V
(19346)210 1122 A
1524(if)S
(\(new_clicks)462 1650 A
2154(<)S
(rmp->mp_seg[D].mem_vir\))966 2238 A
3246({)S
4185 V
(19347)210 1122 A
(rmp->mp_reply.reply_ptr)966 1776 A
2784(=)S
(\(char)210 2868 A
3120(*\))S
(-1;)126 3246 A
4275 V
(19348)210 1122 A
(return\(ENOMEM\);)630 1776 A
4365 V
(19349)210 1122 A
1524(})S
4455 V
(19350)210 1122 A
(new_clicks)420 1524 A
1986(-=)S
(rmp->mp_seg[D].mem_vir;)966 2112 A
4545 V
(19351)210 1122 A
1524(if)S
(\(\(r=get_stack_ptr\(who,)924 1650 A
(&new_sp\)\))378 2616 A
3036(!=)S
(OK\))126 3162 A
3456(/*)S
(ask)126 3582 A
(kernel)252 3750 A
(for)126 4044 A
4212(sp)S
(value)210 4338 A
4590(*/)S
4635 V
(19352)210 1122 A
(panic\(__FILE__,"couldn't)1008 1776 A
(get)126 2826 A
(stack)210 2994 A
(pointer",)378 3246 A
(r\);)126 3666 A
4725 V
(19353)210 1122 A
1524(r)S
1608(=)S
(adjust\(rmp,)462 1692 A
(new_clicks,)462 2196 A
(new_sp\);)336 2700 A
4815 V
(19354)210 1122 A
(rmp->mp_reply.reply_ptr)966 1524 A
2532(=)S
2616(\(r)S
2742(==)S
2868(OK)S
2994(?)S
(m_in.addr)378 3078 A
3498(:)S
(\(char)210 3582 A
3834(*\))S
(-1\);)168 3960 A
4905 V
(19355)210 1122 A
(return\(r\);)420 1524 A
2784(/*)S
(return)252 2910 A
(new)126 3204 A
(address)294 3372 A
3708(or)S
3834(-1)S
3960(*/)S
4995 V
(19356)210 1122 A
1440(})S
5175 V
(19358)210 1122 A
(/*===========================================================================*)3276 1440 A
5265 V
(19359)210 1122 A
1482(*)S
(adjust)252 2784 A
4674(*)S
5355 V
(19360)210 1122 A
(*===========================================================================*/)3276 1482 A
5445 V
(19361)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(adjust\(rmp,)462 1902 A
(data_clicks,)504 2406 A
(sp\))126 2952 A
5535 V
(19362)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(mproc)210 2112 A
(*rmp;)210 2364 A
2784(/*)S
(whose)210 2910 A
(memory)252 3162 A
3456(is)S
(being)210 3582 A
(adjusted?)378 3834 A
4254(*/)S
5625 V
(19363)210 1122 A
(vir_clicks)420 1440 A
(data_clicks;)504 1902 A
2784(/*)S
(how)126 2910 A
(big)126 3078 A
3246(is)S
(data)168 3372 A
(segment)294 3582 A
3918(to)S
(become?)294 4044 A
4380(*/)S
5715 V
(19364)210 1122 A
(vir_bytes)378 1440 A
(sp;)126 1860 A
2784(/*)S
(new)126 2910 A
(value)210 3078 A
3330(of)S
3456(sp)S
3582(*/)S
5805 V
(19365)210 1122 A
1440({)S
5895 V
(19366)210 1122 A
1440(/*)S
(See)126 1566 A
1734(if)S
(data)168 1860 A
(and)126 2070 A
(stack)210 2238 A
(segments)336 2490 A
(can)126 2868 A
(coexist,)336 3036 A
(adjusting)378 3414 A
(them)168 3834 A
4044(if)S
(need)168 4170 A
(be.)126 4380 A
5985 V
(19367)210 1122 A
1482(*)S
(Memory)252 1566 A
1860(is)S
(never)210 1986 A
(allocated)378 2238 A
2658(or)S
(freed.)252 2784 A
(Instead)294 3120 A
3456(it)S
3582(is)S
(added)210 3708 A
3960(or)S
(removed)294 4086 A
(from)168 4422 A
(the)126 4632 A
6075 V
(19368)210 1122 A
1482(*)S
(gap)126 1566 A
(between)294 1734 A
(data)168 2070 A
(segment)294 2280 A
(and)126 2616 A
(stack)210 2784 A
(segment.)336 3036 A
3456(If)S
(the)126 3582 A
(gap)126 3750 A
(size)168 3918 A
(becomes)294 4128 A
6165 V
(19369)210 1122 A
1482(*)S
(negative,)378 1566 A
(the)126 1986 A
(adjustment)420 2154 A
2616(of)S
(data)168 2742 A
2952(or)S
(stack)210 3078 A
(fails)210 3330 A
(and)126 3582 A
(ENOMEM)252 3750 A
4044(is)S
(returned.)378 4170 A
6255 V
(19370)210 1122 A
1482(*/)S
6345 V
(19371)210 1122 A
6435 V
(19372)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mem_map)294 2196 A
(*mem_sp,)336 2532 A
(*mem_dp;)336 2910 A
6525 V
(19373)210 1122 A
(vir_clicks)420 1524 A
(sp_click,)378 1986 A
(gap_base,)378 2406 A
(lower,)252 2826 A
(old_clicks;)462 3120 A
6615 V
(19374)210 1122 A
(int)126 1524 A
(changed,)336 1692 A
2070(r,)S
(ft;)126 2196 A
6705 V
(19375)210 1122 A
(long)168 1524 A
(base_of_stack,)588 1734 A
(delta;)252 2364 A
2784(/*)S
(longs)210 2910 A
(avoid)210 3162 A
(certain)294 3414 A
(problems)336 3750 A
4128(*/)S
6795 V
(19376)210 1122 A
6885 V
(19377)210 1122 A
(mem_dp)252 1524 A
1818(=)S
(&rmp->mp_seg[D];)672 1902 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(data)168 3372 A
(segment)294 3582 A
(map)126 3918 A
4086(*/)S
6975 V
(19378)210 1122 A
(mem_sp)252 1524 A
1818(=)S
(&rmp->mp_seg[S];)672 1902 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(stack)210 3372 A
(segment)294 3624 A
(map)126 3960 A
4128(*/)S
7065 V
(19379)210 1122 A
(changed)294 1524 A
1860(=)S
1944(0;)S
2784(/*)S
(set)126 2910 A
(when)168 3078 A
(either)252 3288 A
(segment)294 3582 A
(changed)294 3918 A
4254(*/)S
8418 V
EP
%%Page: 259 259
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2342(File:)S
2575(servers/pm/break.c)S
12 B
(259)180 4500 A
1755 V
7 LST
(19380)210 1122 A
1845 V
(19381)210 1122 A
1524(if)S
(\(mem_sp->mem_len)672 1650 A
2364(==)S
2490(0\))S
(return\(OK\);)462 2616 A
3120(/*)S
(don't)210 3246 A
(bother)252 3498 A
(init)168 3792 A
4002(*/)S
1935 V
(19382)210 1122 A
2025 V
(19383)210 1122 A
1524(/*)S
(See)126 1650 A
1818(if)S
(stack)210 1944 A
(size)168 2196 A
(has)126 2406 A
(gone)168 2574 A
(negative)336 2784 A
(\(i.e.,)252 3162 A
3456(sp)S
(too)126 3582 A
(close)210 3750 A
4002(to)S
(0xFFFF...\))420 4128 A
4590(*/)S
2115 V
(19384)210 1122 A
(base_of_stack)546 1524 A
2112(=)S
(\(long\))252 2196 A
(mem_sp->mem_vir)630 2490 A
3162(+)S
(\(long\))252 3246 A
(mem_sp->mem_len;)672 3540 A
2205 V
(19385)210 1122 A
(sp_click)336 1524 A
1902(=)S
1986(sp)S
2112(>>)S
(CLICK_SHIFT;)504 2238 A
2784(/*)S
(click)210 2910 A
(containing)420 3162 A
3624(sp)S
3750(*/)S
2295 V
(19386)210 1122 A
1524(if)S
(\(sp_click)378 1650 A
2070(>=)S
(base_of_stack\))588 2196 A
(return\(ENOMEM\);)630 2826 A
3792(/*)S
3918(sp)S
(too)126 4044 A
(high)168 4212 A
4422(*/)S
2385 V
(19387)210 1122 A
2475 V
(19388)210 1122 A
1524(/*)S
(Compute)294 1650 A
(size)168 1986 A
2196(of)S
(gap)126 2322 A
(between)294 2490 A
(stack)210 2826 A
(and)126 3078 A
(data)168 3246 A
(segments.)378 3456 A
3876(*/)S
2565 V
(19389)210 1122 A
(delta)210 1524 A
1776(=)S
(\(long\))252 1860 A
(mem_sp->mem_vir)630 2154 A
2826(-)S
(\(long\))252 2910 A
(sp_click;)378 3204 A
2655 V
(19390)210 1122 A
(lower)210 1524 A
1776(=)S
(\(delta)252 1860 A
2154(>)S
2238(0)S
2322(?)S
(sp_click)336 2406 A
2784(:)S
(mem_sp->mem_vir\);)714 2868 A
2745 V
(19391)210 1122 A
2835 V
(19392)210 1122 A
1524(/*)S
(Add)126 1650 A
1818(a)S
(safety)252 1902 A
(margin)252 2196 A
(for)126 2490 A
(future)252 2658 A
(stack)210 2952 A
(growth.)294 3204 A
(Impossible)420 3540 A
4002(to)S
4128(do)S
(right.)252 4254 A
4548(*/)S
2925 V
(19393)210 1122 A
(#define)294 1440 A
(SAFETY_BYTES)504 1776 A
(\(384)168 2364 A
2574(*)S
(sizeof\(char)462 2658 A
(*\)\))126 3162 A
3015 V
(19394)210 1122 A
(#define)294 1440 A
(SAFETY_CLICKS)546 1776 A
(\(\(SAFETY_BYTES)588 2364 A
2994(+)S
(CLICK_SIZE)420 3078 A
3540(-)S
3624(1\))S
3750(/)S
(CLICK_SIZE\))462 3834 A
3105 V
(19395)210 1122 A
(gap_base)336 1524 A
1902(=)S
(mem_dp->mem_vir)630 1986 A
2658(+)S
(data_clicks)462 2742 A
3246(+)S
(SAFETY_CLICKS;)588 3330 A
3195 V
(19396)210 1122 A
1524(if)S
(\(lower)252 1650 A
1944(<)S
(gap_base\))378 2028 A
(return\(ENOMEM\);)630 2448 A
3120(/*)S
(data)168 3246 A
(and)126 3456 A
(stack)210 3624 A
(collided)336 3876 A
4254(*/)S
3285 V
(19397)210 1122 A
3375 V
(19398)210 1122 A
1524(/*)S
(Update)252 1650 A
(data)168 1944 A
(length)252 2154 A
(\(but)168 2448 A
(not)126 2658 A
(data)168 2826 A
(orgin\))252 3036 A
3330(on)S
(behalf)252 3456 A
3750(of)S
(brk\(\))210 3876 A
(system)252 4128 A
(call.)210 4422 A
4674(*/)S
3465 V
(19399)210 1122 A
(old_clicks)420 1524 A
1986(=)S
(mem_dp->mem_len;)672 2070 A
3555 V
(19400)210 1122 A
1524(if)S
(\(data_clicks)504 1650 A
2196(!=)S
(mem_dp->mem_len\))672 2322 A
3036({)S
3645 V
(19401)210 1122 A
(mem_dp->mem_len)630 1776 A
2448(=)S
(data_clicks;)504 2532 A
3735 V
(19402)210 1122 A
(changed)294 1776 A
2112(|=)S
(DATA_CHANGED;)546 2238 A
3825 V
(19403)210 1122 A
1524(})S
3915 V
(19404)210 1122 A
4005 V
(19405)210 1122 A
1524(/*)S
(Update)252 1650 A
(stack)210 1944 A
(length)252 2196 A
(and)126 2490 A
(origin)252 2658 A
(due)126 2952 A
3120(to)S
(change)252 3246 A
3540(in)S
(stack)210 3666 A
(pointer.)336 3918 A
4296(*/)S
4095 V
(19406)210 1122 A
1524(if)S
(\(delta)252 1650 A
1944(>)S
2028(0\))S
2154({)S
4185 V
(19407)210 1122 A
(mem_sp->mem_vir)630 1776 A
2448(-=)S
(delta;)252 2574 A
4275 V
(19408)210 1122 A
(mem_sp->mem_phys)672 1776 A
2490(-=)S
(delta;)252 2616 A
4365 V
(19409)210 1122 A
(mem_sp->mem_len)630 1776 A
2448(+=)S
(delta;)252 2574 A
4455 V
(19410)210 1122 A
(changed)294 1776 A
2112(|=)S
(STACK_CHANGED;)588 2238 A
4545 V
(19411)210 1122 A
1524(})S
4635 V
(19412)210 1122 A
4725 V
(19413)210 1122 A
1524(/*)S
1650(Do)S
(the)126 1776 A
(new)126 1944 A
(data)168 2112 A
(and)126 2322 A
(stack)210 2490 A
(segment)294 2742 A
(sizes)210 3078 A
(fit)126 3330 A
3498(in)S
(the)126 3624 A
(address)294 3792 A
(space?)252 4128 A
4422(*/)S
4815 V
(19414)210 1122 A
1524(ft)S
1650(=)S
(\(rmp->mp_flags)588 1734 A
2364(&)S
(SEPARATE\);)420 2448 A
4905 V
(19415)210 1122 A
1524(r)S
1608(=)S
(\(rmp->mp_seg[D].mem_vir)966 1692 A
2700(+)S
(rmp->mp_seg[D].mem_len)924 2784 A
3750(>)S
4995 V
(19416)210 1122 A
(rmp->mp_seg[S].mem_vir\))966 1860 A
2868(?)S
(ENOMEM)252 2952 A
3246(:)S
(OK;)126 3330 A
5085 V
(19417)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
2070({)S
5175 V
(19418)210 1122 A
1776(if)S
(\(changed\))378 1902 A
(sys_newmap\(\(int\)\(rmp)840 2322 A
3204(-)S
(mproc\),)294 3288 A
(rmp->mp_seg\);)546 3624 A
5265 V
(19419)210 1122 A
(return\(OK\);)462 1776 A
5355 V
(19420)210 1122 A
1524(})S
5445 V
(19421)210 1122 A
5535 V
(19422)210 1122 A
1524(/*)S
(New)126 1650 A
(sizes)210 1818 A
(don't)210 2070 A
(fit)126 2322 A
2490(or)S
(require)294 2616 A
(too)126 2952 A
(many)168 3120 A
(page/segment)504 3330 A
(registers.)420 3876 A
(Restore.*/)420 4338 A
5625 V
(19423)210 1122 A
1524(if)S
(\(changed)336 1650 A
2028(&)S
(DATA_CHANGED\))546 2112 A
(mem_dp->mem_len)630 2700 A
3372(=)S
(old_clicks;)462 3456 A
5715 V
(19424)210 1122 A
1524(if)S
(\(changed)336 1650 A
2028(&)S
(STACK_CHANGED\))588 2112 A
2742({)S
5805 V
(19425)210 1122 A
(mem_sp->mem_vir)630 1776 A
2448(+=)S
(delta;)252 2574 A
5895 V
(19426)210 1122 A
(mem_sp->mem_phys)672 1776 A
2490(+=)S
(delta;)252 2616 A
5985 V
(19427)210 1122 A
(mem_sp->mem_len)630 1776 A
2448(-=)S
(delta;)252 2574 A
6075 V
(19428)210 1122 A
1524(})S
6165 V
(19429)210 1122 A
(return\(ENOMEM\);)630 1524 A
6255 V
(19430)210 1122 A
1440(})S
8418 V
EP
%%Page: 260 260
BP
/slant 0 def
/height 0 def
1485 V
12 B
(260)180 1080 A
11 R
2333(File:)S
2566(servers/pm/signal.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(servers/pm/signal.c)798 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(19500)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(handles)294 1986 A
(signals,)336 2322 A
(which)210 2700 A
(are)126 2952 A
(asynchronous)504 3120 A
(events)252 3666 A
(and)126 3960 A
(are)126 4128 A
(generally)378 4296 A
2295 V
(19501)210 1122 A
1482(*)S
1566(a)S
(messy)210 1650 A
(and)126 1902 A
(unpleasant)420 2070 A
(business.)378 2532 A
(Signals)294 2994 A
(can)126 3330 A
3498(be)S
(generated)378 3624 A
4044(by)S
(the)126 4170 A
(KILL)168 4338 A
2385 V
(19502)210 1122 A
1482(*)S
(system)252 1566 A
(call,)210 1860 A
2112(or)S
(from)168 2238 A
(the)126 2448 A
(keyboard)336 2616 A
(\(SIGINT\))336 2994 A
3372(or)S
(from)168 3498 A
(the)126 3708 A
(clock)210 3876 A
(\(SIGALRM\).)420 4128 A
2475 V
(19503)210 1122 A
1482(*)S
1566(In)S
(all)126 1692 A
(cases)210 1860 A
(control)294 2112 A
(eventually)420 2448 A
(passes)252 2910 A
3204(to)S
(check_sig\(\))462 3330 A
3834(to)S
(see)126 3960 A
(which)210 4128 A
(processes)378 4380 A
2565 V
(19504)210 1122 A
1482(*)S
(can)126 1566 A
1734(be)S
(signaled.)378 1860 A
(The)126 2322 A
(actual)252 2490 A
(signaling)378 2784 A
3204(is)S
(done)168 3330 A
3540(by)S
(sig_proc\(\).)462 3666 A
2655 V
(19505)210 1122 A
1482(*)S
2745 V
(19506)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are:)168 2910 A
2835 V
(19507)210 1122 A
1482(*)S
(do_sigaction:)546 1650 A
(perform)294 2322 A
(the)126 2658 A
(SIGACTION)378 2826 A
(system)252 3246 A
(call)168 3540 A
2925 V
(19508)210 1122 A
1482(*)S
(do_sigpending:)588 1650 A
(perform)294 2322 A
(the)126 2658 A
(SIGPENDING)420 2826 A
(system)252 3288 A
(call)168 3582 A
3015 V
(19509)210 1122 A
1482(*)S
(do_sigprocmask:)630 1650 A
(perform)294 2322 A
(the)126 2658 A
(SIGPROCMASK)462 2826 A
(system)252 3330 A
(call)168 3624 A
3105 V
(19510)210 1122 A
1482(*)S
(do_sigreturn:)546 1650 A
(perform)294 2322 A
(the)126 2658 A
(SIGRETURN)378 2826 A
(system)252 3246 A
(call)168 3540 A
3195 V
(19511)210 1122 A
1482(*)S
(do_sigsuspend:)588 1650 A
(perform)294 2322 A
(the)126 2658 A
(SIGSUSPEND)420 2826 A
(system)252 3288 A
(call)168 3582 A
3285 V
(19512)210 1122 A
1482(*)S
(do_kill:)336 1650 A
(perform)294 2112 A
(the)126 2448 A
(KILL)168 2616 A
(system)252 2826 A
(call)168 3120 A
3375 V
(19513)210 1122 A
1482(*)S
(do_alarm:)378 1650 A
(perform)294 2112 A
(the)126 2448 A
(ALARM)210 2616 A
(system)252 2868 A
(call)168 3162 A
3372(by)S
(calling)294 3498 A
(set_alarm\(\))462 3834 A
3465 V
(19514)210 1122 A
1482(*)S
(set_alarm:)420 1650 A
(tell)168 2112 A
(the)126 2322 A
(clock)210 2490 A
(task)168 2742 A
2952(to)S
(start)210 3078 A
3330(or)S
(stop)168 3456 A
3666(a)S
(timer)210 3750 A
3555 V
(19515)210 1122 A
1482(*)S
(do_pause:)378 1650 A
(perform)294 2112 A
(the)126 2448 A
(PAUSE)210 2616 A
(system)252 2868 A
(call)168 3162 A
3645 V
(19516)210 1122 A
1482(*)S
(ksig_pending:)546 1650 A
(the)126 2238 A
(kernel)252 2406 A
(notified)336 2700 A
(about)210 3078 A
(pending)294 3330 A
(signals)294 3666 A
3735 V
(19517)210 1122 A
1482(*)S
(sig_proc:)378 1650 A
(interrupt)378 2112 A
2532(or)S
(terminate)378 2658 A
3078(a)S
(signaled)336 3162 A
(process)294 3540 A
3825 V
(19518)210 1122 A
1482(*)S
(check_sig:)420 1650 A
(check)210 2112 A
(which)210 2364 A
(processes)378 2616 A
3036(to)S
(signal)252 3162 A
(with)168 3456 A
(sig_proc\(\))420 3666 A
3915 V
(19519)210 1122 A
1482(*)S
(check_pending:)588 1650 A
(check)210 2322 A
2574(if)S
2700(a)S
(pending)294 2784 A
(signal)252 3120 A
(can)126 3414 A
(now)126 3582 A
3750(be)S
(delivered)378 3876 A
4005 V
(19520)210 1122 A
1482(*/)S
4095 V
(19521)210 1122 A
4185 V
(19522)210 1122 A
(#include)336 1440 A
("pm.h")252 1818 A
4275 V
(19523)210 1122 A
(#include)336 1440 A
(<sys/stat.h>)504 1818 A
4365 V
(19524)210 1122 A
(#include)336 1440 A
(<sys/ptrace.h>)588 1818 A
4455 V
(19525)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
4545 V
(19526)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
4635 V
(19527)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
4725 V
(19528)210 1122 A
(#include)336 1440 A
(<sys/sigcontext.h>)756 1818 A
4815 V
(19529)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
4905 V
(19530)210 1122 A
(#include)336 1440 A
("mproc.h")378 1818 A
4995 V
(19531)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
5085 V
(19532)210 1122 A
5175 V
(19533)210 1122 A
(#define)294 1440 A
(CORE_MODE)378 1776 A
(0777)168 2448 A
2784(/*)S
(mode)168 2910 A
3120(to)S
(use)126 3246 A
3414(on)S
(core)168 3540 A
(image)210 3750 A
(files)210 4002 A
4254(*/)S
5265 V
(19534)210 1122 A
(#define)294 1440 A
(DUMPED)252 1776 A
(0200)168 2448 A
2784(/*)S
(bit)126 2910 A
(set)126 3078 A
3246(in)S
(status)252 3372 A
(when)168 3666 A
(core)168 3876 A
(dumped)252 4086 A
4380(*/)S
5355 V
(19535)210 1122 A
5445 V
(19536)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(dump_core,)420 2490 A
(\(struct)294 2952 A
(mproc)210 3288 A
(*rmp\))210 3540 A
4464(\);)S
5535 V
(19537)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(unpause,)336 2490 A
(\(int)168 2868 A
(pro\))168 3078 A
4464(\);)S
5625 V
(19538)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(handle_sig,)462 2490 A
(\(int)168 2994 A
(proc_nr,)336 3204 A
(sigset_t)336 3582 A
(sig_map\))336 3960 A
4464(\);)S
5715 V
(19539)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(cause_sigalrm,)588 2490 A
(\(struct)294 3120 A
(timer)210 3456 A
(*tp\))168 3708 A
4464(\);)S
5805 V
(19540)210 1122 A
5895 V
(19541)210 1122 A
(/*===========================================================================*)3276 1440 A
5985 V
(19542)210 1122 A
1482(*)S
(do_sigaction)504 2784 A
4674(*)S
6075 V
(19543)210 1122 A
(*===========================================================================*/)3276 1482 A
6165 V
(19544)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_sigaction\(\))588 1902 A
6255 V
(19545)210 1122 A
1440({)S
6345 V
(19546)210 1122 A
(int)126 1524 A
1692(r;)S
6435 V
(19547)210 1122 A
(struct)252 1524 A
(sigaction)378 1818 A
(svec;)210 2238 A
6525 V
(19548)210 1122 A
(struct)252 1524 A
(sigaction)378 1818 A
(*svp;)210 2238 A
6615 V
(19549)210 1122 A
6705 V
(19550)210 1122 A
1524(if)S
(\(m_in.sig_nr)504 1650 A
2196(==)S
(SIGKILL\))336 2322 A
(return\(OK\);)462 2700 A
6795 V
(19551)210 1122 A
1524(if)S
(\(m_in.sig_nr)504 1650 A
2196(<)S
2280(1)S
2364(||)S
(m_in.sig_nr)462 2490 A
2994(>)S
(_NSIG\))252 3078 A
(return)252 3372 A
(\(EINVAL\);)378 3666 A
6885 V
(19552)210 1122 A
(svp)126 1524 A
1692(=)S
(&mp->mp_sigact[m_in.sig_nr];)1176 1776 A
6975 V
(19553)210 1122 A
1524(if)S
(\(\(struct)336 1650 A
(sigaction)378 2028 A
2448(*\))S
(m_in.sig_osa)504 2574 A
3120(!=)S
(\(struct)294 3246 A
(sigaction)378 3582 A
4002(*\))S
(NULL\))210 4128 A
4380({)S
7065 V
(19554)210 1122 A
1776(r)S
1860(=)S
(sys_datacopy\(PM_PROC_NR,\(vir_bytes\))1470 1944 A
(svp,)168 3456 A
8418 V
EP
%%Page: 261 261
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2333(File:)S
2566(servers/pm/signal.c)S
12 B
(261)180 4500 A
1755 V
7 LST
(19555)210 1122 A
(who,)168 2112 A
(\(vir_bytes\))462 2322 A
(m_in.sig_osa,)546 2826 A
(\(phys_bytes\))504 3414 A
(sizeof\(svec\)\);)588 3960 A
1845 V
(19556)210 1122 A
1776(if)S
1902(\(r)S
2028(!=)S
(OK\))126 2154 A
(return\(r\);)420 2322 A
1935 V
(19557)210 1122 A
1524(})S
2025 V
(19558)210 1122 A
2115 V
(19559)210 1122 A
1524(if)S
(\(\(struct)336 1650 A
(sigaction)378 2028 A
2448(*\))S
(m_in.sig_nsa)504 2574 A
3120(==)S
(\(struct)294 3246 A
(sigaction)378 3582 A
4002(*\))S
(NULL\))210 4128 A
2205 V
(19560)210 1122 A
(return\(OK\);)462 1776 A
2295 V
(19561)210 1122 A
2385 V
(19562)210 1122 A
1524(/*)S
(Read)168 1650 A
1860(in)S
(the)126 1986 A
(sigaction)378 2154 A
(structure.)420 2574 A
3036(*/)S
2475 V
(19563)210 1122 A
1524(r)S
1608(=)S
(sys_datacopy\(who,)714 1692 A
(\(vir_bytes\))462 2448 A
(m_in.sig_nsa,)546 2952 A
2565 V
(19564)210 1122 A
(PM_PROC_NR,)462 2112 A
(\(vir_bytes\))462 2616 A
(&svec,)252 3120 A
(\(phys_bytes\))504 3414 A
(sizeof\(svec\)\);)588 3960 A
2655 V
(19565)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
(return\(r\);)420 2070 A
2745 V
(19566)210 1122 A
2835 V
(19567)210 1122 A
1524(if)S
(\(svec.sa_handler)672 1650 A
2364(==)S
(SIG_IGN\))336 2490 A
2868({)S
2925 V
(19568)210 1122 A
(sigaddset\(&mp->mp_ignore,)1050 1776 A
(m_in.sig_nr\);)546 2868 A
3015 V
(19569)210 1122 A
(sigdelset\(&mp->mp_sigpending,)1218 1776 A
(m_in.sig_nr\);)546 3036 A
3105 V
(19570)210 1122 A
(sigdelset\(&mp->mp_catch,)1008 1776 A
(m_in.sig_nr\);)546 2826 A
3195 V
(19571)210 1122 A
(sigdelset\(&mp->mp_sig2mess,)1134 1776 A
(m_in.sig_nr\);)546 2952 A
3285 V
(19572)210 1122 A
1524(})S
(else)168 1608 A
1818(if)S
(\(svec.sa_handler)672 1944 A
2658(==)S
(SIG_DFL\))336 2784 A
3162({)S
3375 V
(19573)210 1122 A
(sigdelset\(&mp->mp_ignore,)1050 1776 A
(m_in.sig_nr\);)546 2868 A
3465 V
(19574)210 1122 A
(sigdelset\(&mp->mp_catch,)1008 1776 A
(m_in.sig_nr\);)546 2826 A
3555 V
(19575)210 1122 A
(sigdelset\(&mp->mp_sig2mess,)1134 1776 A
(m_in.sig_nr\);)546 2952 A
3645 V
(19576)210 1122 A
1524(})S
(else)168 1608 A
1818(if)S
(\(svec.sa_handler)672 1944 A
2658(==)S
(SIG_MESS\))378 2784 A
3204({)S
3735 V
(19577)210 1122 A
1776(if)S
1902(\(!)S
(\(mp->mp_flags)546 2028 A
2616(&)S
(PRIV_PROC\)\))462 2700 A
(return\(EPERM\);)588 3204 A
3825 V
(19578)210 1122 A
(sigdelset\(&mp->mp_ignore,)1050 1776 A
(m_in.sig_nr\);)546 2868 A
3915 V
(19579)210 1122 A
(sigaddset\(&mp->mp_sig2mess,)1134 1776 A
(m_in.sig_nr\);)546 2952 A
4005 V
(19580)210 1122 A
(sigdelset\(&mp->mp_catch,)1008 1776 A
(m_in.sig_nr\);)546 2826 A
4095 V
(19581)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
4185 V
(19582)210 1122 A
(sigdelset\(&mp->mp_ignore,)1050 1776 A
(m_in.sig_nr\);)546 2868 A
4275 V
(19583)210 1122 A
(sigaddset\(&mp->mp_catch,)1008 1776 A
(m_in.sig_nr\);)546 2826 A
4365 V
(19584)210 1122 A
(sigdelset\(&mp->mp_sig2mess,)1134 1776 A
(m_in.sig_nr\);)546 2952 A
4455 V
(19585)210 1122 A
1524(})S
4545 V
(19586)210 1122 A
(mp->mp_sigact[m_in.sig_nr].sa_handler)1554 1524 A
3120(=)S
(svec.sa_handler;)672 3204 A
4635 V
(19587)210 1122 A
(sigdelset\(&svec.sa_mask,)1008 1524 A
(SIGKILL\);)378 2574 A
4725 V
(19588)210 1122 A
(mp->mp_sigact[m_in.sig_nr].sa_mask)1428 1524 A
2994(=)S
(svec.sa_mask;)546 3078 A
4815 V
(19589)210 1122 A
(mp->mp_sigact[m_in.sig_nr].sa_flags)1470 1524 A
3036(=)S
(svec.sa_flags;)588 3120 A
4905 V
(19590)210 1122 A
(mp->mp_sigreturn)672 1524 A
2238(=)S
(\(vir_bytes\))462 2322 A
(m_in.sig_ret;)546 2826 A
4995 V
(19591)210 1122 A
(return\(OK\);)462 1524 A
5085 V
(19592)210 1122 A
1440(})S
5265 V
(19594)210 1122 A
(/*===========================================================================*)3276 1440 A
5355 V
(19595)210 1122 A
1482(*)S
(do_sigpending)546 2784 A
4674(*)S
5445 V
(19596)210 1122 A
(*===========================================================================*/)3276 1482 A
5535 V
(19597)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_sigpending\(\))630 1902 A
5625 V
(19598)210 1122 A
1440({)S
5715 V
(19599)210 1122 A
(mp->mp_reply.reply_mask)966 1524 A
2532(=)S
(\(long\))252 2616 A
(mp->mp_sigpending;)756 2910 A
5805 V
(19600)210 1122 A
(return)252 1524 A
(OK;)126 1818 A
5895 V
(19601)210 1122 A
1440(})S
6075 V
(19603)210 1122 A
(/*===========================================================================*)3276 1440 A
6165 V
(19604)210 1122 A
1482(*)S
(do_sigprocmask)588 2784 A
4674(*)S
6255 V
(19605)210 1122 A
(*===========================================================================*/)3276 1482 A
6345 V
(19606)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_sigprocmask\(\))672 1902 A
6435 V
(19607)210 1122 A
1440({)S
6525 V
(19608)210 1122 A
1440(/*)S
(Note)168 1566 A
(that)168 1776 A
(the)126 1986 A
(library)294 2154 A
(interface)378 2490 A
(passes)252 2910 A
(the)126 3204 A
(actual)252 3372 A
(mask)168 3666 A
3876(in)S
(sigmask_set,)504 4002 A
6615 V
(19609)210 1122 A
1482(*)S
(not)126 1566 A
1734(a)S
(pointer)294 1818 A
2154(to)S
(the)126 2280 A
(mask,)210 2448 A
2700(in)S
(order)210 2826 A
3078(to)S
(save)168 3204 A
3414(a)S
(copy.)210 3498 A
(Similarly,)420 3792 A
6705 V
(19610)210 1122 A
1482(*)S
(the)126 1566 A
(old)126 1734 A
(mask)168 1902 A
2112(is)S
(placed)252 2238 A
2532(in)S
(the)126 2658 A
(return)252 2826 A
(message)294 3120 A
(which)210 3456 A
(the)126 3708 A
(library)294 3876 A
6795 V
(19611)210 1122 A
1482(*)S
(interface)378 1566 A
(copies)252 1986 A
(\(if)126 2280 A
(requested\))420 2448 A
2910(to)S
(the)126 3036 A
(user)168 3204 A
(specified)378 3414 A
(address.)336 3834 A
6885 V
(19612)210 1122 A
1482(*)S
6975 V
(19613)210 1122 A
1482(*)S
(The)126 1566 A
(library)294 1734 A
(interface)378 2070 A
(must)168 2490 A
(set)126 2700 A
(SIG_INQUIRE)462 2868 A
3372(if)S
(the)126 3498 A
('act')210 3666 A
(argument)336 3918 A
7065 V
(19614)210 1122 A
1482(*)S
1566(is)S
(NULL.)210 1692 A
8418 V
EP
%%Page: 262 262
BP
/slant 0 def
/height 0 def
1485 V
12 B
(262)180 1080 A
11 R
2333(File:)S
2566(servers/pm/signal.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(19615)210 1122 A
1482(*/)S
1845 V
(19616)210 1122 A
1935 V
(19617)210 1122 A
(int)126 1524 A
1692(i;)S
2025 V
(19618)210 1122 A
2115 V
(19619)210 1122 A
(mp->mp_reply.reply_mask)966 1524 A
2532(=)S
(\(long\))252 2616 A
(mp->mp_sigmask;)630 2910 A
2205 V
(19620)210 1122 A
2295 V
(19621)210 1122 A
(switch)252 1524 A
(\(m_in.sig_how\))588 1818 A
2448({)S
2385 V
(19622)210 1122 A
(case)168 1692 A
(SIG_BLOCK:)420 1902 A
2475 V
(19623)210 1122 A
(sigdelset\(\(sigset_t)798 1776 A
(*\)&m_in.sig_set,)672 2616 A
(SIGKILL\);)378 3330 A
2565 V
(19624)210 1122 A
(for)126 1776 A
1944(\(i)S
2070(=)S
2154(1;)S
2280(i)S
2364(<=)S
(_NSIG;)252 2490 A
(i++\))168 2784 A
2994({)S
2655 V
(19625)210 1122 A
2112(if)S
(\(sigismember\(\(sigset_t)924 2238 A
(*\)&m_in.sig_set,)672 3204 A
(i\)\))126 3918 A
2745 V
(19626)210 1122 A
(sigaddset\(&mp->mp_sigmask,)1092 2448 A
(i\);)126 3582 A
2835 V
(19627)210 1122 A
1776(})S
2925 V
(19628)210 1122 A
(break;)252 1776 A
3015 V
(19629)210 1122 A
3105 V
(19630)210 1122 A
(case)168 1692 A
(SIG_UNBLOCK:)504 1902 A
3195 V
(19631)210 1122 A
(for)126 1776 A
1944(\(i)S
2070(=)S
2154(1;)S
2280(i)S
2364(<=)S
(_NSIG;)252 2490 A
(i++\))168 2784 A
2994({)S
3285 V
(19632)210 1122 A
2112(if)S
(\(sigismember\(\(sigset_t)924 2238 A
(*\)&m_in.sig_set,)672 3204 A
(i\)\))126 3918 A
3375 V
(19633)210 1122 A
(sigdelset\(&mp->mp_sigmask,)1092 2448 A
(i\);)126 3582 A
3465 V
(19634)210 1122 A
1776(})S
3555 V
(19635)210 1122 A
(check_pending\(mp\);)756 1776 A
3645 V
(19636)210 1122 A
(break;)252 1776 A
3735 V
(19637)210 1122 A
3825 V
(19638)210 1122 A
(case)168 1692 A
(SIG_SETMASK:)504 1902 A
3915 V
(19639)210 1122 A
(sigdelset\(\(sigset_t)798 1776 A
2616(*\))S
(&m_in.sig_set,)588 2742 A
(SIGKILL\);)378 3372 A
4005 V
(19640)210 1122 A
(mp->mp_sigmask)588 1776 A
2406(=)S
(\(sigset_t\))420 2490 A
(m_in.sig_set;)546 2952 A
4095 V
(19641)210 1122 A
(check_pending\(mp\);)756 1776 A
4185 V
(19642)210 1122 A
(break;)252 1776 A
4275 V
(19643)210 1122 A
4365 V
(19644)210 1122 A
(case)168 1692 A
(SIG_INQUIRE:)504 1902 A
4455 V
(19645)210 1122 A
(break;)252 1776 A
4545 V
(19646)210 1122 A
4635 V
(19647)210 1122 A
(default:)336 1692 A
4725 V
(19648)210 1122 A
(return\(EINVAL\);)630 1776 A
4815 V
(19649)210 1122 A
(break;)252 1776 A
4905 V
(19650)210 1122 A
1524(})S
4995 V
(19651)210 1122 A
(return)252 1524 A
(OK;)126 1818 A
5085 V
(19652)210 1122 A
1440(})S
5265 V
(19654)210 1122 A
(/*===========================================================================*)3276 1440 A
5355 V
(19655)210 1122 A
1482(*)S
(do_sigsuspend)546 2784 A
4674(*)S
5445 V
(19656)210 1122 A
(*===========================================================================*/)3276 1482 A
5535 V
(19657)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_sigsuspend\(\))630 1902 A
5625 V
(19658)210 1122 A
1440({)S
5715 V
(19659)210 1122 A
(mp->mp_sigmask2)630 1524 A
2196(=)S
(mp->mp_sigmask;)630 2280 A
3120(/*)S
(save)168 3246 A
(the)126 3456 A
(old)126 3624 A
(mask)168 3792 A
4002(*/)S
5805 V
(19660)210 1122 A
(mp->mp_sigmask)588 1524 A
2154(=)S
(\(sigset_t\))420 2238 A
(m_in.sig_set;)546 2700 A
5895 V
(19661)210 1122 A
(sigdelset\(&mp->mp_sigmask,)1092 1524 A
(SIGKILL\);)378 2658 A
5985 V
(19662)210 1122 A
(mp->mp_flags)504 1524 A
2070(|=)S
(SIGSUSPENDED;)546 2196 A
6075 V
(19663)210 1122 A
(check_pending\(mp\);)756 1524 A
6165 V
(19664)210 1122 A
(return\(SUSPEND\);)672 1524 A
6255 V
(19665)210 1122 A
1440(})S
6435 V
(19667)210 1122 A
(/*===========================================================================*)3276 1440 A
6525 V
(19668)210 1122 A
1482(*)S
(do_sigreturn)504 2784 A
4674(*)S
6615 V
(19669)210 1122 A
(*===========================================================================*/)3276 1482 A
6705 V
(19670)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_sigreturn\(\))588 1902 A
6795 V
(19671)210 1122 A
1440({)S
6885 V
(19672)210 1122 A
1440(/*)S
1566(A)S
(user)168 1650 A
(signal)252 1860 A
(handler)294 2154 A
2490(is)S
(done.)210 2616 A
(Restore)294 2910 A
(context)294 3246 A
(and)126 3582 A
(check)210 3750 A
(for)126 4002 A
6975 V
(19673)210 1122 A
1482(*)S
(pending)294 1566 A
(unblocked)378 1902 A
(signals.)336 2322 A
7065 V
(19674)210 1122 A
1482(*/)S
8418 V
EP
%%Page: 263 263
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2333(File:)S
2566(servers/pm/signal.c)S
12 B
(263)180 4500 A
1755 V
7 LST
(19675)210 1122 A
1845 V
(19676)210 1122 A
(int)126 1524 A
1692(r;)S
1935 V
(19677)210 1122 A
2025 V
(19678)210 1122 A
(mp->mp_sigmask)588 1524 A
2154(=)S
(\(sigset_t\))420 2238 A
(m_in.sig_set;)546 2700 A
2115 V
(19679)210 1122 A
(sigdelset\(&mp->mp_sigmask,)1092 1524 A
(SIGKILL\);)378 2658 A
2205 V
(19680)210 1122 A
2295 V
(19681)210 1122 A
1524(r)S
1608(=)S
(sys_sigreturn\(who,)756 1692 A
(\(struct)294 2490 A
(sigmsg)252 2826 A
3120(*\))S
(m_in.sig_context\);)756 3246 A
2385 V
(19682)210 1122 A
(check_pending\(mp\);)756 1524 A
2475 V
(19683)210 1122 A
(return\(r\);)420 1524 A
2565 V
(19684)210 1122 A
1440(})S
2745 V
(19686)210 1122 A
(/*===========================================================================*)3276 1440 A
2835 V
(19687)210 1122 A
1482(*)S
(do_kill)294 2784 A
4674(*)S
2925 V
(19688)210 1122 A
(*===========================================================================*/)3276 1482 A
3015 V
(19689)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_kill\(\))378 1902 A
3105 V
(19690)210 1122 A
1440({)S
3195 V
(19691)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(kill\(pid,)378 2070 A
(signo\))252 2490 A
(system)252 2784 A
(call.)210 3078 A
3330(*/)S
3285 V
(19692)210 1122 A
3375 V
(19693)210 1122 A
(return)252 1524 A
(check_sig\(m_in.pid,)798 1818 A
(m_in.sig_nr\);)546 2658 A
3465 V
(19694)210 1122 A
1440(})S
3645 V
(19696)210 1122 A
(/*===========================================================================*)3276 1440 A
3735 V
(19697)210 1122 A
1482(*)S
(ksig_pending)504 2784 A
4674(*)S
3825 V
(19698)210 1122 A
(*===========================================================================*/)3276 1482 A
3915 V
(19699)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(ksig_pending\(\))588 1902 A
4005 V
(19700)210 1122 A
1440({)S
4095 V
(19701)210 1122 A
1440(/*)S
(Certain)294 1566 A
(signals,)336 1902 A
(such)168 2280 A
2490(as)S
(segmentation)504 2616 A
(violations)420 3162 A
(originate)378 3624 A
4044(in)S
(the)126 4170 A
(kernel.)294 4338 A
4185 V
(19702)210 1122 A
1482(*)S
(When)168 1566 A
(the)126 1776 A
(kernel)252 1944 A
(detects)294 2238 A
(such)168 2574 A
(signals,)336 2784 A
3162(it)S
(notifies)336 3288 A
(the)126 3666 A
3834(PM)S
3960(to)S
(take)168 4086 A
(further)294 4296 A
4275 V
(19703)210 1122 A
1482(*)S
(action.)294 1566 A
(The)126 1902 A
2070(PM)S
(requests)336 2196 A
(the)126 2574 A
(kernel)252 2742 A
3036(to)S
(send)168 3162 A
(messages)336 3372 A
(with)168 3750 A
(the)126 3960 A
(process)294 4128 A
4365 V
(19704)210 1122 A
1482(*)S
(slot)168 1566 A
(and)126 1776 A
(bit)126 1944 A
(map)126 2112 A
(for)126 2280 A
(all)126 2448 A
(signaled)336 2616 A
(processes.)420 2994 A
(The)126 3456 A
(File)168 3624 A
(System,)294 3834 A
(for)126 4170 A
(example,)336 4338 A
4455 V
(19705)210 1122 A
1482(*)S
(uses)168 1566 A
(this)168 1776 A
(mechanism)378 1986 A
2406(to)S
(signal)252 2532 A
(writing)294 2826 A
3162(on)S
(broken)252 3288 A
(pipes)210 3582 A
(\(SIGPIPE\).)420 3834 A
4545 V
(19706)210 1122 A
1482(*)S
4635 V
(19707)210 1122 A
1482(*)S
(The)126 1566 A
(kernel)252 1734 A
(has)126 2028 A
(notified)336 2196 A
(the)126 2574 A
2742(PM)S
(about)210 2868 A
(pending)294 3120 A
(signals.)336 3456 A
(Request)294 3834 A
(pending)294 4170 A
4725 V
(19708)210 1122 A
1482(*)S
(signals)294 1566 A
(until)210 1902 A
(all)126 2154 A
(signals)294 2322 A
(are)126 2658 A
(handled.)336 2826 A
3204(If)S
(there)210 3330 A
(are)126 3582 A
3750(no)S
(more)168 3876 A
(signals,)336 4086 A
4815 V
(19709)210 1122 A
1482(*)S
(NONE)168 1566 A
1776(is)S
(returned)336 1902 A
2280(in)S
(the)126 2406 A
(process)294 2574 A
(number)252 2910 A
(field.)252 3204 A
4905 V
(19710)210 1122 A
1482(*/)S
4995 V
(19711)210 1122 A
(int)126 1482 A
(proc_nr;)336 1650 A
5085 V
(19712)210 1122 A
(sigset_t)336 1482 A
(sig_map;)336 1860 A
5175 V
(19713)210 1122 A
5265 V
(19714)210 1122 A
(while)210 1482 A
(\(TRUE\))252 1734 A
2028({)S
5355 V
(19715)210 1122 A
(sys_getksig\(&proc_nr,)882 1566 A
(&sig_map\);)420 2490 A
3120(/*)S
(get)126 3246 A
3414(an)S
(arbitrary)378 3540 A
(pending)294 3960 A
(signal)252 4296 A
4590(*/)S
5445 V
(19716)210 1122 A
1566(if)S
(\(NONE)210 1692 A
1944(==)S
(proc_nr\))336 2070 A
2448({)S
3120(/*)S
(stop)168 3246 A
3456(if)S
3582(no)S
(more)168 3708 A
(pending)294 3918 A
(signals)294 4254 A
4590(*/)S
5535 V
(19717)210 1122 A
(break;)252 1776 A
5625 V
(19718)210 1122 A
1566(})S
(else)168 1650 A
1860({)S
5715 V
(19719)210 1122 A
(handle_sig\(proc_nr,)798 1776 A
(sig_map\);)378 2616 A
3120(/*)S
(handle)252 3246 A
(the)126 3540 A
(received)336 3708 A
(signal)252 4086 A
4380(*/)S
5805 V
(19720)210 1122 A
(sys_endksig\(proc_nr\);)882 1776 A
3120(/*)S
(tell)168 3246 A
(kernel)252 3456 A
(it's)168 3750 A
(done)168 3960 A
4170(*/)S
5895 V
(19721)210 1122 A
1566(})S
5985 V
(19722)210 1122 A
1482(})S
6075 V
(19723)210 1122 A
(return\(SUSPEND\);)672 1482 A
3120(/*)S
(prevents)336 3246 A
(sending)294 3624 A
(reply)210 3960 A
4212(*/)S
6165 V
(19724)210 1122 A
1440(})S
6345 V
(19726)210 1122 A
(/*===========================================================================*)3276 1440 A
6435 V
(19727)210 1122 A
1482(*)S
(handle_sig)420 2784 A
4674(*)S
6525 V
(19728)210 1122 A
(*===========================================================================*/)3276 1482 A
6615 V
(19729)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(handle_sig\(proc_nr,)798 1986 A
(sig_map\))336 2826 A
6705 V
(19730)210 1122 A
(int)126 1440 A
(proc_nr;)336 1608 A
6795 V
(19731)210 1122 A
(sigset_t)336 1440 A
(sig_map;)336 1818 A
6885 V
(19732)210 1122 A
1440({)S
6975 V
(19733)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rmp;)210 2448 A
7065 V
(19734)210 1122 A
(int)126 1524 A
1692(i;)S
8418 V
EP
%%Page: 264 264
BP
/slant 0 def
/height 0 def
1485 V
12 B
(264)180 1080 A
11 R
2333(File:)S
2566(servers/pm/signal.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(19735)210 1122 A
(pid_t)210 1524 A
(proc_id,)336 1776 A
(id;)126 2154 A
1845 V
(19736)210 1122 A
1935 V
(19737)210 1122 A
(rmp)126 1524 A
1692(=)S
(&mproc[proc_nr];)672 1776 A
2025 V
(19738)210 1122 A
1524(if)S
(\(\(rmp->mp_flags)630 1650 A
2322(&)S
(\(IN_USE)294 2406 A
2742(|)S
(ZOMBIE\)\))336 2826 A
3204(!=)S
(IN_USE\))294 3330 A
(return;)294 3666 A
2115 V
(19739)210 1122 A
(proc_id)294 1524 A
1860(=)S
(rmp->mp_pid;)504 1944 A
2205 V
(19740)210 1122 A
1524(mp)S
1650(=)S
(&mproc[0];)420 1734 A
3120(/*)S
(pretend)294 3246 A
(signals)294 3582 A
(are)126 3918 A
(from)168 4086 A
4296(PM)S
4422(*/)S
2295 V
(19741)210 1122 A
(mp->mp_procgrp)588 1524 A
2154(=)S
(rmp->mp_procgrp;)672 2238 A
3120(/*)S
(get)126 3246 A
(process)294 3414 A
(group)210 3750 A
(right)210 4002 A
4254(*/)S
2385 V
(19742)210 1122 A
2475 V
(19743)210 1122 A
1524(/*)S
(Check)210 1650 A
(each)168 1902 A
(bit)126 2112 A
2280(in)S
(turn)168 2406 A
2616(to)S
(see)126 2742 A
2910(if)S
3036(a)S
(signal)252 3120 A
3414(is)S
3540(to)S
3666(be)S
(sent.)210 3792 A
(Unlike)252 4086 A
2565 V
(19744)210 1122 A
1566(*)S
(kill\(\),)294 1650 A
(the)126 1986 A
(kernel)252 2154 A
(may)126 2448 A
(collect)294 2616 A
(several)294 2952 A
(unrelated)378 3288 A
(signals)294 3708 A
(for)126 4044 A
4212(a)S
2655 V
(19745)210 1122 A
1566(*)S
(process)294 1650 A
(and)126 1986 A
(pass)168 2154 A
(them)168 2364 A
2574(to)S
2700(PM)S
2826(in)S
(one)126 2952 A
(blow.)210 3120 A
(Thus)168 3414 A
(loop)168 3624 A
3834(on)S
(the)126 3960 A
(bit)126 4128 A
2745 V
(19746)210 1122 A
1566(*)S
(map.)168 1650 A
(For)126 1860 A
(SIGINT)252 2028 A
(and)126 2322 A
(SIGQUIT,)336 2490 A
(use)126 2868 A
(proc_id)294 3036 A
3372(0)S
3456(to)S
(indicate)336 3582 A
3960(a)S
(broadcast)378 4044 A
2835 V
(19747)210 1122 A
1566(*)S
1650(to)S
(the)126 1776 A
(recipient's)462 1944 A
(process)294 2448 A
(group.)252 2784 A
(For)126 3120 A
(SIGKILL,)336 3288 A
(use)126 3666 A
(proc_id)294 3834 A
4170(-1)S
4296(to)S
2925 V
(19748)210 1122 A
1566(*)S
(indicate)336 1650 A
2028(a)S
(systemwide)420 2112 A
(broadcast.)420 2574 A
3015 V
(19749)210 1122 A
1566(*/)S
3105 V
(19750)210 1122 A
(for)126 1524 A
1692(\(i)S
1818(=)S
1902(1;)S
2028(i)S
2112(<=)S
(_NSIG;)252 2238 A
(i++\))168 2532 A
2742({)S
3195 V
(19751)210 1122 A
1776(if)S
(\(!sigismember\(&sig_map,)966 1902 A
(i\)\))126 2910 A
(continue;)378 3078 A
3285 V
(19752)210 1122 A
(switch)252 1776 A
(\(i\))126 2070 A
2238({)S
3375 V
(19753)210 1122 A
(case)168 1944 A
(SIGINT:)294 2154 A
3465 V
(19754)210 1122 A
(case)168 1944 A
(SIGQUIT:)336 2154 A
3555 V
(19755)210 1122 A
2112(id)S
2238(=)S
2322(0;)S
(break;)252 2448 A
2784(/*)S
(broadcast)378 2910 A
3330(to)S
(process)294 3456 A
(group)210 3792 A
4044(*/)S
3645 V
(19756)210 1122 A
(case)168 1944 A
(SIGKILL:)336 2154 A
3735 V
(19757)210 1122 A
2112(id)S
2238(=)S
(-1;)126 2322 A
(break;)252 2490 A
2784(/*)S
(broadcast)378 2910 A
3330(to)S
(all)126 3456 A
(except)252 3624 A
(INIT)168 3918 A
4128(*/)S
3825 V
(19758)210 1122 A
(default:)336 1944 A
3915 V
(19759)210 1122 A
2112(id)S
2238(=)S
(proc_id;)336 2322 A
4005 V
(19760)210 1122 A
(break;)252 2112 A
4095 V
(19761)210 1122 A
1776(})S
4185 V
(19762)210 1122 A
(check_sig\(id,)546 1776 A
(i\);)126 2364 A
4275 V
(19763)210 1122 A
1524(})S
4365 V
(19764)210 1122 A
1440(})S
4545 V
(19766)210 1122 A
(/*===========================================================================*)3276 1440 A
4635 V
(19767)210 1122 A
1482(*)S
(do_alarm)336 2784 A
4674(*)S
4725 V
(19768)210 1122 A
(*===========================================================================*/)3276 1482 A
4815 V
(19769)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_alarm\(\))420 1902 A
4905 V
(19770)210 1122 A
1440({)S
4995 V
(19771)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(alarm\(seconds\))588 2070 A
(system)252 2700 A
(call.)210 2994 A
3246(*/)S
5085 V
(19772)210 1122 A
(return\(set_alarm\(who,)882 1524 A
(m_in.seconds\)\);)630 2448 A
5175 V
(19773)210 1122 A
1440(})S
5355 V
(19775)210 1122 A
(/*===========================================================================*)3276 1440 A
5445 V
(19776)210 1122 A
1482(*)S
(set_alarm)378 2784 A
4674(*)S
5535 V
(19777)210 1122 A
(*===========================================================================*/)3276 1482 A
5625 V
(19778)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(set_alarm\(proc_nr,)756 1902 A
(sec\))168 2700 A
5715 V
(19779)210 1122 A
(int)126 1440 A
(proc_nr;)336 1608 A
2784(/*)S
(process)294 2910 A
(that)168 3246 A
(wants)210 3456 A
(the)126 3708 A
(alarm)210 3876 A
4128(*/)S
5805 V
(19780)210 1122 A
(int)126 1440 A
(sec;)168 1608 A
2784(/*)S
(how)126 2910 A
(many)168 3078 A
(seconds)294 3288 A
(delay)210 3624 A
(before)252 3876 A
(the)126 4170 A
(signal)252 4338 A
4632(*/)S
5895 V
(19781)210 1122 A
1440({)S
5985 V
(19782)210 1122 A
1440(/*)S
(This)168 1566 A
(routine)294 1776 A
2112(is)S
(used)168 2238 A
2448(by)S
(do_alarm\(\))420 2574 A
3036(to)S
(set)126 3162 A
(the)126 3330 A
(alarm)210 3498 A
(timer.)252 3750 A
4086(It)S
4212(is)S
(also)168 4338 A
(used)168 4548 A
6075 V
(19783)210 1122 A
1482(*)S
1566(to)S
(turn)168 1692 A
(the)126 1902 A
(timer)210 2070 A
(off)126 2322 A
(when)168 2490 A
2700(a)S
(process)294 2784 A
(exits)210 3120 A
(with)168 3372 A
(the)126 3582 A
(timer)210 3750 A
(still)210 4002 A
(on.)126 4254 A
6165 V
(19784)210 1122 A
1482(*/)S
6255 V
(19785)210 1122 A
(clock_t)294 1524 A
(ticks;)252 1860 A
2448(/*)S
(number)252 2574 A
2868(of)S
(ticks)210 2994 A
(for)126 3246 A
(alarm)210 3414 A
3666(*/)S
6345 V
(19786)210 1122 A
(clock_t)294 1524 A
(exptime;)336 1860 A
2448(/*)S
(needed)252 2574 A
(for)126 2868 A
(remaining)378 3036 A
(time)168 3456 A
3666(on)S
(previous)336 3792 A
(alarm)210 4170 A
4422(*/)S
6435 V
(19787)210 1122 A
(clock_t)294 1524 A
(uptime;)294 1860 A
2448(/*)S
(current)294 2574 A
(system)252 2910 A
(time)168 3204 A
3414(*/)S
6525 V
(19788)210 1122 A
(int)126 1524 A
(remaining;)420 1692 A
2448(/*)S
(previous)336 2574 A
(time)168 2952 A
(left)168 3162 A
3372(in)S
(seconds)294 3498 A
3834(*/)S
6615 V
(19789)210 1122 A
(int)126 1524 A
1692(s;)S
6705 V
(19790)210 1122 A
6795 V
(19791)210 1122 A
1524(/*)S
(First)210 1650 A
(determine)378 1902 A
(remaining)378 2322 A
(time)168 2742 A
2952(of)S
(previous)336 3078 A
(alarm,)252 3456 A
3750(if)S
(set.)168 3876 A
4086(*/)S
6885 V
(19792)210 1122 A
1524(if)S
(\(mproc[proc_nr].mp_flags)1008 1650 A
2700(&)S
(ALARM_ON\))378 2784 A
3204({)S
6975 V
(19793)210 1122 A
1776(if)S
1902(\()S
(\(s=getuptime\(&uptime\)\))924 1986 A
2952(!=)S
(OK\))126 3078 A
7065 V
(19794)210 1122 A
(panic\(__FILE__,"set_alarm)1050 2112 A
(couldn't)336 3204 A
(get)126 3582 A
(uptime",)336 3750 A
(s\);)126 4128 A
8418 V
EP
%%Page: 265 265
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2333(File:)S
2566(servers/pm/signal.c)S
12 B
(265)180 4500 A
1755 V
7 LST
(19795)210 1122 A
(exptime)294 1776 A
2112(=)S
(*tmr_exp_time\(&mproc[proc_nr].mp_timer\);)1680 2196 A
1845 V
(19796)210 1122 A
(remaining)378 1776 A
2196(=)S
(\(int\))210 2280 A
(\(\(exptime)378 2532 A
2952(-)S
(uptime)252 3036 A
3330(+)S
(\(HZ-1\)\)/HZ\);)504 3414 A
1935 V
(19797)210 1122 A
1776(if)S
(\(remaining)420 1902 A
2364(<)S
2448(0\))S
(remaining)378 2574 A
2994(=)S
3078(0;)S
2025 V
(19798)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
2115 V
(19799)210 1122 A
(remaining)378 1776 A
2196(=)S
2280(0;)S
2205 V
(19800)210 1122 A
1524(})S
2295 V
(19801)210 1122 A
2385 V
(19802)210 1122 A
1524(/*)S
(Tell)168 1650 A
(the)126 1860 A
(clock)210 2028 A
(task)168 2280 A
2490(to)S
(provide)294 2616 A
2952(a)S
(signal)252 3036 A
(message)294 3330 A
(when)168 3666 A
(the)126 3876 A
(time)168 4044 A
(comes.)252 4254 A
2475 V
(19803)210 1122 A
1566(*)S
2565 V
(19804)210 1122 A
1566(*)S
(Large)210 1650 A
(delays)252 1902 A
(cause)210 2196 A
2448(a)S
(lot)126 2532 A
2700(of)S
(problems.)378 2826 A
(First,)252 3288 A
(the)126 3582 A
(alarm)210 3750 A
(system)252 4002 A
(call)168 4296 A
2655 V
(19805)210 1122 A
1566(*)S
(takes)210 1650 A
1902(an)S
(unsigned)336 2028 A
(seconds)294 2406 A
(count)210 2742 A
(and)126 2994 A
(the)126 3162 A
(library)294 3330 A
(has)126 3666 A
(cast)168 3834 A
4044(it)S
4170(to)S
4296(an)S
(int.)168 4422 A
2745 V
(19806)210 1122 A
1566(*)S
(That)168 1650 A
(probably)336 1860 A
(works,)252 2238 A
(but)126 2532 A
2700(on)S
(return)252 2826 A
(the)126 3120 A
(library)294 3288 A
(will)168 3624 A
(convert)294 3834 A
("negative")420 4170 A
2835 V
(19807)210 1122 A
1566(*)S
(unsigneds)378 1650 A
2070(to)S
(errors.)294 2196 A
(Presumably)420 2574 A
3036(no)S
(one)126 3162 A
(checks)252 3330 A
(for)126 3624 A
(these)210 3792 A
(errors,)294 4044 A
4380(so)S
2925 V
(19808)210 1122 A
1566(*)S
(force)210 1650 A
(this)168 1902 A
(call)168 2112 A
(through.)336 2322 A
(Second,)294 2742 A
3078(If)S
(unsigned)336 3204 A
(and)126 3582 A
(long)168 3750 A
(have)168 3960 A
(the)126 4170 A
(same)168 4338 A
3015 V
(19809)210 1122 A
1566(*)S
(size,)210 1650 A
(converting)420 1902 A
(from)168 2364 A
(seconds)294 2574 A
2910(to)S
(ticks)210 3036 A
(can)126 3288 A
(easily)252 3456 A
(overflow.)378 3750 A
(Finally,)336 4212 A
3105 V
(19810)210 1122 A
1566(*)S
(the)126 1650 A
(kernel)252 1818 A
(has)126 2112 A
(similar)294 2280 A
(overflow)336 2616 A
(bugs)168 2994 A
(adding)252 3204 A
(ticks.)252 3498 A
3195 V
(19811)210 1122 A
1566(*)S
3285 V
(19812)210 1122 A
1566(*)S
(Fixing)252 1650 A
(this)168 1944 A
(requires)336 2154 A
2532(a)S
(lot)126 2616 A
2784(of)S
(ugly)168 2910 A
(casts)210 3120 A
3372(to)S
(fit)126 3498 A
(the)126 3666 A
(wrong)210 3834 A
(interface)378 4086 A
3375 V
(19813)210 1122 A
1566(*)S
(types)210 1650 A
(and)126 1902 A
2070(to)S
(avoid)210 2196 A
(overflow)336 2448 A
(traps.)252 2826 A
(ALRM_EXP_TIME)546 3162 A
(has)126 3750 A
(the)126 3918 A
(right)210 4086 A
(type)168 4338 A
3465 V
(19814)210 1122 A
1566(*)S
(\(clock_t\))378 1650 A
(although)336 2070 A
2448(it)S
2574(is)S
(declared)336 2700 A
3078(as)S
(long.)210 3204 A
(How)126 3498 A
(can)126 3666 A
(variables)378 3834 A
(like)168 4254 A
3555 V
(19815)210 1122 A
1566(*)S
(this)168 1650 A
1860(be)S
(declared)336 1986 A
(properly)336 2364 A
(without)294 2742 A
(combinatorial)546 3078 A
(explosion)378 3666 A
4086(of)S
(message)294 4212 A
3645 V
(19816)210 1122 A
1566(*)S
(types?)252 1650 A
3735 V
(19817)210 1122 A
1566(*/)S
3825 V
(19818)210 1122 A
(ticks)210 1524 A
1776(=)S
(\(clock_t\))378 1860 A
(\(HZ)126 2280 A
2448(*)S
(\(unsigned)378 2532 A
(long\))210 2952 A
(\(unsigned\))420 3204 A
(sec\);)210 3666 A
3915 V
(19819)210 1122 A
1524(if)S
1650(\()S
(\(unsigned)378 1734 A
(long\))210 2154 A
(ticks)210 2406 A
2658(/)S
2742(HZ)S
2868(!=)S
(\(unsigned\))420 2994 A
(sec\))168 3456 A
4005 V
(19820)210 1122 A
(ticks)210 1776 A
2028(=)S
(LONG_MAX;)378 2112 A
2784(/*)S
(eternity)336 2910 A
(\(really)294 3288 A
(TMR_NEVER\))420 3624 A
4086(*/)S
4095 V
(19821)210 1122 A
4185 V
(19822)210 1122 A
1524(if)S
(\(ticks)252 1650 A
1944(!=)S
2070(0\))S
2196({)S
4275 V
(19823)210 1122 A
(pm_set_timer\(&mproc[proc_nr].mp_timer,)1596 1776 A
(ticks,)252 3414 A
(cause_sigalrm,)588 3708 A
(proc_nr\);)378 4338 A
4365 V
(19824)210 1122 A
(mproc[proc_nr].mp_flags)966 1776 A
2784(|=)S
(ALARM_ON;)378 2952 A
4455 V
(19825)210 1122 A
1524(})S
(else)168 1608 A
1818(if)S
(\(mproc[proc_nr].mp_flags)1008 1944 A
2994(&)S
(ALARM_ON\))378 3078 A
3498({)S
4545 V
(19826)210 1122 A
(pm_cancel_timer\(&mproc[proc_nr].mp_timer\);)1764 1776 A
4635 V
(19827)210 1122 A
(mproc[proc_nr].mp_flags)966 1776 A
2784(&=)S
(\304ALARM_ON;)420 2910 A
4725 V
(19828)210 1122 A
1524(})S
4815 V
(19829)210 1122 A
(return\(remaining\);)756 1524 A
4905 V
(19830)210 1122 A
1440(})S
5085 V
(19832)210 1122 A
(/*===========================================================================*)3276 1440 A
5175 V
(19833)210 1122 A
1482(*)S
(cause_sigalrm)546 2784 A
4674(*)S
5265 V
(19834)210 1122 A
(*===========================================================================*/)3276 1482 A
5355 V
(19835)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(cause_sigalrm\(tp\))714 1986 A
5445 V
(19836)210 1122 A
(struct)252 1440 A
(timer)210 1734 A
(*tp;)168 1986 A
5535 V
(19837)210 1122 A
1440({)S
5625 V
(19838)210 1122 A
(int)126 1524 A
(proc_nr;)336 1692 A
5715 V
(19839)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rmp;)210 2448 A
5805 V
(19840)210 1122 A
5895 V
(19841)210 1122 A
(proc_nr)294 1524 A
1860(=)S
(tmr_arg\(tp\)->ta_int;)840 1944 A
3120(/*)S
(get)126 3246 A
(process)294 3414 A
(from)168 3750 A
(timer)210 3960 A
4212(*/)S
5985 V
(19842)210 1122 A
(rmp)126 1524 A
1692(=)S
(&mproc[proc_nr];)672 1776 A
6075 V
(19843)210 1122 A
6165 V
(19844)210 1122 A
1524(if)S
(\(\(rmp->mp_flags)630 1650 A
2322(&)S
(\(IN_USE)294 2406 A
2742(|)S
(ZOMBIE\)\))336 2826 A
3204(!=)S
(IN_USE\))294 3330 A
(return;)294 3666 A
6255 V
(19845)210 1122 A
1524(if)S
(\(\(rmp->mp_flags)630 1650 A
2322(&)S
(ALARM_ON\))378 2406 A
2826(==)S
2952(0\))S
(return;)294 3078 A
6345 V
(19846)210 1122 A
(rmp->mp_flags)546 1524 A
2112(&=)S
(\304ALARM_ON;)420 2238 A
6435 V
(19847)210 1122 A
(check_sig\(rmp->mp_pid,)924 1524 A
(SIGALRM\);)378 2490 A
6525 V
(19848)210 1122 A
1440(})S
6705 V
(19850)210 1122 A
(/*===========================================================================*)3276 1440 A
6795 V
(19851)210 1122 A
1482(*)S
(do_pause)336 2784 A
4674(*)S
6885 V
(19852)210 1122 A
(*===========================================================================*/)3276 1482 A
6975 V
(19853)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_pause\(\))420 1902 A
7065 V
(19854)210 1122 A
1440({)S
8418 V
EP
%%Page: 266 266
BP
/slant 0 def
/height 0 def
1485 V
12 B
(266)180 1080 A
11 R
2333(File:)S
2566(servers/pm/signal.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(19855)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(pause\(\))294 2070 A
(system)252 2406 A
(call.)210 2700 A
2952(*/)S
1845 V
(19856)210 1122 A
1935 V
(19857)210 1122 A
(mp->mp_flags)504 1524 A
2070(|=)S
(PAUSED;)294 2196 A
2025 V
(19858)210 1122 A
(return\(SUSPEND\);)672 1524 A
2115 V
(19859)210 1122 A
1440(})S
2295 V
(19861)210 1122 A
(/*===========================================================================*)3276 1440 A
2385 V
(19862)210 1122 A
1482(*)S
(sig_proc)336 2784 A
4674(*)S
2475 V
(19863)210 1122 A
(*===========================================================================*/)3276 1482 A
2565 V
(19864)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(sig_proc\(rmp,)546 1944 A
(signo\))252 2532 A
2655 V
(19865)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(mproc)210 2112 A
(*rmp;)210 2364 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(the)126 3372 A
(process)294 3540 A
3876(to)S
4002(be)S
(signaled)336 4128 A
4506(*/)S
2745 V
(19866)210 1122 A
(int)126 1440 A
(signo;)252 1608 A
2784(/*)S
(signal)252 2910 A
3204(to)S
(send)168 3330 A
3540(to)S
(process)294 3666 A
4002(\(1)S
4128(to)S
(_NSIG\))252 4254 A
4548(*/)S
2835 V
(19867)210 1122 A
1440({)S
2925 V
(19868)210 1122 A
1440(/*)S
(Send)168 1566 A
1776(a)S
(signal)252 1860 A
2154(to)S
2280(a)S
(process.)336 2364 A
(Check)210 2784 A
3036(to)S
(see)126 3162 A
3330(if)S
(the)126 3456 A
(signal)252 3624 A
3918(is)S
4044(to)S
4170(be)S
(caught,)294 4296 A
3015 V
(19869)210 1122 A
1482(*)S
(ignored,)336 1566 A
(tranformed)420 1944 A
(into)168 2406 A
2616(a)S
(message)294 2700 A
(\(for)168 3036 A
(system)252 3246 A
(processes\))420 3540 A
4002(or)S
(blocked.)336 4128 A
3105 V
(19870)210 1122 A
1482(*)S
1608(-)S
1692(If)S
(the)126 1818 A
(signal)252 1986 A
2280(is)S
2406(to)S
2532(be)S
(transformed)462 2658 A
(into)168 3162 A
3372(a)S
(message,)336 3456 A
(request)294 3834 A
(the)126 4170 A
(KERNEL)252 4338 A
4632(to)S
3195 V
(19871)210 1122 A
1482(*)S
(send)168 1566 A
(the)126 1776 A
(target)252 1944 A
(process)294 2238 A
2574(a)S
(system)252 2658 A
(notification)504 2952 A
(with)168 3498 A
(the)126 3708 A
(pending)294 3876 A
(signal)252 4212 A
4506(as)S
4632(an)S
3285 V
(19872)210 1122 A
1482(*)S
(argument.)378 1566 A
3375 V
(19873)210 1122 A
1482(*)S
1608(-)S
1692(If)S
(the)126 1818 A
(signal)252 1986 A
2280(is)S
2406(to)S
2532(be)S
(caught,)294 2658 A
(request)294 2994 A
(the)126 3330 A
(KERNEL)252 3498 A
3792(to)S
(push)168 3918 A
4128(a)S
(sigcontext)420 4212 A
3465 V
(19874)210 1122 A
1482(*)S
(structure)378 1566 A
(and)126 1986 A
2154(a)S
(sigframe)336 2238 A
(structure)378 2616 A
(onto)168 3036 A
(the)126 3246 A
(catcher's)378 3414 A
(stack.)252 3834 A
(Also,)210 4170 A
(KERNEL)252 4422 A
3555 V
(19875)210 1122 A
1482(*)S
(will)168 1566 A
(reset)210 1776 A
(the)126 2028 A
(program)294 2196 A
(counter)294 2532 A
(and)126 2868 A
(stack)210 3036 A
(pointer,)336 3288 A
3666(so)S
(that)168 3792 A
(when)168 4002 A
(the)126 4212 A
(process)294 4380 A
3645 V
(19876)210 1122 A
1482(*)S
(next)168 1566 A
(runs,)210 1776 A
2028(it)S
(will)168 2154 A
2364(be)S
(executing)378 2490 A
(the)126 2910 A
(signal)252 3078 A
(handler.)336 3372 A
(When)168 3750 A
(the)126 3960 A
(signal)252 4128 A
(handler)294 4422 A
3735 V
(19877)210 1122 A
1482(*)S
(returns,)336 1566 A
(sigreturn\(2\))504 1986 A
(will)168 2532 A
2742(be)S
(called.)294 2868 A
(Then)168 3246 A
(KERNEL)252 3456 A
(will)168 3750 A
(restore)294 3960 A
(the)126 4296 A
(signal)252 4464 A
3825 V
(19878)210 1122 A
1482(*)S
(context)294 1566 A
(from)168 1902 A
(the)126 2112 A
(sigcontext)420 2280 A
(structure.)420 2742 A
3915 V
(19879)210 1122 A
1482(*)S
1566(If)S
(there)210 1692 A
1944(is)S
(insufficient)504 2070 A
(stack)210 2616 A
(space,)252 2868 A
(kill)168 3162 A
(the)126 3372 A
(process.)336 3540 A
4005 V
(19880)210 1122 A
1482(*/)S
4095 V
(19881)210 1122 A
4185 V
(19882)210 1122 A
(vir_bytes)378 1524 A
(new_sp;)294 1944 A
4275 V
(19883)210 1122 A
(int)126 1524 A
1692(s;)S
4365 V
(19884)210 1122 A
(int)126 1524 A
(slot;)210 1692 A
4455 V
(19885)210 1122 A
(int)126 1524 A
(sigflags;)378 1692 A
4545 V
(19886)210 1122 A
(struct)252 1524 A
(sigmsg)252 1818 A
(sm;)126 2112 A
4635 V
(19887)210 1122 A
4725 V
(19888)210 1122 A
(slot)168 1524 A
1734(=)S
(\(int\))210 1818 A
(\(rmp)168 2070 A
2280(-)S
(mproc\);)294 2364 A
4815 V
(19889)210 1122 A
1524(if)S
(\(\(rmp->mp_flags)630 1650 A
2322(&)S
(\(IN_USE)294 2406 A
2742(|)S
(ZOMBIE\)\))336 2826 A
3204(!=)S
(IN_USE\))294 3330 A
3666({)S
4905 V
(19890)210 1122 A
(printf\("PM:)462 1776 A
(signal)252 2280 A
2574(%d)S
(sent)168 2700 A
2910(to)S
3036(%s)S
(process)294 3162 A
(%d\\n",)252 3498 A
4995 V
(19891)210 1122 A
(signo,)252 2112 A
(\(rmp->mp_flags)588 2406 A
3036(&)S
(ZOMBIE\))294 3120 A
3456(?)S
("zombie")336 3540 A
3918(:)S
("dead",)294 4002 A
(slot\);)252 4338 A
5085 V
(19892)210 1122 A
(panic\(__FILE__,"",)756 1776 A
(NO_NUM\);)336 2574 A
5175 V
(19893)210 1122 A
1524(})S
5265 V
(19894)210 1122 A
1524(if)S
(\(\(rmp->mp_flags)630 1650 A
2322(&)S
(TRACED\))294 2406 A
2742(&&)S
(signo)210 2868 A
3120(!=)S
(SIGKILL\))336 3246 A
3624({)S
5355 V
(19895)210 1122 A
1776(/*)S
1902(A)S
(traced)252 1986 A
(process)294 2280 A
(has)126 2616 A
(special)294 2784 A
(handling.)378 3120 A
3540(*/)S
5445 V
(19896)210 1122 A
(unpause\(slot\);)588 1776 A
5535 V
(19897)210 1122 A
(stop_proc\(rmp,)588 1776 A
(signo\);)294 2406 A
2784(/*)S
2910(a)S
(signal)252 2994 A
(causes)252 3288 A
3582(it)S
3708(to)S
(stop)168 3834 A
4044(*/)S
5625 V
(19898)210 1122 A
(return;)294 1776 A
5715 V
(19899)210 1122 A
1524(})S
5805 V
(19900)210 1122 A
1524(/*)S
(Some)168 1650 A
(signals)294 1860 A
(are)126 2196 A
(ignored)294 2364 A
2700(by)S
(default.)336 2826 A
3204(*/)S
5895 V
(19901)210 1122 A
1524(if)S
(\(sigismember\(&rmp->mp_ignore,)1218 1650 A
(signo\)\))294 2910 A
3246({)S
5985 V
(19902)210 1122 A
(return;)294 1776 A
6075 V
(19903)210 1122 A
1524(})S
6165 V
(19904)210 1122 A
1524(if)S
(\(sigismember\(&rmp->mp_sigmask,)1260 1650 A
(signo\)\))294 2952 A
3288({)S
6255 V
(19905)210 1122 A
1776(/*)S
(Signal)252 1902 A
(should)252 2196 A
2490(be)S
(blocked.)336 2616 A
2994(*/)S
6345 V
(19906)210 1122 A
(sigaddset\(&rmp->mp_sigpending,)1260 1776 A
(signo\);)294 3078 A
6435 V
(19907)210 1122 A
(return;)294 1776 A
6525 V
(19908)210 1122 A
1524(})S
6615 V
(19909)210 1122 A
(sigflags)336 1524 A
1902(=)S
(rmp->mp_sigact[signo].sa_flags;)1302 1986 A
6705 V
(19910)210 1122 A
1524(if)S
(\(sigismember\(&rmp->mp_catch,)1176 1650 A
(signo\)\))294 2868 A
3204({)S
6795 V
(19911)210 1122 A
1776(if)S
(\(rmp->mp_flags)588 1902 A
2532(&)S
(SIGSUSPENDED\))546 2616 A
6885 V
(19912)210 1122 A
(sm.sm_mask)420 2112 A
2574(=)S
(rmp->mp_sigmask2;)714 2658 A
6975 V
(19913)210 1122 A
(else)168 1776 A
7065 V
(19914)210 1122 A
(sm.sm_mask)420 2112 A
2574(=)S
(rmp->mp_sigmask;)672 2658 A
8418 V
EP
%%Page: 267 267
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2333(File:)S
2566(servers/pm/signal.c)S
12 B
(267)180 4500 A
1755 V
7 LST
(19915)210 1122 A
(sm.sm_signo)462 1776 A
2280(=)S
(signo;)252 2364 A
1845 V
(19916)210 1122 A
(sm.sm_sighandler)672 1776 A
2490(=)S
(\(vir_bytes\))462 2574 A
(rmp->mp_sigact[signo].sa_handler;)1386 3078 A
1935 V
(19917)210 1122 A
(sm.sm_sigreturn)630 1776 A
2448(=)S
(rmp->mp_sigreturn;)756 2532 A
2025 V
(19918)210 1122 A
1776(if)S
(\(\(s=get_stack_ptr\(slot,)966 1902 A
(&new_sp\)\))378 2910 A
3330(!=)S
(OK\))126 3456 A
2115 V
(19919)210 1122 A
(panic\(__FILE__,"couldn't)1008 2112 A
(get)126 3162 A
(new)126 3330 A
(stack)210 3498 A
(pointer",s\);)504 3750 A
2205 V
(19920)210 1122 A
(sm.sm_stkptr)504 1776 A
2322(=)S
(new_sp;)294 2406 A
2295 V
(19921)210 1122 A
2385 V
(19922)210 1122 A
1776(/*)S
(Make)168 1902 A
(room)168 2112 A
(for)126 2322 A
(the)126 2490 A
(sigcontext)420 2658 A
(and)126 3120 A
(sigframe)336 3288 A
(struct.)294 3666 A
4002(*/)S
2475 V
(19923)210 1122 A
(new_sp)252 1776 A
2070(-=)S
(sizeof\(struct)546 2196 A
(sigcontext\))462 2784 A
2565 V
(19924)210 1122 A
2826(+)S
2910(3)S
2994(*)S
(sizeof\(char)462 3078 A
3582(*\))S
3708(+)S
3792(2)S
3876(*)S
(sizeof\(int\);)504 3960 A
2655 V
(19925)210 1122 A
2745 V
(19926)210 1122 A
1776(if)S
(\(adjust\(rmp,)504 1902 A
(rmp->mp_seg[D].mem_len,)966 2448 A
(new_sp\))294 3456 A
3792(!=)S
(OK\))126 3918 A
2835 V
(19927)210 1122 A
(goto)168 2112 A
(doterminate;)504 2322 A
2925 V
(19928)210 1122 A
3015 V
(19929)210 1122 A
(rmp->mp_sigmask)630 1776 A
2448(|=)S
(rmp->mp_sigact[signo].sa_mask;)1260 2574 A
3105 V
(19930)210 1122 A
1776(if)S
(\(sigflags)378 1902 A
2322(&)S
(SA_NODEFER\))462 2406 A
3195 V
(19931)210 1122 A
(sigdelset\(&rmp->mp_sigmask,)1134 2112 A
(signo\);)294 3288 A
3285 V
(19932)210 1122 A
(else)168 1776 A
3375 V
(19933)210 1122 A
(sigaddset\(&rmp->mp_sigmask,)1134 2112 A
(signo\);)294 3288 A
3465 V
(19934)210 1122 A
3555 V
(19935)210 1122 A
1776(if)S
(\(sigflags)378 1902 A
2322(&)S
(SA_RESETHAND\))546 2406 A
2994({)S
3645 V
(19936)210 1122 A
(sigdelset\(&rmp->mp_catch,)1050 2112 A
(signo\);)294 3204 A
3735 V
(19937)210 1122 A
(rmp->mp_sigact[signo].sa_handler)1344 2112 A
3498(=)S
(SIG_DFL;)336 3582 A
3825 V
(19938)210 1122 A
1776(})S
3915 V
(19939)210 1122 A
4005 V
(19940)210 1122 A
1776(if)S
(\(OK)126 1902 A
2070(==)S
(\(s=sys_sigsend\(slot,)840 2196 A
(&sm\)\)\))252 3078 A
3372({)S
4095 V
(19941)210 1122 A
4185 V
(19942)210 1122 A
(sigdelset\(&rmp->mp_sigpending,)1260 2112 A
(signo\);)294 3414 A
4275 V
(19943)210 1122 A
2112(/*)S
2238(If)S
(process)294 2364 A
2700(is)S
(hanging)294 2826 A
3162(on)S
(PAUSE,)252 3288 A
(WAIT,)210 3582 A
(SIGSUSPEND,)462 3834 A
(tty,)168 4338 A
4365 V
(19944)210 1122 A
2154(*)S
(pipe,)210 2238 A
(etc.,)210 2490 A
(release)294 2742 A
(it.)126 3078 A
4455 V
(19945)210 1122 A
2154(*/)S
4545 V
(19946)210 1122 A
(unpause\(slot\);)588 2112 A
4635 V
(19947)210 1122 A
(return;)294 2112 A
4725 V
(19948)210 1122 A
1776(})S
4815 V
(19949)210 1122 A
(panic\(__FILE__,)630 1776 A
("warning,)378 2448 A
(sys_sigsend)462 2868 A
(failed",)336 3372 A
(s\);)126 3750 A
4905 V
(19950)210 1122 A
1524(})S
4995 V
(19951)210 1122 A
(else)168 1524 A
1734(if)S
(\(sigismember\(&rmp->mp_sig2mess,)1302 1860 A
(signo\)\))294 3204 A
3540({)S
5085 V
(19952)210 1122 A
1776(if)S
(\(OK)126 1902 A
2070(!=)S
(\(s=sys_kill\(slot,signo\)\)\))1050 2196 A
5175 V
(19953)210 1122 A
(panic\(__FILE__,)630 2112 A
("warning,)378 2784 A
(sys_kill)336 3204 A
(failed",)336 3582 A
(s\);)126 3960 A
5265 V
(19954)210 1122 A
(return;)294 1776 A
5355 V
(19955)210 1122 A
1524(})S
5445 V
(19956)210 1122 A
5535 V
(19957)210 1122 A
(doterminate:)504 1440 A
5625 V
(19958)210 1122 A
1524(/*)S
(Signal)252 1650 A
(should)252 1944 A
(not)126 2238 A
2406(or)S
(cannot)252 2532 A
2826(be)S
(caught.)294 2952 A
(Take)168 3330 A
(default)294 3540 A
(action.)294 3876 A
4212(*/)S
5715 V
(19959)210 1122 A
1524(if)S
(\(sigismember\(&ign_sset,)966 1650 A
(signo\)\))294 2658 A
(return;)294 2994 A
5805 V
(19960)210 1122 A
5895 V
(19961)210 1122 A
(rmp->mp_sigstatus)714 1524 A
2280(=)S
(\(char\))252 2364 A
(signo;)252 2658 A
5985 V
(19962)210 1122 A
1524(if)S
(\(sigismember\(&core_sset,)1008 1650 A
(signo\)\))294 2700 A
3036({)S
6075 V
(19963)210 1122 A
1776(/*)S
(Switch)252 1902 A
2196(to)S
(the)126 2322 A
(user's)252 2490 A
2784(FS)S
(environment)462 2910 A
(and)126 3414 A
(dump)168 3582 A
(core.)210 3792 A
4044(*/)S
6165 V
(19964)210 1122 A
(tell_fs\(CHDIR,)588 1776 A
(slot,)210 2406 A
(FALSE,)252 2658 A
(0\);)126 2952 A
6255 V
(19965)210 1122 A
(dump_core\(rmp\);)630 1776 A
6345 V
(19966)210 1122 A
1524(})S
6435 V
(19967)210 1122 A
(pm_exit\(rmp,)504 1524 A
(0\);)126 2070 A
2784(/*)S
(terminate)378 2910 A
(process)294 3330 A
3666(*/)S
6525 V
(19968)210 1122 A
1440(})S
6705 V
(19970)210 1122 A
(/*===========================================================================*)3276 1440 A
6795 V
(19971)210 1122 A
1482(*)S
(check_sig)378 2784 A
4674(*)S
6885 V
(19972)210 1122 A
(*===========================================================================*/)3276 1482 A
6975 V
(19973)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(check_sig\(proc_id,)756 1902 A
(signo\))252 2700 A
7065 V
(19974)210 1122 A
(pid_t)210 1440 A
(proc_id;)336 1692 A
2784(/*)S
(pid)126 2910 A
3078(of)S
(proc)168 3204 A
3414(to)S
(sig,)168 3540 A
3750(or)S
3876(0)S
3960(or)S
(-1,)126 4086 A
4254(or)S
(-pgrp)210 4380 A
4632(*/)S
8418 V
EP
%%Page: 268 268
BP
/slant 0 def
/height 0 def
1485 V
12 B
(268)180 1080 A
11 R
2333(File:)S
2566(servers/pm/signal.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(19975)210 1122 A
(int)126 1440 A
(signo;)252 1608 A
2784(/*)S
(signal)252 2910 A
3204(to)S
(send)168 3330 A
3540(to)S
(process)294 3666 A
4002(\(0)S
4128(to)S
(_NSIG\))252 4254 A
4548(*/)S
1845 V
(19976)210 1122 A
1440({)S
1935 V
(19977)210 1122 A
1440(/*)S
(Check)210 1566 A
1818(to)S
(see)126 1944 A
2112(if)S
2238(it)S
2364(is)S
(possible)336 2490 A
2868(to)S
(send)168 2994 A
3204(a)S
(signal.)294 3288 A
(The)126 3666 A
(signal)252 3834 A
(may)126 4128 A
(have)168 4296 A
4506(to)S
4632(be)S
2025 V
(19978)210 1122 A
1482(*)S
(sent)168 1566 A
1776(to)S
1902(a)S
(group)210 1986 A
2238(of)S
(processes.)420 2364 A
(This)168 2868 A
(routine)294 3078 A
3414(is)S
(invoked)294 3540 A
3876(by)S
(the)126 4002 A
(KILL)168 4170 A
(system)252 4380 A
2115 V
(19979)210 1122 A
1482(*)S
(call,)210 1566 A
(and)126 1818 A
(also)168 1986 A
(when)168 2196 A
(the)126 2406 A
(kernel)252 2574 A
(catches)294 2868 A
3204(a)S
(DEL)126 3288 A
3456(or)S
(other)210 3582 A
(signal.)294 3834 A
2205 V
(19980)210 1122 A
1482(*/)S
2295 V
(19981)210 1122 A
2385 V
(19982)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rmp;)210 2448 A
2475 V
(19983)210 1122 A
(int)126 1524 A
(count;)252 1692 A
2784(/*)S
(count)210 2910 A
3162(#)S
3246(of)S
(signals)294 3372 A
(sent)168 3708 A
3918(*/)S
2565 V
(19984)210 1122 A
(int)126 1524 A
(error_code;)462 1692 A
2655 V
(19985)210 1122 A
2745 V
(19986)210 1122 A
1524(if)S
(\(signo)252 1650 A
1944(<)S
2028(0)S
2112(||)S
(signo)210 2238 A
2490(>)S
(_NSIG\))252 2574 A
(return\(EINVAL\);)630 2868 A
2835 V
(19987)210 1122 A
2925 V
(19988)210 1122 A
1524(/*)S
(Return)252 1650 A
(EINVAL)252 1944 A
(for)126 2238 A
(attempts)336 2406 A
2784(to)S
(send)168 2910 A
(SIGKILL)294 3120 A
3456(to)S
(INIT)168 3582 A
(alone.)252 3792 A
4086(*/)S
3015 V
(19989)210 1122 A
1524(if)S
(\(proc_id)336 1650 A
2028(==)S
(INIT_PID)336 2154 A
2532(&&)S
(signo)210 2658 A
2910(==)S
(SIGKILL\))336 3036 A
(return\(EINVAL\);)630 3414 A
3105 V
(19990)210 1122 A
3195 V
(19991)210 1122 A
1524(/*)S
(Search)252 1650 A
(the)126 1944 A
(proc)168 2112 A
(table)210 2322 A
(for)126 2574 A
(processes)378 2742 A
3162(to)S
(signal.)294 3288 A
(\(See)168 3666 A
(forkexit.c)420 3876 A
(about)210 4338 A
3285 V
(19992)210 1122 A
1566(*)S
(pid)126 1650 A
(magic.\))294 1818 A
3375 V
(19993)210 1122 A
1566(*/)S
3465 V
(19994)210 1122 A
(count)210 1524 A
1776(=)S
1860(0;)S
3555 V
(19995)210 1122 A
(error_code)420 1524 A
1986(=)S
(ESRCH;)252 2070 A
3645 V
(19996)210 1122 A
(for)126 1524 A
(\(rmp)168 1692 A
1902(=)S
(&mproc[0];)420 1986 A
(rmp)126 2448 A
2616(<)S
(&mproc[NR_PROCS];)714 2700 A
(rmp++\))252 3456 A
3750({)S
3735 V
(19997)210 1122 A
1776(if)S
(\(!\(rmp->mp_flags)672 1902 A
2616(&)S
(IN_USE\)\))336 2700 A
(continue;)378 3078 A
3825 V
(19998)210 1122 A
1776(if)S
(\(\(rmp->mp_flags)630 1902 A
2574(&)S
(ZOMBIE\))294 2658 A
2994(&&)S
(signo)210 3120 A
3372(!=)S
3498(0\))S
(continue;)378 3624 A
3915 V
(19999)210 1122 A
4005 V
(20000)210 1122 A
1776(/*)S
(Check)210 1902 A
(for)126 2154 A
(selection.)420 2322 A
2784(*/)S
4095 V
(20001)210 1122 A
1776(if)S
(\(proc_id)336 1902 A
2280(>)S
2364(0)S
2448(&&)S
(proc_id)294 2574 A
2910(!=)S
(rmp->mp_pid\))504 3036 A
(continue;)378 3582 A
4185 V
(20002)210 1122 A
1776(if)S
(\(proc_id)336 1902 A
2280(==)S
2406(0)S
2490(&&)S
(mp->mp_procgrp)588 2616 A
3246(!=)S
(rmp->mp_procgrp\))672 3372 A
(continue;)378 4086 A
4275 V
(20003)210 1122 A
1776(if)S
(\(proc_id)336 1902 A
2280(==)S
2406(-1)S
2532(&&)S
(rmp->mp_pid)462 2658 A
3162(<=)S
(INIT_PID\))378 3288 A
(continue;)378 3708 A
4365 V
(20004)210 1122 A
1776(if)S
(\(proc_id)336 1902 A
2280(<)S
2364(-1)S
2490(&&)S
(rmp->mp_procgrp)630 2616 A
3288(!=)S
(-proc_id\))378 3414 A
(continue;)378 3834 A
4455 V
(20005)210 1122 A
4545 V
(20006)210 1122 A
1776(/*)S
(Check)210 1902 A
(for)126 2154 A
(permission.)462 2322 A
2826(*/)S
4635 V
(20007)210 1122 A
1776(if)S
(\(mp->mp_effuid)588 1902 A
2532(!=)S
(SUPER_USER)420 2658 A
4725 V
(20008)210 1122 A
1944(&&)S
(mp->mp_realuid)588 2070 A
2700(!=)S
(rmp->mp_realuid)630 2826 A
4815 V
(20009)210 1122 A
1944(&&)S
(mp->mp_effuid)546 2070 A
2658(!=)S
(rmp->mp_realuid)630 2784 A
4905 V
(20010)210 1122 A
1944(&&)S
(mp->mp_realuid)588 2070 A
2700(!=)S
(rmp->mp_effuid)588 2826 A
4995 V
(20011)210 1122 A
1944(&&)S
(mp->mp_effuid)546 2070 A
2658(!=)S
(rmp->mp_effuid\))630 2784 A
3456({)S
5085 V
(20012)210 1122 A
(error_code)420 2112 A
2574(=)S
(EPERM;)252 2658 A
5175 V
(20013)210 1122 A
(continue;)378 2112 A
5265 V
(20014)210 1122 A
1776(})S
5355 V
(20015)210 1122 A
5445 V
(20016)210 1122 A
(count++;)336 1776 A
5535 V
(20017)210 1122 A
1776(if)S
(\(signo)252 1902 A
2196(==)S
2322(0\))S
(continue;)378 2448 A
5625 V
(20018)210 1122 A
5715 V
(20019)210 1122 A
1776(/*)S
('sig_proc')420 1902 A
(will)168 2364 A
(handle)252 2574 A
(the)126 2868 A
(disposition)462 3036 A
3540(of)S
(the)126 3666 A
(signal.)294 3834 A
(The)126 4212 A
5805 V
(20020)210 1122 A
1818(*)S
(signal)252 1902 A
(may)126 2196 A
2364(be)S
(caught,)294 2490 A
(blocked,)336 2826 A
(ignored,)336 3204 A
3582(or)S
(cause)210 3708 A
(process)294 3960 A
5895 V
(20021)210 1122 A
1818(*)S
(termination,)504 1902 A
(possibly)336 2448 A
(with)168 2826 A
(core)168 3036 A
(dump.)210 3246 A
5985 V
(20022)210 1122 A
1818(*/)S
6075 V
(20023)210 1122 A
(sig_proc\(rmp,)546 1776 A
(signo\);)294 2364 A
6165 V
(20024)210 1122 A
6255 V
(20025)210 1122 A
1776(if)S
(\(proc_id)336 1902 A
2280(>)S
2364(0\))S
(break;)252 2490 A
2784(/*)S
(only)168 2910 A
(one)126 3120 A
(process)294 3288 A
(being)210 3624 A
(signaled)336 3876 A
4254(*/)S
6345 V
(20026)210 1122 A
1524(})S
6435 V
(20027)210 1122 A
6525 V
(20028)210 1122 A
1524(/*)S
1650(If)S
(the)126 1776 A
(calling)294 1944 A
(process)294 2280 A
(has)126 2616 A
(killed)252 2784 A
(itself,)294 3078 A
(don't)210 3414 A
(reply.)252 3666 A
3960(*/)S
6615 V
(20029)210 1122 A
1524(if)S
(\(\(mp->mp_flags)588 1650 A
2280(&)S
(\(IN_USE)294 2364 A
2700(|)S
(ZOMBIE\)\))336 2784 A
3162(!=)S
(IN_USE\))294 3288 A
(return\(SUSPEND\);)672 3624 A
6705 V
(20030)210 1122 A
(return\(count)504 1524 A
2070(>)S
2154(0)S
2238(?)S
2322(OK)S
2448(:)S
(error_code\);)504 2532 A
6795 V
(20031)210 1122 A
1440(})S
8418 V
EP
%%Page: 269 269
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2333(File:)S
2566(servers/pm/signal.c)S
12 B
(269)180 4500 A
1755 V
7 LST
(20033)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(20034)210 1122 A
1482(*)S
(check_pending)546 2784 A
4674(*)S
1935 V
(20035)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(20036)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(check_pending\(rmp\))756 1944 A
2115 V
(20037)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(mproc)210 2112 A
(*rmp;)210 2364 A
2205 V
(20038)210 1122 A
1440({)S
2295 V
(20039)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(to)S
(see)126 2028 A
2196(if)S
(any)126 2322 A
(pending)294 2490 A
(signals)294 2826 A
(have)168 3162 A
(been)168 3372 A
(unblocked.)420 3582 A
(The)126 4086 A
2385 V
(20040)210 1122 A
1566(*)S
(first)210 1650 A
(such)168 1902 A
(signal)252 2112 A
(found)210 2406 A
2658(is)S
(delivered.)420 2784 A
2475 V
(20041)210 1122 A
1566(*)S
2565 V
(20042)210 1122 A
1566(*)S
1650(If)S
(multiple)336 1776 A
(pending)294 2154 A
(unmasked)336 2490 A
(signals)294 2868 A
(are)126 3204 A
(found,)252 3372 A
(they)168 3666 A
(will)168 3876 A
4086(be)S
2655 V
(20043)210 1122 A
1566(*)S
(delivered)378 1650 A
(sequentially.)546 2070 A
2745 V
(20044)210 1122 A
1566(*)S
2835 V
(20045)210 1122 A
1566(*)S
(There)210 1650 A
(are)126 1902 A
(several)294 2070 A
(places)252 2406 A
2700(in)S
(this)168 2826 A
(file)168 3036 A
(where)210 3246 A
(the)126 3498 A
(signal)252 3666 A
(mask)168 3960 A
4170(is)S
2925 V
(20046)210 1122 A
1566(*)S
(changed.)336 1650 A
2070(At)S
(each)168 2196 A
(such)168 2406 A
(place,)252 2616 A
(check_pending\(\))630 2910 A
(should)252 3582 A
3876(be)S
(called)252 4002 A
4296(to)S
3015 V
(20047)210 1122 A
1566(*)S
(check)210 1650 A
(for)126 1902 A
(newly)210 2070 A
(unblocked)378 2322 A
(signals.)336 2742 A
3105 V
(20048)210 1122 A
1566(*/)S
3195 V
(20049)210 1122 A
3285 V
(20050)210 1122 A
(int)126 1524 A
1692(i;)S
3375 V
(20051)210 1122 A
3465 V
(20052)210 1122 A
(for)126 1524 A
1692(\(i)S
1818(=)S
1902(1;)S
2028(i)S
2112(<=)S
(_NSIG;)252 2238 A
(i++\))168 2532 A
2742({)S
3555 V
(20053)210 1122 A
1776(if)S
(\(sigismember\(&rmp->mp_sigpending,)1386 1902 A
3330(i\))S
3456(&&)S
3645 V
(20054)210 1122 A
(!sigismember\(&rmp->mp_sigmask,)1260 2112 A
(i\)\))126 3414 A
3582({)S
3735 V
(20055)210 1122 A
(sigdelset\(&rmp->mp_sigpending,)1260 2112 A
(i\);)126 3414 A
3825 V
(20056)210 1122 A
(sig_proc\(rmp,)546 2112 A
(i\);)126 2700 A
3915 V
(20057)210 1122 A
(break;)252 2112 A
4005 V
(20058)210 1122 A
1776(})S
4095 V
(20059)210 1122 A
1524(})S
4185 V
(20060)210 1122 A
1440(})S
4365 V
(20062)210 1122 A
(/*===========================================================================*)3276 1440 A
4455 V
(20063)210 1122 A
1482(*)S
(unpause)294 2784 A
4674(*)S
4545 V
(20064)210 1122 A
(*===========================================================================*/)3276 1482 A
4635 V
(20065)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(unpause\(pro\))504 1986 A
4725 V
(20066)210 1122 A
(int)126 1440 A
(pro;)168 1608 A
2784(/*)S
(which)210 2910 A
(process)294 3162 A
(number)252 3498 A
3792(*/)S
4815 V
(20067)210 1122 A
1440({)S
4905 V
(20068)210 1122 A
1440(/*)S
1566(A)S
(signal)252 1650 A
1944(is)S
2070(to)S
2196(be)S
(sent)168 2322 A
2532(to)S
2658(a)S
(process.)336 2742 A
3162(If)S
(that)168 3288 A
(process)294 3498 A
3834(is)S
(hanging)294 3960 A
4296(on)S
4422(a)S
4995 V
(20069)210 1122 A
1482(*)S
(system)252 1566 A
(call,)210 1860 A
(the)126 2112 A
(system)252 2280 A
(call)168 2574 A
(must)168 2784 A
2994(be)S
(terminated)420 3120 A
(with)168 3582 A
(EINTR.)252 3792 A
(Possible)336 4128 A
5085 V
(20070)210 1122 A
1482(*)S
(calls)210 1566 A
(are)126 1818 A
(PAUSE,)252 1986 A
(WAIT,)210 2280 A
(READ)168 2532 A
(and)126 2742 A
(WRITE,)252 2910 A
(the)126 3204 A
(latter)252 3372 A
(two)126 3666 A
(for)126 3834 A
(pipes)210 4002 A
(and)126 4254 A
(ttys.)210 4422 A
5175 V
(20071)210 1122 A
1482(*)S
(First)210 1566 A
(check)210 1818 A
2070(if)S
(the)126 2196 A
(process)294 2364 A
2700(is)S
(hanging)294 2826 A
3162(on)S
3288(an)S
3414(PM)S
(call.)210 3540 A
3834(If)S
(not,)168 3960 A
(tell)168 4170 A
(FS,)126 4380 A
5265 V
(20072)210 1122 A
1482(*)S
1566(so)S
1692(it)S
(can)126 1818 A
(check)210 1986 A
(for)126 2238 A
(READs)210 2406 A
(and)126 2658 A
(WRITEs)252 2826 A
(from)168 3120 A
(pipes,)252 3330 A
(ttys)168 3624 A
(and)126 3834 A
(the)126 4002 A
(like.)210 4170 A
5355 V
(20073)210 1122 A
1482(*/)S
5445 V
(20074)210 1122 A
5535 V
(20075)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rmp;)210 2448 A
5625 V
(20076)210 1122 A
5715 V
(20077)210 1122 A
(rmp)126 1524 A
1692(=)S
(&mproc[pro];)504 1776 A
5805 V
(20078)210 1122 A
5895 V
(20079)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(to)S
(see)126 2028 A
2196(if)S
(process)294 2322 A
2658(is)S
(hanging)294 2784 A
3120(on)S
3246(a)S
(PAUSE,)252 3330 A
(WAIT)168 3624 A
3834(or)S
(SIGSUSPEND)420 3960 A
(call.)210 4422 A
4674(*/)S
5985 V
(20080)210 1122 A
1524(if)S
(\(rmp->mp_flags)588 1650 A
2280(&)S
(\(PAUSED)294 2364 A
2700(|)S
(WAITING)294 2784 A
3120(|)S
(SIGSUSPENDED\)\))588 3204 A
3834({)S
6075 V
(20081)210 1122 A
(rmp->mp_flags)546 1776 A
2364(&=)S
(\304\(PAUSED)336 2490 A
2868(|)S
(WAITING)294 2952 A
3288(|)S
(SIGSUSPENDED\);)588 3372 A
6165 V
(20082)210 1122 A
(setreply\(pro,)546 1776 A
(EINTR\);)294 2364 A
6255 V
(20083)210 1122 A
(return;)294 1776 A
6345 V
(20084)210 1122 A
1524(})S
6435 V
(20085)210 1122 A
6525 V
(20086)210 1122 A
1524(/*)S
(Process)294 1650 A
1986(is)S
(not)126 2112 A
(hanging)294 2280 A
2616(on)S
2742(an)S
2868(PM)S
(call.)210 2994 A
(Ask)126 3288 A
3456(FS)S
3582(to)S
(take)168 3708 A
3918(a)S
(look.)210 4002 A
4254(*/)S
6615 V
(20087)210 1122 A
(tell_fs\(UNPAUSE,)672 1524 A
(pro,)168 2238 A
2448(0,)S
(0\);)126 2574 A
6705 V
(20088)210 1122 A
1440(})S
8418 V
EP
%%Page: 270 270
BP
/slant 0 def
/height 0 def
1485 V
12 B
(270)180 1080 A
11 R
2333(File:)S
2566(servers/pm/signal.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(20090)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(20091)210 1122 A
1482(*)S
(dump_core)378 2784 A
4674(*)S
1935 V
(20092)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(20093)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(dump_core\(rmp\))588 1986 A
2115 V
(20094)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(mproc)210 2112 A
(*rmp;)210 2364 A
2784(/*)S
(whose)210 2910 A
(core)168 3162 A
3372(is)S
3498(to)S
3624(be)S
(dumped)252 3750 A
4044(*/)S
2205 V
(20095)210 1122 A
1440({)S
2295 V
(20096)210 1122 A
1440(/*)S
(Make)168 1566 A
1776(a)S
(core)168 1860 A
(dump)168 2070 A
2280(on)S
(the)126 2406 A
(file)168 2574 A
("core",)294 2784 A
3120(if)S
(possible.)378 3246 A
3666(*/)S
2385 V
(20097)210 1122 A
2475 V
(20098)210 1122 A
(int)126 1524 A
1692(s,)S
(fd,)126 1818 A
(seg,)168 1986 A
(slot;)210 2196 A
2565 V
(20099)210 1122 A
(vir_bytes)378 1524 A
(current_sp;)462 1944 A
2655 V
(20100)210 1122 A
(long)168 1524 A
(trace_data,)462 1734 A
(trace_off;)420 2238 A
2745 V
(20101)210 1122 A
2835 V
(20102)210 1122 A
(slot)168 1524 A
1734(=)S
(\(int\))210 1818 A
(\(rmp)168 2070 A
2280(-)S
(mproc\);)294 2364 A
2925 V
(20103)210 1122 A
3015 V
(20104)210 1122 A
1524(/*)S
(Can)126 1650 A
(core)168 1818 A
(file)168 2028 A
2238(be)S
(written?)336 2364 A
2784(We)S
(are)126 2910 A
(operating)378 3078 A
3498(in)S
(the)126 3624 A
(user's)252 3792 A
4086(FS)S
(environment,)504 4212 A
3105 V
(20105)210 1122 A
1566(*)S
1650(so)S
1776(no)S
(special)294 1902 A
(permission)420 2238 A
(checks)252 2700 A
(are)126 2994 A
(needed.)294 3162 A
3195 V
(20106)210 1122 A
1566(*/)S
3285 V
(20107)210 1122 A
1524(if)S
(\(rmp->mp_realuid)672 1650 A
2364(!=)S
(rmp->mp_effuid\))630 2490 A
(return;)294 3162 A
3375 V
(20108)210 1122 A
1524(if)S
1650(\()S
(\(fd)126 1734 A
1902(=)S
(open\(core_name,)630 1986 A
(O_WRONLY)336 2658 A
3036(|)S
(O_CREAT)294 3120 A
3456(|)S
(O_TRUNC)294 3540 A
3876(|)S
(O_NONBLOCK,)462 3960 A
3465 V
(20109)210 1122 A
(CORE_MODE\)\))462 3456 A
3960(<)S
4044(0\))S
(return;)294 4170 A
3555 V
(20110)210 1122 A
(rmp->mp_sigstatus)714 1524 A
2280(|=)S
(DUMPED;)294 2406 A
3645 V
(20111)210 1122 A
3735 V
(20112)210 1122 A
1524(/*)S
(Make)168 1650 A
(sure)168 1860 A
(the)126 2070 A
(stack)210 2238 A
(segment)294 2490 A
2826(is)S
2952(up)S
3078(to)S
(date.)210 3204 A
3825 V
(20113)210 1122 A
1566(*)S
1650(We)S
(don't)210 1776 A
(want)168 2028 A
(adjust\(\))336 2238 A
2616(to)S
(fail)168 2742 A
(unless)252 2952 A
(current_sp)420 3246 A
3708(is)S
(preposterous,)546 3834 A
3915 V
(20114)210 1122 A
1566(*)S
(but)126 1650 A
1818(it)S
(might)210 1944 A
(fail)168 2196 A
(due)126 2406 A
2574(to)S
(safety)252 2700 A
(checking.)378 2994 A
(Also,)210 3456 A
3708(we)S
(don't)210 3834 A
(really)252 4086 A
(want)168 4380 A
4005 V
(20115)210 1122 A
1566(*)S
(the)126 1650 A
(adjust\(\))336 1818 A
(for)126 2196 A
(sending)294 2364 A
2700(a)S
(signal)252 2784 A
3078(to)S
(fail)168 3204 A
(due)126 3414 A
3582(to)S
(safety)252 3708 A
(checking.)378 4002 A
4095 V
(20116)210 1122 A
1566(*)S
(Maybe)210 1650 A
(make)168 1902 A
(SAFETY_BYTES)504 2112 A
2658(a)S
(parameter.)420 2742 A
4185 V
(20117)210 1122 A
1566(*/)S
4275 V
(20118)210 1122 A
1524(if)S
(\(\(s=get_stack_ptr\(slot,)966 1650 A
(&current_sp\)\))546 2658 A
3246(!=)S
(OK\))126 3372 A
4365 V
(20119)210 1122 A
(panic\(__FILE__,"couldn't)1008 1776 A
(get)126 2826 A
(new)126 2994 A
(stack)210 3162 A
(pointer",s\);)504 3414 A
4455 V
(20120)210 1122 A
(adjust\(rmp,)462 1524 A
(rmp->mp_seg[D].mem_len,)966 2028 A
(current_sp\);)504 3036 A
4545 V
(20121)210 1122 A
4635 V
(20122)210 1122 A
1524(/*)S
(Write)210 1650 A
(the)126 1902 A
(memory)252 2070 A
(map)126 2364 A
2532(of)S
(all)126 2658 A
(segments)336 2826 A
3204(to)S
(begin)210 3330 A
(the)126 3582 A
(core)168 3750 A
(file.)210 3960 A
4212(*/)S
4725 V
(20123)210 1122 A
1524(if)S
(\(write\(fd,)420 1650 A
(\(char)210 2112 A
2364(*\))S
(rmp->mp_seg,)504 2490 A
(\(unsigned\))420 3036 A
(sizeof)252 3498 A
(rmp->mp_seg\))504 3792 A
4815 V
(20124)210 1122 A
1692(!=)S
(\(unsigned\))420 1818 A
(sizeof)252 2280 A
(rmp->mp_seg\))504 2574 A
3120({)S
4905 V
(20125)210 1122 A
(close\(fd\);)420 1776 A
4995 V
(20126)210 1122 A
(return;)294 1776 A
5085 V
(20127)210 1122 A
1524(})S
5175 V
(20128)210 1122 A
5265 V
(20129)210 1122 A
1524(/*)S
(Write)210 1650 A
(out)126 1902 A
(the)126 2070 A
(whole)210 2238 A
(kernel)252 2490 A
(process)294 2784 A
(table)210 3120 A
(entry)210 3372 A
3624(to)S
(get)126 3750 A
(the)126 3918 A
(regs.)210 4086 A
4338(*/)S
5355 V
(20130)210 1122 A
(trace_off)378 1524 A
1944(=)S
2028(0;)S
5445 V
(20131)210 1122 A
(while)210 1524 A
(\(sys_trace\(T_GETUSER,)882 1776 A
(slot,)210 2700 A
(trace_off,)420 2952 A
(&trace_data\))504 3414 A
3960(==)S
(OK\))126 4086 A
4254({)S
5535 V
(20132)210 1122 A
1776(if)S
(\(write\(fd,)420 1902 A
(\(char)210 2364 A
2616(*\))S
(&trace_data,)504 2742 A
(\(unsigned\))420 3288 A
(sizeof)252 3750 A
(\(long\)\))294 4044 A
5625 V
(20133)210 1122 A
1944(!=)S
(\(unsigned\))420 2070 A
(sizeof)252 2532 A
(\(long\)\))294 2826 A
3162({)S
5715 V
(20134)210 1122 A
(close\(fd\);)420 2112 A
5805 V
(20135)210 1122 A
(return;)294 2112 A
5895 V
(20136)210 1122 A
1776(})S
5985 V
(20137)210 1122 A
(trace_off)378 1776 A
2196(+=)S
(sizeof)252 2322 A
(\(long\);)294 2616 A
6075 V
(20138)210 1122 A
1524(})S
6165 V
(20139)210 1122 A
6255 V
(20140)210 1122 A
1524(/*)S
(Loop)168 1650 A
(through)294 1860 A
(segments)336 2196 A
(and)126 2574 A
(write)210 2742 A
(the)126 2994 A
(segments)336 3162 A
(themselves)420 3540 A
(out.)168 4002 A
4212(*/)S
6345 V
(20141)210 1122 A
(for)126 1524 A
(\(seg)168 1692 A
1902(=)S
1986(0;)S
(seg)126 2112 A
2280(<)S
(NR_LOCAL_SEGS;)588 2364 A
(seg++\))252 2994 A
3288({)S
6435 V
(20142)210 1122 A
(rw_seg\(1,)378 1776 A
(fd,)126 2196 A
(slot,)210 2364 A
(seg,)168 2616 A
6525 V
(20143)210 1122 A
(\(phys_bytes\))504 2112 A
(rmp->mp_seg[seg].mem_len)1008 2658 A
3708(<<)S
(CLICK_SHIFT\);)546 3834 A
6615 V
(20144)210 1122 A
1524(})S
6705 V
(20145)210 1122 A
(close\(fd\);)420 1524 A
6795 V
(20146)210 1122 A
1440(})S
8418 V
EP
%%Page: 271 271
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2326(File:)S
(servers/pm/timers.c)874 2559 A
12 B
(271)180 4500 A
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(servers/pm/timers.c)798 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(20200)210 1122 A
1440(/*)S
1566(PM)S
(watchdog)336 1692 A
(timer)210 2070 A
(management.)462 2322 A
(These)210 2826 A
(functions)378 3078 A
3498(in)S
(this)168 3624 A
(file)168 3834 A
(provide)294 4044 A
2295 V
(20201)210 1122 A
1482(*)S
1566(a)S
(convenient)420 1650 A
(interface)378 2112 A
2532(to)S
(the)126 2658 A
(timers)252 2826 A
(library)294 3120 A
(that)168 3456 A
(manages)294 3666 A
4002(a)S
(list)168 4086 A
4296(of)S
2385 V
(20202)210 1122 A
1482(*)S
(watchdog)336 1566 A
(timers.)294 1944 A
(All)126 2280 A
(details)294 2448 A
2784(of)S
(scheduling)420 2910 A
3372(an)S
(alarm)210 3498 A
3750(at)S
(the)126 3876 A
(CLOCK)210 4044 A
(task)168 4296 A
2475 V
(20203)210 1122 A
1482(*)S
(are)126 1566 A
(hidden)252 1734 A
(behind)252 2028 A
(this)168 2322 A
(interface.)420 2532 A
2565 V
(20204)210 1122 A
1482(*)S
(Only)168 1566 A
(system)252 1776 A
(processes)378 2070 A
(are)126 2490 A
(allowed)294 2658 A
2994(to)S
(set)126 3120 A
3288(an)S
(alarm)210 3414 A
(timer)210 3666 A
3918(at)S
(the)126 4044 A
(kernel.)294 4212 A
2655 V
(20205)210 1122 A
1482(*)S
(Therefore,)420 1566 A
(the)126 2028 A
2196(PM)S
(maintains)378 2322 A
2742(a)S
(local)210 2826 A
(list)168 3078 A
3288(of)S
(timers)252 3414 A
(for)126 3708 A
(user)168 3876 A
(processes)378 4086 A
2745 V
(20206)210 1122 A
1482(*)S
(that)168 1566 A
(requested)378 1776 A
2196(an)S
(alarm)210 2322 A
(signal.)294 2574 A
2835 V
(20207)210 1122 A
1482(*)S
2925 V
(20208)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are:)168 2910 A
3015 V
(20209)210 1122 A
1482(*)S
(pm_set_timer:)546 1650 A
(reset)210 2448 A
(and)126 2700 A
(existing)336 2868 A
3246(or)S
(set)126 3372 A
3540(a)S
(new)126 3624 A
(watchdog)336 3792 A
(timer)210 4170 A
3105 V
(20210)210 1122 A
1482(*)S
(pm_expire_timers:)714 1650 A
(check)210 2448 A
(for)126 2700 A
(expired)294 2868 A
(timers)252 3204 A
(and)126 3498 A
(run)126 3666 A
(watchdog)336 3834 A
(functions)378 4212 A
3195 V
(20211)210 1122 A
1482(*)S
(pm_cancel_timer:)672 1650 A
(remove)252 2448 A
2742(a)S
(time)168 2826 A
(from)168 3036 A
(the)126 3246 A
(list)168 3414 A
3624(of)S
(timers)252 3750 A
3285 V
(20212)210 1122 A
1482(*)S
3375 V
(20213)210 1122 A
1482(*/)S
3465 V
(20214)210 1122 A
3555 V
(20215)210 1122 A
(#include)336 1440 A
("pm.h")252 1818 A
3645 V
(20216)210 1122 A
3735 V
(20217)210 1122 A
(#include)336 1440 A
(<timers.h>)420 1818 A
3825 V
(20218)210 1122 A
(#include)336 1440 A
(<minix/syslib.h>)672 1818 A
3915 V
(20219)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
4005 V
(20220)210 1122 A
4095 V
(20221)210 1122 A
(PRIVATE)294 1440 A
(timer_t)294 1776 A
(*pm_timers)420 2112 A
2574(=)S
(NULL;)210 2658 A
4185 V
(20222)210 1122 A
4275 V
(20223)210 1122 A
(/*===========================================================================*)3276 1440 A
4365 V
(20224)210 1122 A
1482(*)S
(pm_set_timer)504 2784 A
4674(*)S
4455 V
(20225)210 1122 A
(*===========================================================================*/)3276 1482 A
4545 V
(20226)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(pm_set_timer\(timer_t)840 1944 A
(*tp,)168 2826 A
(int)126 3036 A
(ticks,)252 3204 A
(tmr_func_t)420 3498 A
(watchdog,)378 3960 A
(int)126 4380 A
(arg\))168 4548 A
4635 V
(20227)210 1122 A
1440({)S
4725 V
(20228)210 1122 A
(int)126 1776 A
1944(r;)S
4815 V
(20229)210 1122 A
(clock_t)294 1776 A
(now,)168 2112 A
(prev_time)378 2322 A
2742(=)S
2826(0,)S
(next_time;)420 2952 A
4905 V
(20230)210 1122 A
4995 V
(20231)210 1122 A
1776(if)S
(\(\(r)126 1902 A
2070(=)S
(getuptime\(&now\)\))672 2154 A
2868(!=)S
(OK\))126 2994 A
5085 V
(20232)210 1122 A
(panic\(__FILE__,)630 2112 A
("PM)126 2784 A
(couldn't)336 2952 A
(get)126 3330 A
(uptime",)336 3498 A
(NO_NUM\);)336 3876 A
5175 V
(20233)210 1122 A
5265 V
(20234)210 1122 A
1776(/*)S
(Set)126 1902 A
(timer)210 2070 A
(argument)336 2322 A
(and)126 2700 A
(add)126 2868 A
(timer)210 3036 A
3288(to)S
(the)126 3414 A
(list.)210 3582 A
3834(*/)S
5355 V
(20235)210 1122 A
(tmr_arg\(tp\)->ta_int)798 1776 A
2616(=)S
(arg;)168 2700 A
5445 V
(20236)210 1122 A
(prev_time)378 1776 A
2196(=)S
(tmrs_settimer\(&pm_timers,tp,now+ticks,watchdog,&next_time\);)2478 2280 A
5535 V
(20237)210 1122 A
5625 V
(20238)210 1122 A
1776(/*)S
(Reschedule)420 1902 A
(our)126 2364 A
(synchronous)462 2532 A
(alarm)210 3036 A
3288(if)S
(necessary.)420 3414 A
3876(*/)S
5715 V
(20239)210 1122 A
1776(if)S
1902(\(!)S
(prev_time)378 2028 A
2448(||)S
(prev_time)378 2574 A
2994(>)S
(next_time\))420 3078 A
3540({)S
5805 V
(20240)210 1122 A
2112(if)S
(\(sys_setalarm\(next_time,)1008 2238 A
3288(1\))S
3414(!=)S
(OK\))126 3540 A
5895 V
(20241)210 1122 A
(panic\(__FILE__,)630 2448 A
("PM)126 3120 A
(set)126 3288 A
(timer)210 3456 A
(couldn't)336 3708 A
(set)126 4086 A
(alarm.",)336 4254 A
(NO_NUM\);)336 4632 A
5985 V
(20242)210 1122 A
1776(})S
6075 V
(20243)210 1122 A
6165 V
(20244)210 1122 A
(return;)294 1776 A
6255 V
(20245)210 1122 A
1440(})S
6435 V
(20247)210 1122 A
(/*===========================================================================*)3276 1440 A
6525 V
(20248)210 1122 A
1482(*)S
(pm_expire_timers)672 2784 A
4674(*)S
6615 V
(20249)210 1122 A
(*===========================================================================*/)3276 1482 A
6705 V
(20250)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(pm_expire_timers\(clock_t)1008 1944 A
(now\))168 2994 A
6795 V
(20251)210 1122 A
1440({)S
6885 V
(20252)210 1122 A
(clock_t)294 1776 A
(next_time;)420 2112 A
6975 V
(20253)210 1122 A
7065 V
(20254)210 1122 A
1776(/*)S
(Check)210 1902 A
(for)126 2154 A
(expired)294 2322 A
(timers)252 2658 A
(and)126 2952 A
(possibly)336 3120 A
(reschedule)420 3498 A
3960(an)S
(alarm.)252 4086 A
4380(*/)S
8418 V
EP
%%Page: 272 272
BP
/slant 0 def
/height 0 def
1485 V
12 B
(272)180 1080 A
11 R
2326(File:)S
(servers/pm/timers.c)874 2559 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(20255)210 1122 A
(tmrs_exptimers\(&pm_timers,)1092 1776 A
(now,)168 2910 A
(&next_time\);)504 3120 A
1845 V
(20256)210 1122 A
1776(if)S
(\(next_time)420 1902 A
2364(>)S
2448(0\))S
2574({)S
1935 V
(20257)210 1122 A
2112(if)S
(\(sys_setalarm\(next_time,)1008 2238 A
3288(1\))S
3414(!=)S
(OK\))126 3540 A
2025 V
(20258)210 1122 A
(panic\(__FILE__,)630 2448 A
("PM)126 3120 A
(expire)252 3288 A
(timer)210 3582 A
(couldn't)336 3834 A
(set)126 4212 A
(alarm.",)336 4380 A
(NO_NUM\);)336 4758 A
2115 V
(20259)210 1122 A
1776(})S
2205 V
(20260)210 1122 A
1440(})S
2385 V
(20262)210 1122 A
(/*===========================================================================*)3276 1440 A
2475 V
(20263)210 1122 A
1482(*)S
(pm_cancel_timer)630 2784 A
4674(*)S
2565 V
(20264)210 1122 A
(*===========================================================================*/)3276 1482 A
2655 V
(20265)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(pm_cancel_timer\(timer_t)966 1944 A
(*tp\))168 2952 A
2745 V
(20266)210 1122 A
1440({)S
2835 V
(20267)210 1122 A
(clock_t)294 1776 A
(next_time,)420 2112 A
(prev_time;)420 2574 A
2925 V
(20268)210 1122 A
(prev_time)378 1776 A
2196(=)S
(tmrs_clrtimer\(&pm_timers,)1050 2280 A
(tp,)126 3372 A
(&next_time\);)504 3540 A
3015 V
(20269)210 1122 A
3105 V
(20270)210 1122 A
1776(/*)S
1902(If)S
(the)126 2028 A
(earliest)336 2196 A
(timer)210 2574 A
(has)126 2826 A
(been)168 2994 A
(removed,)336 3204 A
3582(we)S
(have)168 3708 A
3918(to)S
(set)126 4044 A
(the)126 4212 A
(alarm)210 4380 A
4632(to)S
3195 V
(20271)210 1122 A
1650(*)S
(the)126 1734 A
(next)168 1902 A
(timer,)252 2112 A
2406(or)S
(cancel)252 2532 A
(the)126 2826 A
(alarm)210 2994 A
(altogether)420 3246 A
3708(if)S
(the)126 3834 A
(last)168 4002 A
(timer)210 4212 A
(has)126 4464 A
3285 V
(20272)210 1122 A
1650(*)S
(been)168 1734 A
(cancelled)378 1944 A
(\(next_time)420 2364 A
(will)168 2826 A
3036(be)S
3162(0)S
(then\).)252 3246 A
3375 V
(20273)210 1122 A
1818(*/)S
3465 V
(20274)210 1122 A
1776(if)S
(\(prev_time)420 1902 A
2364(<)S
(next_time)378 2448 A
2868(||)S
2994(!)S
(next_time\))420 3078 A
3540({)S
3555 V
(20275)210 1122 A
2112(if)S
(\(sys_setalarm\(next_time,)1008 2238 A
3288(1\))S
3414(!=)S
(OK\))126 3540 A
3645 V
(20276)210 1122 A
(panic\(__FILE__,)630 2448 A
("PM)126 3120 A
(expire)252 3288 A
(timer)210 3582 A
(couldn't)336 3834 A
(set)126 4212 A
(alarm.",)336 4380 A
(NO_NUM\);)336 4758 A
3735 V
(20277)210 1122 A
1776(})S
3825 V
(20278)210 1122 A
1440(})S
4095 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4185 V
(servers/pm/time.c)714 2676 A
4275 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4455 V
(20300)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(takes)210 1986 A
(care)168 2238 A
2448(of)S
(those)210 2574 A
(system)252 2826 A
(calls)210 3120 A
(that)168 3372 A
(deal)168 3582 A
(with)168 3792 A
(time.)210 4002 A
4545 V
(20301)210 1122 A
1482(*)S
4635 V
(20302)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are)126 2910 A
4725 V
(20303)210 1122 A
1482(*)S
(do_time:)336 1650 A
(perform)294 2448 A
(the)126 2784 A
(TIME)168 2952 A
(system)252 3162 A
(call)168 3456 A
4815 V
(20304)210 1122 A
1482(*)S
(do_stime:)378 1650 A
(perform)294 2448 A
(the)126 2784 A
(STIME)210 2952 A
(system)252 3204 A
(call)168 3498 A
4905 V
(20305)210 1122 A
1482(*)S
(do_times:)378 1650 A
(perform)294 2448 A
(the)126 2784 A
(TIMES)210 2952 A
(system)252 3204 A
(call)168 3498 A
4995 V
(20306)210 1122 A
1482(*/)S
5085 V
(20307)210 1122 A
5175 V
(20308)210 1122 A
(#include)336 1440 A
("pm.h")252 1818 A
5265 V
(20309)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
5355 V
(20310)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
5445 V
(20311)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
5535 V
(20312)210 1122 A
(#include)336 1440 A
("mproc.h")378 1818 A
5625 V
(20313)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
5715 V
(20314)210 1122 A
5805 V
(20315)210 1122 A
(PRIVATE)294 1440 A
(time_t)252 1776 A
(boottime;)378 2070 A
5895 V
(20316)210 1122 A
5985 V
(20317)210 1122 A
(/*===========================================================================*)3276 1440 A
6075 V
(20318)210 1122 A
1482(*)S
(do_time)294 2784 A
4674(*)S
6165 V
(20319)210 1122 A
(*===========================================================================*/)3276 1482 A
6255 V
(20320)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_time\(\))378 1902 A
6345 V
(20321)210 1122 A
1440({)S
6435 V
(20322)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(time\(tp\))336 2070 A
(system)252 2448 A
(call.)210 2742 A
(This)168 2994 A
(returns)294 3204 A
(the)126 3540 A
(time)168 3708 A
3918(in)S
(seconds)294 4044 A
(since)210 4380 A
6525 V
(20323)210 1122 A
1482(*)S
(1.1.1970.)378 1566 A
(MINIX)210 2028 A
2280(is)S
2406(an)S
(astrophysically)630 2532 A
(naive)210 3204 A
(system)252 3456 A
(that)168 3750 A
(assumes)294 3960 A
(the)126 4296 A
(earth)210 4464 A
6615 V
(20324)210 1122 A
1482(*)S
(rotates)294 1566 A
1902(at)S
2028(a)S
(constant)336 2112 A
(rate)168 2490 A
(and)126 2700 A
(that)168 2868 A
(such)168 3078 A
(things)252 3288 A
3582(as)S
(leap)168 3708 A
(seconds)294 3918 A
4254(do)S
(not)126 4380 A
6705 V
(20325)210 1122 A
1482(*)S
(exist.)252 1566 A
6795 V
(20326)210 1122 A
1482(*/)S
6885 V
(20327)210 1122 A
(clock_t)294 1524 A
(uptime;)294 1860 A
6975 V
(20328)210 1122 A
(int)126 1524 A
1692(s;)S
7065 V
(20329)210 1122 A
8418 V
EP
%%Page: 273 273
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2366(File:)S
(servers/pm/time.c)794 2599 A
12 B
(273)180 4500 A
1755 V
7 LST
(20330)210 1122 A
1524(if)S
1650(\()S
(\(s=getuptime\(&uptime\)\))924 1734 A
2700(!=)S
(OK\))126 2826 A
1845 V
(20331)210 1122 A
(panic\(__FILE__,"do_time)966 1776 A
(couldn't)336 2784 A
(get)126 3162 A
(uptime",)336 3330 A
(s\);)126 3708 A
1935 V
(20332)210 1122 A
2025 V
(20333)210 1122 A
(mp->mp_reply.reply_time)966 1524 A
2532(=)S
(\(time_t\))336 2616 A
(\(boottime)378 2994 A
3414(+)S
(\(uptime/HZ\)\);)546 3498 A
2115 V
(20334)210 1122 A
(mp->mp_reply.reply_utime)1008 1524 A
2574(=)S
(\(uptime%HZ\)*1000000/HZ;)966 2658 A
2205 V
(20335)210 1122 A
(return\(OK\);)462 1524 A
2295 V
(20336)210 1122 A
1440(})S
2475 V
(20338)210 1122 A
(/*===========================================================================*)3276 1440 A
2565 V
(20339)210 1122 A
1482(*)S
(do_stime)336 2784 A
4674(*)S
2655 V
(20340)210 1122 A
(*===========================================================================*/)3276 1482 A
2745 V
(20341)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_stime\(\))420 1902 A
2835 V
(20342)210 1122 A
1440({)S
2925 V
(20343)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(stime\(tp\))378 2070 A
(system)252 2490 A
(call.)210 2784 A
(Retrieve)336 3036 A
(the)126 3414 A
(system's)336 3582 A
(uptime)252 3960 A
(\(ticks)252 4254 A
3015 V
(20344)210 1122 A
1482(*)S
(since)210 1566 A
(boot\))210 1818 A
(and)126 2070 A
(store)210 2238 A
(the)126 2490 A
(time)168 2658 A
2868(in)S
(seconds)294 2994 A
3330(at)S
(system)252 3456 A
(boot)168 3750 A
3960(in)S
(the)126 4086 A
(global)252 4254 A
3105 V
(20345)210 1122 A
1482(*)S
(variable)336 1566 A
('boottime'.)462 1944 A
3195 V
(20346)210 1122 A
1482(*/)S
3285 V
(20347)210 1122 A
(clock_t)294 1524 A
(uptime;)294 1860 A
3375 V
(20348)210 1122 A
(int)126 1524 A
1692(s;)S
3465 V
(20349)210 1122 A
3555 V
(20350)210 1122 A
1524(if)S
(\(mp->mp_effuid)588 1650 A
2280(!=)S
(SUPER_USER\))462 2406 A
2910({)S
3645 V
(20351)210 1122 A
(return\(EPERM\);)588 1692 A
3735 V
(20352)210 1122 A
1524(})S
3825 V
(20353)210 1122 A
1524(if)S
1650(\()S
(\(s=getuptime\(&uptime\)\))924 1734 A
2700(!=)S
(OK\))126 2826 A
3915 V
(20354)210 1122 A
(panic\(__FILE__,"do_stime)1008 1692 A
(couldn't)336 2742 A
(get)126 3120 A
(uptime",)336 3288 A
(s\);)126 3666 A
4005 V
(20355)210 1122 A
(boottime)336 1524 A
1902(=)S
(\(long\))252 1986 A
(m_in.stime)420 2280 A
2742(-)S
(\(uptime/HZ\);)504 2826 A
4095 V
(20356)210 1122 A
4185 V
(20357)210 1122 A
1524(/*)S
(Also)168 1650 A
(inform)252 1860 A
2154(FS)S
(about)210 2280 A
(the)126 2532 A
(new)126 2700 A
(system)252 2868 A
(time.)210 3162 A
3414(*/)S
4275 V
(20358)210 1122 A
(tell_fs\(STIME,)588 1524 A
(boottime,)378 2154 A
2574(0,)S
(0\);)126 2700 A
4365 V
(20359)210 1122 A
4455 V
(20360)210 1122 A
(return\(OK\);)462 1524 A
4545 V
(20361)210 1122 A
1440(})S
4725 V
(20363)210 1122 A
(/*===========================================================================*)3276 1440 A
4815 V
(20364)210 1122 A
1482(*)S
(do_times)336 2784 A
4674(*)S
4905 V
(20365)210 1122 A
(*===========================================================================*/)3276 1482 A
4995 V
(20366)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_times\(\))420 1902 A
5085 V
(20367)210 1122 A
1440({)S
5175 V
(20368)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(times\(buffer\))546 2070 A
(system)252 2658 A
(call.)210 2952 A
3204(*/)S
5265 V
(20369)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rmp)168 2448 A
2658(=)S
(mp;)126 2742 A
5355 V
(20370)210 1122 A
(clock_t)294 1524 A
(t[5];)210 1860 A
5445 V
(20371)210 1122 A
(int)126 1524 A
1692(s;)S
5535 V
(20372)210 1122 A
5625 V
(20373)210 1122 A
1524(if)S
(\(OK)126 1650 A
1818(!=)S
(\(s=sys_times\(who,)714 1944 A
(t\)\)\))168 2700 A
5715 V
(20374)210 1122 A
(panic\(__FILE__,"do_times)1008 1692 A
(couldn't)336 2742 A
(get)126 3120 A
(times",)294 3288 A
(s\);)126 3624 A
5805 V
(20375)210 1122 A
(rmp->mp_reply.reply_t1)924 1524 A
2490(=)S
(t[0];)210 2574 A
3456(/*)S
(user)168 3582 A
(time)168 3792 A
4002(*/)S
5895 V
(20376)210 1122 A
(rmp->mp_reply.reply_t2)924 1524 A
2490(=)S
(t[1];)210 2574 A
3456(/*)S
(system)252 3582 A
(time)168 3876 A
4086(*/)S
5985 V
(20377)210 1122 A
(rmp->mp_reply.reply_t3)924 1524 A
2490(=)S
(rmp->mp_child_utime;)840 2574 A
3456(/*)S
(child)210 3582 A
(user)168 3834 A
(time)168 4044 A
4254(*/)S
6075 V
(20378)210 1122 A
(rmp->mp_reply.reply_t4)924 1524 A
2490(=)S
(rmp->mp_child_stime;)840 2574 A
3456(/*)S
(child)210 3582 A
(system)252 3834 A
(time)168 4128 A
4338(*/)S
6165 V
(20379)210 1122 A
(rmp->mp_reply.reply_t5)924 1524 A
2490(=)S
(t[4];)210 2574 A
3456(/*)S
(uptime)252 3582 A
(since)210 3876 A
(boot)168 4128 A
4338(*/)S
6255 V
(20380)210 1122 A
6345 V
(20381)210 1122 A
(return\(OK\);)462 1524 A
6435 V
(20382)210 1122 A
1440(})S
8418 V
EP
%%Page: 274 274
BP
/slant 0 def
/height 0 def
1485 V
12 B
(274)180 1080 A
11 R
2335(File:)S
2568(servers/pm/getset.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(servers/pm/getset.c)798 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(20400)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(handles)294 1986 A
(the)126 2322 A
2490(4)S
(system)252 2574 A
(calls)210 2868 A
(that)168 3120 A
(get)126 3330 A
(and)126 3498 A
(set)126 3666 A
(uids)168 3834 A
(and)126 4044 A
(gids.)210 4212 A
2295 V
(20401)210 1122 A
1482(*)S
1566(It)S
(also)168 1692 A
(handles)294 1902 A
(getpid\(\),)378 2238 A
(setsid\(\),)378 2658 A
(and)126 3078 A
(getpgrp\(\).)420 3246 A
(The)126 3750 A
(code)168 3918 A
(for)126 4128 A
(each)168 4296 A
2385 V
(20402)210 1122 A
1482(*)S
(one)126 1566 A
1734(is)S
1860(so)S
(tiny)168 1986 A
(that)168 2196 A
2406(it)S
(hardly)252 2532 A
(seemed)252 2826 A
(worthwhile)420 3120 A
3582(to)S
(make)168 3708 A
(each)168 3918 A
4128(a)S
(separate)336 4212 A
2475 V
(20403)210 1122 A
1482(*)S
(function.)378 1566 A
2565 V
(20404)210 1122 A
1482(*/)S
2655 V
(20405)210 1122 A
2745 V
(20406)210 1122 A
(#include)336 1440 A
("pm.h")252 1818 A
2835 V
(20407)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
2925 V
(20408)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
3015 V
(20409)210 1122 A
(#include)336 1440 A
("mproc.h")378 1818 A
3105 V
(20410)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
3195 V
(20411)210 1122 A
3285 V
(20412)210 1122 A
(/*===========================================================================*)3276 1440 A
3375 V
(20413)210 1122 A
1482(*)S
(do_getset)378 2784 A
4674(*)S
3465 V
(20414)210 1122 A
(*===========================================================================*/)3276 1482 A
3555 V
(20415)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_getset\(\))462 1902 A
3645 V
(20416)210 1122 A
1440({)S
3735 V
(20417)210 1122 A
1440(/*)S
(Handle)252 1566 A
(GETUID,)294 1860 A
(GETGID,)294 2196 A
(GETPID,)294 2532 A
(GETPGRP,)336 2868 A
(SETUID,)294 3246 A
(SETGID,)294 3582 A
(SETSID.)294 3918 A
(The)126 4296 A
(four)168 4464 A
3825 V
(20418)210 1122 A
1482(*)S
(GETs)168 1566 A
(and)126 1776 A
(SETSID)252 1944 A
(return)252 2238 A
(their)210 2532 A
(primary)294 2784 A
(results)294 3120 A
3456(in)S
('r'.)168 3582 A
(GETUID,)294 3834 A
(GETGID,)294 4170 A
(and)126 4506 A
3915 V
(20419)210 1122 A
1482(*)S
(GETPID)252 1566 A
(also)168 1860 A
(return)252 2070 A
(secondary)378 2364 A
(results)294 2784 A
(\(the)168 3120 A
(effective)378 3330 A
(IDs,)168 3750 A
3960(or)S
(the)126 4086 A
(parent)252 4254 A
4005 V
(20420)210 1122 A
1482(*)S
(process)294 1566 A
(ID\))126 1902 A
2070(in)S
('reply_res2',)546 2196 A
(which)210 2784 A
3036(is)S
(returned)336 3162 A
3540(to)S
(the)126 3666 A
(user.)210 3834 A
4095 V
(20421)210 1122 A
1482(*/)S
4185 V
(20422)210 1122 A
4275 V
(20423)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rmp)168 2448 A
2658(=)S
(mp;)126 2742 A
4365 V
(20424)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(r;)S
4455 V
(20425)210 1122 A
4545 V
(20426)210 1122 A
(switch\(call_nr\))630 1524 A
2196({)S
4635 V
(20427)210 1122 A
(case)168 1776 A
(GETUID:)294 1986 A
4725 V
(20428)210 1122 A
2112(r)S
2196(=)S
(rmp->mp_realuid;)672 2280 A
4815 V
(20429)210 1122 A
(rmp->mp_reply.reply_res2)1008 2112 A
3162(=)S
(rmp->mp_effuid;)630 3246 A
4905 V
(20430)210 1122 A
(break;)252 2112 A
4995 V
(20431)210 1122 A
5085 V
(20432)210 1122 A
(case)168 1776 A
(GETGID:)294 1986 A
5175 V
(20433)210 1122 A
2112(r)S
2196(=)S
(rmp->mp_realgid;)672 2280 A
5265 V
(20434)210 1122 A
(rmp->mp_reply.reply_res2)1008 2112 A
3162(=)S
(rmp->mp_effgid;)630 3246 A
5355 V
(20435)210 1122 A
(break;)252 2112 A
5445 V
(20436)210 1122 A
5535 V
(20437)210 1122 A
(case)168 1776 A
(GETPID:)294 1986 A
5625 V
(20438)210 1122 A
2112(r)S
2196(=)S
(mproc[who].mp_pid;)756 2280 A
5715 V
(20439)210 1122 A
(rmp->mp_reply.reply_res2)1008 2112 A
3162(=)S
(mproc[rmp->mp_parent].mp_pid;)1218 3246 A
5805 V
(20440)210 1122 A
(break;)252 2112 A
5895 V
(20441)210 1122 A
5985 V
(20442)210 1122 A
(case)168 1776 A
(SETUID:)294 1986 A
6075 V
(20443)210 1122 A
2112(if)S
(\(rmp->mp_realuid)672 2238 A
2952(!=)S
(\(uid_t\))294 3078 A
(m_in.usr_id)462 3414 A
3918(&&)S
6165 V
(20444)210 1122 A
(rmp->mp_effuid)588 2784 A
3414(!=)S
(SUPER_USER\))462 3540 A
6255 V
(20445)210 1122 A
(return\(EPERM\);)588 2448 A
6345 V
(20446)210 1122 A
(rmp->mp_realuid)630 2112 A
2784(=)S
(\(uid_t\))294 2868 A
(m_in.usr_id;)504 3204 A
6435 V
(20447)210 1122 A
(rmp->mp_effuid)588 2112 A
2742(=)S
(\(uid_t\))294 2826 A
(m_in.usr_id;)504 3162 A
6525 V
(20448)210 1122 A
(tell_fs\(SETUID,)630 2112 A
(who,)168 2784 A
(rmp->mp_realuid,)672 2994 A
(rmp->mp_effuid\);)672 3708 A
6615 V
(20449)210 1122 A
2112(r)S
2196(=)S
(OK;)126 2280 A
6705 V
(20450)210 1122 A
(break;)252 2112 A
6795 V
(20451)210 1122 A
6885 V
(20452)210 1122 A
(case)168 1776 A
(SETGID:)294 1986 A
6975 V
(20453)210 1122 A
2112(if)S
(\(rmp->mp_realgid)672 2238 A
2952(!=)S
(\(gid_t\))294 3078 A
(m_in.grp_id)462 3414 A
3918(&&)S
7065 V
(20454)210 1122 A
(rmp->mp_effuid)588 2784 A
3414(!=)S
(SUPER_USER\))462 3540 A
8418 V
EP
%%Page: 275 275
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2335(File:)S
2568(servers/pm/getset.c)S
12 B
(275)180 4500 A
1755 V
7 LST
(20455)210 1122 A
(return\(EPERM\);)588 2448 A
1845 V
(20456)210 1122 A
(rmp->mp_realgid)630 2112 A
2784(=)S
(\(gid_t\))294 2868 A
(m_in.grp_id;)504 3204 A
1935 V
(20457)210 1122 A
(rmp->mp_effgid)588 2112 A
2742(=)S
(\(gid_t\))294 2826 A
(m_in.grp_id;)504 3162 A
2025 V
(20458)210 1122 A
(tell_fs\(SETGID,)630 2112 A
(who,)168 2784 A
(rmp->mp_realgid,)672 2994 A
(rmp->mp_effgid\);)672 3708 A
2115 V
(20459)210 1122 A
2112(r)S
2196(=)S
(OK;)126 2280 A
2205 V
(20460)210 1122 A
(break;)252 2112 A
2295 V
(20461)210 1122 A
2385 V
(20462)210 1122 A
(case)168 1776 A
(SETSID:)294 1986 A
2475 V
(20463)210 1122 A
2112(if)S
(\(rmp->mp_procgrp)672 2238 A
2952(==)S
(rmp->mp_pid\))504 3078 A
(return\(EPERM\);)588 3624 A
2565 V
(20464)210 1122 A
(rmp->mp_procgrp)630 2112 A
2784(=)S
(rmp->mp_pid;)504 2868 A
2655 V
(20465)210 1122 A
(tell_fs\(SETSID,)630 2112 A
(who,)168 2784 A
2994(0,)S
(0\);)126 3120 A
2745 V
(20466)210 1122 A
2112(/*)S
(fall)168 2238 A
(through)294 2448 A
2784(*/)S
2835 V
(20467)210 1122 A
2925 V
(20468)210 1122 A
(case)168 1776 A
(GETPGRP:)336 1986 A
3015 V
(20469)210 1122 A
2112(r)S
2196(=)S
(rmp->mp_procgrp;)672 2280 A
3105 V
(20470)210 1122 A
(break;)252 2112 A
3195 V
(20471)210 1122 A
3285 V
(20472)210 1122 A
(default:)336 1776 A
3375 V
(20473)210 1122 A
2112(r)S
2196(=)S
(EINVAL;)294 2280 A
3465 V
(20474)210 1122 A
(break;)252 2112 A
3555 V
(20475)210 1122 A
1524(})S
3645 V
(20476)210 1122 A
(return\(r\);)420 1524 A
3735 V
(20477)210 1122 A
1440(})S
4095 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4185 V
(servers/pm/misc.c)714 2676 A
4275 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4455 V
(20500)210 1122 A
1440(/*)S
(Miscellaneous)546 1566 A
(system)252 2154 A
(calls.)252 2448 A
(Author:)294 3792 A
(Kees)168 4128 A
4338(J.)S
(Bot)126 4464 A
4545 V
(20501)210 1122 A
1482(*)S
4128(31)S
(Mar)126 4254 A
(2000)168 4422 A
4635 V
(20502)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are:)168 2910 A
4725 V
(20503)210 1122 A
1482(*)S
(do_reboot:)420 1650 A
(kill)168 2112 A
(all)126 2322 A
(processes,)420 2490 A
(then)168 2952 A
(reboot)252 3162 A
(system)252 3456 A
4815 V
(20504)210 1122 A
1482(*)S
(do_svrctl:)420 1650 A
(process)294 2112 A
(manager)294 2448 A
(control)294 2784 A
4905 V
(20505)210 1122 A
1482(*)S
(do_getsysinfo:)588 1650 A
(request)294 2280 A
(copy)168 2616 A
2826(of)S
2952(PM)S
(data)168 3078 A
(structure)378 3288 A
(\(Jorrit)294 3750 A
4086(N.)S
(Herder\))294 4212 A
4995 V
(20506)210 1122 A
1482(*)S
(do_getprocnr:)546 1650 A
(lookup)252 2238 A
(process)294 2532 A
(slot)168 2868 A
(number)252 3078 A
(\(Jorrit)294 3414 A
3750(N.)S
(Herder\))294 3876 A
5085 V
(20507)210 1122 A
1482(*)S
(do_memalloc:)504 1650 A
(allocate)336 2196 A
2574(a)S
(chunk)210 2658 A
2910(of)S
(memory)252 3036 A
(\(Jorrit)294 3372 A
3708(N.)S
(Herder\))294 3834 A
5175 V
(20508)210 1122 A
1482(*)S
(do_memfree:)462 1650 A
(deallocate)420 2154 A
2616(a)S
(chunk)210 2700 A
2952(of)S
(memory)252 3078 A
(\(Jorrit)294 3414 A
3750(N.)S
(Herder\))294 3876 A
5265 V
(20509)210 1122 A
1482(*)S
(do_getsetpriority:)756 1650 A
(get/set)294 2448 A
(process)294 2784 A
(priority)336 3120 A
5355 V
(20510)210 1122 A
1482(*/)S
5445 V
(20511)210 1122 A
5535 V
(20512)210 1122 A
(#include)336 1440 A
("pm.h")252 1818 A
5625 V
(20513)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
5715 V
(20514)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
5805 V
(20515)210 1122 A
(#include)336 1440 A
(<sys/svrctl.h>)588 1818 A
5895 V
(20516)210 1122 A
(#include)336 1440 A
(<sys/resource.h>)672 1818 A
5985 V
(20517)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
6075 V
(20518)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
6165 V
(20519)210 1122 A
(#include)336 1440 A
("mproc.h")378 1818 A
6255 V
(20520)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
6345 V
(20521)210 1122 A
6435 V
(20522)210 1122 A
(/*===========================================================================*)3276 1440 A
6525 V
(20523)210 1122 A
1482(*)S
(do_allocmem)462 2784 A
4674(*)S
6615 V
(20524)210 1122 A
(*===========================================================================*/)3276 1482 A
6705 V
(20525)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_allocmem\(\))546 1902 A
6795 V
(20526)210 1122 A
1440({)S
6885 V
(20527)210 1122 A
(vir_clicks)420 1524 A
(mem_clicks;)462 1986 A
6975 V
(20528)210 1122 A
(phys_clicks)462 1524 A
(mem_base;)378 2028 A
7065 V
(20529)210 1122 A
8418 V
EP
%%Page: 276 276
BP
/slant 0 def
/height 0 def
1485 V
12 B
(276)180 1080 A
11 R
2360(File:)S
2593(servers/pm/misc.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(20530)210 1122 A
(mem_clicks)420 1524 A
1986(=)S
(\(m_in.memsize)546 2070 A
2658(+)S
(CLICK_SIZE)420 2742 A
3204(-1)S
3330(\))S
3414(>>)S
(CLICK_SHIFT;)504 3540 A
1845 V
(20531)210 1122 A
(mem_base)336 1524 A
1902(=)S
(alloc_mem\(mem_clicks\);)924 1986 A
1935 V
(20532)210 1122 A
1524(if)S
(\(mem_base)378 1650 A
2070(==)S
(NO_MEM\))294 2196 A
(return\(ENOMEM\);)630 2532 A
2025 V
(20533)210 1122 A
(mp->mp_reply.membase)840 1524 A
2406(=)S
(\(phys_bytes\))504 2532 A
(\(mem_base)378 3078 A
3498(<<)S
(CLICK_SHIFT\);)546 3624 A
2115 V
(20534)210 1122 A
(return\(OK\);)462 1524 A
2205 V
(20535)210 1122 A
1440(})S
2385 V
(20537)210 1122 A
(/*===========================================================================*)3276 1440 A
2475 V
(20538)210 1122 A
1482(*)S
(do_freemem)420 2784 A
4674(*)S
2565 V
(20539)210 1122 A
(*===========================================================================*/)3276 1482 A
2655 V
(20540)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_freemem\(\))504 1902 A
2745 V
(20541)210 1122 A
1440({)S
2835 V
(20542)210 1122 A
(vir_clicks)420 1524 A
(mem_clicks;)462 1986 A
2925 V
(20543)210 1122 A
(phys_clicks)462 1524 A
(mem_base;)378 2028 A
3015 V
(20544)210 1122 A
3105 V
(20545)210 1122 A
(mem_clicks)420 1524 A
1986(=)S
(\(m_in.memsize)546 2070 A
2658(+)S
(CLICK_SIZE)420 2742 A
3204(-1)S
3330(\))S
3414(>>)S
(CLICK_SHIFT;)504 3540 A
3195 V
(20546)210 1122 A
(mem_base)336 1524 A
1902(=)S
(\(m_in.membase)546 1986 A
2574(+)S
(CLICK_SIZE)420 2658 A
3120(-1)S
3246(\))S
3330(>>)S
(CLICK_SHIFT;)504 3456 A
3285 V
(20547)210 1122 A
(free_mem\(mem_base,)756 1524 A
(mem_clicks\);)504 2322 A
3375 V
(20548)210 1122 A
(return\(OK\);)462 1524 A
3465 V
(20549)210 1122 A
1440(})S
3645 V
(20551)210 1122 A
(/*===========================================================================*)3276 1440 A
3735 V
(20552)210 1122 A
1482(*)S
(do_getsysinfo)546 2784 A
4674(*)S
3825 V
(20553)210 1122 A
(*===========================================================================*/)3276 1482 A
3915 V
(20554)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_getsysinfo\(\))630 1902 A
4005 V
(20555)210 1122 A
1440({)S
4095 V
(20556)210 1122 A
(struct)252 1524 A
(mproc)210 1818 A
(*proc_addr;)462 2070 A
4185 V
(20557)210 1122 A
(vir_bytes)378 1524 A
(src_addr,)378 1944 A
(dst_addr;)378 2364 A
4275 V
(20558)210 1122 A
(struct)252 1524 A
(kinfo)210 1818 A
(kinfo;)252 2070 A
4365 V
(20559)210 1122 A
(size_t)252 1524 A
(len;)168 1818 A
4455 V
(20560)210 1122 A
(int)126 1524 A
1692(s;)S
4545 V
(20561)210 1122 A
4635 V
(20562)210 1122 A
(switch\(m_in.info_what\))924 1524 A
2490({)S
4725 V
(20563)210 1122 A
(case)168 1524 A
(SI_KINFO:)378 1734 A
3120(/*)S
(kernel)252 3246 A
(info)168 3540 A
3750(is)S
(obtained)336 3876 A
(via)126 4254 A
4422(PM)S
4548(*/)S
4815 V
(20564)210 1122 A
(sys_getkinfo\(&kinfo\);)882 1776 A
4905 V
(20565)210 1122 A
(src_addr)336 1776 A
2154(=)S
(\(vir_bytes\))462 2238 A
(&kinfo;)294 2742 A
4995 V
(20566)210 1122 A
(len)126 1776 A
1944(=)S
(sizeof\(struct)546 2028 A
(kinfo\);)294 2616 A
5085 V
(20567)210 1122 A
(break;)252 1776 A
5175 V
(20568)210 1122 A
(case)168 1524 A
(SI_PROC_ADDR:)546 1734 A
3120(/*)S
(get)126 3246 A
(address)294 3414 A
3750(of)S
3876(PM)S
(process)294 4002 A
(table)210 4338 A
4590(*/)S
5265 V
(20569)210 1122 A
(proc_addr)378 1776 A
2196(=)S
(&mproc[0];)420 2280 A
5355 V
(20570)210 1122 A
(src_addr)336 1776 A
2154(=)S
(\(vir_bytes\))462 2238 A
(&proc_addr;)462 2742 A
5445 V
(20571)210 1122 A
(len)126 1776 A
1944(=)S
(sizeof\(struct)546 2028 A
(mproc)210 2616 A
(*\);)126 2868 A
5535 V
(20572)210 1122 A
(break;)252 1776 A
5625 V
(20573)210 1122 A
(case)168 1524 A
(SI_PROC_TAB:)504 1734 A
3120(/*)S
(copy)168 3246 A
(entire)252 3456 A
(process)294 3750 A
(table)210 4086 A
4338(*/)S
5715 V
(20574)210 1122 A
(src_addr)336 1776 A
2154(=)S
(\(vir_bytes\))462 2238 A
(mproc;)252 2742 A
5805 V
(20575)210 1122 A
(len)126 1776 A
1944(=)S
(sizeof\(struct)546 2028 A
(mproc\))252 2616 A
2910(*)S
(NR_PROCS;)378 2994 A
5895 V
(20576)210 1122 A
(break;)252 1776 A
5985 V
(20577)210 1122 A
(default:)336 1524 A
6075 V
(20578)210 1122 A
(return\(EINVAL\);)630 1776 A
6165 V
(20579)210 1122 A
1524(})S
6255 V
(20580)210 1122 A
6345 V
(20581)210 1122 A
(dst_addr)336 1524 A
1902(=)S
(\(vir_bytes\))462 1986 A
(m_in.info_where;)672 2490 A
6435 V
(20582)210 1122 A
1524(if)S
(\(OK)126 1650 A
1818(!=)S
(\(s=sys_datacopy\(SELF,)882 1944 A
(src_addr,)378 2868 A
(who,)168 3288 A
(dst_addr,)378 3498 A
(len\)\)\))252 3918 A
6525 V
(20583)210 1122 A
(return\(s\);)420 1776 A
6615 V
(20584)210 1122 A
(return\(OK\);)462 1524 A
6705 V
(20585)210 1122 A
1440(})S
8418 V
EP
%%Page: 277 277
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2360(File:)S
2593(servers/pm/misc.c)S
12 B
(277)180 4500 A
1755 V
7 LST
(20587)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(20588)210 1122 A
1482(*)S
(do_getprocnr)504 2784 A
4674(*)S
1935 V
(20589)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(20590)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_getprocnr\(\))588 1902 A
2115 V
(20591)210 1122 A
1440({)S
2205 V
(20592)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(mproc)210 2196 A
(*rmp;)210 2448 A
2295 V
(20593)210 1122 A
(static)252 1524 A
(char)168 1818 A
(search_key[PROC_NAME_LEN+1];)1176 2028 A
2385 V
(20594)210 1122 A
(int)126 1524 A
(key_len;)336 1692 A
2475 V
(20595)210 1122 A
(int)126 1524 A
1692(s;)S
2565 V
(20596)210 1122 A
2655 V
(20597)210 1122 A
1524(if)S
(\(m_in.pid)378 1650 A
2070(>=)S
2196(0\))S
2322({)S
3456(/*)S
(lookup)252 3582 A
(process)294 3876 A
4212(by)S
(pid)126 4338 A
4506(*/)S
2745 V
(20598)210 1122 A
(for)126 1776 A
(\(rmp)168 1944 A
2154(=)S
(&mproc[0];)420 2238 A
(rmp)126 2700 A
2868(<)S
(&mproc[NR_PROCS];)714 2952 A
(rmp++\))252 3708 A
4002({)S
2835 V
(20599)210 1122 A
2112(if)S
(\(\(rmp->mp_flags)630 2238 A
2910(&)S
(IN_USE\))294 2994 A
3330(&&)S
(\(rmp->mp_pid==m_in.pid\)\))1008 3456 A
4506({)S
2925 V
(20600)210 1122 A
(mp->mp_reply.procnr)798 2448 A
3288(=)S
(\(int\))210 3372 A
(\(rmp)168 3624 A
3834(-)S
(mproc\);)294 3918 A
3015 V
(20601)210 1122 A
(return\(OK\);)462 2448 A
3105 V
(20602)210 1122 A
2112(})S
3195 V
(20603)210 1122 A
1776(})S
3285 V
(20604)210 1122 A
(return\(ESRCH\);)588 1776 A
3375 V
(20605)210 1122 A
1524(})S
(else)168 1608 A
1818(if)S
(\(m_in.namelen)546 1944 A
2532(>)S
2616(0\))S
2742({)S
3456(/*)S
(lookup)252 3582 A
(process)294 3876 A
4212(by)S
(name)168 4338 A
4548(*/)S
3465 V
(20606)210 1122 A
(key_len)294 1776 A
2112(=)S
(MIN\(m_in.namelen,)714 2196 A
(PROC_NAME_LEN\);)630 2952 A
3555 V
(20607)210 1122 A
1776(if)S
(\(OK)126 1902 A
2070(!=)S
(\(s=sys_datacopy\(who,)840 2196 A
(\(vir_bytes\))462 3078 A
(m_in.addr,)420 3582 A
3645 V
(20608)210 1122 A
(SELF,)210 2448 A
(\(vir_bytes\))462 2700 A
(search_key,)462 3204 A
(key_len\)\)\))420 3708 A
3735 V
(20609)210 1122 A
(return\(s\);)420 2112 A
3825 V
(20610)210 1122 A
(search_key[key_len])798 1776 A
2616(=)S
('\\0';)210 2700 A
3120(/*)S
(terminate)378 3246 A
(for)126 3666 A
(safety)252 3834 A
4128(*/)S
3915 V
(20611)210 1122 A
(for)126 1776 A
(\(rmp)168 1944 A
2154(=)S
(&mproc[0];)420 2238 A
(rmp)126 2700 A
2868(<)S
(&mproc[NR_PROCS];)714 2952 A
(rmp++\))252 3708 A
4002({)S
4005 V
(20612)210 1122 A
2112(if)S
(\(\(rmp->mp_flags)630 2238 A
2910(&)S
(IN_USE\))294 2994 A
3330(&&)S
4095 V
(20613)210 1122 A
(strncmp\(rmp->mp_name,)882 2448 A
(search_key,)462 3372 A
(key_len\)==0\))504 3876 A
4422({)S
4185 V
(20614)210 1122 A
(mp->mp_reply.procnr)798 2448 A
3288(=)S
(\(int\))210 3372 A
(\(rmp)168 3624 A
3834(-)S
(mproc\);)294 3918 A
4275 V
(20615)210 1122 A
(return\(OK\);)462 2448 A
4365 V
(20616)210 1122 A
2112(})S
4455 V
(20617)210 1122 A
1776(})S
4545 V
(20618)210 1122 A
(return\(ESRCH\);)588 1776 A
4635 V
(20619)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3120(/*)S
(return)252 3246 A
(own)126 3540 A
(process)294 3708 A
(number)252 4044 A
4338(*/)S
4725 V
(20620)210 1122 A
(mp->mp_reply.procnr)798 1776 A
2616(=)S
(who;)168 2700 A
4815 V
(20621)210 1122 A
1524(})S
4905 V
(20622)210 1122 A
(return\(OK\);)462 1524 A
4995 V
(20623)210 1122 A
1440(})S
5175 V
(20625)210 1122 A
(/*===========================================================================*)3276 1440 A
5265 V
(20626)210 1122 A
1482(*)S
(do_reboot)378 2784 A
4674(*)S
5355 V
(20627)210 1122 A
(*===========================================================================*/)3276 1482 A
5445 V
(20628)210 1122 A
(#define)294 1440 A
(REBOOT_CODE)462 1776 A
("delay;)294 2448 A
(boot")210 2784 A
5535 V
(20629)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_reboot\(\))462 1902 A
5625 V
(20630)210 1122 A
1440({)S
5715 V
(20631)210 1122 A
(char)168 1524 A
(monitor_code[32*sizeof\(char)1134 1734 A
(*\)];)168 2910 A
5805 V
(20632)210 1122 A
(int)126 1524 A
(code_len;)378 1692 A
5895 V
(20633)210 1122 A
(int)126 1524 A
(abort_flag;)462 1692 A
5985 V
(20634)210 1122 A
6075 V
(20635)210 1122 A
1524(if)S
(\(mp->mp_effuid)588 1650 A
2280(!=)S
(SUPER_USER\))462 2406 A
(return\(EPERM\);)588 2910 A
6165 V
(20636)210 1122 A
6255 V
(20637)210 1122 A
(switch)252 1524 A
(\(m_in.reboot_flag\))756 1818 A
2616({)S
6345 V
(20638)210 1122 A
(case)168 1524 A
(RBT_HALT:)378 1734 A
6435 V
(20639)210 1122 A
(case)168 1524 A
(RBT_PANIC:)420 1734 A
6525 V
(20640)210 1122 A
(case)168 1524 A
(RBT_RESET:)420 1734 A
6615 V
(20641)210 1122 A
(abort_flag)420 1776 A
2238(=)S
(m_in.reboot_flag;)714 2322 A
6705 V
(20642)210 1122 A
(break;)252 1776 A
6795 V
(20643)210 1122 A
(case)168 1524 A
(RBT_REBOOT:)462 1734 A
6885 V
(20644)210 1122 A
(code_len)336 1776 A
2154(=)S
(strlen\(REBOOT_CODE\))798 2238 A
3078(+)S
3162(1;)S
6975 V
(20645)210 1122 A
(strncpy\(monitor_code,)882 1776 A
(REBOOT_CODE,)504 2700 A
(code_len\);)420 3246 A
7065 V
(20646)210 1122 A
(abort_flag)420 1776 A
2238(=)S
(RBT_MONITOR;)504 2322 A
8418 V
EP
%%Page: 278 278
BP
/slant 0 def
/height 0 def
1485 V
12 B
(278)180 1080 A
11 R
2360(File:)S
2593(servers/pm/misc.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(20647)210 1122 A
(break;)252 1776 A
1845 V
(20648)210 1122 A
(case)168 1524 A
(RBT_MONITOR:)504 1734 A
1935 V
(20649)210 1122 A
(code_len)336 1776 A
2154(=)S
(m_in.reboot_strlen)756 2238 A
3036(+)S
3120(1;)S
2025 V
(20650)210 1122 A
1776(if)S
(\(code_len)378 1902 A
2322(>)S
(sizeof\(monitor_code\)\))882 2406 A
(return\(EINVAL\);)630 3330 A
2115 V
(20651)210 1122 A
1776(if)S
(\(sys_datacopy\(who,)756 1902 A
(\(vir_bytes\))462 2700 A
(m_in.reboot_code,)714 3204 A
2205 V
(20652)210 1122 A
(PM_PROC_NR,)462 2112 A
(\(vir_bytes\))462 2616 A
(monitor_code,)546 3120 A
2295 V
(20653)210 1122 A
(\(phys_bytes\))504 2112 A
(\(code_len\)\))462 2658 A
3162(!=)S
(OK\))126 3288 A
(return\(EFAULT\);)630 3456 A
2385 V
(20654)210 1122 A
1776(if)S
(\(monitor_code[code_len-1])1050 1902 A
2994(!=)S
3120(0\))S
(return\(EINVAL\);)630 3246 A
2475 V
(20655)210 1122 A
(abort_flag)420 1776 A
2238(=)S
(RBT_MONITOR;)504 2322 A
2565 V
(20656)210 1122 A
(break;)252 1776 A
2655 V
(20657)210 1122 A
(default:)336 1524 A
2745 V
(20658)210 1122 A
(return\(EINVAL\);)630 1776 A
2835 V
(20659)210 1122 A
1524(})S
2925 V
(20660)210 1122 A
3015 V
(20661)210 1122 A
(check_sig\(-1,)546 1524 A
(SIGKILL\);)378 2112 A
3120(/*)S
(kill)168 3246 A
(all)126 3456 A
(processes)378 3624 A
(except)252 4044 A
(init)168 4338 A
4548(*/)S
3105 V
(20662)210 1122 A
(tell_fs\(REBOOT,0,0,0\);)924 1524 A
3120(/*)S
(tell)168 3246 A
3456(FS)S
3582(to)S
(prepare)294 3708 A
(for)126 4044 A
(shutdown)336 4212 A
4590(*/)S
3195 V
(20663)210 1122 A
3285 V
(20664)210 1122 A
1524(/*)S
(Ask)126 1650 A
(the)126 1818 A
(kernel)252 1986 A
2280(to)S
(abort.)252 2406 A
(All)126 2700 A
(system)252 2868 A
(services,)378 3162 A
(including)378 3582 A
(the)126 4002 A
(PM,)126 4170 A
(will)168 4338 A
3375 V
(20665)210 1122 A
1566(*)S
(get)126 1650 A
1818(a)S
(HARD_STOP)378 1902 A
(notification.)546 2322 A
(Await)210 2910 A
(the)126 3162 A
(notification)504 3330 A
3876(in)S
(the)126 4002 A
(main)168 4170 A
(loop.)210 4380 A
3465 V
(20666)210 1122 A
1566(*/)S
3555 V
(20667)210 1122 A
(sys_abort\(abort_flag,)882 1524 A
(PM_PROC_NR,)462 2448 A
(monitor_code,)546 2952 A
(code_len\);)420 3540 A
3645 V
(20668)210 1122 A
(return\(SUSPEND\);)672 1524 A
3120(/*)S
(don't)210 3246 A
(reply)210 3498 A
3750(to)S
(killed)252 3876 A
(process)294 4170 A
4506(*/)S
3735 V
(20669)210 1122 A
1440(})S
3915 V
(20671)210 1122 A
(/*===========================================================================*)3276 1440 A
4005 V
(20672)210 1122 A
1482(*)S
(do_getsetpriority)714 2784 A
4674(*)S
4095 V
(20673)210 1122 A
(*===========================================================================*/)3276 1482 A
4185 V
(20674)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_getsetpriority\(\))798 1902 A
4275 V
(20675)210 1122 A
1440({)S
4365 V
(20676)210 1122 A
(int)126 1776 A
(arg_which,)420 1944 A
(arg_who,)336 2406 A
(arg_pri;)336 2784 A
4455 V
(20677)210 1122 A
(int)126 1776 A
(rmp_nr;)294 1944 A
4545 V
(20678)210 1122 A
(struct)252 1776 A
(mproc)210 2070 A
(*rmp;)210 2322 A
4635 V
(20679)210 1122 A
4725 V
(20680)210 1122 A
(arg_which)378 1776 A
2196(=)S
(m_in.m1_i1;)462 2280 A
4815 V
(20681)210 1122 A
(arg_who)294 1776 A
2112(=)S
(m_in.m1_i2;)462 2196 A
4905 V
(20682)210 1122 A
(arg_pri)294 1776 A
2112(=)S
(m_in.m1_i3;)462 2196 A
2784(/*)S
(for)126 2910 A
(SETPRIORITY)462 3078 A
3582(*/)S
4995 V
(20683)210 1122 A
5085 V
(20684)210 1122 A
1776(/*)S
(Code)168 1902 A
(common)252 2112 A
2406(to)S
(GETPRIORITY)462 2532 A
(and)126 3036 A
(SETPRIORITY.)504 3204 A
3750(*/)S
5175 V
(20685)210 1122 A
5265 V
(20686)210 1122 A
1776(/*)S
(Only)168 1902 A
(support)294 2112 A
(PRIO_PROCESS)504 2448 A
(for)126 2994 A
(now.)168 3162 A
3372(*/)S
5355 V
(20687)210 1122 A
1776(if)S
(\(arg_which)420 1902 A
2364(!=)S
(PRIO_PROCESS\))546 2490 A
5445 V
(20688)210 1122 A
(return\(EINVAL\);)630 2112 A
5535 V
(20689)210 1122 A
5625 V
(20690)210 1122 A
1776(if)S
(\(arg_who)336 1902 A
2280(==)S
2406(0\))S
5715 V
(20691)210 1122 A
(rmp_nr)252 2112 A
2406(=)S
(who;)168 2490 A
5805 V
(20692)210 1122 A
(else)168 1776 A
5895 V
(20693)210 1122 A
2112(if)S
(\(\(rmp_nr)336 2238 A
2616(=)S
(proc_from_pid\(arg_who\)\))966 2700 A
3708(<)S
3792(0\))S
5985 V
(20694)210 1122 A
(return\(ESRCH\);)588 2448 A
6075 V
(20695)210 1122 A
6165 V
(20696)210 1122 A
(rmp)126 1776 A
1944(=)S
(&mproc[rmp_nr];)630 2028 A
6255 V
(20697)210 1122 A
6345 V
(20698)210 1122 A
1776(if)S
(\(mp->mp_effuid)588 1902 A
2532(!=)S
(SUPER_USER)420 2658 A
3120(&&)S
6435 V
(20699)210 1122 A
(mp->mp_effuid)546 1902 A
2490(!=)S
(rmp->mp_effuid)588 2616 A
3246(&&)S
(mp->mp_effuid)546 3372 A
3960(!=)S
(rmp->mp_realuid\))672 4086 A
6525 V
(20700)210 1122 A
(return)252 2112 A
(EPERM;)252 2406 A
6615 V
(20701)210 1122 A
6705 V
(20702)210 1122 A
1776(/*)S
1902(If)S
(GET,)168 2028 A
(that's)252 2238 A
(it.)126 2532 A
2700(*/)S
6795 V
(20703)210 1122 A
1776(if)S
(\(call_nr)336 1902 A
2280(==)S
(GETPRIORITY\))504 2406 A
2952({)S
6885 V
(20704)210 1122 A
(return\(rmp->mp_nice)798 2112 A
2952(-)S
(PRIO_MIN\);)420 3036 A
6975 V
(20705)210 1122 A
1776(})S
7065 V
(20706)210 1122 A
8418 V
EP
%%Page: 279 279
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2360(File:)S
2593(servers/pm/misc.c)S
12 B
(279)180 4500 A
1755 V
7 LST
(20707)210 1122 A
1776(/*)S
(Only)168 1902 A
(root)168 2112 A
2322(is)S
(allowed)294 2448 A
2784(to)S
(reduce)252 2910 A
(the)126 3204 A
(nice)168 3372 A
(level.)252 3582 A
3876(*/)S
1845 V
(20708)210 1122 A
1776(if)S
(\(rmp->mp_nice)546 1902 A
2490(>)S
(arg_pri)294 2574 A
2910(&&)S
(mp->mp_effuid)546 3036 A
3624(!=)S
(SUPER_USER\))462 3750 A
1935 V
(20709)210 1122 A
(return\(EACCES\);)630 2112 A
2025 V
(20710)210 1122 A
2115 V
(20711)210 1122 A
1776(/*)S
(We're)210 1902 A
(SET,)168 2154 A
(and)126 2364 A
(it's)168 2532 A
(allowed.)336 2742 A
3120(Do)S
3246(it)S
(and)126 3372 A
(tell)168 3540 A
(kernel.)294 3750 A
4086(*/)S
2205 V
(20712)210 1122 A
(rmp->mp_nice)504 1776 A
2322(=)S
(arg_pri;)336 2406 A
2295 V
(20713)210 1122 A
(return)252 1776 A
(sys_nice\(rmp_nr,)672 2070 A
(arg_pri\);)378 2784 A
2385 V
(20714)210 1122 A
1440(})S
2565 V
(20716)210 1122 A
(/*===========================================================================*)3276 1440 A
2655 V
(20717)210 1122 A
1482(*)S
(do_svrctl)378 2784 A
4674(*)S
2745 V
(20718)210 1122 A
(*===========================================================================*/)3276 1482 A
2835 V
(20719)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_svrctl\(\))462 1902 A
2925 V
(20720)210 1122 A
1440({)S
3015 V
(20721)210 1122 A
(int)126 1524 A
1692(s,)S
(req;)168 1818 A
3105 V
(20722)210 1122 A
(vir_bytes)378 1524 A
(ptr;)168 1944 A
3195 V
(20723)210 1122 A
(#define)294 1440 A
(MAX_LOCAL_PARAMS)672 1776 A
2490(2)S
3285 V
(20724)210 1122 A
(static)252 1524 A
(struct)252 1818 A
2112({)S
3375 V
(20725)210 1122 A
(char)168 1776 A
(name[30];)378 1986 A
3465 V
(20726)210 1122 A
(char)168 1776 A
(value[30];)420 1986 A
3555 V
(20727)210 1122 A
1524(})S
(local_param_overrides[MAX_LOCAL_PARAMS];)1680 1608 A
3645 V
(20728)210 1122 A
(static)252 1524 A
(int)126 1818 A
(local_params)504 1986 A
2532(=)S
2616(0;)S
3735 V
(20729)210 1122 A
3825 V
(20730)210 1122 A
(req)126 1524 A
1692(=)S
(m_in.svrctl_req;)672 1776 A
3915 V
(20731)210 1122 A
(ptr)126 1524 A
1692(=)S
(\(vir_bytes\))462 1776 A
(m_in.svrctl_argp;)714 2280 A
4005 V
(20732)210 1122 A
4095 V
(20733)210 1122 A
1524(/*)S
1650(Is)S
(the)126 1776 A
(request)294 1944 A
(indeed)252 2280 A
(for)126 2574 A
(the)126 2742 A
(MM?)126 2910 A
3078(*/)S
4185 V
(20734)210 1122 A
1524(if)S
(\(\(\(req)252 1650 A
1944(>>)S
2070(8\))S
2196(&)S
(0xFF\))210 2280 A
2532(!=)S
('M'\))168 2658 A
(return\(EINVAL\);)630 2868 A
4275 V
(20735)210 1122 A
4365 V
(20736)210 1122 A
1524(/*)S
(Control)294 1650 A
(operations)420 1986 A
(local)210 2448 A
2700(to)S
(the)126 2826 A
(PM.)126 2994 A
3162(*/)S
4455 V
(20737)210 1122 A
(switch\(req\))462 1524 A
2028({)S
4545 V
(20738)210 1122 A
(case)168 1524 A
(MMSETPARAM:)462 1734 A
4635 V
(20739)210 1122 A
(case)168 1524 A
(MMGETPARAM:)462 1734 A
2238({)S
4725 V
(20740)210 1122 A
(struct)252 1692 A
(sysgetenv)378 1986 A
(sysgetenv;)420 2406 A
4815 V
(20741)210 1122 A
(char)168 1692 A
(search_key[64];)630 1902 A
4905 V
(20742)210 1122 A
(char)168 1692 A
(*val_start;)462 1902 A
4995 V
(20743)210 1122 A
(size_t)252 1692 A
(val_len;)336 1986 A
5085 V
(20744)210 1122 A
(size_t)252 1692 A
(copy_len;)378 1986 A
5175 V
(20745)210 1122 A
5265 V
(20746)210 1122 A
1692(/*)S
(Copy)168 1818 A
(sysgetenv)378 2028 A
(structure)378 2448 A
2868(to)S
(PM.)126 2994 A
3162(*/)S
5355 V
(20747)210 1122 A
1692(if)S
(\(sys_datacopy\(who,)756 1818 A
(ptr,)168 2616 A
(SELF,)210 2826 A
(\(vir_bytes\))462 3078 A
(&sysgetenv,)462 3582 A
5445 V
(20748)210 1122 A
(sizeof\(sysgetenv\)\))756 2028 A
2826(!=)S
(OK\))126 2952 A
(return\(EFAULT\);)630 3120 A
5535 V
(20749)210 1122 A
5625 V
(20750)210 1122 A
1692(/*)S
(Set)126 1818 A
1986(a)S
(param)210 2070 A
(override?)378 2322 A
2742(*/)S
5715 V
(20751)210 1122 A
1692(if)S
(\(req)168 1818 A
2028(==)S
(MMSETPARAM\))462 2154 A
2658({)S
5805 V
(20752)210 1122 A
1776(if)S
(\(local_params)546 1902 A
2490(>=)S
(MAX_LOCAL_PARAMS\))714 2616 A
(return)252 3372 A
(ENOSPC;)294 3666 A
5895 V
(20753)210 1122 A
1776(if)S
(\(sysgetenv.keylen)714 1902 A
2658(<=)S
2784(0)S
5985 V
(20754)210 1122 A
1818(||)S
(sysgetenv.keylen)672 1944 A
2658(>=)S
6075 V
(20755)210 1122 A
(sizeof\(local_param_overrides[local_params].name\))2016 2154 A
6165 V
(20756)210 1122 A
1818(||)S
(sysgetenv.vallen)672 1944 A
2658(<=)S
2784(0)S
6255 V
(20757)210 1122 A
1818(||)S
(sysgetenv.vallen)672 1944 A
2658(>=)S
6345 V
(20758)210 1122 A
(sizeof\(local_param_overrides[local_params].value\)\))2100 2154 A
6435 V
(20759)210 1122 A
(return)252 2112 A
(EINVAL;)294 2406 A
6525 V
(20760)210 1122 A
6615 V
(20761)210 1122 A
1860(if)S
(\(\(s)126 1986 A
2154(=)S
(sys_datacopy\(who,)714 2238 A
(\(vir_bytes\))462 2994 A
(sysgetenv.key,)588 3498 A
6705 V
(20762)210 1122 A
(SELF,)210 1944 A
(\(vir_bytes\))462 2196 A
(local_param_overrides[local_params].name,)1722 2700 A
6795 V
(20763)210 1122 A
(sysgetenv.keylen\)\))756 2070 A
2868(!=)S
(OK\))126 2994 A
6885 V
(20764)210 1122 A
(return)252 2112 A
2406(s;)S
6975 V
(20765)210 1122 A
1860(if)S
(\(\(s)126 1986 A
2154(=)S
(sys_datacopy\(who,)714 2238 A
(\(vir_bytes\))462 2994 A
(sysgetenv.val,)588 3498 A
7065 V
(20766)210 1122 A
(SELF,)210 1944 A
(\(vir_bytes\))462 2196 A
(local_param_overrides[local_params].value,)1764 2700 A
8418 V
EP
%%Page: 280 280
BP
/slant 0 def
/height 0 def
1485 V
12 B
(280)180 1080 A
11 R
2360(File:)S
2593(servers/pm/misc.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(20767)210 1122 A
(sysgetenv.keylen\)\))756 2028 A
2826(!=)S
(OK\))126 2952 A
1845 V
(20768)210 1122 A
(return)252 2112 A
2406(s;)S
1935 V
(20769)210 1122 A
(local_param_overrides[local_params].name[sysgetenv.keylen])2436 1944 A
4422(=)S
('\\0';)210 4506 A
2025 V
(20770)210 1122 A
(local_param_overrides[local_params].value[sysgetenv.vallen])2478 1944 A
4464(=)S
('\\0';)210 4548 A
2115 V
(20771)210 1122 A
2205 V
(20772)210 1122 A
(local_params++;)630 1776 A
2295 V
(20773)210 1122 A
2385 V
(20774)210 1122 A
(return)252 1776 A
(OK;)126 2070 A
2475 V
(20775)210 1122 A
1692(})S
2565 V
(20776)210 1122 A
2655 V
(20777)210 1122 A
1692(if)S
(\(sysgetenv.keylen)714 1818 A
2574(==)S
2700(0\))S
2826({)S
3120(/*)S
(copy)168 3246 A
(all)126 3456 A
(parameters)420 3624 A
4086(*/)S
2745 V
(20778)210 1122 A
(val_start)378 1860 A
2280(=)S
(monitor_params;)630 2364 A
2835 V
(20779)210 1122 A
(val_len)294 1860 A
2196(=)S
(sizeof\(monitor_params\);)966 2280 A
2925 V
(20780)210 1122 A
1692(})S
3015 V
(20781)210 1122 A
(else)168 1692 A
1902({)S
3120(/*)S
(lookup)252 3246 A
(value)210 3540 A
(for)126 3792 A
(key)126 3960 A
4128(*/)S
3105 V
(20782)210 1122 A
(int)126 1860 A
2028(p;)S
3195 V
(20783)210 1122 A
1860(/*)S
(Try)126 1986 A
2154(to)S
(get)126 2280 A
2448(a)S
(copy)168 2532 A
2742(of)S
(the)126 2868 A
(requested)378 3036 A
(key.)168 3456 A
3666(*/)S
3285 V
(20784)210 1122 A
1860(if)S
(\(sysgetenv.keylen)714 1986 A
2742(>)S
(sizeof\(search_key\)\))798 2826 A
(return\(EINVAL\);)630 3666 A
3375 V
(20785)210 1122 A
1860(if)S
(\(\(s)126 1986 A
2154(=)S
(sys_datacopy\(who,)714 2238 A
(\(vir_bytes\))462 2994 A
(sysgetenv.key,)588 3498 A
3465 V
(20786)210 1122 A
(SELF,)210 2196 A
(\(vir_bytes\))462 2448 A
(search_key,)462 2952 A
(sysgetenv.keylen\)\))756 3456 A
4254(!=)S
(OK\))126 4380 A
3555 V
(20787)210 1122 A
(return\(s\);)420 2028 A
3645 V
(20788)210 1122 A
3735 V
(20789)210 1122 A
1860(/*)S
(Make)168 1986 A
(sure)168 2196 A
(key)126 2406 A
2574(is)S
(null-terminated)630 2700 A
(and)126 3372 A
(lookup)252 3540 A
(value.)252 3834 A
3825 V
(20790)210 1122 A
1902(*)S
(First)210 1986 A
(check)210 2238 A
(local)210 2490 A
(overrides.)420 2742 A
3915 V
(20791)210 1122 A
1902(*/)S
4005 V
(20792)210 1122 A
(search_key[sysgetenv.keylen-1]=)1302 1860 A
('\\0';)210 3204 A
4095 V
(20793)210 1122 A
(for\(p)210 1860 A
2112(=)S
2196(0;)S
2322(p)S
2406(<)S
(local_params;)546 2490 A
(p++\))168 3078 A
3288({)S
4185 V
(20794)210 1122 A
2112(if)S
(\(!strcmp\(search_key,)840 2238 A
(local_param_overrides[p].name\)\))1302 3120 A
4464({)S
4275 V
(20795)210 1122 A
(val_start)378 2448 A
2868(=)S
(local_param_overrides[p].value;)1302 2952 A
4365 V
(20796)210 1122 A
(break;)252 2448 A
4455 V
(20797)210 1122 A
2112(})S
4545 V
(20798)210 1122 A
1860(})S
4635 V
(20799)210 1122 A
1860(if)S
1986(\(p)S
2112(>=)S
(local_params)504 2238 A
2784(&&)S
(\(val_start)420 2910 A
3372(=)S
(find_param\(search_key\)\))966 3456 A
4464(==)S
(NULL\))210 4590 A
4725 V
(20800)210 1122 A
(return\(ESRCH\);)588 2070 A
4815 V
(20801)210 1122 A
(val_len)294 1860 A
2196(=)S
(strlen\(val_start\))714 2280 A
3036(+)S
3120(1;)S
4905 V
(20802)210 1122 A
1692(})S
4995 V
(20803)210 1122 A
5085 V
(20804)210 1122 A
1692(/*)S
(See)126 1818 A
1986(if)S
2112(it)S
(fits)168 2238 A
2448(in)S
(the)126 2574 A
(client's)336 2742 A
(buffer.)294 3120 A
3456(*/)S
5175 V
(20805)210 1122 A
1692(if)S
(\(val_len)336 1818 A
2196(>)S
(sysgetenv.vallen\))714 2280 A
5265 V
(20806)210 1122 A
(return)252 1776 A
(E2BIG;)252 2070 A
5355 V
(20807)210 1122 A
5445 V
(20808)210 1122 A
1692(/*)S
(Value)210 1818 A
(found,)252 2070 A
(make)168 2364 A
(the)126 2574 A
(actual)252 2742 A
(copy)168 3036 A
(\(as)126 3246 A
(far)126 3414 A
3582(as)S
(possible\).)420 3708 A
4170(*/)S
5535 V
(20809)210 1122 A
(copy_len)336 1692 A
2070(=)S
(MIN\(val_len,)504 2154 A
(sysgetenv.vallen\);)756 2700 A
5625 V
(20810)210 1122 A
1692(if)S
(\(\(s=sys_datacopy\(SELF,)924 1818 A
(\(vir_bytes\))462 2784 A
(val_start,)420 3288 A
5715 V
(20811)210 1122 A
(who,)168 2028 A
(\(vir_bytes\))462 2238 A
(sysgetenv.val,)588 2742 A
(copy_len\)\))420 3372 A
3834(!=)S
(OK\))126 3960 A
5805 V
(20812)210 1122 A
(return\(s\);)420 1860 A
5895 V
(20813)210 1122 A
5985 V
(20814)210 1122 A
(return)252 1692 A
(OK;)126 1986 A
6075 V
(20815)210 1122 A
1524(})S
6165 V
(20816)210 1122 A
(default:)336 1524 A
6255 V
(20817)210 1122 A
(return\(EINVAL\);)630 1776 A
6345 V
(20818)210 1122 A
1524(})S
6435 V
(20819)210 1122 A
1440(})S
8418 V
EP
%%Page: 281 281
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2453(File:)S
2686(servers/fs/fs.h)S
12 B
(281)180 4500 A
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(servers/fs/fs.h)630 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(20900)210 1122 A
1440(/*)S
(This)168 1566 A
1776(is)S
(the)126 1902 A
(master)252 2070 A
(header)252 2364 A
(for)126 2658 A
(fs.)126 2826 A
3036(It)S
(includes)336 3162 A
(some)168 3540 A
(other)210 3750 A
(files)210 4002 A
2295 V
(20901)210 1122 A
1482(*)S
(and)126 1566 A
(defines)294 1734 A
(the)126 2070 A
(principal)378 2238 A
(constants.)420 2658 A
2385 V
(20902)210 1122 A
1482(*/)S
2475 V
(20903)210 1122 A
(#define)294 1440 A
(_POSIX_SOURCE)546 1776 A
2574(1)S
2784(/*)S
(tell)168 2910 A
(headers)294 3120 A
3456(to)S
(include)294 3582 A
(POSIX)210 3918 A
(stuff)210 4170 A
4422(*/)S
2565 V
(20904)210 1122 A
(#define)294 1440 A
(_MINIX)252 1776 A
2574(1)S
2784(/*)S
(tell)168 2910 A
(headers)294 3120 A
3456(to)S
(include)294 3582 A
(MINIX)210 3918 A
(stuff)210 4170 A
4422(*/)S
2655 V
(20905)210 1122 A
(#define)294 1440 A
(_SYSTEM)294 1776 A
2574(1)S
2784(/*)S
(tell)168 2910 A
(headers)294 3120 A
(that)168 3456 A
(this)168 3666 A
3876(is)S
(the)126 4002 A
(kernel)252 4170 A
4464(*/)S
2745 V
(20906)210 1122 A
2835 V
(20907)210 1122 A
(#define)294 1440 A
(VERBOSE)294 1776 A
2574(0)S
2784(/*)S
(show)168 2910 A
(messages)336 3120 A
(during)252 3498 A
(initialization?)630 3792 A
4464(*/)S
2925 V
(20908)210 1122 A
3015 V
(20909)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(are)126 2154 A
2322(so)S
(basic,)252 2448 A
(all)126 2742 A
(the)126 2910 A
(*.c)126 3078 A
(files)210 3246 A
(get)126 3498 A
(them)168 3666 A
(automatically.)588 3876 A
4506(*/)S
3105 V
(20910)210 1122 A
(#include)336 1440 A
(<minix/config.h>)672 1818 A
2784(/*)S
(MUST)168 2910 A
3120(be)S
(first)210 3246 A
3498(*/)S
3195 V
(20911)210 1122 A
(#include)336 1440 A
(<ansi.h>)336 1818 A
2784(/*)S
(MUST)168 2910 A
3120(be)S
(second)252 3246 A
3540(*/)S
3285 V
(20912)210 1122 A
(#include)336 1440 A
(<sys/types.h>)546 1818 A
3375 V
(20913)210 1122 A
(#include)336 1440 A
(<minix/const.h>)630 1818 A
3465 V
(20914)210 1122 A
(#include)336 1440 A
(<minix/type.h>)588 1818 A
3555 V
(20915)210 1122 A
(#include)336 1440 A
(<minix/dmap.h>)588 1818 A
3645 V
(20916)210 1122 A
3735 V
(20917)210 1122 A
(#include)336 1440 A
(<limits.h>)420 1818 A
3825 V
(20918)210 1122 A
(#include)336 1440 A
(<errno.h>)378 1818 A
3915 V
(20919)210 1122 A
4005 V
(20920)210 1122 A
(#include)336 1440 A
(<minix/syslib.h>)672 1818 A
4095 V
(20921)210 1122 A
(#include)336 1440 A
(<minix/sysutil.h>)714 1818 A
4185 V
(20922)210 1122 A
4275 V
(20923)210 1122 A
(#include)336 1440 A
("const.h")378 1818 A
4365 V
(20924)210 1122 A
(#include)336 1440 A
("type.h")336 1818 A
4455 V
(20925)210 1122 A
(#include)336 1440 A
("proto.h")378 1818 A
4545 V
(20926)210 1122 A
(#include)336 1440 A
("glo.h")294 1818 A
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(servers/fs/const.h)756 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(21000)210 1122 A
1440(/*)S
(Tables)252 1566 A
(sizes)210 1860 A
2112(*/)S
5445 V
(21001)210 1122 A
(#define)294 1440 A
(V1_NR_DZONES)504 1776 A
2574(7)S
2784(/*)S
2910(#)S
(direct)252 2994 A
(zone)168 3288 A
(numbers)294 3498 A
3834(in)S
3960(a)S
4044(V1)S
(inode)210 4170 A
4422(*/)S
5535 V
(21002)210 1122 A
(#define)294 1440 A
(V1_NR_TZONES)504 1776 A
2574(9)S
2784(/*)S
(total)210 2910 A
3162(#)S
(zone)168 3246 A
(numbers)294 3456 A
3792(in)S
3918(a)S
4002(V1)S
(inode)210 4128 A
4380(*/)S
5625 V
(21003)210 1122 A
(#define)294 1440 A
(V2_NR_DZONES)504 1776 A
2574(7)S
2784(/*)S
2910(#)S
(direct)252 2994 A
(zone)168 3288 A
(numbers)294 3498 A
3834(in)S
3960(a)S
4044(V2)S
(inode)210 4170 A
4422(*/)S
5715 V
(21004)210 1122 A
(#define)294 1440 A
(V2_NR_TZONES)504 1776 A
2532(10)S
2784(/*)S
(total)210 2910 A
3162(#)S
(zone)168 3246 A
(numbers)294 3456 A
3792(in)S
3918(a)S
4002(V2)S
(inode)210 4128 A
4380(*/)S
5805 V
(21005)210 1122 A
5895 V
(21006)210 1122 A
(#define)294 1440 A
(NR_FILPS)336 1776 A
(128)126 2490 A
2784(/*)S
2910(#)S
(slots)210 2994 A
3246(in)S
(filp)168 3372 A
(table)210 3582 A
3834(*/)S
5985 V
(21007)210 1122 A
(#define)294 1440 A
(NR_INODES)378 1776 A
2532(64)S
2784(/*)S
2910(#)S
(slots)210 2994 A
3246(in)S
("in)126 3372 A
(core")210 3540 A
(inode)210 3792 A
(table)210 4044 A
4296(*/)S
6075 V
(21008)210 1122 A
(#define)294 1440 A
(NR_SUPERS)378 1776 A
2574(8)S
2784(/*)S
2910(#)S
(slots)210 2994 A
3246(in)S
(super)210 3372 A
(block)210 3624 A
(table)210 3876 A
4128(*/)S
6165 V
(21009)210 1122 A
(#define)294 1440 A
(NR_LOCKS)336 1776 A
2574(8)S
2784(/*)S
2910(#)S
(slots)210 2994 A
3246(in)S
(the)126 3372 A
(file)168 3540 A
(locking)294 3750 A
(table)210 4086 A
4338(*/)S
6255 V
(21010)210 1122 A
6345 V
(21011)210 1122 A
1440(/*)S
(The)126 1566 A
(type)168 1734 A
1944(of)S
(sizeof)252 2070 A
(may)126 2364 A
2532(be)S
(\(unsigned\))420 2658 A
(long.)210 3120 A
(Use)126 3414 A
(the)126 3582 A
(following)378 3750 A
(macro)210 4170 A
(for)126 4422 A
6435 V
(21012)210 1122 A
1482(*)S
(taking)252 1566 A
(the)126 1860 A
(sizes)210 2028 A
2280(of)S
(small)210 2406 A
(objects)294 2658 A
2994(so)S
(that)168 3120 A
(there)210 3330 A
(are)126 3582 A
3750(no)S
(surprises)378 3876 A
(like)168 4296 A
6525 V
(21013)210 1122 A
1482(*)S
(\(small\))294 1566 A
(long)168 1902 A
(constants)378 2112 A
(being)210 2532 A
(passed)252 2784 A
3078(to)S
(routines)336 3204 A
(expecting)378 3582 A
4002(an)S
(int.)168 4128 A
6615 V
(21014)210 1122 A
1482(*/)S
6705 V
(21015)210 1122 A
(#define)294 1440 A
(usizeof\(t\))420 1776 A
(\(\(unsigned\))462 2238 A
(sizeof\(t\)\))420 2742 A
6795 V
(21016)210 1122 A
6885 V
(21017)210 1122 A
1440(/*)S
(File)168 1566 A
(system)252 1776 A
(types.)252 2070 A
2364(*/)S
6975 V
(21018)210 1122 A
(#define)294 1440 A
(SUPER_MAGIC)462 1776 A
(0x137F)252 2364 A
2784(/*)S
(magic)210 2910 A
(number)252 3162 A
(contained)378 3456 A
3876(in)S
(super-block)462 4002 A
4506(*/)S
7065 V
(21019)210 1122 A
(#define)294 1440 A
(SUPER_REV)378 1776 A
(0x7F13)252 2364 A
2784(/*)S
(magic)210 2910 A
3162(#)S
(when)168 3246 A
(68000)210 3456 A
(disk)168 3708 A
(read)168 3918 A
4128(on)S
4254(PC)S
4380(or)S
4506(vv)S
4632(*/)S
8418 V
EP
%%Page: 282 282
BP
/slant 0 def
/height 0 def
1485 V
12 B
(282)180 1080 A
11 R
2376(File:)S
2609(servers/fs/const.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(21020)210 1122 A
(#define)294 1440 A
(SUPER_V2)336 1776 A
(0x2468)252 2364 A
2784(/*)S
(magic)210 2910 A
3162(#)S
(for)126 3246 A
3414(V2)S
(file)168 3540 A
(systems)294 3750 A
4086(*/)S
1845 V
(21021)210 1122 A
(#define)294 1440 A
(SUPER_V2_REV)504 1776 A
(0x6824)252 2364 A
2784(/*)S
2910(V2)S
(magic)210 3036 A
(written)294 3288 A
3624(on)S
(PC,)126 3750 A
(read)168 3918 A
4128(on)S
(68K)126 4254 A
4422(or)S
4548(vv)S
4674(*/)S
1935 V
(21022)210 1122 A
(#define)294 1440 A
(SUPER_V3)336 1776 A
(0x4d5a)252 2364 A
2784(/*)S
(magic)210 2910 A
3162(#)S
(for)126 3246 A
3414(V3)S
(file)168 3540 A
(systems)294 3750 A
4086(*/)S
2025 V
(21023)210 1122 A
2115 V
(21024)210 1122 A
(#define)294 1440 A
1776(V1)S
2574(1)S
2784(/*)S
(version)294 2910 A
(number)252 3246 A
3540(of)S
3666(V1)S
(file)168 3792 A
(systems)294 4002 A
4338(*/)S
2205 V
(21025)210 1122 A
(#define)294 1440 A
1776(V2)S
2574(2)S
2784(/*)S
(version)294 2910 A
(number)252 3246 A
3540(of)S
3666(V2)S
(file)168 3792 A
(systems)294 4002 A
4338(*/)S
2295 V
(21026)210 1122 A
(#define)294 1440 A
1776(V3)S
2574(3)S
2784(/*)S
(version)294 2910 A
(number)252 3246 A
3540(of)S
3666(V3)S
(file)168 3792 A
(systems)294 4002 A
4338(*/)S
2385 V
(21027)210 1122 A
2475 V
(21028)210 1122 A
1440(/*)S
(Miscellaneous)546 1566 A
(constants)378 2154 A
2574(*/)S
2565 V
(21029)210 1122 A
(#define)294 1440 A
(SU_UID)252 1776 A
(\(\(uid_t\))336 2154 A
2532(0\))S
2784(/*)S
(super_user's)504 2910 A
(uid_t)210 3456 A
3708(*/)S
2655 V
(21030)210 1122 A
(#define)294 1440 A
(SYS_UID)294 1776 A
(\(\(uid_t\))336 2154 A
2532(0\))S
2784(/*)S
(uid_t)210 2910 A
(for)126 3162 A
(processes)378 3330 A
3750(MM)S
(and)126 3876 A
(INIT)168 4044 A
4254(*/)S
2745 V
(21031)210 1122 A
(#define)294 1440 A
(SYS_GID)294 1776 A
(\(\(gid_t\))336 2154 A
2532(0\))S
2784(/*)S
(gid_t)210 2910 A
(for)126 3162 A
(processes)378 3330 A
3750(MM)S
(and)126 3876 A
(INIT)168 4044 A
4254(*/)S
2835 V
(21032)210 1122 A
(#define)294 1440 A
(NORMAL)252 1776 A
2574(0)S
2784(/*)S
(forces)252 2910 A
(get_block)378 3204 A
3624(to)S
3750(do)S
(disk)168 3876 A
(read)168 4086 A
4296(*/)S
2925 V
(21033)210 1122 A
(#define)294 1440 A
(NO_READ)294 1776 A
2574(1)S
2784(/*)S
(prevents)336 2910 A
(get_block)378 3288 A
(from)168 3708 A
(doing)210 3918 A
(disk)168 4170 A
(read)168 4380 A
4590(*/)S
3015 V
(21034)210 1122 A
(#define)294 1440 A
(PREFETCH)336 1776 A
2574(2)S
2784(/*)S
(tells)210 2910 A
(get_block)378 3162 A
(not)126 3582 A
3750(to)S
(read)168 3876 A
4086(or)S
(mark)168 4212 A
(dev)126 4422 A
4590(*/)S
3105 V
(21035)210 1122 A
3195 V
(21036)210 1122 A
(#define)294 1440 A
(XPIPE)210 1776 A
(\(-NR_TASKS-1\))546 2112 A
2784(/*)S
(used)168 2910 A
3120(in)S
(fp_task)294 3246 A
(when)168 3582 A
(susp'd)252 3792 A
4086(on)S
(pipe)168 4212 A
4422(*/)S
3285 V
(21037)210 1122 A
(#define)294 1440 A
(XLOCK)210 1776 A
(\(-NR_TASKS-2\))546 2112 A
2784(/*)S
(used)168 2910 A
3120(in)S
(fp_task)294 3246 A
(when)168 3582 A
(susp'd)252 3792 A
4086(on)S
(lock)168 4212 A
4422(*/)S
3375 V
(21038)210 1122 A
(#define)294 1440 A
(XPOPEN)252 1776 A
(\(-NR_TASKS-3\))546 2112 A
2784(/*)S
(used)168 2910 A
3120(in)S
(fp_task)294 3246 A
(when)168 3582 A
(susp'd)252 3792 A
4086(on)S
(pipe)168 4212 A
(open)168 4422 A
4632(*/)S
3465 V
(21039)210 1122 A
(#define)294 1440 A
(XSELECT)294 1776 A
(\(-NR_TASKS-4\))546 2112 A
2784(/*)S
(used)168 2910 A
3120(in)S
(fp_task)294 3246 A
(when)168 3582 A
(susp'd)252 3792 A
4086(on)S
(select)252 4212 A
4506(*/)S
3555 V
(21040)210 1122 A
3645 V
(21041)210 1122 A
(#define)294 1440 A
(NO_BIT)252 1776 A
(\(\(bit_t\))336 2154 A
2532(0\))S
2784(/*)S
(returned)336 2910 A
3288(by)S
(alloc_bit\(\))462 3414 A
3918(to)S
(signal)252 4044 A
(failure)294 4338 A
4674(*/)S
3735 V
(21042)210 1122 A
3825 V
(21043)210 1122 A
(#define)294 1440 A
(DUP_MASK)336 1776 A
(0100)168 2448 A
2784(/*)S
(mask)168 2910 A
3120(to)S
(distinguish)462 3246 A
(dup2)168 3750 A
(from)168 3960 A
(dup)126 4170 A
4338(*/)S
3915 V
(21044)210 1122 A
4005 V
(21045)210 1122 A
(#define)294 1440 A
(LOOK_UP)294 1776 A
2574(0)S
2658(/*)S
(tells)210 2784 A
(search_dir)420 3036 A
3498(to)S
(lookup)252 3624 A
(string)252 3918 A
4212(*/)S
4095 V
(21046)210 1122 A
(#define)294 1440 A
(ENTER)210 1776 A
2574(1)S
2658(/*)S
(tells)210 2784 A
(search_dir)420 3036 A
3498(to)S
(make)168 3624 A
(dir)126 3834 A
(entry)210 4002 A
4254(*/)S
4185 V
(21047)210 1122 A
(#define)294 1440 A
(DELETE)252 1776 A
2574(2)S
2658(/*)S
(tells)210 2784 A
(search_dir)420 3036 A
3498(to)S
(delete)252 3624 A
(entry)210 3918 A
4170(*/)S
4275 V
(21048)210 1122 A
(#define)294 1440 A
(IS_EMPTY)336 1776 A
2574(3)S
2658(/*)S
(tells)210 2784 A
(search_dir)420 3036 A
3498(to)S
(ret.)168 3624 A
3834(OK)S
3960(or)S
(ENOTEMPTY)378 4086 A
4506(*/)S
4365 V
(21049)210 1122 A
4455 V
(21050)210 1122 A
(#define)294 1440 A
(CLEAN)210 1776 A
2574(0)S
2784(/*)S
(disk)168 2910 A
(and)126 3120 A
(memory)252 3288 A
(copies)252 3582 A
(identical)378 3876 A
4296(*/)S
4545 V
(21051)210 1122 A
(#define)294 1440 A
(DIRTY)210 1776 A
2574(1)S
2784(/*)S
(disk)168 2910 A
(and)126 3120 A
(memory)252 3288 A
(copies)252 3582 A
(differ)252 3876 A
4170(*/)S
4635 V
(21052)210 1122 A
(#define)294 1440 A
(ATIME)210 1776 A
(002)126 2490 A
2784(/*)S
(set)126 2910 A
3078(if)S
(atime)210 3204 A
(field)210 3456 A
(needs)210 3708 A
(updating)336 3960 A
4338(*/)S
4725 V
(21053)210 1122 A
(#define)294 1440 A
(CTIME)210 1776 A
(004)126 2490 A
2784(/*)S
(set)126 2910 A
3078(if)S
(ctime)210 3204 A
(field)210 3456 A
(needs)210 3708 A
(updating)336 3960 A
4338(*/)S
4815 V
(21054)210 1122 A
(#define)294 1440 A
(MTIME)210 1776 A
(010)126 2490 A
2784(/*)S
(set)126 2910 A
3078(if)S
(mtime)210 3204 A
(field)210 3456 A
(needs)210 3708 A
(updating)336 3960 A
4338(*/)S
4905 V
(21055)210 1122 A
4995 V
(21056)210 1122 A
(#define)294 1440 A
(BYTE_SWAP)378 1776 A
2574(0)S
2784(/*)S
(tells)210 2910 A
(conv2/conv4)462 3162 A
3666(to)S
(swap)168 3792 A
(bytes)210 4002 A
4254(*/)S
5085 V
(21057)210 1122 A
5175 V
(21058)210 1122 A
(#define)294 1440 A
(END_OF_FILE)462 1776 A
(\(-104\))252 2364 A
2784(/*)S
(eof)126 2910 A
(detected)336 3078 A
3456(*/)S
5265 V
(21059)210 1122 A
5355 V
(21060)210 1122 A
(#define)294 1440 A
(ROOT_INODE)420 1776 A
2574(1)S
3120(/*)S
(inode)210 3246 A
(number)252 3498 A
(for)126 3792 A
(root)168 3960 A
(directory)378 4170 A
4590(*/)S
5445 V
(21061)210 1122 A
(#define)294 1440 A
(BOOT_BLOCK)420 1776 A
(\(\(block_t\))420 2280 A
2742(0\))S
3120(/*)S
(block)210 3246 A
(number)252 3498 A
3792(of)S
(boot)168 3918 A
(block)210 4128 A
4380(*/)S
5535 V
(21062)210 1122 A
(#define)294 1440 A
(SUPER_BLOCK_BYTES)714 1776 A
(\(1024\))252 2532 A
3120(/*)S
(bytes)210 3246 A
(offset)252 3498 A
3792(*/)S
5625 V
(21063)210 1122 A
(#define)294 1440 A
(START_BLOCK)462 1776 A
2448(2)S
3120(/*)S
(first)210 3246 A
(block)210 3498 A
3750(of)S
3876(FS)S
(\(not)168 4002 A
(counting)336 4212 A
(SB\))126 4590 A
4758(*/)S
5715 V
(21064)210 1122 A
5805 V
(21065)210 1122 A
(#define)294 1440 A
(DIR_ENTRY_SIZE)588 1776 A
(usizeof)294 2658 A
(\(struct)294 2994 A
(direct\))294 3330 A
3708(/*)S
3834(#)S
(bytes/dir)378 3918 A
(entry)210 4338 A
4674(*/)S
5895 V
(21066)210 1122 A
(#define)294 1440 A
(NR_DIR_ENTRIES\(b\))714 1776 A
(\(\(b\)/DIR_ENTRY_SIZE\))840 2616 A
3540(/*)S
3666(#)S
(dir)126 3750 A
(entries/blk)462 3918 A
4506(*/)S
5985 V
(21067)210 1122 A
(#define)294 1440 A
(SUPER_SIZE)420 1776 A
(usizeof)294 2448 A
(\(struct)294 2784 A
(super_block\))504 3120 A
3708(/*)S
(super_block)462 3834 A
(size)168 4338 A
4674(*/)S
6075 V
(21068)210 1122 A
(#define)294 1440 A
(PIPE_SIZE\(b\))504 1776 A
(\(V1_NR_DZONES*\(b\)\))756 2700 A
3540(/*)S
(pipe)168 3666 A
(size)168 3876 A
4086(in)S
(bytes)210 4212 A
4506(*/)S
6165 V
(21069)210 1122 A
6255 V
(21070)210 1122 A
(#define)294 1440 A
(FS_BITMAP_CHUNKS\(b\))798 1776 A
(\(\(b\)/usizeof)504 2616 A
(\(bitchunk_t\)\)/*)630 3162 A
3834(#)S
(map)126 3918 A
(chunks/blk)420 4086 A
4632(*/)S
6345 V
(21071)210 1122 A
(#define)294 1440 A
(FS_BITCHUNK_BITS)672 1776 A
(\(usizeof\(bitchunk_t\))840 3120 A
4002(*)S
(CHAR_BIT\))378 4086 A
6435 V
(21072)210 1122 A
(#define)294 1440 A
(FS_BITS_PER_BLOCK\(b\))840 1776 A
(\(FS_BITMAP_CHUNKS\(b\))840 2784 A
3666(*)S
(FS_BITCHUNK_BITS\))714 3750 A
6525 V
(21073)210 1122 A
6615 V
(21074)210 1122 A
1440(/*)S
(Derived)294 1566 A
(sizes)210 1902 A
(pertaining)420 2154 A
2616(to)S
(the)126 2742 A
2910(V1)S
(file)168 3036 A
(system.)294 3246 A
3582(*/)S
6705 V
(21075)210 1122 A
(#define)294 1440 A
(V1_ZONE_NUM_SIZE)672 1776 A
(usizeof)294 2910 A
(\(zone1_t\))378 3246 A
3708(/*)S
3834(#)S
(bytes)210 3918 A
4170(in)S
4296(V1)S
(zone)168 4422 A
4674(*/)S
6795 V
(21076)210 1122 A
(#define)294 1440 A
(V1_INODE_SIZE)546 1776 A
(usizeof)294 2868 A
(\(d1_inode\))420 3204 A
3708(/*)S
(bytes)210 3834 A
4086(in)S
4212(V1)S
(dsk)126 4338 A
(ino)126 4506 A
4674(*/)S
6885 V
(21077)210 1122 A
6975 V
(21078)210 1122 A
1440(/*)S
1566(#)S
(zones/indir)462 1650 A
(block)210 2154 A
2406(*/)S
7065 V
(21079)210 1122 A
(#define)294 1440 A
(V1_INDIRECTS)504 1776 A
(\(STATIC_BLOCK_SIZE/V1_ZONE_NUM_SIZE\))1512 2322 A
8418 V
EP
%%Page: 283 283
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2376(File:)S
2609(servers/fs/const.h)S
12 B
(283)180 4500 A
1755 V
7 LST
(21080)210 1122 A
1845 V
(21081)210 1122 A
1440(/*)S
1566(#)S
1650(V1)S
(dsk)126 1776 A
(inodes/blk)420 1944 A
2406(*/)S
1935 V
(21082)210 1122 A
(#define)294 1440 A
(V1_INODES_PER_BLOCK)798 1776 A
(\(STATIC_BLOCK_SIZE/V1_INODE_SIZE\))1386 2616 A
2025 V
(21083)210 1122 A
2115 V
(21084)210 1122 A
1440(/*)S
(Derived)294 1566 A
(sizes)210 1902 A
(pertaining)420 2154 A
2616(to)S
(the)126 2742 A
2910(V2)S
(file)168 3036 A
(system.)294 3246 A
3582(*/)S
2205 V
(21085)210 1122 A
(#define)294 1440 A
(V2_ZONE_NUM_SIZE)672 1776 A
(usizeof)294 2952 A
(\(zone_t\))336 3288 A
3708(/*)S
3834(#)S
(bytes)210 3918 A
4170(in)S
4296(V2)S
(zone)168 4422 A
4674(*/)S
2295 V
(21086)210 1122 A
(#define)294 1440 A
(V2_INODE_SIZE)546 1776 A
(usizeof)294 2868 A
(\(d2_inode\))420 3204 A
3708(/*)S
(bytes)210 3834 A
4086(in)S
4212(V2)S
(dsk)126 4338 A
(ino)126 4506 A
4674(*/)S
2385 V
(21087)210 1122 A
(#define)294 1440 A
(V2_INDIRECTS\(b\))630 1776 A
(\(\(b\)/V2_ZONE_NUM_SIZE\))924 2532 A
3540(/*)S
3666(#)S
(zones/indir)462 3750 A
(block)210 4254 A
4506(*/)S
2475 V
(21088)210 1122 A
(#define)294 1440 A
(V2_INODES_PER_BLOCK\(b\))924 1776 A
(\(\(b\)/V2_INODE_SIZE\)/*)882 2742 A
3666(#)S
3750(V2)S
(dsk)126 3876 A
(inodes/blk)420 4044 A
4506(*/)S
2745 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2835 V
(servers/fs/type.h)714 2676 A
2925 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3105 V
(21100)210 1122 A
1440(/*)S
(Declaration)462 1566 A
2070(of)S
(the)126 2196 A
2364(V1)S
(inode)210 2490 A
2742(as)S
2868(it)S
2994(is)S
3120(on)S
(the)126 3246 A
(disk)168 3414 A
(\(not)168 3624 A
3834(in)S
(core\).)252 3960 A
4254(*/)S
3195 V
(21101)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
2070({)S
2784(/*)S
(V1.x)168 2910 A
(disk)168 3120 A
(inode)210 3330 A
3582(*/)S
3285 V
(21102)210 1122 A
(mode_t)252 1524 A
(d1_mode;)336 1818 A
2784(/*)S
(file)168 2910 A
(type,)210 3120 A
(protection,)462 3372 A
(etc.)168 3876 A
4086(*/)S
3375 V
(21103)210 1122 A
(uid_t)210 1524 A
(d1_uid;)294 1776 A
2784(/*)S
(user)168 2910 A
3120(id)S
3246(of)S
(the)126 3372 A
(file's)252 3540 A
(owner)210 3834 A
4086(*/)S
3465 V
(21104)210 1122 A
(off_t)210 1524 A
(d1_size;)336 1776 A
2784(/*)S
(current)294 2910 A
(file)168 3246 A
(size)168 3456 A
3666(in)S
(bytes)210 3792 A
4044(*/)S
3555 V
(21105)210 1122 A
(time_t)252 1524 A
(d1_mtime;)378 1818 A
2784(/*)S
(when)168 2910 A
(was)126 3120 A
(file)168 3288 A
(data)168 3498 A
(last)168 3708 A
(changed)294 3918 A
4254(*/)S
3645 V
(21106)210 1122 A
(u8_t)168 1524 A
(d1_gid;)294 1734 A
2784(/*)S
(group)210 2910 A
(number)252 3162 A
3456(*/)S
3735 V
(21107)210 1122 A
(u8_t)168 1524 A
(d1_nlinks;)420 1734 A
2784(/*)S
(how)126 2910 A
(many)168 3078 A
(links)210 3288 A
3540(to)S
(this)168 3666 A
(file)168 3876 A
4086(*/)S
3825 V
(21108)210 1122 A
(u16_t)210 1524 A
(d1_zone[V1_NR_TZONES];)924 1776 A
2784(/*)S
(block)210 2910 A
(nums)168 3162 A
(for)126 3372 A
(direct,)294 3540 A
(ind,)168 3876 A
(and)126 4086 A
(dbl)126 4254 A
(ind)126 4422 A
4590(*/)S
3915 V
(21109)210 1122 A
1440(})S
(d1_inode;)378 1524 A
4005 V
(21110)210 1122 A
4095 V
(21111)210 1122 A
1440(/*)S
(Declaration)462 1566 A
2070(of)S
(the)126 2196 A
2364(V2)S
(inode)210 2490 A
2742(as)S
2868(it)S
2994(is)S
3120(on)S
(the)126 3246 A
(disk)168 3414 A
(\(not)168 3624 A
3834(in)S
(core\).)252 3960 A
4254(*/)S
4185 V
(21112)210 1122 A
(typedef)294 1440 A
(struct)252 1776 A
2070({)S
2784(/*)S
(V2.x)168 2910 A
(disk)168 3120 A
(inode)210 3330 A
3582(*/)S
4275 V
(21113)210 1122 A
(mode_t)252 1524 A
(d2_mode;)336 1818 A
2784(/*)S
(file)168 2910 A
(type,)210 3120 A
(protection,)462 3372 A
(etc.)168 3876 A
4086(*/)S
4365 V
(21114)210 1122 A
(u16_t)210 1524 A
(d2_nlinks;)420 1776 A
2784(/*)S
(how)126 2910 A
(many)168 3078 A
(links)210 3288 A
3540(to)S
(this)168 3666 A
(file.)210 3876 A
(HACK!)210 4128 A
4380(*/)S
4455 V
(21115)210 1122 A
(uid_t)210 1524 A
(d2_uid;)294 1776 A
2784(/*)S
(user)168 2910 A
3120(id)S
3246(of)S
(the)126 3372 A
(file's)252 3540 A
(owner.)252 3834 A
4128(*/)S
4545 V
(21116)210 1122 A
(u16_t)210 1524 A
(d2_gid;)294 1776 A
2784(/*)S
(group)210 2910 A
(number)252 3162 A
(HACK!)210 3456 A
3708(*/)S
4635 V
(21117)210 1122 A
(off_t)210 1524 A
(d2_size;)336 1776 A
2784(/*)S
(current)294 2910 A
(file)168 3246 A
(size)168 3456 A
3666(in)S
(bytes)210 3792 A
4044(*/)S
4725 V
(21118)210 1122 A
(time_t)252 1524 A
(d2_atime;)378 1818 A
2784(/*)S
(when)168 2910 A
(was)126 3120 A
(file)168 3288 A
(data)168 3498 A
(last)168 3708 A
(accessed)336 3918 A
4296(*/)S
4815 V
(21119)210 1122 A
(time_t)252 1524 A
(d2_mtime;)378 1818 A
2784(/*)S
(when)168 2910 A
(was)126 3120 A
(file)168 3288 A
(data)168 3498 A
(last)168 3708 A
(changed)294 3918 A
4254(*/)S
4905 V
(21120)210 1122 A
(time_t)252 1524 A
(d2_ctime;)378 1818 A
2784(/*)S
(when)168 2910 A
(was)126 3120 A
(inode)210 3288 A
(data)168 3540 A
(last)168 3750 A
(changed)294 3960 A
4296(*/)S
4995 V
(21121)210 1122 A
(zone_t)252 1524 A
(d2_zone[V2_NR_TZONES];)924 1818 A
2784(/*)S
(block)210 2910 A
(nums)168 3162 A
(for)126 3372 A
(direct,)294 3540 A
(ind,)168 3876 A
(and)126 4086 A
(dbl)126 4254 A
(ind)126 4422 A
4590(*/)S
5085 V
(21122)210 1122 A
1440(})S
(d2_inode;)378 1524 A
5445 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5535 V
(servers/fs/proto.h)756 2676 A
5625 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5805 V
(21200)210 1122 A
1440(/*)S
(Function)336 1566 A
(prototypes.)462 1944 A
2448(*/)S
5895 V
(21201)210 1122 A
5985 V
(21202)210 1122 A
(#include)336 1440 A
("timers.h")420 1818 A
6075 V
(21203)210 1122 A
6165 V
(21204)210 1122 A
1440(/*)S
(Structs)294 1566 A
(used)168 1902 A
2112(in)S
(prototypes)420 2238 A
(must)168 2700 A
2910(be)S
(declared)336 3036 A
3414(as)S
(such)168 3540 A
(first.)252 3750 A
4044(*/)S
6255 V
(21205)210 1122 A
(struct)252 1440 A
(buf;)168 1734 A
6345 V
(21206)210 1122 A
(struct)252 1440 A
(filp;)210 1734 A
6435 V
(21207)210 1122 A
(struct)252 1440 A
(inode;)252 1734 A
6525 V
(21208)210 1122 A
(struct)252 1440 A
(super_block;)504 1734 A
6615 V
(21209)210 1122 A
6705 V
(21210)210 1122 A
1440(/*)S
(cache.c)294 1566 A
1902(*/)S
6795 V
(21211)210 1122 A
(_PROTOTYPE\()462 1440 A
(zone_t)252 1944 A
(alloc_zone,)462 2238 A
(\(Dev_t)252 2742 A
(dev,)168 3036 A
(zone_t)252 3246 A
3540(z\))S
4464(\);)S
6885 V
(21212)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(flushall,)378 2154 A
(\(Dev_t)252 2574 A
(dev\))168 2868 A
4464(\);)S
6975 V
(21213)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(free_zone,)420 2154 A
(\(Dev_t)252 2616 A
(dev,)168 2910 A
(zone_t)252 3120 A
(numb\))210 3414 A
4464(\);)S
7065 V
(21214)210 1122 A
(_PROTOTYPE\()462 1440 A
(struct)252 1944 A
(buf)126 2238 A
(*get_block,)462 2406 A
(\(Dev_t)252 2910 A
(dev,)168 3204 A
(block_t)294 3414 A
(block,int)378 3750 A
(only_search\)\);)588 4170 A
8418 V
EP
%%Page: 284 284
BP
/slant 0 def
/height 0 def
1485 V
12 B
(284)180 1080 A
11 R
2377(File:)S
2610(servers/fs/proto.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(21215)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(invalidate,)462 2154 A
(\(Dev_t)252 2658 A
(device\))294 2952 A
4464(\);)S
1845 V
(21216)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(put_block,)420 2154 A
(\(struct)294 2616 A
(buf)126 2952 A
(*bp,)168 3120 A
(int)126 3330 A
(block_type\))462 3498 A
4464(\);)S
1935 V
(21217)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(rw_block,)378 2154 A
(\(struct)294 2574 A
(buf)126 2910 A
(*bp,)168 3078 A
(int)126 3288 A
(rw_flag\))336 3456 A
4464(\);)S
2025 V
(21218)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(rw_scattered,)546 2154 A
(\(Dev_t)252 2742 A
(dev,)168 3036 A
2115 V
(21219)210 1122 A
(struct)252 2448 A
(buf)126 2742 A
(**bufq,)294 2910 A
(int)126 3246 A
(bufqsize,)378 3414 A
(int)126 3834 A
(rw_flag\))336 4002 A
4464(\);)S
2205 V
(21220)210 1122 A
2295 V
(21221)210 1122 A
1440(/*)S
(device.c)336 1566 A
1944(*/)S
2385 V
(21222)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(dev_open,)378 2112 A
(\(Dev_t)252 2532 A
(dev,)168 2826 A
(int)126 3036 A
(proc,)210 3204 A
(int)126 3456 A
(flags\))252 3624 A
4464(\);)S
2475 V
(21223)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(dev_close,)420 2154 A
(\(Dev_t)252 2616 A
(dev\))168 2910 A
4464(\);)S
2565 V
(21224)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(dev_io,)294 2112 A
(\(int)168 2448 A
(op,)126 2658 A
(Dev_t)210 2826 A
(dev,)168 3078 A
(int)126 3288 A
(proc,)210 3456 A
(void)168 3708 A
(*buf,)210 3918 A
2655 V
(21225)210 1122 A
(off_t)210 2448 A
(pos,)168 2700 A
(int)126 2910 A
(bytes,)252 3078 A
(int)126 3372 A
(flags\))252 3540 A
4464(\);)S
2745 V
(21226)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(gen_opcl,)378 2112 A
(\(int)168 2532 A
(op,)126 2742 A
(Dev_t)210 2910 A
(dev,)168 3162 A
(int)126 3372 A
(proc,)210 3540 A
(int)126 3792 A
(flags\))252 3960 A
4464(\);)S
2835 V
(21227)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(gen_io,)294 2154 A
(\(int)168 2490 A
(task_nr,)336 2700 A
(message)294 3078 A
(*mess_ptr\))420 3414 A
4464(\);)S
2925 V
(21228)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(no_dev,)294 2112 A
(\(int)168 2448 A
(op,)126 2658 A
(Dev_t)210 2826 A
(dev,)168 3078 A
(int)126 3288 A
(proc,)210 3456 A
(int)126 3708 A
(flags\))252 3876 A
4464(\);)S
3015 V
(21229)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(tty_opcl,)378 2112 A
(\(int)168 2532 A
(op,)126 2742 A
(Dev_t)210 2910 A
(dev,)168 3162 A
(int)126 3372 A
(proc,)210 3540 A
(int)126 3792 A
(flags\))252 3960 A
4464(\);)S
3105 V
(21230)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(ctty_opcl,)420 2112 A
(\(int)168 2574 A
(op,)126 2784 A
(Dev_t)210 2952 A
(dev,)168 3204 A
(int)126 3414 A
(proc,)210 3582 A
(int)126 3834 A
(flags\))252 4002 A
4464(\);)S
3195 V
(21231)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(clone_opcl,)462 2112 A
(\(int)168 2616 A
(op,)126 2826 A
(Dev_t)210 2994 A
(dev,)168 3246 A
(int)126 3456 A
(proc,)210 3624 A
(int)126 3876 A
(flags\))252 4044 A
4464(\);)S
3285 V
(21232)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(ctty_io,)336 2154 A
(\(int)168 2532 A
(task_nr,)336 2742 A
(message)294 3120 A
(*mess_ptr\))420 3456 A
4464(\);)S
3375 V
(21233)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_ioctl,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
3465 V
(21234)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_setsid,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
3555 V
(21235)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(dev_status,)462 2154 A
(\(message)336 2658 A
3036(*\))S
4464(\);)S
3645 V
(21236)210 1122 A
3735 V
(21237)210 1122 A
1440(/*)S
(dmp.c)210 1566 A
1818(*/)S
3825 V
(21238)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_fkey_pressed,)672 2112 A
(\(void\))252 2826 A
4464(\);)S
3915 V
(21239)210 1122 A
4005 V
(21240)210 1122 A
1440(/*)S
(dmap.c)252 1566 A
1860(*/)S
4095 V
(21241)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_devctl,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
4185 V
(21242)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(build_dmap,)462 2154 A
(\(void\))252 2658 A
4464(\);)S
4275 V
(21243)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(map_driver,)462 2112 A
(\(int)168 2616 A
(major,)252 2826 A
(int)126 3120 A
(proc_nr,)336 3288 A
(int)126 3666 A
(dev_style\))420 3834 A
4464(\);)S
4365 V
(21244)210 1122 A
4455 V
(21245)210 1122 A
1440(/*)S
(filedes.c)378 1566 A
1986(*/)S
4545 V
(21246)210 1122 A
(_PROTOTYPE\()462 1440 A
(struct)252 1944 A
(filp)168 2238 A
(*find_filp,)462 2448 A
(\(struct)294 2952 A
(inode)210 3288 A
(*rip,)210 3540 A
(mode_t)252 3792 A
(bits\))210 4086 A
4464(\);)S
4635 V
(21247)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(get_fd,)294 2112 A
(\(int)168 2448 A
(start,)252 2658 A
(mode_t)252 2952 A
(bits,)210 3246 A
(int)126 3498 A
(*k,)126 3666 A
(struct)252 3834 A
(filp)168 4128 A
(**fpt\))252 4338 A
4632(\);)S
4725 V
(21248)210 1122 A
(_PROTOTYPE\()462 1440 A
(struct)252 1944 A
(filp)168 2238 A
(*get_filp,)420 2448 A
(\(int)168 2910 A
(fild\))210 3120 A
4464(\);)S
4815 V
(21249)210 1122 A
4905 V
(21250)210 1122 A
1440(/*)S
(inode.c)294 1566 A
1902(*/)S
4995 V
(21251)210 1122 A
(_PROTOTYPE\()462 1440 A
(struct)252 1944 A
(inode)210 2238 A
(*alloc_inode,)546 2490 A
(\(dev_t)252 3078 A
(dev,)168 3372 A
(mode_t)252 3582 A
(bits\))210 3876 A
4464(\);)S
5085 V
(21252)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(dup_inode,)420 2154 A
(\(struct)294 2616 A
(inode)210 2952 A
(*ip\))168 3204 A
4464(\);)S
5175 V
(21253)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(free_inode,)462 2154 A
(\(Dev_t)252 2658 A
(dev,)168 2952 A
(Ino_t)210 3162 A
(numb\))210 3414 A
4464(\);)S
5265 V
(21254)210 1122 A
(_PROTOTYPE\()462 1440 A
(struct)252 1944 A
(inode)210 2238 A
(*get_inode,)462 2490 A
(\(Dev_t)252 2994 A
(dev,)168 3288 A
(int)126 3498 A
(numb\))210 3666 A
4464(\);)S
5355 V
(21255)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(put_inode,)420 2154 A
(\(struct)294 2616 A
(inode)210 2952 A
(*rip\))210 3204 A
4464(\);)S
5445 V
(21256)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(update_times,)546 2154 A
(\(struct)294 2742 A
(inode)210 3078 A
(*rip\))210 3330 A
4464(\);)S
5535 V
(21257)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(rw_inode,)378 2154 A
(\(struct)294 2574 A
(inode)210 2910 A
(*rip,)210 3162 A
(int)126 3414 A
(rw_flag\))336 3582 A
4464(\);)S
5625 V
(21258)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(wipe_inode,)462 2154 A
(\(struct)294 2658 A
(inode)210 2994 A
(*rip\))210 3246 A
4464(\);)S
5715 V
(21259)210 1122 A
5805 V
(21260)210 1122 A
1440(/*)S
(link.c)252 1566 A
1860(*/)S
5895 V
(21261)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_link,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
5985 V
(21262)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_unlink,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
6075 V
(21263)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_rename,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
6165 V
(21264)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(truncate,)378 2154 A
(\(struct)294 2574 A
(inode)210 2910 A
(*rip\))210 3162 A
4464(\);)S
6255 V
(21265)210 1122 A
6345 V
(21266)210 1122 A
1440(/*)S
(lock.c)252 1566 A
1860(*/)S
6435 V
(21267)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(lock_op,)336 2112 A
(\(struct)294 2490 A
(filp)168 2826 A
(*f,)126 3036 A
(int)126 3204 A
(req\))168 3372 A
4464(\);)S
6525 V
(21268)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(lock_revive,)504 2154 A
(\(void\))252 2700 A
4464(\);)S
6615 V
(21269)210 1122 A
6705 V
(21270)210 1122 A
1440(/*)S
(main.c)252 1566 A
1860(*/)S
6795 V
(21271)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(main,)210 2112 A
(\(void\))252 2364 A
4464(\);)S
6885 V
(21272)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(reply,)252 2154 A
(\(int)168 2448 A
(whom,)210 2658 A
(int)126 2910 A
(result\))294 3078 A
4464(\);)S
6975 V
(21273)210 1122 A
7065 V
(21274)210 1122 A
1440(/*)S
(misc.c)252 1566 A
1860(*/)S
8418 V
EP
%%Page: 285 285
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2377(File:)S
2610(servers/fs/proto.h)S
12 B
(285)180 4500 A
1755 V
7 LST
(21275)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_dup,)294 2112 A
(\(void\))252 2448 A
4464(\);)S
1845 V
(21276)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_exit,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
1935 V
(21277)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_fcntl,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
2025 V
(21278)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_fork,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
2115 V
(21279)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_exec,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
2205 V
(21280)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_revive,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
2295 V
(21281)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_set,)294 2112 A
(\(void\))252 2448 A
4464(\);)S
2385 V
(21282)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_sync,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
2475 V
(21283)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_fsync,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
2565 V
(21284)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_reboot,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
2655 V
(21285)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_svrctl,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
2745 V
(21286)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_getsysinfo,)588 2112 A
(\(void\))252 2742 A
4464(\);)S
2835 V
(21287)210 1122 A
2925 V
(21288)210 1122 A
1440(/*)S
(mount.c)294 1566 A
1902(*/)S
3015 V
(21289)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_mount,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
3105 V
(21290)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_umount,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
3195 V
(21291)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(unmount,)336 2112 A
(\(Dev_t)252 2490 A
(dev\))168 2784 A
4464(\);)S
3285 V
(21292)210 1122 A
3375 V
(21293)210 1122 A
1440(/*)S
(open.c)252 1566 A
1860(*/)S
3465 V
(21294)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_close,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
3555 V
(21295)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_creat,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
3645 V
(21296)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_lseek,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
3735 V
(21297)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_mknod,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
3825 V
(21298)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_mkdir,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
3915 V
(21299)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_open,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
4005 V
(21300)210 1122 A
4095 V
(21301)210 1122 A
1440(/*)S
(path.c)252 1566 A
1860(*/)S
4185 V
(21302)210 1122 A
(_PROTOTYPE\()462 1440 A
(struct)252 1944 A
(inode)210 2238 A
(*advance,\(struct)672 2490 A
(inode)210 3204 A
(*dirp,)252 3456 A
(char)168 3750 A
(string[NAME_MAX]\)\);)798 3960 A
4275 V
(21303)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(search_dir,)462 2112 A
(\(struct)294 2616 A
(inode)210 2952 A
(*ldir_ptr,)420 3204 A
4365 V
(21304)210 1122 A
(char)168 2448 A
(string)252 2658 A
([NAME_MAX],)462 2952 A
(ino_t)210 3456 A
(*numb,)252 3708 A
(int)126 4002 A
(flag\))210 4170 A
4464(\);)S
4455 V
(21305)210 1122 A
(_PROTOTYPE\()462 1440 A
(struct)252 1944 A
(inode)210 2238 A
(*eat_path,)420 2490 A
(\(char)210 2952 A
(*path\))252 3204 A
4464(\);)S
4545 V
(21306)210 1122 A
(_PROTOTYPE\()462 1440 A
(struct)252 1944 A
(inode)210 2238 A
(*last_dir,)420 2490 A
(\(char)210 2952 A
(*path,)252 3204 A
(char)168 3498 A
(string)252 3708 A
([NAME_MAX]\)\);)546 4002 A
4635 V
(21307)210 1122 A
4725 V
(21308)210 1122 A
1440(/*)S
(pipe.c)252 1566 A
1860(*/)S
4815 V
(21309)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_pipe,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
4905 V
(21310)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_unpause,)462 2112 A
(\(void\))252 2616 A
4464(\);)S
4995 V
(21311)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(pipe_check,)462 2112 A
(\(struct)294 2616 A
(inode)210 2952 A
(*rip,)210 3204 A
(int)126 3456 A
(rw_flag,)336 3624 A
5085 V
(21312)210 1122 A
(int)126 2448 A
(oflags,)294 2616 A
(int)126 2952 A
(bytes,)252 3120 A
(off_t)210 3414 A
(position,)378 3666 A
(int)126 4086 A
(*canwrite,)420 4254 A
(int)126 4716 A
(notouch\)\);)420 4884 A
5175 V
(21313)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(release,)336 2154 A
(\(struct)294 2532 A
(inode)210 2868 A
(*ip,)168 3120 A
(int)126 3330 A
(call_nr,)336 3498 A
(int)126 3876 A
(count\))252 4044 A
4464(\);)S
5265 V
(21314)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(revive,)294 2154 A
(\(int)168 2490 A
(proc_nr,)336 2700 A
(int)126 3078 A
(bytes\))252 3246 A
4464(\);)S
5355 V
(21315)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(suspend,)336 2154 A
(\(int)168 2532 A
(task\))210 2742 A
4464(\);)S
5445 V
(21316)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(select_request_pipe,)840 2112 A
(\(struct)294 2994 A
(filp)168 3330 A
(*f,)126 3540 A
(int)126 3708 A
(*ops,)210 3876 A
(int)126 4128 A
(bl\))126 4296 A
4464(\);)S
5535 V
(21317)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(select_cancel_pipe,)798 2112 A
(\(struct)294 2952 A
(filp)168 3288 A
(*f\))126 3498 A
4464(\);)S
5625 V
(21318)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(select_match_pipe,)756 2112 A
(\(struct)294 2910 A
(filp)168 3246 A
(*f\))126 3456 A
4464(\);)S
5715 V
(21319)210 1122 A
5805 V
(21320)210 1122 A
1440(/*)S
(protect.c)378 1566 A
1986(*/)S
5895 V
(21321)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_access,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
5985 V
(21322)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_chmod,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
6075 V
(21323)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_chown,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
6165 V
(21324)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_umask,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
6255 V
(21325)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(forbidden,)420 2112 A
(\(struct)294 2574 A
(inode)210 2910 A
(*rip,)210 3162 A
(mode_t)252 3414 A
(access_desired\))630 3708 A
4464(\);)S
6345 V
(21326)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(read_only,)420 2112 A
(\(struct)294 2574 A
(inode)210 2910 A
(*ip\))168 3162 A
4464(\);)S
6435 V
(21327)210 1122 A
6525 V
(21328)210 1122 A
1440(/*)S
(read.c)252 1566 A
1860(*/)S
6615 V
(21329)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_read,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
6705 V
(21330)210 1122 A
(_PROTOTYPE\()462 1440 A
(struct)252 1944 A
(buf)126 2238 A
(*rahead,)336 2406 A
(\(struct)294 2784 A
(inode)210 3120 A
(*rip,)210 3372 A
(block_t)294 3624 A
(baseblock,)420 3960 A
6795 V
(21331)210 1122 A
(off_t)210 2448 A
(position,)378 2700 A
(unsigned)336 3120 A
(bytes_ahead\))504 3498 A
4464(\);)S
6885 V
(21332)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(read_ahead,)462 2154 A
(\(void\))252 2658 A
4464(\);)S
6975 V
(21333)210 1122 A
(_PROTOTYPE\()462 1440 A
(block_t)294 1944 A
(read_map,)378 2280 A
(\(struct)294 2700 A
(inode)210 3036 A
(*rip,)210 3288 A
(off_t)210 3540 A
(position\))378 3792 A
4464(\);)S
7065 V
(21334)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(read_write,)462 2112 A
(\(int)168 2616 A
(rw_flag\))336 2826 A
4464(\);)S
8418 V
EP
%%Page: 286 286
BP
/slant 0 def
/height 0 def
1485 V
12 B
(286)180 1080 A
11 R
2377(File:)S
2610(servers/fs/proto.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(21335)210 1122 A
(_PROTOTYPE\()462 1440 A
(zone_t)252 1944 A
(rd_indir,)378 2238 A
(\(struct)294 2658 A
(buf)126 2994 A
(*bp,)168 3162 A
(int)126 3372 A
(index\))252 3540 A
4464(\);)S
1845 V
(21336)210 1122 A
1935 V
(21337)210 1122 A
1440(/*)S
(stadir.c)336 1566 A
1944(*/)S
2025 V
(21338)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_chdir,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
2115 V
(21339)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_fchdir,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
2205 V
(21340)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_chroot,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
2295 V
(21341)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_fstat,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
2385 V
(21342)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_stat,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
2475 V
(21343)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_fstatfs,)462 2112 A
(\(void\))252 2616 A
4464(\);)S
2565 V
(21344)210 1122 A
2655 V
(21345)210 1122 A
1440(/*)S
(super.c)294 1566 A
1902(*/)S
2745 V
(21346)210 1122 A
(_PROTOTYPE\()462 1440 A
(bit_t)210 1944 A
(alloc_bit,)420 2196 A
(\(struct)294 2658 A
(super_block)462 2994 A
(*sp,)168 3498 A
(int)126 3708 A
(map,)168 3876 A
(bit_t)210 4086 A
(origin\)\);)378 4338 A
2835 V
(21347)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(free_bit,)378 2154 A
(\(struct)294 2574 A
(super_block)462 2910 A
(*sp,)168 3414 A
(int)126 3624 A
(map,)168 3792 A
2925 V
(21348)210 1122 A
(bit_t)210 3456 A
(bit_returned\))546 3708 A
4464(\);)S
3015 V
(21349)210 1122 A
(_PROTOTYPE\()462 1440 A
(struct)252 1944 A
(super_block)462 2238 A
(*get_super,)462 2742 A
(\(Dev_t)252 3246 A
(dev\))168 3540 A
4464(\);)S
3105 V
(21350)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(mounted,)336 2112 A
(\(struct)294 2490 A
(inode)210 2826 A
(*rip\))210 3078 A
4464(\);)S
3195 V
(21351)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(read_super,)462 2112 A
(\(struct)294 2616 A
(super_block)462 2952 A
(*sp\))168 3456 A
4464(\);)S
3285 V
(21352)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(get_block_size,)630 2112 A
(\(dev_t)252 2784 A
(dev\))168 3078 A
4464(\);)S
3375 V
(21353)210 1122 A
3465 V
(21354)210 1122 A
1440(/*)S
(time.c)252 1566 A
1860(*/)S
3555 V
(21355)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_stime,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
3645 V
(21356)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_utime,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
3735 V
(21357)210 1122 A
3825 V
(21358)210 1122 A
1440(/*)S
(utility.c)378 1566 A
1986(*/)S
3915 V
(21359)210 1122 A
(_PROTOTYPE\()462 1440 A
(time_t)252 1944 A
(clock_time,)462 2238 A
(\(void\))252 2742 A
4464(\);)S
4005 V
(21360)210 1122 A
(_PROTOTYPE\()462 1440 A
(unsigned)336 1944 A
(conv2,)252 2322 A
(\(int)168 2616 A
(norm,)210 2826 A
(int)126 3078 A
3246(w\))S
4464(\);)S
4095 V
(21361)210 1122 A
(_PROTOTYPE\()462 1440 A
(long)168 1944 A
(conv4,)252 2154 A
(\(int)168 2448 A
(norm,)210 2658 A
(long)168 2910 A
3120(x\))S
4464(\);)S
4185 V
(21362)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(fetch_name,)462 2112 A
(\(char)210 2616 A
(*path,)252 2868 A
(int)126 3162 A
(len,)168 3330 A
(int)126 3540 A
(flag\))210 3708 A
4464(\);)S
4275 V
(21363)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(no_sys,)294 2112 A
(\(void\))252 2448 A
4464(\);)S
4365 V
(21364)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(panic,)252 2154 A
(\(char)210 2448 A
(*who,)210 2700 A
(char)168 2952 A
(*mess,)252 3162 A
(int)126 3456 A
(num\))168 3624 A
4464(\);)S
4455 V
(21365)210 1122 A
4545 V
(21366)210 1122 A
1440(/*)S
(write.c)294 1566 A
1902(*/)S
4635 V
(21367)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(clear_zone,)462 2154 A
(\(struct)294 2658 A
(inode)210 2994 A
(*rip,)210 3246 A
(off_t)210 3498 A
(pos,)168 3750 A
(int)126 3960 A
(flag\))210 4128 A
4464(\);)S
4725 V
(21368)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_write,)378 2112 A
(\(void\))252 2532 A
4464(\);)S
4815 V
(21369)210 1122 A
(_PROTOTYPE\()462 1440 A
(struct)252 1944 A
(buf)126 2238 A
(*new_block,)462 2406 A
(\(struct)294 2910 A
(inode)210 3246 A
(*rip,)210 3498 A
(off_t)210 3750 A
(position\))378 4002 A
4464(\);)S
4905 V
(21370)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(zero_block,)462 2154 A
(\(struct)294 2658 A
(buf)126 2994 A
(*bp\))168 3162 A
4464(\);)S
4995 V
(21371)210 1122 A
5085 V
(21372)210 1122 A
1440(/*)S
(select.c)336 1566 A
1944(*/)S
5175 V
(21373)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(do_select,)420 2112 A
(\(void\))252 2574 A
4464(\);)S
5265 V
(21374)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(select_callback,)672 2112 A
(\(struct)294 2826 A
(filp)168 3162 A
3372(*,)S
(int)126 3498 A
(ops\))168 3666 A
4464(\);)S
5355 V
(21375)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(select_forget,)588 2154 A
(\(int)168 2784 A
(fproc\))252 2994 A
4464(\);)S
5445 V
(21376)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(select_timeout_check,)882 2154 A
(\(timer_t)336 3078 A
3456(*\))S
4464(\);)S
5535 V
(21377)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(init_select,)504 2154 A
(\(void\))252 2700 A
4464(\);)S
5625 V
(21378)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(select_notified,)672 2112 A
(\(int)168 2826 A
(major,)252 3036 A
(int)126 3330 A
(minor,)252 3498 A
(int)126 3792 A
(ops\))168 3960 A
4464(\);)S
5715 V
(21379)210 1122 A
5805 V
(21380)210 1122 A
1440(/*)S
(timers.c)336 1566 A
1944(*/)S
5895 V
(21381)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(fs_set_timer,)546 2154 A
(\(timer_t)336 2742 A
(*tp,)168 3120 A
(int)126 3330 A
(delta,)252 3498 A
(tmr_func_t)420 3792 A
(watchdog,)378 4254 A
(int)126 4674 A
(arg\)\);)252 4842 A
5985 V
(21382)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(fs_expire_timers,)714 2154 A
(\(clock_t)336 2910 A
(now\))168 3288 A
4464(\);)S
6075 V
(21383)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(fs_cancel_timer,)672 2154 A
(\(timer_t)336 2868 A
(*tp\))168 3246 A
4464(\);)S
6165 V
(21384)210 1122 A
(_PROTOTYPE\()462 1440 A
(void)168 1944 A
(fs_init_timer,)588 2154 A
(\(timer_t)336 2784 A
(*tp\))168 3162 A
4464(\);)S
6255 V
(21385)210 1122 A
6345 V
(21386)210 1122 A
1440(/*)S
(cdprobe.c)378 1566 A
1986(*/)S
6435 V
(21387)210 1122 A
(_PROTOTYPE\()462 1440 A
(int)126 1944 A
(cdprobe,)336 2112 A
(\(void\))252 2490 A
4464(\);)S
8418 V
EP
%%Page: 287 287
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2423(File:)S
2656(servers/fs/glo.h)S
12 B
(287)180 4500 A
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(servers/fs/glo.h)672 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(21400)210 1122 A
1440(/*)S
(EXTERN)252 1566 A
(should)252 1860 A
2154(be)S
(extern)252 2280 A
(except)252 2574 A
(for)126 2868 A
(the)126 3036 A
(table)210 3204 A
(file)168 3456 A
3666(*/)S
2295 V
(21401)210 1122 A
(#ifdef)252 1440 A
(_TABLE)252 1734 A
2385 V
(21402)210 1122 A
(#undef)252 1440 A
(EXTERN)252 1734 A
2475 V
(21403)210 1122 A
(#define)294 1440 A
(EXTERN)252 1776 A
2565 V
(21404)210 1122 A
(#endif)252 1440 A
2655 V
(21405)210 1122 A
2745 V
(21406)210 1122 A
1440(/*)S
(File)168 1566 A
(System)252 1776 A
(global)252 2070 A
(variables)378 2364 A
2784(*/)S
2835 V
(21407)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(fproc)210 2028 A
(*fp;)168 2280 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(caller's)336 3372 A
(fproc)210 3750 A
(struct)252 4002 A
4296(*/)S
2925 V
(21408)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(super_user;)462 1902 A
2784(/*)S
2910(1)S
2994(if)S
(caller)252 3120 A
3414(is)S
(super_user,)462 3540 A
(else)168 4044 A
4254(0)S
4338(*/)S
3015 V
(21409)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(susp_count;)462 1902 A
2784(/*)S
(number)252 2910 A
3204(of)S
(procs)210 3330 A
(suspended)378 3582 A
4002(on)S
(pipe)168 4128 A
4338(*/)S
3105 V
(21410)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(nr_locks;)378 1902 A
2784(/*)S
(number)252 2910 A
3204(of)S
(locks)210 3330 A
(currently)378 3582 A
4002(in)S
(place)210 4128 A
4380(*/)S
3195 V
(21411)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(reviving;)378 1902 A
2784(/*)S
(number)252 2910 A
3204(of)S
(pipe)168 3330 A
(processes)378 3540 A
3960(to)S
4086(be)S
(revived)294 4212 A
4548(*/)S
3285 V
(21412)210 1122 A
(EXTERN)252 1440 A
(off_t)210 1734 A
(rdahedpos;)420 1986 A
2784(/*)S
(position)336 2910 A
3288(to)S
(read)168 3414 A
(ahead)210 3624 A
3876(*/)S
3375 V
(21413)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(inode)210 2028 A
(*rdahed_inode;)588 2280 A
3120(/*)S
(pointer)294 3246 A
3582(to)S
(inode)210 3708 A
3960(to)S
(read)168 4086 A
(ahead)210 4296 A
4548(*/)S
3465 V
(21414)210 1122 A
(EXTERN)252 1440 A
(Dev_t)210 1734 A
(root_dev;)378 1986 A
2784(/*)S
(device)252 2910 A
(number)252 3204 A
3498(of)S
(the)126 3624 A
(root)168 3792 A
(device)252 4002 A
4296(*/)S
3555 V
(21415)210 1122 A
(EXTERN)252 1440 A
(time_t)252 1734 A
(boottime;)378 2028 A
2784(/*)S
(time)168 2910 A
3120(in)S
(seconds)294 3246 A
3582(at)S
(system)252 3708 A
(boot)168 4002 A
4212(*/)S
3645 V
(21416)210 1122 A
3735 V
(21417)210 1122 A
1440(/*)S
(The)126 1566 A
(parameters)420 1734 A
2196(of)S
(the)126 2322 A
(call)168 2490 A
(are)126 2700 A
(kept)168 2868 A
(here.)210 3078 A
3330(*/)S
3825 V
(21418)210 1122 A
(EXTERN)252 1440 A
(message)294 1734 A
(m_in;)210 2070 A
2784(/*)S
(the)126 2910 A
(input)210 3078 A
(message)294 3330 A
(itself)252 3666 A
3960(*/)S
3915 V
(21419)210 1122 A
(EXTERN)252 1440 A
(message)294 1734 A
(m_out;)252 2070 A
2784(/*)S
(the)126 2910 A
(output)252 3078 A
(message)294 3372 A
(used)168 3708 A
(for)126 3918 A
(reply)210 4086 A
4338(*/)S
4005 V
(21420)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(who;)168 1902 A
2784(/*)S
(caller's)336 2910 A
(proc)168 3288 A
(number)252 3498 A
3792(*/)S
4095 V
(21421)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(call_nr;)336 1902 A
2784(/*)S
(system)252 2910 A
(call)168 3204 A
(number)252 3414 A
3708(*/)S
4185 V
(21422)210 1122 A
(EXTERN)252 1440 A
(char)168 1734 A
(user_path[PATH_MAX];/*)924 1944 A
(storage)294 2910 A
(for)126 3246 A
(user)168 3414 A
(path)168 3624 A
(name)168 3834 A
4044(*/)S
4275 V
(21423)210 1122 A
4365 V
(21424)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(variables)378 2154 A
(are)126 2574 A
(used)168 2742 A
(for)126 2952 A
(returning)378 3120 A
(results)294 3540 A
3876(to)S
(the)126 4002 A
(caller.)294 4170 A
4506(*/)S
4455 V
(21425)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(err_code;)378 1902 A
2784(/*)S
(temporary)378 2910 A
(storage)294 3330 A
(for)126 3666 A
(error)210 3834 A
(number)252 4086 A
4380(*/)S
4545 V
(21426)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(rdwt_err;)378 1902 A
2784(/*)S
(status)252 2910 A
3204(of)S
(last)168 3330 A
(disk)168 3540 A
(i/o)126 3750 A
(request)294 3918 A
4254(*/)S
4635 V
(21427)210 1122 A
4725 V
(21428)210 1122 A
1440(/*)S
(Data)168 1566 A
(initialized)462 1776 A
(elsewhere.)420 2280 A
2742(*/)S
4815 V
(21429)210 1122 A
(extern)252 1440 A
(_PROTOTYPE)420 1734 A
(\(int)168 2196 A
(\(*call_vec[]\),)588 2406 A
(\(void\))252 3036 A
3330(\);)S
3456(/*)S
(sys)126 3582 A
(call)168 3750 A
(table)210 3960 A
4212(*/)S
4905 V
(21430)210 1122 A
(extern)252 1440 A
(char)168 1734 A
(dot1[2];)336 1944 A
2406(/*)S
(dot1)168 2532 A
(\(&dot1[0]\))420 2742 A
(and)126 3204 A
(dot2)168 3372 A
(\(&dot2[0]\))420 3582 A
(have)168 4044 A
4254(a)S
(special)294 4338 A
4674(*/)S
4995 V
(21431)210 1122 A
(extern)252 1440 A
(char)168 1734 A
(dot2[3];)336 1944 A
2406(/*)S
(meaning)294 2532 A
2868(to)S
(search_dir:)462 2994 A
3498(no)S
(access)252 3624 A
(permission)420 3918 A
(check.)252 4380 A
4674(*/)S
5445 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5535 V
(servers/fs/fproc.h)756 2676 A
5625 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5805 V
(21500)210 1122 A
1440(/*)S
(This)168 1566 A
1776(is)S
(the)126 1902 A
(per-process)462 2070 A
(information.)504 2574 A
3162(A)S
(slot)168 3246 A
3456(is)S
(reserved)336 3582 A
(for)126 3960 A
(each)168 4128 A
(potential)378 4338 A
5895 V
(21501)210 1122 A
1482(*)S
(process.)336 1566 A
(Thus)168 1944 A
(NR_PROCS)336 2154 A
(must)168 2532 A
2742(be)S
(the)126 2868 A
(same)168 3036 A
3246(as)S
3372(in)S
(the)126 3498 A
(kernel.)294 3666 A
4002(It)S
4128(is)S
(not)126 4254 A
5985 V
(21502)210 1122 A
1482(*)S
(possible)336 1566 A
1944(or)S
(even)168 2070 A
(necessary)378 2280 A
2700(to)S
(tell)168 2826 A
(when)168 3036 A
3246(a)S
(slot)168 3330 A
3540(is)S
(free)168 3666 A
(here.)210 3876 A
6075 V
(21503)210 1122 A
1482(*/)S
6165 V
(21504)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(fproc)210 2028 A
2280({)S
6255 V
(21505)210 1122 A
(mode_t)252 1524 A
(fp_umask;)378 1818 A
2784(/*)S
(mask)168 2910 A
(set)126 3120 A
3288(by)S
(umask)210 3414 A
(system)252 3666 A
(call)168 3960 A
4170(*/)S
6345 V
(21506)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*fp_workdir;)504 2070 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(working)294 3372 A
(directory's)462 3708 A
(inode)210 4212 A
4464(*/)S
6435 V
(21507)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*fp_rootdir;)504 2070 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(current)294 3372 A
(root)168 3708 A
(dir)126 3918 A
(\(see)168 4086 A
(chroot\))294 4296 A
4632(*/)S
6525 V
(21508)210 1122 A
(struct)252 1524 A
(filp)168 1818 A
(*fp_filp[OPEN_MAX];/*)882 2028 A
(the)126 2952 A
(file)168 3120 A
(descriptor)420 3330 A
(table)210 3792 A
4044(*/)S
6615 V
(21509)210 1122 A
(uid_t)210 1524 A
(fp_realuid;)462 1776 A
2784(/*)S
(real)168 2910 A
(user)168 3120 A
3330(id)S
3456(*/)S
6705 V
(21510)210 1122 A
(uid_t)210 1524 A
(fp_effuid;)420 1776 A
2784(/*)S
(effective)378 2910 A
(user)168 3330 A
3540(id)S
3666(*/)S
6795 V
(21511)210 1122 A
(gid_t)210 1524 A
(fp_realgid;)462 1776 A
2784(/*)S
(real)168 2910 A
(group)210 3120 A
3372(id)S
3498(*/)S
6885 V
(21512)210 1122 A
(gid_t)210 1524 A
(fp_effgid;)420 1776 A
2784(/*)S
(effective)378 2910 A
(group)210 3330 A
3582(id)S
3708(*/)S
6975 V
(21513)210 1122 A
(dev_t)210 1524 A
(fp_tty;)294 1776 A
2784(/*)S
(major/minor)462 2910 A
3414(of)S
(controlling)462 3540 A
(tty)126 4044 A
4212(*/)S
7065 V
(21514)210 1122 A
(int)126 1524 A
(fp_fd;)252 1692 A
2784(/*)S
(place)210 2910 A
3162(to)S
(save)168 3288 A
3498(fd)S
3624(if)S
(rd/wr)210 3750 A
(can't)210 4002 A
(finish)252 4254 A
4548(*/)S
8418 V
EP
%%Page: 288 288
BP
/slant 0 def
/height 0 def
1485 V
12 B
(288)180 1080 A
11 R
2376(File:)S
2609(servers/fs/fproc.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(21515)210 1122 A
(char)168 1524 A
(*fp_buffer;)462 1734 A
2784(/*)S
(place)210 2910 A
3162(to)S
(save)168 3288 A
(buffer)252 3498 A
3792(if)S
(rd/wr)210 3918 A
(can't)210 4170 A
(finish*/)336 4422 A
1845 V
(21516)210 1122 A
(int)126 1524 A
(fp_nbytes;)420 1734 A
2784(/*)S
(place)210 2910 A
3162(to)S
(save)168 3288 A
(bytes)210 3498 A
3750(if)S
(rd/wr)210 3876 A
(can't)210 4128 A
(finish)252 4380 A
4674(*/)S
1935 V
(21517)210 1122 A
(int)126 1524 A
(fp_cum_io_partial;)756 1734 A
2784(/*)S
(partial)294 2910 A
(byte)168 3246 A
(count)210 3456 A
3708(if)S
(rd/wr)210 3834 A
(can't)210 4086 A
(finish)252 4338 A
4632(*/)S
2025 V
(21518)210 1122 A
(char)168 1524 A
(fp_suspended;)546 1734 A
2784(/*)S
(set)126 2910 A
3078(to)S
(indicate)336 3204 A
(process)294 3582 A
(hanging)294 3918 A
4254(*/)S
2115 V
(21519)210 1122 A
(char)168 1524 A
(fp_revived;)462 1734 A
2784(/*)S
(set)126 2910 A
3078(to)S
(indicate)336 3204 A
(process)294 3582 A
(being)210 3918 A
(revived)294 4170 A
4506(*/)S
2205 V
(21520)210 1122 A
(char)168 1524 A
(fp_task;)336 1734 A
2784(/*)S
(which)210 2910 A
(task)168 3162 A
3372(is)S
(proc)168 3498 A
(suspended)378 3708 A
4128(on)S
4254(*/)S
2295 V
(21521)210 1122 A
(char)168 1524 A
(fp_sesldr;)420 1734 A
2784(/*)S
(true)168 2910 A
3120(if)S
(proc)168 3246 A
3456(is)S
3582(a)S
(session)294 3666 A
(leader)252 4002 A
4296(*/)S
2385 V
(21522)210 1122 A
(pid_t)210 1524 A
(fp_pid;)294 1776 A
2784(/*)S
(process)294 2910 A
3246(id)S
3372(*/)S
2475 V
(21523)210 1122 A
(long)168 1524 A
(fp_cloexec;)462 1734 A
2784(/*)S
(bit)126 2910 A
(map)126 3078 A
(for)126 3246 A
(POSIX)210 3414 A
(Table)210 3666 A
(6-2)126 3918 A
(FD_CLOEXEC)420 4086 A
4548(*/)S
2565 V
(21524)210 1122 A
1440(})S
(fproc[NR_PROCS];)672 1524 A
2655 V
(21525)210 1122 A
2745 V
(21526)210 1122 A
1440(/*)S
(Field)210 1566 A
(values.)294 1818 A
2154(*/)S
2835 V
(21527)210 1122 A
(#define)294 1440 A
(NOT_SUSPENDED)546 1776 A
2574(0)S
2784(/*)S
(process)294 2910 A
3246(is)S
(not)126 3372 A
(suspended)378 3540 A
3960(on)S
(pipe)168 4086 A
4296(or)S
(task)168 4422 A
4632(*/)S
2925 V
(21528)210 1122 A
(#define)294 1440 A
(SUSPENDED)378 1776 A
2574(1)S
2784(/*)S
(process)294 2910 A
3246(is)S
(suspended)378 3372 A
3792(on)S
(pipe)168 3918 A
4128(or)S
(task)168 4254 A
4464(*/)S
3015 V
(21529)210 1122 A
(#define)294 1440 A
(NOT_REVIVING)504 1776 A
2574(0)S
2784(/*)S
(process)294 2910 A
3246(is)S
(not)126 3372 A
(being)210 3540 A
(revived)294 3792 A
4128(*/)S
3105 V
(21530)210 1122 A
(#define)294 1440 A
(REVIVING)336 1776 A
2574(1)S
2784(/*)S
(process)294 2910 A
3246(is)S
(being)210 3372 A
(revived)294 3624 A
(from)168 3960 A
(suspension)420 4170 A
4632(*/)S
3195 V
(21531)210 1122 A
(#define)294 1440 A
(PID_FREE)336 1776 A
2574(0)S
2784(/*)S
(process)294 2910 A
(slot)168 3246 A
(free)168 3456 A
3666(*/)S
3285 V
(21532)210 1122 A
3375 V
(21533)210 1122 A
1440(/*)S
(Check)210 1566 A
1818(is)S
(process)294 1944 A
(number)252 2280 A
2574(is)S
(acceptable)420 2700 A
3162(-)S
(includes)336 3246 A
(system)252 3624 A
(processes.)420 3918 A
4380(*/)S
3465 V
(21534)210 1122 A
(#define)294 1440 A
(isokprocnr\(n\))546 1776 A
(\(\(unsigned\)\(\(n\)+NR_TASKS\))1050 2448 A
3540(<)S
(NR_PROCS)336 3624 A
4002(+)S
(NR_TASKS\))378 4086 A
3555 V
(21535)210 1122 A
4095 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4185 V
(servers/fs/buf.h)672 2676 A
4275 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4455 V
(21600)210 1122 A
1440(/*)S
(Buffer)252 1566 A
(\(block\))294 1860 A
(cache.)252 2196 A
2532(To)S
(acquire)294 2658 A
2994(a)S
(block,)252 3078 A
3372(a)S
(routine)294 3456 A
(calls)210 3792 A
(get_block\(\),)504 4044 A
4545 V
(21601)210 1122 A
1482(*)S
(telling)294 1566 A
(which)210 1902 A
(block)210 2154 A
2406(it)S
(wants.)252 2532 A
(The)126 2868 A
(block)210 3036 A
3288(is)S
(then)168 3414 A
(regarded)336 3624 A
4002(as)S
("in)126 4128 A
(use")168 4296 A
4635 V
(21602)210 1122 A
1482(*)S
(and)126 1566 A
(has)126 1734 A
(its)126 1902 A
('b_count')378 2070 A
(field)210 2490 A
(incremented.)504 2742 A
(All)126 3330 A
(the)126 3498 A
(blocks)252 3666 A
(that)168 3960 A
(are)126 4170 A
(not)126 4338 A
4725 V
(21603)210 1122 A
1482(*)S
1566(in)S
(use)126 1692 A
(are)126 1860 A
(chained)294 2028 A
(together)336 2364 A
2742(in)S
2868(an)S
(LRU)126 2994 A
(list,)210 3162 A
(with)168 3414 A
('front')294 3624 A
(pointing)336 3960 A
4815 V
(21604)210 1122 A
1482(*)S
1566(to)S
(the)126 1692 A
(least)210 1860 A
(recently)336 2112 A
(used)168 2490 A
(block,)252 2700 A
(and)126 2994 A
('rear')252 3162 A
3456(to)S
(the)126 3582 A
(most)168 3750 A
(recently)336 3960 A
(used)168 4338 A
4905 V
(21605)210 1122 A
1482(*)S
(block.)252 1566 A
1902(A)S
(reverse)294 1986 A
(chain,)252 2322 A
(using)210 2616 A
(the)126 2868 A
(field)210 3036 A
(b_prev)252 3288 A
3582(is)S
(also)168 3708 A
(maintained.)462 3918 A
4995 V
(21606)210 1122 A
1482(*)S
(Usage)210 1566 A
(for)126 1818 A
(LRU)126 1986 A
2154(is)S
(measured)336 2280 A
2658(by)S
(the)126 2784 A
(time)168 2952 A
(the)126 3162 A
(put_block\(\))462 3330 A
3834(is)S
(done.)210 3960 A
(The)126 4254 A
(second)252 4422 A
5085 V
(21607)210 1122 A
1482(*)S
(parameter)378 1566 A
1986(to)S
(put_block\(\))462 2112 A
(can)126 2616 A
(violate)294 2784 A
(the)126 3120 A
(LRU)126 3288 A
(order)210 3456 A
(and)126 3708 A
(put)126 3876 A
4044(a)S
(block)210 4128 A
4380(on)S
(the)126 4506 A
5175 V
(21608)210 1122 A
1482(*)S
(front)210 1566 A
1818(of)S
(the)126 1944 A
(list,)210 2112 A
2364(if)S
2490(it)S
(will)168 2616 A
(probably)336 2826 A
(not)126 3204 A
3372(be)S
(needed)252 3498 A
(soon.)210 3792 A
4086(If)S
4212(a)S
(block)210 4296 A
5265 V
(21609)210 1122 A
1482(*)S
1566(is)S
(modified,)378 1692 A
(the)126 2112 A
(modifying)378 2280 A
(routine)294 2700 A
(must)168 3036 A
(set)126 3246 A
(b_dirt)252 3414 A
3708(to)S
(DIRTY,)252 3834 A
4128(so)S
(the)126 4254 A
(block)210 4422 A
5355 V
(21610)210 1122 A
1482(*)S
(will)168 1566 A
(eventually)420 1776 A
2238(be)S
(rewritten)378 2364 A
2784(to)S
(the)126 2910 A
(disk.)210 3078 A
5445 V
(21611)210 1122 A
1482(*/)S
5535 V
(21612)210 1122 A
5625 V
(21613)210 1122 A
(#include)336 1440 A
(<sys/dir.h>)462 1818 A
3120(/*)S
(need)168 3246 A
(struct)252 3456 A
(direct)252 3750 A
4044(*/)S
5715 V
(21614)210 1122 A
(#include)336 1440 A
(<dirent.h>)420 1818 A
5805 V
(21615)210 1122 A
5895 V
(21616)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(buf)126 2028 A
2196({)S
5985 V
(21617)210 1122 A
1524(/*)S
(Data)168 1650 A
(portion)294 1860 A
2196(of)S
(the)126 2322 A
(buffer.)294 2490 A
2826(*/)S
6075 V
(21618)210 1122 A
(union)210 1524 A
1776({)S
6165 V
(21619)210 1122 A
(char)168 1608 A
(b__data[MAX_BLOCK_SIZE];)1008 1818 A
3666(/*)S
(ordinary)336 3792 A
(user)168 4170 A
(data)168 4380 A
4590(*/)S
6255 V
(21620)210 1122 A
1440(/*)S
(directory)378 1566 A
(block)210 1986 A
2238(*/)S
6345 V
(21621)210 1122 A
(struct)252 1608 A
(direct)252 1902 A
(b__dir[NR_DIR_ENTRIES\(MAX_BLOCK_SIZE\)];)1638 2196 A
6435 V
(21622)210 1122 A
1440(/*)S
1566(V1)S
(indirect)336 1692 A
(block)210 2070 A
2322(*/)S
6525 V
(21623)210 1122 A
(zone1_t)294 1608 A
(b__v1_ind[V1_INDIRECTS];)1008 1944 A
6615 V
(21624)210 1122 A
1440(/*)S
1566(V2)S
(indirect)336 1692 A
(block)210 2070 A
2322(*/)S
6705 V
(21625)210 1122 A
(zone_t)252 1608 A
(b__v2_ind[V2_INDIRECTS\(MAX_BLOCK_SIZE\)];)1680 1944 A
6795 V
(21626)210 1122 A
1440(/*)S
1566(V1)S
(inode)210 1692 A
(block)210 1944 A
2196(*/)S
6885 V
(21627)210 1122 A
(d1_inode)336 1608 A
(b__v1_ino[V1_INODES_PER_BLOCK];)1302 1986 A
6975 V
(21628)210 1122 A
1440(/*)S
1566(V2)S
(inode)210 1692 A
(block)210 1944 A
2196(*/)S
7065 V
(21629)210 1122 A
(d2_inode)336 1608 A
(b__v2_ino[V2_INODES_PER_BLOCK\(MAX_BLOCK_SIZE\)];)1974 1986 A
8418 V
EP
%%Page: 289 289
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2420(File:)S
2653(servers/fs/buf.h)S
12 B
(289)180 4500 A
1755 V
7 LST
(21630)210 1122 A
1440(/*)S
(bit)126 1566 A
(map)126 1734 A
(block)210 1902 A
2154(*/)S
1845 V
(21631)210 1122 A
(bitchunk_t)420 1608 A
(b__bitmap[FS_BITMAP_CHUNKS\(MAX_BLOCK_SIZE\)];)1848 2070 A
1935 V
(21632)210 1122 A
1524(})S
1608(b;)S
2025 V
(21633)210 1122 A
2115 V
(21634)210 1122 A
1524(/*)S
(Header)252 1650 A
(portion)294 1944 A
2280(of)S
(the)126 2406 A
(buffer.)294 2574 A
2910(*/)S
2205 V
(21635)210 1122 A
(struct)252 1524 A
(buf)126 1818 A
(*b_next;)336 1986 A
2784(/*)S
(used)168 2910 A
3120(to)S
(link)168 3246 A
(all)126 3456 A
(free)168 3624 A
(bufs)168 3834 A
4044(in)S
4170(a)S
(chain)210 4254 A
4506(*/)S
2295 V
(21636)210 1122 A
(struct)252 1524 A
(buf)126 1818 A
(*b_prev;)336 1986 A
2784(/*)S
(used)168 2910 A
3120(to)S
(link)168 3246 A
(all)126 3456 A
(free)168 3624 A
(bufs)168 3834 A
(the)126 4044 A
(other)210 4212 A
(way)126 4464 A
4632(*/)S
2385 V
(21637)210 1122 A
(struct)252 1524 A
(buf)126 1818 A
(*b_hash;)336 1986 A
2784(/*)S
(used)168 2910 A
3120(to)S
(link)168 3246 A
(bufs)168 3456 A
3666(on)S
(hash)168 3792 A
(chains)252 4002 A
4296(*/)S
2475 V
(21638)210 1122 A
(block_t)294 1524 A
(b_blocknr;)420 1860 A
2784(/*)S
(block)210 2910 A
(number)252 3162 A
3456(of)S
(its)126 3582 A
(\(minor\))294 3750 A
(device)252 4086 A
4380(*/)S
2565 V
(21639)210 1122 A
(dev_t)210 1524 A
(b_dev;)252 1776 A
2784(/*)S
(major)210 2910 A
3162(|)S
(minor)210 3246 A
(device)252 3498 A
(where)210 3792 A
(block)210 4044 A
(resides)294 4296 A
4632(*/)S
2655 V
(21640)210 1122 A
(char)168 1524 A
(b_dirt;)294 1734 A
2784(/*)S
(CLEAN)210 2910 A
3162(or)S
(DIRTY)210 3288 A
3540(*/)S
2745 V
(21641)210 1122 A
(char)168 1524 A
(b_count;)336 1734 A
2784(/*)S
(number)252 2910 A
3204(of)S
(users)210 3330 A
3582(of)S
(this)168 3708 A
(buffer)252 3918 A
4212(*/)S
2835 V
(21642)210 1122 A
1440(})S
(buf[NR_BUFS];)546 1524 A
2925 V
(21643)210 1122 A
3015 V
(21644)210 1122 A
1440(/*)S
1566(A)S
(block)210 1650 A
1902(is)S
(free)168 2028 A
2238(if)S
(b_dev)210 2364 A
2616(==)S
(NO_DEV.)294 2742 A
3078(*/)S
3105 V
(21645)210 1122 A
3195 V
(21646)210 1122 A
(#define)294 1440 A
(NIL_BUF)294 1776 A
(\(\(struct)336 2112 A
(buf)126 2490 A
2658(*\))S
2784(0\))S
3120(/*)S
(indicates)378 3246 A
(absence)294 3666 A
4002(of)S
4128(a)S
(buffer)252 4212 A
4506(*/)S
3285 V
(21647)210 1122 A
3375 V
(21648)210 1122 A
1440(/*)S
(These)210 1566 A
(defs)168 1818 A
(make)168 2028 A
2238(it)S
(possible)336 2364 A
2742(to)S
(use)126 2868 A
3036(to)S
(bp->b_data)420 3162 A
(instead)294 3624 A
3960(of)S
(bp->b.b__data)546 4086 A
4674(*/)S
3465 V
(21649)210 1122 A
(#define)294 1440 A
(b_data)252 1776 A
(b.b__data)378 2154 A
3555 V
(21650)210 1122 A
(#define)294 1440 A
(b_dir)210 1776 A
(b.b__dir)336 2154 A
3645 V
(21651)210 1122 A
(#define)294 1440 A
(b_v1_ind)336 1776 A
(b.b__v1_ind)462 2154 A
3735 V
(21652)210 1122 A
(#define)294 1440 A
(b_v2_ind)336 1776 A
(b.b__v2_ind)462 2154 A
3825 V
(21653)210 1122 A
(#define)294 1440 A
(b_v1_ino)336 1776 A
(b.b__v1_ino)462 2154 A
3915 V
(21654)210 1122 A
(#define)294 1440 A
(b_v2_ino)336 1776 A
(b.b__v2_ino)462 2154 A
4005 V
(21655)210 1122 A
(#define)294 1440 A
(b_bitmap)336 1776 A
(b.b__bitmap)462 2154 A
4095 V
(21656)210 1122 A
4185 V
(21657)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(buf)126 2028 A
(*buf_hash[NR_BUF_HASH];)966 2196 A
3456(/*)S
(the)126 3582 A
(buffer)252 3750 A
(hash)168 4044 A
(table)210 4254 A
4506(*/)S
4275 V
(21658)210 1122 A
4365 V
(21659)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(buf)126 2028 A
(*front;)294 2196 A
2784(/*)S
(points)252 2910 A
3204(to)S
(least)210 3330 A
(recently)336 3582 A
(used)168 3960 A
(free)168 4170 A
(block)210 4380 A
4632(*/)S
4455 V
(21660)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(buf)126 2028 A
(*rear;)252 2196 A
2784(/*)S
(points)252 2910 A
3204(to)S
(most)168 3330 A
(recently)336 3540 A
(used)168 3918 A
(free)168 4128 A
(block)210 4338 A
4590(*/)S
4545 V
(21661)210 1122 A
(EXTERN)252 1440 A
(int)126 1734 A
(bufs_in_use;)504 1902 A
2784(/*)S
2910(#)S
(bufs)168 2994 A
(currently)378 3204 A
3624(in)S
(use)126 3750 A
(\(not)168 3918 A
4128(on)S
(free)168 4254 A
(list\)*/)294 4464 A
4635 V
(21662)210 1122 A
4725 V
(21663)210 1122 A
1440(/*)S
(When)168 1566 A
1776(a)S
(block)210 1860 A
2112(is)S
(released,)378 2238 A
(the)126 2658 A
(type)168 2826 A
3036(of)S
(usage)210 3162 A
3414(is)S
(passed)252 3540 A
3834(to)S
(put_block\(\).)504 3960 A
4506(*/)S
4815 V
(21664)210 1122 A
(#define)294 1440 A
(WRITE_IMMED)462 1776 A
(0100)168 2364 A
2574(/*)S
(block)210 2700 A
(should)252 2952 A
3246(be)S
(written)294 3372 A
3708(to)S
(disk)168 3834 A
(now)126 4044 A
4212(*/)S
4905 V
(21665)210 1122 A
(#define)294 1440 A
(ONE_SHOT)336 1776 A
(0200)168 2364 A
2574(/*)S
(set)126 2700 A
2868(if)S
(block)210 2994 A
(not)126 3246 A
(likely)252 3414 A
3708(to)S
3834(be)S
(needed)252 3960 A
(soon)168 4254 A
4464(*/)S
4995 V
(21666)210 1122 A
5085 V
(21667)210 1122 A
(#define)294 1440 A
(INODE_BLOCK)462 1776 A
2574(0)S
3834(/*)S
(inode)210 3960 A
(block)210 4212 A
4464(*/)S
5175 V
(21668)210 1122 A
(#define)294 1440 A
(DIRECTORY_BLOCK)630 1776 A
2574(1)S
3834(/*)S
(directory)378 3960 A
(block)210 4380 A
4632(*/)S
5265 V
(21669)210 1122 A
(#define)294 1440 A
(INDIRECT_BLOCK)588 1776 A
2574(2)S
3834(/*)S
(pointer)294 3960 A
(block)210 4296 A
4548(*/)S
5355 V
(21670)210 1122 A
(#define)294 1440 A
(MAP_BLOCK)378 1776 A
2574(3)S
3834(/*)S
(bit)126 3960 A
(map)126 4128 A
4296(*/)S
5445 V
(21671)210 1122 A
(#define)294 1440 A
(FULL_DATA_BLOCK)630 1776 A
2574(5)S
3834(/*)S
(data,)210 3960 A
(fully)210 4212 A
(used)168 4464 A
4674(*/)S
5535 V
(21672)210 1122 A
(#define)294 1440 A
(PARTIAL_DATA_BLOCK)756 1776 A
2574(6)S
3834(/*)S
(data,)210 3960 A
(partly)252 4212 A
(used*/)252 4506 A
5625 V
(21673)210 1122 A
5715 V
(21674)210 1122 A
(#define)294 1440 A
(HASH_MASK)378 1776 A
(\(NR_BUF_HASH)504 2196 A
2742(-)S
2826(1\))S
3120(/*)S
(mask)168 3246 A
(for)126 3456 A
(hashing)294 3624 A
(block)210 3960 A
(numbers)294 4212 A
4548(*/)S
5895 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5985 V
(servers/fs/file.h)714 2676 A
6075 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6255 V
(21700)210 1122 A
1440(/*)S
(This)168 1566 A
1776(is)S
(the)126 1902 A
(filp)168 2070 A
(table.)252 2280 A
2616(It)S
2742(is)S
2868(an)S
(intermediary)504 2994 A
(between)294 3540 A
(file)168 3876 A
(descriptors)462 4086 A
(and)126 4590 A
6345 V
(21701)210 1122 A
1482(*)S
(inodes.)294 1566 A
1944(A)S
(slot)168 2028 A
2238(is)S
(free)168 2364 A
2574(if)S
(filp_count)420 2700 A
3162(==)S
3288(0.)S
6435 V
(21702)210 1122 A
1482(*/)S
6525 V
(21703)210 1122 A
6615 V
(21704)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(filp)168 2028 A
2238({)S
6705 V
(21705)210 1122 A
(mode_t)252 1524 A
(filp_mode;)420 1818 A
2784(/*)S
2910(RW)S
(bits,)210 3036 A
(telling)294 3288 A
(how)126 3624 A
(file)168 3792 A
4002(is)S
(opened)252 4128 A
4422(*/)S
6795 V
(21706)210 1122 A
(int)126 1524 A
(filp_flags;)462 1692 A
2784(/*)S
(flags)210 2910 A
(from)168 3162 A
(open)168 3372 A
(and)126 3582 A
(fcntl)210 3750 A
4002(*/)S
6885 V
(21707)210 1122 A
(int)126 1524 A
(filp_count;)462 1692 A
2784(/*)S
(how)126 2910 A
(many)168 3078 A
(file)168 3288 A
(descriptors)462 3498 A
(share)210 4002 A
(this)168 4254 A
(slot?*/)294 4464 A
6975 V
(21708)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*filp_ino;)420 2070 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(the)126 3372 A
(inode)210 3540 A
3792(*/)S
7065 V
(21709)210 1122 A
(off_t)210 1524 A
(filp_pos;)378 1776 A
2784(/*)S
(file)168 2910 A
(position)336 3120 A
3498(*/)S
8418 V
EP
%%Page: 290 290
BP
/slant 0 def
/height 0 def
1485 V
12 B
(290)180 1080 A
11 R
2419(File:)S
2652(servers/fs/file.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(21710)210 1122 A
1845 V
(21711)210 1122 A
1524(/*)S
(the)126 1650 A
(following)378 1818 A
(fields)252 2238 A
(are)126 2532 A
(for)126 2700 A
(select\(\))336 2868 A
(and)126 3246 A
(are)126 3414 A
(owned)210 3582 A
3834(by)S
(the)126 3960 A
(generic)294 4128 A
1935 V
(21712)210 1122 A
1566(*)S
(select\(\))336 1650 A
(code)168 2028 A
(\(i.e.,)252 2238 A
(fd-type-specific)672 2532 A
(select\(\))336 3246 A
(code)168 3624 A
(can't)210 3834 A
(touch)210 4086 A
(these\).)294 4338 A
2025 V
(21713)210 1122 A
1566(*/)S
2115 V
(21714)210 1122 A
(int)126 1524 A
(filp_selectors;)630 1692 A
2784(/*)S
(select\(\)ing)462 2910 A
(processes)378 3414 A
(blocking)336 3834 A
4212(on)S
(this)168 4338 A
4548(fd)S
4674(*/)S
2205 V
(21715)210 1122 A
(int)126 1524 A
(filp_select_ops;)672 1692 A
2784(/*)S
(interested)420 2910 A
3372(in)S
(these)210 3498 A
(SEL_*)210 3750 A
(operations)420 4002 A
4464(*/)S
2295 V
(21716)210 1122 A
2385 V
(21717)210 1122 A
1524(/*)S
(following)378 1650 A
(are)126 2070 A
(for)126 2238 A
(fd-type-specific)672 2406 A
(select\(\))336 3120 A
3498(*/)S
2475 V
(21718)210 1122 A
(int)126 1524 A
(filp_pipe_select_ops;)882 1692 A
2565 V
(21719)210 1122 A
1440(})S
(filp[NR_FILPS];)630 1524 A
2655 V
(21720)210 1122 A
2745 V
(21721)210 1122 A
(#define)294 1440 A
(FILP_CLOSED)462 1776 A
2448(0)S
2784(/*)S
(filp_mode:)420 2910 A
(associated)420 3372 A
(device)252 3834 A
(closed)252 4128 A
4422(*/)S
2835 V
(21722)210 1122 A
2925 V
(21723)210 1122 A
(#define)294 1440 A
(NIL_FILP)336 1776 A
(\(struct)294 2154 A
(filp)168 2490 A
2700(*\))S
2826(0)S
3120(/*)S
(indicates)378 3246 A
(absence)294 3666 A
4002(of)S
4128(a)S
(filp)168 4212 A
(slot)168 4422 A
4632(*/)S
3195 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3285 V
(servers/fs/lock.h)714 2676 A
3375 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3555 V
(21800)210 1122 A
1440(/*)S
(This)168 1566 A
1776(is)S
(the)126 1902 A
(file)168 2070 A
(locking)294 2280 A
(table.)252 2616 A
(Like)168 2952 A
(the)126 3162 A
(filp)168 3330 A
(table,)252 3540 A
3834(it)S
(points)252 3960 A
4254(to)S
(the)126 4380 A
3645 V
(21801)210 1122 A
1482(*)S
(inode)210 1566 A
(table,)252 1818 A
(however,)336 2112 A
2490(in)S
(this)168 2616 A
(case)168 2826 A
3036(to)S
(achieve)294 3162 A
(advisory)336 3498 A
(locking.)336 3876 A
3735 V
(21802)210 1122 A
1482(*/)S
3825 V
(21803)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(file_lock)378 2028 A
2448({)S
3915 V
(21804)210 1122 A
(short)210 1524 A
(lock_type;)420 1776 A
2784(/*)S
(F_RDLOCK)336 2910 A
3288(or)S
(F_WRLOCK;)378 3414 A
3834(0)S
(means)210 3918 A
(unused)252 4170 A
(slot)168 4464 A
4674(*/)S
4005 V
(21805)210 1122 A
(pid_t)210 1524 A
(lock_pid;)378 1776 A
2784(/*)S
(pid)126 2910 A
3078(of)S
(the)126 3204 A
(process)294 3372 A
(holding)294 3708 A
(the)126 4044 A
(lock)168 4212 A
4422(*/)S
4095 V
(21806)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*lock_inode;)504 2070 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(the)126 3372 A
(inode)210 3540 A
(locked)252 3792 A
4086(*/)S
4185 V
(21807)210 1122 A
(off_t)210 1524 A
(lock_first;)462 1776 A
2784(/*)S
(offset)252 2910 A
3204(of)S
(first)210 3330 A
(byte)168 3582 A
(locked)252 3792 A
4086(*/)S
4275 V
(21808)210 1122 A
(off_t)210 1524 A
(lock_last;)420 1776 A
2784(/*)S
(offset)252 2910 A
3204(of)S
(last)168 3330 A
(byte)168 3540 A
(locked)252 3750 A
4044(*/)S
4365 V
(21809)210 1122 A
1440(})S
(file_lock[NR_LOCKS];)840 1524 A
4545 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4635 V
(servers/fs/inode.h)756 2676 A
4725 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4905 V
(21900)210 1122 A
1440(/*)S
(Inode)210 1566 A
(table.)252 1818 A
(This)168 2154 A
(table)210 2364 A
(holds)210 2616 A
(inodes)252 2868 A
(that)168 3162 A
(are)126 3372 A
(currently)378 3540 A
3960(in)S
(use.)168 4086 A
4338(In)S
(some)168 4464 A
4995 V
(21901)210 1122 A
1482(*)S
(cases)210 1566 A
(they)168 1818 A
(have)168 2028 A
(been)168 2238 A
(opened)252 2448 A
2742(by)S
2868(an)S
(open\(\))252 2994 A
3288(or)S
(creat\(\))294 3414 A
(system)252 3750 A
(call,)210 4044 A
4296(in)S
(other)210 4422 A
5085 V
(21902)210 1122 A
1482(*)S
(cases)210 1566 A
(the)126 1818 A
(file)168 1986 A
(system)252 2196 A
(itself)252 2490 A
(needs)210 2784 A
(the)126 3036 A
(inode)210 3204 A
(for)126 3456 A
(one)126 3624 A
(reason)252 3792 A
4086(or)S
(another,)336 4212 A
5175 V
(21903)210 1122 A
1482(*)S
(such)168 1566 A
1776(as)S
1902(to)S
(search)252 2028 A
2322(a)S
(directory)378 2406 A
(for)126 2826 A
2994(a)S
(path)168 3078 A
(name.)210 3288 A
5265 V
(21904)210 1122 A
1482(*)S
(The)126 1566 A
(first)210 1734 A
(part)168 1986 A
2196(of)S
(the)126 2322 A
(struct)252 2490 A
(holds)210 2784 A
(fields)252 3036 A
(that)168 3330 A
(are)126 3540 A
(present)294 3708 A
4044(on)S
(the)126 4170 A
5355 V
(21905)210 1122 A
1482(*)S
(disk;)210 1566 A
(the)126 1818 A
(second)252 1986 A
(part)168 2280 A
(holds)210 2490 A
(fields)252 2742 A
(not)126 3036 A
(present)294 3204 A
3540(on)S
(the)126 3666 A
(disk.)210 3834 A
5445 V
(21906)210 1122 A
1482(*)S
(The)126 1566 A
(disk)168 1734 A
(inode)210 1944 A
(part)168 2196 A
2406(is)S
(also)168 2532 A
(declared)336 2742 A
3120(in)S
("type.h")336 3246 A
3624(as)S
('d1_inode')420 3750 A
(for)126 4212 A
4380(V1)S
5535 V
(21907)210 1122 A
1482(*)S
(file)168 1566 A
(systems)294 1776 A
(and)126 2112 A
('d2_inode')420 2280 A
(for)126 2742 A
2910(V2)S
(file)168 3036 A
(systems.)336 3246 A
5625 V
(21908)210 1122 A
1482(*/)S
5715 V
(21909)210 1122 A
5805 V
(21910)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(inode)210 2028 A
2280({)S
5895 V
(21911)210 1122 A
(mode_t)252 1524 A
(i_mode;)294 1818 A
2784(/*)S
(file)168 2910 A
(type,)210 3120 A
(protection,)462 3372 A
(etc.)168 3876 A
4086(*/)S
5985 V
(21912)210 1122 A
(nlink_t)294 1524 A
(i_nlinks;)378 1860 A
2784(/*)S
(how)126 2910 A
(many)168 3078 A
(links)210 3288 A
3540(to)S
(this)168 3666 A
(file)168 3876 A
4086(*/)S
6075 V
(21913)210 1122 A
(uid_t)210 1524 A
(i_uid;)252 1776 A
2784(/*)S
(user)168 2910 A
3120(id)S
3246(of)S
(the)126 3372 A
(file's)252 3540 A
(owner)210 3834 A
4086(*/)S
6165 V
(21914)210 1122 A
(gid_t)210 1524 A
(i_gid;)252 1776 A
2784(/*)S
(group)210 2910 A
(number)252 3162 A
3456(*/)S
6255 V
(21915)210 1122 A
(off_t)210 1524 A
(i_size;)294 1776 A
2784(/*)S
(current)294 2910 A
(file)168 3246 A
(size)168 3456 A
3666(in)S
(bytes)210 3792 A
4044(*/)S
6345 V
(21916)210 1122 A
(time_t)252 1524 A
(i_atime;)336 1818 A
2784(/*)S
(time)168 2910 A
3120(of)S
(last)168 3246 A
(access)252 3456 A
(\(V2)126 3750 A
(only\))210 3918 A
4170(*/)S
6435 V
(21917)210 1122 A
(time_t)252 1524 A
(i_mtime;)336 1818 A
2784(/*)S
(when)168 2910 A
(was)126 3120 A
(file)168 3288 A
(data)168 3498 A
(last)168 3708 A
(changed)294 3918 A
4254(*/)S
6525 V
(21918)210 1122 A
(time_t)252 1524 A
(i_ctime;)336 1818 A
2784(/*)S
(when)168 2910 A
(was)126 3120 A
(inode)210 3288 A
(itself)252 3540 A
(changed)294 3834 A
(\(V2)126 4170 A
(only\)*/)294 4338 A
6615 V
(21919)210 1122 A
(zone_t)252 1524 A
(i_zone[V2_NR_TZONES];)882 1818 A
2742(/*)S
(zone)168 2868 A
(numbers)294 3078 A
(for)126 3414 A
(direct,)294 3582 A
(ind,)168 3918 A
(and)126 4128 A
(dbl)126 4296 A
(ind)126 4464 A
4632(*/)S
6705 V
(21920)210 1122 A
6795 V
(21921)210 1122 A
1524(/*)S
(The)126 1650 A
(following)378 1818 A
(items)210 2238 A
(are)126 2490 A
(not)126 2658 A
(present)294 2826 A
3162(on)S
(the)126 3288 A
(disk.)210 3456 A
3708(*/)S
6885 V
(21922)210 1122 A
(dev_t)210 1524 A
(i_dev;)252 1776 A
2784(/*)S
(which)210 2910 A
(device)252 3162 A
3456(is)S
(the)126 3582 A
(inode)210 3750 A
4002(on)S
4128(*/)S
6975 V
(21923)210 1122 A
(ino_t)210 1524 A
(i_num;)252 1776 A
2784(/*)S
(inode)210 2910 A
(number)252 3162 A
3456(on)S
(its)126 3582 A
(\(minor\))294 3750 A
(device)252 4086 A
4380(*/)S
7065 V
(21924)210 1122 A
(int)126 1524 A
(i_count;)336 1692 A
2784(/*)S
2910(#)S
(times)210 2994 A
(inode)210 3246 A
(used;)210 3498 A
3750(0)S
(means)210 3834 A
(slot)168 4086 A
4296(is)S
(free)168 4422 A
4632(*/)S
8418 V
EP
%%Page: 291 291
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2370(File:)S
(servers/fs/inode.h)786 2603 A
12 B
(291)180 4500 A
1755 V
7 LST
(21925)210 1122 A
(int)126 1524 A
(i_ndzones;)420 1692 A
2784(/*)S
2910(#)S
(direct)252 2994 A
(zones)210 3288 A
(\(Vx_NR_DZONES\))588 3540 A
4170(*/)S
1845 V
(21926)210 1122 A
(int)126 1524 A
(i_nindirs;)420 1692 A
2784(/*)S
2910(#)S
(indirect)336 2994 A
(zones)210 3372 A
(per)126 3624 A
(indirect)336 3792 A
(block)210 4170 A
4422(*/)S
1935 V
(21927)210 1122 A
(struct)252 1524 A
(super_block)462 1818 A
(*i_sp;)252 2322 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(super)210 3372 A
(block)210 3624 A
(for)126 3876 A
(inode's)294 4044 A
(device)252 4380 A
4674(*/)S
2025 V
(21928)210 1122 A
(char)168 1524 A
(i_dirt;)294 1734 A
2784(/*)S
(CLEAN)210 2910 A
3162(or)S
(DIRTY)210 3288 A
3540(*/)S
2115 V
(21929)210 1122 A
(char)168 1524 A
(i_pipe;)294 1734 A
2784(/*)S
(set)126 2910 A
3078(to)S
(I_PIPE)252 3204 A
3498(if)S
(pipe)168 3624 A
3834(*/)S
2205 V
(21930)210 1122 A
(char)168 1524 A
(i_mount;)336 1734 A
2784(/*)S
(this)168 2910 A
(bit)126 3120 A
3288(is)S
(set)126 3414 A
3582(if)S
(file)168 3708 A
(mounted)294 3918 A
4254(on)S
4380(*/)S
2295 V
(21931)210 1122 A
(char)168 1524 A
(i_seek;)294 1734 A
2784(/*)S
(set)126 2910 A
3078(on)S
(LSEEK,)252 3204 A
(cleared)294 3498 A
3834(on)S
(READ/WRITE)420 3960 A
4422(*/)S
2385 V
(21932)210 1122 A
(char)168 1524 A
(i_update;)378 1734 A
2784(/*)S
(the)126 2910 A
(ATIME,)252 3078 A
(CTIME,)252 3372 A
(and)126 3666 A
(MTIME)210 3834 A
(bits)168 4086 A
(are)126 4296 A
(here)168 4464 A
4674(*/)S
2475 V
(21933)210 1122 A
1440(})S
(inode[NR_INODES];)714 1524 A
2565 V
(21934)210 1122 A
2655 V
(21935)210 1122 A
(#define)294 1440 A
(NIL_INODE)378 1776 A
(\(struct)294 2196 A
(inode)210 2532 A
2784(*\))S
2910(0)S
3120(/*)S
(indicates)378 3246 A
(absence)294 3666 A
4002(of)S
(inode)210 4128 A
(slot)168 4380 A
4590(*/)S
2745 V
(21936)210 1122 A
2835 V
(21937)210 1122 A
1440(/*)S
(Field)210 1566 A
(values.)294 1818 A
(Note)168 2196 A
(that)168 2406 A
(CLEAN)210 2616 A
(and)126 2868 A
(DIRTY)210 3036 A
(are)126 3288 A
(defined)294 3456 A
3792(in)S
("const.h")378 3918 A
4338(*/)S
2925 V
(21938)210 1122 A
(#define)294 1440 A
(NO_PIPE)294 1776 A
2574(0)S
2784(/*)S
(i_pipe)252 2910 A
3204(is)S
(NO_PIPE)294 3330 A
3666(if)S
(inode)210 3792 A
4044(is)S
(not)126 4170 A
4338(a)S
(pipe)168 4422 A
4632(*/)S
3015 V
(21939)210 1122 A
(#define)294 1440 A
(I_PIPE)252 1776 A
2574(1)S
2784(/*)S
(i_pipe)252 2910 A
3204(is)S
(I_PIPE)252 3330 A
3624(if)S
(inode)210 3750 A
4002(is)S
4128(a)S
(pipe)168 4212 A
4422(*/)S
3105 V
(21940)210 1122 A
(#define)294 1440 A
(NO_MOUNT)336 1776 A
2574(0)S
2784(/*)S
(i_mount)294 2910 A
3246(is)S
(NO_MOUNT)336 3372 A
3750(if)S
(file)168 3876 A
(not)126 4086 A
(mounted)294 4254 A
(on*/)168 4590 A
3195 V
(21941)210 1122 A
(#define)294 1440 A
(I_MOUNT)294 1776 A
2574(1)S
2784(/*)S
(i_mount)294 2910 A
3246(is)S
(I_MOUNT)294 3372 A
3708(if)S
(file)168 3834 A
(mounted)294 4044 A
4380(on)S
4506(*/)S
3285 V
(21942)210 1122 A
(#define)294 1440 A
(NO_SEEK)294 1776 A
2574(0)S
2784(/*)S
(i_seek)252 2910 A
3204(=)S
(NO_SEEK)294 3288 A
3624(if)S
(last)168 3750 A
3960(op)S
(was)126 4086 A
(not)126 4254 A
(SEEK)168 4422 A
4632(*/)S
3375 V
(21943)210 1122 A
(#define)294 1440 A
(ISEEK)210 1776 A
2574(1)S
2784(/*)S
(i_seek)252 2910 A
3204(=)S
(ISEEK)210 3288 A
3540(if)S
(last)168 3666 A
3876(op)S
(was)126 4002 A
(SEEK)168 4170 A
4380(*/)S
3645 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3735 V
(servers/fs/param.h)756 2676 A
3825 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4005 V
(22000)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(names)210 2154 A
(are)126 2406 A
(synonyms)336 2574 A
(for)126 2952 A
(the)126 3120 A
(variables)378 3288 A
3708(in)S
(the)126 3834 A
(input)210 4002 A
(message.)336 4254 A
4632(*/)S
4095 V
(22001)210 1122 A
(#define)294 1440 A
(acc_time)336 1776 A
(m2_l1)210 2364 A
4185 V
(22002)210 1122 A
(#define)294 1440 A
(addr)168 1776 A
(m1_i3)210 2364 A
4275 V
(22003)210 1122 A
(#define)294 1440 A
(buffer)252 1776 A
(m1_p1)210 2364 A
4365 V
(22004)210 1122 A
(#define)294 1440 A
(child)210 1776 A
(m1_i2)210 2364 A
4455 V
(22005)210 1122 A
(#define)294 1440 A
(co_mode)294 1776 A
(m1_i1)210 2364 A
4545 V
(22006)210 1122 A
(#define)294 1440 A
(eff_grp_id)420 1776 A
(m1_i3)210 2364 A
4635 V
(22007)210 1122 A
(#define)294 1440 A
(eff_user_id)462 1776 A
(m1_i3)210 2364 A
4725 V
(22008)210 1122 A
(#define)294 1440 A
(erki)168 1776 A
(m1_p1)210 2364 A
4815 V
(22009)210 1122 A
(#define)294 1440 A
1776(fd)S
(m1_i1)210 2364 A
4905 V
(22010)210 1122 A
(#define)294 1440 A
(fd2)126 1776 A
(m1_i2)210 2364 A
4995 V
(22011)210 1122 A
(#define)294 1440 A
(ioflags)294 1776 A
(m1_i3)210 2364 A
5085 V
(22012)210 1122 A
(#define)294 1440 A
(group)210 1776 A
(m1_i3)210 2364 A
5175 V
(22013)210 1122 A
(#define)294 1440 A
(real_grp_id)462 1776 A
(m1_i2)210 2364 A
5265 V
(22014)210 1122 A
(#define)294 1440 A
(ls_fd)210 1776 A
(m2_i1)210 2364 A
5355 V
(22015)210 1122 A
(#define)294 1440 A
(mk_mode)294 1776 A
(m1_i2)210 2364 A
5445 V
(22016)210 1122 A
(#define)294 1440 A
(mk_z0)210 1776 A
(m1_i3)210 2364 A
5535 V
(22017)210 1122 A
(#define)294 1440 A
(mode)168 1776 A
(m3_i2)210 2364 A
5625 V
(22018)210 1122 A
(#define)294 1440 A
(c_mode)252 1776 A
(m1_i3)210 2364 A
5715 V
(22019)210 1122 A
(#define)294 1440 A
(c_name)252 1776 A
(m1_p1)210 2364 A
5805 V
(22020)210 1122 A
(#define)294 1440 A
(name)168 1776 A
(m3_p1)210 2364 A
5895 V
(22021)210 1122 A
(#define)294 1440 A
(name1)210 1776 A
(m1_p1)210 2364 A
5985 V
(22022)210 1122 A
(#define)294 1440 A
(name2)210 1776 A
(m1_p2)210 2364 A
6075 V
(22023)210 1122 A
(#define)294 1440 A
(name_length)462 1776 A
(m3_i1)210 2364 A
6165 V
(22024)210 1122 A
(#define)294 1440 A
(name1_length)504 1776 A
(m1_i1)210 2364 A
6255 V
(22025)210 1122 A
(#define)294 1440 A
(name2_length)504 1776 A
(m1_i2)210 2364 A
6345 V
(22026)210 1122 A
(#define)294 1440 A
(nbytes)252 1776 A
(m1_i2)210 2364 A
6435 V
(22027)210 1122 A
(#define)294 1440 A
(owner)210 1776 A
(m1_i2)210 2364 A
6525 V
(22028)210 1122 A
(#define)294 1440 A
(parent)252 1776 A
(m1_i1)210 2364 A
6615 V
(22029)210 1122 A
(#define)294 1440 A
(pathname)336 1776 A
(m3_ca1)252 2364 A
6705 V
(22030)210 1122 A
(#define)294 1440 A
(pid)126 1776 A
(m1_i3)210 2364 A
6795 V
(22031)210 1122 A
(#define)294 1440 A
(pro)126 1776 A
(m1_i1)210 2364 A
6885 V
(22032)210 1122 A
(#define)294 1440 A
(ctl_req)294 1776 A
(m4_l1)210 2364 A
6975 V
(22033)210 1122 A
(#define)294 1440 A
(driver_nr)378 1776 A
(m4_l2)210 2364 A
7065 V
(22034)210 1122 A
(#define)294 1440 A
(dev_nr)252 1776 A
(m4_l3)210 2364 A
8418 V
EP
%%Page: 292 292
BP
/slant 0 def
/height 0 def
1485 V
12 B
(292)180 1080 A
11 R
2354(File:)S
2587(servers/fs/param.h)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(22035)210 1122 A
(#define)294 1440 A
(dev_style)378 1776 A
(m4_l4)210 2364 A
1845 V
(22036)210 1122 A
(#define)294 1440 A
(rd_only)294 1776 A
(m1_i3)210 2364 A
1935 V
(22037)210 1122 A
(#define)294 1440 A
(real_user_id)504 1776 A
(m1_i2)210 2364 A
2025 V
(22038)210 1122 A
(#define)294 1440 A
(request)294 1776 A
(m1_i2)210 2364 A
2115 V
(22039)210 1122 A
(#define)294 1440 A
(sig)126 1776 A
(m1_i2)210 2364 A
2205 V
(22040)210 1122 A
(#define)294 1440 A
(slot1)210 1776 A
(m1_i1)210 2364 A
2295 V
(22041)210 1122 A
(#define)294 1440 A
1776(tp)S
(m2_l1)210 2364 A
2385 V
(22042)210 1122 A
(#define)294 1440 A
(utime_actime)504 1776 A
(m2_l1)210 2364 A
2475 V
(22043)210 1122 A
(#define)294 1440 A
(utime_modtime)546 1776 A
(m2_l2)210 2364 A
2565 V
(22044)210 1122 A
(#define)294 1440 A
(utime_file)420 1776 A
(m2_p1)210 2364 A
2655 V
(22045)210 1122 A
(#define)294 1440 A
(utime_length)504 1776 A
(m2_i1)210 2364 A
2745 V
(22046)210 1122 A
(#define)294 1440 A
(utime_strlen)504 1776 A
(m2_i2)210 2364 A
2835 V
(22047)210 1122 A
(#define)294 1440 A
(whence)252 1776 A
(m2_i2)210 2364 A
2925 V
(22048)210 1122 A
(#define)294 1440 A
(svrctl_req)420 1776 A
(m2_i1)210 2364 A
3015 V
(22049)210 1122 A
(#define)294 1440 A
(svrctl_argp)462 1776 A
(m2_p1)210 2364 A
3105 V
(22050)210 1122 A
(#define)294 1440 A
(pm_stime)336 1776 A
(m1_i1)210 2364 A
3195 V
(22051)210 1122 A
(#define)294 1440 A
(info_what)378 1776 A
(m1_i1)210 2364 A
3285 V
(22052)210 1122 A
(#define)294 1440 A
(info_where)420 1776 A
(m1_p1)210 2364 A
3375 V
(22053)210 1122 A
3465 V
(22054)210 1122 A
1440(/*)S
(The)126 1566 A
(following)378 1734 A
(names)210 2154 A
(are)126 2406 A
(synonyms)336 2574 A
(for)126 2952 A
(the)126 3120 A
(variables)378 3288 A
3708(in)S
(the)126 3834 A
(output)252 4002 A
(message.)336 4296 A
4674(*/)S
3555 V
(22055)210 1122 A
(#define)294 1440 A
(reply_type)420 1776 A
(m_type)252 2364 A
3645 V
(22056)210 1122 A
(#define)294 1440 A
(reply_l1)336 1776 A
(m2_l1)210 2364 A
3735 V
(22057)210 1122 A
(#define)294 1440 A
(reply_i1)336 1776 A
(m1_i1)210 2364 A
3825 V
(22058)210 1122 A
(#define)294 1440 A
(reply_i2)336 1776 A
(m1_i2)210 2364 A
3915 V
(22059)210 1122 A
(#define)294 1440 A
(reply_t1)336 1776 A
(m4_l1)210 2364 A
4005 V
(22060)210 1122 A
(#define)294 1440 A
(reply_t2)336 1776 A
(m4_l2)210 2364 A
4095 V
(22061)210 1122 A
(#define)294 1440 A
(reply_t3)336 1776 A
(m4_l3)210 2364 A
4185 V
(22062)210 1122 A
(#define)294 1440 A
(reply_t4)336 1776 A
(m4_l4)210 2364 A
4275 V
(22063)210 1122 A
(#define)294 1440 A
(reply_t5)336 1776 A
(m4_l5)210 2364 A
4545 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4635 V
(servers/fs/super.h)756 2676 A
4725 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4905 V
(22100)210 1122 A
1440(/*)S
(Super)210 1566 A
(block)210 1818 A
(table.)252 2070 A
(The)126 2406 A
(root)168 2574 A
(file)168 2784 A
(system)252 2994 A
(and)126 3288 A
(every)210 3456 A
(mounted)294 3708 A
(file)168 4044 A
(system)252 4254 A
4995 V
(22101)210 1122 A
1482(*)S
(has)126 1566 A
1734(an)S
(entry)210 1860 A
(here.)210 2112 A
(The)126 2406 A
(entry)210 2574 A
(holds)210 2826 A
(information)462 3078 A
(about)210 3582 A
(the)126 3834 A
(sizes)210 4002 A
4254(of)S
(the)126 4380 A
(bit)126 4548 A
5085 V
(22102)210 1122 A
1482(*)S
(maps)168 1566 A
(and)126 1776 A
(inodes.)294 1944 A
(The)126 2322 A
(s_ninodes)378 2490 A
(field)210 2910 A
(gives)210 3162 A
(the)126 3414 A
(number)252 3582 A
3876(of)S
(inodes)252 4002 A
(available)378 4296 A
5175 V
(22103)210 1122 A
1482(*)S
(for)126 1566 A
(files)210 1734 A
(and)126 1986 A
(directories,)504 2154 A
(including)378 2700 A
(the)126 3120 A
(root)168 3288 A
(directory.)420 3498 A
(Inode)210 4002 A
4254(0)S
4338(is)S
5265 V
(22104)210 1122 A
1482(*)S
1566(on)S
(the)126 1692 A
(disk,)210 1860 A
(but)126 2112 A
(not)126 2280 A
(used.)210 2448 A
(Thus)168 2742 A
(s_ninodes)378 2952 A
3372(=)S
3456(4)S
(means)210 3540 A
(that)168 3792 A
4002(5)S
(bits)168 4086 A
(will)168 4296 A
4506(be)S
5355 V
(22105)210 1122 A
1482(*)S
(used)168 1566 A
1776(in)S
(the)126 1902 A
(bit)126 2070 A
(map,)168 2238 A
(bit)126 2448 A
2616(0,)S
(which)210 2742 A
2994(is)S
(always)252 3120 A
3414(1)S
(and)126 3498 A
(not)126 3666 A
(used,)210 3834 A
(and)126 4086 A
(bits)168 4254 A
(1-4)126 4464 A
5445 V
(22106)210 1122 A
1482(*)S
(for)126 1566 A
(files)210 1734 A
(and)126 1986 A
(directories.)504 2154 A
(The)126 2742 A
(disk)168 2910 A
(layout)252 3120 A
(is:)126 3414 A
5535 V
(22107)210 1122 A
1482(*)S
5625 V
(22108)210 1122 A
1482(*)S
(Item)168 1692 A
2196(#)S
(blocks)252 2280 A
5715 V
(22109)210 1122 A
1482(*)S
(boot)168 1692 A
(block)210 1902 A
2364(1)S
5805 V
(22110)210 1122 A
1482(*)S
(super)210 1692 A
(block)210 1944 A
2364(1)S
(\(offset)294 2574 A
(1kB\))168 2910 A
5895 V
(22111)210 1122 A
1482(*)S
(inode)210 1692 A
(map)126 1944 A
(s_imap_blocks)546 2280 A
5985 V
(22112)210 1122 A
1482(*)S
(zone)168 1692 A
(map)126 1902 A
(s_zmap_blocks)546 2280 A
6075 V
(22113)210 1122 A
1482(*)S
(inodes)252 1692 A
(\(s_ninodes)420 2280 A
2742(+)S
('inodes)294 2826 A
(per)126 3162 A
(block')252 3330 A
3624(-)S
(1\)/'inodes)420 3708 A
(per)126 4170 A
(block')252 4338 A
6165 V
(22114)210 1122 A
1482(*)S
(unused)252 1692 A
(whatever)336 2280 A
2658(is)S
(needed)252 2784 A
3078(to)S
(fill)168 3204 A
(out)126 3414 A
(the)126 3582 A
(current)294 3750 A
(zone)168 4086 A
6255 V
(22115)210 1122 A
1482(*)S
(data)168 1692 A
(zones)210 1902 A
(\(s_zones)336 2280 A
2658(-)S
(s_firstdatazone\))672 2742 A
3456(<<)S
(s_log_zone_size)630 3582 A
6345 V
(22116)210 1122 A
1482(*)S
6435 V
(22117)210 1122 A
1482(*)S
1566(A)S
(super_block)462 1650 A
(slot)168 2154 A
2364(is)S
(free)168 2490 A
2700(if)S
(s_dev)210 2826 A
3078(==)S
(NO_DEV.)294 3204 A
6525 V
(22118)210 1122 A
1482(*/)S
6615 V
(22119)210 1122 A
6705 V
(22120)210 1122 A
(EXTERN)252 1440 A
(struct)252 1734 A
(super_block)462 2028 A
2532({)S
6795 V
(22121)210 1122 A
(ino_t)210 1524 A
(s_ninodes;)420 1776 A
2784(/*)S
2910(#)S
(usable)252 2994 A
(inodes)252 3288 A
3582(on)S
(the)126 3708 A
(minor)210 3876 A
(device)252 4128 A
4422(*/)S
6885 V
(22122)210 1122 A
(zone1_t)294 1524 A
(s_nzones;)378 1902 A
2784(/*)S
(total)210 2910 A
(device)252 3162 A
(size,)210 3456 A
(including)378 3708 A
(bit)126 4128 A
(maps)168 4296 A
(etc)126 4506 A
4674(*/)S
6975 V
(22123)210 1122 A
(short)210 1524 A
(s_imap_blocks;)588 1776 A
2784(/*)S
2910(#)S
2994(of)S
(blocks)252 3120 A
(used)168 3414 A
3624(by)S
(inode)210 3750 A
(bit)126 4002 A
(map)126 4170 A
4338(*/)S
7065 V
(22124)210 1122 A
(short)210 1524 A
(s_zmap_blocks;)588 1776 A
2784(/*)S
2910(#)S
2994(of)S
(blocks)252 3120 A
(used)168 3414 A
3624(by)S
(zone)168 3750 A
(bit)126 3960 A
(map)126 4128 A
4296(*/)S
8418 V
EP
%%Page: 293 293
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2373(File:)S
2606(servers/fs/super.h)S
12 B
(293)180 4500 A
1755 V
7 LST
(22125)210 1122 A
(zone1_t)294 1524 A
(s_firstdatazone;)672 1860 A
2784(/*)S
(number)252 2910 A
3204(of)S
(first)210 3330 A
(data)168 3582 A
(zone)168 3792 A
4002(*/)S
1845 V
(22126)210 1122 A
(short)210 1524 A
(s_log_zone_size;)672 1776 A
2784(/*)S
(log2)168 2910 A
3120(of)S
(blocks/zone)462 3246 A
3750(*/)S
1935 V
(22127)210 1122 A
(short)210 1524 A
(s_pad;)252 1776 A
2784(/*)S
(try)126 2910 A
3078(to)S
(avoid)210 3204 A
(compiler-dependent)756 3456 A
(padding)294 4254 A
4590(*/)S
2025 V
(22128)210 1122 A
(off_t)210 1524 A
(s_max_size;)462 1776 A
2784(/*)S
(maximum)294 2910 A
(file)168 3246 A
(size)168 3456 A
3666(on)S
(this)168 3792 A
(device)252 4002 A
4296(*/)S
2115 V
(22129)210 1122 A
(zone_t)252 1524 A
(s_zones;)336 1818 A
2784(/*)S
(number)252 2910 A
3204(of)S
(zones)210 3330 A
(\(replaces)378 3582 A
(s_nzones)336 4002 A
4380(in)S
(V2\))126 4506 A
4674(*/)S
2205 V
(22130)210 1122 A
(short)210 1524 A
(s_magic;)336 1776 A
2784(/*)S
(magic)210 2910 A
(number)252 3162 A
3456(to)S
(recognize)378 3582 A
(super-blocks)504 4002 A
4548(*/)S
2295 V
(22131)210 1122 A
2385 V
(22132)210 1122 A
1524(/*)S
(The)126 1650 A
(following)378 1818 A
(items)210 2238 A
(are)126 2490 A
(valid)210 2658 A
2910(on)S
(disk)168 3036 A
(only)168 3246 A
(for)126 3456 A
3624(V3)S
(and)126 3750 A
(above)210 3918 A
4170(*/)S
2475 V
(22133)210 1122 A
2565 V
(22134)210 1122 A
1524(/*)S
(The)126 1650 A
(block)210 1818 A
(size)168 2070 A
2280(in)S
(bytes.)252 2406 A
(Minimum)294 2700 A
(MIN_BLOCK)378 3036 A
(SIZE.)210 3456 A
(SECTOR_SIZE)462 3708 A
2655 V
(22135)210 1122 A
1566(*)S
(multiple.)378 1650 A
2070(If)S
2196(V1)S
2322(or)S
2448(V2)S
(filesystem,)462 2574 A
(this)168 3078 A
(should)252 3288 A
3582(be)S
2745 V
(22136)210 1122 A
1566(*)S
(initialised)462 1650 A
2154(to)S
(STATIC_BLOCK_SIZE.)756 2280 A
(Maximum)294 3078 A
(MAX_BLOCK_SIZE.)630 3414 A
2835 V
(22137)210 1122 A
1566(*/)S
2925 V
(22138)210 1122 A
(short)210 1524 A
(s_pad2;)294 1776 A
2784(/*)S
(try)126 2910 A
3078(to)S
(avoid)210 3204 A
(compiler-dependent)756 3456 A
(padding)294 4254 A
4590(*/)S
3015 V
(22139)210 1122 A
(unsigned)336 1524 A
(short)210 1902 A
(s_block_size;)546 2154 A
2784(/*)S
(block)210 2910 A
(size)168 3162 A
3372(in)S
(bytes.)252 3498 A
3792(*/)S
3105 V
(22140)210 1122 A
(char)168 1524 A
(s_disk_version;)630 1734 A
2784(/*)S
(filesystem)420 2910 A
(format)252 3372 A
(sub-version)462 3666 A
4170(*/)S
3195 V
(22141)210 1122 A
3285 V
(22142)210 1122 A
1524(/*)S
(The)126 1650 A
(following)378 1818 A
(items)210 2238 A
(are)126 2490 A
(only)168 2658 A
(used)168 2868 A
(when)168 3078 A
(the)126 3288 A
(super_block)462 3456 A
3960(is)S
4086(in)S
(memory.)294 4212 A
4548(*/)S
3375 V
(22143)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*s_isup;)336 2070 A
2784(/*)S
(inode)210 2910 A
(for)126 3162 A
(root)168 3330 A
(dir)126 3540 A
3708(of)S
(mounted)294 3834 A
(file)168 4170 A
(sys)126 4380 A
4548(*/)S
3465 V
(22144)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*s_imount;)420 2070 A
2784(/*)S
(inode)210 2910 A
(mounted)294 3162 A
3498(on)S
3624(*/)S
3555 V
(22145)210 1122 A
(unsigned)336 1524 A
(s_inodes_per_block;)798 1902 A
2784(/*)S
(precalculated)546 2910 A
(from)168 3498 A
(magic)210 3708 A
(number)252 3960 A
4254(*/)S
3645 V
(22146)210 1122 A
(dev_t)210 1524 A
(s_dev;)252 1776 A
2784(/*)S
(whose)210 2910 A
(super)210 3162 A
(block)210 3414 A
3666(is)S
(this?)210 3792 A
4044(*/)S
3735 V
(22147)210 1122 A
(int)126 1524 A
(s_rd_only;)420 1692 A
2784(/*)S
(set)126 2910 A
3078(to)S
3204(1)S
(iff)126 3288 A
(file)168 3456 A
(sys)126 3666 A
(mounted)294 3834 A
(read)168 4170 A
(only)168 4380 A
4590(*/)S
3825 V
(22148)210 1122 A
(int)126 1524 A
(s_native;)378 1692 A
2784(/*)S
(set)126 2910 A
3078(to)S
3204(1)S
(iff)126 3288 A
(not)126 3456 A
(byte)168 3624 A
(swapped)294 3834 A
(file)168 4170 A
(system)252 4380 A
4674(*/)S
3915 V
(22149)210 1122 A
(int)126 1524 A
(s_version;)420 1692 A
2784(/*)S
(file)168 2910 A
(system)252 3120 A
(version,)336 3414 A
(zero)168 3792 A
(means)210 4002 A
(bad)126 4254 A
(magic)210 4422 A
4674(*/)S
4005 V
(22150)210 1122 A
(int)126 1524 A
(s_ndzones;)420 1692 A
2784(/*)S
2910(#)S
(direct)252 2994 A
(zones)210 3288 A
3540(in)S
3666(an)S
(inode)210 3792 A
4044(*/)S
4095 V
(22151)210 1122 A
(int)126 1524 A
(s_nindirs;)420 1692 A
2784(/*)S
2910(#)S
(indirect)336 2994 A
(zones)210 3372 A
(per)126 3624 A
(indirect)336 3792 A
(block)210 4170 A
4422(*/)S
4185 V
(22152)210 1122 A
(bit_t)210 1524 A
(s_isearch;)420 1776 A
2784(/*)S
(inodes)252 2910 A
(below)210 3204 A
(this)168 3456 A
(bit)126 3666 A
(number)252 3834 A
(are)126 4128 A
4296(in)S
(use)126 4422 A
4590(*/)S
4275 V
(22153)210 1122 A
(bit_t)210 1524 A
(s_zsearch;)420 1776 A
2784(/*)S
(all)126 2910 A
(zones)210 3078 A
(below)210 3330 A
(this)168 3582 A
(bit)126 3792 A
(number)252 3960 A
(are)126 4254 A
4422(in)S
(use*/)210 4548 A
4365 V
(22154)210 1122 A
1440(})S
(super_block[NR_SUPERS];)966 1524 A
4455 V
(22155)210 1122 A
4545 V
(22156)210 1122 A
(#define)294 1440 A
(NIL_SUPER)378 1776 A
(\(struct)294 2196 A
(super_block)462 2532 A
3036(*\))S
3162(0)S
4635 V
(22157)210 1122 A
(#define)294 1440 A
(IMAP)168 1776 A
2448(0)S
2784(/*)S
(operating)378 2910 A
3330(on)S
(the)126 3456 A
(inode)210 3624 A
(bit)126 3876 A
(map)126 4044 A
4212(*/)S
4725 V
(22158)210 1122 A
(#define)294 1440 A
(ZMAP)168 1776 A
2448(1)S
2784(/*)S
(operating)378 2910 A
3330(on)S
(the)126 3456 A
(zone)168 3624 A
(bit)126 3834 A
(map)126 4002 A
4170(*/)S
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(servers/fs/table.c)756 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(22200)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(table)210 2532 A
(used)168 2784 A
2994(to)S
(map)126 3120 A
(system)252 3288 A
(call)168 3582 A
(numbers)294 3792 A
(onto)168 4128 A
(the)126 4338 A
5445 V
(22201)210 1122 A
1482(*)S
(routines)336 1566 A
(that)168 1944 A
(perform)294 2154 A
(them.)210 2490 A
5535 V
(22202)210 1122 A
1482(*/)S
5625 V
(22203)210 1122 A
5715 V
(22204)210 1122 A
(#define)294 1440 A
(_TABLE)252 1776 A
5805 V
(22205)210 1122 A
5895 V
(22206)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
5985 V
(22207)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
6075 V
(22208)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
6165 V
(22209)210 1122 A
(#include)336 1440 A
("buf.h")294 1818 A
6255 V
(22210)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
6345 V
(22211)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
6435 V
(22212)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
6525 V
(22213)210 1122 A
(#include)336 1440 A
("lock.h")336 1818 A
6615 V
(22214)210 1122 A
(#include)336 1440 A
("super.h")378 1818 A
6705 V
(22215)210 1122 A
6795 V
(22216)210 1122 A
(PUBLIC)252 1440 A
(_PROTOTYPE)420 1734 A
(\(int)168 2196 A
(\(*call_vec[]\),)588 2406 A
(\(void\))252 3036 A
3330(\))S
3414(=)S
3498({)S
6885 V
(22217)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2616(0)S
2700(=)S
(unused)252 2784 A
3120(*/)S
6975 V
(22218)210 1122 A
(do_exit,)336 1776 A
2448(/*)S
2616(1)S
2700(=)S
(exit)168 2784 A
3120(*/)S
7065 V
(22219)210 1122 A
(do_fork,)336 1776 A
2448(/*)S
2616(2)S
2700(=)S
(fork)168 2784 A
3120(*/)S
8418 V
EP
%%Page: 294 294
BP
/slant 0 def
/height 0 def
1485 V
12 B
(294)180 1080 A
11 R
2387(File:)S
2620(servers/fs/table.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(22220)210 1122 A
(do_read,)336 1776 A
2448(/*)S
2616(3)S
2700(=)S
(read)168 2784 A
3120(*/)S
1845 V
(22221)210 1122 A
(do_write,)378 1776 A
2448(/*)S
2616(4)S
2700(=)S
(write)210 2784 A
3120(*/)S
1935 V
(22222)210 1122 A
(do_open,)336 1776 A
2448(/*)S
2616(5)S
2700(=)S
(open)168 2784 A
3120(*/)S
2025 V
(22223)210 1122 A
(do_close,)378 1776 A
2448(/*)S
2616(6)S
2700(=)S
(close)210 2784 A
3120(*/)S
2115 V
(22224)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2616(7)S
2700(=)S
(wait)168 2784 A
3120(*/)S
2205 V
(22225)210 1122 A
(do_creat,)378 1776 A
2448(/*)S
2616(8)S
2700(=)S
(creat)210 2784 A
3120(*/)S
2295 V
(22226)210 1122 A
(do_link,)336 1776 A
2448(/*)S
2616(9)S
2700(=)S
(link)168 2784 A
3120(*/)S
2385 V
(22227)210 1122 A
(do_unlink,)420 1776 A
2448(/*)S
2574(10)S
2700(=)S
(unlink)252 2784 A
3120(*/)S
2475 V
(22228)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(11)S
2700(=)S
(waitpid)294 2784 A
3120(*/)S
2565 V
(22229)210 1122 A
(do_chdir,)378 1776 A
2448(/*)S
2574(12)S
2700(=)S
(chdir)210 2784 A
3120(*/)S
2655 V
(22230)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(13)S
2700(=)S
(time)168 2784 A
3120(*/)S
2745 V
(22231)210 1122 A
(do_mknod,)378 1776 A
2448(/*)S
2574(14)S
2700(=)S
(mknod)210 2784 A
3120(*/)S
2835 V
(22232)210 1122 A
(do_chmod,)378 1776 A
2448(/*)S
2574(15)S
2700(=)S
(chmod)210 2784 A
3120(*/)S
2925 V
(22233)210 1122 A
(do_chown,)378 1776 A
2448(/*)S
2574(16)S
2700(=)S
(chown)210 2784 A
3120(*/)S
3015 V
(22234)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(17)S
2700(=)S
(break)210 2784 A
3120(*/)S
3105 V
(22235)210 1122 A
(do_stat,)336 1776 A
2448(/*)S
2574(18)S
2700(=)S
(stat)168 2784 A
3120(*/)S
3195 V
(22236)210 1122 A
(do_lseek,)378 1776 A
2448(/*)S
2574(19)S
2700(=)S
(lseek)210 2784 A
3120(*/)S
3285 V
(22237)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(20)S
2700(=)S
(getpid)252 2784 A
3120(*/)S
3375 V
(22238)210 1122 A
(do_mount,)378 1776 A
2448(/*)S
2574(21)S
2700(=)S
(mount)210 2784 A
3120(*/)S
3465 V
(22239)210 1122 A
(do_umount,)420 1776 A
2448(/*)S
2574(22)S
2700(=)S
(umount)252 2784 A
3120(*/)S
3555 V
(22240)210 1122 A
(do_set,)294 1776 A
2448(/*)S
2574(23)S
2700(=)S
(setuid)252 2784 A
3120(*/)S
3645 V
(22241)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(24)S
2700(=)S
(getuid)252 2784 A
3120(*/)S
3735 V
(22242)210 1122 A
(do_stime,)378 1776 A
2448(/*)S
2574(25)S
2700(=)S
(stime)210 2784 A
3120(*/)S
3825 V
(22243)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(26)S
2700(=)S
(ptrace)252 2784 A
3120(*/)S
3915 V
(22244)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(27)S
2700(=)S
(alarm)210 2784 A
3120(*/)S
4005 V
(22245)210 1122 A
(do_fstat,)378 1776 A
2448(/*)S
2574(28)S
2700(=)S
(fstat)210 2784 A
3120(*/)S
4095 V
(22246)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(29)S
2700(=)S
(pause)210 2784 A
3120(*/)S
4185 V
(22247)210 1122 A
(do_utime,)378 1776 A
2448(/*)S
2574(30)S
2700(=)S
(utime)210 2784 A
3120(*/)S
4275 V
(22248)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(31)S
2700(=)S
(\(stty\))252 2784 A
3120(*/)S
4365 V
(22249)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(32)S
2700(=)S
(\(gtty\))252 2784 A
3120(*/)S
4455 V
(22250)210 1122 A
(do_access,)420 1776 A
2448(/*)S
2574(33)S
2700(=)S
(access)252 2784 A
3120(*/)S
4545 V
(22251)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(34)S
2700(=)S
(\(nice\))252 2784 A
3120(*/)S
4635 V
(22252)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(35)S
2700(=)S
(\(ftime\))294 2784 A
3120(*/)S
4725 V
(22253)210 1122 A
(do_sync,)336 1776 A
2448(/*)S
2574(36)S
2700(=)S
(sync)168 2784 A
3120(*/)S
4815 V
(22254)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(37)S
2700(=)S
(kill)168 2784 A
3120(*/)S
4905 V
(22255)210 1122 A
(do_rename,)420 1776 A
2448(/*)S
2574(38)S
2700(=)S
(rename)252 2784 A
3120(*/)S
4995 V
(22256)210 1122 A
(do_mkdir,)378 1776 A
2448(/*)S
2574(39)S
2700(=)S
(mkdir)210 2784 A
3120(*/)S
5085 V
(22257)210 1122 A
(do_unlink,)420 1776 A
2448(/*)S
2574(40)S
2700(=)S
(rmdir)210 2784 A
3120(*/)S
5175 V
(22258)210 1122 A
(do_dup,)294 1776 A
2448(/*)S
2574(41)S
2700(=)S
(dup)126 2784 A
3120(*/)S
5265 V
(22259)210 1122 A
(do_pipe,)336 1776 A
2448(/*)S
2574(42)S
2700(=)S
(pipe)168 2784 A
3120(*/)S
5355 V
(22260)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(43)S
2700(=)S
(times)210 2784 A
3120(*/)S
5445 V
(22261)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(44)S
2700(=)S
(\(prof\))252 2784 A
3120(*/)S
5535 V
(22262)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(45)S
2700(=)S
(unused)252 2784 A
3120(*/)S
5625 V
(22263)210 1122 A
(do_set,)294 1776 A
2448(/*)S
2574(46)S
2700(=)S
(setgid)252 2784 A
3120(*/)S
5715 V
(22264)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(47)S
2700(=)S
(getgid)252 2784 A
3120(*/)S
5805 V
(22265)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(48)S
2700(=)S
(\(signal\)*/)420 2784 A
5895 V
(22266)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(49)S
2700(=)S
(unused)252 2784 A
3120(*/)S
5985 V
(22267)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(50)S
2700(=)S
(unused)252 2784 A
3120(*/)S
6075 V
(22268)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(51)S
2700(=)S
(\(acct\))252 2784 A
3120(*/)S
6165 V
(22269)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(52)S
2700(=)S
(\(phys\))252 2784 A
3120(*/)S
6255 V
(22270)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(53)S
2700(=)S
(\(lock\))252 2784 A
3120(*/)S
6345 V
(22271)210 1122 A
(do_ioctl,)378 1776 A
2448(/*)S
2574(54)S
2700(=)S
(ioctl)210 2784 A
3120(*/)S
6435 V
(22272)210 1122 A
(do_fcntl,)378 1776 A
2448(/*)S
2574(55)S
2700(=)S
(fcntl)210 2784 A
3120(*/)S
6525 V
(22273)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(56)S
2700(=)S
(\(mpx\))210 2784 A
3120(*/)S
6615 V
(22274)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(57)S
2700(=)S
(unused)252 2784 A
3120(*/)S
6705 V
(22275)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(58)S
2700(=)S
(unused)252 2784 A
3120(*/)S
6795 V
(22276)210 1122 A
(do_exec,)336 1776 A
2448(/*)S
2574(59)S
2700(=)S
(execve)252 2784 A
3120(*/)S
6885 V
(22277)210 1122 A
(do_umask,)378 1776 A
2448(/*)S
2574(60)S
2700(=)S
(umask)210 2784 A
3120(*/)S
6975 V
(22278)210 1122 A
(do_chroot,)420 1776 A
2448(/*)S
2574(61)S
2700(=)S
(chroot)252 2784 A
3120(*/)S
7065 V
(22279)210 1122 A
(do_setsid,)420 1776 A
2448(/*)S
2574(62)S
2700(=)S
(setsid)252 2784 A
3120(*/)S
8418 V
EP
%%Page: 295 295
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2387(File:)S
2620(servers/fs/table.c)S
12 B
(295)180 4500 A
1755 V
7 LST
(22280)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(63)S
2700(=)S
(getpgrp)294 2784 A
3120(*/)S
1845 V
(22281)210 1122 A
1935 V
(22282)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(64)S
2700(=)S
(KSIG:)210 2784 A
(signals)294 3036 A
(originating)462 3372 A
3876(in)S
(the)126 4002 A
(kernel)252 4170 A
4464(*/)S
2025 V
(22283)210 1122 A
(do_unpause,)462 1776 A
2448(/*)S
2574(65)S
2700(=)S
(UNPAUSE)294 2784 A
3120(*/)S
2115 V
(22284)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(66)S
2700(=)S
(unused)252 2784 A
3120(*/)S
2205 V
(22285)210 1122 A
(do_revive,)420 1776 A
2448(/*)S
2574(67)S
2700(=)S
(REVIVE)252 2784 A
3120(*/)S
2295 V
(22286)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(68)S
2700(=)S
(TASK_REPLY)420 2784 A
3456(*/)S
2385 V
(22287)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(69)S
2700(=)S
(unused)252 2784 A
3078(*/)S
2475 V
(22288)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(70)S
2700(=)S
(unused)252 2784 A
3078(*/)S
2565 V
(22289)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(71)S
2700(=)S
2784(si)S
2910(*/)S
2655 V
(22290)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(72)S
2700(=)S
(sigsuspend)420 2784 A
3246(*/)S
2745 V
(22291)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(73)S
2700(=)S
(sigpending)420 2784 A
3246(*/)S
2835 V
(22292)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(74)S
2700(=)S
(sigprocmask)462 2784 A
3288(*/)S
2925 V
(22293)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(75)S
2700(=)S
(sigreturn)378 2784 A
3204(*/)S
3015 V
(22294)210 1122 A
(do_reboot,)420 1776 A
2448(/*)S
2574(76)S
2700(=)S
(reboot)252 2784 A
3078(*/)S
3105 V
(22295)210 1122 A
(do_svrctl,)420 1776 A
2448(/*)S
2574(77)S
2700(=)S
(svrctl)252 2784 A
3078(*/)S
3195 V
(22296)210 1122 A
3285 V
(22297)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(78)S
2700(=)S
(unused)252 2784 A
3078(*/)S
3375 V
(22298)210 1122 A
(do_getsysinfo,)588 1776 A
2448(/*)S
2574(79)S
2700(=)S
(getsysinfo)420 2784 A
3246(*/)S
3465 V
(22299)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(80)S
2700(=)S
(unused)252 2784 A
3078(*/)S
3555 V
(22300)210 1122 A
(do_devctl,)420 1776 A
2448(/*)S
2574(81)S
2700(=)S
(devctl)252 2784 A
3078(*/)S
3645 V
(22301)210 1122 A
(do_fstatfs,)462 1776 A
2448(/*)S
2574(82)S
2700(=)S
(fstatfs)294 2784 A
3120(*/)S
3735 V
(22302)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(83)S
2700(=)S
(memalloc)336 2784 A
3162(*/)S
3825 V
(22303)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(84)S
2700(=)S
(memfree)294 2784 A
3120(*/)S
3915 V
(22304)210 1122 A
(do_select,)420 1776 A
2448(/*)S
2574(85)S
2700(=)S
(select)252 2784 A
3078(*/)S
4005 V
(22305)210 1122 A
(do_fchdir,)420 1776 A
2448(/*)S
2574(86)S
2700(=)S
(fchdir)252 2784 A
3078(*/)S
4095 V
(22306)210 1122 A
(do_fsync,)378 1776 A
2448(/*)S
2574(87)S
2700(=)S
(fsync)210 2784 A
3036(*/)S
4185 V
(22307)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(88)S
2700(=)S
(getpriority)462 2784 A
3288(*/)S
4275 V
(22308)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(89)S
2700(=)S
(setpriority)462 2784 A
3288(*/)S
4365 V
(22309)210 1122 A
(no_sys,)294 1776 A
2448(/*)S
2574(90)S
2700(=)S
(gettimeofday)504 2784 A
3330(*/)S
4455 V
(22310)210 1122 A
1440(};)S
4545 V
(22311)210 1122 A
1440(/*)S
(This)168 1566 A
(should)252 1776 A
(not)126 2070 A
(fail)168 2238 A
(with)168 2448 A
("array)252 2658 A
(size)168 2952 A
3162(is)S
(negative":)420 3288 A
3750(*/)S
4635 V
(22312)210 1122 A
(extern)252 1440 A
(int)126 1734 A
(dummy[sizeof\(call_vec\))924 1902 A
2868(==)S
(NCALLS)252 2994 A
3288(*)S
(sizeof\(call_vec[0]\))798 3372 A
4212(?)S
4296(1)S
4380(:)S
(-1];)168 4464 A
4725 V
(22313)210 1122 A
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(servers/fs/cache.c)756 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(22400)210 1122 A
1440(/*)S
(The)126 1566 A
(file)168 1734 A
(system)252 1944 A
(maintains)378 2238 A
2658(a)S
(buffer)252 2742 A
(cache)210 3036 A
3288(to)S
(reduce)252 3414 A
(the)126 3708 A
(number)252 3876 A
4170(of)S
(disk)168 4296 A
5445 V
(22401)210 1122 A
1482(*)S
(accesses)336 1566 A
(needed.)294 1944 A
(Whenever)336 2322 A
2700(a)S
(read)168 2784 A
2994(or)S
(write)210 3120 A
3372(to)S
(the)126 3498 A
(disk)168 3666 A
3876(is)S
(done,)210 4002 A
4254(a)S
(check)210 4338 A
4590(is)S
5535 V
(22402)210 1122 A
1482(*)S
(first)210 1566 A
(made)168 1818 A
2028(to)S
(see)126 2154 A
2322(if)S
(the)126 2448 A
(block)210 2616 A
2868(is)S
2994(in)S
(the)126 3120 A
(cache.)252 3288 A
(This)168 3624 A
(file)168 3834 A
(manages)294 4044 A
(the)126 4380 A
5625 V
(22403)210 1122 A
1482(*)S
(cache.)252 1566 A
5715 V
(22404)210 1122 A
1482(*)S
5805 V
(22405)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are:)168 2910 A
5895 V
(22406)210 1122 A
1482(*)S
(get_block:)420 1650 A
(request)294 2196 A
2532(to)S
(fetch)210 2658 A
2910(a)S
(block)210 2994 A
(for)126 3246 A
(reading)294 3414 A
3750(or)S
(writing)294 3876 A
(from)168 4212 A
(cache)210 4422 A
5985 V
(22407)210 1122 A
1482(*)S
(put_block:)420 1650 A
(return)252 2196 A
2490(a)S
(block)210 2574 A
(previously)420 2826 A
(requested)378 3288 A
(with)168 3708 A
(get_block)378 3918 A
6075 V
(22408)210 1122 A
1482(*)S
(alloc_zone:)462 1650 A
(allocate)336 2196 A
2574(a)S
(new)126 2658 A
(zone)168 2826 A
(\(to)126 3036 A
(increase)336 3204 A
(the)126 3582 A
(length)252 3750 A
4044(of)S
4170(a)S
(file\))210 4254 A
6165 V
(22409)210 1122 A
1482(*)S
(free_zone:)420 1650 A
(release)294 2196 A
2532(a)S
(zone)168 2616 A
(\(when)210 2826 A
3078(a)S
(file)168 3162 A
3372(is)S
(removed\))336 3498 A
6255 V
(22410)210 1122 A
1482(*)S
(rw_block:)378 1650 A
(read)168 2196 A
2406(or)S
(write)210 2532 A
2784(a)S
(block)210 2868 A
(from)168 3120 A
(the)126 3330 A
(disk)168 3498 A
(itself)252 3708 A
6345 V
(22411)210 1122 A
1482(*)S
(invalidate:)462 1650 A
(remove)252 2196 A
(all)126 2490 A
(the)126 2658 A
(cache)210 2826 A
(blocks)252 3078 A
3372(on)S
(some)168 3498 A
(device)252 3708 A
6435 V
(22412)210 1122 A
1482(*/)S
6525 V
(22413)210 1122 A
6615 V
(22414)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
6705 V
(22415)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
6795 V
(22416)210 1122 A
(#include)336 1440 A
("buf.h")294 1818 A
6885 V
(22417)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
6975 V
(22418)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
7065 V
(22419)210 1122 A
(#include)336 1440 A
("super.h")378 1818 A
8418 V
EP
%%Page: 296 296
BP
/slant 0 def
/height 0 def
1485 V
12 B
(296)180 1080 A
11 R
2368(File:)S
(servers/fs/cache.c)790 2601 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(22420)210 1122 A
1845 V
(22421)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(rm_lru,)294 2490 A
(\(struct)294 2826 A
(buf)126 3162 A
(*bp\))168 3330 A
3540(\);)S
1935 V
(22422)210 1122 A
2025 V
(22423)210 1122 A
(/*===========================================================================*)3276 1440 A
2115 V
(22424)210 1122 A
1482(*)S
(get_block)378 2784 A
4674(*)S
2205 V
(22425)210 1122 A
(*===========================================================================*/)3276 1482 A
2295 V
(22426)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(buf)126 2028 A
(*get_block\(dev,)630 2196 A
(block,)252 2868 A
(only_search\))504 3162 A
2385 V
(22427)210 1122 A
(register)336 1440 A
(dev_t)210 1818 A
(dev;)168 2070 A
2784(/*)S
2910(on)S
(which)210 3036 A
(device)252 3288 A
3582(is)S
(the)126 3708 A
(block?)252 3876 A
4170(*/)S
2475 V
(22428)210 1122 A
(register)336 1440 A
(block_t)294 1818 A
(block;)252 2154 A
2784(/*)S
(which)210 2910 A
(block)210 3162 A
3414(is)S
(wanted?)294 3540 A
3876(*/)S
2565 V
(22429)210 1122 A
(int)126 1440 A
(only_search;)504 1608 A
2784(/*)S
2910(if)S
(NO_READ,)336 3036 A
(don't)210 3414 A
(read,)210 3666 A
(else)168 3918 A
(act)126 4128 A
(normal)252 4296 A
4590(*/)S
2655 V
(22430)210 1122 A
1440({)S
2745 V
(22431)210 1122 A
1440(/*)S
(Check)210 1566 A
1818(to)S
(see)126 1944 A
2112(if)S
(the)126 2238 A
(requested)378 2406 A
(block)210 2826 A
3078(is)S
3204(in)S
(the)126 3330 A
(block)210 3498 A
(cache.)252 3750 A
4086(If)S
(so,)126 4212 A
(return)252 4380 A
2835 V
(22432)210 1122 A
1482(*)S
1566(a)S
(pointer)294 1650 A
1986(to)S
(it.)126 2112 A
2322(If)S
(not,)168 2448 A
(evict)210 2658 A
(some)168 2910 A
(other)210 3120 A
(block)210 3372 A
(and)126 3624 A
(fetch)210 3792 A
4044(it)S
(\(unless)294 4170 A
2925 V
(22433)210 1122 A
1482(*)S
('only_search')546 1566 A
2154(is)S
(1\).)126 2280 A
(All)126 2490 A
(the)126 2658 A
(blocks)252 2826 A
3120(in)S
(the)126 3246 A
(cache)210 3414 A
(that)168 3666 A
(are)126 3876 A
(not)126 4044 A
4212(in)S
(use)126 4338 A
3015 V
(22434)210 1122 A
1482(*)S
(are)126 1566 A
(linked)252 1734 A
(together)336 2028 A
2406(in)S
2532(a)S
(chain,)252 2616 A
(with)168 2910 A
('front')294 3120 A
(pointing)336 3456 A
3834(to)S
(the)126 3960 A
(least)210 4128 A
(recently)336 4380 A
3105 V
(22435)210 1122 A
1482(*)S
(used)168 1566 A
(block)210 1776 A
(and)126 2028 A
('rear')252 2196 A
2490(to)S
(the)126 2616 A
(most)168 2784 A
(recently)336 2994 A
(used)168 3372 A
(block.)252 3582 A
3918(If)S
('only_search')546 4044 A
4632(is)S
3195 V
(22436)210 1122 A
1482(*)S
1566(1,)S
(the)126 1692 A
(block)210 1860 A
(being)210 2112 A
(requested)378 2364 A
(will)168 2784 A
2994(be)S
(overwritten)462 3120 A
3624(in)S
(its)126 3750 A
(entirety,)378 3918 A
4338(so)S
4464(it)S
4590(is)S
3285 V
(22437)210 1122 A
1482(*)S
(only)168 1566 A
(necessary)378 1776 A
2196(to)S
(see)126 2322 A
2490(if)S
2616(it)S
2742(is)S
2868(in)S
(the)126 2994 A
(cache;)252 3162 A
3456(if)S
3582(it)S
3708(is)S
(not,)168 3834 A
(any)126 4044 A
(free)168 4212 A
(buffer)252 4422 A
3375 V
(22438)210 1122 A
1482(*)S
(will)168 1566 A
(do.)126 1776 A
1986(It)S
2112(is)S
(not)126 2238 A
(necessary)378 2406 A
2826(to)S
(actually)336 2952 A
(read)168 3330 A
(the)126 3540 A
(block)210 3708 A
3960(in)S
(from)168 4086 A
(disk.)210 4296 A
3465 V
(22439)210 1122 A
1482(*)S
1566(If)S
('only_search')546 1692 A
2280(is)S
(PREFETCH,)378 2406 A
(the)126 2826 A
(block)210 2994 A
(need)168 3246 A
(not)126 3456 A
3624(be)S
(read)168 3750 A
(from)168 3960 A
(the)126 4170 A
(disk,)210 4338 A
3555 V
(22440)210 1122 A
1482(*)S
(and)126 1566 A
(the)126 1734 A
(device)252 1902 A
2196(is)S
(not)126 2322 A
2490(to)S
2616(be)S
(marked)252 2742 A
3036(on)S
(the)126 3162 A
(block,)252 3330 A
3624(so)S
(callers)294 3750 A
(can)126 4086 A
(tell)168 4254 A
4464(if)S
3645 V
(22441)210 1122 A
1482(*)S
(the)126 1566 A
(block)210 1734 A
(returned)336 1986 A
2364(is)S
(valid.)252 2490 A
3735 V
(22442)210 1122 A
1482(*)S
1566(In)S
(addition)336 1692 A
2070(to)S
(the)126 2196 A
(LRU)126 2364 A
(chain,)252 2532 A
(there)210 2826 A
3078(is)S
(also)168 3204 A
3414(a)S
(hash)168 3498 A
(chain)210 3708 A
3960(to)S
(link)168 4086 A
(together)336 4296 A
3825 V
(22443)210 1122 A
1482(*)S
(blocks)252 1566 A
(whose)210 1860 A
(block)210 2112 A
(numbers)294 2364 A
(end)126 2700 A
(with)168 2868 A
(the)126 3078 A
(same)168 3246 A
(bit)126 3456 A
(strings,)336 3624 A
(for)126 4002 A
(fast)168 4170 A
(lookup.)294 4380 A
3915 V
(22444)210 1122 A
1482(*/)S
4005 V
(22445)210 1122 A
4095 V
(22446)210 1122 A
(int)126 1524 A
1692(b;)S
4185 V
(22447)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(buf)126 2196 A
(*bp,)168 2364 A
(*prev_ptr;)420 2574 A
4275 V
(22448)210 1122 A
4365 V
(22449)210 1122 A
1524(/*)S
(Search)252 1650 A
(the)126 1944 A
(hash)168 2112 A
(chain)210 2322 A
(for)126 2574 A
(\(dev,)210 2742 A
(block\).)294 2994 A
(Do_read\(\))378 3330 A
(can)126 3750 A
(use)126 3918 A
4455 V
(22450)210 1122 A
1566(*)S
(get_block\(NO_DEV)672 1650 A
(...\))168 2364 A
2574(to)S
(get)126 2700 A
2868(an)S
(unnamed)294 2994 A
(block)210 3330 A
3582(to)S
(fill)168 3708 A
(with)168 3918 A
(zeros)210 4128 A
(when)168 4380 A
4545 V
(22451)210 1122 A
1566(*)S
(someone)294 1650 A
(wants)210 1986 A
2238(to)S
(read)168 2364 A
(from)168 2574 A
2784(a)S
(hole)168 2868 A
3078(in)S
3204(a)S
(file,)210 3288 A
3540(in)S
(which)210 3666 A
(case)168 3918 A
(this)168 4128 A
(search)252 4338 A
4635 V
(22452)210 1122 A
1566(*)S
1650(is)S
(skipped)294 1776 A
4725 V
(22453)210 1122 A
1566(*/)S
4815 V
(22454)210 1122 A
1524(if)S
(\(dev)168 1650 A
1860(!=)S
(NO_DEV\))294 1986 A
2322({)S
4905 V
(22455)210 1122 A
1776(b)S
1860(=)S
(\(int\))210 1944 A
(block)210 2196 A
2448(&)S
(HASH_MASK;)420 2532 A
4995 V
(22456)210 1122 A
1776(bp)S
1902(=)S
(buf_hash[b];)504 1986 A
5085 V
(22457)210 1122 A
(while)210 1776 A
(\(bp)126 2028 A
2196(!=)S
(NIL_BUF\))336 2322 A
2700({)S
5175 V
(22458)210 1122 A
2112(if)S
(\(bp->b_blocknr)588 2238 A
2868(==)S
(block)210 2994 A
3246(&&)S
(bp->b_dev)378 3372 A
3792(==)S
(dev\))168 3918 A
4128({)S
5265 V
(22459)210 1122 A
2448(/*)S
(Block)210 2574 A
(needed)252 2826 A
(has)126 3120 A
(been)168 3288 A
(found.)252 3498 A
3792(*/)S
5355 V
(22460)210 1122 A
2448(if)S
(\(bp->b_count)504 2574 A
3120(==)S
3246(0\))S
(rm_lru\(bp\);)462 3372 A
5445 V
(22461)210 1122 A
(bp->b_count++;)588 2448 A
3120(/*)S
(record)252 3246 A
(that)168 3540 A
(block)210 3750 A
4002(is)S
4128(in)S
(use)126 4254 A
4422(*/)S
5535 V
(22462)210 1122 A
5625 V
(22463)210 1122 A
(return\(bp\);)462 2448 A
5715 V
(22464)210 1122 A
2112(})S
(else)168 2196 A
2406({)S
5805 V
(22465)210 1122 A
2448(/*)S
(This)168 2574 A
(block)210 2784 A
3036(is)S
(not)126 3162 A
(the)126 3330 A
(one)126 3498 A
(sought.)294 3666 A
4002(*/)S
5895 V
(22466)210 1122 A
2448(bp)S
2574(=)S
(bp->b_hash;)462 2658 A
3162(/*)S
(move)168 3288 A
3498(to)S
(next)168 3624 A
(block)210 3834 A
4086(on)S
(hash)168 4212 A
(chain)210 4422 A
4674(*/)S
5985 V
(22467)210 1122 A
2112(})S
6075 V
(22468)210 1122 A
1776(})S
6165 V
(22469)210 1122 A
1524(})S
6255 V
(22470)210 1122 A
6345 V
(22471)210 1122 A
1524(/*)S
(Desired)294 1650 A
(block)210 1986 A
2238(is)S
(not)126 2364 A
2532(on)S
(available)378 2658 A
(chain.)252 3078 A
(Take)168 3414 A
(oldest)252 3624 A
(block)210 3918 A
(\('front'\).)420 4170 A
4632(*/)S
6435 V
(22472)210 1122 A
1524(if)S
(\(\(bp)168 1650 A
1860(=)S
(front\))252 1944 A
2238(==)S
(NIL_BUF\))336 2364 A
(panic\(__FILE__,"all)798 2742 A
(buffers)294 3582 A
3918(in)S
(use",)210 4044 A
(NR_BUFS\);)378 4296 A
6525 V
(22473)210 1122 A
(rm_lru\(bp\);)462 1524 A
6615 V
(22474)210 1122 A
6705 V
(22475)210 1122 A
1524(/*)S
(Remove)252 1650 A
(the)126 1944 A
(block)210 2112 A
(that)168 2364 A
(was)126 2574 A
(just)168 2742 A
(taken)210 2952 A
(from)168 3204 A
(its)126 3414 A
(hash)168 3582 A
(chain.)252 3792 A
4086(*/)S
6795 V
(22476)210 1122 A
1524(b)S
1608(=)S
(\(int\))210 1692 A
(bp->b_blocknr)546 1944 A
2532(&)S
(HASH_MASK;)420 2616 A
6885 V
(22477)210 1122 A
(prev_ptr)336 1524 A
1902(=)S
(buf_hash[b];)504 1986 A
6975 V
(22478)210 1122 A
1524(if)S
(\(prev_ptr)378 1650 A
2070(==)S
(bp\))126 2196 A
2364({)S
7065 V
(22479)210 1122 A
(buf_hash[b])462 1776 A
2280(=)S
(bp->b_hash;)462 2364 A
8418 V
EP
%%Page: 297 297
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2368(File:)S
(servers/fs/cache.c)790 2601 A
12 B
(297)180 4500 A
1755 V
7 LST
(22480)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
1845 V
(22481)210 1122 A
1776(/*)S
(The)126 1902 A
(block)210 2070 A
(just)168 2322 A
(taken)210 2532 A
2784(is)S
(not)126 2910 A
3078(on)S
(the)126 3204 A
(front)210 3372 A
3624(of)S
(its)126 3750 A
(hash)168 3918 A
(chain.)252 4128 A
4422(*/)S
1935 V
(22482)210 1122 A
(while)210 1776 A
(\(prev_ptr->b_hash)714 2028 A
2784(!=)S
(NIL_BUF\))336 2910 A
2025 V
(22483)210 1122 A
2112(if)S
(\(prev_ptr->b_hash)714 2238 A
2994(==)S
(bp\))126 3120 A
3288({)S
2115 V
(22484)210 1122 A
(prev_ptr->b_hash)672 2448 A
3162(=)S
(bp->b_hash;)462 3246 A
3792(/*)S
(found)210 3918 A
4170(it)S
4296(*/)S
2205 V
(22485)210 1122 A
(break;)252 2448 A
2295 V
(22486)210 1122 A
2112(})S
(else)168 2196 A
2406({)S
2385 V
(22487)210 1122 A
(prev_ptr)336 2448 A
2826(=)S
(prev_ptr->b_hash;)714 2910 A
3792(/*)S
(keep)168 3918 A
(looking)294 4128 A
4464(*/)S
2475 V
(22488)210 1122 A
2112(})S
2565 V
(22489)210 1122 A
1524(})S
2655 V
(22490)210 1122 A
2745 V
(22491)210 1122 A
1524(/*)S
1650(If)S
(the)126 1776 A
(block)210 1944 A
(taken)210 2196 A
2448(is)S
(dirty,)252 2574 A
(make)168 2868 A
3078(it)S
(clean)210 3204 A
3456(by)S
(writing)294 3582 A
3918(it)S
4044(to)S
(the)126 4170 A
(disk.)210 4338 A
2835 V
(22492)210 1122 A
1566(*)S
(Avoid)210 1650 A
(hysteresis)420 1902 A
2364(by)S
(flushing)336 2490 A
(all)126 2868 A
(other)210 3036 A
(dirty)210 3288 A
(blocks)252 3540 A
(for)126 3834 A
(the)126 4002 A
(same)168 4170 A
(device.)294 4380 A
2925 V
(22493)210 1122 A
1566(*/)S
3015 V
(22494)210 1122 A
1524(if)S
(\(bp->b_dev)420 1650 A
2112(!=)S
(NO_DEV\))294 2238 A
2574({)S
3105 V
(22495)210 1122 A
1776(if)S
(\(bp->b_dirt)462 1902 A
2406(==)S
(DIRTY\))252 2532 A
(flushall\(bp->b_dev\);)840 2826 A
3195 V
(22496)210 1122 A
1524(})S
3285 V
(22497)210 1122 A
3375 V
(22498)210 1122 A
1524(/*)S
(Fill)168 1650 A
1860(in)S
(block's)294 1986 A
(parameters)420 2322 A
(and)126 2784 A
(add)126 2952 A
3120(it)S
3246(to)S
(the)126 3372 A
(hash)168 3540 A
(chain)210 3750 A
(where)210 4002 A
4254(it)S
(goes.)210 4380 A
4632(*/)S
3465 V
(22499)210 1122 A
(bp->b_dev)378 1524 A
1944(=)S
(dev;)168 2028 A
2784(/*)S
(fill)168 2910 A
3120(in)S
(device)252 3246 A
(number)252 3540 A
3834(*/)S
3555 V
(22500)210 1122 A
(bp->b_blocknr)546 1524 A
2112(=)S
(block;)252 2196 A
2784(/*)S
(fill)168 2910 A
3120(in)S
(block)210 3246 A
(number)252 3498 A
3792(*/)S
3645 V
(22501)210 1122 A
(bp->b_count++;)588 1524 A
2784(/*)S
(record)252 2910 A
(that)168 3204 A
(block)210 3414 A
3666(is)S
(being)210 3792 A
(used)168 4044 A
4254(*/)S
3735 V
(22502)210 1122 A
1524(b)S
1608(=)S
(\(int\))210 1692 A
(bp->b_blocknr)546 1944 A
2532(&)S
(HASH_MASK;)420 2616 A
3825 V
(22503)210 1122 A
(bp->b_hash)420 1524 A
1986(=)S
(buf_hash[b];)504 2070 A
3915 V
(22504)210 1122 A
(buf_hash[b])462 1524 A
2028(=)S
(bp;)126 2112 A
2784(/*)S
(add)126 2910 A
3078(to)S
(hash)168 3204 A
(list)168 3414 A
3624(*/)S
4005 V
(22505)210 1122 A
4095 V
(22506)210 1122 A
1524(/*)S
1650(Go)S
(get)126 1776 A
(the)126 1944 A
(requested)378 2112 A
(block)210 2532 A
(unless)252 2784 A
(searching)378 3078 A
3498(or)S
(prefetching.)504 3624 A
4170(*/)S
4185 V
(22507)210 1122 A
1524(if)S
(\(dev)168 1650 A
1860(!=)S
(NO_DEV\))294 1986 A
2322({)S
4275 V
(22508)210 1122 A
1776(if)S
(\(only_search)504 1902 A
2448(==)S
(PREFETCH\))378 2574 A
(bp->b_dev)378 2994 A
3414(=)S
(NO_DEV;)294 3498 A
4365 V
(22509)210 1122 A
(else)168 1776 A
4455 V
(22510)210 1122 A
1776(if)S
(\(only_search)504 1902 A
2448(==)S
(NORMAL\))294 2574 A
2910({)S
4545 V
(22511)210 1122 A
(rw_block\(bp,)504 2112 A
(READING\);)378 2658 A
4635 V
(22512)210 1122 A
1776(})S
4725 V
(22513)210 1122 A
1524(})S
4815 V
(22514)210 1122 A
(return\(bp\);)462 1524 A
2784(/*)S
(return)252 2910 A
(the)126 3204 A
(newly)210 3372 A
(acquired)336 3624 A
(block)210 4002 A
4254(*/)S
4905 V
(22515)210 1122 A
1440(})S
5085 V
(22517)210 1122 A
(/*===========================================================================*)3276 1440 A
5175 V
(22518)210 1122 A
1482(*)S
(put_block)378 2784 A
4674(*)S
5265 V
(22519)210 1122 A
(*===========================================================================*/)3276 1482 A
5355 V
(22520)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(put_block\(bp,)546 1944 A
(block_type\))462 2532 A
5445 V
(22521)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(buf)126 2112 A
(*bp;)168 2280 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(the)126 3372 A
(buffer)252 3540 A
3834(to)S
3960(be)S
(released)336 4086 A
4464(*/)S
5535 V
(22522)210 1122 A
(int)126 1440 A
(block_type;)462 1608 A
2784(/*)S
(INODE_BLOCK,)504 2910 A
(DIRECTORY_BLOCK,)672 3456 A
4170(or)S
(whatever)336 4296 A
4674(*/)S
5625 V
(22523)210 1122 A
1440({)S
5715 V
(22524)210 1122 A
1440(/*)S
(Return)252 1566 A
1860(a)S
(block)210 1944 A
2196(to)S
(the)126 2322 A
(list)168 2490 A
2700(of)S
(available)378 2826 A
(blocks.)294 3246 A
(Depending)378 3666 A
4086(on)S
('block_type')504 4212 A
5805 V
(22525)210 1122 A
1482(*)S
1566(it)S
(may)126 1692 A
1860(be)S
(put)126 1986 A
2154(on)S
(the)126 2280 A
(front)210 2448 A
2700(or)S
(rear)168 2826 A
3036(of)S
(the)126 3162 A
(LRU)126 3330 A
(chain.)252 3498 A
(Blocks)252 3834 A
(that)168 4128 A
(are)126 4338 A
5895 V
(22526)210 1122 A
1482(*)S
(expected)336 1566 A
1944(to)S
2070(be)S
(needed)252 2196 A
(again)210 2490 A
(shortly)294 2742 A
(\(e.g.,)252 3078 A
(partially)378 3372 A
(full)168 3792 A
(data)168 4002 A
(blocks\))294 4212 A
5985 V
(22527)210 1122 A
1482(*)S
1566(go)S
1692(on)S
(the)126 1818 A
(rear;)210 1986 A
(blocks)252 2238 A
(that)168 2532 A
(are)126 2742 A
(unlikely)336 2910 A
3288(to)S
3414(be)S
(needed)252 3540 A
(again)210 3834 A
(shortly)294 4086 A
6075 V
(22528)210 1122 A
1482(*)S
(\(e.g.,)252 1566 A
(full)168 1860 A
(data)168 2070 A
(blocks\))294 2280 A
2616(go)S
2742(on)S
(the)126 2868 A
(front.)252 3036 A
(Blocks)252 3372 A
(whose)210 3666 A
(loss)168 3918 A
(can)126 4128 A
(hurt)168 4296 A
6165 V
(22529)210 1122 A
1482(*)S
(the)126 1566 A
(integrity)378 1734 A
2154(of)S
(the)126 2280 A
(file)168 2448 A
(system)252 2658 A
(\(e.g.,)252 2952 A
(inode)210 3246 A
(blocks\))294 3498 A
(are)126 3834 A
(written)294 4002 A
4338(to)S
6255 V
(22530)210 1122 A
1482(*)S
(disk)168 1566 A
(immediately)462 1776 A
2280(if)S
(they)168 2406 A
(are)126 2616 A
(dirty.)252 2784 A
6345 V
(22531)210 1122 A
1482(*/)S
6435 V
(22532)210 1122 A
1524(if)S
(\(bp)126 1650 A
1818(==)S
(NIL_BUF\))336 1944 A
(return;)294 2322 A
2784(/*)S
2910(it)S
3036(is)S
(easier)252 3162 A
3456(to)S
(check)210 3582 A
(here)168 3834 A
(than)168 4044 A
4254(in)S
(caller)252 4380 A
4674(*/)S
6525 V
(22533)210 1122 A
6615 V
(22534)210 1122 A
(bp->b_count--;)588 1524 A
2784(/*)S
(there)210 2910 A
3162(is)S
(one)126 3288 A
(use)126 3456 A
(fewer)210 3624 A
(now)126 3876 A
4044(*/)S
6705 V
(22535)210 1122 A
1524(if)S
(\(bp->b_count)504 1650 A
2196(!=)S
2322(0\))S
(return;)294 2448 A
2784(/*)S
(block)210 2910 A
3162(is)S
(still)210 3288 A
3540(in)S
(use)126 3666 A
3834(*/)S
6795 V
(22536)210 1122 A
6885 V
(22537)210 1122 A
(bufs_in_use--;)588 1524 A
2784(/*)S
(one)126 2910 A
(fewer)210 3078 A
(block)210 3330 A
(buffers)294 3582 A
3918(in)S
(use)126 4044 A
4212(*/)S
6975 V
(22538)210 1122 A
7065 V
(22539)210 1122 A
1524(/*)S
(Put)126 1650 A
(this)168 1818 A
(block)210 2028 A
(back)168 2280 A
2490(on)S
(the)126 2616 A
(LRU)126 2784 A
(chain.)252 2952 A
3288(If)S
(the)126 3414 A
(ONE_SHOT)336 3582 A
(bit)126 3960 A
4128(is)S
(set)126 4254 A
4422(in)S
8418 V
EP
%%Page: 298 298
BP
/slant 0 def
/height 0 def
1485 V
12 B
(298)180 1080 A
11 R
2368(File:)S
(servers/fs/cache.c)790 2601 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(22540)210 1122 A
1566(*)S
('block_type',)546 1650 A
(the)126 2238 A
(block)210 2406 A
2658(is)S
(not)126 2784 A
(likely)252 2952 A
3246(to)S
3372(be)S
(needed)252 3498 A
(again)210 3792 A
(shortly,)336 4044 A
4422(so)S
(put)126 4548 A
1845 V
(22541)210 1122 A
1566(*)S
1650(it)S
1776(on)S
(the)126 1902 A
(front)210 2070 A
2322(of)S
(the)126 2448 A
(LRU)126 2616 A
(chain)210 2784 A
(where)210 3036 A
3288(it)S
(will)168 3414 A
3624(be)S
(the)126 3750 A
(first)210 3918 A
(one)126 4170 A
4338(to)S
4464(be)S
1935 V
(22542)210 1122 A
1566(*)S
(taken)210 1650 A
(when)168 1902 A
2112(a)S
(free)168 2196 A
(buffer)252 2406 A
2700(is)S
(needed)252 2826 A
(later.)252 3120 A
2025 V
(22543)210 1122 A
1566(*/)S
2115 V
(22544)210 1122 A
1524(if)S
(\(bp->b_dev)420 1650 A
2112(==)S
(DEV_RAM)294 2238 A
2574(||)S
(block_type)420 2700 A
3162(&)S
(ONE_SHOT\))378 3246 A
3666({)S
2205 V
(22545)210 1122 A
1776(/*)S
(Block)210 1902 A
(probably)336 2154 A
(won't)210 2532 A
2784(be)S
(needed)252 2910 A
(quickly.)336 3204 A
(Put)126 3582 A
3750(it)S
3876(on)S
(front)210 4002 A
4254(of)S
(chain.)252 4380 A
2295 V
(22546)210 1122 A
1818(*)S
1902(It)S
(will)168 2028 A
2238(be)S
(the)126 2364 A
(next)168 2532 A
(block)210 2742 A
2994(to)S
3120(be)S
(evicted)294 3246 A
(from)168 3582 A
(the)126 3792 A
(cache.)252 3960 A
2385 V
(22547)210 1122 A
1818(*/)S
2475 V
(22548)210 1122 A
(bp->b_prev)420 1776 A
2238(=)S
(NIL_BUF;)336 2322 A
2565 V
(22549)210 1122 A
(bp->b_next)420 1776 A
2238(=)S
(front;)252 2322 A
2655 V
(22550)210 1122 A
1776(if)S
(\(front)252 1902 A
2196(==)S
(NIL_BUF\))336 2322 A
2745 V
(22551)210 1122 A
(rear)168 2112 A
2322(=)S
(bp;)126 2406 A
2784(/*)S
(LRU)126 2910 A
(chain)210 3078 A
(was)126 3330 A
(empty)210 3498 A
3750(*/)S
2835 V
(22552)210 1122 A
(else)168 1776 A
2925 V
(22553)210 1122 A
(front->b_prev)546 2112 A
2700(=)S
(bp;)126 2784 A
3015 V
(22554)210 1122 A
(front)210 1776 A
2028(=)S
(bp;)126 2112 A
3105 V
(22555)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3195 V
(22556)210 1122 A
1776(/*)S
(Block)210 1902 A
(probably)336 2154 A
(will)168 2532 A
2742(be)S
(needed)252 2868 A
(quickly.)336 3162 A
(Put)126 3582 A
3750(it)S
3876(on)S
(rear)168 4002 A
4212(of)S
(chain.)252 4338 A
3285 V
(22557)210 1122 A
1818(*)S
1902(It)S
(will)168 2028 A
(not)126 2238 A
2406(be)S
(evicted)294 2532 A
(from)168 2868 A
(the)126 3078 A
(cache)210 3246 A
(for)126 3498 A
3666(a)S
(long)168 3750 A
(time.)210 3960 A
3375 V
(22558)210 1122 A
1818(*/)S
3465 V
(22559)210 1122 A
(bp->b_prev)420 1776 A
2238(=)S
(rear;)210 2322 A
3555 V
(22560)210 1122 A
(bp->b_next)420 1776 A
2238(=)S
(NIL_BUF;)336 2322 A
3645 V
(22561)210 1122 A
1776(if)S
(\(rear)210 1902 A
2154(==)S
(NIL_BUF\))336 2280 A
3735 V
(22562)210 1122 A
(front)210 2112 A
2364(=)S
(bp;)126 2448 A
3825 V
(22563)210 1122 A
(else)168 1776 A
3915 V
(22564)210 1122 A
(rear->b_next)504 2112 A
2658(=)S
(bp;)126 2742 A
4005 V
(22565)210 1122 A
(rear)168 1776 A
1986(=)S
(bp;)126 2070 A
4095 V
(22566)210 1122 A
1524(})S
4185 V
(22567)210 1122 A
4275 V
(22568)210 1122 A
1524(/*)S
(Some)168 1650 A
(blocks)252 1860 A
(are)126 2154 A
2322(so)S
(important)378 2448 A
(\(e.g.,)252 2868 A
(inodes,)294 3162 A
(indirect)336 3498 A
(blocks\))294 3876 A
(that)168 4212 A
(they)168 4422 A
4365 V
(22569)210 1122 A
1566(*)S
(should)252 1650 A
1944(be)S
(written)294 2070 A
2406(to)S
(the)126 2532 A
(disk)168 2700 A
(immediately)462 2910 A
3414(to)S
(avoid)210 3540 A
(messing)294 3792 A
4128(up)S
(the)126 4254 A
(file)168 4422 A
4455 V
(22570)210 1122 A
1566(*)S
(system)252 1650 A
1944(in)S
(the)126 2070 A
(event)210 2238 A
2490(of)S
2616(a)S
(crash.)252 2700 A
4545 V
(22571)210 1122 A
1566(*/)S
4635 V
(22572)210 1122 A
1524(if)S
(\(\(block_type)504 1650 A
2196(&)S
(WRITE_IMMED\))504 2280 A
2826(&&)S
(bp->b_dirt==DIRTY)714 2952 A
3708(&&)S
(bp->b_dev)378 3834 A
4254(!=)S
(NO_DEV\))294 4380 A
4716({)S
4725 V
(22573)210 1122 A
(rw_block\(bp,)504 2112 A
(WRITING\);)378 2658 A
4815 V
(22574)210 1122 A
1524(})S
4905 V
(22575)210 1122 A
1440(})S
5085 V
(22577)210 1122 A
(/*===========================================================================*)3276 1440 A
5175 V
(22578)210 1122 A
1482(*)S
(alloc_zone)420 2784 A
4674(*)S
5265 V
(22579)210 1122 A
(*===========================================================================*/)3276 1482 A
5355 V
(22580)210 1122 A
(PUBLIC)252 1440 A
(zone_t)252 1734 A
(alloc_zone\(dev,)630 2028 A
2700(z\))S
5445 V
(22581)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
2784(/*)S
(device)252 2910 A
(where)210 3204 A
(zone)168 3456 A
(wanted)252 3666 A
3960(*/)S
5535 V
(22582)210 1122 A
(zone_t)252 1440 A
1734(z;)S
2784(/*)S
(try)126 2910 A
3078(to)S
(allocate)336 3204 A
(new)126 3582 A
(zone)168 3750 A
(near)168 3960 A
(this)168 4170 A
(one)126 4380 A
4548(*/)S
5625 V
(22583)210 1122 A
1440({)S
5715 V
(22584)210 1122 A
1440(/*)S
(Allocate)336 1566 A
1944(a)S
(new)126 2028 A
(zone)168 2196 A
2406(on)S
(the)126 2532 A
(indicated)378 2700 A
(device)252 3120 A
(and)126 3414 A
(return)252 3582 A
(its)126 3876 A
(number.)294 4044 A
4380(*/)S
5805 V
(22585)210 1122 A
5895 V
(22586)210 1122 A
(int)126 1524 A
(major,)252 1692 A
(minor;)252 1986 A
5985 V
(22587)210 1122 A
(bit_t)210 1524 A
1776(b,)S
(bit;)168 1902 A
6075 V
(22588)210 1122 A
(struct)252 1524 A
(super_block)462 1818 A
(*sp;)168 2322 A
6165 V
(22589)210 1122 A
6255 V
(22590)210 1122 A
1524(/*)S
(Note)168 1650 A
(that)168 1860 A
(the)126 2070 A
(routine)294 2238 A
(alloc_bit\(\))462 2574 A
(returns)294 3078 A
3414(1)S
(for)126 3498 A
(the)126 3666 A
(lowest)252 3834 A
(possible)336 4128 A
6345 V
(22591)210 1122 A
1566(*)S
(zone,)210 1650 A
(which)210 1902 A
(corresponds)462 2154 A
2658(to)S
(sp->s_firstdatazone.)840 2784 A
3708(To)S
(convert)294 3834 A
4170(a)S
(value)210 4254 A
6435 V
(22592)210 1122 A
1566(*)S
(between)294 1650 A
(the)126 1986 A
(bit)126 2154 A
(number,)294 2322 A
('b',)168 2658 A
(used)168 2868 A
3078(by)S
(alloc_bit\(\))462 3204 A
(and)126 3708 A
(the)126 3876 A
(zone)168 4044 A
(number,)294 4254 A
('z',)168 4590 A
6525 V
(22593)210 1122 A
1566(*)S
(stored)252 1650 A
1944(in)S
(the)126 2070 A
(inode,)252 2238 A
(use)126 2532 A
(the)126 2700 A
(formula:)336 2868 A
6615 V
(22594)210 1122 A
1566(*)S
1818(z)S
1902(=)S
1986(b)S
2070(+)S
(sp->s_firstdatazone)798 2154 A
2994(-)S
3078(1)S
6705 V
(22595)210 1122 A
1566(*)S
(Alloc_bit\(\))462 1650 A
(never)210 2154 A
(returns)294 2406 A
2742(0,)S
(since)210 2868 A
(this)168 3120 A
3330(is)S
(used)168 3456 A
(for)126 3666 A
(NO_BIT)252 3834 A
(\(failure\).)420 4128 A
6795 V
(22596)210 1122 A
1566(*/)S
6885 V
(22597)210 1122 A
1524(sp)S
1650(=)S
(get_super\(dev\);)630 1734 A
6975 V
(22598)210 1122 A
7065 V
(22599)210 1122 A
1524(/*)S
1650(If)S
1776(z)S
1860(is)S
1986(0,)S
(skip)168 2112 A
(initial)294 2322 A
(part)168 2658 A
2868(of)S
(the)126 2994 A
(map)126 3162 A
(known)210 3330 A
3582(to)S
3708(be)S
(fully)210 3834 A
4086(in)S
(use.)168 4212 A
4422(*/)S
8418 V
EP
%%Page: 299 299
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2368(File:)S
(servers/fs/cache.c)790 2601 A
12 B
(299)180 4500 A
1755 V
7 LST
(22600)210 1122 A
1524(if)S
1650(\(z)S
1776(==)S
(sp->s_firstdatazone\))840 1902 A
2784({)S
1845 V
(22601)210 1122 A
(bit)126 1776 A
1944(=)S
(sp->s_zsearch;)588 2028 A
1935 V
(22602)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
2025 V
(22603)210 1122 A
(bit)126 1776 A
1944(=)S
(\(bit_t\))294 2028 A
2364(z)S
2448(-)S
(\(sp->s_firstdatazone)840 2532 A
3414(-)S
(1\);)126 3498 A
2115 V
(22604)210 1122 A
1524(})S
2205 V
(22605)210 1122 A
1524(b)S
1608(=)S
(alloc_bit\(sp,)546 1692 A
(ZMAP,)210 2280 A
(bit\);)210 2532 A
2295 V
(22606)210 1122 A
1524(if)S
1650(\(b)S
1776(==)S
(NO_BIT\))294 1902 A
2238({)S
2385 V
(22607)210 1122 A
(err_code)336 1776 A
2154(=)S
(ENOSPC;)294 2238 A
2475 V
(22608)210 1122 A
(major)210 1776 A
2028(=)S
(\(int\))210 2112 A
(\(sp->s_dev)420 2364 A
2826(>>)S
(MAJOR\))252 2952 A
3246(&)S
(BYTE;)210 3330 A
2565 V
(22609)210 1122 A
(minor)210 1776 A
2028(=)S
(\(int\))210 2112 A
(\(sp->s_dev)420 2364 A
2826(>>)S
(MINOR\))252 2952 A
3246(&)S
(BYTE;)210 3330 A
2655 V
(22610)210 1122 A
(printf\("No)420 1776 A
(space)210 2238 A
2490(on)S
(%sdevice)336 2616 A
(%d/%d\\n",)378 2994 A
2745 V
(22611)210 1122 A
(sp->s_dev)378 2112 A
2532(==)S
(root_dev)336 2658 A
3036(?)S
("root)210 3120 A
3372(")S
3456(:)S
("",)126 3540 A
(major,)252 3708 A
(minor\);)294 4002 A
2835 V
(22612)210 1122 A
(return\(NO_ZONE\);)672 1776 A
2925 V
(22613)210 1122 A
1524(})S
3015 V
(22614)210 1122 A
1524(if)S
1650(\(z)S
1776(==)S
(sp->s_firstdatazone\))840 1902 A
(sp->s_zsearch)546 2784 A
3372(=)S
3456(b;)S
3792(/*)S
(for)126 3918 A
(next)168 4086 A
(time)168 4296 A
4506(*/)S
3105 V
(22615)210 1122 A
(return\(sp->s_firstdatazone)1092 1524 A
2658(-)S
2742(1)S
2826(+)S
(\(zone_t\))336 2910 A
(b\);)126 3288 A
3195 V
(22616)210 1122 A
1440(})S
3375 V
(22618)210 1122 A
(/*===========================================================================*)3276 1440 A
3465 V
(22619)210 1122 A
1482(*)S
(free_zone)378 2784 A
4674(*)S
3555 V
(22620)210 1122 A
(*===========================================================================*/)3276 1482 A
3645 V
(22621)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(free_zone\(dev,)588 1944 A
(numb\))210 2574 A
3735 V
(22622)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
3120(/*)S
(device)252 3246 A
(where)210 3540 A
(zone)168 3792 A
(located)294 4002 A
4338(*/)S
3825 V
(22623)210 1122 A
(zone_t)252 1440 A
(numb;)210 1734 A
3120(/*)S
(zone)168 3246 A
3456(to)S
3582(be)S
(returned)336 3708 A
4086(*/)S
3915 V
(22624)210 1122 A
1440({)S
4005 V
(22625)210 1122 A
1440(/*)S
(Return)252 1566 A
1860(a)S
(zone.)210 1944 A
2196(*/)S
4095 V
(22626)210 1122 A
4185 V
(22627)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(super_block)462 2196 A
(*sp;)168 2700 A
4275 V
(22628)210 1122 A
(bit_t)210 1524 A
(bit;)168 1776 A
4365 V
(22629)210 1122 A
4455 V
(22630)210 1122 A
1524(/*)S
(Locate)252 1650 A
(the)126 1944 A
(appropriate)462 2112 A
(super_block)462 2616 A
(and)126 3120 A
(return)252 3288 A
(bit.)168 3582 A
3792(*/)S
4545 V
(22631)210 1122 A
1524(sp)S
1650(=)S
(get_super\(dev\);)630 1734 A
4635 V
(22632)210 1122 A
1524(if)S
(\(numb)210 1650 A
1902(<)S
(sp->s_firstdatazone)798 1986 A
2826(||)S
(numb)168 2952 A
3162(>=)S
(sp->s_zones\))504 3288 A
(return;)294 3834 A
4725 V
(22633)210 1122 A
(bit)126 1524 A
1692(=)S
(\(bit_t\))294 1776 A
(\(numb)210 2112 A
2364(-)S
(\(sp->s_firstdatazone)840 2448 A
3330(-)S
(1\)\);)168 3414 A
4815 V
(22634)210 1122 A
(free_bit\(sp,)504 1524 A
(ZMAP,)210 2070 A
(bit\);)210 2322 A
4905 V
(22635)210 1122 A
1524(if)S
(\(bit)168 1650 A
1860(<)S
(sp->s_zsearch\))588 1944 A
(sp->s_zsearch)546 2574 A
3162(=)S
(bit;)168 3246 A
4995 V
(22636)210 1122 A
1440(})S
5175 V
(22638)210 1122 A
(/*===========================================================================*)3276 1440 A
5265 V
(22639)210 1122 A
1482(*)S
(rw_block)336 2784 A
4674(*)S
5355 V
(22640)210 1122 A
(*===========================================================================*/)3276 1482 A
5445 V
(22641)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(rw_block\(bp,)504 1944 A
(rw_flag\))336 2490 A
5535 V
(22642)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(buf)126 2112 A
(*bp;)168 2280 A
2784(/*)S
(buffer)252 2910 A
(pointer)294 3204 A
3540(*/)S
5625 V
(22643)210 1122 A
(int)126 1440 A
(rw_flag;)336 1608 A
2784(/*)S
(READING)294 2910 A
3246(or)S
(WRITING)294 3372 A
3708(*/)S
5715 V
(22644)210 1122 A
1440({)S
5805 V
(22645)210 1122 A
1440(/*)S
(Read)168 1566 A
1776(or)S
(write)210 1902 A
2154(a)S
(disk)168 2238 A
(block.)252 2448 A
(This)168 2742 A
2952(is)S
(the)126 3078 A
(only)168 3246 A
(routine)294 3456 A
3792(in)S
(which)210 3918 A
(actual)252 4170 A
(disk)168 4464 A
5895 V
(22646)210 1122 A
1482(*)S
(I/O)126 1566 A
1734(is)S
(invoked.)336 1860 A
2238(If)S
2364(an)S
(error)210 2490 A
(occurs,)294 2742 A
3078(a)S
(message)294 3162 A
3498(is)S
(printed)294 3624 A
(here,)210 3960 A
(but)126 4212 A
(the)126 4380 A
(error)210 4548 A
5985 V
(22647)210 1122 A
1482(*)S
1566(is)S
(not)126 1692 A
(reported)336 1860 A
2238(to)S
(the)126 2364 A
(caller.)294 2532 A
2910(If)S
(the)126 3036 A
(error)210 3204 A
(occurred)336 3456 A
(while)210 3834 A
(purging)294 4086 A
4422(a)S
(block)210 4506 A
6075 V
(22648)210 1122 A
1482(*)S
(from)168 1566 A
(the)126 1776 A
(cache,)252 1944 A
2238(it)S
2364(is)S
(not)126 2490 A
(clear)210 2658 A
(what)168 2910 A
(the)126 3120 A
(caller)252 3288 A
(could)210 3582 A
3834(do)S
(about)210 3960 A
4212(it)S
(anyway.)294 4338 A
6165 V
(22649)210 1122 A
1482(*/)S
6255 V
(22650)210 1122 A
6345 V
(22651)210 1122 A
(int)126 1524 A
1692(r,)S
(op;)126 1818 A
6435 V
(22652)210 1122 A
(off_t)210 1524 A
(pos;)168 1776 A
6525 V
(22653)210 1122 A
(dev_t)210 1524 A
(dev;)168 1776 A
6615 V
(22654)210 1122 A
(int)126 1524 A
(block_size;)462 1692 A
6705 V
(22655)210 1122 A
6795 V
(22656)210 1122 A
(block_size)420 1524 A
1986(=)S
(get_block_size\(bp->b_dev\);)1092 2070 A
6885 V
(22657)210 1122 A
6975 V
(22658)210 1122 A
1524(if)S
1650(\()S
(\(dev)168 1734 A
1944(=)S
(bp->b_dev\))420 2028 A
2490(!=)S
(NO_DEV\))294 2616 A
2952({)S
7065 V
(22659)210 1122 A
(pos)126 1776 A
1944(=)S
(\(off_t\))294 2028 A
(bp->b_blocknr)546 2364 A
2952(*)S
(block_size;)462 3036 A
8418 V
EP
%%Page: 300 300
BP
/slant 0 def
/height 0 def
1485 V
12 B
(300)180 1080 A
11 R
2368(File:)S
(servers/fs/cache.c)790 2601 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(22660)210 1122 A
1776(op)S
1902(=)S
(\(rw_flag)336 1986 A
2364(==)S
(READING)294 2490 A
2826(?)S
(DEV_READ)336 2910 A
3288(:)S
(DEV_WRITE\);)462 3372 A
1845 V
(22661)210 1122 A
1776(r)S
1860(=)S
(dev_io\(op,)420 1944 A
(dev,)168 2406 A
(FS_PROC_NR,)462 2616 A
(bp->b_data,)462 3120 A
(pos,)168 3624 A
(block_size,)462 3834 A
(0\);)126 4338 A
1935 V
(22662)210 1122 A
1776(if)S
1902(\(r)S
2028(!=)S
(block_size\))462 2154 A
2658({)S
2025 V
(22663)210 1122 A
1944(if)S
2070(\(r)S
2196(>=)S
2322(0\))S
2448(r)S
2532(=)S
(END_OF_FILE;)504 2616 A
2115 V
(22664)210 1122 A
1944(if)S
2070(\(r)S
2196(!=)S
(END_OF_FILE\))504 2322 A
2205 V
(22665)210 1122 A
(printf\("Unrecoverable)882 2028 A
(disk)168 2952 A
(error)210 3162 A
3414(on)S
(device)252 3540 A
(%d/%d,)252 3834 A
(block)210 4128 A
(%ld\\n",)294 4380 A
2295 V
(22666)210 1122 A
(\(dev>>MAJOR\)&BYTE,)756 2448 A
(\(dev>>MINOR\)&BYTE,)756 3246 A
(bp->b_blocknr\);)630 4044 A
2385 V
(22667)210 1122 A
(bp->b_dev)378 2112 A
2532(=)S
(NO_DEV;)294 2616 A
3120(/*)S
(invalidate)420 3246 A
(block)210 3708 A
3960(*/)S
2475 V
(22668)210 1122 A
2565 V
(22669)210 1122 A
2112(/*)S
(Report)252 2238 A
(read)168 2532 A
(errors)252 2742 A
3036(to)S
(interested)420 3162 A
(parties.)336 3624 A
4002(*/)S
2655 V
(22670)210 1122 A
2112(if)S
(\(rw_flag)336 2238 A
2616(==)S
(READING\))336 2742 A
(rdwt_err)336 3120 A
3498(=)S
3582(r;)S
2745 V
(22671)210 1122 A
1776(})S
2835 V
(22672)210 1122 A
1524(})S
2925 V
(22673)210 1122 A
3015 V
(22674)210 1122 A
(bp->b_dirt)420 1524 A
1986(=)S
(CLEAN;)252 2070 A
3105 V
(22675)210 1122 A
1440(})S
3285 V
(22677)210 1122 A
(/*===========================================================================*)3276 1440 A
3375 V
(22678)210 1122 A
1482(*)S
(invalidate)420 2784 A
4674(*)S
3465 V
(22679)210 1122 A
(*===========================================================================*/)3276 1482 A
3555 V
(22680)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(invalidate\(device\))756 1944 A
3645 V
(22681)210 1122 A
(dev_t)210 1440 A
(device;)294 1692 A
2784(/*)S
(device)252 2910 A
(whose)210 3204 A
(blocks)252 3456 A
(are)126 3750 A
3918(to)S
4044(be)S
(purged)252 4170 A
4464(*/)S
3735 V
(22682)210 1122 A
1440({)S
3825 V
(22683)210 1122 A
1440(/*)S
(Remove)252 1566 A
(all)126 1860 A
(the)126 2028 A
(blocks)252 2196 A
(belonging)378 2490 A
2910(to)S
(some)168 3036 A
(device)252 3246 A
(from)168 3540 A
(the)126 3750 A
(cache.)252 3918 A
4212(*/)S
3915 V
(22684)210 1122 A
4005 V
(22685)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(buf)126 2196 A
(*bp;)168 2364 A
4095 V
(22686)210 1122 A
4185 V
(22687)210 1122 A
(for)126 1524 A
(\(bp)126 1692 A
1860(=)S
(&buf[0];)336 1944 A
2322(bp)S
2448(<)S
(&buf[NR_BUFS];)588 2532 A
(bp++\))210 3162 A
4275 V
(22688)210 1122 A
1776(if)S
(\(bp->b_dev)420 1902 A
2364(==)S
(device\))294 2490 A
(bp->b_dev)378 2826 A
3246(=)S
(NO_DEV;)294 3330 A
4365 V
(22689)210 1122 A
1440(})S
4545 V
(22691)210 1122 A
(/*===========================================================================*)3276 1440 A
4635 V
(22692)210 1122 A
1482(*)S
(flushall)336 2784 A
4674(*)S
4725 V
(22693)210 1122 A
(*===========================================================================*/)3276 1482 A
4815 V
(22694)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(flushall\(dev\))546 1944 A
4905 V
(22695)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
2784(/*)S
(device)252 2910 A
3204(to)S
(flush)210 3330 A
3582(*/)S
4995 V
(22696)210 1122 A
1440({)S
5085 V
(22697)210 1122 A
1440(/*)S
(Flush)210 1566 A
(all)126 1818 A
(dirty)210 1986 A
(blocks)252 2238 A
(for)126 2532 A
(one)126 2700 A
(device.)294 2868 A
3204(*/)S
5175 V
(22698)210 1122 A
5265 V
(22699)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(buf)126 2196 A
(*bp;)168 2364 A
5355 V
(22700)210 1122 A
(static)252 1524 A
(struct)252 1818 A
(buf)126 2112 A
(*dirty[NR_BUFS];)672 2280 A
3120(/*)S
(static)252 3246 A
3540(so)S
3666(it)S
(isn't)210 3792 A
4044(on)S
(stack)210 4170 A
4422(*/)S
5445 V
(22701)210 1122 A
(int)126 1524 A
(ndirty;)294 1692 A
5535 V
(22702)210 1122 A
5625 V
(22703)210 1122 A
(for)126 1524 A
(\(bp)126 1692 A
1860(=)S
(&buf[0],)336 1944 A
(ndirty)252 2322 A
2616(=)S
2700(0;)S
2826(bp)S
2952(<)S
(&buf[NR_BUFS];)588 3036 A
(bp++\))210 3666 A
5715 V
(22704)210 1122 A
1776(if)S
(\(bp->b_dirt)462 1902 A
2406(==)S
(DIRTY)210 2532 A
2784(&&)S
(bp->b_dev)378 2910 A
3330(==)S
(dev\))168 3456 A
(dirty[ndirty++])630 3666 A
4338(=)S
(bp;)126 4422 A
5805 V
(22705)210 1122 A
(rw_scattered\(dev,)714 1524 A
(dirty,)252 2280 A
(ndirty,)294 2574 A
(WRITING\);)378 2910 A
5895 V
(22706)210 1122 A
1440(})S
6075 V
(22708)210 1122 A
(/*===========================================================================*)3276 1440 A
6165 V
(22709)210 1122 A
1482(*)S
(rw_scattered)504 2784 A
4674(*)S
6255 V
(22710)210 1122 A
(*===========================================================================*/)3276 1482 A
6345 V
(22711)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(rw_scattered\(dev,)714 1944 A
(bufq,)210 2700 A
(bufqsize,)378 2952 A
(rw_flag\))336 3372 A
6435 V
(22712)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
2784(/*)S
(major-minor)462 2910 A
(device)252 3414 A
(number)252 3708 A
4002(*/)S
6525 V
(22713)210 1122 A
(struct)252 1440 A
(buf)126 1734 A
(**bufq;)294 1902 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(array)210 3372 A
3624(of)S
(buffers)294 3750 A
4086(*/)S
6615 V
(22714)210 1122 A
(int)126 1440 A
(bufqsize;)378 1608 A
2784(/*)S
(number)252 2910 A
3204(of)S
(buffers)294 3330 A
3666(*/)S
6705 V
(22715)210 1122 A
(int)126 1440 A
(rw_flag;)336 1608 A
2784(/*)S
(READING)294 2910 A
3246(or)S
(WRITING)294 3372 A
3708(*/)S
6795 V
(22716)210 1122 A
1440({)S
6885 V
(22717)210 1122 A
1440(/*)S
(Read)168 1566 A
1776(or)S
(write)210 1902 A
(scattered)378 2154 A
(data)168 2574 A
(from)168 2784 A
2994(a)S
(device.)294 3078 A
3414(*/)S
6975 V
(22718)210 1122 A
7065 V
(22719)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(buf)126 2196 A
(*bp;)168 2364 A
8418 V
EP
%%Page: 301 301
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2368(File:)S
(servers/fs/cache.c)790 2601 A
12 B
(301)180 4500 A
1755 V
7 LST
(22720)210 1122 A
(int)126 1524 A
(gap;)168 1692 A
1845 V
(22721)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(i;)S
1935 V
(22722)210 1122 A
(register)336 1524 A
(iovec_t)294 1902 A
(*iop;)210 2238 A
2025 V
(22723)210 1122 A
(static)252 1524 A
(iovec_t)294 1818 A
(iovec[NR_IOREQS];)714 2154 A
2952(/*)S
(static)252 3078 A
3372(so)S
3498(it)S
(isn't)210 3624 A
3876(on)S
(stack)210 4002 A
4254(*/)S
2115 V
(22724)210 1122 A
(int)126 1524 A
1692(j,)S
1818(r;)S
2205 V
(22725)210 1122 A
(int)126 1524 A
(block_size;)462 1692 A
2295 V
(22726)210 1122 A
2385 V
(22727)210 1122 A
(block_size)420 1524 A
1986(=)S
(get_block_size\(dev\);)840 2070 A
2475 V
(22728)210 1122 A
2565 V
(22729)210 1122 A
1524(/*)S
(\(Shell\))294 1650 A
(sort)168 1986 A
(buffers)294 2196 A
2532(on)S
(b_blocknr.)420 2658 A
3120(*/)S
2655 V
(22730)210 1122 A
(gap)126 1524 A
1692(=)S
1776(1;)S
2745 V
(22731)210 1122 A
1524(do)S
2835 V
(22732)210 1122 A
(gap)126 1776 A
1944(=)S
2028(3)S
2112(*)S
(gap)126 2196 A
2364(+)S
2448(1;)S
2925 V
(22733)210 1122 A
(while)210 1524 A
(\(gap)168 1776 A
1986(<=)S
(bufqsize\);)420 2112 A
3015 V
(22734)210 1122 A
(while)210 1524 A
(\(gap)168 1776 A
1986(!=)S
2112(1\))S
2238({)S
3105 V
(22735)210 1122 A
(gap)126 1776 A
1944(/=)S
2070(3;)S
3195 V
(22736)210 1122 A
(for)126 1776 A
1944(\(j)S
2070(=)S
(gap;)168 2154 A
2364(j)S
2448(<)S
(bufqsize;)378 2532 A
(j++\))168 2952 A
3162({)S
3285 V
(22737)210 1122 A
(for)126 2112 A
2280(\(i)S
2406(=)S
2490(j)S
2574(-)S
(gap;)168 2658 A
3375 V
(22738)210 1122 A
2322(i)S
2406(>=)S
2532(0)S
2616(&&)S
(bufq[i]->b_blocknr)756 2742 A
3540(>)S
(bufq[i)252 3624 A
3918(+)S
(gap]->b_blocknr;)672 4002 A
3465 V
(22739)210 1122 A
2322(i)S
2406(-=)S
(gap\))168 2532 A
2742({)S
3555 V
(22740)210 1122 A
2448(bp)S
2574(=)S
(bufq[i];)336 2658 A
3645 V
(22741)210 1122 A
(bufq[i])294 2448 A
2784(=)S
(bufq[i)252 2868 A
3162(+)S
(gap];)210 3246 A
3735 V
(22742)210 1122 A
(bufq[i)252 2448 A
2742(+)S
(gap])168 2826 A
3036(=)S
(bp;)126 3120 A
3825 V
(22743)210 1122 A
2112(})S
3915 V
(22744)210 1122 A
1776(})S
4005 V
(22745)210 1122 A
1524(})S
4095 V
(22746)210 1122 A
4185 V
(22747)210 1122 A
1524(/*)S
(Set)126 1650 A
1818(up)S
(I/O)126 1944 A
(vector)252 2112 A
(and)126 2406 A
2574(do)S
(I/O.)168 2700 A
(The)126 2952 A
(result)252 3120 A
3414(of)S
(dev_io)252 3540 A
3834(is)S
3960(OK)S
4086(if)S
(everything)420 4212 A
4275 V
(22748)210 1122 A
1566(*)S
(went)168 1650 A
(fine,)210 1860 A
(otherwise)378 2112 A
(the)126 2532 A
(error)210 2700 A
(code)168 2952 A
(for)126 3162 A
(the)126 3330 A
(first)210 3498 A
(failed)252 3750 A
(transfer.)378 4044 A
4365 V
(22749)210 1122 A
1566(*/)S
4455 V
(22750)210 1122 A
(while)210 1524 A
(\(bufqsize)378 1776 A
2196(>)S
2280(0\))S
2406({)S
4545 V
(22751)210 1122 A
(for)126 1776 A
1944(\(j)S
2070(=)S
2154(0,)S
(iop)126 2280 A
2448(=)S
(iovec;)252 2532 A
2826(j)S
2910(<)S
(NR_IOREQS)378 2994 A
3414(&&)S
3540(j)S
3624(<)S
(bufqsize;)378 3708 A
(j++,)168 4128 A
(iop++\))252 4338 A
4632({)S
4635 V
(22752)210 1122 A
2112(bp)S
2238(=)S
(bufq[j];)336 2322 A
4725 V
(22753)210 1122 A
2112(if)S
(\(bp->b_blocknr)588 2238 A
2868(!=)S
(bufq[0]->b_blocknr)756 2994 A
3792(+)S
3876(j\))S
(break;)252 4002 A
4815 V
(22754)210 1122 A
(iop->iov_addr)546 2112 A
2700(=)S
(\(vir_bytes\))462 2784 A
(bp->b_data;)462 3288 A
4905 V
(22755)210 1122 A
(iop->iov_size)546 2112 A
2700(=)S
(block_size;)462 2784 A
4995 V
(22756)210 1122 A
1776(})S
5085 V
(22757)210 1122 A
1776(r)S
1860(=)S
(dev_io\(rw_flag)588 1944 A
2574(==)S
(WRITING)294 2700 A
3036(?)S
(DEV_SCATTER)462 3120 A
3624(:)S
(DEV_GATHER,)462 3708 A
5175 V
(22758)210 1122 A
(dev,)168 2112 A
(FS_PROC_NR,)462 2322 A
(iovec,)252 2826 A
5265 V
(22759)210 1122 A
(\(off_t\))294 2112 A
(bufq[0]->b_blocknr)756 2448 A
3246(*)S
(block_size,)462 3330 A
3834(j,)S
(0\);)126 3960 A
5355 V
(22760)210 1122 A
5445 V
(22761)210 1122 A
1776(/*)S
(Harvest)294 1902 A
(the)126 2238 A
(results.)336 2406 A
(Dev_io)252 2826 A
(reports)294 3120 A
(the)126 3456 A
(first)210 3624 A
(error)210 3876 A
4128(it)S
(may)126 4254 A
(have)168 4422 A
5535 V
(22762)210 1122 A
1818(*)S
(encountered,)504 1902 A
(but)126 2448 A
2616(we)S
(only)168 2742 A
(care)168 2952 A
3162(if)S
(it's)168 3288 A
(the)126 3498 A
(first)210 3666 A
(block)210 3918 A
(that)168 4170 A
(failed.)294 4380 A
5625 V
(22763)210 1122 A
1818(*/)S
5715 V
(22764)210 1122 A
(for)126 1776 A
1944(\(i)S
2070(=)S
2154(0,)S
(iop)126 2280 A
2448(=)S
(iovec;)252 2532 A
2826(i)S
2910(<)S
2994(j;)S
(i++,)168 3120 A
(iop++\))252 3330 A
3624({)S
5805 V
(22765)210 1122 A
2112(bp)S
2238(=)S
(bufq[i];)336 2322 A
5895 V
(22766)210 1122 A
2112(if)S
(\(iop->iov_size)588 2238 A
2868(!=)S
2994(0\))S
3120({)S
5985 V
(22767)210 1122 A
2448(/*)S
(Transfer)336 2574 A
(failed.)294 2952 A
3288(An)S
(error?)252 3414 A
3708(Do)S
3834(we)S
(care?)210 3960 A
4212(*/)S
6075 V
(22768)210 1122 A
2448(if)S
2574(\(r)S
2700(!=)S
2826(OK)S
2952(&&)S
3078(i)S
3162(==)S
3288(0\))S
3414({)S
6165 V
(22769)210 1122 A
(printf\()294 2784 A
6255 V
(22770)210 1122 A
("fs:)168 2784 A
(I/O)126 2994 A
(error)210 3162 A
3414(on)S
(device)252 3540 A
(%d/%d,)252 3834 A
(block)210 4128 A
(%lu\\n",)294 4380 A
6345 V
(22771)210 1122 A
(\(dev>>MAJOR\)&BYTE,)756 3120 A
(\(dev>>MINOR\)&BYTE,)756 3918 A
6435 V
(22772)210 1122 A
(bp->b_blocknr\);)630 3120 A
6525 V
(22773)210 1122 A
(bp->b_dev)378 2784 A
3204(=)S
(NO_DEV;)294 3288 A
3792(/*)S
(invalidate)420 3918 A
(block)210 4380 A
4632(*/)S
6615 V
(22774)210 1122 A
2448(})S
6705 V
(22775)210 1122 A
(break;)252 2448 A
6795 V
(22776)210 1122 A
2112(})S
6885 V
(22777)210 1122 A
2112(if)S
(\(rw_flag)336 2238 A
2616(==)S
(READING\))336 2742 A
3120({)S
6975 V
(22778)210 1122 A
(bp->b_dev)378 2448 A
2868(=)S
(dev;)168 2952 A
3456(/*)S
(validate)336 3582 A
(block)210 3960 A
4212(*/)S
7065 V
(22779)210 1122 A
(put_block\(bp,)546 2448 A
(PARTIAL_DATA_BLOCK\);)840 3036 A
8418 V
EP
%%Page: 302 302
BP
/slant 0 def
/height 0 def
1485 V
12 B
(302)180 1080 A
11 R
2368(File:)S
(servers/fs/cache.c)790 2601 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(22780)210 1122 A
2112(})S
(else)168 2196 A
2406({)S
1845 V
(22781)210 1122 A
(bp->b_dirt)420 2448 A
2910(=)S
(CLEAN;)252 2994 A
1935 V
(22782)210 1122 A
2112(})S
2025 V
(22783)210 1122 A
1776(})S
2115 V
(22784)210 1122 A
(bufq)168 1776 A
1986(+=)S
2112(i;)S
2205 V
(22785)210 1122 A
(bufqsize)336 1776 A
2154(-=)S
2280(i;)S
2295 V
(22786)210 1122 A
1776(if)S
(\(rw_flag)336 1902 A
2280(==)S
(READING\))336 2406 A
2784({)S
2385 V
(22787)210 1122 A
2112(/*)S
(Don't)210 2238 A
(bother)252 2490 A
(reading)294 2784 A
(more)168 3120 A
(than)168 3330 A
(the)126 3540 A
(device)252 3708 A
4002(is)S
(willing)294 4128 A
4464(to)S
2475 V
(22788)210 1122 A
2154(*)S
(give)168 2238 A
2448(at)S
(this)168 2574 A
(time.)210 2784 A
(Don't)210 3078 A
(forget)252 3330 A
3624(to)S
(release)294 3750 A
(those)210 4086 A
(extras.)294 4338 A
2565 V
(22789)210 1122 A
2154(*/)S
2655 V
(22790)210 1122 A
(while)210 2112 A
(\(bufqsize)378 2364 A
2784(>)S
2868(0\))S
2994({)S
2745 V
(22791)210 1122 A
(put_block\(*bufq++,)756 2448 A
(PARTIAL_DATA_BLOCK\);)840 3246 A
2835 V
(22792)210 1122 A
(bufqsize--;)462 2448 A
2925 V
(22793)210 1122 A
2112(})S
3015 V
(22794)210 1122 A
1776(})S
3105 V
(22795)210 1122 A
1776(if)S
(\(rw_flag)336 1902 A
2280(==)S
(WRITING)294 2406 A
2742(&&)S
2868(i)S
2952(==)S
3078(0\))S
3204({)S
3195 V
(22796)210 1122 A
2112(/*)S
(We're)210 2238 A
(not)126 2490 A
(making)252 2658 A
(progress,)378 2952 A
(this)168 3372 A
(means)210 3582 A
3834(we)S
(might)210 3960 A
(keep)168 4212 A
3285 V
(22797)210 1122 A
2154(*)S
(looping.)336 2238 A
(Buffers)294 2616 A
(remain)252 2952 A
(dirty)210 3246 A
3498(if)S
(un-written.)462 3624 A
(Buffers)294 4128 A
(are)126 4464 A
3375 V
(22798)210 1122 A
2154(*)S
(lost)168 2238 A
2448(if)S
(invalidate\(\)d)546 2574 A
3162(or)S
(LRU-removed)462 3288 A
(while)210 3792 A
(dirty.)252 4044 A
(This)168 4338 A
3465 V
(22799)210 1122 A
2154(*)S
2238(is)S
(better)252 2364 A
(than)168 2658 A
(keeping)294 2868 A
(unwritable)420 3204 A
(blocks)252 3666 A
(around)252 3960 A
(forever..)378 4254 A
3555 V
(22800)210 1122 A
2154(*/)S
3645 V
(22801)210 1122 A
(break;)252 2112 A
3735 V
(22802)210 1122 A
1776(})S
3825 V
(22803)210 1122 A
1524(})S
3915 V
(22804)210 1122 A
1440(})S
4095 V
(22806)210 1122 A
(/*===========================================================================*)3276 1440 A
4185 V
(22807)210 1122 A
1482(*)S
(rm_lru)252 2784 A
4674(*)S
4275 V
(22808)210 1122 A
(*===========================================================================*/)3276 1482 A
4365 V
(22809)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(rm_lru\(bp\))420 1986 A
4455 V
(22810)210 1122 A
(struct)252 1440 A
(buf)126 1734 A
(*bp;)168 1902 A
4545 V
(22811)210 1122 A
1440({)S
4635 V
(22812)210 1122 A
1440(/*)S
(Remove)252 1566 A
1860(a)S
(block)210 1944 A
(from)168 2196 A
(its)126 2406 A
(LRU)126 2574 A
(chain.)252 2742 A
3036(*/)S
4725 V
(22813)210 1122 A
(struct)252 1524 A
(buf)126 1818 A
(*next_ptr,)420 1986 A
(*prev_ptr;)420 2448 A
4815 V
(22814)210 1122 A
4905 V
(22815)210 1122 A
(bufs_in_use++;)588 1524 A
4995 V
(22816)210 1122 A
(next_ptr)336 1524 A
1902(=)S
(bp->b_next;)462 1986 A
2784(/*)S
(successor)378 2910 A
3330(on)S
(LRU)126 3456 A
(chain)210 3624 A
3876(*/)S
5085 V
(22817)210 1122 A
(prev_ptr)336 1524 A
1902(=)S
(bp->b_prev;)462 1986 A
2784(/*)S
(predecessor)462 2910 A
3414(on)S
(LRU)126 3540 A
(chain)210 3708 A
3960(*/)S
5175 V
(22818)210 1122 A
1524(if)S
(\(prev_ptr)378 1650 A
2070(!=)S
(NIL_BUF\))336 2196 A
5265 V
(22819)210 1122 A
(prev_ptr->b_next)672 1776 A
2490(=)S
(next_ptr;)378 2574 A
5355 V
(22820)210 1122 A
(else)168 1524 A
5445 V
(22821)210 1122 A
(front)210 1776 A
2028(=)S
(next_ptr;)378 2112 A
2784(/*)S
(this)168 2910 A
(block)210 3120 A
(was)126 3372 A
3540(at)S
(front)210 3666 A
3918(of)S
(chain)210 4044 A
4296(*/)S
5535 V
(22822)210 1122 A
5625 V
(22823)210 1122 A
1524(if)S
(\(next_ptr)378 1650 A
2070(!=)S
(NIL_BUF\))336 2196 A
5715 V
(22824)210 1122 A
(next_ptr->b_prev)672 1776 A
2490(=)S
(prev_ptr;)378 2574 A
5805 V
(22825)210 1122 A
(else)168 1524 A
5895 V
(22826)210 1122 A
(rear)168 1776 A
1986(=)S
(prev_ptr;)378 2070 A
2784(/*)S
(this)168 2910 A
(block)210 3120 A
(was)126 3372 A
3540(at)S
(rear)168 3666 A
3876(of)S
(chain)210 4002 A
4254(*/)S
5985 V
(22827)210 1122 A
1440(})S
6345 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6435 V
(servers/fs/inode.c)756 2676 A
6525 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6705 V
(22900)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(manages)294 1986 A
(the)126 2322 A
(inode)210 2490 A
(table.)252 2742 A
(There)210 3078 A
(are)126 3330 A
(procedures)420 3498 A
3960(to)S
(allocate)336 4086 A
(and)126 4464 A
6795 V
(22901)210 1122 A
1482(*)S
(deallocate)420 1566 A
(inodes,)294 2028 A
(acquire,)336 2364 A
(erase,)252 2742 A
(and)126 3036 A
(release)294 3204 A
(them,)210 3540 A
(and)126 3792 A
(read)168 3960 A
(and)126 4170 A
(write)210 4338 A
6885 V
(22902)210 1122 A
1482(*)S
(them)168 1566 A
(from)168 1776 A
(the)126 1986 A
(disk.)210 2154 A
6975 V
(22903)210 1122 A
1482(*)S
7065 V
(22904)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are)126 2910 A
8418 V
EP
%%Page: 303 303
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2373(File:)S
(servers/fs/inode.c)781 2606 A
12 B
(303)180 4500 A
1755 V
7 LST
(22905)210 1122 A
1482(*)S
(get_inode:)420 1650 A
(search)252 2238 A
(inode)210 2532 A
(table)210 2784 A
(for)126 3036 A
3204(a)S
(given)210 3288 A
(inode;)252 3540 A
3834(if)S
(not)126 3960 A
(there,)252 4128 A
1845 V
(22906)210 1122 A
1482(*)S
(read)168 2238 A
2448(it)S
1935 V
(22907)210 1122 A
1482(*)S
(put_inode:)420 1650 A
(indicate)336 2238 A
(that)168 2616 A
2826(an)S
(inode)210 2952 A
3204(is)S
3330(no)S
(longer)252 3456 A
(needed)252 3750 A
4044(in)S
(memory)252 4170 A
2025 V
(22908)210 1122 A
1482(*)S
(alloc_inode:)504 1650 A
(allocate)336 2238 A
2616(a)S
(new,)168 2700 A
(unused)252 2910 A
(inode)210 3204 A
2115 V
(22909)210 1122 A
1482(*)S
(wipe_inode:)462 1650 A
(erase)210 2238 A
(some)168 2490 A
(fields)252 2700 A
2994(of)S
3120(a)S
(newly)210 3204 A
(allocated)378 3456 A
(inode)210 3876 A
2205 V
(22910)210 1122 A
1482(*)S
(free_inode:)462 1650 A
(mark)168 2238 A
2448(an)S
(inode)210 2574 A
2826(as)S
(available)378 2952 A
(for)126 3372 A
3540(a)S
(new)126 3624 A
(file)168 3792 A
2295 V
(22911)210 1122 A
1482(*)S
(update_times:)546 1650 A
(update)252 2238 A
(atime,)252 2532 A
(ctime,)252 2826 A
(and)126 3120 A
(mtime)210 3288 A
2385 V
(22912)210 1122 A
1482(*)S
(rw_inode:)378 1650 A
(read)168 2238 A
2448(a)S
(disk)168 2532 A
(block)210 2742 A
(and)126 2994 A
(extract)294 3162 A
3498(an)S
(inode,)252 3624 A
3918(or)S
(corresp.)336 4044 A
(write)210 4422 A
2475 V
(22913)210 1122 A
1482(*)S
(old_icopy:)420 1650 A
(copy)168 2238 A
(to/from)294 2448 A
(in-core)294 2784 A
(inode)210 3120 A
(struct)252 3372 A
(and)126 3666 A
(disk)168 3834 A
(inode)210 4044 A
(\(V1.x\))252 4296 A
2565 V
(22914)210 1122 A
1482(*)S
(new_icopy:)420 1650 A
(copy)168 2238 A
(to/from)294 2448 A
(in-core)294 2784 A
(inode)210 3120 A
(struct)252 3372 A
(and)126 3666 A
(disk)168 3834 A
(inode)210 4044 A
(\(V2.x\))252 4296 A
2655 V
(22915)210 1122 A
1482(*)S
(dup_inode:)420 1650 A
(indicate)336 2238 A
(that)168 2616 A
(someone)294 2826 A
(else)168 3162 A
3372(is)S
(using)210 3498 A
3750(an)S
(inode)210 3876 A
(table)210 4128 A
(entry)210 4380 A
2745 V
(22916)210 1122 A
1482(*/)S
2835 V
(22917)210 1122 A
2925 V
(22918)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
3015 V
(22919)210 1122 A
(#include)336 1440 A
("buf.h")294 1818 A
3105 V
(22920)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
3195 V
(22921)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
3285 V
(22922)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
3375 V
(22923)210 1122 A
(#include)336 1440 A
("super.h")378 1818 A
3465 V
(22924)210 1122 A
3555 V
(22925)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(old_icopy,)420 2490 A
(\(struct)294 2952 A
(inode)210 3288 A
(*rip,)210 3540 A
(d1_inode)336 3792 A
(*dip,)210 4170 A
3645 V
(22926)210 1122 A
(int)126 3456 A
(direction,)420 3624 A
(int)126 4086 A
(norm\)\);)294 4254 A
3735 V
(22927)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(new_icopy,)420 2490 A
(\(struct)294 2952 A
(inode)210 3288 A
(*rip,)210 3540 A
(d2_inode)336 3792 A
(*dip,)210 4170 A
3825 V
(22928)210 1122 A
(int)126 3456 A
(direction,)420 3624 A
(int)126 4086 A
(norm\)\);)294 4254 A
3915 V
(22929)210 1122 A
4005 V
(22930)210 1122 A
(/*===========================================================================*)3276 1440 A
4095 V
(22931)210 1122 A
1482(*)S
(get_inode)378 2784 A
4674(*)S
4185 V
(22932)210 1122 A
(*===========================================================================*/)3276 1482 A
4275 V
(22933)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(inode)210 2028 A
(*get_inode\(dev,)630 2280 A
(numb\))210 2952 A
4365 V
(22934)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
2784(/*)S
(device)252 2910 A
3204(on)S
(which)210 3330 A
(inode)210 3582 A
(resides)294 3834 A
4170(*/)S
4455 V
(22935)210 1122 A
(int)126 1440 A
(numb;)210 1608 A
2784(/*)S
(inode)210 2910 A
(number)252 3162 A
(\(ANSI:)252 3456 A
(may)126 3750 A
(not)126 3918 A
4086(be)S
(unshort\))336 4212 A
4590(*/)S
4545 V
(22936)210 1122 A
1440({)S
4635 V
(22937)210 1122 A
1440(/*)S
(Find)168 1566 A
1776(a)S
(slot)168 1860 A
2070(in)S
(the)126 2196 A
(inode)210 2364 A
(table,)252 2616 A
(load)168 2910 A
(the)126 3120 A
(specified)378 3288 A
(inode)210 3708 A
(into)168 3960 A
(it,)126 4170 A
(and)126 4338 A
4725 V
(22938)210 1122 A
1482(*)S
(return)252 1566 A
1860(a)S
(pointer)294 1944 A
2280(to)S
(the)126 2406 A
(slot.)210 2574 A
2868(If)S
('dev')210 2994 A
3246(==)S
(NO_DEV,)294 3372 A
(just)168 3708 A
(return)252 3918 A
4212(a)S
(free)168 4296 A
(slot.)210 4506 A
4815 V
(22939)210 1122 A
1482(*/)S
4905 V
(22940)210 1122 A
4995 V
(22941)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip,)210 2448 A
(*xp;)168 2700 A
5085 V
(22942)210 1122 A
5175 V
(22943)210 1122 A
1524(/*)S
(Search)252 1650 A
(the)126 1944 A
(inode)210 2112 A
(table)210 2364 A
(both)168 2616 A
(for)126 2826 A
(\(dev,)210 2994 A
(numb\))210 3246 A
(and)126 3498 A
3666(a)S
(free)168 3750 A
(slot.)210 3960 A
4212(*/)S
5265 V
(22944)210 1122 A
1524(xp)S
1650(=)S
(NIL_INODE;)420 1734 A
5355 V
(22945)210 1122 A
(for)126 1524 A
(\(rip)168 1692 A
1902(=)S
(&inode[0];)420 1986 A
(rip)126 2448 A
2616(<)S
(&inode[NR_INODES];)756 2700 A
(rip++\))252 3498 A
3792({)S
5445 V
(22946)210 1122 A
1776(if)S
(\(rip->i_count)546 1902 A
2490(>)S
2574(0\))S
2700({)S
2784(/*)S
(only)168 2910 A
(check)210 3120 A
(used)168 3372 A
(slots)210 3582 A
(for)126 3834 A
(\(dev,)210 4002 A
(numb\))210 4254 A
4506(*/)S
5535 V
(22947)210 1122 A
2112(if)S
(\(rip->i_dev)462 2238 A
2742(==)S
(dev)126 2868 A
3036(&&)S
(rip->i_num)420 3162 A
3624(==)S
(numb\))210 3750 A
4002({)S
5625 V
(22948)210 1122 A
2448(/*)S
(This)168 2574 A
2784(is)S
(the)126 2910 A
(inode)210 3078 A
(that)168 3330 A
3540(we)S
(are)126 3666 A
(looking)294 3834 A
(for.)168 4170 A
4380(*/)S
5715 V
(22949)210 1122 A
(rip->i_count++;)630 2448 A
5805 V
(22950)210 1122 A
(return\(rip\);)504 2448 A
3120(/*)S
(\(dev,)210 3246 A
(numb\))210 3498 A
(found)210 3750 A
4002(*/)S
5895 V
(22951)210 1122 A
2112(})S
5985 V
(22952)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
6075 V
(22953)210 1122 A
2112(xp)S
2238(=)S
(rip;)168 2322 A
2784(/*)S
(remember)336 2910 A
(this)168 3288 A
(free)168 3498 A
(slot)168 3708 A
(for)126 3918 A
(later)210 4086 A
4338(*/)S
6165 V
(22954)210 1122 A
1776(})S
6255 V
(22955)210 1122 A
1524(})S
6345 V
(22956)210 1122 A
6435 V
(22957)210 1122 A
1524(/*)S
(Inode)210 1650 A
1902(we)S
(want)168 2028 A
2238(is)S
(not)126 2364 A
(currently)378 2532 A
2952(in)S
(use.)168 3078 A
(Did)126 3330 A
3498(we)S
(find)168 3624 A
3834(a)S
(free)168 3918 A
(slot?)210 4128 A
4380(*/)S
6525 V
(22958)210 1122 A
1524(if)S
(\(xp)126 1650 A
1818(==)S
(NIL_INODE\))420 1944 A
2406({)S
2784(/*)S
(inode)210 2910 A
(table)210 3162 A
(completely)420 3414 A
(full)168 3876 A
4086(*/)S
6615 V
(22959)210 1122 A
(err_code)336 1776 A
2154(=)S
(ENFILE;)294 2238 A
6705 V
(22960)210 1122 A
(return\(NIL_INODE\);)756 1776 A
6795 V
(22961)210 1122 A
1524(})S
6885 V
(22962)210 1122 A
6975 V
(22963)210 1122 A
1524(/*)S
1650(A)S
(free)168 1734 A
(inode)210 1944 A
(slot)168 2196 A
(has)126 2406 A
(been)168 2574 A
(located.)336 2784 A
(Load)168 3204 A
(the)126 3414 A
(inode)210 3582 A
(into)168 3834 A
(it.)126 4044 A
4212(*/)S
7065 V
(22964)210 1122 A
(xp->i_dev)378 1524 A
1944(=)S
(dev;)168 2028 A
8418 V
EP
%%Page: 304 304
BP
/slant 0 def
/height 0 def
1485 V
12 B
(304)180 1080 A
11 R
2373(File:)S
(servers/fs/inode.c)781 2606 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(22965)210 1122 A
(xp->i_num)378 1524 A
1944(=)S
(numb;)210 2028 A
1845 V
(22966)210 1122 A
(xp->i_count)462 1524 A
2028(=)S
2112(1;)S
1935 V
(22967)210 1122 A
1524(if)S
(\(dev)168 1650 A
1860(!=)S
(NO_DEV\))294 1986 A
(rw_inode\(xp,)504 2322 A
(READING\);)378 2868 A
3456(/*)S
(get)126 3582 A
(inode)210 3750 A
(from)168 4002 A
(disk)168 4212 A
4422(*/)S
2025 V
(22968)210 1122 A
(xp->i_update)504 1524 A
2070(=)S
2154(0;)S
2784(/*)S
(all)126 2910 A
(the)126 3078 A
(times)210 3246 A
(are)126 3498 A
(initially)378 3666 A
(up-to-date)420 4086 A
4548(*/)S
2115 V
(22969)210 1122 A
2205 V
(22970)210 1122 A
(return\(xp\);)462 1524 A
2295 V
(22971)210 1122 A
1440(})S
2475 V
(22973)210 1122 A
(/*===========================================================================*)3276 1440 A
2565 V
(22974)210 1122 A
1482(*)S
(put_inode)378 2784 A
4674(*)S
2655 V
(22975)210 1122 A
(*===========================================================================*/)3276 1482 A
2745 V
(22976)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(put_inode\(rip\))588 1944 A
2835 V
(22977)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(inode)210 3372 A
3624(to)S
3750(be)S
(released)336 3876 A
4254(*/)S
2925 V
(22978)210 1122 A
1440({)S
3015 V
(22979)210 1122 A
1440(/*)S
(The)126 1566 A
(caller)252 1734 A
2028(is)S
2154(no)S
(longer)252 2280 A
(using)210 2574 A
(this)168 2826 A
(inode.)252 3036 A
3372(If)S
3498(no)S
(one)126 3624 A
(else)168 3792 A
4002(is)S
(using)210 4128 A
4380(it)S
(either)252 4506 A
3105 V
(22980)210 1122 A
1482(*)S
(write)210 1566 A
1818(it)S
(back)168 1944 A
2154(to)S
(the)126 2280 A
(disk)168 2448 A
(immediately.)504 2658 A
3246(If)S
3372(it)S
(has)126 3498 A
3666(no)S
(links,)252 3792 A
(truncate)336 4086 A
4464(it)S
(and)126 4590 A
3195 V
(22981)210 1122 A
1482(*)S
(return)252 1566 A
1860(it)S
1986(to)S
(the)126 2112 A
(pool)168 2280 A
2490(of)S
(available)378 2616 A
(inodes.)294 3036 A
3285 V
(22982)210 1122 A
1482(*/)S
3375 V
(22983)210 1122 A
3465 V
(22984)210 1122 A
1524(if)S
(\(rip)168 1650 A
1860(==)S
(NIL_INODE\))420 1986 A
(return;)294 2448 A
2784(/*)S
(checking)336 2910 A
(here)168 3288 A
3498(is)S
(easier)252 3624 A
(than)168 3918 A
4128(in)S
(caller)252 4254 A
4548(*/)S
3555 V
(22985)210 1122 A
1524(if)S
(\(--rip->i_count)630 1650 A
2322(==)S
2448(0\))S
2574({)S
2784(/*)S
(i_count)294 2910 A
3246(==)S
3372(0)S
(means)210 3456 A
3708(no)S
(one)126 3834 A
4002(is)S
(using)210 4128 A
4380(it)S
(now)126 4506 A
4674(*/)S
3645 V
(22986)210 1122 A
1776(if)S
(\(rip->i_nlinks)588 1902 A
2532(==)S
2658(0\))S
2784({)S
3735 V
(22987)210 1122 A
2112(/*)S
(i_nlinks)336 2238 A
2616(==)S
2742(0)S
(means)210 2826 A
(free)168 3078 A
(the)126 3288 A
(inode.)252 3456 A
3750(*/)S
3825 V
(22988)210 1122 A
(truncate\(rip\);)588 2112 A
2784(/*)S
(return)252 2910 A
(all)126 3204 A
(the)126 3372 A
(disk)168 3540 A
(blocks)252 3750 A
4044(*/)S
3915 V
(22989)210 1122 A
(rip->i_mode)462 2112 A
2616(=)S
(I_NOT_ALLOC;)504 2700 A
3456(/*)S
(clear)210 3582 A
(I_TYPE)252 3834 A
(field)210 4128 A
4380(*/)S
4005 V
(22990)210 1122 A
(rip->i_dirt)462 2112 A
2616(=)S
(DIRTY;)252 2700 A
4095 V
(22991)210 1122 A
(free_inode\(rip->i_dev,)924 2112 A
(rip->i_num\);)504 3078 A
4185 V
(22992)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
4275 V
(22993)210 1122 A
2112(if)S
(\(rip->i_pipe)504 2238 A
2784(==)S
(I_PIPE\))294 2910 A
(truncate\(rip\);)588 3246 A
4365 V
(22994)210 1122 A
1776(})S
4455 V
(22995)210 1122 A
(rip->i_pipe)462 1776 A
2280(=)S
(NO_PIPE;)336 2364 A
2784(/*)S
(should)252 2910 A
(always)252 3204 A
3498(be)S
(cleared)294 3624 A
3960(*/)S
4545 V
(22996)210 1122 A
1776(if)S
(\(rip->i_dirt)504 1902 A
2448(==)S
(DIRTY\))252 2574 A
(rw_inode\(rip,)546 2868 A
(WRITING\);)378 3456 A
4635 V
(22997)210 1122 A
1524(})S
4725 V
(22998)210 1122 A
1440(})S
4905 V
(23000)210 1122 A
(/*===========================================================================*)3276 1440 A
4995 V
(23001)210 1122 A
1482(*)S
(alloc_inode)462 2784 A
4674(*)S
5085 V
(23002)210 1122 A
(*===========================================================================*/)3276 1482 A
5175 V
(23003)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(inode)210 2028 A
(*alloc_inode\(dev_t)756 2280 A
(dev,)168 3078 A
(mode_t)252 3288 A
(bits\))210 3582 A
5265 V
(23004)210 1122 A
1440({)S
5355 V
(23005)210 1122 A
1440(/*)S
(Allocate)336 1566 A
1944(a)S
(free)168 2028 A
(inode)210 2238 A
2490(on)S
('dev',)252 2616 A
(and)126 2910 A
(return)252 3078 A
3372(a)S
(pointer)294 3456 A
3792(to)S
(it.)126 3918 A
4086(*/)S
5445 V
(23006)210 1122 A
5535 V
(23007)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
5625 V
(23008)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(super_block)462 2196 A
(*sp;)168 2700 A
5715 V
(23009)210 1122 A
(int)126 1524 A
(major,)252 1692 A
(minor,)252 1986 A
(inumb;)252 2280 A
5805 V
(23010)210 1122 A
(bit_t)210 1524 A
1776(b;)S
5895 V
(23011)210 1122 A
5985 V
(23012)210 1122 A
1524(sp)S
1650(=)S
(get_super\(dev\);)630 1734 A
2448(/*)S
(get)126 2574 A
(pointer)294 2742 A
3078(to)S
(super_block)462 3204 A
3708(*/)S
6075 V
(23013)210 1122 A
1524(if)S
(\(sp->s_rd_only\))630 1650 A
2322({)S
2448(/*)S
(can't)210 2574 A
(allocate)336 2826 A
3204(an)S
(inode)210 3330 A
3582(on)S
3708(a)S
(read)168 3792 A
(only)168 4002 A
(device.)294 4212 A
4548(*/)S
6165 V
(23014)210 1122 A
(err_code)336 1776 A
2154(=)S
(EROFS;)252 2238 A
6255 V
(23015)210 1122 A
(return\(NIL_INODE\);)756 1776 A
6345 V
(23016)210 1122 A
1524(})S
6435 V
(23017)210 1122 A
6525 V
(23018)210 1122 A
1524(/*)S
(Acquire)294 1650 A
1986(an)S
(inode)210 2112 A
(from)168 2364 A
(the)126 2574 A
(bit)126 2742 A
(map.)168 2910 A
3120(*/)S
6615 V
(23019)210 1122 A
1524(b)S
1608(=)S
(alloc_bit\(sp,)546 1692 A
(IMAP,)210 2280 A
(sp->s_isearch\);)630 2532 A
6705 V
(23020)210 1122 A
1524(if)S
1650(\(b)S
1776(==)S
(NO_BIT\))294 1902 A
2238({)S
6795 V
(23021)210 1122 A
(err_code)336 1776 A
2154(=)S
(ENFILE;)294 2238 A
6885 V
(23022)210 1122 A
(major)210 1776 A
2028(=)S
(\(int\))210 2112 A
(\(sp->s_dev)420 2364 A
2826(>>)S
(MAJOR\))252 2952 A
3246(&)S
(BYTE;)210 3330 A
6975 V
(23023)210 1122 A
(minor)210 1776 A
2028(=)S
(\(int\))210 2112 A
(\(sp->s_dev)420 2364 A
2826(>>)S
(MINOR\))252 2952 A
3246(&)S
(BYTE;)210 3330 A
7065 V
(23024)210 1122 A
(printf\("Out)462 1776 A
2280(of)S
(i-nodes)294 2406 A
2742(on)S
(%sdevice)336 2868 A
(%d/%d\\n",)378 3246 A
8418 V
EP
%%Page: 305 305
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2373(File:)S
(servers/fs/inode.c)781 2606 A
12 B
(305)180 4500 A
1755 V
7 LST
(23025)210 1122 A
(sp->s_dev)378 2112 A
2532(==)S
(root_dev)336 2658 A
3036(?)S
("root)210 3120 A
3372(")S
3456(:)S
("",)126 3540 A
(major,)252 3708 A
(minor\);)294 4002 A
1845 V
(23026)210 1122 A
(return\(NIL_INODE\);)756 1776 A
1935 V
(23027)210 1122 A
1524(})S
2025 V
(23028)210 1122 A
(sp->s_isearch)546 1524 A
2112(=)S
2196(b;)S
2784(/*)S
(next)168 2910 A
(time)168 3120 A
(start)210 3330 A
(here)168 3582 A
3792(*/)S
2115 V
(23029)210 1122 A
(inumb)210 1524 A
1776(=)S
(\(int\))210 1860 A
2112(b;)S
2784(/*)S
2910(be)S
(careful)294 3036 A
(not)126 3372 A
3540(to)S
(pass)168 3666 A
(unshort)294 3876 A
4212(as)S
(param)210 4338 A
4590(*/)S
2205 V
(23030)210 1122 A
2295 V
(23031)210 1122 A
1524(/*)S
(Try)126 1650 A
1818(to)S
(acquire)294 1944 A
2280(a)S
(slot)168 2364 A
2574(in)S
(the)126 2700 A
(inode)210 2868 A
(table.)252 3120 A
3414(*/)S
2385 V
(23032)210 1122 A
1524(if)S
(\(\(rip)210 1650 A
1902(=)S
(get_inode\(NO_DEV,)714 1986 A
(inumb\)\))294 2742 A
3078(==)S
(NIL_INODE\))420 3204 A
3666({)S
2475 V
(23033)210 1122 A
1776(/*)S
1902(No)S
(inode)210 2028 A
(table)210 2280 A
(slots)210 2532 A
(available.)420 2784 A
(Free)168 3288 A
(the)126 3498 A
(inode)210 3666 A
(just)168 3918 A
(allocated.)420 4128 A
4590(*/)S
2565 V
(23034)210 1122 A
(free_bit\(sp,)504 1776 A
(IMAP,)210 2322 A
(b\);)126 2574 A
2655 V
(23035)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
2745 V
(23036)210 1122 A
1776(/*)S
1902(An)S
(inode)210 2028 A
(slot)168 2280 A
2490(is)S
(available.)420 2616 A
(Put)126 3078 A
(the)126 3246 A
(inode)210 3414 A
(just)168 3666 A
(allocated)378 3876 A
(into)168 4296 A
(it.)126 4506 A
4674(*/)S
2835 V
(23037)210 1122 A
(rip->i_mode)462 1776 A
2280(=)S
(bits;)210 2364 A
3120(/*)S
(set)126 3246 A
3414(up)S
(RWX)126 3540 A
(bits)168 3708 A
3918(*/)S
2925 V
(23038)210 1122 A
(rip->i_nlinks)546 1776 A
2364(=)S
2448(0;)S
3120(/*)S
(initial)294 3246 A
3582(no)S
(links)210 3708 A
3960(*/)S
3015 V
(23039)210 1122 A
(rip->i_uid)420 1776 A
2238(=)S
(fp->fp_effuid;)588 2322 A
3120(/*)S
(file's)252 3246 A
(uid)126 3540 A
3708(is)S
(owner's)294 3834 A
4170(*/)S
3105 V
(23040)210 1122 A
(rip->i_gid)420 1776 A
2238(=)S
(fp->fp_effgid;)588 2322 A
3120(/*)S
(ditto)210 3246 A
(group)210 3498 A
3750(id)S
3876(*/)S
3195 V
(23041)210 1122 A
(rip->i_dev)420 1776 A
2238(=)S
(dev;)168 2322 A
3120(/*)S
(mark)168 3246 A
(which)210 3456 A
(device)252 3708 A
4002(it)S
4128(is)S
4254(on)S
4380(*/)S
3285 V
(23042)210 1122 A
(rip->i_ndzones)588 1776 A
2406(=)S
(sp->s_ndzones;)588 2490 A
3120(/*)S
(number)252 3246 A
3540(of)S
(direct)252 3666 A
(zones)210 3960 A
4212(*/)S
3375 V
(23043)210 1122 A
(rip->i_nindirs)588 1776 A
2406(=)S
(sp->s_nindirs;)588 2490 A
3120(/*)S
(number)252 3246 A
3540(of)S
(indirect)336 3666 A
(zones)210 4044 A
(per)126 4296 A
(blk*/)210 4464 A
3465 V
(23044)210 1122 A
(rip->i_sp)378 1776 A
2196(=)S
(sp;)126 2280 A
3120(/*)S
(pointer)294 3246 A
3582(to)S
(super)210 3708 A
(block)210 3960 A
4212(*/)S
3555 V
(23045)210 1122 A
3645 V
(23046)210 1122 A
1776(/*)S
(Fields)252 1902 A
(not)126 2196 A
(cleared)294 2364 A
(already)294 2700 A
(are)126 3036 A
(cleared)294 3204 A
3540(in)S
(wipe_inode\(\).)546 3666 A
(They)168 4296 A
(have)168 4506 A
3735 V
(23047)210 1122 A
1818(*)S
(been)168 1902 A
(put)126 2112 A
(there)210 2280 A
(because)294 2532 A
(truncate\(\))420 2868 A
(needs)210 3330 A
3582(to)S
(clear)210 3708 A
(the)126 3960 A
(same)168 4128 A
(fields)252 4338 A
4632(if)S
3825 V
(23048)210 1122 A
1818(*)S
(the)126 1902 A
(file)168 2070 A
(happens)294 2280 A
2616(to)S
2742(be)S
(open)168 2868 A
(while)210 3078 A
(being)210 3330 A
(truncated.)420 3582 A
4086(It)S
(saves)210 4212 A
(space)210 4464 A
3915 V
(23049)210 1122 A
1818(*)S
(not)126 1902 A
2070(to)S
(repeat)252 2196 A
(the)126 2490 A
(code)168 2658 A
(twice.)252 2868 A
4005 V
(23050)210 1122 A
1818(*/)S
4095 V
(23051)210 1122 A
(wipe_inode\(rip\);)672 1776 A
4185 V
(23052)210 1122 A
1524(})S
4275 V
(23053)210 1122 A
4365 V
(23054)210 1122 A
(return\(rip\);)504 1524 A
4455 V
(23055)210 1122 A
1440(})S
4635 V
(23057)210 1122 A
(/*===========================================================================*)3276 1440 A
4725 V
(23058)210 1122 A
1482(*)S
(wipe_inode)420 2784 A
4674(*)S
4815 V
(23059)210 1122 A
(*===========================================================================*/)3276 1482 A
4905 V
(23060)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(wipe_inode\(rip\))630 1944 A
4995 V
(23061)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(the)126 2910 A
(inode)210 3078 A
3330(to)S
3456(be)S
(erased)252 3582 A
3876(*/)S
5085 V
(23062)210 1122 A
1440({)S
5175 V
(23063)210 1122 A
1440(/*)S
(Erase)210 1566 A
(some)168 1818 A
(fields)252 2028 A
2322(in)S
(the)126 2448 A
(inode.)252 2616 A
(This)168 2952 A
(function)336 3162 A
3540(is)S
(called)252 3666 A
(from)168 3960 A
(alloc_inode\(\))546 4170 A
5265 V
(23064)210 1122 A
1482(*)S
(when)168 1566 A
1776(a)S
(new)126 1860 A
(inode)210 2028 A
2280(is)S
2406(to)S
2532(be)S
(allocated,)420 2658 A
(and)126 3120 A
(from)168 3288 A
(truncate\(\),)462 3498 A
(when)168 4002 A
4212(an)S
(existing)336 4338 A
5355 V
(23065)210 1122 A
1482(*)S
(inode)210 1566 A
1818(is)S
1944(to)S
2070(be)S
(truncated.)420 2196 A
5445 V
(23066)210 1122 A
1482(*/)S
5535 V
(23067)210 1122 A
5625 V
(23068)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(i;)S
5715 V
(23069)210 1122 A
5805 V
(23070)210 1122 A
(rip->i_size)462 1524 A
2028(=)S
2112(0;)S
5895 V
(23071)210 1122 A
(rip->i_update)546 1524 A
2112(=)S
(ATIME)210 2196 A
2448(|)S
(CTIME)210 2532 A
2784(|)S
(MTIME;)252 2868 A
3456(/*)S
(update)252 3582 A
(all)126 3876 A
(times)210 4044 A
(later)210 4296 A
4548(*/)S
5985 V
(23072)210 1122 A
(rip->i_dirt)462 1524 A
2028(=)S
(DIRTY;)252 2112 A
6075 V
(23073)210 1122 A
(for)126 1524 A
1692(\(i)S
1818(=)S
1902(0;)S
2028(i)S
2112(<)S
(V2_NR_TZONES;)546 2196 A
(i++\))168 2784 A
(rip->i_zone[i])588 2994 A
3624(=)S
(NO_ZONE;)336 3708 A
6165 V
(23074)210 1122 A
1440(})S
6345 V
(23076)210 1122 A
(/*===========================================================================*)3276 1440 A
6435 V
(23077)210 1122 A
1482(*)S
(free_inode)420 2784 A
4674(*)S
6525 V
(23078)210 1122 A
(*===========================================================================*/)3276 1482 A
6615 V
(23079)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(free_inode\(dev,)630 1944 A
(inumb\))252 2616 A
6705 V
(23080)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
2784(/*)S
2910(on)S
(which)210 3036 A
(device)252 3288 A
3582(is)S
(the)126 3708 A
(inode)210 3876 A
4128(*/)S
6795 V
(23081)210 1122 A
(ino_t)210 1440 A
(inumb;)252 1692 A
2784(/*)S
(number)252 2910 A
3204(of)S
(inode)210 3330 A
3582(to)S
3708(be)S
(freed)210 3834 A
4086(*/)S
6885 V
(23082)210 1122 A
1440({)S
6975 V
(23083)210 1122 A
1440(/*)S
(Return)252 1566 A
1860(an)S
(inode)210 1986 A
2238(to)S
(the)126 2364 A
(pool)168 2532 A
2742(of)S
(unallocated)462 2868 A
(inodes.)294 3372 A
3708(*/)S
7065 V
(23084)210 1122 A
8418 V
EP
%%Page: 306 306
BP
/slant 0 def
/height 0 def
1485 V
12 B
(306)180 1080 A
11 R
2373(File:)S
(servers/fs/inode.c)781 2606 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(23085)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(super_block)462 2196 A
(*sp;)168 2700 A
1845 V
(23086)210 1122 A
(bit_t)210 1524 A
1776(b;)S
1935 V
(23087)210 1122 A
2025 V
(23088)210 1122 A
1524(/*)S
(Locate)252 1650 A
(the)126 1944 A
(appropriate)462 2112 A
(super_block.)504 2616 A
3162(*/)S
2115 V
(23089)210 1122 A
1524(sp)S
1650(=)S
(get_super\(dev\);)630 1734 A
2205 V
(23090)210 1122 A
1524(if)S
(\(inumb)252 1650 A
1944(<=)S
2070(0)S
2154(||)S
(inumb)210 2280 A
2532(>)S
(sp->s_ninodes\))588 2616 A
(return;)294 3246 A
2295 V
(23091)210 1122 A
1524(b)S
1608(=)S
(inumb;)252 1692 A
2385 V
(23092)210 1122 A
(free_bit\(sp,)504 1524 A
(IMAP,)210 2070 A
(b\);)126 2322 A
2475 V
(23093)210 1122 A
1524(if)S
1650(\(b)S
1776(<)S
(sp->s_isearch\))588 1860 A
(sp->s_isearch)546 2490 A
3078(=)S
3162(b;)S
2565 V
(23094)210 1122 A
1440(})S
2745 V
(23096)210 1122 A
(/*===========================================================================*)3276 1440 A
2835 V
(23097)210 1122 A
1482(*)S
(update_times)504 2784 A
4674(*)S
2925 V
(23098)210 1122 A
(*===========================================================================*/)3276 1482 A
3015 V
(23099)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(update_times\(rip\))714 1944 A
3105 V
(23100)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(inode)210 3372 A
3624(to)S
3750(be)S
(read/written)504 3876 A
4422(*/)S
3195 V
(23101)210 1122 A
1440({)S
3285 V
(23102)210 1122 A
1440(/*)S
(Various)294 1566 A
(system)252 1902 A
(calls)210 2196 A
(are)126 2448 A
(required)336 2616 A
2994(by)S
(the)126 3120 A
(standard)336 3288 A
3666(to)S
(update)252 3792 A
(atime,)252 4086 A
(ctime,)252 4380 A
3375 V
(23103)210 1122 A
1482(*)S
1566(or)S
(mtime.)252 1692 A
(Since)210 2028 A
(updating)336 2280 A
2658(a)S
(time)168 2742 A
(requires)336 2952 A
(sending)294 3330 A
3666(a)S
(message)294 3750 A
4086(to)S
(the)126 4212 A
(clock)210 4380 A
3465 V
(23104)210 1122 A
1482(*)S
(task--an)336 1566 A
(expensive)378 1944 A
(business--the)546 2364 A
(times)210 2952 A
(are)126 3204 A
(marked)252 3372 A
(for)126 3666 A
(update)252 3834 A
4128(by)S
(setting)294 4254 A
3555 V
(23105)210 1122 A
1482(*)S
(bits)168 1566 A
1776(in)S
(i_update.)378 1902 A
(When)168 2364 A
2574(a)S
(stat,)210 2658 A
(fstat,)252 2910 A
3204(or)S
(sync)168 3330 A
3540(is)S
(done,)210 3666 A
3918(or)S
4044(an)S
(inode)210 4170 A
4422(is)S
3645 V
(23106)210 1122 A
1482(*)S
(released,)378 1566 A
(update_times\(\))588 1986 A
(may)126 2616 A
2784(be)S
(called)252 2910 A
3204(to)S
(actually)336 3330 A
(fill)168 3708 A
3918(in)S
(the)126 4044 A
(times.)252 4212 A
3735 V
(23107)210 1122 A
1482(*/)S
3825 V
(23108)210 1122 A
3915 V
(23109)210 1122 A
(time_t)252 1524 A
(cur_time;)378 1818 A
4005 V
(23110)210 1122 A
(struct)252 1524 A
(super_block)462 1818 A
(*sp;)168 2322 A
4095 V
(23111)210 1122 A
4185 V
(23112)210 1122 A
1524(sp)S
1650(=)S
(rip->i_sp;)420 1734 A
2784(/*)S
(get)126 2910 A
(pointer)294 3078 A
3414(to)S
(super)210 3540 A
(block.)252 3792 A
4086(*/)S
4275 V
(23113)210 1122 A
1524(if)S
(\(sp->s_rd_only\))630 1650 A
(return;)294 2322 A
2784(/*)S
2910(no)S
(updates)294 3036 A
(for)126 3372 A
(read-only)378 3540 A
(file)168 3960 A
(systems)294 4170 A
4506(*/)S
4365 V
(23114)210 1122 A
4455 V
(23115)210 1122 A
(cur_time)336 1524 A
1902(=)S
(clock_time\(\);)546 1986 A
4545 V
(23116)210 1122 A
1524(if)S
(\(rip->i_update)588 1650 A
2280(&)S
(ATIME\))252 2364 A
(rip->i_atime)504 2658 A
3204(=)S
(cur_time;)378 3288 A
4635 V
(23117)210 1122 A
1524(if)S
(\(rip->i_update)588 1650 A
2280(&)S
(CTIME\))252 2364 A
(rip->i_ctime)504 2658 A
3204(=)S
(cur_time;)378 3288 A
4725 V
(23118)210 1122 A
1524(if)S
(\(rip->i_update)588 1650 A
2280(&)S
(MTIME\))252 2364 A
(rip->i_mtime)504 2658 A
3204(=)S
(cur_time;)378 3288 A
4815 V
(23119)210 1122 A
(rip->i_update)546 1524 A
2112(=)S
2196(0;)S
2784(/*)S
(they)168 2910 A
(are)126 3120 A
(all)126 3288 A
(up-to-date)420 3456 A
(now)126 3918 A
4086(*/)S
4905 V
(23120)210 1122 A
1440(})S
5085 V
(23122)210 1122 A
(/*===========================================================================*)3276 1440 A
5175 V
(23123)210 1122 A
1482(*)S
(rw_inode)336 2784 A
4674(*)S
5265 V
(23124)210 1122 A
(*===========================================================================*/)3276 1482 A
5355 V
(23125)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(rw_inode\(rip,)546 1944 A
(rw_flag\))336 2532 A
5445 V
(23126)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(inode)210 3372 A
3624(to)S
3750(be)S
(read/written)504 3876 A
4422(*/)S
5535 V
(23127)210 1122 A
(int)126 1440 A
(rw_flag;)336 1608 A
2784(/*)S
(READING)294 2910 A
3246(or)S
(WRITING)294 3372 A
3708(*/)S
5625 V
(23128)210 1122 A
1440({)S
5715 V
(23129)210 1122 A
1440(/*)S
1566(An)S
(entry)210 1692 A
1944(in)S
(the)126 2070 A
(inode)210 2238 A
(table)210 2490 A
2742(is)S
2868(to)S
2994(be)S
(copied)252 3120 A
3414(to)S
3540(or)S
(from)168 3666 A
(the)126 3876 A
(disk.)210 4044 A
4296(*/)S
5805 V
(23130)210 1122 A
5895 V
(23131)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(buf)126 2196 A
(*bp;)168 2364 A
5985 V
(23132)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(super_block)462 2196 A
(*sp;)168 2700 A
6075 V
(23133)210 1122 A
(d1_inode)336 1524 A
(*dip;)210 1902 A
6165 V
(23134)210 1122 A
(d2_inode)336 1524 A
(*dip2;)252 1902 A
6255 V
(23135)210 1122 A
(block_t)294 1524 A
1860(b,)S
(offset;)294 1986 A
6345 V
(23136)210 1122 A
6435 V
(23137)210 1122 A
1524(/*)S
(Get)126 1650 A
(the)126 1818 A
(block)210 1986 A
(where)210 2238 A
(the)126 2490 A
(inode)210 2658 A
(resides.)336 2910 A
3288(*/)S
6525 V
(23138)210 1122 A
1524(sp)S
1650(=)S
(get_super\(rip->i_dev\);)924 1734 A
2784(/*)S
(get)126 2910 A
(pointer)294 3078 A
3414(to)S
(super)210 3540 A
(block)210 3792 A
4044(*/)S
6615 V
(23139)210 1122 A
(rip->i_sp)378 1524 A
1944(=)S
(sp;)126 2028 A
2784(/*)S
(inode)210 2910 A
(must)168 3162 A
(contain)294 3372 A
(super)210 3708 A
(block)210 3960 A
(pointer)294 4212 A
4548(*/)S
6705 V
(23140)210 1122 A
(offset)252 1524 A
1818(=)S
(sp->s_imap_blocks)714 1902 A
2658(+)S
(sp->s_zmap_blocks)714 2742 A
3498(+)S
3582(2;)S
6795 V
(23141)210 1122 A
1524(b)S
1608(=)S
(\(block_t\))378 1692 A
(\(rip->i_num)462 2112 A
2616(-)S
(1\)/sp->s_inodes_per_block)1050 2700 A
3792(+)S
(offset;)294 3876 A
6885 V
(23142)210 1122 A
1524(bp)S
1650(=)S
(get_block\(rip->i_dev,)882 1734 A
2658(b,)S
(NORMAL\);)336 2784 A
6975 V
(23143)210 1122 A
(dip)126 1524 A
1734(=)S
(bp->b_v1_ino)504 1818 A
2364(+)S
(\(rip->i_num)462 2448 A
2952(-)S
3036(1\))S
3162(%)S
(V1_INODES_PER_BLOCK;)840 3246 A
7065 V
(23144)210 1122 A
(dip2)168 1524 A
1734(=)S
(bp->b_v2_ino)504 1818 A
2364(+)S
(\(rip->i_num)462 2448 A
2952(-)S
3036(1\))S
3162(%)S
8418 V
EP
%%Page: 307 307
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2373(File:)S
(servers/fs/inode.c)781 2606 A
12 B
(307)180 4500 A
1755 V
7 LST
(23145)210 1122 A
(V2_INODES_PER_BLOCK\(sp->s_block_size\);)1596 1818 A
1845 V
(23146)210 1122 A
1935 V
(23147)210 1122 A
1524(/*)S
1650(Do)S
(the)126 1776 A
(read)168 1944 A
2154(or)S
(write.)252 2280 A
2574(*/)S
2025 V
(23148)210 1122 A
1524(if)S
(\(rw_flag)336 1650 A
2028(==)S
(WRITING\))336 2154 A
2532({)S
2115 V
(23149)210 1122 A
1776(if)S
(\(rip->i_update\))630 1902 A
(update_times\(rip\);)756 2574 A
3456(/*)S
(times)210 3582 A
(need)168 3834 A
(updating)336 4044 A
4422(*/)S
2205 V
(23150)210 1122 A
1776(if)S
(\(sp->s_rd_only)588 1902 A
2532(==)S
(FALSE\))252 2658 A
(bp->b_dirt)420 2952 A
3414(=)S
(DIRTY;)252 3498 A
2295 V
(23151)210 1122 A
1524(})S
2385 V
(23152)210 1122 A
2475 V
(23153)210 1122 A
1524(/*)S
(Copy)168 1650 A
(the)126 1860 A
(inode)210 2028 A
(from)168 2280 A
(the)126 2490 A
(disk)168 2658 A
(block)210 2868 A
3120(to)S
(the)126 3246 A
(in-core)294 3414 A
(table)210 3750 A
4002(or)S
(vice)168 4128 A
(versa.)252 4338 A
2565 V
(23154)210 1122 A
1566(*)S
1650(If)S
(the)126 1776 A
(fourth)252 1944 A
(parameter)378 2238 A
(below)210 2658 A
2910(is)S
(FALSE,)252 3036 A
(the)126 3330 A
(bytes)210 3498 A
(are)126 3750 A
(swapped.)336 3918 A
2655 V
(23155)210 1122 A
1566(*/)S
2745 V
(23156)210 1122 A
1524(if)S
(\(sp->s_version)588 1650 A
2280(==)S
(V1\))126 2406 A
2835 V
(23157)210 1122 A
(old_icopy\(rip,)588 1776 A
(dip,)168 2406 A
(rw_flag,)336 2658 A
(sp->s_native\);)588 3036 A
2925 V
(23158)210 1122 A
(else)168 1524 A
3015 V
(23159)210 1122 A
(new_icopy\(rip,)588 1776 A
(dip2,)210 2406 A
(rw_flag,)336 2658 A
(sp->s_native\);)588 3036 A
3105 V
(23160)210 1122 A
3195 V
(23161)210 1122 A
(put_block\(bp,)546 1524 A
(INODE_BLOCK\);)546 2112 A
3285 V
(23162)210 1122 A
(rip->i_dirt)462 1524 A
2028(=)S
(CLEAN;)252 2112 A
3375 V
(23163)210 1122 A
1440(})S
3555 V
(23165)210 1122 A
(/*===========================================================================*)3276 1440 A
3645 V
(23166)210 1122 A
1482(*)S
(old_icopy)378 2784 A
4674(*)S
3735 V
(23167)210 1122 A
(*===========================================================================*/)3276 1482 A
3825 V
(23168)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(old_icopy\(rip,)588 1986 A
(dip,)168 2616 A
(direction,)420 2826 A
(norm\))210 3288 A
3915 V
(23169)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(the)126 3372 A
(in-core)294 3540 A
(inode)210 3876 A
(struct)252 4128 A
4422(*/)S
4005 V
(23170)210 1122 A
(register)336 1440 A
(d1_inode)336 1818 A
(*dip;)210 2196 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(the)126 3372 A
(d1_inode)336 3540 A
(inode)210 3918 A
(struct)252 4170 A
4464(*/)S
4095 V
(23171)210 1122 A
(int)126 1440 A
(direction;)420 1608 A
2784(/*)S
(READING)294 2910 A
(\(from)210 3246 A
(disk\))210 3498 A
3750(or)S
(WRITING)294 3876 A
(\(to)126 4212 A
(disk\))210 4380 A
4632(*/)S
4185 V
(23172)210 1122 A
(int)126 1440 A
(norm;)210 1608 A
2784(/*)S
(TRUE)168 2910 A
3120(=)S
3204(do)S
(not)126 3330 A
(swap)168 3498 A
(bytes;)252 3708 A
(FALSE)210 4002 A
4254(=)S
(swap)168 4338 A
4548(*/)S
4275 V
(23173)210 1122 A
4365 V
(23174)210 1122 A
1440({)S
4455 V
(23175)210 1122 A
1440(/*)S
(The)126 1566 A
(V1.x)168 1734 A
(IBM)126 1944 A
(disk,)210 2112 A
(the)126 2364 A
(V1.x)168 2532 A
(68000)210 2742 A
(disk,)210 2994 A
(and)126 3246 A
(the)126 3414 A
3582(V2)S
(disk)168 3708 A
(\(same)210 3918 A
(for)126 4170 A
(IBM)126 4338 A
(and)126 4506 A
4545 V
(23176)210 1122 A
1482(*)S
(68000\))252 1566 A
(all)126 1860 A
(have)168 2028 A
(different)378 2238 A
(inode)210 2658 A
(layouts.)336 2910 A
(When)168 3330 A
3540(an)S
(inode)210 3666 A
3918(is)S
(read)168 4044 A
4254(or)S
(written)294 4380 A
4635 V
(23177)210 1122 A
1482(*)S
(this)168 1566 A
(routine)294 1776 A
(handles)294 2112 A
(the)126 2448 A
(conversions)462 2616 A
3120(so)S
(that)168 3246 A
(the)126 3456 A
(information)462 3624 A
4128(in)S
(the)126 4254 A
(inode)210 4422 A
4725 V
(23178)210 1122 A
1482(*)S
(table)210 1566 A
1818(is)S
(independent)462 1944 A
2448(of)S
(the)126 2574 A
(disk)168 2742 A
(structure)378 2952 A
(from)168 3372 A
(which)210 3582 A
(the)126 3834 A
(inode)210 4002 A
(came.)210 4254 A
4815 V
(23179)210 1122 A
1482(*)S
(The)126 1566 A
(old_icopy)378 1734 A
(routine)294 2154 A
(copies)252 2490 A
2784(to)S
(and)126 2910 A
(from)168 3078 A
3288(V1)S
(disks.)252 3414 A
4905 V
(23180)210 1122 A
1482(*/)S
4995 V
(23181)210 1122 A
5085 V
(23182)210 1122 A
(int)126 1524 A
1692(i;)S
5175 V
(23183)210 1122 A
5265 V
(23184)210 1122 A
1524(if)S
(\(direction)420 1650 A
2112(==)S
(READING\))336 2238 A
2616({)S
5355 V
(23185)210 1122 A
1776(/*)S
(Copy)168 1902 A
(V1.x)168 2112 A
(inode)210 2322 A
2574(to)S
(the)126 2700 A
(in-core)294 2868 A
(table,)252 3204 A
(swapping)336 3498 A
(bytes)210 3876 A
4128(if)S
(need)168 4254 A
(be.)126 4464 A
4632(*/)S
5445 V
(23186)210 1122 A
(rip->i_mode)462 1776 A
2406(=)S
(conv2\(norm,)462 2490 A
(\(int\))210 2994 A
(dip->d1_mode\);)588 3246 A
5535 V
(23187)210 1122 A
(rip->i_uid)420 1776 A
2406(=)S
(conv2\(norm,)462 2490 A
(\(int\))210 2994 A
(dip->d1_uid)462 3246 A
3750(\);)S
5625 V
(23188)210 1122 A
(rip->i_size)462 1776 A
2406(=)S
(conv4\(norm,)462 2490 A
(dip->d1_size\);)588 3246 A
5715 V
(23189)210 1122 A
(rip->i_mtime)504 1776 A
2406(=)S
(conv4\(norm,)462 2490 A
(dip->d1_mtime\);)630 3246 A
5805 V
(23190)210 1122 A
(rip->i_atime)504 1776 A
2406(=)S
(rip->i_mtime;)546 2490 A
5895 V
(23191)210 1122 A
(rip->i_ctime)504 1776 A
2406(=)S
(rip->i_mtime;)546 2490 A
5985 V
(23192)210 1122 A
(rip->i_nlinks)546 1776 A
2406(=)S
(dip->d1_nlinks;)630 2490 A
3792(/*)S
3918(1)S
(char)168 4002 A
4212(*/)S
6075 V
(23193)210 1122 A
(rip->i_gid)420 1776 A
2406(=)S
(dip->d1_gid;)504 2490 A
3792(/*)S
3918(1)S
(char)168 4002 A
4212(*/)S
6165 V
(23194)210 1122 A
(rip->i_ndzones)588 1776 A
2406(=)S
(V1_NR_DZONES;)546 2490 A
6255 V
(23195)210 1122 A
(rip->i_nindirs)588 1776 A
2406(=)S
(V1_INDIRECTS;)546 2490 A
6345 V
(23196)210 1122 A
(for)126 1776 A
1944(\(i)S
2070(=)S
2154(0;)S
2280(i)S
2364(<)S
(V1_NR_TZONES;)546 2448 A
(i++\))168 3036 A
6435 V
(23197)210 1122 A
(rip->i_zone[i])588 2112 A
2742(=)S
(conv2\(norm,)462 2826 A
(\(int\))210 3330 A
(dip->d1_zone[i]\);)714 3582 A
6525 V
(23198)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
6615 V
(23199)210 1122 A
1776(/*)S
(Copying)294 1902 A
(V1.x)168 2238 A
(inode)210 2448 A
2700(to)S
(disk)168 2826 A
(from)168 3036 A
(the)126 3246 A
(in-core)294 3414 A
(table.)252 3750 A
4044(*/)S
6705 V
(23200)210 1122 A
(dip->d1_mode)504 1776 A
2406(=)S
(conv2\(norm,)462 2490 A
(\(int\))210 2994 A
(rip->i_mode\);)546 3246 A
6795 V
(23201)210 1122 A
(dip->d1_uid)462 1776 A
2406(=)S
(conv2\(norm,)462 2490 A
(\(int\))210 2994 A
(rip->i_uid)420 3246 A
3708(\);)S
6885 V
(23202)210 1122 A
(dip->d1_size)504 1776 A
2406(=)S
(conv4\(norm,)462 2490 A
(rip->i_size\);)546 3246 A
6975 V
(23203)210 1122 A
(dip->d1_mtime)546 1776 A
2406(=)S
(conv4\(norm,)462 2490 A
(rip->i_mtime\);)588 3246 A
7065 V
(23204)210 1122 A
(dip->d1_nlinks)588 1776 A
2406(=)S
(rip->i_nlinks;)588 2490 A
3792(/*)S
3918(1)S
(char)168 4002 A
4212(*/)S
8418 V
EP
%%Page: 308 308
BP
/slant 0 def
/height 0 def
1485 V
12 B
(308)180 1080 A
11 R
2373(File:)S
(servers/fs/inode.c)781 2606 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(23205)210 1122 A
(dip->d1_gid)462 1776 A
2406(=)S
(rip->i_gid;)462 2490 A
3792(/*)S
3918(1)S
(char)168 4002 A
4212(*/)S
1845 V
(23206)210 1122 A
(for)126 1776 A
1944(\(i)S
2070(=)S
2154(0;)S
2280(i)S
2364(<)S
(V1_NR_TZONES;)546 2448 A
(i++\))168 3036 A
1935 V
(23207)210 1122 A
(dip->d1_zone[i])630 2112 A
2784(=)S
(conv2\(norm,)462 2868 A
(\(int\))210 3372 A
(rip->i_zone[i]\);)672 3624 A
2025 V
(23208)210 1122 A
1524(})S
2115 V
(23209)210 1122 A
1440(})S
2295 V
(23211)210 1122 A
(/*===========================================================================*)3276 1440 A
2385 V
(23212)210 1122 A
1482(*)S
(new_icopy)378 2784 A
4674(*)S
2475 V
(23213)210 1122 A
(*===========================================================================*/)3276 1482 A
2565 V
(23214)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(new_icopy\(rip,)588 1986 A
(dip,)168 2616 A
(direction,)420 2826 A
(norm\))210 3288 A
2655 V
(23215)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(the)126 3372 A
(in-core)294 3540 A
(inode)210 3876 A
(struct)252 4128 A
4422(*/)S
2745 V
(23216)210 1122 A
(register)336 1440 A
(d2_inode)336 1818 A
(*dip;)210 2196 A
2448(/*)S
(pointer)294 2574 A
2910(to)S
(the)126 3036 A
(d2_inode)336 3204 A
(struct)252 3582 A
3876(*/)S
2835 V
(23217)210 1122 A
(int)126 1440 A
(direction;)420 1608 A
2784(/*)S
(READING)294 2910 A
(\(from)210 3246 A
(disk\))210 3498 A
3750(or)S
(WRITING)294 3876 A
(\(to)126 4212 A
(disk\))210 4380 A
4632(*/)S
2925 V
(23218)210 1122 A
(int)126 1440 A
(norm;)210 1608 A
2784(/*)S
(TRUE)168 2910 A
3120(=)S
3204(do)S
(not)126 3330 A
(swap)168 3498 A
(bytes;)252 3708 A
(FALSE)210 4002 A
4254(=)S
(swap)168 4338 A
4548(*/)S
3015 V
(23219)210 1122 A
3105 V
(23220)210 1122 A
1440({)S
3195 V
(23221)210 1122 A
1440(/*)S
(Same)168 1566 A
1776(as)S
(old_icopy,)420 1902 A
(but)126 2364 A
(to/from)294 2532 A
2868(V2)S
(disk)168 2994 A
(layout.)294 3204 A
3540(*/)S
3285 V
(23222)210 1122 A
3375 V
(23223)210 1122 A
(int)126 1524 A
1692(i;)S
3465 V
(23224)210 1122 A
3555 V
(23225)210 1122 A
1524(if)S
(\(direction)420 1650 A
2112(==)S
(READING\))336 2238 A
2616({)S
3645 V
(23226)210 1122 A
1776(/*)S
(Copy)168 1902 A
(V2.x)168 2112 A
(inode)210 2322 A
2574(to)S
(the)126 2700 A
(in-core)294 2868 A
(table,)252 3204 A
(swapping)336 3498 A
(bytes)210 3876 A
4128(if)S
(need)168 4254 A
(be.)126 4464 A
4632(*/)S
3735 V
(23227)210 1122 A
(rip->i_mode)462 1776 A
2406(=)S
(conv2\(norm,dip->d2_mode\);)1050 2490 A
3825 V
(23228)210 1122 A
(rip->i_uid)420 1776 A
2406(=)S
(conv2\(norm,dip->d2_uid\);)1008 2490 A
3915 V
(23229)210 1122 A
(rip->i_nlinks)546 1776 A
2406(=)S
(conv2\(norm,dip->d2_nlinks\);)1134 2490 A
4005 V
(23230)210 1122 A
(rip->i_gid)420 1776 A
2406(=)S
(conv2\(norm,dip->d2_gid\);)1008 2490 A
4095 V
(23231)210 1122 A
(rip->i_size)462 1776 A
2406(=)S
(conv4\(norm,dip->d2_size\);)1050 2490 A
4185 V
(23232)210 1122 A
(rip->i_atime)504 1776 A
2406(=)S
(conv4\(norm,dip->d2_atime\);)1092 2490 A
4275 V
(23233)210 1122 A
(rip->i_ctime)504 1776 A
2406(=)S
(conv4\(norm,dip->d2_ctime\);)1092 2490 A
4365 V
(23234)210 1122 A
(rip->i_mtime)504 1776 A
2406(=)S
(conv4\(norm,dip->d2_mtime\);)1092 2490 A
4455 V
(23235)210 1122 A
(rip->i_ndzones)588 1776 A
2406(=)S
(V2_NR_DZONES;)546 2490 A
4545 V
(23236)210 1122 A
(rip->i_nindirs)588 1776 A
2406(=)S
(V2_INDIRECTS\(rip->i_sp->s_block_size\);)1596 2490 A
4635 V
(23237)210 1122 A
(for)126 1776 A
1944(\(i)S
2070(=)S
2154(0;)S
2280(i)S
2364(<)S
(V2_NR_TZONES;)546 2448 A
(i++\))168 3036 A
4725 V
(23238)210 1122 A
(rip->i_zone[i])588 2112 A
2742(=)S
(conv4\(norm,)462 2826 A
(\(long\))252 3330 A
(dip->d2_zone[i]\);)714 3624 A
4815 V
(23239)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
4905 V
(23240)210 1122 A
1776(/*)S
(Copying)294 1902 A
(V2.x)168 2238 A
(inode)210 2448 A
2700(to)S
(disk)168 2826 A
(from)168 3036 A
(the)126 3246 A
(in-core)294 3414 A
(table.)252 3750 A
4044(*/)S
4995 V
(23241)210 1122 A
(dip->d2_mode)504 1776 A
2406(=)S
(conv2\(norm,rip->i_mode\);)1008 2490 A
5085 V
(23242)210 1122 A
(dip->d2_uid)462 1776 A
2406(=)S
(conv2\(norm,rip->i_uid\);)966 2490 A
5175 V
(23243)210 1122 A
(dip->d2_nlinks)588 1776 A
2406(=)S
(conv2\(norm,rip->i_nlinks\);)1092 2490 A
5265 V
(23244)210 1122 A
(dip->d2_gid)462 1776 A
2406(=)S
(conv2\(norm,rip->i_gid\);)966 2490 A
5355 V
(23245)210 1122 A
(dip->d2_size)504 1776 A
2406(=)S
(conv4\(norm,rip->i_size\);)1008 2490 A
5445 V
(23246)210 1122 A
(dip->d2_atime)546 1776 A
2406(=)S
(conv4\(norm,rip->i_atime\);)1050 2490 A
5535 V
(23247)210 1122 A
(dip->d2_ctime)546 1776 A
2406(=)S
(conv4\(norm,rip->i_ctime\);)1050 2490 A
5625 V
(23248)210 1122 A
(dip->d2_mtime)546 1776 A
2406(=)S
(conv4\(norm,rip->i_mtime\);)1050 2490 A
5715 V
(23249)210 1122 A
(for)126 1776 A
1944(\(i)S
2070(=)S
2154(0;)S
2280(i)S
2364(<)S
(V2_NR_TZONES;)546 2448 A
(i++\))168 3036 A
5805 V
(23250)210 1122 A
(dip->d2_zone[i])630 2112 A
2784(=)S
(conv4\(norm,)462 2868 A
(\(long\))252 3372 A
(rip->i_zone[i]\);)672 3666 A
5895 V
(23251)210 1122 A
1524(})S
5985 V
(23252)210 1122 A
1440(})S
6165 V
(23254)210 1122 A
(/*===========================================================================*)3276 1440 A
6255 V
(23255)210 1122 A
1482(*)S
(dup_inode)378 2784 A
4674(*)S
6345 V
(23256)210 1122 A
(*===========================================================================*/)3276 1482 A
6435 V
(23257)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(dup_inode\(ip\))546 1944 A
6525 V
(23258)210 1122 A
(struct)252 1440 A
(inode)210 1734 A
(*ip;)168 1986 A
2784(/*)S
(The)126 2910 A
(inode)210 3078 A
3330(to)S
3456(be)S
(duplicated.)462 3582 A
4086(*/)S
6615 V
(23259)210 1122 A
1440({)S
6705 V
(23260)210 1122 A
1440(/*)S
(This)168 1566 A
(routine)294 1776 A
2112(is)S
2238(a)S
(simplified)420 2322 A
(form)168 2784 A
2994(of)S
(get_inode\(\))462 3120 A
(for)126 3624 A
(the)126 3792 A
(case)168 3960 A
(where)210 4170 A
6795 V
(23261)210 1122 A
1482(*)S
(the)126 1566 A
(inode)210 1734 A
(pointer)294 1986 A
2322(is)S
(already)294 2448 A
(known.)252 2784 A
6885 V
(23262)210 1122 A
1482(*/)S
6975 V
(23263)210 1122 A
7065 V
(23264)210 1122 A
(ip->i_count++;)588 1524 A
8418 V
EP
%%Page: 309 309
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2373(File:)S
(servers/fs/inode.c)781 2606 A
12 B
(309)180 4500 A
1755 V
7 LST
(23265)210 1122 A
1440(})S
2295 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2385 V
(servers/fs/super.c)756 2676 A
2475 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2655 V
(23300)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(manages)294 1986 A
(the)126 2322 A
(super)210 2490 A
(block)210 2742 A
(table)210 2994 A
(and)126 3246 A
(the)126 3414 A
(related)294 3582 A
(data)168 3918 A
(structures,)462 4128 A
2745 V
(23301)210 1122 A
1482(*)S
(namely,)294 1566 A
(the)126 1902 A
(bit)126 2070 A
(maps)168 2238 A
(that)168 2448 A
(keep)168 2658 A
(track)210 2868 A
3120(of)S
(which)210 3246 A
(zones)210 3498 A
(and)126 3750 A
(which)210 3918 A
(inodes)252 4170 A
(are)126 4464 A
2835 V
(23302)210 1122 A
1482(*)S
(allocated)378 1566 A
(and)126 1986 A
(which)210 2154 A
(are)126 2406 A
(free.)210 2574 A
(When)168 2868 A
3078(a)S
(new)126 3162 A
(inode)210 3330 A
3582(or)S
(zone)168 3708 A
3918(is)S
(needed,)294 4044 A
(the)126 4380 A
2925 V
(23303)210 1122 A
1482(*)S
(appropriate)462 1566 A
(bit)126 2070 A
(map)126 2238 A
2406(is)S
(searched)336 2532 A
(for)126 2910 A
3078(a)S
(free)168 3162 A
(entry.)252 3372 A
3015 V
(23304)210 1122 A
1482(*)S
3105 V
(23305)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are)126 2910 A
3195 V
(23306)210 1122 A
1482(*)S
(alloc_bit:)420 1650 A
(somebody)336 2364 A
(wants)210 2742 A
2994(to)S
(allocate)336 3120 A
3498(a)S
(zone)168 3582 A
3792(or)S
(inode;)252 3918 A
(find)168 4212 A
(one)126 4422 A
3285 V
(23307)210 1122 A
1482(*)S
(free_bit:)378 1650 A
(indicate)336 2364 A
(that)168 2742 A
2952(a)S
(zone)168 3036 A
3246(or)S
(inode)210 3372 A
3624(is)S
(available)378 3750 A
(for)126 4170 A
(allocation)420 4338 A
3375 V
(23308)210 1122 A
1482(*)S
(get_super:)420 1650 A
(search)252 2364 A
(the)126 2658 A
('superblock')504 2826 A
(table)210 3372 A
(for)126 3624 A
3792(a)S
(device)252 3876 A
3465 V
(23309)210 1122 A
1482(*)S
(mounted:)336 1650 A
(tells)210 2364 A
2616(if)S
(file)168 2742 A
(inode)210 2952 A
3204(is)S
3330(on)S
(mounted)294 3456 A
(\(or)126 3792 A
(ROOT\))210 3960 A
(file)168 4212 A
(system)252 4422 A
3555 V
(23310)210 1122 A
1482(*)S
(read_super:)462 1650 A
(read)168 2364 A
2574(a)S
(superblock)420 2658 A
3645 V
(23311)210 1122 A
1482(*/)S
3735 V
(23312)210 1122 A
3825 V
(23313)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
3915 V
(23314)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
4005 V
(23315)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
4095 V
(23316)210 1122 A
(#include)336 1440 A
("buf.h")294 1818 A
4185 V
(23317)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
4275 V
(23318)210 1122 A
(#include)336 1440 A
("super.h")378 1818 A
4365 V
(23319)210 1122 A
(#include)336 1440 A
("const.h")378 1818 A
4455 V
(23320)210 1122 A
4545 V
(23321)210 1122 A
(/*===========================================================================*)3276 1440 A
4635 V
(23322)210 1122 A
1482(*)S
(alloc_bit)378 2784 A
4674(*)S
4725 V
(23323)210 1122 A
(*===========================================================================*/)3276 1482 A
4815 V
(23324)210 1122 A
(PUBLIC)252 1440 A
(bit_t)210 1734 A
(alloc_bit\(sp,)546 1986 A
(map,)168 2574 A
(origin\))294 2784 A
4905 V
(23325)210 1122 A
(struct)252 1440 A
(super_block)462 1734 A
(*sp;)168 2238 A
2784(/*)S
(the)126 2910 A
(filesystem)420 3078 A
3540(to)S
(allocate)336 3666 A
(from)168 4044 A
4254(*/)S
4995 V
(23326)210 1122 A
(int)126 1440 A
(map;)168 1608 A
2784(/*)S
(IMAP)168 2910 A
(\(inode)252 3120 A
(map\))168 3414 A
3624(or)S
(ZMAP)168 3750 A
(\(zone)210 3960 A
(map\))168 4212 A
4422(*/)S
5085 V
(23327)210 1122 A
(bit_t)210 1440 A
(origin;)294 1692 A
2784(/*)S
(number)252 2910 A
3204(of)S
(bit)126 3330 A
3498(to)S
(start)210 3624 A
(searching)378 3876 A
4296(at)S
4422(*/)S
5175 V
(23328)210 1122 A
1440({)S
5265 V
(23329)210 1122 A
1440(/*)S
(Allocate)336 1566 A
1944(a)S
(bit)126 2028 A
(from)168 2196 A
2406(a)S
(bit)126 2490 A
(map)126 2658 A
(and)126 2826 A
(return)252 2994 A
(its)126 3288 A
(bit)126 3456 A
(number.)294 3624 A
3960(*/)S
5355 V
(23330)210 1122 A
5445 V
(23331)210 1122 A
(block_t)294 1524 A
(start_block;)504 1860 A
2784(/*)S
(first)210 2910 A
(bit)126 3162 A
(block)210 3330 A
3582(*/)S
5535 V
(23332)210 1122 A
(bit_t)210 1524 A
(map_bits;)378 1776 A
2784(/*)S
(how)126 2910 A
(many)168 3078 A
(bits)168 3288 A
(are)126 3498 A
(there)210 3666 A
3918(in)S
(the)126 4044 A
(bit)126 4212 A
(map?)168 4380 A
4590(*/)S
5625 V
(23333)210 1122 A
(unsigned)336 1524 A
(bit_blocks;)462 1902 A
2784(/*)S
(how)126 2910 A
(many)168 3078 A
(blocks)252 3288 A
(are)126 3582 A
(there)210 3750 A
4002(in)S
(the)126 4128 A
(bit)126 4296 A
(map?)168 4464 A
4674(*/)S
5715 V
(23334)210 1122 A
(unsigned)336 1524 A
(block,)252 1902 A
(word,)210 2196 A
(bcount;)294 2448 A
5805 V
(23335)210 1122 A
(struct)252 1524 A
(buf)126 1818 A
(*bp;)168 1986 A
5895 V
(23336)210 1122 A
(bitchunk_t)420 1524 A
(*wptr,)252 1986 A
(*wlim,)252 2280 A
2574(k;)S
5985 V
(23337)210 1122 A
(bit_t)210 1524 A
1776(i,)S
1902(b;)S
6075 V
(23338)210 1122 A
6165 V
(23339)210 1122 A
1524(if)S
(\(sp->s_rd_only\))630 1650 A
6255 V
(23340)210 1122 A
(panic\(__FILE__,"can't)882 1776 A
(allocate)336 2700 A
(bit)126 3078 A
3246(on)S
(read-only)378 3372 A
(filesys.",)420 3792 A
(NO_NUM\);)336 4254 A
6345 V
(23341)210 1122 A
6435 V
(23342)210 1122 A
1524(if)S
(\(map)168 1650 A
1860(==)S
(IMAP\))210 1986 A
2238({)S
6525 V
(23343)210 1122 A
(start_block)462 1776 A
2280(=)S
(START_BLOCK;)504 2364 A
6615 V
(23344)210 1122 A
(map_bits)336 1776 A
2154(=)S
(sp->s_ninodes)546 2238 A
2826(+)S
2910(1;)S
6705 V
(23345)210 1122 A
(bit_blocks)420 1776 A
2238(=)S
(sp->s_imap_blocks;)756 2322 A
6795 V
(23346)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
6885 V
(23347)210 1122 A
(start_block)462 1776 A
2280(=)S
(START_BLOCK)462 2364 A
2868(+)S
(sp->s_imap_blocks;)756 2952 A
6975 V
(23348)210 1122 A
(map_bits)336 1776 A
2154(=)S
(sp->s_zones)462 2238 A
2742(-)S
(\(sp->s_firstdatazone)840 2826 A
3708(-)S
(1\);)126 3792 A
7065 V
(23349)210 1122 A
(bit_blocks)420 1776 A
2238(=)S
(sp->s_zmap_blocks;)756 2322 A
8418 V
EP
%%Page: 310 310
BP
/slant 0 def
/height 0 def
1485 V
12 B
(310)180 1080 A
11 R
2376(File:)S
2609(servers/fs/super.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(23350)210 1122 A
1524(})S
1845 V
(23351)210 1122 A
1935 V
(23352)210 1122 A
1524(/*)S
(Figure)252 1650 A
(out)126 1944 A
(where)210 2112 A
2364(to)S
(start)210 2490 A
(the)126 2742 A
(bit)126 2910 A
(search)252 3078 A
(\(depends)336 3372 A
3750(on)S
('origin'\).)420 3876 A
4338(*/)S
2025 V
(23353)210 1122 A
1524(if)S
(\(origin)294 1650 A
1986(>=)S
(map_bits\))378 2112 A
(origin)252 2532 A
2826(=)S
2910(0;)S
3120(/*)S
(for)126 3246 A
(robustness)420 3414 A
3876(*/)S
2115 V
(23354)210 1122 A
2205 V
(23355)210 1122 A
1524(/*)S
(Locate)252 1650 A
(the)126 1944 A
(starting)336 2112 A
(place.)252 2490 A
2784(*/)S
2295 V
(23356)210 1122 A
(block)210 1524 A
1776(=)S
(origin)252 1860 A
2154(/)S
(FS_BITS_PER_BLOCK\(sp->s_block_size\);)1512 2238 A
2385 V
(23357)210 1122 A
(word)168 1524 A
1734(=)S
(\(origin)294 1818 A
2154(%)S
(FS_BITS_PER_BLOCK\(sp->s_block_size\)\))1512 2238 A
3792(/)S
(FS_BITCHUNK_BITS;)714 3876 A
2475 V
(23358)210 1122 A
2565 V
(23359)210 1122 A
1524(/*)S
(Iterate)294 1650 A
(over)168 1986 A
(all)126 2196 A
(blocks)252 2364 A
(plus)168 2658 A
(one,)168 2868 A
(because)294 3078 A
3414(we)S
(start)210 3540 A
3792(in)S
(the)126 3918 A
(middle.)294 4086 A
4422(*/)S
2655 V
(23360)210 1122 A
(bcount)252 1524 A
1818(=)S
(bit_blocks)420 1902 A
2364(+)S
2448(1;)S
2745 V
(23361)210 1122 A
1524(do)S
1650({)S
2835 V
(23362)210 1122 A
1776(bp)S
1902(=)S
(get_block\(sp->s_dev,)840 1986 A
(start_block)462 2868 A
3372(+)S
(block,)252 3456 A
(NORMAL\);)336 3750 A
2925 V
(23363)210 1122 A
(wlim)168 1776 A
1986(=)S
(&bp->b_bitmap[FS_BITMAP_CHUNKS\(sp->s_block_size\)];)2100 2070 A
3015 V
(23364)210 1122 A
3105 V
(23365)210 1122 A
1776(/*)S
(Iterate)294 1902 A
(over)168 2238 A
(the)126 2448 A
(words)210 2616 A
2868(in)S
(block.)252 2994 A
3288(*/)S
3195 V
(23366)210 1122 A
(for)126 1776 A
(\(wptr)210 1944 A
2196(=)S
(&bp->b_bitmap[word];)840 2280 A
(wptr)168 3162 A
3372(<)S
(wlim;)210 3456 A
(wptr++\))294 3708 A
4044({)S
3285 V
(23367)210 1122 A
3375 V
(23368)210 1122 A
2112(/*)S
(Does)168 2238 A
(this)168 2448 A
(word)168 2658 A
(contain)294 2868 A
3204(a)S
(free)168 3288 A
(bit?)168 3498 A
3708(*/)S
3465 V
(23369)210 1122 A
2112(if)S
(\(*wptr)252 2238 A
2532(==)S
(\(bitchunk_t\))504 2658 A
(\3040\))126 3204 A
(continue;)378 3372 A
3555 V
(23370)210 1122 A
3645 V
(23371)210 1122 A
2112(/*)S
(Find)168 2238 A
(and)126 2448 A
(allocate)336 2616 A
(the)126 2994 A
(free)168 3162 A
(bit.)168 3372 A
3582(*/)S
3735 V
(23372)210 1122 A
2112(k)S
2196(=)S
(conv2\(sp->s_native,)798 2280 A
(\(int\))210 3120 A
(*wptr\);)294 3372 A
3825 V
(23373)210 1122 A
(for)126 2112 A
2280(\(i)S
2406(=)S
2490(0;)S
2616(\(k)S
2742(&)S
2826(\(1)S
2952(<<)S
(i\)\))126 3078 A
3246(!=)S
3372(0;)S
(++i\))168 3498 A
3708({})S
3915 V
(23374)210 1122 A
4005 V
(23375)210 1122 A
2112(/*)S
(Bit)126 2238 A
(number)252 2406 A
(from)168 2700 A
(the)126 2910 A
(start)210 3078 A
3330(of)S
(the)126 3456 A
(bit)126 3624 A
(map.)168 3792 A
4002(*/)S
4095 V
(23376)210 1122 A
2112(b)S
2196(=)S
(\(\(bit_t\))336 2280 A
(block)210 2658 A
2910(*)S
(FS_BITS_PER_BLOCK\(sp->s_block_size\)\))1512 2994 A
4185 V
(23377)210 1122 A
2280(+)S
(\(wptr)210 2364 A
2616(-)S
(&bp->b_bitmap[0]\))714 2700 A
3456(*)S
(FS_BITCHUNK_BITS)672 3540 A
4275 V
(23378)210 1122 A
2280(+)S
2364(i;)S
4365 V
(23379)210 1122 A
4455 V
(23380)210 1122 A
2112(/*)S
(Don't)210 2238 A
(allocate)336 2490 A
(bits)168 2868 A
(beyond)252 3078 A
(the)126 3372 A
(end)126 3540 A
3708(of)S
(the)126 3834 A
(map.)168 4002 A
4212(*/)S
4545 V
(23381)210 1122 A
2112(if)S
2238(\(b)S
2364(>=)S
(map_bits\))378 2490 A
(break;)252 2910 A
4635 V
(23382)210 1122 A
4725 V
(23383)210 1122 A
2112(/*)S
(Allocate)336 2238 A
(and)126 2616 A
(return)252 2784 A
(bit)126 3078 A
(number.)294 3246 A
3582(*/)S
4815 V
(23384)210 1122 A
2112(k)S
2196(|=)S
2322(1)S
2406(<<)S
2532(i;)S
4905 V
(23385)210 1122 A
(*wptr)210 2112 A
2364(=)S
(conv2\(sp->s_native,)798 2448 A
(\(int\))210 3288 A
(k\);)126 3540 A
4995 V
(23386)210 1122 A
(bp->b_dirt)420 2112 A
2574(=)S
(DIRTY;)252 2658 A
5085 V
(23387)210 1122 A
(put_block\(bp,)546 2112 A
(MAP_BLOCK\);)462 2700 A
5175 V
(23388)210 1122 A
(return\(b\);)420 2112 A
5265 V
(23389)210 1122 A
1776(})S
5355 V
(23390)210 1122 A
(put_block\(bp,)546 1776 A
(MAP_BLOCK\);)462 2364 A
5445 V
(23391)210 1122 A
1776(if)S
(\(++block)336 1902 A
2280(>=)S
(bit_blocks\))462 2406 A
(block)210 2910 A
3162(=)S
3246(0;)S
3456(/*)S
(last)168 3582 A
(block,)252 3792 A
(wrap)168 4086 A
(around)252 4296 A
4590(*/)S
5535 V
(23392)210 1122 A
(word)168 1776 A
1986(=)S
2070(0;)S
5625 V
(23393)210 1122 A
1524(})S
(while)210 1608 A
(\(--bcount)378 1860 A
2280(>)S
(0\);)126 2364 A
5715 V
(23394)210 1122 A
(return\(NO_BIT\);)630 1524 A
2784(/*)S
2910(no)S
(bit)126 3036 A
(could)210 3204 A
3456(be)S
(allocated)378 3582 A
4002(*/)S
5805 V
(23395)210 1122 A
1440(})S
5985 V
(23397)210 1122 A
(/*===========================================================================*)3276 1440 A
6075 V
(23398)210 1122 A
1482(*)S
(free_bit)336 2784 A
4674(*)S
6165 V
(23399)210 1122 A
(*===========================================================================*/)3276 1482 A
6255 V
(23400)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(free_bit\(sp,)504 1944 A
(map,)168 2490 A
(bit_returned\))546 2700 A
6345 V
(23401)210 1122 A
(struct)252 1440 A
(super_block)462 1734 A
(*sp;)168 2238 A
2784(/*)S
(the)126 2910 A
(filesystem)420 3078 A
3540(to)S
(operate)294 3666 A
4002(on)S
4128(*/)S
6435 V
(23402)210 1122 A
(int)126 1440 A
(map;)168 1608 A
2784(/*)S
(IMAP)168 2910 A
(\(inode)252 3120 A
(map\))168 3414 A
3624(or)S
(ZMAP)168 3750 A
(\(zone)210 3960 A
(map\))168 4212 A
4422(*/)S
6525 V
(23403)210 1122 A
(bit_t)210 1440 A
(bit_returned;)546 1692 A
2784(/*)S
(number)252 2910 A
3204(of)S
(bit)126 3330 A
3498(to)S
(insert)252 3624 A
(into)168 3918 A
(the)126 4128 A
(map)126 4296 A
4464(*/)S
6615 V
(23404)210 1122 A
1440({)S
6705 V
(23405)210 1122 A
1440(/*)S
(Return)252 1566 A
1860(a)S
(zone)168 1944 A
2154(or)S
(inode)210 2280 A
2532(by)S
(turning)294 2658 A
(off)126 2994 A
(its)126 3162 A
(bitmap)252 3330 A
(bit.)168 3624 A
3834(*/)S
6795 V
(23406)210 1122 A
6885 V
(23407)210 1122 A
(unsigned)336 1524 A
(block,)252 1902 A
(word,)210 2196 A
(bit;)168 2448 A
6975 V
(23408)210 1122 A
(struct)252 1524 A
(buf)126 1818 A
(*bp;)168 1986 A
7065 V
(23409)210 1122 A
(bitchunk_t)420 1524 A
1986(k,)S
(mask;)210 2112 A
8418 V
EP
%%Page: 311 311
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2376(File:)S
2609(servers/fs/super.c)S
12 B
(311)180 4500 A
1755 V
7 LST
(23410)210 1122 A
(block_t)294 1524 A
(start_block;)504 1860 A
1845 V
(23411)210 1122 A
1935 V
(23412)210 1122 A
1524(if)S
(\(sp->s_rd_only\))630 1650 A
2025 V
(23413)210 1122 A
(panic\(__FILE__,"can't)882 1776 A
(free)168 2700 A
(bit)126 2910 A
3078(on)S
(read-only)378 3204 A
(filesys.",)420 3624 A
(NO_NUM\);)336 4086 A
2115 V
(23414)210 1122 A
2205 V
(23415)210 1122 A
1524(if)S
(\(map)168 1650 A
1860(==)S
(IMAP\))210 1986 A
2238({)S
2295 V
(23416)210 1122 A
(start_block)462 1776 A
2280(=)S
(START_BLOCK;)504 2364 A
2385 V
(23417)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
2475 V
(23418)210 1122 A
(start_block)462 1776 A
2280(=)S
(START_BLOCK)462 2364 A
2868(+)S
(sp->s_imap_blocks;)756 2952 A
2565 V
(23419)210 1122 A
1524(})S
2655 V
(23420)210 1122 A
(block)210 1524 A
1776(=)S
(bit_returned)504 1860 A
2406(/)S
(FS_BITS_PER_BLOCK\(sp->s_block_size\);)1512 2490 A
2745 V
(23421)210 1122 A
(word)168 1524 A
1734(=)S
(\(bit_returned)546 1818 A
2406(%)S
(FS_BITS_PER_BLOCK\(sp->s_block_size\)\))1512 2490 A
2835 V
(23422)210 1122 A
1818(/)S
(FS_BITCHUNK_BITS;)714 1902 A
2925 V
(23423)210 1122 A
3015 V
(23424)210 1122 A
(bit)126 1524 A
1692(=)S
(bit_returned)504 1776 A
2322(%)S
(FS_BITCHUNK_BITS;)714 2406 A
3105 V
(23425)210 1122 A
(mask)168 1524 A
1734(=)S
1818(1)S
1902(<<)S
(bit;)168 2028 A
3195 V
(23426)210 1122 A
3285 V
(23427)210 1122 A
1524(bp)S
1650(=)S
(get_block\(sp->s_dev,)840 1734 A
(start_block)462 2616 A
3120(+)S
(block,)252 3204 A
(NORMAL\);)336 3498 A
3375 V
(23428)210 1122 A
3465 V
(23429)210 1122 A
1524(k)S
1608(=)S
(conv2\(sp->s_native,)798 1692 A
(\(int\))210 2532 A
(bp->b_bitmap[word]\);)840 2784 A
3555 V
(23430)210 1122 A
1524(if)S
(\(!\(k)168 1650 A
1860(&)S
(mask\)\))252 1944 A
2238({)S
3645 V
(23431)210 1122 A
(panic\(__FILE__,map)756 1776 A
2574(==)S
(IMAP)168 2700 A
2910(?)S
("tried)252 2994 A
3288(to)S
(free)168 3414 A
(unused)252 3624 A
(inode")252 3918 A
4212(:)S
3735 V
(23432)210 1122 A
("tried)252 2028 A
2322(to)S
(free)168 2448 A
(unused)252 2658 A
(block",)294 2952 A
(NO_NUM\);)336 3288 A
3825 V
(23433)210 1122 A
1524(})S
3915 V
(23434)210 1122 A
4005 V
(23435)210 1122 A
1524(k)S
1608(&=)S
(\304mask;)252 1734 A
4095 V
(23436)210 1122 A
(bp->b_bitmap[word])756 1524 A
2322(=)S
(conv2\(sp->s_native,)798 2406 A
(\(int\))210 3246 A
(k\);)126 3498 A
4185 V
(23437)210 1122 A
(bp->b_dirt)420 1524 A
1986(=)S
(DIRTY;)252 2070 A
4275 V
(23438)210 1122 A
4365 V
(23439)210 1122 A
(put_block\(bp,)546 1524 A
(MAP_BLOCK\);)462 2112 A
4455 V
(23440)210 1122 A
1440(})S
4635 V
(23442)210 1122 A
(/*===========================================================================*)3276 1440 A
4725 V
(23443)210 1122 A
1482(*)S
(get_super)378 2784 A
4674(*)S
4815 V
(23444)210 1122 A
(*===========================================================================*/)3276 1482 A
4905 V
(23445)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(super_block)462 2028 A
(*get_super\(dev\))630 2532 A
4995 V
(23446)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
2784(/*)S
(device)252 2910 A
(number)252 3204 A
(whose)210 3498 A
(super_block)462 3750 A
4254(is)S
(sought)252 4380 A
4674(*/)S
5085 V
(23447)210 1122 A
1440({)S
5175 V
(23448)210 1122 A
1440(/*)S
(Search)252 1566 A
(the)126 1860 A
(superblock)420 2028 A
(table)210 2490 A
(for)126 2742 A
(this)168 2910 A
(device.)294 3120 A
3498(It)S
3624(is)S
(supposed)336 3750 A
4128(to)S
4254(be)S
(there.)252 4380 A
4674(*/)S
5265 V
(23449)210 1122 A
5355 V
(23450)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(super_block)462 2196 A
(*sp;)168 2700 A
5445 V
(23451)210 1122 A
5535 V
(23452)210 1122 A
1524(if)S
(\(dev)168 1650 A
1860(==)S
(NO_DEV\))294 1986 A
5625 V
(23453)210 1122 A
(panic\(__FILE__,"request)966 1776 A
(for)126 2784 A
(super_block)462 2952 A
3456(of)S
(NO_DEV",)336 3582 A
(NO_NUM\);)336 3960 A
5715 V
(23454)210 1122 A
5805 V
(23455)210 1122 A
(for)126 1524 A
(\(sp)126 1692 A
1860(=)S
(&super_block[0];)672 1944 A
2658(sp)S
2784(<)S
(&super_block[NR_SUPERS];)1008 2868 A
(sp++\))210 3918 A
5895 V
(23456)210 1122 A
1776(if)S
(\(sp->s_dev)420 1902 A
2364(==)S
(dev\))168 2490 A
(return\(sp\);)462 2700 A
5985 V
(23457)210 1122 A
6075 V
(23458)210 1122 A
1524(/*)S
(Search)252 1650 A
(failed.)294 1944 A
(Something)378 2322 A
(wrong.)252 2742 A
3036(*/)S
6165 V
(23459)210 1122 A
(panic\(__FILE__,"can't)882 1524 A
(find)168 2448 A
(superblock)420 2658 A
(for)126 3120 A
(device)252 3288 A
(\(in)126 3582 A
(decimal\)",)420 3750 A
(\(int\))210 4212 A
(dev\);)210 4464 A
6255 V
(23460)210 1122 A
6345 V
(23461)210 1122 A
(return\(NIL_SUPER\);)756 1524 A
2784(/*)S
2910(to)S
(keep)168 3036 A
(the)126 3246 A
(compiler)336 3414 A
(and)126 3792 A
(lint)168 3960 A
(quiet)210 4170 A
4422(*/)S
6435 V
(23462)210 1122 A
1440(})S
6615 V
(23464)210 1122 A
(/*===========================================================================*)3276 1440 A
6705 V
(23465)210 1122 A
1482(*)S
(get_block_size)588 2784 A
4674(*)S
6795 V
(23466)210 1122 A
(*===========================================================================*/)3276 1482 A
6885 V
(23467)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(get_block_size\(dev_t)840 1902 A
(dev\))168 2784 A
6975 V
(23468)210 1122 A
1440({)S
7065 V
(23469)210 1122 A
1440(/*)S
(Search)252 1566 A
(the)126 1860 A
(superblock)420 2028 A
(table)210 2490 A
(for)126 2742 A
(this)168 2910 A
(device.)294 3120 A
3456(*/)S
8418 V
EP
%%Page: 312 312
BP
/slant 0 def
/height 0 def
1485 V
12 B
(312)180 1080 A
11 R
2376(File:)S
2609(servers/fs/super.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(23470)210 1122 A
1845 V
(23471)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(super_block)462 2196 A
(*sp;)168 2700 A
1935 V
(23472)210 1122 A
2025 V
(23473)210 1122 A
1524(if)S
(\(dev)168 1650 A
1860(==)S
(NO_DEV\))294 1986 A
2115 V
(23474)210 1122 A
(panic\(__FILE__,"request)966 1776 A
(for)126 2784 A
(block)210 2952 A
(size)168 3204 A
3414(of)S
(NO_DEV",)336 3540 A
(NO_NUM\);)336 3918 A
2205 V
(23475)210 1122 A
2295 V
(23476)210 1122 A
(for)126 1524 A
(\(sp)126 1692 A
1860(=)S
(&super_block[0];)672 1944 A
2658(sp)S
2784(<)S
(&super_block[NR_SUPERS];)1008 2868 A
(sp++\))210 3918 A
4170({)S
2385 V
(23477)210 1122 A
1776(if)S
(\(sp->s_dev)420 1902 A
2364(==)S
(dev\))168 2490 A
2700({)S
2475 V
(23478)210 1122 A
(return\(sp->s_block_size\);)1050 2112 A
2565 V
(23479)210 1122 A
1776(})S
2655 V
(23480)210 1122 A
1524(})S
2745 V
(23481)210 1122 A
2835 V
(23482)210 1122 A
1524(/*)S
1650(no)S
(mounted)294 1776 A
(filesystem?)462 2112 A
(use)126 2616 A
(this)168 2784 A
(block)210 2994 A
(size)168 3246 A
(then.)210 3456 A
3708(*/)S
2925 V
(23483)210 1122 A
(return)252 1524 A
(MIN_BLOCK_SIZE;)630 1818 A
3015 V
(23484)210 1122 A
1440(})S
3195 V
(23486)210 1122 A
(/*===========================================================================*)3276 1440 A
3285 V
(23487)210 1122 A
1482(*)S
(mounted)294 2784 A
4674(*)S
3375 V
(23488)210 1122 A
(*===========================================================================*/)3276 1482 A
3465 V
(23489)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(mounted\(rip\))504 1902 A
3555 V
(23490)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(inode)210 3372 A
3624(*/)S
3645 V
(23491)210 1122 A
1440({)S
3735 V
(23492)210 1122 A
1440(/*)S
(Report)252 1566 A
1860(on)S
(whether)294 1986 A
(the)126 2322 A
(given)210 2490 A
(inode)210 2742 A
2994(is)S
3120(on)S
3246(a)S
(mounted)294 3330 A
(\(or)126 3666 A
(ROOT\))210 3834 A
(file)168 4086 A
(system.)294 4296 A
4632(*/)S
3825 V
(23493)210 1122 A
3915 V
(23494)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(super_block)462 2196 A
(*sp;)168 2700 A
4005 V
(23495)210 1122 A
(register)336 1524 A
(dev_t)210 1902 A
(dev;)168 2154 A
4095 V
(23496)210 1122 A
4185 V
(23497)210 1122 A
(dev)126 1524 A
1692(=)S
(\(dev_t\))294 1776 A
(rip->i_zone[0];)630 2112 A
4275 V
(23498)210 1122 A
1524(if)S
(\(dev)168 1650 A
1860(==)S
(root_dev\))378 1986 A
(return\(TRUE\);)546 2406 A
3120(/*)S
(inode)210 3246 A
3498(is)S
3624(on)S
(root)168 3750 A
(file)168 3960 A
(system)252 4170 A
4464(*/)S
4365 V
(23499)210 1122 A
4455 V
(23500)210 1122 A
(for)126 1524 A
(\(sp)126 1692 A
1860(=)S
(&super_block[0];)672 1944 A
2658(sp)S
2784(<)S
(&super_block[NR_SUPERS];)1008 2868 A
(sp++\))210 3918 A
4545 V
(23501)210 1122 A
1776(if)S
(\(sp->s_dev)420 1902 A
2364(==)S
(dev\))168 2490 A
(return\(TRUE\);)546 2700 A
4635 V
(23502)210 1122 A
4725 V
(23503)210 1122 A
(return\(FALSE\);)588 1524 A
4815 V
(23504)210 1122 A
1440(})S
4995 V
(23506)210 1122 A
(/*===========================================================================*)3276 1440 A
5085 V
(23507)210 1122 A
1482(*)S
(read_super)420 2784 A
4674(*)S
5175 V
(23508)210 1122 A
(*===========================================================================*/)3276 1482 A
5265 V
(23509)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(read_super\(sp\))588 1902 A
5355 V
(23510)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(super_block)462 2112 A
(*sp;)168 2616 A
2826(/*)S
(pointer)294 2952 A
3288(to)S
3414(a)S
(superblock)420 3498 A
3960(*/)S
5445 V
(23511)210 1122 A
1440({)S
5535 V
(23512)210 1122 A
1440(/*)S
(Read)168 1566 A
1776(a)S
(superblock.)462 1860 A
2364(*/)S
5625 V
(23513)210 1122 A
(dev_t)210 1524 A
(dev;)168 1776 A
5715 V
(23514)210 1122 A
(int)126 1524 A
(magic;)252 1692 A
5805 V
(23515)210 1122 A
(int)126 1524 A
(version,)336 1692 A
(native,)294 2070 A
2406(r;)S
5895 V
(23516)210 1122 A
(static)252 1524 A
(char)168 1818 A
(sbbuf[MIN_BLOCK_SIZE];)924 2028 A
5985 V
(23517)210 1122 A
6075 V
(23518)210 1122 A
(dev)126 1524 A
1692(=)S
(sp->s_dev;)420 1776 A
2784(/*)S
(save)168 2910 A
(device)252 3120 A
(\(will)210 3414 A
3666(be)S
(overwritten)462 3792 A
4296(by)S
(copy\))210 4422 A
4674(*/)S
6165 V
(23519)210 1122 A
1524(if)S
(\(dev)168 1650 A
1860(==)S
(NO_DEV\))294 1986 A
6255 V
(23520)210 1122 A
(panic\(__FILE__,"request)966 1776 A
(for)126 2784 A
(super_block)462 2952 A
3456(of)S
(NO_DEV",)336 3582 A
(NO_NUM\);)336 3960 A
6345 V
(23521)210 1122 A
1524(r)S
1608(=)S
(dev_io\(DEV_READ,)672 1692 A
(dev,)168 2406 A
(FS_PROC_NR,)462 2616 A
6435 V
(23522)210 1122 A
(sbbuf,)252 1776 A
(SUPER_BLOCK_BYTES,)756 2070 A
(MIN_BLOCK_SIZE,)630 2868 A
(0\);)126 3540 A
6525 V
(23523)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(MIN_BLOCK_SIZE\))630 1902 A
2574({)S
6615 V
(23524)210 1122 A
(return)252 1776 A
(EINVAL;)294 2070 A
6705 V
(23525)210 1122 A
1524(})S
6795 V
(23526)210 1122 A
(memcpy\(sp,)420 1524 A
(sbbuf,)252 1986 A
(sizeof\(*sp\)\);)546 2280 A
6885 V
(23527)210 1122 A
(sp->s_dev)378 1524 A
1944(=)S
(NO_DEV;)294 2028 A
2784(/*)S
(restore)294 2910 A
(later)210 3246 A
3498(*/)S
6975 V
(23528)210 1122 A
(magic)210 1524 A
1776(=)S
(sp->s_magic;)504 1860 A
2784(/*)S
(determines)420 2910 A
(file)168 3372 A
(system)252 3582 A
(type)168 3876 A
4086(*/)S
7065 V
(23529)210 1122 A
8418 V
EP
%%Page: 313 313
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2376(File:)S
2609(servers/fs/super.c)S
12 B
(313)180 4500 A
1755 V
7 LST
(23530)210 1122 A
1524(/*)S
(Get)126 1650 A
(file)168 1818 A
(system)252 2028 A
(version)294 2322 A
(and)126 2658 A
(type.)210 2826 A
3078(*/)S
1845 V
(23531)210 1122 A
1524(if)S
(\(magic)252 1650 A
1944(==)S
(SUPER_MAGIC)462 2070 A
2574(||)S
(magic)210 2700 A
2952(==)S
(conv2\(BYTE_SWAP,)672 3078 A
(SUPER_MAGIC\)\))546 3792 A
4380({)S
1935 V
(23532)210 1122 A
(version)294 1776 A
2112(=)S
(V1;)126 2196 A
2025 V
(23533)210 1122 A
(native)252 1776 A
2112(=)S
(\(magic)252 2196 A
2490(==)S
(SUPER_MAGIC\);)546 2616 A
2115 V
(23534)210 1122 A
1524(})S
(else)168 1608 A
1818(if)S
(\(magic)252 1944 A
2238(==)S
(SUPER_V2)336 2364 A
2742(||)S
(magic)210 2868 A
3120(==)S
(conv2\(BYTE_SWAP,)672 3246 A
(SUPER_V2\)\))420 3960 A
4422({)S
2205 V
(23535)210 1122 A
(version)294 1776 A
2112(=)S
(V2;)126 2196 A
2295 V
(23536)210 1122 A
(native)252 1776 A
2112(=)S
(\(magic)252 2196 A
2490(==)S
(SUPER_V2\);)420 2616 A
2385 V
(23537)210 1122 A
1524(})S
(else)168 1608 A
1818(if)S
(\(magic)252 1944 A
2238(==)S
(SUPER_V3\))378 2364 A
2784({)S
2475 V
(23538)210 1122 A
(version)294 1776 A
2112(=)S
(V3;)126 2196 A
2565 V
(23539)210 1122 A
(native)252 1776 A
2070(=)S
2154(1;)S
2655 V
(23540)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
2745 V
(23541)210 1122 A
(return\(EINVAL\);)630 1776 A
2835 V
(23542)210 1122 A
1524(})S
2925 V
(23543)210 1122 A
3015 V
(23544)210 1122 A
1524(/*)S
1650(If)S
(the)126 1776 A
(super)210 1944 A
(block)210 2196 A
(has)126 2448 A
(the)126 2616 A
(wrong)210 2784 A
(byte)168 3036 A
(order,)252 3246 A
(swap)168 3540 A
(the)126 3750 A
(fields;)294 3918 A
(the)126 4254 A
(magic)210 4422 A
3105 V
(23545)210 1122 A
1566(*)S
(number)252 1650 A
(doesn't)294 1944 A
(need)168 2280 A
(conversion.)462 2490 A
2994(*/)S
3195 V
(23546)210 1122 A
(sp->s_ninodes)546 1524 A
2112(=)S
(conv4\(native,)546 2448 A
(sp->s_ninodes\);)630 3036 A
3285 V
(23547)210 1122 A
(sp->s_nzones)504 1524 A
2070(=)S
(conv2\(native,)546 2448 A
(\(int\))210 3036 A
(sp->s_nzones\);)588 3288 A
3375 V
(23548)210 1122 A
(sp->s_imap_blocks)714 1524 A
2280(=)S
(conv2\(native,)546 2448 A
(\(int\))210 3036 A
(sp->s_imap_blocks\);)798 3288 A
3465 V
(23549)210 1122 A
(sp->s_zmap_blocks)714 1524 A
2280(=)S
(conv2\(native,)546 2448 A
(\(int\))210 3036 A
(sp->s_zmap_blocks\);)798 3288 A
3555 V
(23550)210 1122 A
(sp->s_firstdatazone)798 1524 A
2364(=)S
(conv2\(native,)546 2448 A
(\(int\))210 3036 A
(sp->s_firstdatazone\);)882 3288 A
3645 V
(23551)210 1122 A
(sp->s_log_zone_size)798 1524 A
2364(=)S
(conv2\(native,)546 2448 A
(\(int\))210 3036 A
(sp->s_log_zone_size\);)882 3288 A
3735 V
(23552)210 1122 A
(sp->s_max_size)588 1524 A
2154(=)S
(conv4\(native,)546 2448 A
(sp->s_max_size\);)672 3036 A
3825 V
(23553)210 1122 A
(sp->s_zones)462 1524 A
2028(=)S
(conv4\(native,)546 2448 A
(sp->s_zones\);)546 3036 A
3915 V
(23554)210 1122 A
4005 V
(23555)210 1122 A
1524(/*)S
1650(In)S
(V1,)126 1776 A
(the)126 1944 A
(device)252 2112 A
(size)168 2406 A
(was)126 2616 A
(kept)168 2784 A
2994(in)S
3120(a)S
(short,)252 3204 A
(s_nzones,)378 3498 A
(which)210 3918 A
(limited)294 4170 A
4095 V
(23556)210 1122 A
1566(*)S
(devices)294 1650 A
1986(to)S
(32K)126 2112 A
(zones.)252 2280 A
(For)126 2616 A
(V2,)126 2784 A
2952(it)S
(was)126 3078 A
(decided)294 3246 A
3582(to)S
(keep)168 3708 A
(the)126 3918 A
(size)168 4086 A
4296(as)S
4422(a)S
4185 V
(23557)210 1122 A
1566(*)S
(long.)210 1650 A
(However,)336 1944 A
(just)168 2322 A
(changing)336 2532 A
(s_nzones)336 2910 A
3288(to)S
3414(a)S
(long)168 3498 A
(would)210 3708 A
(not)126 3960 A
(work,)210 4128 A
(since)210 4380 A
4275 V
(23558)210 1122 A
1566(*)S
(then)168 1650 A
(the)126 1860 A
(position)336 2028 A
2406(of)S
(s_magic)294 2532 A
2868(in)S
(the)126 2994 A
(super)210 3162 A
(block)210 3414 A
(would)210 3666 A
(not)126 3918 A
4086(be)S
(the)126 4212 A
(same)168 4380 A
4365 V
(23559)210 1122 A
1566(*)S
1650(in)S
1776(V1)S
(and)126 1902 A
2070(V2)S
(file)168 2196 A
(systems,)336 2406 A
(and)126 2784 A
(there)210 2952 A
(would)210 3204 A
3456(be)S
3582(no)S
(way)126 3708 A
3876(to)S
(tell)168 4002 A
(whether)294 4212 A
4455 V
(23560)210 1122 A
1566(*)S
1650(a)S
(newly)210 1734 A
(mounted)294 1986 A
(file)168 2322 A
(system)252 2532 A
(was)126 2826 A
2994(V1)S
3120(or)S
(V2.)126 3246 A
(The)126 3456 A
(solution)336 3624 A
(was)126 4002 A
4170(to)S
(introduce)378 4296 A
4545 V
(23561)210 1122 A
1566(*)S
1650(a)S
(new)126 1734 A
(variable,)378 1902 A
(s_zones,)336 2322 A
(and)126 2700 A
(copy)168 2868 A
(the)126 3078 A
(size)168 3246 A
(there.)252 3456 A
4635 V
(23562)210 1122 A
1566(*)S
4725 V
(23563)210 1122 A
1566(*)S
(Calculate)378 1650 A
(some)168 2070 A
(other)210 2280 A
(numbers)294 2532 A
(that)168 2868 A
(depend)252 3078 A
3372(on)S
(the)126 3498 A
(version)294 3666 A
(here)168 4002 A
(too,)168 4212 A
4422(to)S
4815 V
(23564)210 1122 A
1566(*)S
(hide)168 1650 A
(some)168 1860 A
2070(of)S
(the)126 2196 A
(differences.)504 2364 A
4905 V
(23565)210 1122 A
1566(*/)S
4995 V
(23566)210 1122 A
1524(if)S
(\(version)336 1650 A
2028(==)S
(V1\))126 2154 A
2322({)S
5085 V
(23567)210 1122 A
(sp->s_block_size)672 1776 A
2490(=)S
(STATIC_BLOCK_SIZE;)756 2574 A
5175 V
(23568)210 1122 A
(sp->s_zones)462 1776 A
2280(=)S
(sp->s_nzones;)546 2364 A
3120(/*)S
(only)168 3246 A
3456(V1)S
(needs)210 3582 A
(this)168 3834 A
(copy)168 4044 A
4254(*/)S
5265 V
(23569)210 1122 A
(sp->s_inodes_per_block)924 1776 A
2742(=)S
(V1_INODES_PER_BLOCK;)840 2826 A
5355 V
(23570)210 1122 A
(sp->s_ndzones)546 1776 A
2364(=)S
(V1_NR_DZONES;)546 2448 A
5445 V
(23571)210 1122 A
(sp->s_nindirs)546 1776 A
2364(=)S
(V1_INDIRECTS;)546 2448 A
5535 V
(23572)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
5625 V
(23573)210 1122 A
1776(if)S
(\(version)336 1902 A
2280(==)S
(V2\))126 2406 A
5715 V
(23574)210 1122 A
(sp->s_block_size)672 2112 A
2826(=)S
(STATIC_BLOCK_SIZE;)756 2910 A
5805 V
(23575)210 1122 A
1776(if)S
(\(sp->s_block_size)714 1902 A
2658(<)S
(MIN_BLOCK_SIZE\))630 2742 A
5895 V
(23576)210 1122 A
(return)252 2112 A
(EINVAL;)294 2406 A
5985 V
(23577)210 1122 A
(sp->s_inodes_per_block)924 1776 A
2742(=)S
(V2_INODES_PER_BLOCK\(sp->s_block_size\);)1596 2826 A
6075 V
(23578)210 1122 A
(sp->s_ndzones)546 1776 A
2364(=)S
(V2_NR_DZONES;)546 2448 A
6165 V
(23579)210 1122 A
(sp->s_nindirs)546 1776 A
2364(=)S
(V2_INDIRECTS\(sp->s_block_size\);)1302 2448 A
6255 V
(23580)210 1122 A
1524(})S
6345 V
(23581)210 1122 A
6435 V
(23582)210 1122 A
1524(if)S
(\(sp->s_block_size)714 1650 A
2406(<)S
(MIN_BLOCK_SIZE\))630 2490 A
3162({)S
6525 V
(23583)210 1122 A
(return)252 1776 A
(EINVAL;)294 2070 A
6615 V
(23584)210 1122 A
1524(})S
6705 V
(23585)210 1122 A
1524(if)S
(\(sp->s_block_size)714 1650 A
2406(>)S
(MAX_BLOCK_SIZE\))630 2490 A
3162({)S
6795 V
(23586)210 1122 A
(printf\("Filesystem)756 1776 A
(block)210 2574 A
(size)168 2826 A
3036(is)S
3162(%d)S
(kB;)126 3288 A
(maximum)294 3456 A
(filesystem\\n")546 3792 A
6885 V
(23587)210 1122 A
("block)252 1776 A
(size)168 2070 A
2280(is)S
2406(%d)S
(kB.)126 2532 A
(This)168 2700 A
(limit)210 2910 A
(can)126 3162 A
3330(be)S
(increased)378 3456 A
3876(by)S
(recompiling.\\n",)672 4002 A
6975 V
(23588)210 1122 A
(sp->s_block_size/1024,)924 1776 A
(MAX_BLOCK_SIZE/1024\);)882 2742 A
7065 V
(23589)210 1122 A
(return)252 1776 A
(EINVAL;)294 2070 A
8418 V
EP
%%Page: 314 314
BP
/slant 0 def
/height 0 def
1485 V
12 B
(314)180 1080 A
11 R
2376(File:)S
2609(servers/fs/super.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(23590)210 1122 A
1524(})S
1845 V
(23591)210 1122 A
1524(if)S
(\(\(sp->s_block_size)756 1650 A
2448(%)S
(512\))168 2532 A
2742(!=)S
2868(0\))S
2994({)S
1935 V
(23592)210 1122 A
(return)252 1776 A
(EINVAL;)294 2070 A
2025 V
(23593)210 1122 A
1524(})S
2115 V
(23594)210 1122 A
1524(if)S
(\(SUPER_SIZE)462 1650 A
2154(>)S
(sp->s_block_size\))714 2238 A
2994({)S
2205 V
(23595)210 1122 A
(return)252 1776 A
(EINVAL;)294 2070 A
2295 V
(23596)210 1122 A
1524(})S
2385 V
(23597)210 1122 A
1524(if)S
(\(\(sp->s_block_size)756 1650 A
2448(%)S
(V2_INODE_SIZE\))588 2532 A
3162(!=)S
3288(0)S
3372(||)S
2475 V
(23598)210 1122 A
(\(sp->s_block_size)714 1650 A
2406(%)S
(V1_INODE_SIZE\))588 2490 A
3120(!=)S
3246(0\))S
3372({)S
2565 V
(23599)210 1122 A
(return)252 1776 A
(EINVAL;)294 2070 A
2655 V
(23600)210 1122 A
1524(})S
2745 V
(23601)210 1122 A
2835 V
(23602)210 1122 A
(sp->s_isearch)546 1524 A
2112(=)S
2196(0;)S
2784(/*)S
(inode)210 2910 A
(searches)336 3162 A
(initially)378 3540 A
(start)210 3960 A
4212(at)S
4338(0)S
4422(*/)S
2925 V
(23603)210 1122 A
(sp->s_zsearch)546 1524 A
2112(=)S
2196(0;)S
2784(/*)S
(zone)168 2910 A
(searches)336 3120 A
(initially)378 3498 A
(start)210 3918 A
4170(at)S
4296(0)S
4380(*/)S
3015 V
(23604)210 1122 A
(sp->s_version)546 1524 A
2112(=)S
(version;)336 2196 A
3105 V
(23605)210 1122 A
(sp->s_native)504 1524 A
2112(=)S
(native;)294 2196 A
3195 V
(23606)210 1122 A
3285 V
(23607)210 1122 A
1524(/*)S
(Make)168 1650 A
1860(a)S
(few)126 1944 A
(basic)210 2112 A
(checks)252 2364 A
2658(to)S
(see)126 2784 A
2952(if)S
(super)210 3078 A
(block)210 3330 A
(looks)210 3582 A
(reasonable.)462 3834 A
4338(*/)S
3375 V
(23608)210 1122 A
1524(if)S
(\(sp->s_imap_blocks)756 1650 A
2448(<)S
2532(1)S
2616(||)S
(sp->s_zmap_blocks)714 2742 A
3498(<)S
3582(1)S
3465 V
(23609)210 1122 A
2784(||)S
(sp->s_ninodes)546 2910 A
3498(<)S
3582(1)S
3666(||)S
(sp->s_zones)462 3792 A
4296(<)S
4380(1)S
3555 V
(23610)210 1122 A
2784(||)S
(\(unsigned\))420 2910 A
(sp->s_log_zone_size)798 3372 A
4212(>)S
4296(4\))S
4422({)S
3645 V
(23611)210 1122 A
(printf\("not)462 1776 A
(enough)252 2280 A
(imap)168 2574 A
2784(or)S
(zone)168 2910 A
(map)126 3120 A
(blocks,)294 3288 A
(\\n"\);)210 3624 A
3735 V
(23612)210 1122 A
(printf\("or)420 1776 A
(not)126 2238 A
(enough)252 2406 A
(inodes,)294 2700 A
3036(or)S
(not)126 3162 A
(enough)252 3330 A
(zones,)252 3624 A
3918(")S
3825 V
(23613)210 1122 A
("or)126 2112 A
(zone)168 2280 A
(size)168 2490 A
(too)126 2700 A
(large\\n"\);)420 2868 A
3915 V
(23614)210 1122 A
(return\(EINVAL\);)630 1776 A
4005 V
(23615)210 1122 A
1524(})S
4095 V
(23616)210 1122 A
(sp->s_dev)378 1524 A
1944(=)S
(dev;)168 2028 A
2784(/*)S
(restore)294 2910 A
(device)252 3246 A
(number)252 3540 A
3834(*/)S
4185 V
(23617)210 1122 A
(return\(OK\);)462 1524 A
4275 V
(23618)210 1122 A
1440(})S
4545 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4635 V
(servers/fs/filedes.c)840 2676 A
4725 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4905 V
(23700)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(procedures)420 2532 A
(that)168 2994 A
(manipulate)420 3204 A
(file)168 3666 A
(descriptors.)504 3876 A
4995 V
(23701)210 1122 A
1482(*)S
5085 V
(23702)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are)126 2910 A
5175 V
(23703)210 1122 A
1482(*)S
(get_fd:)294 1650 A
(look)168 2112 A
(for)126 2322 A
(free)168 2490 A
(file)168 2700 A
(descriptor)420 2910 A
(and)126 3372 A
(free)168 3540 A
(filp)168 3750 A
(slots)210 3960 A
5265 V
(23704)210 1122 A
1482(*)S
(get_filp:)378 1650 A
(look)168 2112 A
2322(up)S
(the)126 2448 A
(filp)168 2616 A
(entry)210 2826 A
(for)126 3078 A
3246(a)S
(given)210 3330 A
(file)168 3582 A
(descriptor)420 3792 A
5355 V
(23705)210 1122 A
1482(*)S
(find_filp:)420 1650 A
(find)168 2112 A
2322(a)S
(filp)168 2406 A
(slot)168 2616 A
(that)168 2826 A
(points)252 3036 A
3330(to)S
3456(a)S
(given)210 3540 A
(inode)210 3792 A
5445 V
(23706)210 1122 A
1482(*/)S
5535 V
(23707)210 1122 A
5625 V
(23708)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
5715 V
(23709)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
5805 V
(23710)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
5895 V
(23711)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
5985 V
(23712)210 1122 A
6075 V
(23713)210 1122 A
(/*===========================================================================*)3276 1440 A
6165 V
(23714)210 1122 A
1482(*)S
(get_fd)252 2784 A
4674(*)S
6255 V
(23715)210 1122 A
(*===========================================================================*/)3276 1482 A
6345 V
(23716)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(get_fd\(int)420 1902 A
(start,)252 2364 A
(mode_t)252 2658 A
(bits,)210 2952 A
(int)126 3204 A
(*k,)126 3372 A
(struct)252 3540 A
(filp)168 3834 A
(**fpt\))252 4044 A
6435 V
(23717)210 1122 A
1440({)S
6525 V
(23718)210 1122 A
1440(/*)S
(Look)168 1566 A
(for)126 1776 A
1944(a)S
(free)168 2028 A
(file)168 2238 A
(descriptor)420 2448 A
(and)126 2910 A
3078(a)S
(free)168 3162 A
(filp)168 3372 A
(slot.)210 3582 A
(Fill)168 3876 A
4086(in)S
(the)126 4212 A
(mode)168 4380 A
(word)168 4590 A
6615 V
(23719)210 1122 A
1482(*)S
1566(in)S
(the)126 1692 A
(latter,)294 1860 A
(but)126 2196 A
(don't)210 2364 A
(claim)210 2616 A
(either)252 2868 A
(one)126 3162 A
(yet,)168 3330 A
(since)210 3540 A
(the)126 3792 A
(open\(\))252 3960 A
4254(or)S
(creat\(\))294 4380 A
6705 V
(23720)210 1122 A
1482(*)S
(may)126 1566 A
(yet)126 1734 A
(fail.)210 1902 A
6795 V
(23721)210 1122 A
1482(*/)S
6885 V
(23722)210 1122 A
6975 V
(23723)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(filp)168 2196 A
(*f;)126 2406 A
7065 V
(23724)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(i;)S
8418 V
EP
%%Page: 315 315
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2347(File:)S
2580(servers/fs/filedes.c)S
12 B
(315)180 4500 A
1755 V
7 LST
(23725)210 1122 A
1845 V
(23726)210 1122 A
1524(*k)S
1650(=)S
(-1;)126 1734 A
2784(/*)S
2910(we)S
(need)168 3036 A
3246(a)S
(way)126 3330 A
3498(to)S
(tell)168 3624 A
3834(if)S
(file)168 3960 A
(desc)168 4170 A
(found)210 4380 A
4632(*/)S
1935 V
(23727)210 1122 A
2025 V
(23728)210 1122 A
1524(/*)S
(Search)252 1650 A
(the)126 1944 A
(fproc)210 2112 A
(fp_filp)294 2364 A
(table)210 2700 A
(for)126 2952 A
3120(a)S
(free)168 3204 A
(file)168 3414 A
(descriptor.)462 3624 A
4128(*/)S
2115 V
(23729)210 1122 A
(for)126 1524 A
1692(\(i)S
1818(=)S
(start;)252 1902 A
2196(i)S
2280(<)S
(OPEN_MAX;)378 2364 A
(i++\))168 2784 A
2994({)S
2205 V
(23730)210 1122 A
1776(if)S
(\(fp->fp_filp[i])630 1902 A
2574(==)S
(NIL_FILP\))378 2700 A
3120({)S
2295 V
(23731)210 1122 A
2112(/*)S
2238(A)S
(file)168 2322 A
(descriptor)420 2532 A
(has)126 2994 A
(been)168 3162 A
(located.)336 3372 A
3750(*/)S
2385 V
(23732)210 1122 A
2112(*k)S
2238(=)S
2322(i;)S
2475 V
(23733)210 1122 A
(break;)252 2112 A
2565 V
(23734)210 1122 A
1776(})S
2655 V
(23735)210 1122 A
1524(})S
2745 V
(23736)210 1122 A
2835 V
(23737)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(to)S
(see)126 2028 A
2196(if)S
2322(a)S
(file)168 2406 A
(descriptor)420 2616 A
(has)126 3078 A
(been)168 3246 A
(found.)252 3456 A
3750(*/)S
2925 V
(23738)210 1122 A
1524(if)S
(\(*k)126 1650 A
1818(<)S
1902(0\))S
(return\(EMFILE\);)630 2028 A
2784(/*)S
(this)168 2910 A
3120(is)S
(why)126 3246 A
3414(we)S
(initialized)462 3540 A
4044(k)S
4128(to)S
4254(-1)S
4380(*/)S
3015 V
(23739)210 1122 A
3105 V
(23740)210 1122 A
1524(/*)S
(Now)126 1650 A
(that)168 1818 A
2028(a)S
(file)168 2112 A
(descriptor)420 2322 A
(has)126 2784 A
(been)168 2952 A
(found,)252 3162 A
(look)168 3456 A
(for)126 3666 A
3834(a)S
(free)168 3918 A
(filp)168 4128 A
(slot.)210 4338 A
4590(*/)S
3195 V
(23741)210 1122 A
(for)126 1524 A
1692(\(f)S
1818(=)S
(&filp[0];)378 1902 A
2322(f)S
2406(<)S
(&filp[NR_FILPS];)672 2490 A
(f++\))168 3204 A
3414({)S
3285 V
(23742)210 1122 A
1776(if)S
(\(f->filp_count)588 1902 A
2532(==)S
2658(0\))S
2784({)S
3375 V
(23743)210 1122 A
(f->filp_mode)504 2112 A
2658(=)S
(bits;)210 2742 A
3465 V
(23744)210 1122 A
(f->filp_pos)462 2112 A
2616(=)S
(0L;)126 2700 A
3555 V
(23745)210 1122 A
(f->filp_selectors)714 2112 A
2868(=)S
2952(0;)S
3645 V
(23746)210 1122 A
(f->filp_select_ops)756 2112 A
2910(=)S
2994(0;)S
3735 V
(23747)210 1122 A
(f->filp_pipe_select_ops)966 2112 A
3120(=)S
3204(0;)S
3825 V
(23748)210 1122 A
(f->filp_flags)546 2112 A
2700(=)S
2784(0;)S
3915 V
(23749)210 1122 A
(*fpt)168 2112 A
2322(=)S
2406(f;)S
4005 V
(23750)210 1122 A
(return\(OK\);)462 2112 A
4095 V
(23751)210 1122 A
1776(})S
4185 V
(23752)210 1122 A
1524(})S
4275 V
(23753)210 1122 A
4365 V
(23754)210 1122 A
1524(/*)S
1650(If)S
(control)294 1776 A
(passes)252 2112 A
(here,)210 2406 A
(the)126 2658 A
(filp)168 2826 A
(table)210 3036 A
(must)168 3288 A
3498(be)S
(full.)210 3624 A
(Report)252 3918 A
(that)168 4212 A
(back.)210 4422 A
4674(*/)S
4455 V
(23755)210 1122 A
(return\(ENFILE\);)630 1524 A
4545 V
(23756)210 1122 A
1440(})S
4725 V
(23758)210 1122 A
(/*===========================================================================*)3276 1440 A
4815 V
(23759)210 1122 A
1482(*)S
(get_filp)336 2784 A
4674(*)S
4905 V
(23760)210 1122 A
(*===========================================================================*/)3276 1482 A
4995 V
(23761)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(filp)168 2028 A
(*get_filp\(fild\))630 2238 A
5085 V
(23762)210 1122 A
(int)126 1440 A
(fild;)210 1608 A
2784(/*)S
(file)168 2910 A
(descriptor)420 3120 A
3582(*/)S
5175 V
(23763)210 1122 A
1440({)S
5265 V
(23764)210 1122 A
1440(/*)S
(See)126 1566 A
1734(if)S
('fild')252 1860 A
(refers)252 2154 A
2448(to)S
2574(a)S
(valid)210 2658 A
(file)168 2910 A
(descr.)252 3120 A
3456(If)S
(so,)126 3582 A
(return)252 3750 A
(its)126 4044 A
(filp)168 4212 A
(ptr.)168 4422 A
4632(*/)S
5355 V
(23765)210 1122 A
5445 V
(23766)210 1122 A
(err_code)336 1524 A
1902(=)S
(EBADF;)252 1986 A
5535 V
(23767)210 1122 A
1524(if)S
(\(fild)210 1650 A
1902(<)S
1986(0)S
2070(||)S
(fild)168 2196 A
2406(>=)S
(OPEN_MAX)336 2532 A
2910(\))S
(return\(NIL_FILP\);)714 2994 A
5625 V
(23768)210 1122 A
(return\(fp->fp_filp[fild]\);)1092 1524 A
2784(/*)S
(may)126 2910 A
(also)168 3078 A
3288(be)S
(NIL_FILP)336 3414 A
3792(*/)S
5715 V
(23769)210 1122 A
1440(})S
5895 V
(23771)210 1122 A
(/*===========================================================================*)3276 1440 A
5985 V
(23772)210 1122 A
1482(*)S
(find_filp)378 2784 A
4674(*)S
6075 V
(23773)210 1122 A
(*===========================================================================*/)3276 1482 A
6165 V
(23774)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(filp)168 2028 A
(*find_filp\(register)798 2238 A
(struct)252 3078 A
(inode)210 3372 A
(*rip,)210 3624 A
(mode_t)252 3876 A
(bits\))210 4170 A
6255 V
(23775)210 1122 A
1440({)S
6345 V
(23776)210 1122 A
1440(/*)S
(Find)168 1566 A
1776(a)S
(filp)168 1860 A
(slot)168 2070 A
(that)168 2280 A
(refers)252 2490 A
2784(to)S
(the)126 2910 A
(inode)210 3078 A
('rip')210 3330 A
3582(in)S
3708(a)S
(way)126 3792 A
3960(as)S
(described)378 4086 A
6435 V
(23777)210 1122 A
1482(*)S
1566(by)S
(the)126 1692 A
(mode)168 1860 A
(bit)126 2070 A
('bits'.)294 2238 A
(Used)168 2574 A
(for)126 2784 A
(determining)462 2952 A
(whether)294 3456 A
(somebody)336 3792 A
4170(is)S
(still)210 4296 A
6525 V
(23778)210 1122 A
1482(*)S
(interested)420 1566 A
2028(in)S
(either)252 2154 A
(end)126 2448 A
2616(of)S
2742(a)S
(pipe.)210 2826 A
(Also)168 3120 A
(used)168 3330 A
(when)168 3540 A
(opening)294 3750 A
4086(a)S
(FIFO)168 4170 A
4380(to)S
6615 V
(23779)210 1122 A
1482(*)S
(find)168 1566 A
(partners)336 1776 A
2154(to)S
(share)210 2280 A
2532(a)S
(filp)168 2616 A
(field)210 2826 A
(with)168 3078 A
(\(to)126 3288 A
(shared)252 3456 A
(the)126 3750 A
(file)168 3918 A
(position\).)420 4128 A
6705 V
(23780)210 1122 A
1482(*)S
(Like)168 1566 A
('get_fd')336 1776 A
2154(it)S
(performs)336 2280 A
(its)126 2658 A
(job)126 2826 A
2994(by)S
(linear)252 3120 A
(search)252 3414 A
(through)294 3708 A
(the)126 4044 A
(filp)168 4212 A
(table.)252 4422 A
6795 V
(23781)210 1122 A
1482(*/)S
6885 V
(23782)210 1122 A
6975 V
(23783)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(filp)168 2196 A
(*f;)126 2406 A
7065 V
(23784)210 1122 A
8418 V
EP
%%Page: 316 316
BP
/slant 0 def
/height 0 def
1485 V
12 B
(316)180 1080 A
11 R
2347(File:)S
2580(servers/fs/filedes.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(23785)210 1122 A
(for)126 1524 A
1692(\(f)S
1818(=)S
(&filp[0];)378 1902 A
2322(f)S
2406(<)S
(&filp[NR_FILPS];)672 2490 A
(f++\))168 3204 A
3414({)S
1845 V
(23786)210 1122 A
1776(if)S
(\(f->filp_count)588 1902 A
2532(!=)S
2658(0)S
2742(&&)S
(f->filp_ino)462 2868 A
3372(==)S
(rip)126 3498 A
3666(&&)S
(\(f->filp_mode)546 3792 A
4380(&)S
(bits\)\){)294 4464 A
1935 V
(23787)210 1122 A
(return\(f\);)420 2112 A
2025 V
(23788)210 1122 A
1776(})S
2115 V
(23789)210 1122 A
1524(})S
2205 V
(23790)210 1122 A
2295 V
(23791)210 1122 A
1524(/*)S
1650(If)S
(control)294 1776 A
(passes)252 2112 A
(here,)210 2406 A
(the)126 2658 A
(filp)168 2826 A
(wasn't)252 3036 A
(there.)252 3330 A
(Report)252 3666 A
(that)168 3960 A
(back.)210 4170 A
4422(*/)S
2385 V
(23792)210 1122 A
(return\(NIL_FILP\);)714 1524 A
2475 V
(23793)210 1122 A
1440(})S
2745 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2835 V
(servers/fs/lock.c)714 2676 A
2925 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3105 V
(23800)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(handles)294 1986 A
(advisory)336 2322 A
(file)168 2700 A
(locking)294 2910 A
3246(as)S
(required)336 3372 A
3750(by)S
(POSIX.)252 3876 A
3195 V
(23801)210 1122 A
1482(*)S
3285 V
(23802)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are)126 2910 A
3375 V
(23803)210 1122 A
1482(*)S
(lock_op:)336 1650 A
(perform)294 2112 A
(locking)294 2448 A
(operations)420 2784 A
(for)126 3246 A
(FCNTL)210 3414 A
(system)252 3666 A
(call)168 3960 A
3465 V
(23804)210 1122 A
1482(*)S
(lock_revive:)504 1650 A
(revive)252 2196 A
(processes)378 2490 A
(when)168 2910 A
3120(a)S
(lock)168 3204 A
3414(is)S
(released)336 3540 A
3555 V
(23805)210 1122 A
1482(*/)S
3645 V
(23806)210 1122 A
3735 V
(23807)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
3825 V
(23808)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
3915 V
(23809)210 1122 A
(#include)336 1440 A
(<fcntl.h>)378 1818 A
4005 V
(23810)210 1122 A
(#include)336 1440 A
(<unistd.h>)420 1818 A
4095 V
(23811)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
4185 V
(23812)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
4275 V
(23813)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
4365 V
(23814)210 1122 A
(#include)336 1440 A
("lock.h")336 1818 A
4455 V
(23815)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
4545 V
(23816)210 1122 A
4635 V
(23817)210 1122 A
(/*===========================================================================*)3276 1440 A
4725 V
(23818)210 1122 A
1482(*)S
(lock_op)294 2784 A
4674(*)S
4815 V
(23819)210 1122 A
(*===========================================================================*/)3276 1482 A
4905 V
(23820)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(lock_op\(f,)420 1902 A
(req\))168 2364 A
4995 V
(23821)210 1122 A
(struct)252 1440 A
(filp)168 1734 A
(*f;)126 1944 A
5085 V
(23822)210 1122 A
(int)126 1440 A
(req;)168 1608 A
2784(/*)S
(either)252 2910 A
(F_SETLK)294 3204 A
3540(or)S
(F_SETLKW)336 3666 A
4044(*/)S
5175 V
(23823)210 1122 A
1440({)S
5265 V
(23824)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(advisory)336 2070 A
(locking)294 2448 A
(required)336 2784 A
3162(by)S
(POSIX.)252 3288 A
3582(*/)S
5355 V
(23825)210 1122 A
5445 V
(23826)210 1122 A
(int)126 1524 A
1692(r,)S
(ltype,)252 1818 A
2112(i,)S
(conflict)336 2238 A
2616(=)S
2700(0,)S
(unlocking)378 2826 A
3246(=)S
3330(0;)S
5535 V
(23827)210 1122 A
(mode_t)252 1524 A
(mo;)126 1818 A
5625 V
(23828)210 1122 A
(off_t)210 1524 A
(first,)252 1776 A
(last;)210 2070 A
5715 V
(23829)210 1122 A
(struct)252 1524 A
(flock)210 1818 A
(flock;)252 2070 A
5805 V
(23830)210 1122 A
(vir_bytes)378 1524 A
(user_flock;)462 1944 A
5895 V
(23831)210 1122 A
(struct)252 1524 A
(file_lock)378 1818 A
(*flp,)210 2238 A
(*flp2,)252 2490 A
(*empty;)294 2784 A
5985 V
(23832)210 1122 A
6075 V
(23833)210 1122 A
1524(/*)S
(Fetch)210 1650 A
(the)126 1902 A
(flock)210 2070 A
(structure)378 2322 A
(from)168 2742 A
(user)168 2952 A
(space.)252 3162 A
3456(*/)S
6165 V
(23834)210 1122 A
(user_flock)420 1524 A
1986(=)S
(\(vir_bytes\))462 2070 A
(m_in.name1;)462 2574 A
6255 V
(23835)210 1122 A
1524(r)S
1608(=)S
(sys_datacopy\(who,)714 1692 A
(\(vir_bytes\))462 2448 A
(user_flock,)462 2952 A
6345 V
(23836)210 1122 A
(FS_PROC_NR,)462 1776 A
(\(vir_bytes\))462 2280 A
(&flock,)294 2784 A
(\(phys_bytes\))504 3120 A
(sizeof\(flock\)\);)630 3666 A
6435 V
(23837)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
(return\(EINVAL\);)630 2070 A
6525 V
(23838)210 1122 A
6615 V
(23839)210 1122 A
1524(/*)S
(Make)168 1650 A
(some)168 1860 A
(error)210 2070 A
(checks.)294 2322 A
2658(*/)S
6705 V
(23840)210 1122 A
(ltype)210 1524 A
1776(=)S
(flock.l_type;)546 1860 A
6795 V
(23841)210 1122 A
1524(mo)S
1650(=)S
(f->filp_mode;)546 1734 A
6885 V
(23842)210 1122 A
1524(if)S
(\(ltype)252 1650 A
1944(!=)S
(F_UNLCK)294 2070 A
2406(&&)S
(ltype)210 2532 A
2784(!=)S
(F_RDLCK)294 2910 A
3246(&&)S
(ltype)210 3372 A
3624(!=)S
(F_WRLCK\))336 3750 A
(return\(EINVAL\);)630 4128 A
6975 V
(23843)210 1122 A
1524(if)S
(\(req)168 1650 A
1860(==)S
(F_GETLK)294 1986 A
2322(&&)S
(ltype)210 2448 A
2700(==)S
(F_UNLCK\))336 2826 A
(return\(EINVAL\);)630 3204 A
7065 V
(23844)210 1122 A
1524(if)S
1650(\()S
(\(f->filp_ino->i_mode)840 1734 A
2616(&)S
(I_TYPE\))294 2700 A
3036(!=)S
(I_REGULAR\))420 3162 A
(return\(EINVAL\);)630 3624 A
8418 V
EP
%%Page: 317 317
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2400(File:)S
2633(servers/fs/lock.c)S
12 B
(317)180 4500 A
1755 V
7 LST
(23845)210 1122 A
1524(if)S
(\(req)168 1650 A
1860(!=)S
(F_GETLK)294 1986 A
2322(&&)S
(ltype)210 2448 A
2700(==)S
(F_RDLCK)294 2826 A
3162(&&)S
(\(mo)126 3288 A
3456(&)S
(R_BIT\))252 3540 A
3834(==)S
3960(0\))S
(return\(EBADF\);)588 4086 A
1845 V
(23846)210 1122 A
1524(if)S
(\(req)168 1650 A
1860(!=)S
(F_GETLK)294 1986 A
2322(&&)S
(ltype)210 2448 A
2700(==)S
(F_WRLCK)294 2826 A
3162(&&)S
(\(mo)126 3288 A
3456(&)S
(W_BIT\))252 3540 A
3834(==)S
3960(0\))S
(return\(EBADF\);)588 4086 A
1935 V
(23847)210 1122 A
2025 V
(23848)210 1122 A
1524(/*)S
(Compute)294 1650 A
(the)126 1986 A
(first)210 2154 A
(and)126 2406 A
(last)168 2574 A
(bytes)210 2784 A
3036(in)S
(the)126 3162 A
(lock)168 3330 A
(region.)294 3540 A
3876(*/)S
2115 V
(23849)210 1122 A
(switch)252 1524 A
(\(flock.l_whence\))672 1818 A
2532({)S
2205 V
(23850)210 1122 A
(case)168 1776 A
(SEEK_SET:)378 1986 A
(first)210 2448 A
2700(=)S
2784(0;)S
(break;)252 2910 A
2295 V
(23851)210 1122 A
(case)168 1776 A
(SEEK_CUR:)378 1986 A
(first)210 2448 A
2700(=)S
(f->filp_pos;)504 2784 A
(break;)252 3330 A
2385 V
(23852)210 1122 A
(case)168 1776 A
(SEEK_END:)378 1986 A
(first)210 2448 A
2700(=)S
(f->filp_ino->i_size;)840 2784 A
(break;)252 3666 A
2475 V
(23853)210 1122 A
(default:)336 1776 A
(return\(EINVAL\);)630 2448 A
2565 V
(23854)210 1122 A
1524(})S
2655 V
(23855)210 1122 A
1524(/*)S
(Check)210 1650 A
(for)126 1902 A
(overflow.)378 2070 A
2490(*/)S
2745 V
(23856)210 1122 A
1524(if)S
(\(\(\(long\)flock.l_start)882 1650 A
2574(>)S
2658(0\))S
2784(&&)S
(\(\(first)294 2910 A
3246(+)S
(flock.l_start\))588 3330 A
3960(<)S
(first\)\))294 4044 A
2835 V
(23857)210 1122 A
(return\(EINVAL\);)630 1776 A
2925 V
(23858)210 1122 A
1524(if)S
(\(\(\(long\)flock.l_start)882 1650 A
2574(<)S
2658(0\))S
2784(&&)S
(\(\(first)294 2910 A
3246(+)S
(flock.l_start\))588 3330 A
3960(>)S
(first\)\))294 4044 A
3015 V
(23859)210 1122 A
(return\(EINVAL\);)630 1776 A
3105 V
(23860)210 1122 A
(first)210 1524 A
1776(=)S
(first)210 1860 A
2112(+)S
(flock.l_start;)588 2196 A
3195 V
(23861)210 1122 A
(last)168 1524 A
1734(=)S
(first)210 1818 A
2070(+)S
(flock.l_len)462 2154 A
2658(-)S
2742(1;)S
3285 V
(23862)210 1122 A
1524(if)S
(\(flock.l_len)504 1650 A
2196(==)S
2322(0\))S
(last)168 2448 A
2658(=)S
(MAX_FILE_POS;)546 2742 A
3375 V
(23863)210 1122 A
1524(if)S
(\(last)210 1650 A
1902(<)S
(first\))252 1986 A
(return\(EINVAL\);)630 2280 A
3465 V
(23864)210 1122 A
3555 V
(23865)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(if)S
(this)168 2028 A
(region)252 2238 A
(conflicts)378 2532 A
(with)168 2952 A
(any)126 3162 A
(existing)336 3330 A
(lock.)210 3708 A
3960(*/)S
3645 V
(23866)210 1122 A
(empty)210 1524 A
1776(=)S
(\(struct)294 1860 A
(file_lock)378 2196 A
2616(*\))S
2742(0;)S
3735 V
(23867)210 1122 A
(for)126 1524 A
(\(flp)168 1692 A
1902(=)S
(&file_lock[0];)588 1986 A
(flp)126 2616 A
2784(<)S
2868(&)S
(file_lock[NR_LOCKS];)840 2952 A
(flp++\))252 3834 A
4128({)S
3825 V
(23868)210 1122 A
1776(if)S
(\(flp->lock_type)630 1902 A
2574(==)S
2700(0\))S
2826({)S
3915 V
(23869)210 1122 A
2112(if)S
(\(empty)252 2238 A
2532(==)S
(\(struct)294 2658 A
(file_lock)378 2994 A
3414(*\))S
3540(0\))S
(empty)210 3666 A
3918(=)S
(flp;)168 4002 A
4005 V
(23870)210 1122 A
(continue;)378 2112 A
2784(/*)S
2910(0)S
(means)210 2994 A
(unused)252 3246 A
(slot)168 3540 A
3750(*/)S
4095 V
(23871)210 1122 A
1776(})S
4185 V
(23872)210 1122 A
1776(if)S
(\(flp->lock_inode)672 1902 A
2616(!=)S
(f->filp_ino\))504 2742 A
(continue;)378 3288 A
3792(/*)S
(different)378 3918 A
(file)168 4338 A
4548(*/)S
4275 V
(23873)210 1122 A
1776(if)S
(\(last)210 1902 A
2154(<)S
(flp->lock_first\))672 2238 A
(continue;)378 2952 A
3456(/*)S
(new)126 3582 A
(one)126 3750 A
3918(is)S
4044(in)S
(front)210 4170 A
4422(*/)S
4365 V
(23874)210 1122 A
1776(if)S
(\(first)252 1902 A
2196(>)S
(flp->lock_last\))630 2280 A
(continue;)378 2952 A
3456(/*)S
(new)126 3582 A
(one)126 3750 A
3918(is)S
(afterwards)420 4044 A
4506(*/)S
4455 V
(23875)210 1122 A
1776(if)S
(\(ltype)252 1902 A
2196(==)S
(F_RDLCK)294 2322 A
2658(&&)S
(flp->lock_type)588 2784 A
3414(==)S
(F_RDLCK\))336 3540 A
(continue;)378 3918 A
4545 V
(23876)210 1122 A
1776(if)S
(\(ltype)252 1902 A
2196(!=)S
(F_UNLCK)294 2322 A
2658(&&)S
(flp->lock_pid)546 2784 A
3372(==)S
(fp->fp_pid\))462 3498 A
(continue;)378 4002 A
4635 V
(23877)210 1122 A
4725 V
(23878)210 1122 A
1776(/*)S
(There)210 1902 A
(might)210 2154 A
2406(be)S
2532(a)S
(conflict.)378 2616 A
(Process)294 3078 A
(it.)126 3414 A
3582(*/)S
4815 V
(23879)210 1122 A
(conflict)336 1776 A
2154(=)S
2238(1;)S
4905 V
(23880)210 1122 A
1776(if)S
(\(req)168 1902 A
2112(==)S
(F_GETLK\))336 2238 A
(break;)252 2616 A
4995 V
(23881)210 1122 A
5085 V
(23882)210 1122 A
1776(/*)S
1902(If)S
2028(we)S
(are)126 2154 A
(trying)252 2322 A
2616(to)S
(set)126 2742 A
2910(a)S
(lock,)210 2994 A
3246(it)S
(just)168 3372 A
(failed.)294 3582 A
3918(*/)S
5175 V
(23883)210 1122 A
1776(if)S
(\(ltype)252 1902 A
2196(==)S
(F_RDLCK)294 2322 A
2658(||)S
(ltype)210 2784 A
3036(==)S
(F_WRLCK\))336 3162 A
3540({)S
5265 V
(23884)210 1122 A
2112(if)S
(\(req)168 2238 A
2448(==)S
(F_SETLK\))336 2574 A
2952({)S
5355 V
(23885)210 1122 A
2448(/*)S
(For)126 2574 A
(F_SETLK,)336 2742 A
(just)168 3120 A
(report)252 3330 A
(back)168 3624 A
(failure.)336 3834 A
4212(*/)S
5445 V
(23886)210 1122 A
(return\(EAGAIN\);)630 2448 A
5535 V
(23887)210 1122 A
2112(})S
(else)168 2196 A
2406({)S
5625 V
(23888)210 1122 A
2448(/*)S
(For)126 2574 A
(F_SETLKW,)378 2742 A
(suspend)294 3162 A
(the)126 3498 A
(process.)336 3666 A
4044(*/)S
5715 V
(23889)210 1122 A
(suspend\(XLOCK\);)630 2448 A
5805 V
(23890)210 1122 A
(return\(SUSPEND\);)672 2448 A
5895 V
(23891)210 1122 A
2112(})S
5985 V
(23892)210 1122 A
1776(})S
6075 V
(23893)210 1122 A
6165 V
(23894)210 1122 A
1776(/*)S
1902(We)S
(are)126 2028 A
(clearing)336 2196 A
2574(a)S
(lock)168 2658 A
(and)126 2868 A
3036(we)S
(found)210 3162 A
(something)378 3414 A
(that)168 3834 A
(overlaps.)378 4044 A
4464(*/)S
6255 V
(23895)210 1122 A
(unlocking)378 1776 A
2196(=)S
2280(1;)S
6345 V
(23896)210 1122 A
1776(if)S
(\(first)252 1902 A
2196(<=)S
(flp->lock_first)630 2322 A
2994(&&)S
(last)168 3120 A
3330(>=)S
(flp->lock_last\))630 3456 A
4128({)S
6435 V
(23897)210 1122 A
(flp->lock_type)588 2112 A
2742(=)S
2826(0;)S
3120(/*)S
(mark)168 3246 A
(slot)168 3456 A
3666(as)S
(unused)252 3792 A
4086(*/)S
6525 V
(23898)210 1122 A
(nr_locks--;)462 2112 A
3120(/*)S
(number)252 3246 A
3540(of)S
(locks)210 3666 A
3918(is)S
(now)126 4044 A
4212(1)S
(less)168 4296 A
4506(*/)S
6615 V
(23899)210 1122 A
(continue;)378 2112 A
6705 V
(23900)210 1122 A
1776(})S
6795 V
(23901)210 1122 A
6885 V
(23902)210 1122 A
1776(/*)S
(Part)168 1902 A
2112(of)S
2238(a)S
(locked)252 2322 A
(region)252 2616 A
(has)126 2910 A
(been)168 3078 A
(unlocked.)378 3288 A
3708(*/)S
6975 V
(23903)210 1122 A
1776(if)S
(\(first)252 1902 A
2196(<=)S
(flp->lock_first\))672 2322 A
3036({)S
7065 V
(23904)210 1122 A
(flp->lock_first)630 2112 A
2784(=)S
(last)168 2868 A
3078(+)S
3162(1;)S
8418 V
EP
%%Page: 318 318
BP
/slant 0 def
/height 0 def
1485 V
12 B
(318)180 1080 A
11 R
2400(File:)S
2633(servers/fs/lock.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(23905)210 1122 A
(continue;)378 2112 A
1845 V
(23906)210 1122 A
1776(})S
1935 V
(23907)210 1122 A
2025 V
(23908)210 1122 A
1776(if)S
(\(last)210 1902 A
2154(>=)S
(flp->lock_last\))630 2280 A
2952({)S
2115 V
(23909)210 1122 A
(flp->lock_last)588 2112 A
2742(=)S
(first)210 2826 A
3078(-)S
3162(1;)S
2205 V
(23910)210 1122 A
(continue;)378 2112 A
2295 V
(23911)210 1122 A
1776(})S
2385 V
(23912)210 1122 A
2475 V
(23913)210 1122 A
1776(/*)S
(Bad)126 1902 A
(luck.)210 2070 A
2322(A)S
(lock)168 2406 A
(has)126 2616 A
(been)168 2784 A
(split)210 2994 A
3246(in)S
(two)126 3372 A
3540(by)S
(unlocking)378 3666 A
(the)126 4086 A
(middle.)294 4254 A
4590(*/)S
2565 V
(23914)210 1122 A
1776(if)S
(\(nr_locks)378 1902 A
2322(==)S
(NR_LOCKS\))378 2448 A
(return\(ENOLCK\);)630 2868 A
2655 V
(23915)210 1122 A
(for)126 1776 A
1944(\(i)S
2070(=)S
2154(0;)S
2280(i)S
2364(<)S
(NR_LOCKS;)378 2448 A
(i++\))168 2868 A
2745 V
(23916)210 1122 A
2112(if)S
(\(file_lock[i].lock_type)966 2238 A
3246(==)S
3372(0\))S
(break;)252 3498 A
2835 V
(23917)210 1122 A
(flp2)168 1776 A
1986(=)S
(&file_lock[i];)588 2070 A
2925 V
(23918)210 1122 A
(flp2->lock_type)630 1776 A
2448(=)S
(flp->lock_type;)630 2532 A
3015 V
(23919)210 1122 A
(flp2->lock_pid)588 1776 A
2406(=)S
(flp->lock_pid;)588 2490 A
3105 V
(23920)210 1122 A
(flp2->lock_inode)672 1776 A
2490(=)S
(flp->lock_inode;)672 2574 A
3195 V
(23921)210 1122 A
(flp2->lock_first)672 1776 A
2490(=)S
(last)168 2574 A
2784(+)S
2868(1;)S
3285 V
(23922)210 1122 A
(flp2->lock_last)630 1776 A
2448(=)S
(flp->lock_last;)630 2532 A
3375 V
(23923)210 1122 A
(flp->lock_last)588 1776 A
2406(=)S
(first)210 2490 A
2742(-)S
2826(1;)S
3465 V
(23924)210 1122 A
(nr_locks++;)462 1776 A
3555 V
(23925)210 1122 A
1524(})S
3645 V
(23926)210 1122 A
1524(if)S
(\(unlocking\))462 1650 A
(lock_revive\(\);)588 2154 A
3735 V
(23927)210 1122 A
3825 V
(23928)210 1122 A
1524(if)S
(\(req)168 1650 A
1860(==)S
(F_GETLK\))336 1986 A
2364({)S
3915 V
(23929)210 1122 A
1776(if)S
(\(conflict\))420 1902 A
2364({)S
4005 V
(23930)210 1122 A
2112(/*)S
(GETLK)210 2238 A
(and)126 2490 A
(conflict.)378 2658 A
(Report)252 3078 A
3372(on)S
(the)126 3498 A
(conflicting)462 3666 A
(lock.)210 4170 A
4422(*/)S
4095 V
(23931)210 1122 A
(flock.l_type)504 2112 A
2658(=)S
(flp->lock_type;)630 2742 A
4185 V
(23932)210 1122 A
(flock.l_whence)588 2112 A
2742(=)S
(SEEK_SET;)378 2826 A
4275 V
(23933)210 1122 A
(flock.l_start)546 2112 A
2700(=)S
(flp->lock_first;)672 2784 A
4365 V
(23934)210 1122 A
(flock.l_len)462 2112 A
2616(=)S
(flp->lock_last)588 2700 A
3330(-)S
(flp->lock_first)630 3414 A
4086(+)S
4170(1;)S
4455 V
(23935)210 1122 A
(flock.l_pid)462 2112 A
2616(=)S
(flp->lock_pid;)588 2700 A
4545 V
(23936)210 1122 A
4635 V
(23937)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
4725 V
(23938)210 1122 A
2112(/*)S
2238(It)S
2364(is)S
(GETLK)210 2490 A
(and)126 2742 A
(there)210 2910 A
3162(is)S
3288(no)S
(conflict.)378 3414 A
3834(*/)S
4815 V
(23939)210 1122 A
(flock.l_type)504 2112 A
2658(=)S
(F_UNLCK;)336 2742 A
4905 V
(23940)210 1122 A
1776(})S
4995 V
(23941)210 1122 A
5085 V
(23942)210 1122 A
1776(/*)S
(Copy)168 1902 A
(the)126 2112 A
(flock)210 2280 A
(structure)378 2532 A
(back)168 2952 A
3162(to)S
(the)126 3288 A
(caller.)294 3456 A
3792(*/)S
5175 V
(23943)210 1122 A
1776(r)S
1860(=)S
(sys_datacopy\(FS_PROC_NR,)1008 1944 A
(\(vir_bytes\))462 2994 A
(&flock,)294 3498 A
5265 V
(23944)210 1122 A
(who,)168 2112 A
(\(vir_bytes\))462 2322 A
(user_flock,)462 2826 A
(\(phys_bytes\))504 3330 A
(sizeof\(flock\)\);)630 3876 A
5355 V
(23945)210 1122 A
(return\(r\);)420 1776 A
5445 V
(23946)210 1122 A
1524(})S
5535 V
(23947)210 1122 A
5625 V
(23948)210 1122 A
1524(if)S
(\(ltype)252 1650 A
1944(==)S
(F_UNLCK\))336 2070 A
(return\(OK\);)462 2448 A
3120(/*)S
(unlocked)336 3246 A
3624(a)S
(region)252 3708 A
(with)168 4002 A
4212(no)S
(locks)210 4338 A
4590(*/)S
5715 V
(23949)210 1122 A
5805 V
(23950)210 1122 A
1524(/*)S
(There)210 1650 A
1902(is)S
2028(no)S
(conflict.)378 2154 A
2616(If)S
(space)210 2742 A
(exists,)294 2994 A
(store)210 3330 A
(new)126 3582 A
(lock)168 3750 A
3960(in)S
(the)126 4086 A
(table.)252 4254 A
4548(*/)S
5895 V
(23951)210 1122 A
1524(if)S
(\(empty)252 1650 A
1944(==)S
(\(struct)294 2070 A
(file_lock)378 2406 A
2826(*\))S
2952(0\))S
(return\(ENOLCK\);)630 3078 A
3792(/*)S
(table)210 3918 A
(full)168 4170 A
4380(*/)S
5985 V
(23952)210 1122 A
(empty->lock_type)672 1524 A
2238(=)S
(ltype;)252 2322 A
6075 V
(23953)210 1122 A
(empty->lock_pid)630 1524 A
2196(=)S
(fp->fp_pid;)462 2280 A
6165 V
(23954)210 1122 A
(empty->lock_inode)714 1524 A
2280(=)S
(f->filp_ino;)504 2364 A
6255 V
(23955)210 1122 A
(empty->lock_first)714 1524 A
2280(=)S
(first;)252 2364 A
6345 V
(23956)210 1122 A
(empty->lock_last)672 1524 A
2238(=)S
(last;)210 2322 A
6435 V
(23957)210 1122 A
(nr_locks++;)462 1524 A
6525 V
(23958)210 1122 A
(return\(OK\);)462 1524 A
6615 V
(23959)210 1122 A
1440(})S
8418 V
EP
%%Page: 319 319
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2400(File:)S
2633(servers/fs/lock.c)S
12 B
(319)180 4500 A
1755 V
7 LST
(23961)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(23962)210 1122 A
1482(*)S
(lock_revive)462 2784 A
4674(*)S
1935 V
(23963)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(23964)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(lock_revive\(\))546 1944 A
2115 V
(23965)210 1122 A
1440({)S
2205 V
(23966)210 1122 A
1440(/*)S
1566(Go)S
(find)168 1692 A
(all)126 1902 A
(the)126 2070 A
(processes)378 2238 A
(that)168 2658 A
(are)126 2868 A
(waiting)294 3036 A
(for)126 3372 A
(any)126 3540 A
(kind)168 3708 A
3918(of)S
(lock)168 4044 A
(and)126 4254 A
2295 V
(23967)210 1122 A
1482(*)S
(revive)252 1566 A
(them)168 1860 A
(all.)168 2070 A
(The)126 2322 A
(ones)168 2490 A
(that)168 2700 A
(are)126 2910 A
(still)210 3078 A
(blocked)294 3330 A
(will)168 3666 A
(block)210 3876 A
(again)210 4128 A
(when)168 4380 A
2385 V
(23968)210 1122 A
1482(*)S
(they)168 1566 A
(run.)168 1776 A
(The)126 2028 A
(others)252 2196 A
(will)168 2490 A
(complete.)378 2700 A
(This)168 3162 A
(strategy)336 3372 A
3750(is)S
3876(a)S
(space-time)420 3960 A
2475 V
(23969)210 1122 A
1482(*)S
(tradeoff.)378 1566 A
(Figuring)336 2028 A
(out)126 2406 A
(exactly)294 2574 A
(which)210 2910 A
(ones)168 3162 A
3372(to)S
(unblock)294 3498 A
(now)126 3834 A
(would)210 4002 A
(take)168 4254 A
2565 V
(23970)210 1122 A
1482(*)S
(extra)210 1566 A
(code,)210 1818 A
(and)126 2070 A
(the)126 2238 A
(only)168 2406 A
(thing)210 2616 A
2868(it)S
(would)210 2994 A
(win)126 3246 A
(would)210 3414 A
3666(be)S
(some)168 3792 A
(performance)462 4002 A
4506(in)S
2655 V
(23971)210 1122 A
1482(*)S
(extremely)378 1566 A
(rare)168 1986 A
(circumstances)546 2196 A
(\(namely,)336 2784 A
(that)168 3162 A
(somebody)336 3372 A
(actually)336 3750 A
(used)168 4128 A
2745 V
(23972)210 1122 A
1482(*)S
(locking\).)378 1566 A
2835 V
(23973)210 1122 A
1482(*/)S
2925 V
(23974)210 1122 A
3015 V
(23975)210 1122 A
(int)126 1524 A
(task;)210 1692 A
3105 V
(23976)210 1122 A
(struct)252 1524 A
(fproc)210 1818 A
(*fptr;)252 2070 A
3195 V
(23977)210 1122 A
3285 V
(23978)210 1122 A
(for)126 1524 A
(\(fptr)210 1692 A
1944(=)S
(&fproc[INIT_PROC_NR)798 2028 A
2868(+)S
(1];)126 2952 A
(fptr)168 3120 A
3330(<)S
(&fproc[NR_PROCS];)714 3414 A
(fptr++\){)336 4170 A
3375 V
(23979)210 1122 A
(task)168 1776 A
1986(=)S
(-fptr->fp_task;)630 2070 A
3465 V
(23980)210 1122 A
1776(if)S
(\(fptr->fp_suspended)798 1902 A
2742(==)S
(SUSPENDED)378 2868 A
3288(&&)S
(task)168 3414 A
3624(==)S
(XLOCK\))252 3750 A
4044({)S
3555 V
(23981)210 1122 A
(revive\()294 2112 A
(\(int\))210 2448 A
(\(fptr)210 2700 A
2952(-)S
(fproc\),)294 3036 A
(0\);)126 3372 A
3645 V
(23982)210 1122 A
1776(})S
3735 V
(23983)210 1122 A
1524(})S
3825 V
(23984)210 1122 A
1440(})S
4095 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4185 V
(servers/fs/main.c)714 2676 A
4275 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4455 V
(24000)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(main)168 2532 A
(program)294 2742 A
3078(of)S
(the)126 3204 A
(File)168 3372 A
(System.)294 3582 A
3960(It)S
(consists)336 4086 A
4464(of)S
4545 V
(24001)210 1122 A
1482(*)S
1566(a)S
(loop)168 1650 A
(that)168 1860 A
(gets)168 2070 A
(messages)336 2280 A
(requesting)420 2658 A
(work,)210 3120 A
(carries)294 3372 A
(out)126 3708 A
(the)126 3876 A
(work,)210 4044 A
(and)126 4296 A
(sends)210 4464 A
4635 V
(24002)210 1122 A
1482(*)S
(replies.)336 1566 A
4725 V
(24003)210 1122 A
1482(*)S
4815 V
(24004)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are:)168 2910 A
4905 V
(24005)210 1122 A
1482(*)S
(main:)210 1650 A
(main)168 2112 A
(program)294 2322 A
2658(of)S
(the)126 2784 A
(File)168 2952 A
(System)252 3162 A
4995 V
(24006)210 1122 A
1482(*)S
(reply:)252 1650 A
(send)168 2112 A
2322(a)S
(reply)210 2406 A
2658(to)S
2784(a)S
(process)294 2868 A
(after)210 3204 A
(the)126 3456 A
(requested)378 3624 A
(work)168 4044 A
4254(is)S
(done)168 4380 A
5085 V
(24007)210 1122 A
1482(*)S
5175 V
(24008)210 1122 A
1482(*/)S
5265 V
(24009)210 1122 A
5355 V
(24010)210 1122 A
(struct)252 1440 A
(super_block;)504 1734 A
2784(/*)S
(proto.h)294 2910 A
(needs)210 3246 A
3498(to)S
(know)168 3624 A
(this)168 3834 A
4044(*/)S
5445 V
(24011)210 1122 A
5535 V
(24012)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
5625 V
(24013)210 1122 A
(#include)336 1440 A
(<fcntl.h>)378 1818 A
5715 V
(24014)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
5805 V
(24015)210 1122 A
(#include)336 1440 A
(<stdio.h>)378 1818 A
5895 V
(24016)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
5985 V
(24017)210 1122 A
(#include)336 1440 A
(<stdlib.h>)420 1818 A
6075 V
(24018)210 1122 A
(#include)336 1440 A
(<sys/ioc_memory.h>)756 1818 A
6165 V
(24019)210 1122 A
(#include)336 1440 A
(<sys/svrctl.h>)588 1818 A
6255 V
(24020)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
6345 V
(24021)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
6435 V
(24022)210 1122 A
(#include)336 1440 A
(<minix/keymap.h>)672 1818 A
6525 V
(24023)210 1122 A
(#include)336 1440 A
(<minix/const.h>)630 1818 A
6615 V
(24024)210 1122 A
(#include)336 1440 A
("buf.h")294 1818 A
6705 V
(24025)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
6795 V
(24026)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
6885 V
(24027)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
6975 V
(24028)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
7065 V
(24029)210 1122 A
(#include)336 1440 A
("super.h")378 1818 A
8418 V
EP
%%Page: 320 320
BP
/slant 0 def
/height 0 def
1485 V
12 B
(320)180 1080 A
11 R
2385(File:)S
2618(servers/fs/main.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(24030)210 1122 A
1845 V
(24031)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(fs_init,)336 2490 A
(\(void\))252 2868 A
4464(\);)S
1935 V
(24032)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(igetenv,)336 2448 A
(\(char)210 2826 A
(*var,)210 3078 A
(int)126 3330 A
(optional\))378 3498 A
4464(\);)S
2025 V
(24033)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(get_work,)378 2490 A
(\(void\))252 2910 A
4464(\);)S
2115 V
(24034)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(load_ram,)378 2490 A
(\(void\))252 2910 A
4464(\);)S
2205 V
(24035)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(load_super,)462 2490 A
(\(Dev_t)252 2994 A
(super_dev\))420 3288 A
4464(\);)S
2295 V
(24036)210 1122 A
2385 V
(24037)210 1122 A
(/*===========================================================================*)3276 1440 A
2475 V
(24038)210 1122 A
1482(*)S
(main)168 2784 A
4674(*)S
2565 V
(24039)210 1122 A
(*===========================================================================*/)3276 1482 A
2655 V
(24040)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(main\(\))252 1902 A
2745 V
(24041)210 1122 A
1440({)S
2835 V
(24042)210 1122 A
1440(/*)S
(This)168 1566 A
1776(is)S
(the)126 1902 A
(main)168 2070 A
(program)294 2280 A
2616(of)S
(the)126 2742 A
(file)168 2910 A
(system.)294 3120 A
(The)126 3498 A
(main)168 3666 A
(loop)168 3876 A
(consists)336 4086 A
4464(of)S
2925 V
(24043)210 1122 A
1482(*)S
(three)210 1566 A
(major)210 1818 A
(activities:)462 2070 A
(getting)294 2574 A
(new)126 2910 A
(work,)210 3078 A
(processing)420 3330 A
(the)126 3792 A
(work,)210 3960 A
(and)126 4212 A
(sending)294 4380 A
3015 V
(24044)210 1122 A
1482(*)S
(the)126 1566 A
(reply.)252 1734 A
(This)168 2070 A
(loop)168 2280 A
(never)210 2490 A
(terminates)420 2742 A
3204(as)S
(long)168 3330 A
3540(as)S
(the)126 3666 A
(file)168 3834 A
(system)252 4044 A
(runs.)210 4338 A
3105 V
(24045)210 1122 A
1482(*/)S
3195 V
(24046)210 1122 A
(sigset_t)336 1524 A
(sigset;)294 1902 A
3285 V
(24047)210 1122 A
(int)126 1524 A
(error;)252 1692 A
3375 V
(24048)210 1122 A
3465 V
(24049)210 1122 A
(fs_init\(\);)420 1524 A
3555 V
(24050)210 1122 A
3645 V
(24051)210 1122 A
1524(/*)S
(This)168 1650 A
1860(is)S
(the)126 1986 A
(main)168 2154 A
(loop)168 2364 A
(that)168 2574 A
(gets)168 2784 A
(work,)210 2994 A
(processes)378 3246 A
(it,)126 3666 A
(and)126 3834 A
(sends)210 4002 A
(replies.)336 4254 A
4632(*/)S
3735 V
(24052)210 1122 A
(while)210 1524 A
(\(TRUE\))252 1776 A
2070({)S
3825 V
(24053)210 1122 A
(get_work\(\);)462 1776 A
2784(/*)S
(sets)168 2910 A
(who)126 3120 A
(and)126 3288 A
(call_nr)294 3456 A
3792(*/)S
3915 V
(24054)210 1122 A
4005 V
(24055)210 1122 A
1776(fp)S
1902(=)S
(&fproc[who];)504 1986 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(proc)168 3372 A
(table)210 3582 A
(struct)252 3834 A
4128(*/)S
4095 V
(24056)210 1122 A
(super_user)420 1776 A
2238(=)S
(\(fp->fp_effuid)588 2322 A
2952(==)S
(SU_UID)252 3078 A
3372(?)S
(TRUE)168 3456 A
3666(:)S
(FALSE\);)294 3750 A
4170(/*)S
(su?)126 4296 A
4464(*/)S
4185 V
(24057)210 1122 A
4275 V
(24058)210 1122 A
1776(/*)S
(Check)210 1902 A
(for)126 2154 A
(special)294 2322 A
(control)294 2658 A
(messages)336 2994 A
(first.)252 3372 A
3666(*/)S
4365 V
(24059)210 1122 A
1776(if)S
(\(call_nr)336 1902 A
2280(==)S
(SYS_SIG\))336 2406 A
2784({)S
4455 V
(24060)210 1122 A
(sigset)252 2112 A
2406(=)S
(m_in.NOTIFY_ARG;)672 2490 A
4545 V
(24061)210 1122 A
2112(if)S
(\(sigismember\(&sigset,)882 2238 A
(SIGKSTOP\)\))420 3162 A
3624({)S
4635 V
(24062)210 1122 A
(do_sync\(\);)420 2448 A
4725 V
(24063)210 1122 A
(sys_exit\(0\);)504 2448 A
3456(/*)S
(never)210 3582 A
(returns)294 3834 A
4170(*/)S
4815 V
(24064)210 1122 A
2112(})S
4905 V
(24065)210 1122 A
1776(})S
(else)168 1860 A
2070(if)S
(\(call_nr)336 2196 A
2574(==)S
(SYN_ALARM\))420 2700 A
3162({)S
4995 V
(24066)210 1122 A
2112(/*)S
(Not)126 2238 A
2406(a)S
(user)168 2490 A
(request;)336 2700 A
(system)252 3078 A
(has)126 3372 A
(expired)294 3540 A
(one)126 3876 A
4044(of)S
(our)126 4170 A
(timers,)294 4338 A
5085 V
(24067)210 1122 A
2154(*)S
(currently)378 2238 A
(only)168 2658 A
2868(in)S
(use)126 2994 A
(for)126 3162 A
(select\(\).)378 3330 A
(Check)210 3750 A
(it.)126 4002 A
5175 V
(24068)210 1122 A
2154(*/)S
5265 V
(24069)210 1122 A
(fs_expire_timers\(m_in.NOTIFY_TIMESTAMP\);)1680 2112 A
5355 V
(24070)210 1122 A
1776(})S
(else)168 1860 A
2070(if)S
(\(\(call_nr)378 2196 A
2616(&)S
(NOTIFY_MESSAGE\)\))672 2700 A
3414({)S
5445 V
(24071)210 1122 A
2112(/*)S
(Device)252 2238 A
(notifies)336 2532 A
2910(us)S
3036(of)S
3162(an)S
(event.)252 3288 A
3582(*/)S
5535 V
(24072)210 1122 A
(dev_status\(&m_in\);)756 2112 A
5625 V
(24073)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
5715 V
(24074)210 1122 A
2112(/*)S
(Call)168 2238 A
(the)126 2448 A
(internal)336 2616 A
(function)336 2994 A
(that)168 3372 A
(does)168 3582 A
(the)126 3792 A
(work.)210 3960 A
4212(*/)S
5805 V
(24075)210 1122 A
2112(if)S
(\(call_nr)336 2238 A
2616(<)S
2700(0)S
2784(||)S
(call_nr)294 2910 A
3246(>=)S
(NCALLS\))294 3372 A
3708({)S
5895 V
(24076)210 1122 A
(error)210 2448 A
2700(=)S
(ENOSYS;)294 2784 A
5985 V
(24077)210 1122 A
(printf\("FS,)462 2448 A
(warning)294 2952 A
(illegal)294 3288 A
3624(%d)S
(system)252 3750 A
(call)168 4044 A
4254(by)S
(%d\\n",)252 4380 A
(call_nr,)336 4674 A
(who\);)210 5052 A
6075 V
(24078)210 1122 A
2112(})S
(else)168 2196 A
2406(if)S
(\(fp->fp_pid)462 2532 A
3036(==)S
(PID_FREE\))378 3162 A
3582({)S
6165 V
(24079)210 1122 A
(error)210 2448 A
2700(=)S
(ENOSYS;)294 2784 A
6255 V
(24080)210 1122 A
(printf\("FS,)462 2448 A
(bad)126 2952 A
(process,)336 3120 A
(who)126 3498 A
3666(=)S
(%d,)126 3750 A
(call_nr)294 3918 A
4254(=)S
(%d,)126 4338 A
(slot1)210 4506 A
4758(=)S
(%d\\n",)252 4842 A
6345 V
(24081)210 1122 A
(who,)168 2826 A
(call_nr,)336 3036 A
(m_in.slot1\);)504 3414 A
6435 V
(24082)210 1122 A
2112(})S
(else)168 2196 A
2406({)S
6525 V
(24083)210 1122 A
(error)210 2448 A
2700(=)S
(\(*call_vec[call_nr]\)\(\);)966 2784 A
6615 V
(24084)210 1122 A
2112(})S
6705 V
(24085)210 1122 A
6795 V
(24086)210 1122 A
2112(/*)S
(Copy)168 2238 A
(the)126 2448 A
(results)294 2616 A
(back)168 2952 A
3162(to)S
(the)126 3288 A
(user)168 3456 A
(and)126 3666 A
(send)168 3834 A
(reply.)252 4044 A
4338(*/)S
6885 V
(24087)210 1122 A
2112(if)S
(\(error)252 2238 A
2532(!=)S
(SUSPEND\))336 2658 A
3036({)S
(reply\(who,)420 3120 A
(error\);)294 3582 A
3918(})S
6975 V
(24088)210 1122 A
2112(if)S
(\(rdahed_inode)546 2238 A
2826(!=)S
(NIL_INODE\))420 2952 A
3414({)S
7065 V
(24089)210 1122 A
(read_ahead\(\);)546 2448 A
3036(/*)S
3162(do)S
(block)210 3288 A
(read)168 3540 A
(ahead)210 3750 A
4002(*/)S
8418 V
EP
%%Page: 321 321
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2385(File:)S
2618(servers/fs/main.c)S
12 B
(321)180 4500 A
1755 V
7 LST
(24090)210 1122 A
2112(})S
1845 V
(24091)210 1122 A
1776(})S
1935 V
(24092)210 1122 A
1524(})S
2025 V
(24093)210 1122 A
(return\(OK\);)462 1524 A
3120(/*)S
(shouldn't)378 3246 A
(come)168 3666 A
(here)168 3876 A
4086(*/)S
2115 V
(24094)210 1122 A
1440(})S
2295 V
(24096)210 1122 A
(/*===========================================================================*)3276 1440 A
2385 V
(24097)210 1122 A
1482(*)S
(get_work)336 2784 A
4674(*)S
2475 V
(24098)210 1122 A
(*===========================================================================*/)3276 1482 A
2565 V
(24099)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(get_work\(\))420 1986 A
2655 V
(24100)210 1122 A
1440({)S
2745 V
(24101)210 1122 A
1524(/*)S
(Normally)336 1650 A
(wait)168 2028 A
(for)126 2238 A
(new)126 2406 A
(input.)252 2574 A
(However,)336 2910 A
3288(if)S
('reviving')420 3414 A
3876(is)S
2835 V
(24102)210 1122 A
1566(*)S
(nonzero,)336 1650 A
2028(a)S
(suspended)378 2112 A
(process)294 2532 A
(must)168 2868 A
3078(be)S
(awakened.)378 3204 A
2925 V
(24103)210 1122 A
1566(*/)S
3015 V
(24104)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(fproc)210 2196 A
(*rp;)168 2448 A
3105 V
(24105)210 1122 A
3195 V
(24106)210 1122 A
1524(if)S
(\(reviving)378 1650 A
2070(!=)S
2196(0\))S
2322({)S
3285 V
(24107)210 1122 A
1776(/*)S
(Revive)252 1902 A
2196(a)S
(suspended)378 2280 A
(process.)336 2700 A
3078(*/)S
3375 V
(24108)210 1122 A
(for)126 1776 A
(\(rp)126 1944 A
2112(=)S
(&fproc[0];)420 2196 A
2658(rp)S
2784(<)S
(&fproc[NR_PROCS];)714 2868 A
(rp++\))210 3624 A
3465 V
(24109)210 1122 A
2112(if)S
(\(rp->fp_revived)630 2238 A
2910(==)S
(REVIVING\))378 3036 A
3456({)S
3555 V
(24110)210 1122 A
(who)126 2448 A
2616(=)S
(\(int\)\(rp)336 2700 A
3078(-)S
(fproc\);)294 3162 A
3645 V
(24111)210 1122 A
(call_nr)294 2448 A
2784(=)S
(rp->fp_fd)378 2868 A
3288(&)S
(BYTE;)210 3372 A
3735 V
(24112)210 1122 A
(m_in.fd)294 2448 A
2784(=)S
(\(rp->fp_fd)420 2868 A
(>>8\))168 3330 A
3540(&)S
(BYTE;)210 3624 A
3825 V
(24113)210 1122 A
(m_in.buffer)462 2448 A
2952(=)S
(rp->fp_buffer;)588 3036 A
3915 V
(24114)210 1122 A
(m_in.nbytes)462 2448 A
2952(=)S
(rp->fp_nbytes;)588 3036 A
4005 V
(24115)210 1122 A
(rp->fp_suspended)672 2448 A
3162(=)S
(NOT_SUSPENDED;)588 3246 A
(/*no)168 3876 A
(longer)252 4086 A
(hanging*/)378 4380 A
4095 V
(24116)210 1122 A
(rp->fp_revived)588 2448 A
3078(=)S
(NOT_REVIVING;)546 3162 A
4185 V
(24117)210 1122 A
(reviving--;)462 2448 A
4275 V
(24118)210 1122 A
(return;)294 2448 A
4365 V
(24119)210 1122 A
2112(})S
4455 V
(24120)210 1122 A
(panic\(__FILE__,"get_work)1008 1776 A
(couldn't)336 2826 A
(revive)252 3204 A
(anyone",)336 3498 A
(NO_NUM\);)336 3876 A
4545 V
(24121)210 1122 A
1524(})S
4635 V
(24122)210 1122 A
4725 V
(24123)210 1122 A
1524(/*)S
(Normal)252 1650 A
(case.)210 1944 A
2238(No)S
(one)126 2364 A
2532(to)S
(revive.)294 2658 A
2994(*/)S
4815 V
(24124)210 1122 A
1524(if)S
(\(receive\(ANY,)546 1650 A
(&m_in\))252 2238 A
2532(!=)S
(OK\))126 2658 A
(panic\(__FILE__,"fs)756 2826 A
(receive)294 3624 A
(error",)294 3960 A
(NO_NUM\);)336 4296 A
4905 V
(24125)210 1122 A
(who)126 1524 A
1692(=)S
(m_in.m_source;)588 1776 A
4995 V
(24126)210 1122 A
(call_nr)294 1524 A
1860(=)S
(m_in.m_type;)504 1944 A
5085 V
(24127)210 1122 A
1440(})S
5265 V
(24129)210 1122 A
(/*===========================================================================*)3276 1440 A
5355 V
(24130)210 1122 A
1482(*)S
(buf_pool)336 2784 A
4674(*)S
5445 V
(24131)210 1122 A
(*===========================================================================*/)3276 1482 A
5535 V
(24132)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(buf_pool\(void\))588 1986 A
5625 V
(24133)210 1122 A
1440({)S
5715 V
(24134)210 1122 A
1440(/*)S
(Initialize)420 1566 A
(the)126 2028 A
(buffer)252 2196 A
(pool.)210 2490 A
2742(*/)S
5805 V
(24135)210 1122 A
5895 V
(24136)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(buf)126 2196 A
(*bp;)168 2364 A
5985 V
(24137)210 1122 A
6075 V
(24138)210 1122 A
(bufs_in_use)462 1524 A
2028(=)S
2112(0;)S
6165 V
(24139)210 1122 A
(front)210 1524 A
1776(=)S
(&buf[0];)336 1860 A
6255 V
(24140)210 1122 A
(rear)168 1524 A
1734(=)S
(&buf[NR_BUFS)504 1818 A
2364(-)S
(1];)126 2448 A
6345 V
(24141)210 1122 A
6435 V
(24142)210 1122 A
(for)126 1524 A
(\(bp)126 1692 A
1860(=)S
(&buf[0];)336 1944 A
2322(bp)S
2448(<)S
(&buf[NR_BUFS];)588 2532 A
(bp++\))210 3162 A
3414({)S
6525 V
(24143)210 1122 A
(bp->b_blocknr)546 1776 A
2364(=)S
(NO_BLOCK;)378 2448 A
6615 V
(24144)210 1122 A
(bp->b_dev)378 1776 A
2196(=)S
(NO_DEV;)294 2280 A
6705 V
(24145)210 1122 A
(bp->b_next)420 1776 A
2238(=)S
2322(bp)S
2448(+)S
2532(1;)S
6795 V
(24146)210 1122 A
(bp->b_prev)420 1776 A
2238(=)S
2322(bp)S
2448(-)S
2532(1;)S
6885 V
(24147)210 1122 A
1524(})S
6975 V
(24148)210 1122 A
(buf[0].b_prev)546 1524 A
2112(=)S
(NIL_BUF;)336 2196 A
7065 V
(24149)210 1122 A
(buf[NR_BUFS)462 1524 A
2028(-)S
(1].b_next)378 2112 A
2532(=)S
(NIL_BUF;)336 2616 A
8418 V
EP
%%Page: 322 322
BP
/slant 0 def
/height 0 def
1485 V
12 B
(322)180 1080 A
11 R
2385(File:)S
2618(servers/fs/main.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(24150)210 1122 A
1845 V
(24151)210 1122 A
(for)126 1524 A
(\(bp)126 1692 A
1860(=)S
(&buf[0];)336 1944 A
2322(bp)S
2448(<)S
(&buf[NR_BUFS];)588 2532 A
(bp++\))210 3162 A
(bp->b_hash)420 3414 A
3876(=)S
(bp->b_next;)462 3960 A
1935 V
(24152)210 1122 A
(buf_hash[0])462 1524 A
2028(=)S
(front;)252 2112 A
2025 V
(24153)210 1122 A
2115 V
(24154)210 1122 A
1440(})S
2295 V
(24156)210 1122 A
(/*===========================================================================*)3276 1440 A
2385 V
(24157)210 1122 A
1482(*)S
(reply)210 2784 A
4674(*)S
2475 V
(24158)210 1122 A
(*===========================================================================*/)3276 1482 A
2565 V
(24159)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(reply\(whom,)462 1944 A
(result\))294 2448 A
2655 V
(24160)210 1122 A
(int)126 1440 A
(whom;)210 1608 A
2784(/*)S
(process)294 2910 A
3246(to)S
(reply)210 3372 A
3624(to)S
3750(*/)S
2745 V
(24161)210 1122 A
(int)126 1440 A
(result;)294 1608 A
2784(/*)S
(result)252 2910 A
3204(of)S
(the)126 3330 A
(call)168 3498 A
(\(usually)336 3708 A
4086(OK)S
4212(or)S
(error)210 4338 A
4590(#\))S
4716(*/)S
2835 V
(24162)210 1122 A
1440({)S
2925 V
(24163)210 1122 A
1440(/*)S
(Send)168 1566 A
1776(a)S
(reply)210 1860 A
2112(to)S
2238(a)S
(user)168 2322 A
(process.)336 2532 A
2910(It)S
(may)126 3036 A
(fail)168 3204 A
(\(if)126 3414 A
(the)126 3582 A
(process)294 3750 A
(has)126 4086 A
(just)168 4254 A
3015 V
(24164)210 1122 A
1482(*)S
(been)168 1566 A
(killed)252 1776 A
2070(by)S
2196(a)S
(signal\),)336 2280 A
2658(so)S
(don't)210 2784 A
(check)210 3036 A
(the)126 3288 A
(return)252 3456 A
(code.)210 3750 A
4044(If)S
(the)126 4170 A
(send)168 4338 A
3105 V
(24165)210 1122 A
1482(*)S
(fails,)252 1566 A
(just)168 1860 A
(ignore)252 2070 A
(it.)126 2364 A
3195 V
(24166)210 1122 A
1482(*/)S
3285 V
(24167)210 1122 A
(int)126 1524 A
1692(s;)S
3375 V
(24168)210 1122 A
(m_out.reply_type)672 1524 A
2238(=)S
(result;)294 2322 A
3465 V
(24169)210 1122 A
1524(s)S
1608(=)S
(send\(whom,)420 1692 A
(&m_out\);)336 2154 A
3555 V
(24170)210 1122 A
1524(if)S
1650(\(s)S
1776(!=)S
(OK\))126 1902 A
(printf\("FS:)462 2070 A
(couldn't)336 2574 A
(send)168 2952 A
(reply)210 3162 A
(%d:)126 3414 A
(%d\\n",)252 3582 A
(result,)294 3876 A
(s\);)126 4212 A
3645 V
(24171)210 1122 A
1440(})S
3825 V
(24173)210 1122 A
(/*===========================================================================*)3276 1440 A
3915 V
(24174)210 1122 A
1482(*)S
(fs_init)294 2784 A
4674(*)S
4005 V
(24175)210 1122 A
(*===========================================================================*/)3276 1482 A
4095 V
(24176)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(fs_init\(\))378 1986 A
4185 V
(24177)210 1122 A
1440({)S
4275 V
(24178)210 1122 A
1440(/*)S
(Initialize)420 1566 A
(global)252 2028 A
(variables,)420 2322 A
(tables,)294 2784 A
(etc.)168 3120 A
3330(*/)S
4365 V
(24179)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
4455 V
(24180)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(fproc)210 2196 A
(*rfp;)210 2448 A
4545 V
(24181)210 1122 A
(message)294 1524 A
(mess;)210 1860 A
4635 V
(24182)210 1122 A
(int)126 1524 A
1692(s;)S
4725 V
(24183)210 1122 A
4815 V
(24184)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(the)126 2112 A
(process)294 2280 A
(table)210 2616 A
(with)168 2868 A
(help)168 3078 A
3288(of)S
(the)126 3414 A
(process)294 3582 A
(manager)294 3918 A
(messages.)378 4254 A
4905 V
(24185)210 1122 A
1566(*)S
(Expect)252 1650 A
(one)126 1944 A
(message)294 2112 A
(for)126 2448 A
(each)168 2616 A
(system)252 2826 A
(process)294 3120 A
(with)168 3456 A
(its)126 3666 A
(slot)168 3834 A
(number)252 4044 A
(and)126 4338 A
(pid.)168 4506 A
4995 V
(24186)210 1122 A
1566(*)S
(When)168 1650 A
1860(no)S
(more)168 1986 A
(processes)378 2196 A
(follow,)294 2616 A
(the)126 2952 A
(magic)210 3120 A
(process)294 3372 A
(number)252 3708 A
(NONE)168 4002 A
4212(is)S
(sent.)210 4338 A
5085 V
(24187)210 1122 A
1566(*)S
(Then,)210 1650 A
(stop)168 1902 A
(and)126 2112 A
(synchronize)462 2280 A
(with)168 2784 A
(the)126 2994 A
(PM.)126 3162 A
5175 V
(24188)210 1122 A
1566(*/)S
5265 V
(24189)210 1122 A
1524(do)S
1650({)S
5355 V
(24190)210 1122 A
1776(if)S
(\(OK)126 1902 A
2070(!=)S
(\(s=receive\(PM_PROC_NR,)924 2196 A
(&mess\)\)\))336 3162 A
5445 V
(24191)210 1122 A
(panic\(__FILE__,"FS)756 2112 A
(couldn't)336 2910 A
(receive)294 3288 A
(from)168 3624 A
(PM",)168 3834 A
(s\);)126 4044 A
5535 V
(24192)210 1122 A
1776(if)S
(\(NONE)210 1902 A
2154(==)S
(mess.PR_PROC_NR\))672 2280 A
(break;)252 2994 A
5625 V
(24193)210 1122 A
5715 V
(24194)210 1122 A
(rfp)126 1776 A
1944(=)S
(&fproc[mess.PR_PROC_NR];)1008 2028 A
5805 V
(24195)210 1122 A
(rfp->fp_pid)462 1776 A
2280(=)S
(mess.PR_PID;)504 2364 A
5895 V
(24196)210 1122 A
(rfp->fp_realuid)630 1776 A
2448(=)S
(\(uid_t\))294 2532 A
(SYS_UID;)336 2868 A
5985 V
(24197)210 1122 A
(rfp->fp_effuid)588 1776 A
2406(=)S
(\(uid_t\))294 2490 A
(SYS_UID;)336 2826 A
6075 V
(24198)210 1122 A
(rfp->fp_realgid)630 1776 A
2448(=)S
(\(gid_t\))294 2532 A
(SYS_GID;)336 2868 A
6165 V
(24199)210 1122 A
(rfp->fp_effgid)588 1776 A
2406(=)S
(\(gid_t\))294 2490 A
(SYS_GID;)336 2826 A
6255 V
(24200)210 1122 A
(rfp->fp_umask)546 1776 A
2364(=)S
(\3040;)126 2448 A
6345 V
(24201)210 1122 A
6435 V
(24202)210 1122 A
1524(})S
(while)210 1608 A
(\(TRUE\);)294 1860 A
3120(/*)S
(continue)336 3246 A
(until)210 3624 A
(process)294 3876 A
(NONE)168 4212 A
4422(*/)S
6525 V
(24203)210 1122 A
(mess.m_type)462 1524 A
2028(=)S
(OK;)126 2112 A
3120(/*)S
(tell)168 3246 A
3456(PM)S
(that)168 3582 A
3792(we)S
(succeeded)378 3918 A
4338(*/)S
6615 V
(24204)210 1122 A
(s=send\(PM_PROC_NR,)756 1524 A
(&mess\);)294 2322 A
3120(/*)S
(send)168 3246 A
(synchronization)630 3456 A
(message)294 4128 A
4464(*/)S
6705 V
(24205)210 1122 A
6795 V
(24206)210 1122 A
1524(/*)S
(All)126 1650 A
(process)294 1818 A
(table)210 2154 A
(entries)294 2406 A
(have)168 2742 A
(been)168 2952 A
(set.)168 3162 A
(Continue)336 3372 A
(with)168 3750 A
3960(FS)S
(initialization.)630 4086 A
6885 V
(24207)210 1122 A
1566(*)S
(Certain)294 1650 A
(relations)378 1986 A
(must)168 2406 A
(hold)168 2616 A
(for)126 2826 A
(the)126 2994 A
(file)168 3162 A
(system)252 3372 A
3666(to)S
(work)168 3792 A
4002(at)S
(all.)168 4128 A
(Some)168 4338 A
6975 V
(24208)210 1122 A
1566(*)S
(extra)210 1650 A
(block_size)420 1902 A
(requirements)504 2364 A
(are)126 2910 A
(checked)294 3078 A
3414(at)S
(super-block-read-in)798 3540 A
(time.)210 4380 A
7065 V
(24209)210 1122 A
1566(*/)S
8418 V
EP
%%Page: 323 323
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2385(File:)S
2618(servers/fs/main.c)S
12 B
(323)180 4500 A
1755 V
7 LST
(24210)210 1122 A
1524(if)S
(\(OPEN_MAX)378 1650 A
2070(>)S
(127\))168 2154 A
(panic\(__FILE__,"OPEN_MAX)1008 2364 A
3414(>)S
(127",)210 3498 A
(NO_NUM\);)336 3750 A
1845 V
(24211)210 1122 A
1524(if)S
(\(NR_BUFS)336 1650 A
2028(<)S
2112(6\))S
(panic\(__FILE__,"NR_BUFS)966 2238 A
3246(<)S
(6",)126 3330 A
(NO_NUM\);)336 3498 A
1935 V
(24212)210 1122 A
1524(if)S
(\(V1_INODE_SIZE)588 1650 A
2280(!=)S
(32\))126 2406 A
(panic\(__FILE__,"V1)756 2574 A
(inode)210 3372 A
(size)168 3624 A
3834(!=)S
(32",)168 3960 A
(NO_NUM\);)336 4170 A
2025 V
(24213)210 1122 A
1524(if)S
(\(V2_INODE_SIZE)588 1650 A
2280(!=)S
(64\))126 2406 A
(panic\(__FILE__,"V2)756 2574 A
(inode)210 3372 A
(size)168 3624 A
3834(!=)S
(64",)168 3960 A
(NO_NUM\);)336 4170 A
2115 V
(24214)210 1122 A
1524(if)S
(\(OPEN_MAX)378 1650 A
2070(>)S
2154(8)S
2238(*)S
(sizeof\(long\)\))546 2322 A
2205 V
(24215)210 1122 A
(panic\(__FILE__,"Too)798 1818 A
(few)126 2658 A
(bits)168 2826 A
3036(in)S
(fp_cloexec",)504 3162 A
(NO_NUM\);)336 3708 A
2295 V
(24216)210 1122 A
2385 V
(24217)210 1122 A
1524(/*)S
(The)126 1650 A
(following)378 1818 A
(initializations)630 2238 A
(are)126 2910 A
(needed)252 3078 A
3372(to)S
(let)126 3498 A
(dev_opcl)336 3666 A
(succeed)294 4044 A
(.*/)126 4380 A
2475 V
(24218)210 1122 A
1524(fp)S
1650(=)S
(\(struct)294 1734 A
(fproc)210 2070 A
2322(*\))S
(NULL;)210 2448 A
2565 V
(24219)210 1122 A
(who)126 1524 A
1692(=)S
(FS_PROC_NR;)462 1776 A
2655 V
(24220)210 1122 A
2745 V
(24221)210 1122 A
(buf_pool\(\);)462 1524 A
2784(/*)S
(initialize)420 2910 A
(buffer)252 3372 A
(pool)168 3666 A
3876(*/)S
2835 V
(24222)210 1122 A
(build_dmap\(\);)546 1524 A
2784(/*)S
(build)210 2910 A
(device)252 3162 A
(table)210 3456 A
(and)126 3708 A
(map)126 3876 A
(boot)168 4044 A
(driver)252 4254 A
4548(*/)S
2925 V
(24223)210 1122 A
(load_ram\(\);)462 1524 A
2784(/*)S
(init)168 2910 A
(RAM)126 3120 A
(disk,)210 3288 A
(load)168 3540 A
3750(if)S
3876(it)S
4002(is)S
(root)168 4128 A
4338(*/)S
3015 V
(24224)210 1122 A
(load_super\(root_dev\);)882 1524 A
2784(/*)S
(load)168 2910 A
(super)210 3120 A
(block)210 3372 A
(for)126 3624 A
(root)168 3792 A
(device)252 4002 A
4296(*/)S
3105 V
(24225)210 1122 A
(init_select\(\);)588 1524 A
2784(/*)S
(init)168 2910 A
(select\(\))336 3120 A
(structures)420 3498 A
3960(*/)S
3195 V
(24226)210 1122 A
3285 V
(24227)210 1122 A
1524(/*)S
(The)126 1650 A
(root)168 1818 A
(device)252 2028 A
(can)126 2322 A
(now)126 2490 A
2658(be)S
(accessed;)378 2784 A
(set)126 3204 A
(process)294 3372 A
(directories.)504 3708 A
4254(*/)S
3375 V
(24228)210 1122 A
(for)126 1524 A
(\(rfp=&fproc[0];)630 1692 A
(rfp)126 2364 A
2532(<)S
(&fproc[NR_PROCS];)714 2616 A
(rfp++\))252 3372 A
3666({)S
3465 V
(24229)210 1122 A
1776(if)S
(\(rfp->fp_pid)504 1902 A
2448(!=)S
(PID_FREE\))378 2574 A
2994({)S
3555 V
(24230)210 1122 A
(rip)126 2112 A
2280(=)S
(get_inode\(root_dev,)798 2364 A
(ROOT_INODE\);)504 3204 A
3645 V
(24231)210 1122 A
(dup_inode\(rip\);)630 2112 A
3735 V
(24232)210 1122 A
(rfp->fp_rootdir)630 2112 A
2784(=)S
(rip;)168 2868 A
3825 V
(24233)210 1122 A
(rfp->fp_workdir)630 2112 A
2784(=)S
(rip;)168 2868 A
3915 V
(24234)210 1122 A
1776(})S
4005 V
(24235)210 1122 A
1524(})S
4095 V
(24236)210 1122 A
1440(})S
4275 V
(24238)210 1122 A
(/*===========================================================================*)3276 1440 A
4365 V
(24239)210 1122 A
1482(*)S
(igetenv)294 2784 A
4674(*)S
4455 V
(24240)210 1122 A
(*===========================================================================*/)3276 1482 A
4545 V
(24241)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(igetenv\(key,)504 1944 A
(optional\))378 2490 A
4635 V
(24242)210 1122 A
(char)168 1440 A
(*key;)210 1650 A
4725 V
(24243)210 1122 A
(int)126 1440 A
(optional;)378 1608 A
4815 V
(24244)210 1122 A
1440({)S
4905 V
(24245)210 1122 A
1440(/*)S
(Ask)126 1566 A
(kernel)252 1734 A
(for)126 2028 A
2196(an)S
(integer)294 2322 A
(valued)252 2658 A
(boot)168 2952 A
(environment)462 3162 A
(variable.)378 3666 A
4086(*/)S
4995 V
(24246)210 1122 A
(char)168 1524 A
(value[64];)420 1734 A
5085 V
(24247)210 1122 A
(int)126 1524 A
1692(i;)S
5175 V
(24248)210 1122 A
5265 V
(24249)210 1122 A
1524(if)S
(\(\(i)126 1650 A
1818(=)S
(env_get_param\(key,)756 1902 A
(value,)252 2700 A
(sizeof\(value\)\)\))630 2994 A
3666(!=)S
(OK\))126 3792 A
3960({)S
5355 V
(24250)210 1122 A
1692(if)S
(\(!optional\))462 1818 A
5445 V
(24251)210 1122 A
(printf\("FS:)462 1776 A
(Warning,)336 2280 A
(couldn't)336 2658 A
(get)126 3036 A
(monitor)294 3204 A
(param:)252 3540 A
(%d\\n",)252 3834 A
(i\);)126 4128 A
5535 V
(24252)210 1122 A
(return)252 1692 A
1986(0;)S
5625 V
(24253)210 1122 A
1524(})S
5715 V
(24254)210 1122 A
(return\(atoi\(value\)\);)840 1524 A
5805 V
(24255)210 1122 A
1440(})S
5985 V
(24257)210 1122 A
(/*===========================================================================*)3276 1440 A
6075 V
(24258)210 1122 A
1482(*)S
(load_ram)336 2784 A
4674(*)S
6165 V
(24259)210 1122 A
(*===========================================================================*/)3276 1482 A
6255 V
(24260)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(load_ram\(void\))588 1986 A
6345 V
(24261)210 1122 A
1440({)S
6435 V
(24262)210 1122 A
1440(/*)S
(Allocate)336 1566 A
1944(a)S
(RAM)126 2028 A
(disk)168 2196 A
(with)168 2406 A
(size)168 2616 A
(given)210 2826 A
3078(in)S
(the)126 3204 A
(boot)168 3372 A
(parameters.)462 3582 A
4086(If)S
4212(a)S
(RAM)126 4296 A
(disk)168 4464 A
6525 V
(24263)210 1122 A
1482(*)S
(image)210 1566 A
1818(is)S
(given,)252 1944 A
(the)126 2238 A
(copy)168 2406 A
(the)126 2616 A
(entire)252 2784 A
(image)210 3078 A
(device)252 3330 A
(block-by-block)588 3624 A
4254(to)S
4380(a)S
(RAM)126 4464 A
6615 V
(24264)210 1122 A
1482(*)S
(disk)168 1566 A
(with)168 1776 A
(the)126 1986 A
(same)168 2154 A
(size)168 2364 A
2574(as)S
(the)126 2700 A
(image.)252 2868 A
6705 V
(24265)210 1122 A
1482(*)S
1566(If)S
(the)126 1692 A
(root)168 1860 A
(device)252 2070 A
2364(is)S
(not)126 2490 A
(set,)168 2658 A
(the)126 2868 A
(RAM)126 3036 A
(disk)168 3204 A
(will)168 3414 A
3624(be)S
(used)168 3750 A
3960(as)S
(root)168 4086 A
(instead.)336 4296 A
6795 V
(24266)210 1122 A
1482(*/)S
6885 V
(24267)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(buf)126 2196 A
(*bp,)168 2364 A
(*bp1;)210 2574 A
6975 V
(24268)210 1122 A
(u32_t)210 1524 A
(lcount,)294 1776 A
(ram_size_kb;)504 2112 A
7065 V
(24269)210 1122 A
(zone_t)252 1524 A
(zones;)252 1818 A
8418 V
EP
%%Page: 324 324
BP
/slant 0 def
/height 0 def
1485 V
12 B
(324)180 1080 A
11 R
2385(File:)S
2618(servers/fs/main.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(24270)210 1122 A
(struct)252 1524 A
(super_block)462 1818 A
(*sp,)168 2322 A
(*dsp;)210 2532 A
1845 V
(24271)210 1122 A
(block_t)294 1524 A
1860(b;)S
1935 V
(24272)210 1122 A
(Dev_t)210 1524 A
(image_dev;)420 1776 A
2025 V
(24273)210 1122 A
(static)252 1524 A
(char)168 1818 A
(sbbuf[MIN_BLOCK_SIZE];)924 2028 A
2115 V
(24274)210 1122 A
(int)126 1524 A
(block_size_image,)714 1692 A
(block_size_ram,)630 2448 A
(ramfs_block_size;)714 3120 A
2205 V
(24275)210 1122 A
(int)126 1524 A
1692(s;)S
2295 V
(24276)210 1122 A
2385 V
(24277)210 1122 A
1524(/*)S
(Get)126 1650 A
(some)168 1818 A
(boot)168 2028 A
(environment)462 2238 A
(variables.)420 2742 A
3204(*/)S
2475 V
(24278)210 1122 A
(root_dev)336 1524 A
1902(=)S
(igetenv\("rootdev",)756 1986 A
(0\);)126 2784 A
2565 V
(24279)210 1122 A
(image_dev)378 1524 A
1944(=)S
(igetenv\("ramimagedev",)924 2028 A
(0\);)126 2994 A
2655 V
(24280)210 1122 A
(ram_size_kb)462 1524 A
2028(=)S
(igetenv\("ramsize",)756 2112 A
(0\);)126 2910 A
2745 V
(24281)210 1122 A
2835 V
(24282)210 1122 A
1524(/*)S
(Open)168 1650 A
(the)126 1860 A
(root)168 2028 A
(device.)294 2238 A
2574(*/)S
2925 V
(24283)210 1122 A
1524(if)S
(\(dev_open\(root_dev,)798 1650 A
(FS_PROC_NR,)462 2490 A
(R_BIT|W_BIT\))504 2994 A
3540(!=)S
(OK\))126 3666 A
3015 V
(24284)210 1122 A
(panic\(__FILE__,"Cannot)924 1776 A
(open)168 2742 A
(root)168 2952 A
(device",NO_NUM\);)672 3162 A
3105 V
(24285)210 1122 A
3195 V
(24286)210 1122 A
1524(/*)S
1650(If)S
1776(we)S
(must)168 1902 A
(initialize)420 2112 A
2574(a)S
(ram)126 2658 A
(disk,)210 2826 A
(get)126 3078 A
(details)294 3246 A
(from)168 3582 A
(the)126 3792 A
(image)210 3960 A
(device.)294 4212 A
4548(*/)S
3285 V
(24287)210 1122 A
1524(if)S
(\(root_dev)378 1650 A
2070(==)S
(DEV_RAM\))336 2196 A
2574({)S
3375 V
(24288)210 1122 A
(u32_t)210 1776 A
(fsmax,)252 2028 A
(probedev;)378 2322 A
3465 V
(24289)210 1122 A
3555 V
(24290)210 1122 A
1776(/*)S
1902(If)S
2028(we)S
(are)126 2154 A
(running)294 2322 A
(from)168 2658 A
(CD,)126 2868 A
(see)126 3036 A
3204(if)S
3330(we)S
(can)126 3456 A
(find)168 3624 A
(it.)126 3834 A
4002(*/)S
3645 V
(24291)210 1122 A
1776(if)S
(\(igetenv\("cdproberoot",)966 1902 A
2910(1\))S
3036(&&)S
(\(probedev=cdprobe\(\)\))840 3162 A
4044(!=)S
(NO_DEV\))294 4170 A
4506({)S
3735 V
(24292)210 1122 A
(char)168 2112 A
(devnum[10];)462 2322 A
3825 V
(24293)210 1122 A
(struct)252 2112 A
(sysgetenv)378 2406 A
(env;)168 2826 A
3915 V
(24294)210 1122 A
4005 V
(24295)210 1122 A
2112(/*)S
2238(If)S
(so,)126 2364 A
(this)168 2532 A
2742(is)S
(our)126 2868 A
(new)126 3036 A
(RAM)126 3204 A
(image)210 3372 A
(device.)294 3624 A
3960(*/)S
4095 V
(24296)210 1122 A
(image_dev)378 2112 A
2532(=)S
(probedev;)378 2616 A
4185 V
(24297)210 1122 A
4275 V
(24298)210 1122 A
2112(/*)S
(Tell)168 2238 A
2448(PM)S
(about)210 2574 A
(it,)126 2826 A
2994(so)S
(userland)336 3120 A
(can)126 3498 A
(find)168 3666 A
(out)126 3876 A
(about)210 4044 A
4296(it)S
4365 V
(24299)210 1122 A
2154(*)S
(with)168 2238 A
(sysenv)252 2448 A
(interface.)420 2742 A
4455 V
(24300)210 1122 A
2154(*/)S
4545 V
(24301)210 1122 A
(env.key)294 2112 A
2448(=)S
("cdproberoot";)588 2532 A
4635 V
(24302)210 1122 A
(env.keylen)420 2112 A
2574(=)S
(strlen\(env.key\);)672 2658 A
4725 V
(24303)210 1122 A
(sprintf\(devnum,)630 2112 A
("%d",)210 2784 A
(\(int\))210 3036 A
(probedev\);)420 3288 A
4815 V
(24304)210 1122 A
(env.val)294 2112 A
2448(=)S
(devnum;)294 2532 A
4905 V
(24305)210 1122 A
(env.vallen)420 2112 A
2574(=)S
(strlen\(devnum\);)630 2658 A
4995 V
(24306)210 1122 A
(svrctl\(MMSETPARAM,)756 2112 A
(&env\);)252 2910 A
5085 V
(24307)210 1122 A
1776(})S
5175 V
(24308)210 1122 A
5265 V
(24309)210 1122 A
1776(/*)S
(Open)168 1902 A
(image)210 2112 A
(device)252 2364 A
(for)126 2658 A
(RAM)126 2826 A
(root.)210 2994 A
3246(*/)S
5355 V
(24310)210 1122 A
1776(if)S
(\(dev_open\(image_dev,)840 1902 A
(FS_PROC_NR,)462 2784 A
(R_BIT\))252 3288 A
3582(!=)S
(OK\))126 3708 A
5445 V
(24311)210 1122 A
(panic\(__FILE__,"Cannot)924 2112 A
(open)168 3078 A
(RAM)126 3288 A
(image)210 3456 A
(device",)336 3708 A
(NO_NUM\);)336 4086 A
5535 V
(24312)210 1122 A
5625 V
(24313)210 1122 A
1776(/*)S
(Get)126 1902 A
(size)168 2070 A
2280(of)S
(RAM)126 2406 A
(disk)168 2574 A
(image)210 2784 A
(from)168 3036 A
(the)126 3246 A
(super)210 3414 A
(block.)252 3666 A
3960(*/)S
5715 V
(24314)210 1122 A
1776(sp)S
1902(=)S
(&super_block[0];)672 1986 A
5805 V
(24315)210 1122 A
(sp->s_dev)378 1776 A
2196(=)S
(image_dev;)420 2280 A
5895 V
(24316)210 1122 A
1776(if)S
(\(read_super\(sp\))630 1902 A
2574(!=)S
(OK\))126 2700 A
5985 V
(24317)210 1122 A
(panic\(__FILE__,"Bad)798 2112 A
(RAM)126 2952 A
(disk)168 3120 A
(image)210 3330 A
(FS",)168 3582 A
(NO_NUM\);)336 3792 A
6075 V
(24318)210 1122 A
6165 V
(24319)210 1122 A
(lcount)252 1776 A
2070(=)S
(sp->s_zones)462 2154 A
2658(<<)S
(sp->s_log_zone_size;)840 2784 A
3792(/*)S
3918(#)S
(blks)168 4002 A
4212(on)S
(root)168 4338 A
(dev*/)210 4548 A
6255 V
(24320)210 1122 A
6345 V
(24321)210 1122 A
1776(/*)S
(Stretch)294 1902 A
(the)126 2238 A
(RAM)126 2406 A
(disk)168 2574 A
(file)168 2784 A
(system)252 2994 A
3288(to)S
(the)126 3414 A
(boot)168 3582 A
(parameters)420 3792 A
(size,)210 4254 A
(but)126 4506 A
6435 V
(24322)210 1122 A
1818(*)S
1902(no)S
(further)294 2028 A
(than)168 2364 A
(the)126 2574 A
(last)168 2742 A
(zone)168 2952 A
(bit)126 3162 A
(map)126 3330 A
(block)210 3498 A
(allows.)294 3750 A
6525 V
(24323)210 1122 A
1818(*/)S
6615 V
(24324)210 1122 A
1776(if)S
(\(ram_size_kb*1024)714 1902 A
2658(<)S
(lcount*sp->s_block_size\))1008 2742 A
6705 V
(24325)210 1122 A
(ram_size_kb)462 2112 A
2616(=)S
(lcount*sp->s_block_size/1024;)1218 2700 A
6795 V
(24326)210 1122 A
(fsmax)210 1776 A
2028(=)S
(\(u32_t\))294 2112 A
(sp->s_zmap_blocks)714 2448 A
3204(*)S
(CHAR_BIT)336 3288 A
3666(*)S
(sp->s_block_size;)714 3750 A
6885 V
(24327)210 1122 A
(fsmax)210 1776 A
2028(=)S
(\(fsmax)252 2112 A
2406(+)S
(\(sp->s_firstdatazone-1\)\))1008 2490 A
3540(<<)S
(sp->s_log_zone_size;)840 3666 A
6975 V
(24328)210 1122 A
1776(if)S
(\(ram_size_kb*1024)714 1902 A
2658(>)S
(fsmax*sp->s_block_size\))966 2742 A
7065 V
(24329)210 1122 A
(ram_size_kb)462 2112 A
2616(=)S
(fsmax*sp->s_block_size/1024;)1176 2700 A
8418 V
EP
%%Page: 325 325
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2385(File:)S
2618(servers/fs/main.c)S
12 B
(325)180 4500 A
1755 V
7 LST
(24330)210 1122 A
1524(})S
1845 V
(24331)210 1122 A
1935 V
(24332)210 1122 A
1524(/*)S
(Tell)168 1650 A
(RAM)126 1860 A
(driver)252 2028 A
(how)126 2322 A
(big)126 2490 A
(the)126 2658 A
(RAM)126 2826 A
(disk)168 2994 A
(must)168 3204 A
(be.)126 3414 A
3582(*/)S
2025 V
(24333)210 1122 A
(m_out.m_type)504 1524 A
2070(=)S
(DEV_IOCTL;)420 2154 A
2115 V
(24334)210 1122 A
(m_out.PROC_NR)546 1524 A
2112(=)S
(FS_PROC_NR;)462 2196 A
2205 V
(24335)210 1122 A
(m_out.DEVICE)504 1524 A
2070(=)S
(RAM_DEV;)336 2154 A
2295 V
(24336)210 1122 A
(m_out.REQUEST)546 1524 A
2112(=)S
(MIOCRAMSIZE;)504 2196 A
3456(/*)S
(I/O)126 3582 A
(control)294 3750 A
4086(to)S
(use)126 4212 A
4380(*/)S
2385 V
(24337)210 1122 A
(m_out.POSITION)588 1524 A
2154(=)S
(\(ram_size_kb)504 2238 A
2784(*)S
(1024\);)252 2868 A
3456(/*)S
(request)294 3582 A
3918(in)S
(bytes)210 4044 A
4296(*/)S
2475 V
(24338)210 1122 A
1524(if)S
(\(\(s=sendrec\(MEM_PROC_NR,)1008 1650 A
(&m_out\)\))336 2700 A
3078(!=)S
(OK\))126 3204 A
2565 V
(24339)210 1122 A
(panic\("FS","sendrec)798 1776 A
(from)168 2616 A
(MEM)126 2826 A
(failed",)336 2994 A
(s\);)126 3372 A
2655 V
(24340)210 1122 A
(else)168 1524 A
1734(if)S
(\(m_out.REP_STATUS)714 1860 A
2616(!=)S
(OK\))126 2742 A
2910({)S
2745 V
(24341)210 1122 A
1776(/*)S
(Report)252 1902 A
(and)126 2196 A
(continue,)378 2364 A
(unless)252 2784 A
(RAM)126 3078 A
(disk)168 3246 A
3456(is)S
(required)336 3582 A
3960(as)S
(root)168 4086 A
(FS.)126 4296 A
4464(*/)S
2835 V
(24342)210 1122 A
1776(if)S
(\(root_dev)378 1902 A
2322(!=)S
(DEV_RAM\))336 2448 A
2826({)S
2925 V
(24343)210 1122 A
(report\("FS","can't)756 2112 A
(set)126 2910 A
(RAM)126 3078 A
(disk)168 3246 A
(size",)252 3456 A
(m_out.REP_STATUS\);)756 3750 A
3015 V
(24344)210 1122 A
(return;)294 2112 A
3105 V
(24345)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
3195 V
(24346)210 1122 A
(panic\(__FILE__,"can't)882 2112 A
(set)126 3036 A
(RAM)126 3204 A
(disk)168 3372 A
(size",)252 3582 A
(m_out.REP_STATUS\);)756 3876 A
3285 V
(24347)210 1122 A
1776(})S
3375 V
(24348)210 1122 A
1524(})S
3465 V
(24349)210 1122 A
3555 V
(24350)210 1122 A
1524(/*)S
(See)126 1650 A
1818(if)S
1944(we)S
(must)168 2070 A
(load)168 2280 A
(the)126 2490 A
(RAM)126 2658 A
(disk)168 2826 A
(image,)252 3036 A
(otherwise)378 3330 A
(return.)294 3750 A
4086(*/)S
3645 V
(24351)210 1122 A
1524(if)S
(\(root_dev)378 1650 A
2070(!=)S
(DEV_RAM\))336 2196 A
3735 V
(24352)210 1122 A
(return;)294 1776 A
3825 V
(24353)210 1122 A
3915 V
(24354)210 1122 A
1524(/*)S
(Copy)168 1650 A
(the)126 1860 A
(blocks)252 2028 A
(one)126 2322 A
2490(at)S
2616(a)S
(time)168 2700 A
(from)168 2910 A
(the)126 3120 A
(image)210 3288 A
3540(to)S
(the)126 3666 A
(RAM)126 3834 A
(disk.)210 4002 A
4254(*/)S
4005 V
(24355)210 1122 A
(printf\("Loading)630 1524 A
(RAM)126 2196 A
(disk)168 2364 A
(onto)168 2574 A
(/dev/ram:\\33[23CLoaded:)966 2784 A
3918(0)S
(KB"\);)210 4002 A
4095 V
(24356)210 1122 A
4185 V
(24357)210 1122 A
(inode[0].i_mode)630 1524 A
2196(=)S
(I_BLOCK_SPECIAL;)672 2280 A
3120(/*)S
(temp)168 3246 A
(inode)210 3456 A
(for)126 3708 A
(rahead\(\))336 3876 A
4254(*/)S
4275 V
(24358)210 1122 A
(inode[0].i_size)630 1524 A
2196(=)S
(LONG_MAX;)378 2280 A
4365 V
(24359)210 1122 A
(inode[0].i_dev)588 1524 A
2154(=)S
(image_dev;)420 2238 A
4455 V
(24360)210 1122 A
(inode[0].i_zone[0])756 1524 A
2322(=)S
(image_dev;)420 2406 A
4545 V
(24361)210 1122 A
4635 V
(24362)210 1122 A
(block_size_ram)588 1524 A
2154(=)S
(get_block_size\(DEV_RAM\);)1008 2238 A
4725 V
(24363)210 1122 A
(block_size_image)672 1524 A
2238(=)S
(get_block_size\(image_dev\);)1092 2322 A
4815 V
(24364)210 1122 A
4905 V
(24365)210 1122 A
1524(/*)S
(RAM)126 1650 A
(block)210 1818 A
(size)168 2070 A
(has)126 2280 A
2448(to)S
2574(be)S
2700(a)S
(multiple)336 2784 A
3162(of)S
(the)126 3288 A
(root)168 3456 A
(image)210 3666 A
(block)210 3918 A
4995 V
(24366)210 1122 A
1566(*)S
(size)168 1650 A
1860(to)S
(make)168 1986 A
(copying)294 2196 A
(easier.)294 2532 A
5085 V
(24367)210 1122 A
1566(*/)S
5175 V
(24368)210 1122 A
1524(if)S
(\(block_size_image)714 1650 A
2406(%)S
(block_size_ram\))630 2490 A
3162({)S
5265 V
(24369)210 1122 A
(printf\("\\nram)546 1776 A
(block)210 2364 A
(size:)210 2616 A
2868(%d)S
(image)210 2994 A
(block)210 3246 A
(size:)210 3498 A
(%d\\n",)252 3750 A
5355 V
(24370)210 1122 A
(block_size_ram,)630 2112 A
(block_size_image\);)756 2784 A
5445 V
(24371)210 1122 A
(panic\(__FILE__,)630 1776 A
("ram)168 2448 A
(disk)168 2658 A
(block)210 2868 A
(size)168 3120 A
(must)168 3330 A
3540(be)S
3666(a)S
(multiple)336 3750 A
4128(of)S
4254(")S
5535 V
(24372)210 1122 A
("the)168 2112 A
(image)210 2322 A
(disk)168 2574 A
(block)210 2784 A
(size",)252 3036 A
(NO_NUM\);)336 3330 A
5625 V
(24373)210 1122 A
1524(})S
5715 V
(24374)210 1122 A
5805 V
(24375)210 1122 A
1524(/*)S
(Loading)294 1650 A
(blocks)252 1986 A
(from)168 2280 A
(image)210 2490 A
(device.)294 2742 A
3078(*/)S
5895 V
(24376)210 1122 A
(for)126 1524 A
1692(\(b)S
1818(=)S
1902(0;)S
2028(b)S
2112(<)S
(\(block_t\))378 2196 A
(lcount;)294 2616 A
(b++\))168 2952 A
3162({)S
5985 V
(24377)210 1122 A
(int)126 1776 A
(rb,)126 1944 A
(factor;)294 2112 A
6075 V
(24378)210 1122 A
1776(bp)S
1902(=)S
(rahead\(&inode[0],)714 1986 A
2742(b,)S
(\(off_t\)block_size_image)966 2868 A
3876(*)S
3960(b,)S
(block_size_image\);)756 4086 A
6165 V
(24379)210 1122 A
(factor)252 1776 A
2070(=)S
(block_size_image/block_size_ram;)1344 2154 A
6255 V
(24380)210 1122 A
(for\(rb)252 1776 A
2070(=)S
2154(0;)S
2280(rb)S
2406(<)S
(factor;)294 2490 A
(rb++\))210 2826 A
3078({)S
6345 V
(24381)210 1122 A
(bp1)126 2112 A
2280(=)S
(get_block\(root_dev,)798 2364 A
3204(b)S
3288(*)S
(factor)252 3372 A
3666(+)S
(rb,)126 3750 A
(NO_READ\);)378 3918 A
6435 V
(24382)210 1122 A
(memcpy\(bp1->b_data,)798 2112 A
(bp->b_data)420 2952 A
3414(+)S
3498(rb)S
3624(*)S
(block_size_ram,)630 3708 A
6525 V
(24383)210 1122 A
(\(size_t\))336 2448 A
(block_size_ram\);)672 2826 A
6615 V
(24384)210 1122 A
(bp1->b_dirt)462 2112 A
2616(=)S
(DIRTY;)252 2700 A
6705 V
(24385)210 1122 A
(put_block\(bp1,)588 2112 A
(FULL_DATA_BLOCK\);)714 2742 A
6795 V
(24386)210 1122 A
1776(})S
6885 V
(24387)210 1122 A
(put_block\(bp,)546 1776 A
(FULL_DATA_BLOCK\);)714 2364 A
6975 V
(24388)210 1122 A
1776(if)S
1902(\(b)S
2028(%)S
2112(11)S
2238(==)S
2364(0\))S
7065 V
(24389)210 1122 A
(printf\("\\b\\b\\b\\b\\b\\b\\b\\b\\b%6ld)1260 1776 A
(KB",)168 3078 A
(\(\(long\))294 3288 A
3624(b)S
3708(*)S
(block_size_image\)/1024L\);)1050 3792 A
8418 V
EP
%%Page: 326 326
BP
/slant 0 def
/height 0 def
1485 V
12 B
(326)180 1080 A
11 R
2385(File:)S
2618(servers/fs/main.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(24390)210 1122 A
1524(})S
1845 V
(24391)210 1122 A
1935 V
(24392)210 1122 A
1524(/*)S
(Commit)252 1650 A
(changes)294 1944 A
2280(to)S
(RAM)126 2406 A
2574(so)S
(dev_io)252 2700 A
(will)168 2994 A
(see)126 3204 A
(it.)126 3372 A
3540(*/)S
2025 V
(24393)210 1122 A
(do_sync\(\);)420 1524 A
2115 V
(24394)210 1122 A
2205 V
(24395)210 1122 A
(printf\("\\rRAM)546 1524 A
(disk)168 2112 A
2322(of)S
2448(%u)S
2574(KB)S
(loaded)252 2700 A
(onto)168 2994 A
(/dev/ram.",)462 3204 A
(\(unsigned\))420 3708 A
(ram_size_kb\);)546 4170 A
2295 V
(24396)210 1122 A
1524(if)S
(\(root_dev)378 1650 A
2070(==)S
(DEV_RAM\))336 2196 A
(printf\(")336 2574 A
(Using)210 2952 A
(RAM)126 3204 A
(disk)168 3372 A
3582(as)S
(root)168 3708 A
(FS."\);)252 3918 A
2385 V
(24397)210 1122 A
(printf\(")336 1524 A
(\\n"\);)210 1944 A
2475 V
(24398)210 1122 A
2565 V
(24399)210 1122 A
1524(/*)S
(Invalidate)420 1650 A
(and)126 2112 A
(close)210 2280 A
(the)126 2532 A
(image)210 2700 A
(device.)294 2952 A
3288(*/)S
2655 V
(24400)210 1122 A
(invalidate\(image_dev\);)924 1524 A
2745 V
(24401)210 1122 A
(dev_close\(image_dev\);)882 1524 A
2835 V
(24402)210 1122 A
2925 V
(24403)210 1122 A
1524(/*)S
(Resize)252 1650 A
(the)126 1944 A
(RAM)126 2112 A
(disk)168 2280 A
(root)168 2490 A
(file)168 2700 A
(system.)294 2910 A
3246(*/)S
3015 V
(24404)210 1122 A
1524(if)S
(\(dev_io\(DEV_READ,)714 1650 A
(root_dev,)378 2406 A
(FS_PROC_NR,)462 2826 A
3105 V
(24405)210 1122 A
(sbbuf,)252 1776 A
(SUPER_BLOCK_BYTES,)756 2070 A
(MIN_BLOCK_SIZE,)630 2868 A
3540(0\))S
3666(!=)S
(MIN_BLOCK_SIZE\))630 3792 A
4464({)S
3195 V
(24406)210 1122 A
(printf\("WARNING:)672 1776 A
(ramdisk)294 2490 A
(read)168 2826 A
(for)126 3036 A
(resizing)336 3204 A
(failed\\n"\);)462 3582 A
3285 V
(24407)210 1122 A
1524(})S
3375 V
(24408)210 1122 A
(dsp)126 1524 A
1692(=)S
(\(struct)294 1776 A
(super_block)462 2112 A
2616(*\))S
(sbbuf;)252 2742 A
3465 V
(24409)210 1122 A
1524(if)S
(\(dsp->s_magic)546 1650 A
2238(==)S
(SUPER_V3\))378 2364 A
3555 V
(24410)210 1122 A
(ramfs_block_size)672 1776 A
2490(=)S
(dsp->s_block_size;)756 2574 A
3645 V
(24411)210 1122 A
(else)168 1524 A
3735 V
(24412)210 1122 A
(ramfs_block_size)672 1776 A
2490(=)S
(STATIC_BLOCK_SIZE;)756 2574 A
3825 V
(24413)210 1122 A
(zones)210 1524 A
1776(=)S
(\(ram_size_kb)504 1860 A
2406(*)S
(1024)168 2490 A
2700(/)S
(ramfs_block_size\))714 2784 A
3540(>>)S
(sp->s_log_zone_size;)840 3666 A
3915 V
(24414)210 1122 A
4005 V
(24415)210 1122 A
(dsp->s_nzones)546 1524 A
2112(=)S
(conv2\(sp->s_native,)798 2196 A
(\(u16_t\))294 3036 A
(zones\);)294 3372 A
4095 V
(24416)210 1122 A
(dsp->s_zones)504 1524 A
2070(=)S
(conv4\(sp->s_native,)798 2154 A
(zones\);)294 2994 A
4185 V
(24417)210 1122 A
1524(if)S
(\(dev_io\(DEV_WRITE,)756 1650 A
(root_dev,)378 2448 A
(FS_PROC_NR,)462 2868 A
4275 V
(24418)210 1122 A
(sbbuf,)252 1776 A
(SUPER_BLOCK_BYTES,)756 2070 A
(MIN_BLOCK_SIZE,)630 2868 A
3540(0\))S
3666(!=)S
(MIN_BLOCK_SIZE\))630 3792 A
4464({)S
4365 V
(24419)210 1122 A
(printf\("WARNING:)672 1776 A
(ramdisk)294 2490 A
(write)210 2826 A
(for)126 3078 A
(resizing)336 3246 A
(failed\\n"\);)462 3624 A
4455 V
(24420)210 1122 A
1524(})S
4545 V
(24421)210 1122 A
1440(})S
4725 V
(24423)210 1122 A
(/*===========================================================================*)3276 1440 A
4815 V
(24424)210 1122 A
1482(*)S
(load_super)420 2784 A
4674(*)S
4905 V
(24425)210 1122 A
(*===========================================================================*/)3276 1482 A
4995 V
(24426)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(load_super\(super_dev\))882 1986 A
5085 V
(24427)210 1122 A
(dev_t)210 1440 A
(super_dev;)420 1692 A
3120(/*)S
(place)210 3246 A
3498(to)S
(get)126 3624 A
(superblock)420 3792 A
(from)168 4254 A
4464(*/)S
5175 V
(24428)210 1122 A
1440({)S
5265 V
(24429)210 1122 A
(int)126 1524 A
(bad;)168 1692 A
5355 V
(24430)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(super_block)462 2196 A
(*sp;)168 2700 A
5445 V
(24431)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
5535 V
(24432)210 1122 A
5625 V
(24433)210 1122 A
1524(/*)S
(Initialize)420 1650 A
(the)126 2112 A
(super_block)462 2280 A
(table.)252 2784 A
3078(*/)S
5715 V
(24434)210 1122 A
(for)126 1524 A
(\(sp)126 1692 A
1860(=)S
(&super_block[0];)672 1944 A
2658(sp)S
2784(<)S
(&super_block[NR_SUPERS];)1008 2868 A
(sp++\))210 3918 A
5805 V
(24435)210 1122 A
(sp->s_dev)378 1776 A
2196(=)S
(NO_DEV;)294 2280 A
5895 V
(24436)210 1122 A
5985 V
(24437)210 1122 A
1524(/*)S
(Read)168 1650 A
1860(in)S
(super_block)462 1986 A
(for)126 2490 A
(the)126 2658 A
(root)168 2826 A
(file)168 3036 A
(system.)294 3246 A
3582(*/)S
6075 V
(24438)210 1122 A
1524(sp)S
1650(=)S
(&super_block[0];)672 1734 A
6165 V
(24439)210 1122 A
(sp->s_dev)378 1524 A
1944(=)S
(super_dev;)420 2028 A
6255 V
(24440)210 1122 A
6345 V
(24441)210 1122 A
1524(/*)S
(Check)210 1650 A
(super_block)462 1902 A
(for)126 2406 A
(consistency.)504 2574 A
3120(*/)S
6435 V
(24442)210 1122 A
(bad)126 1524 A
1692(=)S
(\(read_super\(sp\))630 1776 A
2448(!=)S
(OK\);)168 2574 A
6525 V
(24443)210 1122 A
1524(if)S
(\(!bad\))252 1650 A
1944({)S
6615 V
(24444)210 1122 A
(rip)126 1776 A
1944(=)S
(get_inode\(super_dev,)840 2028 A
(ROOT_INODE\);)504 2910 A
3456(/*)S
(inode)210 3582 A
(for)126 3834 A
(root)168 4002 A
(dir)126 4212 A
4380(*/)S
6705 V
(24445)210 1122 A
1776(if)S
1902(\()S
(\(rip->i_mode)504 1986 A
2532(&)S
(I_TYPE\))294 2616 A
2952(!=)S
(I_DIRECTORY)462 3078 A
3582(||)S
(rip->i_nlinks)546 3708 A
4296(<)S
4380(3\))S
(bad++;)252 4506 A
6795 V
(24446)210 1122 A
1524(})S
6885 V
(24447)210 1122 A
1524(if)S
(\(bad\))210 1650 A
(panic\(__FILE__,"Invalid)966 1902 A
(root)168 2910 A
(file)168 3120 A
(system",)336 3330 A
(NO_NUM\);)336 3708 A
6975 V
(24448)210 1122 A
7065 V
(24449)210 1122 A
(sp->s_imount)504 1524 A
2070(=)S
(rip;)168 2154 A
8418 V
EP
%%Page: 327 327
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2385(File:)S
2618(servers/fs/main.c)S
12 B
(327)180 4500 A
1755 V
7 LST
(24450)210 1122 A
(dup_inode\(rip\);)630 1524 A
1845 V
(24451)210 1122 A
(sp->s_isup)420 1524 A
1986(=)S
(rip;)168 2070 A
1935 V
(24452)210 1122 A
(sp->s_rd_only)546 1524 A
2112(=)S
2196(0;)S
2025 V
(24453)210 1122 A
(return;)294 1524 A
2115 V
(24454)210 1122 A
1440(})S
2295 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2385 V
(servers/fs/open.c)714 2676 A
2475 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2655 V
(24500)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(procedures)420 2532 A
(for)126 2994 A
(creating,)378 3162 A
(opening,)336 3582 A
(closing,)336 3960 A
(and)126 4338 A
2745 V
(24501)210 1122 A
1482(*)S
(seeking)294 1566 A
1902(on)S
(files.)252 2028 A
2835 V
(24502)210 1122 A
1482(*)S
2925 V
(24503)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are)126 2910 A
3015 V
(24504)210 1122 A
1482(*)S
(do_creat:)378 1650 A
(perform)294 2112 A
(the)126 2448 A
(CREAT)210 2616 A
(system)252 2868 A
(call)168 3162 A
3105 V
(24505)210 1122 A
1482(*)S
(do_open:)336 1650 A
(perform)294 2112 A
(the)126 2448 A
(OPEN)168 2616 A
(system)252 2826 A
(call)168 3120 A
3195 V
(24506)210 1122 A
1482(*)S
(do_mknod:)378 1650 A
(perform)294 2112 A
(the)126 2448 A
(MKNOD)210 2616 A
(system)252 2868 A
(call)168 3162 A
3285 V
(24507)210 1122 A
1482(*)S
(do_mkdir:)378 1650 A
(perform)294 2112 A
(the)126 2448 A
(MKDIR)210 2616 A
(system)252 2868 A
(call)168 3162 A
3375 V
(24508)210 1122 A
1482(*)S
(do_close:)378 1650 A
(perform)294 2112 A
(the)126 2448 A
(CLOSE)210 2616 A
(system)252 2868 A
(call)168 3162 A
3465 V
(24509)210 1122 A
1482(*)S
(do_lseek:)378 1650 A
(perform)294 2112 A
(the)126 2448 A
(LSEEK)210 2616 A
(system)252 2868 A
(call)168 3162 A
3555 V
(24510)210 1122 A
1482(*/)S
3645 V
(24511)210 1122 A
3735 V
(24512)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
3825 V
(24513)210 1122 A
(#include)336 1440 A
(<sys/stat.h>)504 1818 A
3915 V
(24514)210 1122 A
(#include)336 1440 A
(<fcntl.h>)378 1818 A
4005 V
(24515)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
4095 V
(24516)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
4185 V
(24517)210 1122 A
(#include)336 1440 A
("buf.h")294 1818 A
4275 V
(24518)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
4365 V
(24519)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
4455 V
(24520)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
4545 V
(24521)210 1122 A
(#include)336 1440 A
("lock.h")336 1818 A
4635 V
(24522)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
4725 V
(24523)210 1122 A
(#include)336 1440 A
("super.h")378 1818 A
4815 V
(24524)210 1122 A
4905 V
(24525)210 1122 A
(#define)294 1440 A
(offset)252 1776 A
(m2_l1)210 2070 A
4995 V
(24526)210 1122 A
5085 V
(24527)210 1122 A
(PRIVATE)294 1440 A
(char)168 1776 A
(mode_map[])420 1986 A
2448(=)S
({R_BIT,)294 2532 A
(W_BIT,)252 2868 A
(R_BIT|W_BIT,)504 3162 A
(0};)126 3708 A
5175 V
(24528)210 1122 A
5265 V
(24529)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(common_open,)504 2448 A
(\(int)168 2994 A
(oflags,)294 3204 A
(mode_t)252 3540 A
(omode\))252 3834 A
4464(\);)S
5355 V
(24530)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(pipe_open,)420 2448 A
(\(struct)294 2910 A
(inode)210 3246 A
(*rip,mode_t)462 3498 A
(bits,int)336 4002 A
(oflags\)\);)378 4380 A
5445 V
(24531)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(struct)252 2280 A
(inode)210 2574 A
(*new_node,)420 2826 A
(\(char)210 3288 A
(*path,)252 3540 A
(mode_t)252 3834 A
(bits,)210 4128 A
5535 V
(24532)210 1122 A
(zone_t)252 3792 A
(z0\))126 4086 A
4464(\);)S
5625 V
(24533)210 1122 A
5715 V
(24534)210 1122 A
(/*===========================================================================*)3276 1440 A
5805 V
(24535)210 1122 A
1482(*)S
(do_creat)336 2784 A
4674(*)S
5895 V
(24536)210 1122 A
(*===========================================================================*/)3276 1482 A
5985 V
(24537)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_creat\(\))420 1902 A
6075 V
(24538)210 1122 A
1440({)S
6165 V
(24539)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(creat\(name,)462 2070 A
(mode\))210 2574 A
(system)252 2826 A
(call.)210 3120 A
3372(*/)S
6255 V
(24540)210 1122 A
(int)126 1524 A
1692(r;)S
6345 V
(24541)210 1122 A
6435 V
(24542)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name,)924 1650 A
(m_in.name_length,)714 2616 A
(M3\))126 3372 A
3540(!=)S
(OK\))126 3666 A
(return\(err_code\);)714 3834 A
6525 V
(24543)210 1122 A
1524(r)S
1608(=)S
(common_open\(O_WRONLY)840 1692 A
2574(|)S
(O_CREAT)294 2658 A
2994(|)S
(O_TRUNC,)336 3078 A
(\(mode_t\))336 3456 A
(m_in.mode\);)462 3834 A
6615 V
(24544)210 1122 A
(return\(r\);)420 1524 A
6705 V
(24545)210 1122 A
1440(})S
8418 V
EP
%%Page: 328 328
BP
/slant 0 def
/height 0 def
1485 V
12 B
(328)180 1080 A
11 R
2388(File:)S
2621(servers/fs/open.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(24547)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(24548)210 1122 A
1482(*)S
(do_open)294 2784 A
4674(*)S
1935 V
(24549)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(24550)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_open\(\))378 1902 A
2115 V
(24551)210 1122 A
1440({)S
2205 V
(24552)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(open\(name,)420 2070 A
(flags,...\))420 2532 A
(system)252 2994 A
(call.)210 3288 A
3540(*/)S
2295 V
(24553)210 1122 A
2385 V
(24554)210 1122 A
(int)126 1524 A
(create_mode)462 1692 A
2196(=)S
2280(0;)S
2784(/*)S
2910(is)S
(really)252 3036 A
(mode_t)252 3330 A
(but)126 3624 A
(this)168 3792 A
(gives)210 4002 A
(problems)336 4254 A
4632(*/)S
2475 V
(24555)210 1122 A
(int)126 1524 A
1692(r;)S
2565 V
(24556)210 1122 A
2655 V
(24557)210 1122 A
1524(/*)S
1650(If)S
(O_CREAT)294 1776 A
2112(is)S
(set,)168 2238 A
(open)168 2448 A
(has)126 2658 A
(three)210 2826 A
(parameters,)462 3078 A
(otherwise)378 3582 A
(two.)168 4002 A
4212(*/)S
2745 V
(24558)210 1122 A
1524(if)S
(\(m_in.mode)420 1650 A
2112(&)S
(O_CREAT\))336 2196 A
2574({)S
2835 V
(24559)210 1122 A
(create_mode)462 1776 A
2280(=)S
(m_in.c_mode;)504 2364 A
2925 V
(24560)210 1122 A
1776(r)S
1860(=)S
(fetch_name\(m_in.c_name,)966 1944 A
(m_in.name1_length,)756 2952 A
(M1\);)168 3750 A
3015 V
(24561)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3105 V
(24562)210 1122 A
1776(r)S
1860(=)S
(fetch_name\(m_in.name,)882 1944 A
(m_in.name_length,)714 2868 A
(M3\);)168 3624 A
3195 V
(24563)210 1122 A
1524(})S
3285 V
(24564)210 1122 A
3375 V
(24565)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
(return\(err_code\);)714 2070 A
2826(/*)S
(name)168 2952 A
(was)126 3162 A
(bad)126 3330 A
3498(*/)S
3465 V
(24566)210 1122 A
1524(r)S
1608(=)S
(common_open\(m_in.mode,)924 1692 A
(create_mode\);)546 2658 A
3555 V
(24567)210 1122 A
(return\(r\);)420 1524 A
3645 V
(24568)210 1122 A
1440(})S
3825 V
(24570)210 1122 A
(/*===========================================================================*)3276 1440 A
3915 V
(24571)210 1122 A
1482(*)S
(common_open)462 2784 A
4674(*)S
4005 V
(24572)210 1122 A
(*===========================================================================*/)3276 1482 A
4095 V
(24573)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(common_open\(register)840 1944 A
(int)126 2826 A
(oflags,)294 2994 A
(mode_t)252 3330 A
(omode\))252 3624 A
4185 V
(24574)210 1122 A
1440({)S
4275 V
(24575)210 1122 A
1440(/*)S
(Common)252 1566 A
(code)168 1860 A
(from)168 2070 A
(do_creat)336 2280 A
(and)126 2658 A
(do_open.)336 2826 A
3204(*/)S
4365 V
(24576)210 1122 A
4455 V
(24577)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
4545 V
(24578)210 1122 A
(int)126 1524 A
1692(r,)S
1818(b,)S
(exist)210 1944 A
2196(=)S
(TRUE;)210 2280 A
4635 V
(24579)210 1122 A
(dev_t)210 1524 A
(dev;)168 1776 A
4725 V
(24580)210 1122 A
(mode_t)252 1524 A
(bits;)210 1818 A
4815 V
(24581)210 1122 A
(off_t)210 1524 A
(pos;)168 1776 A
4905 V
(24582)210 1122 A
(struct)252 1524 A
(filp)168 1818 A
(*fil_ptr,)378 2028 A
(*filp2;)294 2448 A
4995 V
(24583)210 1122 A
5085 V
(24584)210 1122 A
1524(/*)S
(Remap)210 1650 A
(the)126 1902 A
(bottom)252 2070 A
(two)126 2364 A
(bits)168 2532 A
2742(of)S
(oflags.)294 2868 A
3204(*/)S
5175 V
(24585)210 1122 A
(bits)168 1524 A
1734(=)S
(\(mode_t\))336 1818 A
(mode_map[oflags)630 2196 A
2868(&)S
(O_ACCMODE];)462 2952 A
5265 V
(24586)210 1122 A
5355 V
(24587)210 1122 A
1524(/*)S
(See)126 1650 A
1818(if)S
(file)168 1944 A
(descriptor)420 2154 A
(and)126 2616 A
(filp)168 2784 A
(slots)210 2994 A
(are)126 3246 A
(available.)420 3414 A
3876(*/)S
5445 V
(24588)210 1122 A
1524(if)S
1650(\()S
1734(\(r)S
1860(=)S
(get_fd\(0,)378 1944 A
(bits,)210 2364 A
(&m_in.fd,)378 2616 A
(&fil_ptr\)\))420 3036 A
3498(!=)S
(OK\))126 3624 A
(return\(r\);)420 3792 A
5535 V
(24589)210 1122 A
5625 V
(24590)210 1122 A
1524(/*)S
1650(If)S
(O_CREATE)336 1776 A
2154(is)S
(set,)168 2280 A
(try)126 2490 A
2658(to)S
(make)168 2784 A
(the)126 2994 A
(file.)210 3162 A
3414(*/)S
5715 V
(24591)210 1122 A
1524(if)S
(\(oflags)294 1650 A
1986(&)S
(O_CREAT\))336 2070 A
2448({)S
5805 V
(24592)210 1122 A
1776(/*)S
(Create)252 1902 A
2196(a)S
(new)126 2280 A
(inode)210 2448 A
2700(by)S
(calling)294 2826 A
(new_node\(\).)462 3162 A
3666(*/)S
5895 V
(24593)210 1122 A
(omode)210 1776 A
2028(=)S
(I_REGULAR)378 2112 A
2532(|)S
(\(omode)252 2616 A
2910(&)S
(ALL_MODES)378 2994 A
3414(&)S
(fp->fp_umask\);)588 3498 A
5985 V
(24594)210 1122 A
(rip)126 1776 A
1944(=)S
(new_node\(user_path,)798 2028 A
(omode,)252 2868 A
(NO_ZONE\);)378 3162 A
6075 V
(24595)210 1122 A
1776(r)S
1860(=)S
(err_code;)378 1944 A
6165 V
(24596)210 1122 A
1776(if)S
1902(\(r)S
2028(==)S
(OK\))126 2154 A
(exist)210 2322 A
2574(=)S
(FALSE;)252 2658 A
3162(/*)S
3288(we)S
(just)168 3414 A
(created)294 3624 A
(the)126 3960 A
(file)168 4128 A
4338(*/)S
6255 V
(24597)210 1122 A
(else)168 1776 A
1986(if)S
2112(\(r)S
2238(!=)S
(EEXIST\))294 2364 A
(return\(r\);)420 2700 A
3162(/*)S
(other)210 3288 A
(error)210 3540 A
3792(*/)S
6345 V
(24598)210 1122 A
(else)168 1776 A
(exist)210 1986 A
2238(=)S
(!\(oflags)336 2322 A
2700(&)S
(O_EXCL\);)336 2784 A
3162(/*)S
(file)168 3288 A
(exists,)294 3498 A
3834(if)S
(the)126 3960 A
(O_EXCL)252 4128 A
6435 V
(24599)210 1122 A
(flag)168 3288 A
3498(is)S
(set)126 3624 A
(this)168 3792 A
4002(is)S
4128(an)S
(error)210 4254 A
4506(*/)S
6525 V
(24600)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
6615 V
(24601)210 1122 A
1818(/*)S
(Scan)168 1944 A
(path)168 2154 A
(name.)210 2364 A
2616(*/)S
6705 V
(24602)210 1122 A
1776(if)S
1902(\()S
(\(rip)168 1986 A
2196(=)S
(eat_path\(user_path\)\))840 2280 A
3162(==)S
(NIL_INODE\))420 3288 A
(return\(err_code\);)714 3750 A
6795 V
(24603)210 1122 A
1524(})S
6885 V
(24604)210 1122 A
6975 V
(24605)210 1122 A
1524(/*)S
(Claim)210 1650 A
(the)126 1902 A
(file)168 2070 A
(descriptor)420 2280 A
(and)126 2742 A
(filp)168 2910 A
(slot)168 3120 A
(and)126 3330 A
(fill)168 3498 A
(them)168 3708 A
(in.)126 3918 A
4086(*/)S
7065 V
(24606)210 1122 A
(fp->fp_filp[m_in.fd])840 1524 A
2406(=)S
(fil_ptr;)336 2490 A
8418 V
EP
%%Page: 329 329
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2388(File:)S
2621(servers/fs/open.c)S
12 B
(329)180 4500 A
1755 V
7 LST
(24607)210 1122 A
(fil_ptr->filp_count)798 1524 A
2364(=)S
2448(1;)S
1845 V
(24608)210 1122 A
(fil_ptr->filp_ino)714 1524 A
2280(=)S
(rip;)168 2364 A
1935 V
(24609)210 1122 A
(fil_ptr->filp_flags)798 1524 A
2364(=)S
(oflags;)294 2448 A
2025 V
(24610)210 1122 A
2115 V
(24611)210 1122 A
1524(/*)S
(Only)168 1650 A
1860(do)S
(the)126 1986 A
(normal)252 2154 A
(open)168 2448 A
(code)168 2658 A
2868(if)S
2994(we)S
(didn't)252 3120 A
(just)168 3414 A
(create)252 3624 A
(the)126 3918 A
(file.)210 4086 A
4338(*/)S
2205 V
(24612)210 1122 A
1524(if)S
(\(exist\))294 1650 A
1986({)S
2295 V
(24613)210 1122 A
1776(/*)S
(Check)210 1902 A
(protections.)504 2154 A
2700(*/)S
2385 V
(24614)210 1122 A
1776(if)S
(\(\(r)126 1902 A
2070(=)S
(forbidden\(rip,)588 2154 A
(bits\)\))252 2784 A
3078(==)S
(OK\))126 3204 A
3372({)S
2475 V
(24615)210 1122 A
2112(/*)S
(Opening)294 2238 A
(reg.)168 2574 A
(files)210 2784 A
(directories)462 3036 A
(and)126 3540 A
(special)294 3708 A
(files)210 4044 A
(differ.)294 4296 A
4632(*/)S
2565 V
(24616)210 1122 A
(switch)252 2112 A
(\(rip->i_mode)504 2406 A
2952(&)S
(I_TYPE\))294 3036 A
3372({)S
2655 V
(24617)210 1122 A
(case)168 2238 A
(I_REGULAR:)420 2448 A
2745 V
(24618)210 1122 A
2448(/*)S
(Truncate)336 2574 A
(regular)294 2952 A
(file)168 3288 A
3498(if)S
(O_TRUNC.)336 3624 A
4002(*/)S
2835 V
(24619)210 1122 A
2448(if)S
(\(oflags)294 2574 A
2910(&)S
(O_TRUNC\))336 2994 A
3372({)S
2925 V
(24620)210 1122 A
2784(if)S
(\(\(r)126 2910 A
3078(=)S
(forbidden\(rip,)588 3162 A
(W_BIT\)\))294 3792 A
(!=OK\))210 4128 A
(break;)252 4380 A
3015 V
(24621)210 1122 A
(truncate\(rip\);)588 2784 A
3105 V
(24622)210 1122 A
(wipe_inode\(rip\);)672 2784 A
3195 V
(24623)210 1122 A
2784(/*)S
(Send)168 2910 A
(the)126 3120 A
(inode)210 3288 A
(from)168 3540 A
(the)126 3750 A
(inode)210 3918 A
(cache)210 4170 A
4422(to)S
(the)126 4548 A
3285 V
(24624)210 1122 A
2826(*)S
(block)210 2910 A
(cache,)252 3162 A
3456(so)S
3582(it)S
(gets)168 3708 A
(written)294 3918 A
4254(on)S
(the)126 4380 A
(next)168 4548 A
3375 V
(24625)210 1122 A
2826(*)S
(cache)210 2910 A
(flush.)252 3162 A
3465 V
(24626)210 1122 A
2826(*/)S
3555 V
(24627)210 1122 A
(rw_inode\(rip,)546 2784 A
(WRITING\);)378 3372 A
3645 V
(24628)210 1122 A
2448(})S
3735 V
(24629)210 1122 A
(break;)252 2448 A
3825 V
(24630)210 1122 A
3915 V
(24631)210 1122 A
(case)168 2238 A
(I_DIRECTORY:)504 2448 A
4005 V
(24632)210 1122 A
2448(/*)S
(Directories)462 2574 A
(may)126 3078 A
3246(be)S
(read)168 3372 A
(but)126 3582 A
(not)126 3750 A
(written.)336 3918 A
4296(*/)S
4095 V
(24633)210 1122 A
2448(r)S
2532(=)S
(\(bits)210 2616 A
2868(&)S
(W_BIT)210 2952 A
3204(?)S
(EISDIR)252 3288 A
3582(:)S
(OK\);)168 3666 A
4185 V
(24634)210 1122 A
(break;)252 2448 A
4275 V
(24635)210 1122 A
4365 V
(24636)210 1122 A
(case)168 2238 A
(I_CHAR_SPECIAL:)630 2448 A
4455 V
(24637)210 1122 A
(case)168 2238 A
(I_BLOCK_SPECIAL:)672 2448 A
4545 V
(24638)210 1122 A
2448(/*)S
(Invoke)252 2574 A
(the)126 2868 A
(driver)252 3036 A
(for)126 3330 A
(special)294 3498 A
(processing.)462 3834 A
4338(*/)S
4635 V
(24639)210 1122 A
(dev)126 2448 A
2616(=)S
(\(dev_t\))294 2700 A
(rip->i_zone[0];)630 3036 A
4725 V
(24640)210 1122 A
2448(r)S
2532(=)S
(dev_open\(dev,)546 2616 A
(who,)168 3204 A
(bits)168 3414 A
3624(|)S
(\(oflags)294 3708 A
4044(&)S
(\304O_ACCMODE\)\);)546 4128 A
4815 V
(24641)210 1122 A
(break;)252 2448 A
4905 V
(24642)210 1122 A
4995 V
(24643)210 1122 A
(case)168 2238 A
(I_NAMED_PIPE:)546 2448 A
5085 V
(24644)210 1122 A
(oflags)252 2448 A
2742(|=)S
(O_APPEND;)378 2868 A
3456(/*)S
(force)210 3582 A
(append)252 3834 A
(mode)168 4128 A
4338(*/)S
5175 V
(24645)210 1122 A
(fil_ptr->filp_flags)798 2448 A
3288(=)S
(oflags;)294 3372 A
5265 V
(24646)210 1122 A
2448(r)S
2532(=)S
(pipe_open\(rip,)588 2616 A
(bits,)210 3246 A
(oflags\);)336 3498 A
5355 V
(24647)210 1122 A
2448(if)S
2574(\(r)S
2700(!=)S
(ENXIO\))252 2826 A
3120({)S
5445 V
(24648)210 1122 A
2784(/*)S
(See)126 2910 A
3078(if)S
(someone)294 3204 A
(else)168 3540 A
3750(is)S
(doing)210 3876 A
4128(a)S
4212(rd)S
4338(or)S
4464(wt)S
4590(on)S
5535 V
(24649)210 1122 A
2826(*)S
(the)126 2910 A
(FIFO.)210 3078 A
3372(If)S
(so,)126 3498 A
(use)126 3666 A
(its)126 3834 A
(filp)168 4002 A
(entry)210 4212 A
4464(so)S
(the)126 4590 A
5625 V
(24650)210 1122 A
2826(*)S
(file)168 2910 A
(position)336 3120 A
(will)168 3498 A
3708(be)S
(automatically)546 3834 A
(shared.)294 4422 A
5715 V
(24651)210 1122 A
2826(*/)S
5805 V
(24652)210 1122 A
2784(b)S
2868(=)S
(\(bits)210 2952 A
3204(&)S
(R_BIT)210 3288 A
3540(?)S
(R_BIT)210 3624 A
3876(:)S
(W_BIT\);)294 3960 A
5895 V
(24653)210 1122 A
(fil_ptr->filp_count)798 2784 A
3624(=)S
3708(0;)S
3834(/*)S
(don't)210 3960 A
(find)168 4212 A
(self)168 4422 A
4632(*/)S
5985 V
(24654)210 1122 A
2784(if)S
(\(\(filp2)294 2910 A
3246(=)S
(find_filp\(rip,)588 3330 A
(b\)\))126 3960 A
4128(!=)S
(NIL_FILP\))378 4254 A
4674({)S
6075 V
(24655)210 1122 A
3120(/*)S
(Co-reader)378 3246 A
3666(or)S
(writer)252 3792 A
(found.)252 4086 A
(Use)126 4380 A
(it.*/)210 4548 A
6165 V
(24656)210 1122 A
(fp->fp_filp[m_in.fd])840 3120 A
4002(=)S
(filp2;)252 4086 A
6255 V
(24657)210 1122 A
(filp2->filp_count++;)840 3120 A
6345 V
(24658)210 1122 A
(filp2->filp_ino)630 3120 A
3792(=)S
(rip;)168 3876 A
6435 V
(24659)210 1122 A
(filp2->filp_flags)714 3120 A
3876(=)S
(oflags;)294 3960 A
6525 V
(24660)210 1122 A
6615 V
(24661)210 1122 A
3120(/*)S
(i_count)294 3246 A
(was)126 3582 A
(incremented)462 3750 A
(incorrectly)462 4254 A
6705 V
(24662)210 1122 A
3162(*)S
3246(by)S
(eatpath)294 3372 A
(above,)252 3708 A
(not)126 4002 A
(knowing)294 4170 A
(that)168 4506 A
6795 V
(24663)210 1122 A
3162(*)S
3246(we)S
(were)168 3372 A
(going)210 3582 A
3834(to)S
(use)126 3960 A
4128(an)S
(existing)336 4254 A
6885 V
(24664)210 1122 A
3162(*)S
(filp)168 3246 A
(entry.)252 3456 A
(Correct)294 3792 A
(this)168 4128 A
(error.)252 4338 A
6975 V
(24665)210 1122 A
3162(*/)S
7065 V
(24666)210 1122 A
(rip->i_count--;)630 3120 A
8418 V
EP
%%Page: 330 330
BP
/slant 0 def
/height 0 def
1485 V
12 B
(330)180 1080 A
11 R
2388(File:)S
2621(servers/fs/open.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(24667)210 1122 A
2784(})S
(else)168 2868 A
3078({)S
1845 V
(24668)210 1122 A
3120(/*)S
(Nobody)252 3246 A
(else)168 3540 A
(found.)252 3750 A
(Restore)294 4086 A
(filp.)210 4422 A
4674(*/)S
1935 V
(24669)210 1122 A
(fil_ptr->filp_count)798 3120 A
3960(=)S
4044(1;)S
2025 V
(24670)210 1122 A
3120(if)S
3246(\(b)S
3372(==)S
(R_BIT\))252 3498 A
2115 V
(24671)210 1122 A
(pos)126 3330 A
3498(=)S
(rip->i_zone[V2_NR_DZONES+0];)1176 3582 A
2205 V
(24672)210 1122 A
(else)168 3120 A
2295 V
(24673)210 1122 A
(pos)126 3330 A
3498(=)S
(rip->i_zone[V2_NR_DZONES+1];)1176 3582 A
2385 V
(24674)210 1122 A
(fil_ptr->filp_pos)714 3120 A
3876(=)S
(pos;)168 3960 A
2475 V
(24675)210 1122 A
2784(})S
2565 V
(24676)210 1122 A
2448(})S
2655 V
(24677)210 1122 A
(break;)252 2448 A
2745 V
(24678)210 1122 A
2112(})S
2835 V
(24679)210 1122 A
1776(})S
2925 V
(24680)210 1122 A
1524(})S
3015 V
(24681)210 1122 A
3105 V
(24682)210 1122 A
1524(/*)S
1650(If)S
(error,)252 1776 A
(release)294 2070 A
(inode.)252 2406 A
2700(*/)S
3195 V
(24683)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
2070({)S
3285 V
(24684)210 1122 A
1776(if)S
1902(\(r)S
2028(==)S
(SUSPEND\))336 2154 A
(return\(r\);)420 2532 A
3456(/*)S
(Oops,)210 3582 A
(just)168 3834 A
(suspended)378 4044 A
4464(*/)S
3375 V
(24685)210 1122 A
(fp->fp_filp[m_in.fd])840 1776 A
2658(=)S
(NIL_FILP;)378 2742 A
3465 V
(24686)210 1122 A
(fil_ptr->filp_count=)840 1776 A
2658(0;)S
3555 V
(24687)210 1122 A
(put_inode\(rip\);)630 1776 A
3645 V
(24688)210 1122 A
(return\(r\);)420 1776 A
3735 V
(24689)210 1122 A
1524(})S
3825 V
(24690)210 1122 A
3915 V
(24691)210 1122 A
(return\(m_in.fd\);)672 1524 A
4005 V
(24692)210 1122 A
1440(})S
4185 V
(24694)210 1122 A
(/*===========================================================================*)3276 1440 A
4275 V
(24695)210 1122 A
1482(*)S
(new_node)336 2784 A
4674(*)S
4365 V
(24696)210 1122 A
(*===========================================================================*/)3276 1482 A
4455 V
(24697)210 1122 A
(PRIVATE)294 1440 A
(struct)252 1776 A
(inode)210 2070 A
(*new_node\(char)588 2322 A
(*path,)252 2952 A
(mode_t)252 3246 A
(bits,)210 3540 A
(zone_t)252 3792 A
(z0\))126 4086 A
4545 V
(24698)210 1122 A
1440({)S
4635 V
(24699)210 1122 A
1440(/*)S
(New_node\(\))420 1566 A
2028(is)S
(called)252 2154 A
2448(by)S
(common_open\(\),)588 2574 A
(do_mknod\(\),)462 3204 A
(and)126 3708 A
(do_mkdir\(\).)462 3876 A
4725 V
(24700)210 1122 A
1482(*)S
1566(In)S
(all)126 1692 A
(cases)210 1860 A
2112(it)S
(allocates)378 2238 A
2658(a)S
(new)126 2742 A
(inode,)252 2910 A
(makes)210 3204 A
3456(a)S
(directory)378 3540 A
(entry)210 3960 A
(for)126 4212 A
4380(it)S
4506(on)S
4815 V
(24701)210 1122 A
1482(*)S
(the)126 1566 A
(path)168 1734 A
('path',)294 1944 A
(and)126 2280 A
(initializes)462 2448 A
(it.)126 2952 A
3162(It)S
(returns)294 3288 A
3624(a)S
(pointer)294 3708 A
4044(to)S
(the)126 4170 A
(inode)210 4338 A
4590(if)S
4905 V
(24702)210 1122 A
1482(*)S
1566(it)S
(can)126 1692 A
1860(do)S
(this;)210 1986 A
(otherwise)378 2238 A
2658(it)S
(returns)294 2784 A
(NIL_INODE.)420 3120 A
3624(It)S
(always)252 3750 A
(sets)168 4044 A
('err_code')420 4254 A
4995 V
(24703)210 1122 A
1482(*)S
1566(to)S
1692(an)S
(appropriate)462 1818 A
(value)210 2322 A
(\(OK)126 2574 A
2742(or)S
2868(an)S
(error)210 2994 A
(code\).)252 3246 A
5085 V
(24704)210 1122 A
1482(*/)S
5175 V
(24705)210 1122 A
5265 V
(24706)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rlast_dir_ptr,)630 2448 A
(*rip;)210 3120 A
5355 V
(24707)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(r;)S
5445 V
(24708)210 1122 A
(char)168 1524 A
(string[NAME_MAX];)714 1734 A
5535 V
(24709)210 1122 A
5625 V
(24710)210 1122 A
1524(/*)S
(See)126 1650 A
1818(if)S
(the)126 1944 A
(path)168 2112 A
(can)126 2322 A
2490(be)S
(opened)252 2616 A
(down)168 2910 A
3120(to)S
(the)126 3246 A
(last)168 3414 A
(directory.)420 3624 A
4086(*/)S
5715 V
(24711)210 1122 A
1524(if)S
(\(\(rlast_dir_ptr)630 1650 A
2322(=)S
(last_dir\(path,)588 2406 A
(string\)\))336 3036 A
3414(==)S
(NIL_INODE\))420 3540 A
(return\(NIL_INODE\);)756 4002 A
5805 V
(24712)210 1122 A
5895 V
(24713)210 1122 A
1524(/*)S
(The)126 1650 A
(final)210 1818 A
(directory)378 2070 A
2490(is)S
(accessible.)462 2616 A
(Get)126 3120 A
(final)210 3288 A
(component)378 3540 A
3960(of)S
(the)126 4086 A
(path.)210 4254 A
4506(*/)S
5985 V
(24714)210 1122 A
(rip)126 1524 A
1692(=)S
(advance\(rlast_dir_ptr,)924 1776 A
(string\);)336 2742 A
6075 V
(24715)210 1122 A
1524(if)S
1650(\()S
(rip)126 1734 A
1902(==)S
(NIL_INODE)378 2028 A
2448(&&)S
(err_code)336 2574 A
2952(==)S
(ENOENT\))294 3078 A
3414({)S
6165 V
(24716)210 1122 A
1776(/*)S
(Last)168 1902 A
(path)168 2112 A
(component)378 2322 A
(does)168 2742 A
(not)126 2952 A
(exist.)252 3120 A
(Make)168 3456 A
(new)126 3666 A
(directory)378 3834 A
(entry.)252 4254 A
4548(*/)S
6255 V
(24717)210 1122 A
1776(if)S
1902(\()S
(\(rip)168 1986 A
2196(=)S
(alloc_inode\(rlast_dir_ptr->i_dev,)1386 2280 A
(bits\)\))252 3708 A
4002(==)S
(NIL_INODE\))420 4128 A
4590({)S
6345 V
(24718)210 1122 A
2112(/*)S
(Can't)210 2238 A
(creat)210 2490 A
(new)126 2742 A
(inode:)252 2910 A
(out)126 3204 A
3372(of)S
(inodes.)294 3498 A
3834(*/)S
6435 V
(24719)210 1122 A
(put_inode\(rlast_dir_ptr\);)1050 2112 A
6525 V
(24720)210 1122 A
(return\(NIL_INODE\);)756 2112 A
6615 V
(24721)210 1122 A
1776(})S
6705 V
(24722)210 1122 A
6795 V
(24723)210 1122 A
1776(/*)S
(Force)210 1902 A
(inode)210 2154 A
2406(to)S
(the)126 2532 A
(disk)168 2700 A
(before)252 2910 A
(making)252 3204 A
(directory)378 3498 A
(entry)210 3918 A
4170(to)S
(make)168 4296 A
6885 V
(24724)210 1122 A
1818(*)S
(the)126 1902 A
(system)252 2070 A
(more)168 2364 A
(robust)252 2574 A
2868(in)S
(the)126 2994 A
(face)168 3162 A
3372(of)S
3498(a)S
(crash:)252 3582 A
3876(an)S
(inode)210 4002 A
(with)168 4254 A
6975 V
(24725)210 1122 A
1818(*)S
1902(no)S
(directory)378 2028 A
(entry)210 2448 A
2700(is)S
(much)168 2826 A
(better)252 3036 A
(than)168 3330 A
(the)126 3540 A
(opposite.)378 3708 A
7065 V
(24726)210 1122 A
1818(*/)S
8418 V
EP
%%Page: 331 331
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2388(File:)S
2621(servers/fs/open.c)S
12 B
(331)180 4500 A
1755 V
7 LST
(24727)210 1122 A
(rip->i_nlinks++;)672 1776 A
1845 V
(24728)210 1122 A
(rip->i_zone[0])588 1776 A
2406(=)S
(z0;)126 2490 A
3120(/*)S
(major/minor)462 3246 A
(device)252 3750 A
(numbers)294 4044 A
4380(*/)S
1935 V
(24729)210 1122 A
(rw_inode\(rip,)546 1776 A
(WRITING\);)378 2364 A
3120(/*)S
(force)210 3246 A
(inode)210 3498 A
3750(to)S
(disk)168 3876 A
(now)126 4086 A
4254(*/)S
2025 V
(24730)210 1122 A
2115 V
(24731)210 1122 A
1776(/*)S
(New)126 1902 A
(inode)210 2070 A
(acquired.)378 2322 A
(Try)126 2784 A
2952(to)S
(make)168 3078 A
(directory)378 3288 A
(entry.)252 3708 A
4002(*/)S
2205 V
(24732)210 1122 A
1776(if)S
(\(\(r)126 1902 A
2070(=)S
(search_dir\(rlast_dir_ptr,)1050 2154 A
(string,)294 3246 A
(&rip->i_num,ENTER\)\))798 3582 A
4422(!=)S
(OK\))126 4548 A
4716({)S
2295 V
(24733)210 1122 A
(put_inode\(rlast_dir_ptr\);)1050 2112 A
2385 V
(24734)210 1122 A
(rip->i_nlinks--;)672 2112 A
3120(/*)S
(pity,)210 3246 A
(have)168 3498 A
3708(to)S
(free)168 3834 A
(disk)168 4044 A
(inode)210 4254 A
4506(*/)S
2475 V
(24735)210 1122 A
(rip->i_dirt)462 2112 A
2616(=)S
(DIRTY;)252 2700 A
3120(/*)S
(dirty)210 3246 A
(inodes)252 3498 A
(are)126 3792 A
(written)294 3960 A
(out)126 4296 A
4464(*/)S
2565 V
(24736)210 1122 A
(put_inode\(rip\);)630 2112 A
2784(/*)S
(this)168 2910 A
(call)168 3120 A
(frees)210 3330 A
(the)126 3582 A
(inode)210 3750 A
4002(*/)S
2655 V
(24737)210 1122 A
(err_code)336 2112 A
2490(=)S
2574(r;)S
2745 V
(24738)210 1122 A
(return\(NIL_INODE\);)756 2112 A
2835 V
(24739)210 1122 A
1776(})S
2925 V
(24740)210 1122 A
3015 V
(24741)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3105 V
(24742)210 1122 A
1776(/*)S
(Either)252 1902 A
(last)168 2196 A
(component)378 2406 A
(exists,)294 2826 A
3162(or)S
(there)210 3288 A
3540(is)S
(some)168 3666 A
(problem.)336 3876 A
4254(*/)S
3195 V
(24743)210 1122 A
1776(if)S
(\(rip)168 1902 A
2112(!=)S
(NIL_INODE\))420 2238 A
3285 V
(24744)210 1122 A
2112(r)S
2196(=)S
(EEXIST;)294 2280 A
3375 V
(24745)210 1122 A
(else)168 1776 A
3465 V
(24746)210 1122 A
2112(r)S
2196(=)S
(err_code;)378 2280 A
3555 V
(24747)210 1122 A
1524(})S
3645 V
(24748)210 1122 A
3735 V
(24749)210 1122 A
1524(/*)S
(Return)252 1650 A
(the)126 1944 A
(directory)378 2112 A
(inode)210 2532 A
(and)126 2784 A
(exit.)210 2952 A
3204(*/)S
3825 V
(24750)210 1122 A
(put_inode\(rlast_dir_ptr\);)1050 1524 A
3915 V
(24751)210 1122 A
(err_code)336 1524 A
1902(=)S
1986(r;)S
4005 V
(24752)210 1122 A
(return\(rip\);)504 1524 A
4095 V
(24753)210 1122 A
1440(})S
4275 V
(24755)210 1122 A
(/*===========================================================================*)3276 1440 A
4365 V
(24756)210 1122 A
1482(*)S
(pipe_open)378 2784 A
4674(*)S
4455 V
(24757)210 1122 A
(*===========================================================================*/)3276 1482 A
4545 V
(24758)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(pipe_open\(register)756 1944 A
(struct)252 2742 A
(inode)210 3036 A
(*rip,)210 3288 A
(register)336 3540 A
(mode_t)252 3918 A
(bits,)210 4212 A
4635 V
(24759)210 1122 A
(register)336 1776 A
(int)126 2154 A
(oflags\))294 2322 A
4725 V
(24760)210 1122 A
1440({)S
4815 V
(24761)210 1122 A
1440(/*)S
(This)168 1608 A
(function)336 1818 A
2196(is)S
(called)252 2322 A
(from)168 2616 A
(common_open.)504 2826 A
3372(It)S
(checks)252 3498 A
3792(if)S
4905 V
(24762)210 1122 A
1482(*)S
(there)210 1608 A
1860(is)S
1986(at)S
(least)210 2112 A
(one)126 2364 A
(reader/writer)546 2532 A
(pair)168 3120 A
(for)126 3330 A
(the)126 3498 A
(pipe,)210 3666 A
3918(if)S
(not)126 4044 A
4995 V
(24763)210 1122 A
1482(*)S
1608(it)S
(suspends)336 1734 A
(the)126 2112 A
(caller,)294 2280 A
(otherwise)378 2616 A
3036(it)S
(revives)294 3162 A
(all)126 3498 A
(other)210 3666 A
(blocked)294 3918 A
5085 V
(24764)210 1122 A
1482(*)S
(processes)378 1608 A
(hanging)294 2028 A
2364(on)S
(the)126 2490 A
(pipe.)210 2658 A
5175 V
(24765)210 1122 A
1482(*/)S
5265 V
(24766)210 1122 A
5355 V
(24767)210 1122 A
(rip->i_pipe)462 1524 A
2028(=)S
(I_PIPE;)294 2112 A
5445 V
(24768)210 1122 A
1524(if)S
(\(find_filp\(rip,)630 1650 A
(bits)168 2322 A
2532(&)S
(W_BIT)210 2616 A
2868(?)S
(R_BIT)210 2952 A
3204(:)S
(W_BIT\))252 3288 A
3582(==)S
(NIL_FILP\))378 3708 A
4128({)S
5535 V
(24769)210 1122 A
1776(if)S
(\(oflags)294 1902 A
2238(&)S
(O_NONBLOCK\))462 2322 A
2826({)S
5625 V
(24770)210 1122 A
2112(if)S
(\(bits)210 2238 A
2490(&)S
(W_BIT\))252 2574 A
(return\(ENXIO\);)588 2868 A
5715 V
(24771)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
5805 V
(24772)210 1122 A
(suspend\(XPOPEN\);)672 2112 A
3120(/*)S
(suspend)294 3246 A
(caller)252 3582 A
3876(*/)S
5895 V
(24773)210 1122 A
(return\(SUSPEND\);)672 2112 A
5985 V
(24774)210 1122 A
1776(})S
6075 V
(24775)210 1122 A
1524(})S
(else)168 1608 A
1818(if)S
(\(susp_count)462 1944 A
2448(>)S
2532(0\))S
({/*)126 2658 A
(revive)252 2826 A
(blocked)294 3120 A
(processes)378 3456 A
3876(*/)S
6165 V
(24776)210 1122 A
(release\(rip,)504 1776 A
(OPEN,)210 2322 A
(susp_count\);)504 2574 A
6255 V
(24777)210 1122 A
(release\(rip,)504 1776 A
(CREAT,)252 2322 A
(susp_count\);)504 2616 A
6345 V
(24778)210 1122 A
1524(})S
6435 V
(24779)210 1122 A
(return\(OK\);)462 1524 A
6525 V
(24780)210 1122 A
1440(})S
6705 V
(24782)210 1122 A
(/*===========================================================================*)3276 1440 A
6795 V
(24783)210 1122 A
1482(*)S
(do_mknod)336 2784 A
4674(*)S
6885 V
(24784)210 1122 A
(*===========================================================================*/)3276 1482 A
6975 V
(24785)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_mknod\(\))420 1902 A
7065 V
(24786)210 1122 A
1440({)S
8418 V
EP
%%Page: 332 332
BP
/slant 0 def
/height 0 def
1485 V
12 B
(332)180 1080 A
11 R
2388(File:)S
2621(servers/fs/open.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(24787)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(mknod\(name,)462 2070 A
(mode,)210 2574 A
(addr\))210 2826 A
(system)252 3078 A
(call.)210 3372 A
3624(*/)S
1845 V
(24788)210 1122 A
1935 V
(24789)210 1122 A
(register)336 1524 A
(mode_t)252 1902 A
(bits,)210 2196 A
(mode_bits;)420 2448 A
2025 V
(24790)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*ip;)168 2070 A
2115 V
(24791)210 1122 A
2205 V
(24792)210 1122 A
1524(/*)S
(Only)168 1650 A
(the)126 1860 A
(super_user)420 2028 A
(may)126 2490 A
(make)168 2658 A
(nodes)210 2868 A
(other)210 3120 A
(than)168 3372 A
(fifos.)252 3582 A
3876(*/)S
2295 V
(24793)210 1122 A
(mode_bits)378 1524 A
1944(=)S
(\(mode_t\))336 2028 A
(m_in.mk_mode;)546 2406 A
3456(/*)S
(mode)168 3582 A
3792(of)S
(the)126 3918 A
(inode)210 4086 A
4338(*/)S
2385 V
(24794)210 1122 A
1524(if)S
(\(!super_user)504 1650 A
2196(&&)S
(\(\(mode_bits)462 2322 A
2826(&)S
(I_TYPE\))294 2910 A
3246(!=)S
(I_NAMED_PIPE\)\))588 3372 A
(return\(EPERM\);)588 4002 A
2475 V
(24795)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name1,)966 1650 A
(m_in.name1_length,)756 2658 A
(M1\))126 3456 A
3624(!=)S
(OK\))126 3750 A
(return\(err_code\);)714 3918 A
2565 V
(24796)210 1122 A
(bits)168 1524 A
1734(=)S
(\(mode_bits)420 1818 A
2280(&)S
(I_TYPE\))294 2364 A
2700(|)S
(\(mode_bits)420 2784 A
3246(&)S
(ALL_MODES)378 3330 A
3750(&)S
(fp->fp_umask\);)588 3834 A
2655 V
(24797)210 1122 A
1524(ip)S
1650(=)S
(new_node\(user_path,)798 1734 A
(bits,)210 2574 A
(\(zone_t\))336 2826 A
(m_in.mk_z0\);)504 3204 A
2745 V
(24798)210 1122 A
(put_inode\(ip\);)588 1524 A
2835 V
(24799)210 1122 A
(return\(err_code\);)714 1524 A
2925 V
(24800)210 1122 A
1440(})S
3105 V
(24802)210 1122 A
(/*===========================================================================*)3276 1440 A
3195 V
(24803)210 1122 A
1482(*)S
(do_mkdir)336 2784 A
4674(*)S
3285 V
(24804)210 1122 A
(*===========================================================================*/)3276 1482 A
3375 V
(24805)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_mkdir\(\))420 1902 A
3465 V
(24806)210 1122 A
1440({)S
3555 V
(24807)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(mkdir\(name,)462 2070 A
(mode\))210 2574 A
(system)252 2826 A
(call.)210 3120 A
3372(*/)S
3645 V
(24808)210 1122 A
3735 V
(24809)210 1122 A
(int)126 1524 A
(r1,)126 1692 A
(r2;)126 1860 A
2784(/*)S
(status)252 2910 A
(codes)210 3204 A
3456(*/)S
3825 V
(24810)210 1122 A
(ino_t)210 1524 A
(dot,)168 1776 A
(dotdot;)294 1986 A
2784(/*)S
(inode)210 2910 A
(numbers)294 3162 A
(for)126 3498 A
3666(.)S
(and)126 3750 A
3918(..)S
4044(*/)S
3915 V
(24811)210 1122 A
(mode_t)252 1524 A
(bits;)210 1818 A
2784(/*)S
(mode)168 2910 A
(bits)168 3120 A
(for)126 3330 A
(the)126 3498 A
(new)126 3666 A
(inode)210 3834 A
4086(*/)S
4005 V
(24812)210 1122 A
(char)168 1524 A
(string[NAME_MAX];)714 1734 A
2784(/*)S
(last)168 2910 A
(component)378 3120 A
3540(of)S
(the)126 3666 A
(new)126 3834 A
(dir's)210 4002 A
(path)168 4254 A
(name)168 4464 A
4674(*/)S
4095 V
(24813)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip,)210 2448 A
(*ldirp;)294 2700 A
4185 V
(24814)210 1122 A
4275 V
(24815)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(to)S
(see)126 2028 A
2196(if)S
2322(it)S
2448(is)S
(possible)336 2574 A
2952(to)S
(make)168 3078 A
(another)294 3288 A
(link)168 3624 A
3834(in)S
(the)126 3960 A
(parent)252 4128 A
(dir.)168 4422 A
4632(*/)S
4365 V
(24816)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name1,)966 1650 A
(m_in.name1_length,)756 2658 A
(M1\))126 3456 A
3624(!=)S
(OK\))126 3750 A
(return\(err_code\);)714 3918 A
4455 V
(24817)210 1122 A
(ldirp)210 1524 A
1776(=)S
(last_dir\(user_path,)798 1860 A
(string\);)336 2700 A
3120(/*)S
(pointer)294 3246 A
3582(to)S
(new)126 3708 A
(dir's)210 3876 A
(parent)252 4128 A
4422(*/)S
4545 V
(24818)210 1122 A
1524(if)S
(\(ldirp)252 1650 A
1944(==)S
(NIL_INODE\))420 2070 A
(return\(err_code\);)714 2532 A
4635 V
(24819)210 1122 A
1524(if)S
(\(ldirp->i_nlinks)672 1650 A
2364(>=)S
(\(ldirp->i_sp->s_version)966 2490 A
3498(==)S
3624(V1)S
3750(?)S
4725 V
(24820)210 1122 A
(CHAR_MAX)336 1818 A
2196(:)S
(SHRT_MAX\)\))420 2280 A
2742({)S
4815 V
(24821)210 1122 A
(put_inode\(ldirp\);)714 1776 A
2784(/*)S
(return)252 2910 A
(parent)252 3204 A
3498(*/)S
4905 V
(24822)210 1122 A
(return\(EMLINK\);)630 1776 A
4995 V
(24823)210 1122 A
1524(})S
5085 V
(24824)210 1122 A
5175 V
(24825)210 1122 A
1524(/*)S
(Next)168 1650 A
(make)168 1860 A
(the)126 2070 A
(inode.)252 2238 A
2532(If)S
(that)168 2658 A
(fails,)252 2868 A
(return)252 3162 A
(error)210 3456 A
(code.)210 3708 A
3960(*/)S
5265 V
(24826)210 1122 A
(bits)168 1524 A
1734(=)S
(I_DIRECTORY)462 1818 A
2322(|)S
(\(m_in.mode)420 2406 A
2868(&)S
(RWX_MODES)378 2952 A
3372(&)S
(fp->fp_umask\);)588 3456 A
5355 V
(24827)210 1122 A
(rip)126 1524 A
1692(=)S
(new_node\(user_path,)798 1776 A
(bits,)210 2616 A
(\(zone_t\))336 2868 A
(0\);)126 3246 A
5445 V
(24828)210 1122 A
1524(if)S
(\(rip)168 1650 A
1860(==)S
(NIL_INODE)378 1986 A
2406(||)S
(err_code)336 2532 A
2910(==)S
(EEXIST\))294 3036 A
3372({)S
5535 V
(24829)210 1122 A
(put_inode\(rip\);)630 1776 A
2784(/*)S
(can't)210 2910 A
(make)168 3162 A
(dir:)168 3372 A
3582(it)S
(already)294 3708 A
(exists)252 4044 A
4338(*/)S
5625 V
(24830)210 1122 A
(put_inode\(ldirp\);)714 1776 A
2784(/*)S
(return)252 2910 A
(parent)252 3204 A
(too)126 3498 A
3666(*/)S
5715 V
(24831)210 1122 A
(return\(err_code\);)714 1776 A
5805 V
(24832)210 1122 A
1524(})S
5895 V
(24833)210 1122 A
5985 V
(24834)210 1122 A
1524(/*)S
(Get)126 1650 A
(the)126 1818 A
(inode)210 1986 A
(numbers)294 2238 A
(for)126 2574 A
2742(.)S
(and)126 2826 A
2994(..)S
3120(to)S
(enter)210 3246 A
3498(in)S
(the)126 3624 A
(directory.)420 3792 A
4254(*/)S
6075 V
(24835)210 1122 A
(dotdot)252 1524 A
1818(=)S
(ldirp->i_num;)546 1902 A
2784(/*)S
(parent's)336 2910 A
(inode)210 3288 A
(number)252 3540 A
3834(*/)S
6165 V
(24836)210 1122 A
(dot)126 1524 A
1692(=)S
(rip->i_num;)462 1776 A
2784(/*)S
(inode)210 2910 A
(number)252 3162 A
3456(of)S
(the)126 3582 A
(new)126 3750 A
(dir)126 3918 A
(itself)252 4086 A
4380(*/)S
6255 V
(24837)210 1122 A
6345 V
(24838)210 1122 A
1524(/*)S
(Now)126 1650 A
(make)168 1818 A
(dir)126 2028 A
(entries)294 2196 A
(for)126 2532 A
2700(.)S
(and)126 2784 A
2952(..)S
(unless)252 3078 A
(the)126 3372 A
(disk)168 3540 A
3750(is)S
(completely)420 3876 A
(full.)210 4338 A
4590(*/)S
6435 V
(24839)210 1122 A
1524(/*)S
(Use)126 1650 A
(dot1)168 1818 A
(and)126 2028 A
(dot2,)210 2196 A
2448(so)S
(the)126 2574 A
(mode)168 2742 A
2952(of)S
(the)126 3078 A
(directory)378 3246 A
(isn't)210 3666 A
(important.)420 3918 A
4380(*/)S
6525 V
(24840)210 1122 A
(rip->i_mode)462 1524 A
2028(=)S
(bits;)210 2112 A
2448(/*)S
(set)126 2574 A
(mode)168 2742 A
2952(*/)S
6615 V
(24841)210 1122 A
1524(r1)S
1650(=)S
(search_dir\(rip,)630 1734 A
(dot1,)210 2406 A
(&dot,)210 2658 A
(ENTER\);)294 2910 A
3456(/*)S
(enter)210 3582 A
3834(.)S
3918(in)S
(the)126 4044 A
(new)126 4212 A
(dir)126 4380 A
4548(*/)S
6705 V
(24842)210 1122 A
1524(r2)S
1650(=)S
(search_dir\(rip,)630 1734 A
(dot2,)210 2406 A
(&dotdot,)336 2658 A
(ENTER\);)294 3036 A
3456(/*)S
(enter)210 3582 A
3834(..)S
3960(in)S
(the)126 4086 A
(new)126 4254 A
(dir)126 4422 A
4590(*/)S
6795 V
(24843)210 1122 A
6885 V
(24844)210 1122 A
1524(/*)S
1650(If)S
(both)168 1776 A
1986(.)S
(and)126 2070 A
2238(..)S
(were)168 2364 A
(successfully)504 2574 A
(entered,)336 3120 A
(increment)378 3498 A
(the)126 3918 A
(link)168 4086 A
(counts.)294 4296 A
4632(*/)S
6975 V
(24845)210 1122 A
1524(if)S
(\(r1)126 1650 A
1818(==)S
1944(OK)S
2070(&&)S
2196(r2)S
2322(==)S
(OK\))126 2448 A
2616({)S
7065 V
(24846)210 1122 A
1776(/*)S
(Normal)252 1902 A
(case.)210 2196 A
2490(It)S
(was)126 2616 A
(possible)336 2784 A
3162(to)S
(enter)210 3288 A
3540(.)S
(and)126 3624 A
3792(..)S
3918(in)S
(the)126 4044 A
(new)126 4212 A
(dir.)168 4380 A
4590(*/)S
8418 V
EP
%%Page: 333 333
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2388(File:)S
2621(servers/fs/open.c)S
12 B
(333)180 4500 A
1755 V
7 LST
(24847)210 1122 A
(rip->i_nlinks++;)672 1776 A
2784(/*)S
(this)168 2910 A
(accounts)336 3120 A
(for)126 3498 A
3666(.)S
3750(*/)S
1845 V
(24848)210 1122 A
(ldirp->i_nlinks++;)756 1776 A
2784(/*)S
(this)168 2910 A
(accounts)336 3120 A
(for)126 3498 A
3666(..)S
3792(*/)S
1935 V
(24849)210 1122 A
(ldirp->i_dirt)546 1776 A
2364(=)S
(DIRTY;)252 2448 A
2784(/*)S
(mark)168 2910 A
(parent's)336 3120 A
(inode)210 3498 A
3750(as)S
(dirty)210 3876 A
4128(*/)S
2025 V
(24850)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
2115 V
(24851)210 1122 A
1776(/*)S
1902(It)S
(was)126 2028 A
(not)126 2196 A
(possible)336 2364 A
2742(to)S
(enter)210 2868 A
3120(.)S
3204(or)S
3330(..)S
(probably)336 3456 A
(disk)168 3834 A
(was)126 4044 A
(full.)210 4212 A
4464(*/)S
2205 V
(24852)210 1122 A
(\(void\))252 1776 A
(search_dir\(ldirp,)714 2070 A
(string,)294 2826 A
(\(ino_t)252 3162 A
3456(*\))S
3582(0,)S
(DELETE\);)336 3708 A
2295 V
(24853)210 1122 A
(rip->i_nlinks--;)672 1776 A
2784(/*)S
(undo)168 2910 A
(the)126 3120 A
(increment)378 3288 A
(done)168 3708 A
3918(in)S
(new_node\(\))420 4044 A
4506(*/)S
2385 V
(24854)210 1122 A
1524(})S
2475 V
(24855)210 1122 A
(rip->i_dirt)462 1524 A
2028(=)S
(DIRTY;)252 2112 A
2784(/*)S
(either)252 2910 A
(way,)168 3204 A
(i_nlinks)336 3414 A
(has)126 3792 A
(changed)294 3960 A
4296(*/)S
2565 V
(24856)210 1122 A
2655 V
(24857)210 1122 A
(put_inode\(ldirp\);)714 1524 A
2784(/*)S
(return)252 2910 A
(the)126 3204 A
(inode)210 3372 A
3624(of)S
(the)126 3750 A
(parent)252 3918 A
(dir)126 4212 A
4380(*/)S
2745 V
(24858)210 1122 A
(put_inode\(rip\);)630 1524 A
2784(/*)S
(return)252 2910 A
(the)126 3204 A
(inode)210 3372 A
3624(of)S
(the)126 3750 A
(newly)210 3918 A
(made)168 4170 A
(dir)126 4380 A
4548(*/)S
2835 V
(24859)210 1122 A
(return\(err_code\);)714 1524 A
2784(/*)S
(new_node\(\))420 2910 A
(always)252 3372 A
(sets)168 3666 A
('err_code')420 3876 A
4338(*/)S
2925 V
(24860)210 1122 A
1440(})S
3105 V
(24862)210 1122 A
(/*===========================================================================*)3276 1440 A
3195 V
(24863)210 1122 A
1482(*)S
(do_close)336 2784 A
4674(*)S
3285 V
(24864)210 1122 A
(*===========================================================================*/)3276 1482 A
3375 V
(24865)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_close\(\))420 1902 A
3465 V
(24866)210 1122 A
1440({)S
3555 V
(24867)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(close\(fd\))378 2070 A
(system)252 2490 A
(call.)210 2784 A
3036(*/)S
3645 V
(24868)210 1122 A
3735 V
(24869)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(filp)168 2196 A
(*rfilp;)294 2406 A
3825 V
(24870)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
3915 V
(24871)210 1122 A
(struct)252 1524 A
(file_lock)378 1818 A
(*flp;)210 2238 A
4005 V
(24872)210 1122 A
(int)126 1524 A
(rw,)126 1692 A
(mode_word,)420 1860 A
(lock_count;)462 2322 A
4095 V
(24873)210 1122 A
(dev_t)210 1524 A
(dev;)168 1776 A
4185 V
(24874)210 1122 A
4275 V
(24875)210 1122 A
1524(/*)S
(First)210 1650 A
(locate)252 1902 A
(the)126 2196 A
(inode)210 2364 A
(that)168 2616 A
(belongs)294 2826 A
3162(to)S
(the)126 3288 A
(file)168 3456 A
(descriptor.)462 3666 A
4170(*/)S
4365 V
(24876)210 1122 A
1524(if)S
1650(\()S
(\(rfilp)252 1734 A
2028(=)S
(get_filp\(m_in.fd\)\))756 2112 A
2910(==)S
(NIL_FILP\))378 3036 A
(return\(err_code\);)714 3456 A
4455 V
(24877)210 1122 A
(rip)126 1524 A
1692(=)S
(rfilp->filp_ino;)672 1776 A
2784(/*)S
('rip')210 2910 A
(points)252 3162 A
3456(to)S
(the)126 3582 A
(inode)210 3750 A
4002(*/)S
4545 V
(24878)210 1122 A
4635 V
(24879)210 1122 A
1524(if)S
(\(rfilp->filp_count)756 1650 A
2448(-)S
2532(1)S
2616(==)S
2742(0)S
2826(&&)S
(rfilp->filp_mode)672 2952 A
3666(!=)S
(FILP_CLOSED\))504 3792 A
4338({)S
4725 V
(24880)210 1122 A
1776(/*)S
(Check)210 1902 A
2154(to)S
(see)126 2280 A
2448(if)S
(the)126 2574 A
(file)168 2742 A
2952(is)S
(special.)336 3078 A
3456(*/)S
4815 V
(24881)210 1122 A
(mode_word)378 1776 A
2196(=)S
(rip->i_mode)462 2280 A
2784(&)S
(I_TYPE;)294 2868 A
4905 V
(24882)210 1122 A
1776(if)S
(\(mode_word)420 1902 A
2364(==)S
(I_CHAR_SPECIAL)588 2490 A
3120(||)S
(mode_word)378 3246 A
3666(==)S
(I_BLOCK_SPECIAL\))672 3792 A
4506({)S
4995 V
(24883)210 1122 A
(dev)126 2112 A
2280(=)S
(\(dev_t\))294 2364 A
(rip->i_zone[0];)630 2700 A
5085 V
(24884)210 1122 A
2112(if)S
(\(mode_word)420 2238 A
2700(==)S
(I_BLOCK_SPECIAL\))672 2826 A
3582({)S
5175 V
(24885)210 1122 A
2448(/*)S
(Invalidate)420 2574 A
(cache)210 3036 A
(entries)294 3288 A
(unless)252 3624 A
(special)294 3918 A
4254(is)S
(mounted)294 4380 A
5265 V
(24886)210 1122 A
2490(*)S
2574(or)S
(ROOT)168 2700 A
5355 V
(24887)210 1122 A
2490(*/)S
5445 V
(24888)210 1122 A
2448(if)S
(\(!mounted\(rip\)\))630 2574 A
3246({)S
5535 V
(24889)210 1122 A
(\(void\))252 2784 A
(do_sync\(\);)420 3078 A
3792(/*)S
(purge)210 3918 A
(cache)210 4170 A
4422(*/)S
5625 V
(24890)210 1122 A
(invalidate\(dev\);)672 2784 A
5715 V
(24891)210 1122 A
2448(})S
5805 V
(24892)210 1122 A
2112(})S
5895 V
(24893)210 1122 A
2112(/*)S
2238(Do)S
(any)126 2364 A
(special)294 2532 A
(processing)420 2868 A
3330(on)S
(device)252 3456 A
(close.)252 3750 A
4044(*/)S
5985 V
(24894)210 1122 A
(dev_close\(dev\);)630 2112 A
6075 V
(24895)210 1122 A
1776(})S
6165 V
(24896)210 1122 A
1524(})S
6255 V
(24897)210 1122 A
6345 V
(24898)210 1122 A
1524(/*)S
1650(If)S
(the)126 1776 A
(inode)210 1944 A
(being)210 2196 A
(closed)252 2448 A
2742(is)S
2868(a)S
(pipe,)210 2952 A
(release)294 3204 A
(everyone)336 3540 A
(hanging)294 3918 A
4254(on)S
(it.)126 4380 A
4548(*/)S
6435 V
(24899)210 1122 A
1524(if)S
(\(rip->i_pipe)504 1650 A
2196(==)S
(I_PIPE\))294 2322 A
2658({)S
6525 V
(24900)210 1122 A
1776(rw)S
1902(=)S
(\(rfilp->filp_mode)714 1986 A
2742(&)S
(R_BIT)210 2826 A
3078(?)S
(WRITE)210 3162 A
3414(:)S
(READ\);)252 3498 A
6615 V
(24901)210 1122 A
(release\(rip,)504 1776 A
(rw,)126 2322 A
(NR_PROCS\);)420 2490 A
6705 V
(24902)210 1122 A
1524(})S
6795 V
(24903)210 1122 A
6885 V
(24904)210 1122 A
1524(/*)S
1650(If)S
1776(a)S
(write)210 1860 A
(has)126 2112 A
(been)168 2280 A
(done,)210 2490 A
(the)126 2742 A
(inode)210 2910 A
3162(is)S
(already)294 3288 A
(marked)252 3624 A
3918(as)S
(DIRTY.)252 4044 A
4338(*/)S
6975 V
(24905)210 1122 A
1524(if)S
(\(--rfilp->filp_count)840 1650 A
2532(==)S
2658(0\))S
2784({)S
7065 V
(24906)210 1122 A
1776(if)S
(\(rip->i_pipe)504 1902 A
2448(==)S
(I_PIPE)252 2574 A
2868(&&)S
(rip->i_count)504 2994 A
3540(>)S
3624(1\))S
3750({)S
8418 V
EP
%%Page: 334 334
BP
/slant 0 def
/height 0 def
1485 V
12 B
(334)180 1080 A
11 R
2388(File:)S
2621(servers/fs/open.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(24907)210 1122 A
2112(/*)S
(Save)168 2238 A
(the)126 2448 A
(file)168 2616 A
(position)336 2826 A
3204(in)S
(the)126 3330 A
(i-node)252 3498 A
3792(in)S
(case)168 3918 A
(needed)252 4128 A
(later.)252 4422 A
1845 V
(24908)210 1122 A
2154(*)S
(The)126 2238 A
(read)168 2406 A
(and)126 2616 A
(write)210 2784 A
(positions)378 3036 A
(are)126 3456 A
(saved)210 3624 A
(separately.)462 3876 A
(The)126 4422 A
1935 V
(24909)210 1122 A
2154(*)S
(last)168 2238 A
2448(3)S
(zones)210 2532 A
2784(in)S
(the)126 2910 A
(i-node)252 3078 A
(are)126 3372 A
(not)126 3540 A
(used)168 3708 A
(for)126 3918 A
(\(named\))294 4086 A
(pipes.)252 4422 A
2025 V
(24910)210 1122 A
2154(*/)S
2115 V
(24911)210 1122 A
2112(if)S
(\(rfilp->filp_mode)714 2238 A
2994(==)S
(R_BIT\))252 3120 A
2205 V
(24912)210 1122 A
(rip->i_zone[V2_NR_DZONES+0])1134 2448 A
3624(=)S
(\(zone_t\))336 3708 A
(rfilp->filp_pos;)672 4086 A
2295 V
(24913)210 1122 A
(else)168 2112 A
2385 V
(24914)210 1122 A
(rip->i_zone[V2_NR_DZONES+1])1134 2448 A
3624(=)S
(\(zone_t\))336 3708 A
(rfilp->filp_pos;)672 4086 A
2475 V
(24915)210 1122 A
1776(})S
2565 V
(24916)210 1122 A
(put_inode\(rip\);)630 1776 A
2655 V
(24917)210 1122 A
1524(})S
2745 V
(24918)210 1122 A
2835 V
(24919)210 1122 A
(fp->fp_cloexec)588 1524 A
2154(&=)S
(\304\(1L)168 2280 A
2490(<<)S
(m_in.fd\);)378 2616 A
3120(/*)S
(turn)168 3246 A
(off)126 3456 A
(close-on-exec)546 3624 A
(bit)126 4212 A
4380(*/)S
2925 V
(24920)210 1122 A
(fp->fp_filp[m_in.fd])840 1524 A
2406(=)S
(NIL_FILP;)378 2490 A
3015 V
(24921)210 1122 A
3105 V
(24922)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(to)S
(see)126 2028 A
2196(if)S
(the)126 2322 A
(file)168 2490 A
2700(is)S
(locked.)294 2826 A
3204(If)S
(so,)126 3330 A
(release)294 3498 A
(all)126 3834 A
(locks.)252 4002 A
4296(*/)S
3195 V
(24923)210 1122 A
1524(if)S
(\(nr_locks)378 1650 A
2070(==)S
2196(0\))S
(return\(OK\);)462 2322 A
3285 V
(24924)210 1122 A
(lock_count)420 1524 A
1986(=)S
(nr_locks;)378 2070 A
2784(/*)S
(save)168 2910 A
(count)210 3120 A
3372(of)S
(locks)210 3498 A
3750(*/)S
3375 V
(24925)210 1122 A
(for)126 1524 A
(\(flp)168 1692 A
1902(=)S
(&file_lock[0];)588 1986 A
(flp)126 2616 A
2784(<)S
(&file_lock[NR_LOCKS];)882 2868 A
(flp++\))252 3792 A
4086({)S
3465 V
(24926)210 1122 A
1776(if)S
(\(flp->lock_type)630 1902 A
2574(==)S
2700(0\))S
(continue;)378 2826 A
3456(/*)S
(slot)168 3582 A
(not)126 3792 A
3960(in)S
(use)126 4086 A
4254(*/)S
3555 V
(24927)210 1122 A
1776(if)S
(\(flp->lock_inode)672 1902 A
2616(==)S
(rip)126 2742 A
2910(&&)S
(flp->lock_pid)546 3036 A
3624(==)S
(fp->fp_pid\))462 3750 A
4254({)S
3645 V
(24928)210 1122 A
(flp->lock_type)588 2112 A
2742(=)S
2826(0;)S
3735 V
(24929)210 1122 A
(nr_locks--;)462 2112 A
3825 V
(24930)210 1122 A
1776(})S
3915 V
(24931)210 1122 A
1524(})S
4005 V
(24932)210 1122 A
1524(if)S
(\(nr_locks)378 1650 A
2070(<)S
(lock_count\))462 2154 A
(lock_revive\(\);)588 2658 A
3456(/*)S
(lock)168 3582 A
(released)336 3792 A
4170(*/)S
4095 V
(24933)210 1122 A
(return\(OK\);)462 1524 A
4185 V
(24934)210 1122 A
1440(})S
4365 V
(24936)210 1122 A
(/*===========================================================================*)3276 1440 A
4455 V
(24937)210 1122 A
1482(*)S
(do_lseek)336 2784 A
4674(*)S
4545 V
(24938)210 1122 A
(*===========================================================================*/)3276 1482 A
4635 V
(24939)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_lseek\(\))420 1902 A
4725 V
(24940)210 1122 A
1440({)S
4815 V
(24941)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(lseek\(ls_fd,)504 2070 A
(offset,)294 2616 A
(whence\))294 2952 A
(system)252 3288 A
(call.)210 3582 A
3834(*/)S
4905 V
(24942)210 1122 A
4995 V
(24943)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(filp)168 2196 A
(*rfilp;)294 2406 A
5085 V
(24944)210 1122 A
(register)336 1524 A
(off_t)210 1902 A
(pos;)168 2154 A
5175 V
(24945)210 1122 A
5265 V
(24946)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(to)S
(see)126 2028 A
2196(if)S
(the)126 2322 A
(file)168 2490 A
(descriptor)420 2700 A
3162(is)S
(valid.)252 3288 A
3582(*/)S
5355 V
(24947)210 1122 A
1524(if)S
1650(\()S
(\(rfilp)252 1734 A
2028(=)S
(get_filp\(m_in.ls_fd\)\))882 2112 A
3036(==)S
(NIL_FILP\))378 3162 A
(return\(err_code\);)714 3582 A
5445 V
(24948)210 1122 A
5535 V
(24949)210 1122 A
1524(/*)S
1650(No)S
(lseek)210 1776 A
2028(on)S
(pipes.)252 2154 A
2448(*/)S
5625 V
(24950)210 1122 A
1524(if)S
(\(rfilp->filp_ino->i_pipe)1008 1650 A
2700(==)S
(I_PIPE\))294 2826 A
(return\(ESPIPE\);)630 3162 A
5715 V
(24951)210 1122 A
5805 V
(24952)210 1122 A
1524(/*)S
(The)126 1650 A
(value)210 1818 A
2070(of)S
('whence')336 2196 A
(determines)420 2574 A
(the)126 3036 A
(start)210 3204 A
(position)336 3456 A
3834(to)S
(use.)168 3960 A
4170(*/)S
5895 V
(24953)210 1122 A
(switch\(m_in.whence\))798 1524 A
2364({)S
5985 V
(24954)210 1122 A
(case)168 1776 A
1986(0:)S
(pos)126 2112 A
2280(=)S
2364(0;)S
(break;)252 2784 A
6075 V
(24955)210 1122 A
(case)168 1776 A
1986(1:)S
(pos)126 2112 A
2280(=)S
(rfilp->filp_pos;)672 2364 A
(break;)252 3120 A
6165 V
(24956)210 1122 A
(case)168 1776 A
1986(2:)S
(pos)126 2112 A
2280(=)S
(rfilp->filp_ino->i_size;)1008 2364 A
(break;)252 3456 A
6255 V
(24957)210 1122 A
(default:)336 1776 A
(return\(EINVAL\);)630 2154 A
6345 V
(24958)210 1122 A
1524(})S
6435 V
(24959)210 1122 A
6525 V
(24960)210 1122 A
1524(/*)S
(Check)210 1650 A
(for)126 1902 A
(overflow.)378 2070 A
2490(*/)S
6615 V
(24961)210 1122 A
1524(if)S
(\(\(\(long\)m_in.offset)798 1650 A
2490(>)S
2574(0\))S
2700(&&)S
(\(\(long\)\(pos)462 2826 A
3330(+)S
(m_in.offset\))504 3414 A
3960(<)S
(\(long\)pos\)\))462 4044 A
6705 V
(24962)210 1122 A
(return\(EINVAL\);)630 1776 A
6795 V
(24963)210 1122 A
1524(if)S
(\(\(\(long\)m_in.offset)798 1650 A
2490(<)S
2574(0\))S
2700(&&)S
(\(\(long\)\(pos)462 2826 A
3330(+)S
(m_in.offset\))504 3414 A
3960(>)S
(\(long\)pos\)\))462 4044 A
6885 V
(24964)210 1122 A
(return\(EINVAL\);)630 1776 A
6975 V
(24965)210 1122 A
(pos)126 1524 A
1692(=)S
(pos)126 1776 A
1944(+)S
(m_in.offset;)504 2028 A
7065 V
(24966)210 1122 A
8418 V
EP
%%Page: 335 335
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2388(File:)S
2621(servers/fs/open.c)S
12 B
(335)180 4500 A
1755 V
7 LST
(24967)210 1122 A
1524(if)S
(\(pos)168 1650 A
1860(!=)S
(rfilp->filp_pos\))672 1986 A
1845 V
(24968)210 1122 A
(rfilp->filp_ino->i_seek)966 1776 A
2784(=)S
(ISEEK;)252 2868 A
3456(/*)S
(inhibit)294 3582 A
(read)168 3918 A
(ahead)210 4128 A
4380(*/)S
1935 V
(24969)210 1122 A
(rfilp->filp_pos)630 1524 A
2196(=)S
(pos;)168 2280 A
2025 V
(24970)210 1122 A
(m_out.reply_l1)588 1524 A
2154(=)S
(pos;)168 2238 A
2784(/*)S
(insert)252 2910 A
(the)126 3204 A
(long)168 3372 A
(into)168 3582 A
(the)126 3792 A
(output)252 3960 A
(message)294 4254 A
4590(*/)S
2115 V
(24971)210 1122 A
(return\(OK\);)462 1524 A
2205 V
(24972)210 1122 A
1440(})S
2745 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2835 V
(servers/fs/read.c)714 2676 A
2925 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3105 V
(25000)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(heart)210 2532 A
2784(of)S
(the)126 2910 A
(mechanism)378 3078 A
(used)168 3498 A
3708(to)S
(read)168 3834 A
(\(and)168 4044 A
(write\))252 4254 A
3195 V
(25001)210 1122 A
1482(*)S
(files.)252 1566 A
(Read)168 1902 A
(and)126 2112 A
(write)210 2280 A
(requests)336 2532 A
(are)126 2910 A
(split)210 3078 A
3330(up)S
(into)168 3456 A
(chunks)252 3666 A
(that)168 3960 A
4170(do)S
(not)126 4296 A
(cross)210 4464 A
3285 V
(25002)210 1122 A
1482(*)S
(block)210 1566 A
(boundaries.)462 1818 A
(Each)168 2364 A
(chunk)210 2574 A
2826(is)S
(then)168 2952 A
(processed)378 3162 A
3582(in)S
(turn.)210 3708 A
(Reads)210 4002 A
4254(on)S
(special)294 4380 A
3375 V
(25003)210 1122 A
1482(*)S
(files)210 1566 A
(are)126 1818 A
(also)168 1986 A
(detected)336 2196 A
(and)126 2574 A
(handled.)336 2742 A
3465 V
(25004)210 1122 A
1482(*)S
3555 V
(25005)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are)126 2910 A
3645 V
(25006)210 1122 A
1482(*)S
(do_read:)336 1650 A
(perform)294 2154 A
(the)126 2490 A
(READ)168 2658 A
(system)252 2868 A
(call)168 3162 A
3372(by)S
(calling)294 3498 A
(read_write)420 3834 A
3735 V
(25007)210 1122 A
1482(*)S
(read_write:)462 1650 A
(actually)336 2154 A
2532(do)S
(the)126 2658 A
(work)168 2826 A
3036(of)S
(READ)168 3162 A
(and)126 3372 A
(WRITE)210 3540 A
3825 V
(25008)210 1122 A
1482(*)S
(read_map:)378 1650 A
(given)210 2154 A
2406(an)S
(inode)210 2532 A
(and)126 2784 A
(file)168 2952 A
(position,)378 3162 A
(look)168 3582 A
3792(up)S
(its)126 3918 A
(zone)168 4086 A
(number)252 4296 A
3915 V
(25009)210 1122 A
1482(*)S
(rd_indir:)378 1650 A
(read)168 2154 A
2364(an)S
(entry)210 2490 A
2742(in)S
2868(an)S
(indirect)336 2994 A
(block)210 3372 A
4005 V
(25010)210 1122 A
1482(*)S
(read_ahead:)462 1650 A
(manage)252 2154 A
(the)126 2448 A
(block)210 2616 A
(read)168 2868 A
(ahead)210 3078 A
(business)336 3330 A
4095 V
(25011)210 1122 A
1482(*/)S
4185 V
(25012)210 1122 A
4275 V
(25013)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
4365 V
(25014)210 1122 A
(#include)336 1440 A
(<fcntl.h>)378 1818 A
4455 V
(25015)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
4545 V
(25016)210 1122 A
(#include)336 1440 A
("buf.h")294 1818 A
4635 V
(25017)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
4725 V
(25018)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
4815 V
(25019)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
4905 V
(25020)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
4995 V
(25021)210 1122 A
(#include)336 1440 A
("super.h")378 1818 A
5085 V
(25022)210 1122 A
5175 V
(25023)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(rw_chunk,)378 2448 A
(\(struct)294 2868 A
(inode)210 3204 A
(*rip,)210 3456 A
(off_t)210 3708 A
(position,)378 3960 A
5265 V
(25024)210 1122 A
(unsigned)336 1776 A
(off,)168 2154 A
(int)126 2364 A
(chunk,)252 2532 A
(unsigned)336 2826 A
(left,)210 3204 A
(int)126 3456 A
(rw_flag,)336 3624 A
5355 V
(25025)210 1122 A
(char)168 1776 A
(*buff,)252 1986 A
(int)126 2280 A
(seg,)168 2448 A
(int)126 2658 A
(usr,)168 2826 A
(int)126 3036 A
(block_size,)462 3204 A
(int)126 3708 A
(*completed\)\);)546 3876 A
5445 V
(25026)210 1122 A
5535 V
(25027)210 1122 A
(/*===========================================================================*)3276 1440 A
5625 V
(25028)210 1122 A
1482(*)S
(do_read)294 2784 A
4674(*)S
5715 V
(25029)210 1122 A
(*===========================================================================*/)3276 1482 A
5805 V
(25030)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_read\(\))378 1902 A
5895 V
(25031)210 1122 A
1440({)S
5985 V
(25032)210 1122 A
(return\(read_write\(READING\)\);)1176 1524 A
6075 V
(25033)210 1122 A
1440(})S
6255 V
(25035)210 1122 A
(/*===========================================================================*)3276 1440 A
6345 V
(25036)210 1122 A
1482(*)S
(read_write)420 2784 A
4674(*)S
6435 V
(25037)210 1122 A
(*===========================================================================*/)3276 1482 A
6525 V
(25038)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(read_write\(rw_flag\))798 1902 A
6615 V
(25039)210 1122 A
(int)126 1440 A
(rw_flag;)336 1608 A
2784(/*)S
(READING)294 2910 A
3246(or)S
(WRITING)294 3372 A
3708(*/)S
6705 V
(25040)210 1122 A
1440({)S
6795 V
(25041)210 1122 A
1440(/*)S
(Perform)294 1566 A
(read\(fd,)336 1902 A
(buffer,)294 2280 A
(nbytes\))294 2616 A
2952(or)S
(write\(fd,)378 3078 A
(buffer,)294 3498 A
(nbytes\))294 3834 A
(call.)210 4170 A
4422(*/)S
6885 V
(25042)210 1122 A
6975 V
(25043)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
7065 V
(25044)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(filp)168 2196 A
(*f;)126 2406 A
8418 V
EP
%%Page: 336 336
BP
/slant 0 def
/height 0 def
1485 V
12 B
(336)180 1080 A
11 R
2400(File:)S
2633(servers/fs/read.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(25045)210 1122 A
(off_t)210 1524 A
(bytes_left,)462 1776 A
(f_size,)294 2280 A
(position;)378 2616 A
1845 V
(25046)210 1122 A
(unsigned)336 1524 A
(int)126 1902 A
(off,)168 2070 A
(cum_io;)294 2280 A
1935 V
(25047)210 1122 A
(int)126 1524 A
(op,)126 1692 A
(oflags,)294 1860 A
2196(r,)S
(chunk,)252 2322 A
(usr,)168 2616 A
(seg,)168 2826 A
(block_spec,)462 3036 A
(char_spec;)420 3540 A
2025 V
(25048)210 1122 A
(int)126 1524 A
(regular,)336 1692 A
(partial_pipe)504 2070 A
2616(=)S
2700(0,)S
(partial_cnt)462 2826 A
3330(=)S
3414(0;)S
2115 V
(25049)210 1122 A
(mode_t)252 1524 A
(mode_word;)420 1818 A
2205 V
(25050)210 1122 A
(struct)252 1524 A
(filp)168 1818 A
(*wf;)168 2028 A
2295 V
(25051)210 1122 A
(int)126 1524 A
(block_size;)462 1692 A
2385 V
(25052)210 1122 A
(int)126 1524 A
(completed,)420 1692 A
2154(r2)S
2280(=)S
(OK;)126 2364 A
2475 V
(25053)210 1122 A
(phys_bytes)420 1524 A
1986(p;)S
2565 V
(25054)210 1122 A
2655 V
(25055)210 1122 A
1524(/*)S
(left)168 1650 A
(unfinished)420 1860 A
(rw_chunk\(\)s)462 2322 A
(from)168 2826 A
(previous)336 3036 A
(call!)210 3414 A
(this)168 3666 A
(can't)210 3876 A
(happen.)294 4128 A
2745 V
(25056)210 1122 A
1566(*)S
1650(it)S
(means)210 1776 A
(something)378 2028 A
(has)126 2448 A
(gone)168 2616 A
(wrong)210 2826 A
3078(we)S
(can't)210 3204 A
(repair)252 3456 A
(now.)168 3750 A
2835 V
(25057)210 1122 A
1566(*/)S
2925 V
(25058)210 1122 A
1524(if)S
(\(bufs_in_use)504 1650 A
2196(<)S
2280(0\))S
2406({)S
3015 V
(25059)210 1122 A
(panic\(__FILE__,"start)882 1776 A
2700(-)S
(bufs_in_use)462 2784 A
(negative",)420 3288 A
(bufs_in_use\);)546 3750 A
3105 V
(25060)210 1122 A
1524(})S
3195 V
(25061)210 1122 A
3285 V
(25062)210 1122 A
1524(/*)S
1650(MM)S
(loads)210 1776 A
(segments)336 2028 A
2406(by)S
(putting)294 2532 A
(funny)210 2868 A
(things)252 3120 A
3414(in)S
(upper)210 3540 A
3792(10)S
(bits)168 3918 A
4128(of)S
('fd'.)210 4254 A
4506(*/)S
3375 V
(25063)210 1122 A
1524(if)S
(\(who)168 1650 A
1860(==)S
(PM_PROC_NR)420 1986 A
2448(&&)S
(\(m_in.fd)336 2574 A
2952(&)S
(\(\304BYTE\)\))336 3036 A
3414(\))S
3498({)S
3465 V
(25064)210 1122 A
(usr)126 1776 A
1944(=)S
(m_in.fd)294 2028 A
2364(>>)S
2490(7;)S
3555 V
(25065)210 1122 A
(seg)126 1776 A
1944(=)S
(\(m_in.fd)336 2028 A
2406(>>)S
2532(5\))S
2658(&)S
(03;)126 2742 A
3645 V
(25066)210 1122 A
(m_in.fd)294 1776 A
2112(&=)S
(037;)168 2238 A
2784(/*)S
(get)126 2910 A
(rid)126 3078 A
3246(of)S
(user)168 3372 A
(and)126 3582 A
(segment)294 3750 A
(bits)168 4086 A
4296(*/)S
3735 V
(25067)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3825 V
(25068)210 1122 A
(usr)126 1776 A
1944(=)S
(who;)168 2028 A
2784(/*)S
(normal)252 2910 A
(case)168 3204 A
3414(*/)S
3915 V
(25069)210 1122 A
(seg)126 1776 A
1944(=)S
2028(D;)S
4005 V
(25070)210 1122 A
1524(})S
4095 V
(25071)210 1122 A
4185 V
(25072)210 1122 A
1524(/*)S
1650(If)S
(the)126 1776 A
(file)168 1944 A
(descriptor)420 2154 A
2616(is)S
(valid,)252 2742 A
(get)126 3036 A
(the)126 3204 A
(inode,)252 3372 A
(size)168 3666 A
(and)126 3876 A
(mode.)210 4044 A
4296(*/)S
4275 V
(25073)210 1122 A
1524(if)S
(\(m_in.nbytes)504 1650 A
2196(<)S
2280(0\))S
(return\(EINVAL\);)630 2406 A
4365 V
(25074)210 1122 A
1524(if)S
(\(\(f)126 1650 A
1818(=)S
(get_filp\(m_in.fd\)\))756 1902 A
2700(==)S
(NIL_FILP\))378 2826 A
(return\(err_code\);)714 3246 A
4455 V
(25075)210 1122 A
1524(if)S
(\(\(\(f->filp_mode\))672 1650 A
2364(&)S
(\(rw_flag)336 2448 A
2826(==)S
(READING)294 2952 A
3288(?)S
(R_BIT)210 3372 A
3624(:)S
(W_BIT\)\))294 3708 A
4044(==)S
4170(0\))S
4296({)S
4545 V
(25076)210 1122 A
(return\(f->filp_mode)798 1776 A
2616(==)S
(FILP_CLOSED)462 2742 A
3246(?)S
(EIO)126 3330 A
3498(:)S
(EBADF\);)294 3582 A
4635 V
(25077)210 1122 A
1524(})S
4725 V
(25078)210 1122 A
1524(if)S
(\(m_in.nbytes)504 1650 A
2196(==)S
2322(0\))S
4815 V
(25079)210 1122 A
(return\(0\);)420 1818 A
2448(/*)S
2574(so)S
(char)168 2700 A
(special)294 2910 A
(files)210 3246 A
(need)168 3498 A
(not)126 3708 A
(check)210 3876 A
(for)126 4128 A
(0*/)126 4296 A
4905 V
(25080)210 1122 A
4995 V
(25081)210 1122 A
1524(/*)S
(check)210 1650 A
1902(if)S
(user)168 2028 A
(process)294 2238 A
(has)126 2574 A
(the)126 2742 A
(memory)252 2910 A
3204(it)S
(needs.)252 3330 A
5085 V
(25082)210 1122 A
1566(*)S
1650(if)S
(not,)168 1776 A
(copying)294 1986 A
(will)168 2322 A
(fail)168 2532 A
(later.)252 2742 A
5175 V
(25083)210 1122 A
1566(*)S
1650(do)S
(this)168 1776 A
(after)210 1986 A
(0-check)294 2238 A
(above)210 2574 A
(because)294 2826 A
(umap)168 3162 A
(doesn't)294 3372 A
(want)168 3708 A
3918(to)S
(map)126 4044 A
4212(0)S
(bytes.)252 4296 A
5265 V
(25084)210 1122 A
1566(*/)S
5355 V
(25085)210 1122 A
1524(if)S
(\(\(r)126 1650 A
1818(=)S
(sys_umap\(usr,)546 1902 A
(seg,)168 2490 A
(\(vir_bytes\))462 2700 A
(m_in.buffer,)504 3204 A
(m_in.nbytes,)504 3750 A
(&p\)\))168 4296 A
4506(!=)S
(OK\))126 4632 A
5445 V
(25086)210 1122 A
(return)252 1776 A
2070(r;)S
5535 V
(25087)210 1122 A
(position)336 1524 A
1902(=)S
(f->filp_pos;)504 1986 A
5625 V
(25088)210 1122 A
(oflags)252 1524 A
1818(=)S
(f->filp_flags;)588 1902 A
5715 V
(25089)210 1122 A
(rip)126 1524 A
1692(=)S
(f->filp_ino;)504 1776 A
5805 V
(25090)210 1122 A
(f_size)252 1524 A
1818(=)S
(rip->i_size;)504 1902 A
5895 V
(25091)210 1122 A
1524(r)S
1608(=)S
(OK;)126 1692 A
5985 V
(25092)210 1122 A
1524(if)S
(\(rip->i_pipe)504 1650 A
2196(==)S
(I_PIPE\))294 2322 A
2658({)S
6075 V
(25093)210 1122 A
1776(/*)S
(fp->fp_cum_io_partial)882 1902 A
2826(is)S
(only)168 2952 A
(nonzero)294 3162 A
(when)168 3498 A
(doing)210 3708 A
(partial)294 3960 A
(writes)252 4296 A
4590(*/)S
6165 V
(25094)210 1122 A
(cum_io)252 1776 A
2070(=)S
(fp->fp_cum_io_partial;)924 2154 A
6255 V
(25095)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
6345 V
(25096)210 1122 A
(cum_io)252 1776 A
2070(=)S
2154(0;)S
6435 V
(25097)210 1122 A
1524(})S
6525 V
(25098)210 1122 A
1524(op)S
1650(=)S
(\(rw_flag)336 1734 A
2112(==)S
(READING)294 2238 A
2574(?)S
(DEV_READ)336 2658 A
3036(:)S
(DEV_WRITE\);)462 3120 A
6615 V
(25099)210 1122 A
(mode_word)378 1524 A
1944(=)S
(rip->i_mode)462 2028 A
2532(&)S
(I_TYPE;)294 2616 A
6705 V
(25100)210 1122 A
(regular)294 1524 A
1860(=)S
(mode_word)378 1944 A
2364(==)S
(I_REGULAR)378 2490 A
2910(||)S
(mode_word)378 3036 A
3456(==)S
(I_NAMED_PIPE;)546 3582 A
6795 V
(25101)210 1122 A
6885 V
(25102)210 1122 A
1524(if)S
(\(\(char_spec)462 1650 A
2154(=)S
(\(mode_word)420 2238 A
2700(==)S
(I_CHAR_SPECIAL)588 2826 A
3456(?)S
3540(1)S
3624(:)S
(0\)\)\))168 3708 A
3918({)S
6975 V
(25103)210 1122 A
1776(if)S
(\(rip->i_zone[0])630 1902 A
2574(==)S
(NO_DEV\))294 2700 A
7065 V
(25104)210 1122 A
(panic\(__FILE__,"read_write)1092 2112 A
(tries)210 3246 A
3498(to)S
(read)168 3624 A
(from)168 3834 A
4044(")S
8418 V
EP
%%Page: 337 337
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2400(File:)S
2633(servers/fs/read.c)S
12 B
(337)180 4500 A
1755 V
7 LST
(25105)210 1122 A
("character)420 2448 A
(device)252 2910 A
(NO_DEV",)336 3204 A
(NO_NUM\);)336 3582 A
1845 V
(25106)210 1122 A
(block_size)420 1776 A
2238(=)S
(get_block_size\(rip->i_zone[0]\);)1302 2322 A
1935 V
(25107)210 1122 A
1524(})S
2025 V
(25108)210 1122 A
1524(if)S
(\(\(block_spec)504 1650 A
2196(=)S
(\(mode_word)420 2280 A
2742(==)S
(I_BLOCK_SPECIAL)630 2868 A
3540(?)S
3624(1)S
3708(:)S
(0\)\)\))168 3792 A
4002({)S
2115 V
(25109)210 1122 A
(f_size)252 1776 A
2070(=)S
(ULONG_MAX;)420 2154 A
2205 V
(25110)210 1122 A
1776(if)S
(\(rip->i_zone[0])630 1902 A
2574(==)S
(NO_DEV\))294 2700 A
2295 V
(25111)210 1122 A
(panic\(__FILE__,"read_write)1092 2112 A
(tries)210 3246 A
3498(to)S
(read)168 3624 A
(from)168 3834 A
4044(")S
2385 V
(25112)210 1122 A
2112(")S
(block)210 2196 A
(device)252 2448 A
(NO_DEV",)336 2742 A
(NO_NUM\);)336 3120 A
2475 V
(25113)210 1122 A
(block_size)420 1776 A
2238(=)S
(get_block_size\(rip->i_zone[0]\);)1302 2322 A
2565 V
(25114)210 1122 A
1524(})S
2655 V
(25115)210 1122 A
2745 V
(25116)210 1122 A
1524(if)S
(\(!char_spec)462 1650 A
2154(&&)S
(!block_spec\))504 2280 A
2835 V
(25117)210 1122 A
(block_size)420 1776 A
2238(=)S
(rip->i_sp->s_block_size;)1008 2322 A
2925 V
(25118)210 1122 A
3015 V
(25119)210 1122 A
(rdwt_err)336 1524 A
1902(=)S
(OK;)126 1986 A
2784(/*)S
(set)126 2910 A
3078(to)S
(EIO)126 3204 A
3372(if)S
(disk)168 3498 A
(error)210 3708 A
(occurs)252 3960 A
4254(*/)S
3105 V
(25120)210 1122 A
3195 V
(25121)210 1122 A
1524(/*)S
(Check)210 1650 A
(for)126 1902 A
(character)378 2070 A
(special)294 2490 A
(files.)252 2826 A
3120(*/)S
3285 V
(25122)210 1122 A
1524(if)S
(\(char_spec\))462 1650 A
2154({)S
3375 V
(25123)210 1122 A
(dev_t)210 1776 A
(dev;)168 2028 A
3465 V
(25124)210 1122 A
(dev)126 1776 A
1944(=)S
(\(dev_t\))294 2028 A
(rip->i_zone[0];)630 2364 A
3555 V
(25125)210 1122 A
1776(r)S
1860(=)S
(dev_io\(op,)420 1944 A
(dev,)168 2406 A
(usr,)168 2616 A
(m_in.buffer,)504 2826 A
(position,)378 3372 A
(m_in.nbytes,)504 3792 A
(oflags\);)336 4338 A
3645 V
(25126)210 1122 A
1776(if)S
1902(\(r)S
2028(>=)S
2154(0\))S
2280({)S
3735 V
(25127)210 1122 A
(cum_io)252 2112 A
2406(=)S
2490(r;)S
3825 V
(25128)210 1122 A
(position)336 2112 A
2490(+=)S
2616(r;)S
3915 V
(25129)210 1122 A
2112(r)S
2196(=)S
(OK;)126 2280 A
4005 V
(25130)210 1122 A
1776(})S
4095 V
(25131)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
4185 V
(25132)210 1122 A
1776(if)S
(\(rw_flag)336 1902 A
2280(==)S
(WRITING)294 2406 A
2742(&&)S
(block_spec)420 2868 A
3330(==)S
3456(0\))S
3582({)S
4275 V
(25133)210 1122 A
2112(/*)S
(Check)210 2238 A
2490(in)S
(advance)294 2616 A
2952(to)S
(see)126 3078 A
3246(if)S
(file)168 3372 A
(will)168 3582 A
(grow)168 3792 A
(too)126 4002 A
(big.)168 4170 A
4380(*/)S
4365 V
(25134)210 1122 A
2112(if)S
(\(position)378 2238 A
2658(>)S
(rip->i_sp->s_max_size)882 2742 A
3666(-)S
(m_in.nbytes\))504 3750 A
4455 V
(25135)210 1122 A
(return\(EFBIG\);)588 2448 A
4545 V
(25136)210 1122 A
4635 V
(25137)210 1122 A
2112(/*)S
(Check)210 2238 A
(for)126 2490 A
(O_APPEND)336 2658 A
(flag.)210 3036 A
3288(*/)S
4725 V
(25138)210 1122 A
2112(if)S
(\(oflags)294 2238 A
2574(&)S
(O_APPEND\))378 2658 A
(position)336 3078 A
3456(=)S
(f_size;)294 3540 A
4815 V
(25139)210 1122 A
4905 V
(25140)210 1122 A
2112(/*)S
(Clear)210 2238 A
(the)126 2490 A
(zone)168 2658 A
(containing)420 2868 A
(present)294 3330 A
(EOF)126 3666 A
3834(if)S
(hole)168 3960 A
(about)210 4170 A
4995 V
(25141)210 1122 A
2154(*)S
2238(to)S
2364(be)S
(created.)336 2490 A
(This)168 2910 A
3120(is)S
(necessary)378 3246 A
(because)294 3666 A
(all)126 4002 A
(unwritten)378 4170 A
5085 V
(25142)210 1122 A
2154(*)S
(blocks)252 2238 A
(prior)210 2532 A
2784(to)S
(the)126 2910 A
(EOF)126 3078 A
(must)168 3246 A
(read)168 3456 A
3666(as)S
(zeros.)252 3792 A
5175 V
(25143)210 1122 A
2154(*/)S
5265 V
(25144)210 1122 A
2112(if)S
(\(position)378 2238 A
2658(>)S
(f_size\))294 2742 A
(clear_zone\(rip,)630 3078 A
(f_size,)294 3750 A
(0\);)126 4086 A
5355 V
(25145)210 1122 A
1776(})S
5445 V
(25146)210 1122 A
5535 V
(25147)210 1122 A
1776(/*)S
(Pipes)210 1902 A
(are)126 2154 A
2322(a)S
(little)252 2406 A
(different.)420 2700 A
(Check.)252 3204 A
3498(*/)S
5625 V
(25148)210 1122 A
1776(if)S
(\(rip->i_pipe)504 1902 A
2448(==)S
(I_PIPE\))294 2574 A
2910({)S
5715 V
(25149)210 1122 A
2070(r)S
2154(=)S
(pipe_check\(rip,)630 2238 A
(rw_flag,)336 2910 A
(oflags,)294 3288 A
5805 V
(25150)210 1122 A
(m_in.nbytes,)504 2448 A
(position,)378 2994 A
(&partial_cnt,)546 3414 A
(0\);)126 4002 A
5895 V
(25151)210 1122 A
2070(if)S
2196(\(r)S
2322(<=)S
2448(0\))S
(return\(r\);)420 2574 A
5985 V
(25152)210 1122 A
1776(})S
6075 V
(25153)210 1122 A
6165 V
(25154)210 1122 A
1776(if)S
(\(partial_cnt)504 1902 A
2448(>)S
2532(0\))S
(partial_pipe)504 2658 A
3204(=)S
3288(1;)S
6255 V
(25155)210 1122 A
6345 V
(25156)210 1122 A
1776(/*)S
(Split)210 1902 A
(the)126 2154 A
(transfer)336 2322 A
(into)168 2700 A
(chunks)252 2910 A
(that)168 3204 A
(don't)210 3414 A
(span)168 3666 A
(two)126 3876 A
(blocks.)294 4044 A
4380(*/)S
6435 V
(25157)210 1122 A
(while)210 1776 A
(\(m_in.nbytes)504 2028 A
2574(!=)S
2700(0\))S
2826({)S
6525 V
(25158)210 1122 A
6615 V
(25159)210 1122 A
(off)126 2112 A
2280(=)S
(\(unsigned)378 2364 A
(int\))168 2784 A
(\(position)378 2994 A
3414(%)S
(block_size\);/*)588 3498 A
(offset)252 4128 A
4422(in)S
(blk*/)210 4548 A
6705 V
(25160)210 1122 A
2112(if)S
(\(partial_pipe\))588 2238 A
2868({)S
2994(/*)S
(pipes)210 3120 A
(only)168 3372 A
3582(*/)S
6795 V
(25161)210 1122 A
(chunk)210 2448 A
2700(=)S
(MIN\(partial_cnt,)672 2784 A
(block_size)420 3498 A
3960(-)S
(off\);)210 4044 A
6885 V
(25162)210 1122 A
2112(})S
(else)168 2196 A
6975 V
(25163)210 1122 A
(chunk)210 2448 A
2700(=)S
(MIN\(m_in.nbytes,)672 2784 A
(block_size)420 3498 A
3960(-)S
(off\);)210 4044 A
7065 V
(25164)210 1122 A
2112(if)S
(\(chunk)252 2238 A
2532(<)S
2616(0\))S
(chunk)210 2742 A
2994(=)S
(block_size)420 3078 A
3540(-)S
(off;)168 3624 A
8418 V
EP
%%Page: 338 338
BP
/slant 0 def
/height 0 def
1485 V
12 B
(338)180 1080 A
11 R
2400(File:)S
2633(servers/fs/read.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(25165)210 1122 A
1845 V
(25166)210 1122 A
2112(if)S
(\(rw_flag)336 2238 A
2616(==)S
(READING\))336 2742 A
3120({)S
1935 V
(25167)210 1122 A
(bytes_left)420 2448 A
2910(=)S
(f_size)252 2994 A
3288(-)S
(position;)378 3372 A
2025 V
(25168)210 1122 A
2448(if)S
(\(position)378 2574 A
2994(>=)S
(f_size\))294 3120 A
(break;)252 3456 A
3792(/*)S
3918(we)S
(are)126 4044 A
(beyond)252 4212 A
(EOF)126 4506 A
4674(*/)S
2115 V
(25169)210 1122 A
2448(if)S
(\(chunk)252 2574 A
2868(>)S
(bytes_left\))462 2952 A
(chunk)210 3456 A
3708(=)S
(\(int\))210 3792 A
(bytes_left;)462 4044 A
2205 V
(25170)210 1122 A
2112(})S
2295 V
(25171)210 1122 A
2385 V
(25172)210 1122 A
2112(/*)S
(Read)168 2238 A
2448(or)S
(write)210 2574 A
('chunk')294 2826 A
(bytes.)252 3162 A
3456(*/)S
2475 V
(25173)210 1122 A
2112(r)S
2196(=)S
(rw_chunk\(rip,)546 2280 A
(position,)378 2868 A
(off,)168 3288 A
(chunk,)252 3498 A
(\(unsigned\))420 3792 A
(m_in.nbytes,)504 4254 A
2565 V
(25174)210 1122 A
(rw_flag,)336 2658 A
(m_in.buffer,)504 3036 A
(seg,)168 3582 A
(usr,)168 3792 A
(block_size,)462 4002 A
(&completed\);)504 4506 A
2655 V
(25175)210 1122 A
2745 V
(25176)210 1122 A
2112(if)S
2238(\(r)S
2364(!=)S
(OK\))126 2490 A
(break;)252 2658 A
3120(/*)S
(EOF)126 3246 A
(reached)294 3414 A
3750(*/)S
2835 V
(25177)210 1122 A
2112(if)S
(\(rdwt_err)378 2238 A
2658(<)S
2742(0\))S
(break;)252 2868 A
2925 V
(25178)210 1122 A
3015 V
(25179)210 1122 A
2112(/*)S
(Update)252 2238 A
(counters)336 2532 A
(and)126 2910 A
(pointers.)378 3078 A
3498(*/)S
3105 V
(25180)210 1122 A
(m_in.buffer)462 2112 A
2616(+=)S
(chunk;)252 2742 A
3120(/*)S
(user)168 3246 A
(buffer)252 3456 A
(address)294 3750 A
4086(*/)S
3195 V
(25181)210 1122 A
(m_in.nbytes)462 2112 A
2616(-=)S
(chunk;)252 2742 A
3120(/*)S
(bytes)210 3246 A
(yet)126 3498 A
3666(to)S
3792(be)S
(read)168 3918 A
4128(*/)S
3285 V
(25182)210 1122 A
(cum_io)252 2112 A
2406(+=)S
(chunk;)252 2532 A
3120(/*)S
(bytes)210 3246 A
(read)168 3498 A
3708(so)S
(far)126 3834 A
4002(*/)S
3375 V
(25183)210 1122 A
(position)336 2112 A
2490(+=)S
(chunk;)252 2616 A
3120(/*)S
(position)336 3246 A
(within)252 3624 A
(the)126 3918 A
(file)168 4086 A
4296(*/)S
3465 V
(25184)210 1122 A
3555 V
(25185)210 1122 A
2112(if)S
(\(partial_pipe\))588 2238 A
2868({)S
3645 V
(25186)210 1122 A
(partial_cnt)462 2448 A
2952(-=)S
(chunk;)252 3078 A
3735 V
(25187)210 1122 A
2448(if)S
(\(partial_cnt)504 2574 A
3120(<=)S
3246(0\))S
(break;)252 3414 A
3825 V
(25188)210 1122 A
2112(})S
3915 V
(25189)210 1122 A
1776(})S
4005 V
(25190)210 1122 A
1524(})S
4095 V
(25191)210 1122 A
4185 V
(25192)210 1122 A
1524(/*)S
1650(On)S
(write,)252 1776 A
(update)252 2070 A
(file)168 2364 A
(size)168 2574 A
(and)126 2784 A
(access)252 2952 A
(time.)210 3246 A
3498(*/)S
4275 V
(25193)210 1122 A
1524(if)S
(\(rw_flag)336 1650 A
2028(==)S
(WRITING\))336 2154 A
2532({)S
4365 V
(25194)210 1122 A
1776(if)S
(\(regular)336 1902 A
2280(||)S
(mode_word)378 2406 A
2826(==)S
(I_DIRECTORY\))504 2952 A
3498({)S
4455 V
(25195)210 1122 A
2112(if)S
(\(position)378 2238 A
2658(>)S
(f_size\))294 2742 A
(rip->i_size)462 3078 A
3582(=)S
(position;)378 3666 A
4545 V
(25196)210 1122 A
1776(})S
4635 V
(25197)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
4725 V
(25198)210 1122 A
1776(if)S
(\(rip->i_pipe)504 1902 A
2448(==)S
(I_PIPE\))294 2574 A
2910({)S
4815 V
(25199)210 1122 A
2112(if)S
2238(\()S
(position)336 2322 A
2700(>=)S
(rip->i_size\))504 2826 A
3372({)S
4905 V
(25200)210 1122 A
2448(/*)S
(Reset)210 2574 A
(pipe)168 2826 A
(pointers.)378 3036 A
3456(*/)S
4995 V
(25201)210 1122 A
(rip->i_size)462 2448 A
2952(=)S
3036(0;)S
3456(/*)S
3582(no)S
(data)168 3708 A
(left)168 3918 A
4128(*/)S
5085 V
(25202)210 1122 A
(position)336 2448 A
2826(=)S
2910(0;)S
3456(/*)S
(reset)210 3582 A
(reader\(s\))378 3834 A
4254(*/)S
5175 V
(25203)210 1122 A
2448(wf)S
2574(=)S
(find_filp\(rip,)588 2658 A
(W_BIT\);)294 3288 A
5265 V
(25204)210 1122 A
2448(if)S
(\(wf)126 2574 A
2742(!=)S
(NIL_FILP\))378 2868 A
(wf->filp_pos)504 3288 A
3834(=)S
3918(0;)S
5355 V
(25205)210 1122 A
2112(})S
5445 V
(25206)210 1122 A
1776(})S
5535 V
(25207)210 1122 A
1524(})S
5625 V
(25208)210 1122 A
(f->filp_pos)462 1524 A
2028(=)S
(position;)378 2112 A
5715 V
(25209)210 1122 A
5805 V
(25210)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(to)S
(see)126 2028 A
2196(if)S
(read-ahead)420 2322 A
2784(is)S
(called)252 2910 A
(for,)168 3204 A
(and)126 3414 A
3582(if)S
(so,)126 3708 A
(set)126 3876 A
4044(it)S
(up.)126 4170 A
4338(*/)S
5895 V
(25211)210 1122 A
1524(if)S
(\(rw_flag)336 1650 A
2028(==)S
(READING)294 2154 A
2490(&&)S
(rip->i_seek)462 2616 A
3120(==)S
(NO_SEEK)294 3246 A
3582(&&)S
(position)336 3708 A
4086(%)S
(block_size==)504 4170 A
4716(0)S
5985 V
(25212)210 1122 A
2112(&&)S
(\(regular)336 2238 A
2616(||)S
(mode_word)378 2742 A
3162(==)S
(I_DIRECTORY\)\))546 3288 A
3876({)S
6075 V
(25213)210 1122 A
(rdahed_inode)504 1776 A
2322(=)S
(rip;)168 2406 A
6165 V
(25214)210 1122 A
(rdahedpos)378 1776 A
2196(=)S
(position;)378 2280 A
6255 V
(25215)210 1122 A
1524(})S
6345 V
(25216)210 1122 A
(rip->i_seek)462 1524 A
2028(=)S
(NO_SEEK;)336 2112 A
6435 V
(25217)210 1122 A
6525 V
(25218)210 1122 A
1524(if)S
(\(rdwt_err)378 1650 A
2070(!=)S
(OK\))126 2196 A
2364(r)S
2448(=)S
(rdwt_err;)378 2532 A
3120(/*)S
(check)210 3246 A
(for)126 3498 A
(disk)168 3666 A
(error)210 3876 A
4128(*/)S
6615 V
(25219)210 1122 A
1524(if)S
(\(rdwt_err)378 1650 A
2070(==)S
(END_OF_FILE\))504 2196 A
2742(r)S
2826(=)S
(OK;)126 2910 A
6705 V
(25220)210 1122 A
6795 V
(25221)210 1122 A
1524(/*)S
1650(if)S
(user-space)420 1776 A
(copying)294 2238 A
(failed,)294 2574 A
(read/write)420 2910 A
(failed.)294 3372 A
3708(*/)S
6885 V
(25222)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
1902(OK)S
2028(&&)S
2154(r2)S
2280(!=)S
(OK\))126 2406 A
2574({)S
6975 V
(25223)210 1122 A
1776(r)S
1860(=)S
(r2;)126 1944 A
7065 V
(25224)210 1122 A
1524(})S
8418 V
EP
%%Page: 339 339
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2400(File:)S
2633(servers/fs/read.c)S
12 B
(339)180 4500 A
1755 V
7 LST
(25225)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
2070({)S
1845 V
(25226)210 1122 A
1776(if)S
(\(rw_flag)336 1902 A
2280(==)S
(READING\))336 2406 A
(rip->i_update)546 2784 A
3372(|=)S
(ATIME;)252 3498 A
1935 V
(25227)210 1122 A
1776(if)S
(\(rw_flag)336 1902 A
2280(==)S
(WRITING\))336 2406 A
(rip->i_update)546 2784 A
3372(|=)S
(CTIME)210 3498 A
3750(|)S
(MTIME;)252 3834 A
2025 V
(25228)210 1122 A
(rip->i_dirt)462 1776 A
2280(=)S
(DIRTY;)252 2364 A
3120(/*)S
(inode)210 3246 A
3498(is)S
(thus)168 3624 A
(now)126 3834 A
(dirty)210 4002 A
4254(*/)S
2115 V
(25229)210 1122 A
1776(if)S
(\(partial_pipe\))588 1902 A
2532({)S
2205 V
(25230)210 1122 A
(partial_pipe)504 2112 A
2658(=)S
2742(0;)S
2295 V
(25231)210 1122 A
2448(/*)S
(partial)294 2574 A
(write)210 2910 A
3162(on)S
(pipe)168 3288 A
(with)168 3498 A
3708(*/)S
2385 V
(25232)210 1122 A
2112(/*)S
(O_NONBLOCK,)462 2238 A
(return)252 2742 A
(write)210 3036 A
(count)210 3288 A
3540(*/)S
2475 V
(25233)210 1122 A
2112(if)S
(\(!\(oflags)378 2238 A
2658(&)S
(O_NONBLOCK\)\))504 2742 A
3288({)S
2565 V
(25234)210 1122 A
(fp->fp_cum_io_partial)882 2448 A
3372(=)S
(cum_io;)294 3456 A
2655 V
(25235)210 1122 A
(suspend\(XPIPE\);)630 2448 A
3204(/*)S
(partial)294 3330 A
(write)210 3666 A
3918(on)S
(pipe)168 4044 A
(with)168 4254 A
4464(*/)S
2745 V
(25236)210 1122 A
(return\(SUSPEND\);)672 2448 A
3204(/*)S
(nbyte)210 3330 A
3582(>)S
(PIPE_SIZE)378 3666 A
4086(-)S
(non-atomic)420 4170 A
4632(*/)S
2835 V
(25237)210 1122 A
2112(})S
2925 V
(25238)210 1122 A
1776(})S
3015 V
(25239)210 1122 A
(fp->fp_cum_io_partial)882 1776 A
2700(=)S
2784(0;)S
3105 V
(25240)210 1122 A
(return\(cum_io\);)630 1776 A
3195 V
(25241)210 1122 A
1524(})S
3285 V
(25242)210 1122 A
1524(if)S
(\(bufs_in_use)504 1650 A
2196(<)S
2280(0\))S
2406({)S
3375 V
(25243)210 1122 A
(panic\(__FILE__,"end)798 1776 A
2616(-)S
(bufs_in_use)462 2700 A
(negative",)420 3204 A
(bufs_in_use\);)546 3666 A
3465 V
(25244)210 1122 A
1524(})S
3555 V
(25245)210 1122 A
(return\(r\);)420 1524 A
3645 V
(25246)210 1122 A
1440(})S
3825 V
(25248)210 1122 A
(/*===========================================================================*)3276 1440 A
3915 V
(25249)210 1122 A
1482(*)S
(rw_chunk)336 2784 A
4674(*)S
4005 V
(25250)210 1122 A
(*===========================================================================*/)3276 1482 A
4095 V
(25251)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(rw_chunk\(rip,)546 1944 A
(position,)378 2532 A
(off,)168 2952 A
(chunk,)252 3162 A
(left,)210 3456 A
(rw_flag,)336 3708 A
(buff,)210 4086 A
4185 V
(25252)210 1122 A
(seg,)168 1482 A
(usr,)168 1692 A
(block_size,)462 1902 A
(completed\))420 2406 A
4275 V
(25253)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(inode)210 3372 A
(for)126 3624 A
(file)168 3792 A
4002(to)S
4128(be)S
(rd/wr)210 4254 A
4506(*/)S
4365 V
(25254)210 1122 A
(off_t)210 1440 A
(position;)378 1692 A
2784(/*)S
(position)336 2910 A
(within)252 3288 A
(file)168 3582 A
3792(to)S
(read)168 3918 A
4128(or)S
(write)210 4254 A
4506(*/)S
4455 V
(25255)210 1122 A
(unsigned)336 1440 A
(off;)168 1818 A
2784(/*)S
(off)126 2910 A
(within)252 3078 A
(the)126 3372 A
(current)294 3540 A
(block)210 3876 A
4128(*/)S
4545 V
(25256)210 1122 A
(int)126 1440 A
(chunk;)252 1608 A
2784(/*)S
(number)252 2910 A
3204(of)S
(bytes)210 3330 A
3582(to)S
(read)168 3708 A
3918(or)S
(write)210 4044 A
4296(*/)S
4635 V
(25257)210 1122 A
(unsigned)336 1440 A
(left;)210 1818 A
2784(/*)S
(max)126 2910 A
(number)252 3078 A
3372(of)S
(bytes)210 3498 A
(wanted)252 3750 A
(after)210 4044 A
(position)336 4296 A
4674(*/)S
4725 V
(25258)210 1122 A
(int)126 1440 A
(rw_flag;)336 1608 A
2784(/*)S
(READING)294 2910 A
3246(or)S
(WRITING)294 3372 A
3708(*/)S
4815 V
(25259)210 1122 A
(char)168 1440 A
(*buff;)252 1650 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
3582(of)S
(the)126 3708 A
(user)168 3876 A
(buffer)252 4086 A
4380(*/)S
4905 V
(25260)210 1122 A
(int)126 1440 A
(seg;)168 1608 A
2784(/*)S
2910(T)S
2994(or)S
3120(D)S
(segment)294 3204 A
3540(in)S
(user)168 3666 A
(space)210 3876 A
4128(*/)S
4995 V
(25261)210 1122 A
(int)126 1440 A
(usr;)168 1608 A
2784(/*)S
(which)210 2910 A
(user)168 3162 A
(process)294 3372 A
3708(*/)S
5085 V
(25262)210 1122 A
(int)126 1440 A
(block_size;)462 1608 A
2784(/*)S
(block)210 2910 A
(size)168 3162 A
3372(of)S
3498(FS)S
(operating)378 3624 A
4044(on)S
4170(*/)S
5175 V
(25263)210 1122 A
(int)126 1440 A
(*completed;)462 1608 A
2784(/*)S
(number)252 2910 A
3204(of)S
(bytes)210 3330 A
(copied)252 3582 A
3876(*/)S
5265 V
(25264)210 1122 A
1440({)S
5355 V
(25265)210 1122 A
1440(/*)S
(Read)168 1566 A
1776(or)S
(write)210 1902 A
(\(part)210 2154 A
(of\))126 2406 A
2574(a)S
(block.)252 2658 A
2952(*/)S
5445 V
(25266)210 1122 A
5535 V
(25267)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(buf)126 2196 A
(*bp;)168 2364 A
5625 V
(25268)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(r)S
2154(=)S
(OK;)126 2238 A
5715 V
(25269)210 1122 A
(int)126 1524 A
1692(n,)S
(block_spec;)462 1818 A
5805 V
(25270)210 1122 A
(block_t)294 1524 A
1860(b;)S
5895 V
(25271)210 1122 A
(dev_t)210 1524 A
(dev;)168 1776 A
5985 V
(25272)210 1122 A
6075 V
(25273)210 1122 A
(*completed)420 1524 A
1986(=)S
2070(0;)S
6165 V
(25274)210 1122 A
6255 V
(25275)210 1122 A
(block_spec)420 1524 A
1986(=)S
(\(rip->i_mode)504 2070 A
2616(&)S
(I_TYPE\))294 2700 A
3036(==)S
(I_BLOCK_SPECIAL;)672 3162 A
6345 V
(25276)210 1122 A
1524(if)S
(\(block_spec\))504 1650 A
2196({)S
6435 V
(25277)210 1122 A
1776(b)S
1860(=)S
(position/block_size;)840 1944 A
6525 V
(25278)210 1122 A
(dev)126 1776 A
1944(=)S
(\(dev_t\))294 2028 A
(rip->i_zone[0];)630 2364 A
6615 V
(25279)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
6705 V
(25280)210 1122 A
1776(b)S
1860(=)S
(read_map\(rip,)546 1944 A
(position\);)420 2532 A
6795 V
(25281)210 1122 A
(dev)126 1776 A
1944(=)S
(rip->i_dev;)462 2028 A
6885 V
(25282)210 1122 A
1524(})S
6975 V
(25283)210 1122 A
7065 V
(25284)210 1122 A
1524(if)S
(\(!block_spec)504 1650 A
2196(&&)S
2322(b)S
2406(==)S
(NO_BLOCK\))378 2532 A
2952({)S
8418 V
EP
%%Page: 340 340
BP
/slant 0 def
/height 0 def
1485 V
12 B
(340)180 1080 A
11 R
2400(File:)S
2633(servers/fs/read.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(25285)210 1122 A
1776(if)S
(\(rw_flag)336 1902 A
2280(==)S
(READING\))336 2406 A
2784({)S
1845 V
(25286)210 1122 A
2112(/*)S
(Reading)294 2238 A
(from)168 2574 A
2784(a)S
(nonexistent)462 2868 A
(block.)252 3372 A
(Must)168 3708 A
(read)168 3918 A
4128(as)S
(all)126 4254 A
(zeros.*/)336 4422 A
1935 V
(25287)210 1122 A
2112(bp)S
2238(=)S
(get_block\(NO_DEV,)714 2322 A
(NO_BLOCK,)378 3078 A
(NORMAL\);)336 3498 A
4002(/*)S
(get)126 4128 A
4296(a)S
(buffer)252 4380 A
4674(*/)S
2025 V
(25288)210 1122 A
(zero_block\(bp\);)630 2112 A
2115 V
(25289)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
2205 V
(25290)210 1122 A
2112(/*)S
(Writing)294 2238 A
2574(to)S
2700(a)S
(nonexistent)462 2784 A
(block.)252 3288 A
(Create)252 3582 A
(and)126 3876 A
(enter)210 4044 A
4296(in)S
(inode.*/)336 4422 A
2295 V
(25291)210 1122 A
2112(if)S
(\(\(bp=)210 2238 A
(new_block\(rip,)588 2490 A
(position\)\))420 3120 A
3582(==)S
(NIL_BUF\)return\(err_code\);)1050 3708 A
2385 V
(25292)210 1122 A
1776(})S
2475 V
(25293)210 1122 A
1524(})S
(else)168 1608 A
1818(if)S
(\(rw_flag)336 1944 A
2322(==)S
(READING\))336 2448 A
2826({)S
2565 V
(25294)210 1122 A
1776(/*)S
(Read)168 1902 A
(and)126 2112 A
(read)168 2280 A
(ahead)210 2490 A
2742(if)S
(convenient.)462 2868 A
3372(*/)S
2655 V
(25295)210 1122 A
1776(bp)S
1902(=)S
(rahead\(rip,)462 1986 A
2490(b,)S
(position,)378 2616 A
(left\);)252 3036 A
2745 V
(25296)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
2835 V
(25297)210 1122 A
1776(/*)S
(Normally)336 1902 A
2280(an)S
(existing)336 2406 A
(block)210 2784 A
3036(to)S
3162(be)S
(partially)378 3288 A
(overwritten)462 3708 A
4212(is)S
(first)210 4338 A
(read)168 4590 A
2925 V
(25298)210 1122 A
1818(*)S
(in.)126 1902 A
(However,)336 2112 A
2490(a)S
(full)168 2574 A
(block)210 2784 A
(need)168 3036 A
(not)126 3246 A
3414(be)S
(read)168 3540 A
(in.)126 3750 A
3960(If)S
4086(it)S
4212(is)S
(already)294 4338 A
4674(in)S
3015 V
(25299)210 1122 A
1818(*)S
(the)126 1902 A
(cache,)252 2070 A
(acquire)294 2364 A
(it,)126 2700 A
(otherwise)378 2868 A
(just)168 3288 A
(acquire)294 3498 A
3834(a)S
(free)168 3918 A
(buffer.)294 4128 A
3105 V
(25300)210 1122 A
1818(*/)S
3195 V
(25301)210 1122 A
1776(n)S
1860(=)S
(\(chunk)252 1944 A
2238(==)S
(block_size)420 2364 A
2826(?)S
(NO_READ)294 2910 A
3246(:)S
(NORMAL\);)336 3330 A
3285 V
(25302)210 1122 A
1776(if)S
(\(!block_spec)504 1902 A
2448(&&)S
(off)126 2574 A
2742(==)S
2868(0)S
2952(&&)S
(position)336 3078 A
3456(>=)S
(rip->i_size\))504 3582 A
4128(n)S
4212(=)S
(NO_READ;)336 4296 A
3375 V
(25303)210 1122 A
1776(bp)S
1902(=)S
(get_block\(dev,)588 1986 A
2616(b,)S
(n\);)126 2742 A
3465 V
(25304)210 1122 A
1524(})S
3555 V
(25305)210 1122 A
3645 V
(25306)210 1122 A
1524(/*)S
1650(In)S
(all)126 1776 A
(cases,)252 1944 A
2238(bp)S
(now)126 2364 A
(points)252 2532 A
2826(to)S
2952(a)S
(valid)210 3036 A
(buffer.)294 3288 A
3624(*/)S
3735 V
(25307)210 1122 A
1524(if)S
(\(bp)126 1650 A
1818(==)S
(NIL_BUF\))336 1944 A
2322({)S
3825 V
(25308)210 1122 A
(panic\(__FILE__,"bp)756 1776 A
(not)126 2574 A
(valid)210 2742 A
2994(in)S
(rw_chunk,)378 3120 A
(this)168 3540 A
(can't)210 3750 A
(happen",)336 4002 A
(NO_NUM\);)336 4380 A
3915 V
(25309)210 1122 A
1524(})S
4005 V
(25310)210 1122 A
1524(if)S
(\(rw_flag)336 1650 A
2028(==)S
(WRITING)294 2154 A
2490(&&)S
(chunk)210 2616 A
2868(!=)S
(block_size)420 2994 A
3456(&&)S
(!block_spec)462 3582 A
4086(&&)S
4095 V
(25311)210 1122 A
(position)336 3120 A
3498(>=)S
(rip->i_size)462 3624 A
4128(&&)S
(off)126 4254 A
4422(==)S
4548(0\))S
4674({)S
4185 V
(25312)210 1122 A
(zero_block\(bp\);)630 1776 A
4275 V
(25313)210 1122 A
1524(})S
4365 V
(25314)210 1122 A
4455 V
(25315)210 1122 A
1524(if)S
(\(rw_flag)336 1650 A
2028(==)S
(READING\))336 2154 A
2532({)S
4545 V
(25316)210 1122 A
1776(/*)S
(Copy)168 1902 A
2112(a)S
(chunk)210 2196 A
(from)168 2448 A
(the)126 2658 A
(block)210 2826 A
(buffer)252 3078 A
3372(to)S
(user)168 3498 A
(space.)252 3708 A
4002(*/)S
4635 V
(25317)210 1122 A
1776(r)S
1860(=)S
(sys_vircopy\(FS_PROC_NR,)966 1944 A
2952(D,)S
(\(phys_bytes\))504 3078 A
(\(bp->b_data+off\),)714 3624 A
4725 V
(25318)210 1122 A
(usr,)168 2448 A
(seg,)168 2658 A
(\(phys_bytes\))504 2868 A
(buff,)210 3414 A
4815 V
(25319)210 1122 A
(\(phys_bytes\))504 2448 A
(chunk\);)294 2994 A
4905 V
(25320)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
4995 V
(25321)210 1122 A
1776(/*)S
(Copy)168 1902 A
2112(a)S
(chunk)210 2196 A
(from)168 2448 A
(user)168 2658 A
(space)210 2868 A
3120(to)S
(the)126 3246 A
(block)210 3414 A
(buffer.)294 3666 A
4002(*/)S
5085 V
(25322)210 1122 A
1776(r)S
1860(=)S
(sys_vircopy\(usr,)672 1944 A
(seg,)168 2658 A
(\(phys_bytes\))504 2868 A
(buff,)210 3414 A
5175 V
(25323)210 1122 A
(FS_PROC_NR,)462 2448 A
2952(D,)S
(\(phys_bytes\))504 3078 A
(\(bp->b_data+off\),)714 3624 A
5265 V
(25324)210 1122 A
(\(phys_bytes\))504 2448 A
(chunk\);)294 2994 A
5355 V
(25325)210 1122 A
(bp->b_dirt)420 1776 A
2238(=)S
(DIRTY;)252 2322 A
5445 V
(25326)210 1122 A
1524(})S
5535 V
(25327)210 1122 A
1524(n)S
1608(=)S
(\(off)168 1692 A
1902(+)S
(chunk)210 1986 A
2238(==)S
(block_size)420 2364 A
2826(?)S
(FULL_DATA_BLOCK)630 2910 A
3582(:)S
(PARTIAL_DATA_BLOCK\);)840 3666 A
5625 V
(25328)210 1122 A
(put_block\(bp,)546 1524 A
(n\);)126 2112 A
5715 V
(25329)210 1122 A
5805 V
(25330)210 1122 A
(return\(r\);)420 1524 A
5895 V
(25331)210 1122 A
1440(})S
6165 V
(25334)210 1122 A
(/*===========================================================================*)3276 1440 A
6255 V
(25335)210 1122 A
1482(*)S
(read_map)336 2784 A
4674(*)S
6345 V
(25336)210 1122 A
(*===========================================================================*/)3276 1482 A
6435 V
(25337)210 1122 A
(PUBLIC)252 1440 A
(block_t)294 1734 A
(read_map\(rip,)546 2070 A
(position\))378 2658 A
6525 V
(25338)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(ptr)126 2910 A
3078(to)S
(inode)210 3204 A
3456(to)S
(map)126 3582 A
(from)168 3750 A
3960(*/)S
6615 V
(25339)210 1122 A
(off_t)210 1440 A
(position;)378 1692 A
2784(/*)S
(position)336 2910 A
3288(in)S
(file)168 3414 A
(whose)210 3624 A
(blk)126 3876 A
(wanted)252 4044 A
4338(*/)S
6705 V
(25340)210 1122 A
1440({)S
6795 V
(25341)210 1122 A
1440(/*)S
(Given)210 1566 A
1818(an)S
(inode)210 1944 A
(and)126 2196 A
2364(a)S
(position)336 2448 A
(within)252 2826 A
(the)126 3120 A
(corresponding)546 3288 A
(file,)210 3876 A
(locate)252 4128 A
(the)126 4422 A
6885 V
(25342)210 1122 A
1482(*)S
(block)210 1566 A
(\(not)168 1818 A
(zone\))210 2028 A
(number)252 2280 A
2574(in)S
(which)210 2700 A
(that)168 2952 A
(position)336 3162 A
3540(is)S
3666(to)S
3792(be)S
(found)210 3918 A
(and)126 4170 A
(return)252 4338 A
(it.)126 4632 A
6975 V
(25343)210 1122 A
1482(*/)S
7065 V
(25344)210 1122 A
8418 V
EP
%%Page: 341 341
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2400(File:)S
2633(servers/fs/read.c)S
12 B
(341)180 4500 A
1755 V
7 LST
(25345)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(buf)126 2196 A
(*bp;)168 2364 A
1845 V
(25346)210 1122 A
(register)336 1524 A
(zone_t)252 1902 A
2196(z;)S
1935 V
(25347)210 1122 A
(int)126 1524 A
(scale,)252 1692 A
(boff,)210 1986 A
(dzones,)294 2238 A
(nr_indirects,)546 2574 A
(index,)252 3162 A
(zind,)210 3456 A
(ex;)126 3708 A
2025 V
(25348)210 1122 A
(block_t)294 1524 A
1860(b;)S
2115 V
(25349)210 1122 A
(long)168 1524 A
(excess,)294 1734 A
(zone,)210 2070 A
(block_pos;)420 2322 A
2205 V
(25350)210 1122 A
2295 V
(25351)210 1122 A
(scale)210 1524 A
1776(=)S
(rip->i_sp->s_log_zone_size;)1134 1860 A
3120(/*)S
(for)126 3246 A
(block-zone)420 3414 A
(conversion)420 3876 A
4338(*/)S
2385 V
(25352)210 1122 A
(block_pos)378 1524 A
1944(=)S
(position/rip->i_sp->s_block_size;)1386 2028 A
3456(/*)S
(relative)336 3582 A
(blk)126 3960 A
4128(#)S
4212(in)S
(file)168 4338 A
4548(*/)S
2475 V
(25353)210 1122 A
(zone)168 1524 A
1734(=)S
(block_pos)378 1818 A
2238(>>)S
(scale;)252 2364 A
2784(/*)S
(position's)420 2910 A
(zone)168 3372 A
3582(*/)S
2565 V
(25354)210 1122 A
(boff)168 1524 A
1734(=)S
(\(int\))210 1818 A
(\(block_pos)420 2070 A
2532(-)S
(\(zone)210 2616 A
2868(<<)S
(scale\))252 2994 A
3288(\);)S
3414(/*)S
(relative)336 3540 A
(blk)126 3918 A
4086(#)S
(within)252 4170 A
(zone)168 4464 A
4674(*/)S
2655 V
(25355)210 1122 A
(dzones)252 1524 A
1818(=)S
(rip->i_ndzones;)630 1902 A
2745 V
(25356)210 1122 A
(nr_indirects)504 1524 A
2070(=)S
(rip->i_nindirs;)630 2154 A
2835 V
(25357)210 1122 A
2925 V
(25358)210 1122 A
1524(/*)S
1650(Is)S
('position')420 1776 A
2238(to)S
2364(be)S
(found)210 2490 A
2742(in)S
(the)126 2868 A
(inode)210 3036 A
(itself?)294 3288 A
3624(*/)S
3015 V
(25359)210 1122 A
1524(if)S
(\(zone)210 1650 A
1902(<)S
(dzones\))294 1986 A
2322({)S
3105 V
(25360)210 1122 A
(zind)168 1776 A
1986(=)S
(\(int\))210 2070 A
(zone;)210 2322 A
2784(/*)S
(index)210 2910 A
(should)252 3162 A
3456(be)S
3582(an)S
(int)126 3708 A
3876(*/)S
3195 V
(25361)210 1122 A
1776(z)S
1860(=)S
(rip->i_zone[zind];)756 1944 A
3285 V
(25362)210 1122 A
1776(if)S
1902(\(z)S
2028(==)S
(NO_ZONE\))336 2154 A
(return\(NO_BLOCK\);)714 2532 A
3375 V
(25363)210 1122 A
1776(b)S
1860(=)S
(\(\(block_t\))420 1944 A
2406(z)S
2490(<<)S
(scale\))252 2616 A
2910(+)S
(boff;)210 2994 A
3465 V
(25364)210 1122 A
(return\(b\);)420 1776 A
3555 V
(25365)210 1122 A
1524(})S
3645 V
(25366)210 1122 A
3735 V
(25367)210 1122 A
1524(/*)S
1650(It)S
1776(is)S
(not)126 1902 A
2070(in)S
(the)126 2196 A
(inode,)252 2364 A
2658(so)S
2784(it)S
(must)168 2910 A
3120(be)S
(single)252 3246 A
3540(or)S
(double)252 3666 A
(indirect.)378 3960 A
4380(*/)S
3825 V
(25368)210 1122 A
(excess)252 1524 A
1818(=)S
(zone)168 1902 A
2112(-)S
(dzones;)294 2196 A
2784(/*)S
(first)210 2910 A
(Vx_NR_DZONES)504 3162 A
(don't)210 3708 A
(count)210 3960 A
4212(*/)S
3915 V
(25369)210 1122 A
4005 V
(25370)210 1122 A
1524(if)S
(\(excess)294 1650 A
1986(<)S
(nr_indirects\))546 2070 A
2658({)S
4095 V
(25371)210 1122 A
1776(/*)S
('position')420 1902 A
(can)126 2364 A
2532(be)S
(located)294 2658 A
(via)126 2994 A
(the)126 3162 A
(single)252 3330 A
(indirect)336 3624 A
(block.)252 4002 A
4296(*/)S
4185 V
(25372)210 1122 A
1776(z)S
1860(=)S
(rip->i_zone[dzones];)840 1944 A
4275 V
(25373)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
4365 V
(25374)210 1122 A
1776(/*)S
('position')420 1902 A
(can)126 2364 A
2532(be)S
(located)294 2658 A
(via)126 2994 A
(the)126 3162 A
(double)252 3330 A
(indirect)336 3624 A
(block.)252 4002 A
4296(*/)S
4455 V
(25375)210 1122 A
1776(if)S
1902(\()S
1986(\(z)S
2112(=)S
(rip->i_zone[dzones+1]\))924 2196 A
3162(==)S
(NO_ZONE\))336 3288 A
(return\(NO_BLOCK\);)714 3666 A
4545 V
(25376)210 1122 A
(excess)252 1776 A
2070(-=)S
(nr_indirects;)546 2196 A
3456(/*)S
(single)252 3582 A
(indir)210 3876 A
(doesn't)294 4128 A
(count*/)294 4464 A
4635 V
(25377)210 1122 A
1776(b)S
1860(=)S
(\(block_t\))378 1944 A
2364(z)S
2448(<<)S
(scale;)252 2574 A
4725 V
(25378)210 1122 A
1776(bp)S
1902(=)S
(get_block\(rip->i_dev,)882 1986 A
2910(b,)S
(NORMAL\);)336 3036 A
3456(/*)S
(get)126 3582 A
(double)252 3750 A
(indirect)336 4044 A
(block)210 4422 A
4674(*/)S
4815 V
(25379)210 1122 A
(index)210 1776 A
2028(=)S
(\(int\))210 2112 A
(\(excess/nr_indirects\);)924 2364 A
4905 V
(25380)210 1122 A
1776(z)S
1860(=)S
(rd_indir\(bp,)504 1944 A
(index\);)294 2490 A
3456(/*)S
3582(z=)S
(zone)168 3708 A
(for)126 3918 A
(single*/)336 4086 A
4995 V
(25381)210 1122 A
(put_block\(bp,)546 1776 A
(INDIRECT_BLOCK\);)672 2364 A
3456(/*)S
(release)294 3582 A
(double)252 3918 A
(ind)126 4212 A
(block)210 4380 A
4632(*/)S
5085 V
(25382)210 1122 A
(excess)252 1776 A
2070(=)S
(excess)252 2154 A
2448(%)S
(nr_indirects;)546 2532 A
3456(/*)S
(index)210 3582 A
(into)168 3834 A
(single)252 4044 A
(ind)126 4338 A
(blk)126 4506 A
4674(*/)S
5175 V
(25383)210 1122 A
1524(})S
5265 V
(25384)210 1122 A
5355 V
(25385)210 1122 A
1524(/*)S
('z')126 1650 A
1818(is)S
(zone)168 1944 A
(num)126 2154 A
(for)126 2322 A
(single)252 2490 A
(indirect)336 2784 A
(block;)252 3162 A
('excess')336 3456 A
3834(is)S
(index)210 3960 A
(into)168 4212 A
(it.)126 4422 A
4590(*/)S
5445 V
(25386)210 1122 A
1524(if)S
1650(\(z)S
1776(==)S
(NO_ZONE\))336 1902 A
(return\(NO_BLOCK\);)714 2280 A
5535 V
(25387)210 1122 A
1524(b)S
1608(=)S
(\(block_t\))378 1692 A
2112(z)S
2196(<<)S
(scale;)252 2322 A
3456(/*)S
3582(b)S
3666(is)S
(blk)126 3792 A
3960(#)S
(for)126 4044 A
(single)252 4212 A
(ind)126 4506 A
4674(*/)S
5625 V
(25388)210 1122 A
1524(bp)S
1650(=)S
(get_block\(rip->i_dev,)882 1734 A
2658(b,)S
(NORMAL\);)336 2784 A
3456(/*)S
(get)126 3582 A
(single)252 3750 A
(indirect)336 4044 A
(block)210 4422 A
4674(*/)S
5715 V
(25389)210 1122 A
1524(ex)S
1650(=)S
(\(int\))210 1734 A
(excess;)294 1986 A
3456(/*)S
(need)168 3582 A
3792(an)S
(integer)294 3918 A
4254(*/)S
5805 V
(25390)210 1122 A
1524(z)S
1608(=)S
(rd_indir\(bp,)504 1692 A
(ex\);)168 2238 A
3456(/*)S
(get)126 3582 A
(block)210 3750 A
(pointed)294 4002 A
4338(to)S
4464(*/)S
5895 V
(25391)210 1122 A
(put_block\(bp,)546 1524 A
(INDIRECT_BLOCK\);)672 2112 A
3456(/*)S
(release)294 3582 A
(single)252 3918 A
(indir)210 4212 A
(blk)126 4464 A
4632(*/)S
5985 V
(25392)210 1122 A
1524(if)S
1650(\(z)S
1776(==)S
(NO_ZONE\))336 1902 A
(return\(NO_BLOCK\);)714 2280 A
6075 V
(25393)210 1122 A
1524(b)S
1608(=)S
(\(\(block_t\))420 1692 A
2154(z)S
2238(<<)S
(scale\))252 2364 A
2658(+)S
(boff;)210 2742 A
6165 V
(25394)210 1122 A
(return\(b\);)420 1524 A
6255 V
(25395)210 1122 A
1440(})S
6435 V
(25397)210 1122 A
(/*===========================================================================*)3276 1440 A
6525 V
(25398)210 1122 A
1482(*)S
(rd_indir)336 2784 A
4674(*)S
6615 V
(25399)210 1122 A
(*===========================================================================*/)3276 1482 A
6705 V
(25400)210 1122 A
(PUBLIC)252 1440 A
(zone_t)252 1734 A
(rd_indir\(bp,)504 2028 A
(index\))252 2574 A
6795 V
(25401)210 1122 A
(struct)252 1440 A
(buf)126 1734 A
(*bp;)168 1902 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(indirect)336 3372 A
(block)210 3750 A
4002(*/)S
6885 V
(25402)210 1122 A
(int)126 1440 A
(index;)252 1608 A
2784(/*)S
(index)210 2910 A
(into)168 3162 A
(*bp)126 3372 A
3540(*/)S
6975 V
(25403)210 1122 A
1440({)S
7065 V
(25404)210 1122 A
1440(/*)S
(Given)210 1566 A
1818(a)S
(pointer)294 1902 A
2238(to)S
2364(an)S
(indirect)336 2490 A
(block,)252 2868 A
(read)168 3162 A
(one)126 3372 A
(entry.)252 3540 A
(The)126 3876 A
(reason)252 4044 A
(for)126 4338 A
8418 V
EP
%%Page: 342 342
BP
/slant 0 def
/height 0 def
1485 V
12 B
(342)180 1080 A
11 R
2400(File:)S
2633(servers/fs/read.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(25405)210 1122 A
1482(*)S
(making)252 1566 A
1860(a)S
(separate)336 1944 A
(routine)294 2322 A
(out)126 2658 A
2826(of)S
(this)168 2952 A
3162(is)S
(that)168 3288 A
(there)210 3498 A
(are)126 3750 A
(four)168 3918 A
(cases:)252 4128 A
1845 V
(25406)210 1122 A
1482(*)S
1566(V1)S
(\(IBM)168 1692 A
(and)126 1902 A
(68000\),)294 2070 A
(and)126 2406 A
2574(V2)S
(\(IBM)168 2700 A
(and)126 2910 A
(68000\).)294 3078 A
1935 V
(25407)210 1122 A
1482(*/)S
2025 V
(25408)210 1122 A
2115 V
(25409)210 1122 A
(struct)252 1524 A
(super_block)462 1818 A
(*sp;)168 2322 A
2205 V
(25410)210 1122 A
(zone_t)252 1524 A
(zone;)210 1818 A
2784(/*)S
2910(V2)S
(zones)210 3036 A
(are)126 3288 A
(longs)210 3456 A
(\(shorts)294 3708 A
4044(in)S
(V1\))126 4170 A
4338(*/)S
2295 V
(25411)210 1122 A
2385 V
(25412)210 1122 A
1524(sp)S
1650(=)S
(get_super\(bp->b_dev\);)882 1734 A
2784(/*)S
(need)168 2910 A
(super)210 3120 A
(block)210 3372 A
3624(to)S
(find)168 3750 A
(file)168 3960 A
(sys)126 4170 A
(type)168 4338 A
4548(*/)S
2475 V
(25413)210 1122 A
2565 V
(25414)210 1122 A
1524(/*)S
(read)168 1650 A
1860(a)S
(zone)168 1944 A
(from)168 2154 A
2364(an)S
(indirect)336 2490 A
(block)210 2868 A
3120(*/)S
2655 V
(25415)210 1122 A
1524(if)S
(\(sp->s_version)588 1650 A
2280(==)S
(V1\))126 2406 A
2745 V
(25416)210 1122 A
(zone)168 1776 A
1986(=)S
(\(zone_t\))336 2070 A
(conv2\(sp->s_native,)798 2448 A
(\(int\))210 3288 A
(bp->b_v1_ind[index]\);)882 3582 A
2835 V
(25417)210 1122 A
(else)168 1524 A
2925 V
(25418)210 1122 A
(zone)168 1776 A
1986(=)S
(\(zone_t\))336 2070 A
(conv4\(sp->s_native,)798 2448 A
(\(long\))252 3288 A
(bp->b_v2_ind[index]\);)882 3582 A
3015 V
(25419)210 1122 A
3105 V
(25420)210 1122 A
1524(if)S
(\(zone)210 1650 A
1902(!=)S
(NO_ZONE)294 2028 A
2364(&&)S
3195 V
(25421)210 1122 A
(\(zone)210 2112 A
2364(<)S
(\(zone_t\))336 2448 A
(sp->s_firstdatazone)798 2826 A
3666(||)S
(zone)168 3792 A
4002(>=)S
(sp->s_zones\)\))546 4128 A
4716({)S
3285 V
(25422)210 1122 A
(printf\("Illegal)630 1776 A
(zone)168 2448 A
(number)252 2658 A
(%ld)126 2952 A
3120(in)S
(indirect)336 3246 A
(block,)252 3624 A
(index)210 3918 A
(%d\\n",)252 4170 A
3375 V
(25423)210 1122 A
(\(long\))252 2070 A
(zone,)210 2364 A
(index\);)294 2616 A
3465 V
(25424)210 1122 A
(panic\(__FILE__,"check)882 1776 A
(file)168 2700 A
(system",)336 2910 A
(NO_NUM\);)336 3288 A
3555 V
(25425)210 1122 A
1524(})S
3645 V
(25426)210 1122 A
(return\(zone\);)546 1524 A
3735 V
(25427)210 1122 A
1440(})S
3915 V
(25429)210 1122 A
(/*===========================================================================*)3276 1440 A
4005 V
(25430)210 1122 A
1482(*)S
(read_ahead)420 2784 A
4674(*)S
4095 V
(25431)210 1122 A
(*===========================================================================*/)3276 1482 A
4185 V
(25432)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(read_ahead\(\))504 1944 A
4275 V
(25433)210 1122 A
1440({)S
4365 V
(25434)210 1122 A
1440(/*)S
(Read)168 1566 A
1776(a)S
(block)210 1860 A
(into)168 2112 A
(the)126 2322 A
(cache)210 2490 A
(before)252 2742 A
3036(it)S
3162(is)S
(needed.)294 3288 A
3624(*/)S
4455 V
(25435)210 1122 A
(int)126 1524 A
(block_size;)462 1692 A
4545 V
(25436)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
4635 V
(25437)210 1122 A
(struct)252 1524 A
(buf)126 1818 A
(*bp;)168 1986 A
4725 V
(25438)210 1122 A
(block_t)294 1524 A
1860(b;)S
4815 V
(25439)210 1122 A
4905 V
(25440)210 1122 A
(rip)126 1524 A
1692(=)S
(rdahed_inode;)546 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(inode)210 3372 A
3624(to)S
(read)168 3750 A
(ahead)210 3960 A
(from)168 4212 A
4422(*/)S
4995 V
(25441)210 1122 A
(block_size)420 1524 A
1986(=)S
(get_block_size\(rip->i_dev\);)1134 2070 A
5085 V
(25442)210 1122 A
(rdahed_inode)504 1524 A
2070(=)S
(NIL_INODE;)420 2154 A
2784(/*)S
(turn)168 2910 A
(off)126 3120 A
(read)168 3288 A
(ahead)210 3498 A
3750(*/)S
5175 V
(25443)210 1122 A
1524(if)S
1650(\()S
1734(\(b)S
1860(=)S
(read_map\(rip,)546 1944 A
(rdahedpos\)\))462 2532 A
3036(==)S
(NO_BLOCK\))378 3162 A
(return;)294 3582 A
4128(/*)S
4254(at)S
(EOF)126 4380 A
4548(*/)S
5265 V
(25444)210 1122 A
1524(bp)S
1650(=)S
(rahead\(rip,)462 1734 A
2238(b,)S
(rdahedpos,)420 2364 A
(block_size\);)504 2826 A
5355 V
(25445)210 1122 A
(put_block\(bp,)546 1524 A
(PARTIAL_DATA_BLOCK\);)840 2112 A
5445 V
(25446)210 1122 A
1440(})S
5625 V
(25448)210 1122 A
(/*===========================================================================*)3276 1440 A
5715 V
(25449)210 1122 A
1482(*)S
(rahead)252 2784 A
4674(*)S
5805 V
(25450)210 1122 A
(*===========================================================================*/)3276 1482 A
5895 V
(25451)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(buf)126 2028 A
(*rahead\(rip,)504 2196 A
(baseblock,)420 2742 A
(position,)378 3204 A
(bytes_ahead\))504 3624 A
5985 V
(25452)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(inode)210 3372 A
(for)126 3624 A
(file)168 3792 A
4002(to)S
4128(be)S
(read)168 4254 A
4464(*/)S
6075 V
(25453)210 1122 A
(block_t)294 1440 A
(baseblock;)420 1776 A
2784(/*)S
(block)210 2910 A
3162(at)S
(current)294 3288 A
(position)336 3624 A
4002(*/)S
6165 V
(25454)210 1122 A
(off_t)210 1440 A
(position;)378 1692 A
2784(/*)S
(position)336 2910 A
(within)252 3288 A
(file)168 3582 A
3792(*/)S
6255 V
(25455)210 1122 A
(unsigned)336 1440 A
(bytes_ahead;)504 1818 A
2784(/*)S
(bytes)210 2910 A
(beyond)252 3162 A
(position)336 3456 A
(for)126 3834 A
(immediate)378 4002 A
(use)126 4422 A
4590(*/)S
6345 V
(25456)210 1122 A
1440({)S
6435 V
(25457)210 1122 A
1440(/*)S
(Fetch)210 1566 A
1818(a)S
(block)210 1902 A
(from)168 2154 A
(the)126 2364 A
(cache)210 2532 A
2784(or)S
(the)126 2910 A
(device.)294 3078 A
3456(If)S
3582(a)S
(physical)336 3666 A
(read)168 4044 A
4254(is)S
6525 V
(25458)210 1122 A
1482(*)S
(required,)378 1566 A
(prefetch)336 1986 A
2364(as)S
(many)168 2490 A
(more)168 2700 A
(blocks)252 2910 A
3204(as)S
(convenient)420 3330 A
(into)168 3792 A
(the)126 4002 A
(cache.)252 4170 A
6615 V
(25459)210 1122 A
1482(*)S
(This)168 1566 A
(usually)294 1776 A
(covers)252 2112 A
(bytes_ahead)462 2406 A
(and)126 2910 A
3078(is)S
3204(at)S
(least)210 3330 A
(BLOCKS_MINIMUM.)630 3582 A
6705 V
(25460)210 1122 A
1482(*)S
(The)126 1566 A
(device)252 1734 A
(driver)252 2028 A
(may)126 2322 A
(decide)252 2490 A
2784(it)S
(knows)210 2910 A
(better)252 3162 A
(and)126 3456 A
(stop)168 3624 A
(reading)294 3834 A
4170(at)S
4296(a)S
6795 V
(25461)210 1122 A
1482(*)S
(cylinder)336 1566 A
(boundary)336 1944 A
(\(or)126 2322 A
(after)210 2490 A
2742(an)S
(error\).)294 2868 A
(Rw_scattered\(\))588 3246 A
(puts)168 3876 A
4086(an)S
(optional)336 4212 A
6885 V
(25462)210 1122 A
1482(*)S
(flag)168 1566 A
1776(on)S
(all)126 1902 A
(reads)210 2070 A
2322(to)S
(allow)210 2448 A
(this.)210 2700 A
6975 V
(25463)210 1122 A
1482(*/)S
7065 V
(25464)210 1122 A
(int)126 1524 A
(block_size;)462 1692 A
8418 V
EP
%%Page: 343 343
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2400(File:)S
2633(servers/fs/read.c)S
12 B
(343)180 4500 A
1755 V
7 LST
(25465)210 1122 A
1440(/*)S
(Minimum)294 1566 A
(number)252 1902 A
2196(of)S
(blocks)252 2322 A
2616(to)S
(prefetch.)378 2742 A
3162(*/)S
1845 V
(25466)210 1122 A
1440(#)S
(define)252 1524 A
(BLOCKS_MINIMUM)588 1818 A
(\(NR_BUFS)336 2784 A
3162(<)S
3246(50)S
3372(?)S
3456(18)S
3582(:)S
(32\))126 3666 A
1935 V
(25467)210 1122 A
(int)126 1524 A
(block_spec,)462 1692 A
(scale,)252 2196 A
(read_q_size;)504 2490 A
2025 V
(25468)210 1122 A
(unsigned)336 1524 A
(int)126 1902 A
(blocks_ahead,)546 2070 A
(fragment;)378 2658 A
2115 V
(25469)210 1122 A
(block_t)294 1524 A
(block,)252 1860 A
(blocks_left;)504 2154 A
2205 V
(25470)210 1122 A
(off_t)210 1524 A
(ind1_pos;)378 1776 A
2295 V
(25471)210 1122 A
(dev_t)210 1524 A
(dev;)168 1776 A
2385 V
(25472)210 1122 A
(struct)252 1524 A
(buf)126 1818 A
(*bp;)168 1986 A
2475 V
(25473)210 1122 A
(static)252 1524 A
(struct)252 1818 A
(buf)126 2112 A
(*read_q[NR_BUFS];)714 2280 A
2565 V
(25474)210 1122 A
2655 V
(25475)210 1122 A
(block_spec)420 1524 A
1986(=)S
(\(rip->i_mode)504 2070 A
2616(&)S
(I_TYPE\))294 2700 A
3036(==)S
(I_BLOCK_SPECIAL;)672 3162 A
2745 V
(25476)210 1122 A
1524(if)S
(\(block_spec\))504 1650 A
2196({)S
2835 V
(25477)210 1122 A
(dev)126 1776 A
1944(=)S
(\(dev_t\))294 2028 A
(rip->i_zone[0];)630 2364 A
2925 V
(25478)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3015 V
(25479)210 1122 A
(dev)126 1776 A
1944(=)S
(rip->i_dev;)462 2028 A
3105 V
(25480)210 1122 A
1524(})S
3195 V
(25481)210 1122 A
(block_size)420 1524 A
1986(=)S
(get_block_size\(dev\);)840 2070 A
3285 V
(25482)210 1122 A
3375 V
(25483)210 1122 A
(block)210 1524 A
1776(=)S
(baseblock;)420 1860 A
3465 V
(25484)210 1122 A
1524(bp)S
1650(=)S
(get_block\(dev,)588 1734 A
(block,)252 2364 A
(PREFETCH\);)420 2658 A
3555 V
(25485)210 1122 A
1524(if)S
(\(bp->b_dev)420 1650 A
2112(!=)S
(NO_DEV\))294 2238 A
(return\(bp\);)462 2574 A
3645 V
(25486)210 1122 A
3735 V
(25487)210 1122 A
1524(/*)S
(The)126 1650 A
(best)168 1818 A
(guess)210 2028 A
(for)126 2280 A
(the)126 2448 A
(number)252 2616 A
2910(of)S
(blocks)252 3036 A
3330(to)S
(prefetch:)378 3456 A
3918(A)S
(lot.)168 4002 A
3825 V
(25488)210 1122 A
1566(*)S
1650(It)S
1776(is)S
(impossible)420 1902 A
2364(to)S
(tell)168 2490 A
(what)168 2700 A
(the)126 2910 A
(device)252 3078 A
(looks)210 3372 A
(like,)210 3624 A
3876(so)S
4002(we)S
(don't)210 4128 A
(even)168 4380 A
3915 V
(25489)210 1122 A
1566(*)S
(try)126 1650 A
1818(to)S
(guess)210 1944 A
(the)126 2196 A
(geometry,)378 2364 A
(but)126 2784 A
(leave)210 2952 A
3204(it)S
3330(to)S
(the)126 3456 A
(driver.)294 3624 A
4005 V
(25490)210 1122 A
1566(*)S
4095 V
(25491)210 1122 A
1566(*)S
(The)126 1650 A
(floppy)252 1818 A
(driver)252 2112 A
(can)126 2406 A
(read)168 2574 A
2784(a)S
(full)168 2868 A
(track)210 3078 A
(with)168 3330 A
3540(no)S
(rotational)420 3666 A
(delay,)252 4128 A
(and)126 4422 A
4590(it)S
4185 V
(25492)210 1122 A
1566(*)S
(avoids)252 1650 A
(reading)294 1944 A
(partial)294 2280 A
(tracks)252 2616 A
2910(if)S
3036(it)S
(can,)168 3162 A
3372(so)S
(handing)294 3498 A
3834(it)S
(enough)252 3960 A
(buffers)294 4254 A
4590(to)S
4275 V
(25493)210 1122 A
1566(*)S
(read)168 1650 A
(two)126 1860 A
(tracks)252 2028 A
2322(is)S
(perfect.)336 2448 A
(\(Two,)210 2868 A
(because)294 3120 A
(some)168 3456 A
(diskette)336 3666 A
(types)210 4044 A
(have)168 4296 A
4365 V
(25494)210 1122 A
1566(*)S
1650(an)S
(odd)126 1776 A
(number)252 1944 A
2238(of)S
(sectors)294 2364 A
(per)126 2700 A
(track,)252 2868 A
3162(so)S
3288(a)S
(block)210 3372 A
(may)126 3624 A
(span)168 3792 A
(tracks.\))336 4002 A
4455 V
(25495)210 1122 A
1566(*)S
4545 V
(25496)210 1122 A
1566(*)S
(The)126 1650 A
(disk)168 1818 A
(drivers)294 2028 A
(don't)210 2364 A
(try)126 2616 A
2784(to)S
2910(be)S
(smart.)252 3036 A
(With)168 3372 A
(todays)252 3582 A
(disks)210 3876 A
4128(it)S
4254(is)S
4635 V
(25497)210 1122 A
1566(*)S
(impossible)420 1650 A
2112(to)S
(tell)168 2238 A
(what)168 2448 A
(the)126 2658 A
(real)168 2826 A
(geometry)336 3036 A
(looks)210 3414 A
(like,)210 3666 A
3918(so)S
4044(it)S
4170(is)S
(best)168 4296 A
4506(to)S
4725 V
(25498)210 1122 A
1566(*)S
(read)168 1650 A
1860(as)S
(much)168 1986 A
2196(as)S
(you)126 2322 A
(can.)168 2490 A
(With)168 2742 A
(luck)168 2952 A
(the)126 3162 A
(caching)294 3330 A
3666(on)S
(the)126 3792 A
(drive)210 3960 A
(allows)252 4212 A
4815 V
(25499)210 1122 A
1566(*)S
(for)126 1650 A
1818(a)S
(little)252 1902 A
(time)168 2196 A
2406(to)S
(start)210 2532 A
(the)126 2784 A
(next)168 2952 A
(read.)210 3162 A
4905 V
(25500)210 1122 A
1566(*)S
4995 V
(25501)210 1122 A
1566(*)S
(The)126 1650 A
(current)294 1818 A
(solution)336 2154 A
(below)210 2532 A
2784(is)S
2910(a)S
(bit)126 2994 A
3162(of)S
3288(a)S
(hack,)210 3372 A
3624(it)S
(just)168 3750 A
(reads)210 3960 A
(blocks)252 4212 A
(from)168 4506 A
5085 V
(25502)210 1122 A
1566(*)S
(the)126 1650 A
(current)294 1818 A
(file)168 2154 A
(position)336 2364 A
(hoping)252 2742 A
(that)168 3036 A
(more)168 3246 A
3456(of)S
(the)126 3582 A
(file)168 3750 A
(can)126 3960 A
4128(be)S
(found.)252 4254 A
4590(A)S
5175 V
(25503)210 1122 A
1566(*)S
(better)252 1650 A
(solution)336 1944 A
(must)168 2322 A
(look)168 2532 A
2742(at)S
(the)126 2868 A
(already)294 3036 A
(available)378 3372 A
(zone)168 3792 A
(pointers)336 4002 A
(and)126 4380 A
5265 V
(25504)210 1122 A
1566(*)S
(indirect)336 1650 A
(blocks)252 2028 A
(\(but)168 2322 A
(don't)210 2532 A
(call)168 2784 A
(read_map!\).)462 2994 A
5355 V
(25505)210 1122 A
1566(*/)S
5445 V
(25506)210 1122 A
5535 V
(25507)210 1122 A
(fragment)336 1524 A
1902(=)S
(position)336 1986 A
2364(%)S
(block_size;)462 2448 A
5625 V
(25508)210 1122 A
(position)336 1524 A
1902(-=)S
(fragment;)378 2028 A
5715 V
(25509)210 1122 A
(bytes_ahead)462 1524 A
2028(+=)S
(fragment;)378 2154 A
5805 V
(25510)210 1122 A
5895 V
(25511)210 1122 A
(blocks_ahead)504 1524 A
2070(=)S
(\(bytes_ahead)504 2154 A
2700(+)S
(block_size)420 2784 A
3246(-)S
3330(1\))S
3456(/)S
(block_size;)462 3540 A
5985 V
(25512)210 1122 A
6075 V
(25513)210 1122 A
1524(if)S
(\(block_spec)462 1650 A
2154(&&)S
(rip->i_size)462 2280 A
2784(==)S
2910(0\))S
3036({)S
6165 V
(25514)210 1122 A
(blocks_left)462 1776 A
2280(=)S
(NR_IOREQS;)420 2364 A
6255 V
(25515)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
6345 V
(25516)210 1122 A
(blocks_left)462 1776 A
2280(=)S
(\(rip->i_size)504 2364 A
2910(-)S
(position)336 2994 A
3372(+)S
(block_size)420 3456 A
3918(-)S
4002(1\))S
4128(/)S
(block_size;)462 4212 A
6435 V
(25517)210 1122 A
6525 V
(25518)210 1122 A
1776(/*)S
1902(Go)S
(for)126 2028 A
(the)126 2196 A
(first)210 2364 A
(indirect)336 2616 A
(block)210 2994 A
3246(if)S
3372(we)S
(are)126 3498 A
3666(in)S
(its)126 3792 A
(neighborhood.)546 3960 A
4548(*/)S
6615 V
(25519)210 1122 A
1776(if)S
(\(!block_spec\))546 1902 A
2490({)S
6705 V
(25520)210 1122 A
(scale)210 2112 A
2364(=)S
(rip->i_sp->s_log_zone_size;)1134 2448 A
6795 V
(25521)210 1122 A
(ind1_pos)336 2112 A
2490(=)S
(\(off_t\))294 2574 A
(rip->i_ndzones)588 2910 A
3540(*)S
(\(block_size)462 3624 A
4128(<<)S
(scale\);)294 4254 A
6885 V
(25522)210 1122 A
2112(if)S
(\(position)378 2238 A
2658(<=)S
(ind1_pos)336 2784 A
3162(&&)S
(rip->i_size)462 3288 A
3792(>)S
(ind1_pos\))378 3876 A
4296({)S
6975 V
(25523)210 1122 A
(blocks_ahead++;)630 2448 A
7065 V
(25524)210 1122 A
(blocks_left++;)588 2448 A
8418 V
EP
%%Page: 344 344
BP
/slant 0 def
/height 0 def
1485 V
12 B
(344)180 1080 A
11 R
2400(File:)S
2633(servers/fs/read.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(25525)210 1122 A
2112(})S
1845 V
(25526)210 1122 A
1776(})S
1935 V
(25527)210 1122 A
1524(})S
2025 V
(25528)210 1122 A
2115 V
(25529)210 1122 A
1524(/*)S
1650(No)S
(more)168 1776 A
(than)168 1986 A
(the)126 2196 A
(maximum)294 2364 A
(request.)336 2700 A
3078(*/)S
2205 V
(25530)210 1122 A
1524(if)S
(\(blocks_ahead)546 1650 A
2238(>)S
(NR_IOREQS\))420 2322 A
(blocks_ahead)504 2784 A
3330(=)S
(NR_IOREQS;)420 3414 A
2295 V
(25531)210 1122 A
2385 V
(25532)210 1122 A
1524(/*)S
(Read)168 1650 A
1860(at)S
(least)210 1986 A
(the)126 2238 A
(minimum)294 2406 A
(number)252 2742 A
3036(of)S
(blocks,)294 3162 A
(but)126 3498 A
(not)126 3666 A
(after)210 3834 A
4086(a)S
(seek.)210 4170 A
4422(*/)S
2475 V
(25533)210 1122 A
1524(if)S
(\(blocks_ahead)546 1650 A
2238(<)S
(BLOCKS_MINIMUM)588 2322 A
2952(&&)S
(rip->i_seek)462 3078 A
3582(==)S
(NO_SEEK\))336 3708 A
2565 V
(25534)210 1122 A
(blocks_ahead)504 1776 A
2322(=)S
(BLOCKS_MINIMUM;)630 2406 A
2655 V
(25535)210 1122 A
2745 V
(25536)210 1122 A
1524(/*)S
(Can't)210 1650 A
1902(go)S
(past)168 2028 A
(end)126 2238 A
2406(of)S
(file.)210 2532 A
2784(*/)S
2835 V
(25537)210 1122 A
1524(if)S
(\(blocks_ahead)546 1650 A
2238(>)S
(blocks_left\))504 2322 A
(blocks_ahead)504 2868 A
3414(=)S
(blocks_left;)504 3498 A
2925 V
(25538)210 1122 A
3015 V
(25539)210 1122 A
(read_q_size)462 1524 A
2028(=)S
2112(0;)S
3105 V
(25540)210 1122 A
3195 V
(25541)210 1122 A
1524(/*)S
(Acquire)294 1650 A
(block)210 1986 A
(buffers.)336 2238 A
2616(*/)S
3285 V
(25542)210 1122 A
(for)126 1524 A
(\(;;\))168 1692 A
1902({)S
3375 V
(25543)210 1122 A
(read_q[read_q_size++])882 1776 A
2700(=)S
(bp;)126 2784 A
3465 V
(25544)210 1122 A
3555 V
(25545)210 1122 A
1776(if)S
(\(--blocks_ahead)630 1902 A
2574(==)S
2700(0\))S
(break;)252 2826 A
3645 V
(25546)210 1122 A
3735 V
(25547)210 1122 A
1776(/*)S
(Don't)210 1902 A
(trash)210 2154 A
(the)126 2406 A
(cache,)252 2574 A
(leave)210 2868 A
3120(4)S
(free.)210 3204 A
3456(*/)S
3825 V
(25548)210 1122 A
1776(if)S
(\(bufs_in_use)504 1902 A
2448(>=)S
(NR_BUFS)294 2574 A
2910(-)S
2994(4\))S
(break;)252 3120 A
3915 V
(25549)210 1122 A
4005 V
(25550)210 1122 A
(block++;)336 1776 A
4095 V
(25551)210 1122 A
4185 V
(25552)210 1122 A
1776(bp)S
1902(=)S
(get_block\(dev,)588 1986 A
(block,)252 2616 A
(PREFETCH\);)420 2910 A
4275 V
(25553)210 1122 A
1776(if)S
(\(bp->b_dev)420 1902 A
2364(!=)S
(NO_DEV\))294 2490 A
2826({)S
4365 V
(25554)210 1122 A
2112(/*)S
(Oops,)210 2238 A
(block)210 2490 A
(already)294 2742 A
3078(in)S
(the)126 3204 A
(cache,)252 3372 A
(get)126 3666 A
(out.)168 3834 A
4044(*/)S
4455 V
(25555)210 1122 A
(put_block\(bp,)546 2112 A
(FULL_DATA_BLOCK\);)714 2700 A
4545 V
(25556)210 1122 A
(break;)252 2112 A
4635 V
(25557)210 1122 A
1776(})S
4725 V
(25558)210 1122 A
1524(})S
4815 V
(25559)210 1122 A
(rw_scattered\(dev,)714 1524 A
(read_q,)294 2280 A
(read_q_size,)504 2616 A
(READING\);)378 3162 A
4905 V
(25560)210 1122 A
(return\(get_block\(dev,)882 1524 A
(baseblock,)420 2448 A
(NORMAL\)\);)378 2910 A
4995 V
(25561)210 1122 A
1440(})S
5445 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5535 V
(servers/fs/write.c)756 2676 A
5625 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5805 V
(25600)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
1986(is)S
(the)126 2112 A
(counterpart)462 2280 A
2784(of)S
("read.c".)378 2910 A
3372(It)S
(contains)336 3498 A
(the)126 3876 A
(code)168 4044 A
(for)126 4254 A
(writing)294 4422 A
5895 V
(25601)210 1122 A
1482(*)S
(insofar)294 1566 A
1902(as)S
(this)168 2028 A
2238(is)S
(not)126 2364 A
(contained)378 2532 A
2952(in)S
(read_write\(\).)546 3078 A
5985 V
(25602)210 1122 A
1482(*)S
6075 V
(25603)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are)126 2910 A
6165 V
(25604)210 1122 A
1482(*)S
(do_write:)378 1650 A
(call)168 2238 A
(read_write)420 2448 A
2910(to)S
(perform)294 3036 A
(the)126 3372 A
(WRITE)210 3540 A
(system)252 3792 A
(call)168 4086 A
6255 V
(25605)210 1122 A
1482(*)S
(clear_zone:)462 1650 A
(erase)210 2238 A
2490(a)S
(zone)168 2574 A
2784(in)S
(the)126 2910 A
(middle)252 3078 A
3372(of)S
3498(a)S
(file)168 3582 A
6345 V
(25606)210 1122 A
1482(*)S
(new_block:)420 1650 A
(acquire)294 2238 A
2574(a)S
(new)126 2658 A
(block)210 2826 A
6435 V
(25607)210 1122 A
1482(*/)S
6525 V
(25608)210 1122 A
6615 V
(25609)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
6705 V
(25610)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
6795 V
(25611)210 1122 A
(#include)336 1440 A
("buf.h")294 1818 A
6885 V
(25612)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
6975 V
(25613)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
7065 V
(25614)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
8418 V
EP
%%Page: 345 345
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2381(File:)S
2614(servers/fs/write.c)S
12 B
(345)180 4500 A
1755 V
7 LST
(25615)210 1122 A
(#include)336 1440 A
("super.h")378 1818 A
1845 V
(25616)210 1122 A
1935 V
(25617)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(write_map,)420 2448 A
(\(struct)294 2910 A
(inode)210 3246 A
(*rip,)210 3498 A
(off_t)210 3750 A
(position,)378 4002 A
2025 V
(25618)210 1122 A
(zone_t)252 2448 A
(new_zone\))378 2742 A
4464(\);)S
2115 V
(25619)210 1122 A
2205 V
(25620)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(void)168 2280 A
(wr_indir,)378 2490 A
(\(struct)294 2910 A
(buf)126 3246 A
(*bp,)168 3414 A
(int)126 3624 A
(index,)252 3792 A
(zone_t)252 4086 A
(zone\))210 4380 A
4632(\);)S
2295 V
(25621)210 1122 A
2385 V
(25622)210 1122 A
(/*===========================================================================*)3276 1440 A
2475 V
(25623)210 1122 A
1482(*)S
(do_write)336 2784 A
4674(*)S
2565 V
(25624)210 1122 A
(*===========================================================================*/)3276 1482 A
2655 V
(25625)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_write\(\))420 1902 A
2745 V
(25626)210 1122 A
1440({)S
2835 V
(25627)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(write\(fd,)378 2070 A
(buffer,)294 2490 A
(nbytes\))294 2826 A
(system)252 3162 A
(call.)210 3456 A
3708(*/)S
2925 V
(25628)210 1122 A
3015 V
(25629)210 1122 A
(return\(read_write\(WRITING\)\);)1176 1524 A
3105 V
(25630)210 1122 A
1440(})S
3285 V
(25632)210 1122 A
(/*===========================================================================*)3276 1440 A
3375 V
(25633)210 1122 A
1482(*)S
(write_map)378 2784 A
4674(*)S
3465 V
(25634)210 1122 A
(*===========================================================================*/)3276 1482 A
3555 V
(25635)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(write_map\(rip,)588 1944 A
(position,)378 2574 A
(new_zone\))378 2994 A
3645 V
(25636)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(inode)210 3372 A
3624(to)S
3750(be)S
(changed)294 3876 A
4212(*/)S
3735 V
(25637)210 1122 A
(off_t)210 1440 A
(position;)378 1692 A
2784(/*)S
(file)168 2910 A
(address)294 3120 A
3456(to)S
3582(be)S
(mapped)252 3708 A
4002(*/)S
3825 V
(25638)210 1122 A
(zone_t)252 1440 A
(new_zone;)378 1734 A
2784(/*)S
(zone)168 2910 A
3120(#)S
3204(to)S
3330(be)S
(inserted)336 3456 A
3834(*/)S
3915 V
(25639)210 1122 A
1440({)S
4005 V
(25640)210 1122 A
1440(/*)S
(Write)210 1566 A
1818(a)S
(new)126 1902 A
(zone)168 2070 A
(into)168 2280 A
2490(an)S
(inode.)252 2616 A
2910(*/)S
4095 V
(25641)210 1122 A
(int)126 1524 A
(scale,)252 1692 A
(ind_ex,)294 1986 A
(new_ind,)336 2322 A
(new_dbl,)336 2700 A
(zones,)252 3078 A
(nr_indirects,)546 3372 A
(single,)294 3960 A
(zindex,)294 4296 A
(ex;)126 4632 A
4185 V
(25642)210 1122 A
(zone_t)252 1524 A
1818(z,)S
(z1;)126 1944 A
4275 V
(25643)210 1122 A
(register)336 1524 A
(block_t)294 1902 A
2238(b;)S
4365 V
(25644)210 1122 A
(long)168 1524 A
(excess,)294 1734 A
(zone;)210 2070 A
4455 V
(25645)210 1122 A
(struct)252 1524 A
(buf)126 1818 A
(*bp;)168 1986 A
4545 V
(25646)210 1122 A
4635 V
(25647)210 1122 A
(rip->i_dirt)462 1524 A
2028(=)S
(DIRTY;)252 2112 A
2784(/*)S
(inode)210 2910 A
(will)168 3162 A
3372(be)S
(changed)294 3498 A
3834(*/)S
4725 V
(25648)210 1122 A
1524(bp)S
1650(=)S
(NIL_BUF;)336 1734 A
4815 V
(25649)210 1122 A
(scale)210 1524 A
1776(=)S
(rip->i_sp->s_log_zone_size;)1134 1860 A
3456(/*)S
(for)126 3582 A
(zone-block)420 3750 A
(conversion)420 4212 A
4674(*/)S
4905 V
(25650)210 1122 A
1776(/*)S
(relative)336 1902 A
(zone)168 2280 A
2490(#)S
2574(to)S
(insert)252 2700 A
2994(*/)S
4995 V
(25651)210 1122 A
(zone)168 1524 A
1734(=)S
(\(position/rip->i_sp->s_block_size\))1428 1818 A
3288(>>)S
(scale;)252 3414 A
5085 V
(25652)210 1122 A
(zones)210 1524 A
1776(=)S
(rip->i_ndzones;)630 1860 A
2784(/*)S
2910(#)S
(direct)252 2994 A
(zones)210 3288 A
3540(in)S
(the)126 3666 A
(inode)210 3834 A
4086(*/)S
5175 V
(25653)210 1122 A
(nr_indirects)504 1524 A
2070(=)S
(rip->i_nindirs;/*)714 2154 A
2910(#)S
(indirect)336 2994 A
(zones)210 3372 A
(per)126 3624 A
(indirect)336 3792 A
(block)210 4170 A
4422(*/)S
5265 V
(25654)210 1122 A
5355 V
(25655)210 1122 A
1524(/*)S
1650(Is)S
('position')420 1776 A
2238(to)S
2364(be)S
(found)210 2490 A
2742(in)S
(the)126 2868 A
(inode)210 3036 A
(itself?)294 3288 A
3624(*/)S
5445 V
(25656)210 1122 A
1524(if)S
(\(zone)210 1650 A
1902(<)S
(zones\))252 1986 A
2280({)S
5535 V
(25657)210 1122 A
(zindex)252 1776 A
2070(=)S
(\(int\))210 2154 A
(zone;)210 2406 A
2784(/*)S
2910(we)S
(need)168 3036 A
3246(an)S
(integer)294 3372 A
(here)168 3708 A
3918(*/)S
5625 V
(25658)210 1122 A
(rip->i_zone[zindex])798 1776 A
2616(=)S
(new_zone;)378 2700 A
5715 V
(25659)210 1122 A
(return\(OK\);)462 1776 A
5805 V
(25660)210 1122 A
1524(})S
5895 V
(25661)210 1122 A
5985 V
(25662)210 1122 A
1524(/*)S
1650(It)S
1776(is)S
(not)126 1902 A
2070(in)S
(the)126 2196 A
(inode,)252 2364 A
2658(so)S
2784(it)S
(must)168 2910 A
3120(be)S
(single)252 3246 A
3540(or)S
(double)252 3666 A
(indirect.)378 3960 A
4380(*/)S
6075 V
(25663)210 1122 A
(excess)252 1524 A
1818(=)S
(zone)168 1902 A
2112(-)S
(zones;)252 2196 A
2784(/*)S
(first)210 2910 A
(Vx_NR_DZONES)504 3162 A
(don't)210 3708 A
(count)210 3960 A
4212(*/)S
6165 V
(25664)210 1122 A
(new_ind)294 1524 A
1860(=)S
(FALSE;)252 1944 A
6255 V
(25665)210 1122 A
(new_dbl)294 1524 A
1860(=)S
(FALSE;)252 1944 A
6345 V
(25666)210 1122 A
6435 V
(25667)210 1122 A
1524(if)S
(\(excess)294 1650 A
1986(<)S
(nr_indirects\))546 2070 A
2658({)S
6525 V
(25668)210 1122 A
1776(/*)S
('position')420 1902 A
(can)126 2364 A
2532(be)S
(located)294 2658 A
(via)126 2994 A
(the)126 3162 A
(single)252 3330 A
(indirect)336 3624 A
(block.)252 4002 A
4296(*/)S
6615 V
(25669)210 1122 A
1776(z1)S
1902(=)S
(rip->i_zone[zones];)798 1986 A
3120(/*)S
(single)252 3246 A
(indirect)336 3540 A
(zone)168 3918 A
4128(*/)S
6705 V
(25670)210 1122 A
(single)252 1776 A
2070(=)S
(TRUE;)210 2154 A
6795 V
(25671)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
6885 V
(25672)210 1122 A
1776(/*)S
('position')420 1902 A
(can)126 2364 A
2532(be)S
(located)294 2658 A
(via)126 2994 A
(the)126 3162 A
(double)252 3330 A
(indirect)336 3624 A
(block.)252 4002 A
4296(*/)S
6975 V
(25673)210 1122 A
1776(if)S
1902(\()S
1986(\(z)S
2112(=)S
(rip->i_zone[zones+1]\))882 2196 A
3120(==)S
(NO_ZONE\))336 3246 A
3624({)S
7065 V
(25674)210 1122 A
2112(/*)S
(Create)252 2238 A
(the)126 2532 A
(double)252 2700 A
(indirect)336 2994 A
(block.)252 3372 A
3666(*/)S
8418 V
EP
%%Page: 346 346
BP
/slant 0 def
/height 0 def
1485 V
12 B
(346)180 1080 A
11 R
2381(File:)S
2614(servers/fs/write.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(25675)210 1122 A
2112(if)S
2238(\()S
2322(\(z)S
2448(=)S
(alloc_zone\(rip->i_dev,)924 2532 A
(rip->i_zone[0]\)\))672 3498 A
4212(==)S
(NO_ZONE\))336 4338 A
1845 V
(25676)210 1122 A
(return\(err_code\);)714 2448 A
1935 V
(25677)210 1122 A
(rip->i_zone[zones+1])840 2112 A
2994(=)S
3078(z;)S
2025 V
(25678)210 1122 A
(new_dbl)294 2112 A
2448(=)S
(TRUE;)210 2532 A
2784(/*)S
(set)126 2910 A
(flag)168 3078 A
(for)126 3288 A
(later)210 3456 A
3708(*/)S
2115 V
(25679)210 1122 A
1776(})S
2205 V
(25680)210 1122 A
2295 V
(25681)210 1122 A
1776(/*)S
(Either)252 1902 A
(way,)168 2196 A
('z')126 2406 A
2574(is)S
(zone)168 2700 A
(number)252 2910 A
(for)126 3204 A
(double)252 3372 A
(indirect)336 3666 A
(block.)252 4044 A
4338(*/)S
2385 V
(25682)210 1122 A
(excess)252 1776 A
2070(-=)S
(nr_indirects;)546 2196 A
2784(/*)S
(single)252 2910 A
(indirect)336 3204 A
(doesn't)294 3582 A
(count)210 3918 A
4170(*/)S
2475 V
(25683)210 1122 A
(ind_ex)252 1776 A
2070(=)S
(\(int\))210 2154 A
(\(excess)294 2406 A
2742(/)S
(nr_indirects\);)588 2826 A
2565 V
(25684)210 1122 A
(excess)252 1776 A
2070(=)S
(excess)252 2154 A
2448(%)S
(nr_indirects;)546 2532 A
2655 V
(25685)210 1122 A
1776(if)S
(\(ind_ex)294 1902 A
2238(>=)S
(nr_indirects\))546 2364 A
(return\(EFBIG\);)588 2952 A
2745 V
(25686)210 1122 A
1776(b)S
1860(=)S
(\(block_t\))378 1944 A
2364(z)S
2448(<<)S
(scale;)252 2574 A
2835 V
(25687)210 1122 A
1776(bp)S
1902(=)S
(get_block\(rip->i_dev,)882 1986 A
2910(b,)S
(\(new_dbl)336 3036 A
3414(?)S
(NO_READ)294 3498 A
3834(:)S
(NORMAL\)\);)378 3918 A
2925 V
(25688)210 1122 A
1776(if)S
(\(new_dbl\))378 1902 A
(zero_block\(bp\);)630 2322 A
3015 V
(25689)210 1122 A
1776(z1)S
1902(=)S
(rd_indir\(bp,)504 1986 A
(ind_ex\);)336 2532 A
3105 V
(25690)210 1122 A
(single)252 1776 A
2070(=)S
(FALSE;)252 2154 A
3195 V
(25691)210 1122 A
1524(})S
3285 V
(25692)210 1122 A
3375 V
(25693)210 1122 A
1524(/*)S
1650(z1)S
1776(is)S
(now)126 1902 A
(single)252 2070 A
(indirect)336 2364 A
(zone;)210 2742 A
('excess')336 2994 A
3372(is)S
(index.)252 3498 A
3792(*/)S
3465 V
(25694)210 1122 A
1524(if)S
(\(z1)126 1650 A
1818(==)S
(NO_ZONE\))336 1944 A
2322({)S
3555 V
(25695)210 1122 A
1776(/*)S
(Create)252 1902 A
(indirect)336 2196 A
(block)210 2574 A
(and)126 2826 A
(store)210 2994 A
(zone)168 3246 A
3456(#)S
3540(in)S
(inode)210 3666 A
3918(or)S
(dbl)126 4044 A
(indir)210 4212 A
(blk.)168 4464 A
4674(*/)S
3645 V
(25696)210 1122 A
1776(z1)S
1902(=)S
(alloc_zone\(rip->i_dev,)924 1986 A
(rip->i_zone[0]\);)672 2952 A
3735 V
(25697)210 1122 A
1776(if)S
(\(single\))336 1902 A
3825 V
(25698)210 1122 A
(rip->i_zone[zones])756 2112 A
2910(=)S
(z1;)126 2994 A
3456(/*)S
(update)252 3582 A
(inode)210 3876 A
4128(*/)S
3915 V
(25699)210 1122 A
(else)168 1776 A
4005 V
(25700)210 1122 A
(wr_indir\(bp,)504 2112 A
(ind_ex,)294 2658 A
(z1\);)168 2994 A
3456(/*)S
(update)252 3582 A
(dbl)126 3876 A
(indir)210 4044 A
4296(*/)S
4095 V
(25701)210 1122 A
4185 V
(25702)210 1122 A
(new_ind)294 1776 A
2112(=)S
(TRUE;)210 2196 A
4275 V
(25703)210 1122 A
1776(if)S
(\(bp)126 1902 A
2070(!=)S
(NIL_BUF\))336 2196 A
(bp->b_dirt)420 2574 A
3036(=)S
(DIRTY;)252 3120 A
3456(/*)S
3582(if)S
(double)252 3708 A
(ind,)168 4002 A
4212(it)S
4338(is)S
(dirty*/)294 4464 A
4365 V
(25704)210 1122 A
1776(if)S
(\(z1)126 1902 A
2070(==)S
(NO_ZONE\))336 2196 A
2574({)S
4455 V
(25705)210 1122 A
(put_block\(bp,)546 2112 A
(INDIRECT_BLOCK\);)672 2700 A
3456(/*)S
(release)294 3582 A
(dbl)126 3918 A
(indirect)336 4086 A
(blk)126 4464 A
4632(*/)S
4545 V
(25706)210 1122 A
(return\(err_code\);)714 2112 A
3120(/*)S
(couldn't)336 3246 A
(create)252 3624 A
(single)252 3918 A
(ind)126 4212 A
4380(*/)S
4635 V
(25707)210 1122 A
1776(})S
4725 V
(25708)210 1122 A
1524(})S
4815 V
(25709)210 1122 A
(put_block\(bp,)546 1524 A
(INDIRECT_BLOCK\);)672 2112 A
3120(/*)S
(release)294 3246 A
(double)252 3582 A
(indirect)336 3876 A
(blk)126 4254 A
4422(*/)S
4905 V
(25710)210 1122 A
4995 V
(25711)210 1122 A
1524(/*)S
1650(z1)S
1776(is)S
(indirect)336 1902 A
(block's)294 2280 A
(zone)168 2616 A
(number.)294 2826 A
3162(*/)S
5085 V
(25712)210 1122 A
1524(b)S
1608(=)S
(\(block_t\))378 1692 A
2112(z1)S
2238(<<)S
(scale;)252 2364 A
5175 V
(25713)210 1122 A
1524(bp)S
1650(=)S
(get_block\(rip->i_dev,)882 1734 A
2658(b,)S
(\(new_ind)336 2784 A
3162(?)S
(NO_READ)294 3246 A
3582(:)S
(NORMAL\))294 3666 A
4002(\);)S
5265 V
(25714)210 1122 A
1524(if)S
(\(new_ind\))378 1650 A
(zero_block\(bp\);)630 2070 A
5355 V
(25715)210 1122 A
1524(ex)S
1650(=)S
(\(int\))210 1734 A
(excess;)294 1986 A
3120(/*)S
3246(we)S
(need)168 3372 A
3582(an)S
(int)126 3708 A
(here)168 3876 A
4086(*/)S
5445 V
(25716)210 1122 A
(wr_indir\(bp,)504 1524 A
(ex,)126 2070 A
(new_zone\);)420 2238 A
5535 V
(25717)210 1122 A
(bp->b_dirt)420 1524 A
1986(=)S
(DIRTY;)252 2070 A
5625 V
(25718)210 1122 A
(put_block\(bp,)546 1524 A
(INDIRECT_BLOCK\);)672 2112 A
5715 V
(25719)210 1122 A
5805 V
(25720)210 1122 A
(return\(OK\);)462 1524 A
5895 V
(25721)210 1122 A
1440(})S
6075 V
(25723)210 1122 A
(/*===========================================================================*)3276 1440 A
6165 V
(25724)210 1122 A
1482(*)S
(wr_indir)336 2784 A
4674(*)S
6255 V
(25725)210 1122 A
(*===========================================================================*/)3276 1482 A
6345 V
(25726)210 1122 A
(PRIVATE)294 1440 A
(void)168 1776 A
(wr_indir\(bp,)504 1986 A
(index,)252 2532 A
(zone\))210 2826 A
6435 V
(25727)210 1122 A
(struct)252 1440 A
(buf)126 1734 A
(*bp;)168 1902 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(indirect)336 3372 A
(block)210 3750 A
4002(*/)S
6525 V
(25728)210 1122 A
(int)126 1440 A
(index;)252 1608 A
2784(/*)S
(index)210 2910 A
(into)168 3162 A
(*bp)126 3372 A
3540(*/)S
6615 V
(25729)210 1122 A
(zone_t)252 1440 A
(zone;)210 1734 A
2784(/*)S
(zone)168 2910 A
3120(to)S
(write)210 3246 A
3498(*/)S
6705 V
(25730)210 1122 A
1440({)S
6795 V
(25731)210 1122 A
1440(/*)S
(Given)210 1566 A
1818(a)S
(pointer)294 1902 A
2238(to)S
2364(an)S
(indirect)336 2490 A
(block,)252 2868 A
(write)210 3162 A
(one)126 3414 A
(entry.)252 3582 A
3876(*/)S
6885 V
(25732)210 1122 A
6975 V
(25733)210 1122 A
(struct)252 1524 A
(super_block)462 1818 A
(*sp;)168 2322 A
7065 V
(25734)210 1122 A
8418 V
EP
%%Page: 347 347
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2381(File:)S
2614(servers/fs/write.c)S
12 B
(347)180 4500 A
1755 V
7 LST
(25735)210 1122 A
1524(sp)S
1650(=)S
(get_super\(bp->b_dev\);)882 1734 A
2784(/*)S
(need)168 2910 A
(super)210 3120 A
(block)210 3372 A
3624(to)S
(find)168 3750 A
(file)168 3960 A
(sys)126 4170 A
(type)168 4338 A
4548(*/)S
1845 V
(25736)210 1122 A
1935 V
(25737)210 1122 A
1524(/*)S
(write)210 1650 A
1902(a)S
(zone)168 1986 A
(into)168 2196 A
2406(an)S
(indirect)336 2532 A
(block)210 2910 A
3162(*/)S
2025 V
(25738)210 1122 A
1524(if)S
(\(sp->s_version)588 1650 A
2280(==)S
(V1\))126 2406 A
2115 V
(25739)210 1122 A
(bp->b_v1_ind[index])798 1776 A
2616(=)S
(\(zone1_t\))378 2700 A
(conv2\(sp->s_native,)798 3120 A
(\(int\))210 3960 A
(zone\);)252 4254 A
2205 V
(25740)210 1122 A
(else)168 1524 A
2295 V
(25741)210 1122 A
(bp->b_v2_ind[index])798 1776 A
2616(=)S
(\(zone_t\))336 2700 A
(conv4\(sp->s_native,)798 3120 A
(\(long\))252 3960 A
(zone\);)252 4254 A
2385 V
(25742)210 1122 A
1440(})S
2565 V
(25744)210 1122 A
(/*===========================================================================*)3276 1440 A
2655 V
(25745)210 1122 A
1482(*)S
(clear_zone)420 2784 A
4674(*)S
2745 V
(25746)210 1122 A
(*===========================================================================*/)3276 1482 A
2835 V
(25747)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(clear_zone\(rip,)630 1944 A
(pos,)168 2616 A
(flag\))210 2826 A
2925 V
(25748)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(inode)210 2910 A
3162(to)S
(clear)210 3288 A
3540(*/)S
3015 V
(25749)210 1122 A
(off_t)210 1440 A
(pos;)168 1692 A
2784(/*)S
(points)252 2910 A
3204(to)S
(block)210 3330 A
3582(to)S
(clear)210 3708 A
3960(*/)S
3105 V
(25750)210 1122 A
(int)126 1440 A
(flag;)210 1608 A
2784(/*)S
2910(0)S
2994(if)S
(called)252 3120 A
3414(by)S
(read_write,)462 3540 A
4044(1)S
4128(by)S
(new_block)378 4254 A
4674(*/)S
3195 V
(25751)210 1122 A
1440({)S
3285 V
(25752)210 1122 A
1440(/*)S
(Zero)168 1566 A
1776(a)S
(zone,)210 1860 A
(possibly)336 2112 A
(starting)336 2490 A
2868(in)S
(the)126 2994 A
(middle.)294 3162 A
(The)126 3540 A
(parameter)378 3708 A
('pos')210 4128 A
(gives)210 4380 A
3375 V
(25753)210 1122 A
1482(*)S
1566(a)S
(byte)168 1650 A
1860(in)S
(the)126 1986 A
(first)210 2154 A
(block)210 2406 A
2658(to)S
2784(be)S
(zeroed.)294 2910 A
(Clearzone\(\))462 3288 A
3792(is)S
(called)252 3918 A
(from)168 4212 A
3465 V
(25754)210 1122 A
1482(*)S
(read_write)420 1566 A
(and)126 2028 A
(new_block\(\).)504 2196 A
3555 V
(25755)210 1122 A
1482(*/)S
3645 V
(25756)210 1122 A
3735 V
(25757)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(buf)126 2196 A
(*bp;)168 2364 A
3825 V
(25758)210 1122 A
(register)336 1524 A
(block_t)294 1902 A
2238(b,)S
(blo,)168 2364 A
(bhi;)168 2574 A
3915 V
(25759)210 1122 A
(register)336 1524 A
(off_t)210 1902 A
(next;)210 2154 A
4005 V
(25760)210 1122 A
(register)336 1524 A
(int)126 1902 A
(scale;)252 2070 A
4095 V
(25761)210 1122 A
(register)336 1524 A
(zone_t)252 1902 A
(zone_size;)420 2196 A
4185 V
(25762)210 1122 A
4275 V
(25763)210 1122 A
1524(/*)S
1650(If)S
(the)126 1776 A
(block)210 1944 A
(size)168 2196 A
(and)126 2406 A
(zone)168 2574 A
(size)168 2784 A
(are)126 2994 A
(the)126 3162 A
(same,)210 3330 A
(clear_zone\(\))504 3582 A
(not)126 4128 A
(needed.)294 4296 A
4632(*/)S
4365 V
(25764)210 1122 A
(scale)210 1524 A
1776(=)S
(rip->i_sp->s_log_zone_size;)1134 1860 A
4455 V
(25765)210 1122 A
1524(if)S
(\(scale)252 1650 A
1944(==)S
2070(0\))S
(return;)294 2196 A
4545 V
(25766)210 1122 A
4635 V
(25767)210 1122 A
(zone_size)378 1524 A
1944(=)S
(\(zone_t\))336 2028 A
(rip->i_sp->s_block_size)966 2406 A
3414(<<)S
(scale;)252 3540 A
4725 V
(25768)210 1122 A
1524(if)S
(\(flag)210 1650 A
1902(==)S
2028(1\))S
(pos)126 2154 A
2322(=)S
(\(pos/zone_size\))630 2406 A
3078(*)S
(zone_size;)420 3162 A
4815 V
(25769)210 1122 A
(next)168 1524 A
1734(=)S
(pos)126 1818 A
1986(+)S
(rip->i_sp->s_block_size)966 2070 A
3078(-)S
3162(1;)S
4905 V
(25770)210 1122 A
4995 V
(25771)210 1122 A
1524(/*)S
1650(If)S
('pos')210 1776 A
2028(is)S
2154(in)S
(the)126 2280 A
(last)168 2448 A
(block)210 2658 A
2910(of)S
3036(a)S
(zone,)210 3120 A
3372(do)S
(not)126 3498 A
(clear)210 3666 A
(the)126 3918 A
(zone.)210 4086 A
4338(*/)S
5085 V
(25772)210 1122 A
1524(if)S
(\(next/zone_size)630 1650 A
2322(!=)S
(pos/zone_size\))588 2448 A
(return;)294 3078 A
5175 V
(25773)210 1122 A
1524(if)S
1650(\()S
(\(blo)168 1734 A
1944(=)S
(read_map\(rip,)546 2028 A
(next\)\))252 2616 A
2910(==)S
(NO_BLOCK\))378 3036 A
(return;)294 3456 A
5265 V
(25774)210 1122 A
(bhi)126 1524 A
1692(=)S
1776(\()S
(\(\(blo>>scale\)+1\))672 1902 A
2616(<<)S
(scale\))252 2742 A
3120(-)S
3204(1;)S
5355 V
(25775)210 1122 A
5445 V
(25776)210 1122 A
1524(/*)S
(Clear)210 1650 A
(all)126 1902 A
(the)126 2070 A
(blocks)252 2238 A
(between)294 2532 A
('blo')210 2868 A
(and)126 3120 A
('bhi'.)252 3288 A
3582(*/)S
5535 V
(25777)210 1122 A
(for)126 1524 A
1692(\(b)S
1818(=)S
(blo;)168 1902 A
2112(b)S
2196(<=)S
(bhi;)168 2322 A
(b++\))168 2532 A
2742({)S
5625 V
(25778)210 1122 A
1776(bp)S
1902(=)S
(get_block\(rip->i_dev,)882 1986 A
2910(b,)S
(NO_READ\);)378 3036 A
5715 V
(25779)210 1122 A
(zero_block\(bp\);)630 1776 A
5805 V
(25780)210 1122 A
(put_block\(bp,)546 1776 A
(FULL_DATA_BLOCK\);)714 2364 A
5895 V
(25781)210 1122 A
1524(})S
5985 V
(25782)210 1122 A
1440(})S
6165 V
(25784)210 1122 A
(/*===========================================================================*)3276 1440 A
6255 V
(25785)210 1122 A
1482(*)S
(new_block)378 2784 A
4674(*)S
6345 V
(25786)210 1122 A
(*===========================================================================*/)3276 1482 A
6435 V
(25787)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(buf)126 2028 A
(*new_block\(rip,)630 2196 A
(position\))378 2868 A
6525 V
(25788)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(inode)210 3372 A
3624(*/)S
6615 V
(25789)210 1122 A
(off_t)210 1440 A
(position;)378 1692 A
2784(/*)S
(file)168 2910 A
(pointer)294 3120 A
3456(*/)S
6705 V
(25790)210 1122 A
1440({)S
6795 V
(25791)210 1122 A
1440(/*)S
(Acquire)294 1566 A
1902(a)S
(new)126 1986 A
(block)210 2154 A
(and)126 2406 A
(return)252 2574 A
2868(a)S
(pointer)294 2952 A
3288(to)S
(it.)126 3414 A
(Doing)210 3624 A
3876(so)S
(may)126 4002 A
(require)294 4170 A
6885 V
(25792)210 1122 A
1482(*)S
(allocating)420 1566 A
2028(a)S
(complete)336 2112 A
(zone,)210 2490 A
(and)126 2742 A
(then)168 2910 A
(returning)378 3120 A
(the)126 3540 A
(initial)294 3708 A
(block.)252 4044 A
6975 V
(25793)210 1122 A
1482(*)S
1566(On)S
(the)126 1692 A
(other)210 1860 A
(hand,)210 2112 A
(the)126 2364 A
(current)294 2532 A
(zone)168 2868 A
(may)126 3078 A
(still)210 3246 A
(have)168 3498 A
(some)168 3708 A
(unused)252 3918 A
(blocks.)294 4212 A
7065 V
(25794)210 1122 A
1482(*/)S
8418 V
EP
%%Page: 348 348
BP
/slant 0 def
/height 0 def
1485 V
12 B
(348)180 1080 A
11 R
2381(File:)S
2614(servers/fs/write.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(25795)210 1122 A
1845 V
(25796)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(buf)126 2196 A
(*bp;)168 2364 A
1935 V
(25797)210 1122 A
(block_t)294 1524 A
1860(b,)S
(base_block;)462 1986 A
2025 V
(25798)210 1122 A
(zone_t)252 1524 A
1818(z;)S
2115 V
(25799)210 1122 A
(zone_t)252 1524 A
(zone_size;)420 1818 A
2205 V
(25800)210 1122 A
(int)126 1524 A
(scale,)252 1692 A
1986(r;)S
2295 V
(25801)210 1122 A
(struct)252 1524 A
(super_block)462 1818 A
(*sp;)168 2322 A
2385 V
(25802)210 1122 A
2475 V
(25803)210 1122 A
1524(/*)S
1650(Is)S
(another)294 1776 A
(block)210 2112 A
(available)378 2364 A
2784(in)S
(the)126 2910 A
(current)294 3078 A
(zone?)210 3414 A
3666(*/)S
2565 V
(25804)210 1122 A
1524(if)S
1650(\()S
1734(\(b)S
1860(=)S
(read_map\(rip,)546 1944 A
(position\)\))420 2532 A
2994(==)S
(NO_BLOCK\))378 3120 A
3540({)S
2655 V
(25805)210 1122 A
1776(/*)S
(Choose)252 1902 A
(first)210 2196 A
(zone)168 2448 A
2658(if)S
(possible.)378 2784 A
3204(*/)S
2745 V
(25806)210 1122 A
1776(/*)S
(Lose)168 1902 A
2112(if)S
(the)126 2238 A
(file)168 2406 A
2616(is)S
(nonempty)336 2742 A
(but)126 3120 A
(the)126 3288 A
(first)210 3456 A
(zone)168 3708 A
(number)252 3918 A
4212(is)S
(NO_ZONE)294 4338 A
2835 V
(25807)210 1122 A
1818(*)S
(corresponding)546 1902 A
2490(to)S
2616(a)S
(zone)168 2700 A
(full)168 2910 A
3120(of)S
(zeros.)252 3246 A
3582(It)S
(would)210 3708 A
3960(be)S
(better)252 4086 A
4380(to)S
2925 V
(25808)210 1122 A
1818(*)S
(search)252 1902 A
(near)168 2196 A
(the)126 2406 A
(last)168 2574 A
(real)168 2784 A
(zone.)210 2994 A
3015 V
(25809)210 1122 A
1818(*/)S
3105 V
(25810)210 1122 A
1776(if)S
(\(rip->i_zone[0])630 1902 A
2574(==)S
(NO_ZONE\))336 2700 A
3078({)S
3195 V
(25811)210 1122 A
2112(sp)S
2238(=)S
(rip->i_sp;)420 2322 A
3285 V
(25812)210 1122 A
2112(z)S
2196(=)S
(sp->s_firstdatazone;)840 2280 A
3375 V
(25813)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
3465 V
(25814)210 1122 A
2112(z)S
2196(=)S
(rip->i_zone[0];)630 2280 A
3120(/*)S
(hunt)168 3246 A
(near)168 3456 A
(first)210 3666 A
(zone)168 3918 A
4128(*/)S
3555 V
(25815)210 1122 A
1776(})S
3645 V
(25816)210 1122 A
1776(if)S
1902(\()S
1986(\(z)S
2112(=)S
(alloc_zone\(rip->i_dev,)924 2196 A
(z\)\))126 3162 A
3330(==)S
(NO_ZONE\))336 3456 A
(return\(NIL_BUF\);)672 3834 A
3735 V
(25817)210 1122 A
1776(if)S
1902(\()S
1986(\(r)S
2112(=)S
(write_map\(rip,)588 2196 A
(position,)378 2826 A
(z\)\))126 3246 A
3414(!=)S
(OK\))126 3540 A
3708({)S
3825 V
(25818)210 1122 A
(free_zone\(rip->i_dev,)882 2112 A
(z\);)126 3036 A
3915 V
(25819)210 1122 A
(err_code)336 2112 A
2490(=)S
2574(r;)S
4005 V
(25820)210 1122 A
(return\(NIL_BUF\);)672 2112 A
4095 V
(25821)210 1122 A
1776(})S
4185 V
(25822)210 1122 A
4275 V
(25823)210 1122 A
1776(/*)S
1902(If)S
2028(we)S
(are)126 2154 A
(not)126 2322 A
(writing)294 2490 A
2826(at)S
(EOF,)168 2952 A
(clear)210 3162 A
(the)126 3414 A
(zone,)210 3582 A
(just)168 3834 A
4044(to)S
4170(be)S
(safe.)210 4296 A
4548(*/)S
4365 V
(25824)210 1122 A
1776(if)S
1902(\()S
(position)336 1986 A
2364(!=)S
(rip->i_size\))504 2490 A
(clear_zone\(rip,)630 3036 A
(position,)378 3708 A
(1\);)126 4128 A
4455 V
(25825)210 1122 A
(scale)210 1776 A
2028(=)S
(rip->i_sp->s_log_zone_size;)1134 2112 A
4545 V
(25826)210 1122 A
(base_block)420 1776 A
2238(=)S
(\(block_t\))378 2322 A
2742(z)S
2826(<<)S
(scale;)252 2952 A
4635 V
(25827)210 1122 A
(zone_size)378 1776 A
2196(=)S
(\(zone_t\))336 2280 A
(rip->i_sp->s_block_size)966 2658 A
3666(<<)S
(scale;)252 3792 A
4725 V
(25828)210 1122 A
1776(b)S
1860(=)S
(base_block)420 1944 A
2406(+)S
(\(block_t\)\(\(position)798 2490 A
3330(%)S
(zone_size\)/rip->i_sp->s_block_size\);)1512 3414 A
4815 V
(25829)210 1122 A
1524(})S
4905 V
(25830)210 1122 A
4995 V
(25831)210 1122 A
1524(bp)S
1650(=)S
(get_block\(rip->i_dev,)882 1734 A
2658(b,)S
(NO_READ\);)378 2784 A
5085 V
(25832)210 1122 A
(zero_block\(bp\);)630 1524 A
5175 V
(25833)210 1122 A
(return\(bp\);)462 1524 A
5265 V
(25834)210 1122 A
1440(})S
5445 V
(25836)210 1122 A
(/*===========================================================================*)3276 1440 A
5535 V
(25837)210 1122 A
1482(*)S
(zero_block)420 2784 A
4674(*)S
5625 V
(25838)210 1122 A
(*===========================================================================*/)3276 1482 A
5715 V
(25839)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(zero_block\(bp\))588 1944 A
5805 V
(25840)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(buf)126 2112 A
(*bp;)168 2280 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(buffer)252 3372 A
3666(to)S
(zero)168 3792 A
4002(*/)S
5895 V
(25841)210 1122 A
1440({)S
5985 V
(25842)210 1122 A
1440(/*)S
(Zero)168 1566 A
1776(a)S
(block.)252 1860 A
2154(*/)S
6075 V
(25843)210 1122 A
(memset\(bp->b_data,)756 1524 A
2322(0,)S
(MAX_BLOCK_SIZE\);)672 2448 A
6165 V
(25844)210 1122 A
(bp->b_dirt)420 1524 A
1986(=)S
(DIRTY;)252 2070 A
6255 V
(25845)210 1122 A
1440(})S
8418 V
EP
%%Page: 349 349
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2400(File:)S
2633(servers/fs/pipe.c)S
12 B
(349)180 4500 A
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(servers/fs/pipe.c)714 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(25900)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(deals)210 1986 A
(with)168 2238 A
(the)126 2448 A
(suspension)420 2616 A
(and)126 3078 A
(revival)294 3246 A
3582(of)S
(processes.)420 3708 A
4212(A)S
(process)294 4296 A
(can)126 4632 A
2295 V
(25901)210 1122 A
1482(*)S
1566(be)S
(suspended)378 1692 A
(because)294 2112 A
2448(it)S
(wants)210 2574 A
2826(to)S
(read)168 2952 A
3162(or)S
(write)210 3288 A
(from)168 3540 A
3750(a)S
(pipe)168 3834 A
(and)126 4044 A
(can't,)252 4212 A
4506(or)S
2385 V
(25902)210 1122 A
1482(*)S
(because)294 1566 A
1902(it)S
(wants)210 2028 A
2280(to)S
(read)168 2406 A
2616(or)S
(write)210 2742 A
(from)168 2994 A
3204(a)S
(special)294 3288 A
(file)168 3624 A
(and)126 3834 A
(can't.)252 4002 A
(When)168 4338 A
4548(a)S
2475 V
(25903)210 1122 A
1482(*)S
(process)294 1566 A
(can't)210 1902 A
(continue)336 2154 A
2532(it)S
2658(is)S
(suspended,)420 2784 A
(and)126 3246 A
(revived)294 3414 A
(later)210 3750 A
(when)168 4002 A
4212(it)S
4338(is)S
(able)168 4464 A
2565 V
(25904)210 1122 A
1482(*)S
1566(to)S
(continue.)378 1692 A
2655 V
(25905)210 1122 A
1482(*)S
2745 V
(25906)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are)126 2910 A
2835 V
(25907)210 1122 A
1482(*)S
(do_pipe:)336 1650 A
(perform)294 2196 A
(the)126 2532 A
(PIPE)168 2700 A
(system)252 2910 A
(call)168 3204 A
2925 V
(25908)210 1122 A
1482(*)S
(pipe_check:)462 1650 A
(check)210 2196 A
2448(to)S
(see)126 2574 A
(that)168 2742 A
2952(a)S
(read)168 3036 A
3246(or)S
(write)210 3372 A
3624(on)S
3750(a)S
(pipe)168 3834 A
4044(is)S
(feasible)336 4170 A
(now)126 4548 A
3015 V
(25909)210 1122 A
1482(*)S
(suspend:)336 1650 A
(suspend)294 2196 A
2532(a)S
(process)294 2616 A
(that)168 2952 A
(cannot)252 3162 A
3456(do)S
3582(a)S
(requested)378 3666 A
(read)168 4086 A
4296(or)S
(write)210 4422 A
3105 V
(25910)210 1122 A
1482(*)S
(release:)336 1650 A
(check)210 2196 A
2448(to)S
(see)126 2574 A
2742(if)S
2868(a)S
(suspended)378 2952 A
(process)294 3372 A
(can)126 3708 A
3876(be)S
(released)336 4002 A
(and)126 4380 A
4548(do)S
3195 V
(25911)210 1122 A
1482(*)S
2196(it)S
3285 V
(25912)210 1122 A
1482(*)S
(revive:)294 1650 A
(mark)168 2196 A
2406(a)S
(suspended)378 2490 A
(process)294 2910 A
3246(as)S
(able)168 3372 A
3582(to)S
(run)126 3708 A
(again)210 3876 A
3375 V
(25913)210 1122 A
1482(*)S
(do_unpause:)462 1650 A
2196(a)S
(signal)252 2280 A
(has)126 2574 A
(been)168 2742 A
(sent)168 2952 A
3162(to)S
3288(a)S
(process;)336 3372 A
(see)126 3750 A
3918(if)S
4044(it)S
(suspended)378 4170 A
3465 V
(25914)210 1122 A
1482(*/)S
3555 V
(25915)210 1122 A
3645 V
(25916)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
3735 V
(25917)210 1122 A
(#include)336 1440 A
(<fcntl.h>)378 1818 A
3825 V
(25918)210 1122 A
(#include)336 1440 A
(<signal.h>)420 1818 A
3915 V
(25919)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
4005 V
(25920)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
4095 V
(25921)210 1122 A
(#include)336 1440 A
(<sys/select.h>)588 1818 A
4185 V
(25922)210 1122 A
(#include)336 1440 A
(<sys/time.h>)504 1818 A
4275 V
(25923)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
4365 V
(25924)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
4455 V
(25925)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
4545 V
(25926)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
4635 V
(25927)210 1122 A
(#include)336 1440 A
("super.h")378 1818 A
4725 V
(25928)210 1122 A
(#include)336 1440 A
("select.h")420 1818 A
4815 V
(25929)210 1122 A
4905 V
(25930)210 1122 A
(/*===========================================================================*)3276 1440 A
4995 V
(25931)210 1122 A
1482(*)S
(do_pipe)294 2784 A
4674(*)S
5085 V
(25932)210 1122 A
(*===========================================================================*/)3276 1482 A
5175 V
(25933)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_pipe\(\))378 1902 A
5265 V
(25934)210 1122 A
1440({)S
5355 V
(25935)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(pipe\(fil_des\))546 2070 A
(system)252 2658 A
(call.)210 2952 A
3204(*/)S
5445 V
(25936)210 1122 A
5535 V
(25937)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(fproc)210 2196 A
(*rfp;)210 2448 A
5625 V
(25938)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
5715 V
(25939)210 1122 A
(int)126 1524 A
1692(r;)S
5805 V
(25940)210 1122 A
(struct)252 1524 A
(filp)168 1818 A
(*fil_ptr0,)420 2028 A
(*fil_ptr1;)420 2490 A
5895 V
(25941)210 1122 A
(int)126 1524 A
(fil_des[2];)462 1692 A
2784(/*)S
(reply)210 2910 A
(goes)168 3162 A
(here)168 3372 A
3582(*/)S
5985 V
(25942)210 1122 A
6075 V
(25943)210 1122 A
1524(/*)S
(Acquire)294 1650 A
(two)126 1986 A
(file)168 2154 A
(descriptors.)504 2364 A
2910(*/)S
6165 V
(25944)210 1122 A
(rfp)126 1524 A
1692(=)S
(fp;)126 1776 A
6255 V
(25945)210 1122 A
1524(if)S
1650(\()S
1734(\(r)S
1860(=)S
(get_fd\(0,)378 1944 A
(R_BIT,)252 2364 A
(&fil_des[0],)504 2658 A
(&fil_ptr0\)\))462 3204 A
3708(!=)S
(OK\))126 3834 A
(return\(r\);)420 4002 A
6345 V
(25946)210 1122 A
(rfp->fp_filp[fil_des[0]])1008 1524 A
2574(=)S
(fil_ptr0;)378 2658 A
6435 V
(25947)210 1122 A
(fil_ptr0->filp_count)840 1524 A
2406(=)S
2490(1;)S
6525 V
(25948)210 1122 A
1524(if)S
1650(\()S
1734(\(r)S
1860(=)S
(get_fd\(0,)378 1944 A
(W_BIT,)252 2364 A
(&fil_des[1],)504 2658 A
(&fil_ptr1\)\))462 3204 A
3708(!=)S
(OK\))126 3834 A
4002({)S
6615 V
(25949)210 1122 A
(rfp->fp_filp[fil_des[0]])1008 1776 A
2826(=)S
(NIL_FILP;)378 2910 A
6705 V
(25950)210 1122 A
(fil_ptr0->filp_count)840 1776 A
2658(=)S
2742(0;)S
6795 V
(25951)210 1122 A
(return\(r\);)420 1776 A
6885 V
(25952)210 1122 A
1524(})S
6975 V
(25953)210 1122 A
(rfp->fp_filp[fil_des[1]])1008 1524 A
2574(=)S
(fil_ptr1;)378 2658 A
7065 V
(25954)210 1122 A
(fil_ptr1->filp_count)840 1524 A
2406(=)S
2490(1;)S
8418 V
EP
%%Page: 350 350
BP
/slant 0 def
/height 0 def
1485 V
12 B
(350)180 1080 A
11 R
2400(File:)S
2633(servers/fs/pipe.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(25955)210 1122 A
1845 V
(25956)210 1122 A
1524(/*)S
(Make)168 1650 A
(the)126 1860 A
(inode)210 2028 A
2280(on)S
(the)126 2406 A
(pipe)168 2574 A
(device.)294 2784 A
3120(*/)S
1935 V
(25957)210 1122 A
1524(if)S
1650(\()S
(\(rip)168 1734 A
1944(=)S
(alloc_inode\(root_dev,)882 2028 A
(I_REGULAR\))420 2952 A
3414(\))S
3498(==)S
(NIL_INODE\))420 3624 A
4086({)S
2025 V
(25958)210 1122 A
(rfp->fp_filp[fil_des[0]])1008 1776 A
2826(=)S
(NIL_FILP;)378 2910 A
2115 V
(25959)210 1122 A
(fil_ptr0->filp_count)840 1776 A
2658(=)S
2742(0;)S
2205 V
(25960)210 1122 A
(rfp->fp_filp[fil_des[1]])1008 1776 A
2826(=)S
(NIL_FILP;)378 2910 A
2295 V
(25961)210 1122 A
(fil_ptr1->filp_count)840 1776 A
2658(=)S
2742(0;)S
2385 V
(25962)210 1122 A
(return\(err_code\);)714 1776 A
2475 V
(25963)210 1122 A
1524(})S
2565 V
(25964)210 1122 A
2655 V
(25965)210 1122 A
1524(if)S
(\(read_only\(rip\))630 1650 A
2322(!=)S
(OK\))126 2448 A
2745 V
(25966)210 1122 A
(panic\(__FILE__,"pipe)840 1776 A
(device)252 2658 A
2952(is)S
(read)168 3078 A
(only",)252 3288 A
(NO_NUM\);)336 3582 A
2835 V
(25967)210 1122 A
2925 V
(25968)210 1122 A
(rip->i_pipe)462 1524 A
2028(=)S
(I_PIPE;)294 2112 A
3015 V
(25969)210 1122 A
(rip->i_mode)462 1524 A
2028(&=)S
(\304I_REGULAR;)462 2154 A
3105 V
(25970)210 1122 A
(rip->i_mode)462 1524 A
2028(|=)S
(I_NAMED_PIPE;)546 2154 A
2784(/*)S
(pipes)210 2910 A
(and)126 3162 A
(FIFOs)210 3330 A
(have)168 3582 A
(this)168 3792 A
(bit)126 4002 A
(set)126 4170 A
4338(*/)S
3195 V
(25971)210 1122 A
(fil_ptr0->filp_ino)756 1524 A
2322(=)S
(rip;)168 2406 A
3285 V
(25972)210 1122 A
(fil_ptr0->filp_flags)840 1524 A
2406(=)S
(O_RDONLY;)378 2490 A
3375 V
(25973)210 1122 A
(dup_inode\(rip\);)630 1524 A
2784(/*)S
(for)126 2910 A
(double)252 3078 A
(usage)210 3372 A
3624(*/)S
3465 V
(25974)210 1122 A
(fil_ptr1->filp_ino)756 1524 A
2322(=)S
(rip;)168 2406 A
3555 V
(25975)210 1122 A
(fil_ptr1->filp_flags)840 1524 A
2406(=)S
(O_WRONLY;)378 2490 A
3645 V
(25976)210 1122 A
(rw_inode\(rip,)546 1524 A
(WRITING\);)378 2112 A
2784(/*)S
(mark)168 2910 A
(inode)210 3120 A
3372(as)S
(allocated)378 3498 A
3918(*/)S
3735 V
(25977)210 1122 A
(m_out.reply_i1)588 1524 A
2154(=)S
(fil_des[0];)462 2238 A
3825 V
(25978)210 1122 A
(m_out.reply_i2)588 1524 A
2154(=)S
(fil_des[1];)462 2238 A
3915 V
(25979)210 1122 A
(rip->i_update)546 1524 A
2112(=)S
(ATIME)210 2196 A
2448(|)S
(CTIME)210 2532 A
2784(|)S
(MTIME;)252 2868 A
4005 V
(25980)210 1122 A
(return\(OK\);)462 1524 A
4095 V
(25981)210 1122 A
1440(})S
4275 V
(25983)210 1122 A
(/*===========================================================================*)3276 1440 A
4365 V
(25984)210 1122 A
1482(*)S
(pipe_check)420 2784 A
4674(*)S
4455 V
(25985)210 1122 A
(*===========================================================================*/)3276 1482 A
4545 V
(25986)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(pipe_check\(rip,)630 1902 A
(rw_flag,)336 2574 A
(oflags,)294 2952 A
(bytes,)252 3288 A
(position,)378 3582 A
(canwrite,)378 4002 A
(notouch\))336 4422 A
4635 V
(25987)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(the)126 2910 A
(inode)210 3078 A
3330(of)S
(the)126 3456 A
(pipe)168 3624 A
3834(*/)S
4725 V
(25988)210 1122 A
(int)126 1440 A
(rw_flag;)336 1608 A
2784(/*)S
(READING)294 2910 A
3246(or)S
(WRITING)294 3372 A
3708(*/)S
4815 V
(25989)210 1122 A
(int)126 1440 A
(oflags;)294 1608 A
2784(/*)S
(flags)210 2910 A
(set)126 3162 A
3330(by)S
(open)168 3456 A
3666(or)S
(fcntl)210 3792 A
4044(*/)S
4905 V
(25990)210 1122 A
(register)336 1440 A
(int)126 1818 A
(bytes;)252 1986 A
2784(/*)S
(bytes)210 2910 A
3162(to)S
3288(be)S
(read)168 3414 A
3624(or)S
(written)294 3750 A
(\(all)168 4086 A
(chunks\))294 4296 A
4632(*/)S
4995 V
(25991)210 1122 A
(register)336 1440 A
(off_t)210 1818 A
(position;)378 2070 A
2784(/*)S
(current)294 2910 A
(file)168 3246 A
(position)336 3456 A
3834(*/)S
5085 V
(25992)210 1122 A
(int)126 1440 A
(*canwrite;)420 1608 A
2784(/*)S
(return:)294 2910 A
(number)252 3246 A
3540(of)S
(bytes)210 3666 A
3918(we)S
(can)126 4044 A
(write)210 4212 A
4464(*/)S
5175 V
(25993)210 1122 A
(int)126 1440 A
(notouch;)336 1608 A
2784(/*)S
(check)210 2910 A
(only)168 3162 A
3372(*/)S
5265 V
(25994)210 1122 A
1440({)S
5355 V
(25995)210 1122 A
1440(/*)S
(Pipes)210 1566 A
(are)126 1818 A
1986(a)S
(little)252 2070 A
(different.)420 2364 A
2868(If)S
2994(a)S
(process)294 3078 A
(reads)210 3414 A
(from)168 3666 A
3876(an)S
(empty)210 4002 A
(pipe)168 4254 A
(for)126 4464 A
5445 V
(25996)210 1122 A
1482(*)S
(which)210 1566 A
1818(a)S
(writer)252 1902 A
(still)210 2196 A
(exists,)294 2448 A
(suspend)294 2784 A
(the)126 3120 A
(reader.)294 3288 A
3666(If)S
(the)126 3792 A
(pipe)168 3960 A
4170(is)S
(empty)210 4296 A
5535 V
(25997)210 1122 A
1482(*)S
(and)126 1566 A
(there)210 1734 A
1986(is)S
2112(no)S
(writer,)294 2238 A
(return)252 2574 A
2868(0)S
(bytes.)252 2952 A
3288(If)S
3414(a)S
(process)294 3498 A
3834(is)S
(writing)294 3960 A
4296(to)S
4422(a)S
5625 V
(25998)210 1122 A
1482(*)S
(pipe)168 1566 A
(and)126 1776 A
1944(no)S
(one)126 2070 A
2238(is)S
(reading)294 2364 A
(from)168 2700 A
(it,)126 2910 A
(give)168 3078 A
3288(a)S
(broken)252 3372 A
(pipe)168 3666 A
(error.)252 3876 A
5715 V
(25999)210 1122 A
1482(*/)S
5805 V
(26000)210 1122 A
5895 V
(26001)210 1122 A
1524(/*)S
1650(If)S
(reading,)336 1776 A
(check)210 2154 A
(for)126 2406 A
(empty)210 2574 A
(pipe.)210 2826 A
3078(*/)S
5985 V
(26002)210 1122 A
1524(if)S
(\(rw_flag)336 1650 A
2028(==)S
(READING\))336 2154 A
2532({)S
6075 V
(26003)210 1122 A
1776(if)S
(\(position)378 1902 A
2322(>=)S
(rip->i_size\))504 2448 A
2994({)S
6165 V
(26004)210 1122 A
2112(/*)S
(Process)294 2238 A
2574(is)S
(reading)294 2700 A
(from)168 3036 A
3246(an)S
(empty)210 3372 A
(pipe.)210 3624 A
3876(*/)S
6255 V
(26005)210 1122 A
(int)126 2112 A
2280(r)S
2364(=)S
2448(0;)S
6345 V
(26006)210 1122 A
2112(if)S
(\(find_filp\(rip,)630 2238 A
(W_BIT\))252 2910 A
3204(!=)S
(NIL_FILP\))378 3330 A
3750({)S
6435 V
(26007)210 1122 A
2448(/*)S
(Writer)252 2574 A
(exists)252 2868 A
3162(*/)S
6525 V
(26008)210 1122 A
2448(if)S
(\(oflags)294 2574 A
2910(&)S
(O_NONBLOCK\))462 2994 A
3498({)S
6615 V
(26009)210 1122 A
2784(r)S
2868(=)S
(EAGAIN;)294 2952 A
6705 V
(26010)210 1122 A
2448(})S
(else)168 2532 A
2742({)S
6795 V
(26011)210 1122 A
2784(if)S
(\(!notouch\))420 2910 A
6885 V
(26012)210 1122 A
(suspend\(XPIPE\);)630 3120 A
3792(/*)S
(block)210 3918 A
(reader)252 4170 A
4464(*/)S
6975 V
(26013)210 1122 A
2784(r)S
2868(=)S
(SUSPEND;)336 2952 A
7065 V
(26014)210 1122 A
2448(})S
8418 V
EP
%%Page: 351 351
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2400(File:)S
2633(servers/fs/pipe.c)S
12 B
(351)180 4500 A
1755 V
7 LST
(26015)210 1122 A
2448(/*)S
2574(If)S
(need)168 2700 A
(be,)126 2910 A
(activate)336 3078 A
(sleeping)336 3456 A
(writers.)336 3834 A
4212(*/)S
1845 V
(26016)210 1122 A
2448(if)S
(\(susp_count)462 2574 A
3078(>)S
3162(0)S
3246(&&)S
(!notouch\))378 3372 A
1935 V
(26017)210 1122 A
(release\(rip,)504 2784 A
(WRITE,)252 3330 A
(susp_count\);)504 3624 A
2025 V
(26018)210 1122 A
2112(})S
2115 V
(26019)210 1122 A
(return\(r\);)420 2112 A
2205 V
(26020)210 1122 A
1776(})S
2295 V
(26021)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
2385 V
(26022)210 1122 A
1776(/*)S
(Process)294 1902 A
2238(is)S
(writing)294 2364 A
2700(to)S
2826(a)S
(pipe.)210 2910 A
3162(*/)S
2475 V
(26023)210 1122 A
1776(if)S
(\(find_filp\(rip,)630 1902 A
(R_BIT\))252 2574 A
2868(==)S
(NIL_FILP\))378 2994 A
3414({)S
2565 V
(26024)210 1122 A
2112(/*)S
(Tell)168 2238 A
(kernel)252 2448 A
2742(to)S
(generate)336 2868 A
3246(a)S
(SIGPIPE)294 3330 A
(signal.)294 3666 A
4002(*/)S
2655 V
(26025)210 1122 A
2112(if)S
(\(!notouch\))420 2238 A
2745 V
(26026)210 1122 A
(sys_kill\(\(int\)\(fp)714 2448 A
3204(-)S
(fproc\),)294 3288 A
(SIGPIPE\);)378 3624 A
2835 V
(26027)210 1122 A
(return\(EPIPE\);)588 2112 A
2925 V
(26028)210 1122 A
1776(})S
3015 V
(26029)210 1122 A
3105 V
(26030)210 1122 A
1776(if)S
(\(position)378 1902 A
2322(+)S
(bytes)210 2406 A
2658(>)S
(PIPE_SIZE\(rip->i_sp->s_block_size\)\))1470 2742 A
4254({)S
3195 V
(26031)210 1122 A
2112(if)S
(\(\(oflags)336 2238 A
2616(&)S
(O_NONBLOCK\))462 2700 A
3285 V
(26032)210 1122 A
2154(&&)S
(bytes)210 2280 A
2532(<)S
(PIPE_SIZE\(rip->i_sp->s_block_size\)\))1470 2616 A
3375 V
(26033)210 1122 A
(return\(EAGAIN\);)630 2448 A
3465 V
(26034)210 1122 A
(else)168 2112 A
2322(if)S
(\(\(oflags)336 2448 A
2826(&)S
(O_NONBLOCK\))462 2910 A
3555 V
(26035)210 1122 A
2112(&&)S
(bytes)210 2238 A
2490(>)S
(PIPE_SIZE\(rip->i_sp->s_block_size\)\))1470 2574 A
4086({)S
3645 V
(26036)210 1122 A
2112(if)S
2238(\()S
(\(*canwrite)420 2322 A
2784(=)S
(\(PIPE_SIZE\(rip->i_sp->s_block_size\))1470 2868 A
3735 V
(26037)210 1122 A
2448(-)S
(position\)\))420 2532 A
2994(>)S
3078(0\))S
3246({)S
3825 V
(26038)210 1122 A
2784(/*)S
2910(Do)S
3036(a)S
(partial)294 3120 A
(write.)252 3456 A
(Need)168 3750 A
3960(to)S
(wakeup)252 4086 A
(reader)252 4380 A
4674(*/)S
3915 V
(26039)210 1122 A
2784(if)S
(\(!notouch\))420 2910 A
4005 V
(26040)210 1122 A
(release\(rip,)504 3120 A
(READ,)210 3666 A
(susp_count\);)504 3918 A
4095 V
(26041)210 1122 A
(return\(1\);)420 2784 A
4185 V
(26042)210 1122 A
2448(})S
(else)168 2532 A
2742({)S
4275 V
(26043)210 1122 A
(return\(EAGAIN\);)630 2784 A
4365 V
(26044)210 1122 A
2448(})S
4455 V
(26045)210 1122 A
2322(})S
4545 V
(26046)210 1122 A
2112(if)S
(\(bytes)252 2238 A
2532(>)S
(PIPE_SIZE\(rip->i_sp->s_block_size\)\))1470 2616 A
4128({)S
4635 V
(26047)210 1122 A
2448(if)S
(\(\(*canwrite)462 2574 A
3078(=)S
(PIPE_SIZE\(rip->i_sp->s_block_size\))1428 3162 A
4725 V
(26048)210 1122 A
2784(-)S
(position\))378 2868 A
3288(>)S
3372(0\))S
3498({)S
4815 V
(26049)210 1122 A
2784(/*)S
2910(Do)S
3036(a)S
(partial)294 3120 A
(write.)252 3456 A
(Need)168 3750 A
3960(to)S
(wakeup)252 4086 A
(reader)252 4380 A
4905 V
(26050)210 1122 A
2826(*)S
(since)210 2910 A
(we'll)210 3162 A
(suspend)294 3414 A
(ourself)294 3750 A
4086(in)S
(read_write\(\))504 4212 A
4995 V
(26051)210 1122 A
2826(*/)S
5085 V
(26052)210 1122 A
(release\(rip,)504 2784 A
(READ,)210 3330 A
(susp_count\);)504 3582 A
5175 V
(26053)210 1122 A
(return\(1\);)420 2784 A
5265 V
(26054)210 1122 A
2448(})S
5355 V
(26055)210 1122 A
2112(})S
5445 V
(26056)210 1122 A
2112(if)S
(\(!notouch\))420 2238 A
5535 V
(26057)210 1122 A
(suspend\(XPIPE\);)630 2448 A
3120(/*)S
(stop)168 3246 A
(writer)252 3456 A
3750(--)S
(pipe)168 3876 A
(full)168 4086 A
4296(*/)S
5625 V
(26058)210 1122 A
(return\(SUSPEND\);)672 2112 A
5715 V
(26059)210 1122 A
1776(})S
5805 V
(26060)210 1122 A
5895 V
(26061)210 1122 A
1776(/*)S
(Writing)294 1902 A
2238(to)S
2364(an)S
(empty)210 2490 A
(pipe.)210 2742 A
(Search)252 3036 A
(for)126 3330 A
(suspended)378 3498 A
(reader.)294 3918 A
4254(*/)S
5985 V
(26062)210 1122 A
1776(if)S
(\(position)378 1902 A
2322(==)S
2448(0)S
2532(&&)S
(!notouch\))378 2658 A
6075 V
(26063)210 1122 A
(release\(rip,)504 2112 A
(READ,)210 2658 A
(susp_count\);)504 2910 A
6165 V
(26064)210 1122 A
1524(})S
6255 V
(26065)210 1122 A
6345 V
(26066)210 1122 A
(*canwrite)378 1524 A
1944(=)S
2028(0;)S
6435 V
(26067)210 1122 A
(return\(1\);)420 1524 A
6525 V
(26068)210 1122 A
1440(})S
6705 V
(26070)210 1122 A
(/*===========================================================================*)3276 1440 A
6795 V
(26071)210 1122 A
1482(*)S
(suspend)294 2784 A
4674(*)S
6885 V
(26072)210 1122 A
(*===========================================================================*/)3276 1482 A
6975 V
(26073)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(suspend\(task\))546 1944 A
7065 V
(26074)210 1122 A
(int)126 1440 A
(task;)210 1608 A
2784(/*)S
(who)126 2910 A
3078(is)S
(proc)168 3204 A
(waiting)294 3414 A
(for?)168 3750 A
(\(PIPE)210 3960 A
4212(=)S
(pipe\))210 4296 A
4548(*/)S
8418 V
EP
%%Page: 352 352
BP
/slant 0 def
/height 0 def
1485 V
12 B
(352)180 1080 A
11 R
2400(File:)S
2633(servers/fs/pipe.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(26075)210 1122 A
1440({)S
1845 V
(26076)210 1122 A
1440(/*)S
(Take)168 1566 A
(measures)336 1776 A
2154(to)S
(suspend)294 2280 A
(the)126 2616 A
(processing)420 2784 A
3246(of)S
(the)126 3372 A
(present)294 3540 A
(system)252 3876 A
(call.)210 4170 A
1935 V
(26077)210 1122 A
1482(*)S
(Store)210 1566 A
(the)126 1818 A
(parameters)420 1986 A
2448(to)S
2574(be)S
(used)168 2700 A
(upon)168 2910 A
(resuming)336 3120 A
3498(in)S
(the)126 3624 A
(process)294 3792 A
(table.)252 4128 A
2025 V
(26078)210 1122 A
1482(*)S
(\(Actually)378 1566 A
(they)168 1986 A
(are)126 2196 A
(not)126 2364 A
(used)168 2532 A
(when)168 2742 A
2952(a)S
(process)294 3036 A
3372(is)S
(waiting)294 3498 A
(for)126 3834 A
4002(an)S
(I/O)126 4128 A
(device,)294 4296 A
2115 V
(26079)210 1122 A
1482(*)S
(but)126 1566 A
(they)168 1734 A
(are)126 1944 A
(needed)252 2112 A
(for)126 2406 A
(pipes,)252 2574 A
(and)126 2868 A
3036(it)S
3162(is)S
(not)126 3288 A
(worth)210 3456 A
(making)252 3708 A
(the)126 4002 A
(distinction.\))546 4170 A
2205 V
(26080)210 1122 A
1482(*)S
(The)126 1566 A
(SUSPEND)294 1734 A
(pseudo)252 2070 A
(error)210 2364 A
(should)252 2616 A
2910(be)S
(returned)336 3036 A
(after)210 3414 A
(calling)294 3666 A
(suspend\(\).)420 4002 A
2295 V
(26081)210 1122 A
1482(*/)S
2385 V
(26082)210 1122 A
2475 V
(26083)210 1122 A
1524(if)S
(\(task)210 1650 A
1902(==)S
(XPIPE)210 2028 A
2280(||)S
(task)168 2406 A
2616(==)S
(XPOPEN\))294 2742 A
(susp_count++;/*)630 3078 A
(#procs)252 3750 A
(susp'ed)294 4044 A
4380(on)S
(pipe*/)252 4506 A
2565 V
(26084)210 1122 A
(fp->fp_suspended)672 1524 A
2238(=)S
(SUSPENDED;)420 2322 A
2655 V
(26085)210 1122 A
(fp->fp_fd)378 1524 A
1944(=)S
(m_in.fd)294 2028 A
2364(<<)S
2490(8)S
2574(|)S
(call_nr;)336 2658 A
2745 V
(26086)210 1122 A
(fp->fp_task)462 1524 A
2028(=)S
(-task;)252 2112 A
2835 V
(26087)210 1122 A
1524(if)S
(\(task)210 1650 A
1902(==)S
(XLOCK\))252 2028 A
2322({)S
2925 V
(26088)210 1122 A
(fp->fp_buffer)546 1776 A
2364(=)S
(\(char)210 2448 A
2700(*\))S
(m_in.name1;)462 2826 A
3456(/*)S
(third)210 3582 A
(arg)126 3834 A
4002(to)S
(fcntl\(\))294 4128 A
4464(*/)S
3015 V
(26089)210 1122 A
(fp->fp_nbytes)546 1776 A
2364(=)S
(m_in.request;)546 2448 A
3456(/*)S
(second)252 3582 A
(arg)126 3876 A
4044(to)S
(fcntl\(\))294 4170 A
4506(*/)S
3105 V
(26090)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3195 V
(26091)210 1122 A
(fp->fp_buffer)546 1776 A
2364(=)S
(m_in.buffer;)504 2448 A
3456(/*)S
(for)126 3582 A
(reads)210 3750 A
(and)126 4002 A
(writes)252 4170 A
4464(*/)S
3285 V
(26092)210 1122 A
(fp->fp_nbytes)546 1776 A
2364(=)S
(m_in.nbytes;)504 2448 A
3375 V
(26093)210 1122 A
1524(})S
3465 V
(26094)210 1122 A
1440(})S
3645 V
(26096)210 1122 A
(/*===========================================================================*)3276 1440 A
3735 V
(26097)210 1122 A
1482(*)S
(release)294 2784 A
4674(*)S
3825 V
(26098)210 1122 A
(*===========================================================================*/)3276 1482 A
3915 V
(26099)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(release\(ip,)462 1944 A
(call_nr,)336 2448 A
(count\))252 2826 A
4005 V
(26100)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*ip;)168 2364 A
2784(/*)S
(inode)210 2910 A
3162(of)S
(pipe)168 3288 A
3498(*/)S
4095 V
(26101)210 1122 A
(int)126 1440 A
(call_nr;)336 1608 A
2784(/*)S
(READ,)210 2910 A
(WRITE,)252 3162 A
(OPEN)168 3456 A
3666(or)S
(CREAT)210 3792 A
4044(*/)S
4185 V
(26102)210 1122 A
(int)126 1440 A
(count;)252 1608 A
2784(/*)S
(max)126 2910 A
(number)252 3078 A
3372(of)S
(processes)378 3498 A
3918(to)S
(release)294 4044 A
4380(*/)S
4275 V
(26103)210 1122 A
1440({)S
4365 V
(26104)210 1122 A
1440(/*)S
(Check)210 1566 A
1818(to)S
(see)126 1944 A
2112(if)S
(any)126 2238 A
(process)294 2406 A
2742(is)S
(hanging)294 2868 A
3204(on)S
(the)126 3330 A
(pipe)168 3498 A
(whose)210 3708 A
(inode)210 3960 A
4212(is)S
4338(in)S
('ip'.)210 4464 A
4455 V
(26105)210 1122 A
1482(*)S
1566(If)S
(one)126 1692 A
(is,)126 1860 A
(and)126 2028 A
2196(it)S
(was)126 2322 A
(trying)252 2490 A
2784(to)S
(perform)294 2910 A
(the)126 3246 A
(call)168 3414 A
(indicated)378 3624 A
4044(by)S
('call_nr',)420 4170 A
4545 V
(26106)210 1122 A
1482(*)S
(release)294 1566 A
(it.)126 1902 A
4635 V
(26107)210 1122 A
1482(*/)S
4725 V
(26108)210 1122 A
4815 V
(26109)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(fproc)210 2196 A
(*rp;)168 2448 A
4905 V
(26110)210 1122 A
(struct)252 1524 A
(filp)168 1818 A
(*f;)126 2028 A
4995 V
(26111)210 1122 A
5085 V
(26112)210 1122 A
1524(/*)S
(Trying)252 1650 A
1944(to)S
(perform)294 2070 A
(the)126 2406 A
(call)168 2574 A
(also)168 2784 A
(includes)336 2994 A
(SELECTing)378 3372 A
3792(on)S
3918(it)S
(with)168 4044 A
(that)168 4254 A
5175 V
(26113)210 1122 A
1566(*)S
(operation.)420 1650 A
5265 V
(26114)210 1122 A
1566(*/)S
5355 V
(26115)210 1122 A
1524(if)S
(\(call_nr)336 1650 A
2028(==)S
(READ)168 2154 A
2364(||)S
(call_nr)294 2490 A
2826(==)S
(WRITE\))252 2952 A
3246({)S
5445 V
(26116)210 1122 A
(int)126 1860 A
(op;)126 2028 A
5535 V
(26117)210 1122 A
1860(if)S
(\(call_nr)336 1986 A
2364(==)S
(READ\))210 2490 A
5625 V
(26118)210 1122 A
2112(op)S
2238(=)S
(SEL_RD;)294 2322 A
5715 V
(26119)210 1122 A
(else)168 1860 A
5805 V
(26120)210 1122 A
2112(op)S
2238(=)S
(SEL_WR;)294 2322 A
5895 V
(26121)210 1122 A
(for\(f)210 1860 A
2112(=)S
(&filp[0];)378 2196 A
2616(f)S
2700(<)S
(&filp[NR_FILPS];)672 2784 A
(f++\))168 3498 A
3708({)S
5985 V
(26122)210 1122 A
2112(if)S
(\(f->filp_count)588 2238 A
2868(<)S
2952(1)S
3036(||)S
(!\(f->filp_pipe_select_ops)1050 3162 A
4254(&)S
(op\))126 4338 A
4506(||)S
6075 V
(26123)210 1122 A
(f->filp_ino)462 2238 A
2742(!=)S
(ip\))126 2868 A
6165 V
(26124)210 1122 A
(continue;)378 2448 A
6255 V
(26125)210 1122 A
(select_callback\(f,)756 2154 A
(op\);)168 2952 A
6345 V
(26126)210 1122 A
(f->filp_pipe_select_ops)966 2112 A
3120(&=)S
(\304op;)168 3246 A
6435 V
(26127)210 1122 A
1776(})S
6525 V
(26128)210 1122 A
1524(})S
6615 V
(26129)210 1122 A
6705 V
(26130)210 1122 A
1524(/*)S
(Search)252 1650 A
(the)126 1944 A
(proc)168 2112 A
(table.)252 2322 A
2616(*/)S
6795 V
(26131)210 1122 A
(for)126 1524 A
(\(rp)126 1692 A
1860(=)S
(&fproc[0];)420 1944 A
2406(rp)S
2532(<)S
(&fproc[NR_PROCS];)714 2616 A
(rp++\))210 3372 A
3624({)S
6885 V
(26132)210 1122 A
1776(if)S
(\(rp->fp_suspended)714 1902 A
2658(==)S
(SUSPENDED)378 2784 A
3204(&&)S
6975 V
(26133)210 1122 A
(rp->fp_revived)588 2448 A
3078(==)S
(NOT_REVIVING)504 3204 A
3750(&&)S
7065 V
(26134)210 1122 A
(\(rp->fp_fd)420 2448 A
2910(&)S
(BYTE\))210 2994 A
3246(==)S
(call_nr)294 3372 A
3708(&&)S
8418 V
EP
%%Page: 353 353
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2400(File:)S
2633(servers/fs/pipe.c)S
12 B
(353)180 4500 A
1755 V
7 LST
(26135)210 1122 A
(rp->fp_filp[rp->fp_fd>>8]->filp_ino)1470 2448 A
3960(==)S
(ip\))126 4086 A
4254({)S
1845 V
(26136)210 1122 A
(revive\(\(int\)\(rp)630 2112 A
2784(-)S
(fproc\),)294 2868 A
(0\);)126 3204 A
1935 V
(26137)210 1122 A
(susp_count--;)546 2112 A
2784(/*)S
(keep)168 2910 A
(track)210 3120 A
3372(of)S
(who)126 3498 A
3666(is)S
(suspended)378 3792 A
4212(*/)S
2025 V
(26138)210 1122 A
2112(if)S
(\(--count)336 2238 A
2616(==)S
2742(0\))S
(return;)294 2868 A
2115 V
(26139)210 1122 A
1776(})S
2205 V
(26140)210 1122 A
1524(})S
2295 V
(26141)210 1122 A
1440(})S
2475 V
(26143)210 1122 A
(/*===========================================================================*)3276 1440 A
2565 V
(26144)210 1122 A
1482(*)S
(revive)252 2784 A
4674(*)S
2655 V
(26145)210 1122 A
(*===========================================================================*/)3276 1482 A
2745 V
(26146)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(revive\(proc_nr,)630 1944 A
(returned\))378 2616 A
2835 V
(26147)210 1122 A
(int)126 1440 A
(proc_nr;)336 1608 A
2784(/*)S
(process)294 2910 A
3246(to)S
(revive)252 3372 A
3666(*/)S
2925 V
(26148)210 1122 A
(int)126 1440 A
(returned;)378 1608 A
2784(/*)S
2910(if)S
(hanging)294 3036 A
3372(on)S
(task,)210 3498 A
(how)126 3750 A
(many)168 3918 A
(bytes)210 4128 A
(read)168 4380 A
4590(*/)S
3015 V
(26149)210 1122 A
1440({)S
3105 V
(26150)210 1122 A
1440(/*)S
(Revive)252 1566 A
1860(a)S
(previously)420 1944 A
(blocked)294 2406 A
(process.)336 2742 A
(When)168 3120 A
3330(a)S
(process)294 3414 A
(hangs)210 3750 A
4002(on)S
(tty,)168 4128 A
(this)168 4338 A
3195 V
(26151)210 1122 A
1482(*)S
1566(is)S
(the)126 1692 A
(way)126 1860 A
2028(it)S
2154(is)S
(eventually)420 2280 A
(released.)378 2742 A
3285 V
(26152)210 1122 A
1482(*/)S
3375 V
(26153)210 1122 A
3465 V
(26154)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(fproc)210 2196 A
(*rfp;)210 2448 A
3555 V
(26155)210 1122 A
(register)336 1524 A
(int)126 1902 A
(task;)210 2070 A
3645 V
(26156)210 1122 A
3735 V
(26157)210 1122 A
1524(if)S
(\(proc_nr)336 1650 A
2028(<)S
2112(0)S
2196(||)S
(proc_nr)294 2322 A
2658(>=)S
(NR_PROCS\))378 2784 A
3825 V
(26158)210 1122 A
(panic\(__FILE__,"revive)924 1776 A
(err",)210 2742 A
(proc_nr\);)378 2994 A
3915 V
(26159)210 1122 A
(rfp)126 1524 A
1692(=)S
(&fproc[proc_nr];)672 1776 A
4005 V
(26160)210 1122 A
1524(if)S
(\(rfp->fp_suspended)756 1650 A
2448(==)S
(NOT_SUSPENDED)546 2574 A
3162(||)S
(rfp->fp_revived)630 3288 A
3960(==)S
(REVIVING\)return;)672 4086 A
4095 V
(26161)210 1122 A
4185 V
(26162)210 1122 A
1524(/*)S
(The)126 1650 A
('reviving')420 1818 A
(flag)168 2280 A
(only)168 2490 A
(applies)294 2700 A
3036(to)S
(pipes.)252 3162 A
(Processes)378 3498 A
(waiting)294 3918 A
(for)126 4254 A
(TTY)126 4422 A
(get)126 4590 A
4275 V
(26163)210 1122 A
1566(*)S
1650(a)S
(message)294 1734 A
(right)210 2070 A
(away.)210 2322 A
(The)126 2616 A
(revival)294 2784 A
(process)294 3120 A
3456(is)S
(different)378 3582 A
(for)126 4002 A
(TTY)126 4170 A
(and)126 4338 A
(pipes.)252 4506 A
4365 V
(26164)210 1122 A
1566(*)S
(For)126 1650 A
(select)252 1818 A
(and)126 2112 A
(TTY)126 2280 A
(revival,)336 2448 A
(the)126 2826 A
(work)168 2994 A
3204(is)S
(already)294 3330 A
(done,)210 3666 A
(for)126 3918 A
(pipes)210 4086 A
4338(it)S
4464(is)S
(not:)168 4590 A
4455 V
(26165)210 1122 A
1566(*)S
(the)126 1692 A
(proc)168 1860 A
(must)168 2070 A
2280(be)S
(restarted)378 2406 A
2826(so)S
2952(it)S
(can)126 3078 A
(try)126 3246 A
(again.)252 3414 A
4545 V
(26166)210 1122 A
1566(*/)S
4635 V
(26167)210 1122 A
(task)168 1524 A
1734(=)S
(-rfp->fp_task;)588 1818 A
4725 V
(26168)210 1122 A
1524(if)S
(\(task)210 1650 A
1902(==)S
(XPIPE)210 2028 A
2280(||)S
(task)168 2406 A
2616(==)S
(XLOCK\))252 2742 A
3036({)S
4815 V
(26169)210 1122 A
1776(/*)S
(Revive)252 1902 A
2196(a)S
(process)294 2280 A
(suspended)378 2616 A
3036(on)S
3162(a)S
(pipe)168 3246 A
3456(or)S
(lock.)210 3582 A
3834(*/)S
4905 V
(26170)210 1122 A
(rfp->fp_revived)630 1776 A
2448(=)S
(REVIVING;)378 2532 A
4995 V
(26171)210 1122 A
(reviving++;)462 1776 A
2784(/*)S
(process)294 2910 A
(was)126 3246 A
(waiting)294 3414 A
3750(on)S
(pipe)168 3876 A
4086(or)S
(lock)168 4212 A
4422(*/)S
5085 V
(26172)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
5175 V
(26173)210 1122 A
(rfp->fp_suspended)714 1776 A
2532(=)S
(NOT_SUSPENDED;)588 2616 A
5265 V
(26174)210 1122 A
1776(if)S
(\(task)210 1902 A
2154(==)S
(XPOPEN\))294 2280 A
2616(/*)S
(process)294 2742 A
(blocked)294 3078 A
3414(in)S
(open)168 3540 A
3750(or)S
(create)252 3876 A
4170(*/)S
5355 V
(26175)210 1122 A
(reply\(proc_nr,)588 2112 A
(rfp->fp_fd>>8\);)630 2742 A
5445 V
(26176)210 1122 A
(else)168 1776 A
1986(if)S
(\(task)210 2112 A
2364(==)S
(XSELECT\))336 2490 A
2868({)S
5535 V
(26177)210 1122 A
(reply\(proc_nr,)588 2112 A
(returned\);)420 2742 A
5625 V
(26178)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
5715 V
(26179)210 1122 A
2112(/*)S
(Revive)252 2238 A
2532(a)S
(process)294 2616 A
(suspended)378 2952 A
3372(on)S
(TTY)126 3498 A
3666(or)S
(other)210 3792 A
(device.)294 4044 A
4380(*/)S
5805 V
(26180)210 1122 A
(rfp->fp_nbytes)588 2112 A
2742(=)S
(returned;)378 2826 A
(/*pretend)378 3456 A
3876(it)S
(wants)210 4002 A
(only)168 4254 A
(what)168 4464 A
(there)210 4674 A
(is*/)168 4926 A
5895 V
(26181)210 1122 A
(reply\(proc_nr,)588 2112 A
(returned\);)420 2742 A
3456(/*)S
(unblock)294 3582 A
(the)126 3918 A
(process)294 4086 A
4422(*/)S
5985 V
(26182)210 1122 A
1776(})S
6075 V
(26183)210 1122 A
1524(})S
6165 V
(26184)210 1122 A
1440(})S
6345 V
(26186)210 1122 A
(/*===========================================================================*)3276 1440 A
6435 V
(26187)210 1122 A
1482(*)S
(do_unpause)420 2784 A
4674(*)S
6525 V
(26188)210 1122 A
(*===========================================================================*/)3276 1482 A
6615 V
(26189)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_unpause\(\))504 1902 A
6705 V
(26190)210 1122 A
1440({)S
6795 V
(26191)210 1122 A
1440(/*)S
1566(A)S
(signal)252 1650 A
(has)126 1944 A
(been)168 2112 A
(sent)168 2322 A
2532(to)S
2658(a)S
(user)168 2742 A
(who)126 2952 A
3120(is)S
(paused)252 3246 A
3540(on)S
(the)126 3666 A
(file)168 3834 A
(system.)294 4044 A
6885 V
(26192)210 1122 A
1482(*)S
(Abort)210 1566 A
(the)126 1818 A
(system)252 1986 A
(call)168 2280 A
(with)168 2490 A
(the)126 2700 A
(EINTR)210 2868 A
(error)210 3120 A
(message.)336 3372 A
6975 V
(26193)210 1122 A
1482(*/)S
7065 V
(26194)210 1122 A
8418 V
EP
%%Page: 354 354
BP
/slant 0 def
/height 0 def
1485 V
12 B
(354)180 1080 A
11 R
2400(File:)S
2633(servers/fs/pipe.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(26195)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(fproc)210 2196 A
(*rfp;)210 2448 A
1845 V
(26196)210 1122 A
(int)126 1524 A
(proc_nr,)336 1692 A
(task,)210 2070 A
(fild;)210 2322 A
1935 V
(26197)210 1122 A
(struct)252 1524 A
(filp)168 1818 A
(*f;)126 2028 A
2025 V
(26198)210 1122 A
(dev_t)210 1524 A
(dev;)168 1776 A
2115 V
(26199)210 1122 A
(message)294 1524 A
(mess;)210 1860 A
2205 V
(26200)210 1122 A
2295 V
(26201)210 1122 A
1524(if)S
(\(who)168 1650 A
1860(>)S
(PM_PROC_NR\))462 1944 A
(return\(EPERM\);)588 2448 A
2385 V
(26202)210 1122 A
(proc_nr)294 1524 A
1860(=)S
(m_in.pro;)378 1944 A
2475 V
(26203)210 1122 A
1524(if)S
(\(proc_nr)336 1650 A
2028(<)S
2112(0)S
2196(||)S
(proc_nr)294 2322 A
2658(>=)S
(NR_PROCS\))378 2784 A
2565 V
(26204)210 1122 A
(panic\(__FILE__,"unpause)966 1776 A
(err)126 2784 A
(1",)126 2952 A
(proc_nr\);)378 3120 A
2655 V
(26205)210 1122 A
(rfp)126 1524 A
1692(=)S
(&fproc[proc_nr];)672 1776 A
2745 V
(26206)210 1122 A
1524(if)S
(\(rfp->fp_suspended)756 1650 A
2448(==)S
(NOT_SUSPENDED\))588 2574 A
(return\(OK\);)462 3204 A
2835 V
(26207)210 1122 A
(task)168 1524 A
1734(=)S
(-rfp->fp_task;)588 1818 A
2925 V
(26208)210 1122 A
3015 V
(26209)210 1122 A
(switch)252 1524 A
(\(task\))252 1818 A
2112({)S
3105 V
(26210)210 1122 A
(case)168 1776 A
(XPIPE:)252 1986 A
2784(/*)S
(process)294 2910 A
(trying)252 3246 A
3540(to)S
(read)168 3666 A
3876(or)S
(write)210 4002 A
4254(a)S
(pipe)168 4338 A
4548(*/)S
3195 V
(26211)210 1122 A
(break;)252 2112 A
3285 V
(26212)210 1122 A
3375 V
(26213)210 1122 A
(case)168 1776 A
(XLOCK:)252 1986 A
2784(/*)S
(process)294 2910 A
(trying)252 3246 A
3540(to)S
(set)126 3666 A
3834(a)S
(lock)168 3918 A
(with)168 4128 A
(FCNTL)210 4338 A
4590(*/)S
3465 V
(26214)210 1122 A
(break;)252 2112 A
3555 V
(26215)210 1122 A
3645 V
(26216)210 1122 A
(case)168 1776 A
(XSELECT:)336 1986 A
2784(/*)S
(process)294 2910 A
(blocking)336 3246 A
3624(on)S
(select\(\))336 3750 A
4128(*/)S
3735 V
(26217)210 1122 A
(select_forget\(proc_nr\);)966 2112 A
3825 V
(26218)210 1122 A
(break;)252 2112 A
3915 V
(26219)210 1122 A
4005 V
(26220)210 1122 A
(case)168 1776 A
(XPOPEN:)294 1986 A
2784(/*)S
(process)294 2910 A
(trying)252 3246 A
3540(to)S
(open)168 3666 A
3876(a)S
(fifo)168 3960 A
4170(*/)S
4095 V
(26221)210 1122 A
(break;)252 2112 A
4185 V
(26222)210 1122 A
4275 V
(26223)210 1122 A
(default:)336 1776 A
2784(/*)S
(process)294 2910 A
(trying)252 3246 A
3540(to)S
3666(do)S
(device)252 3792 A
(I/O)126 4086 A
(\(e.g.)210 4254 A
(tty\)*/)252 4506 A
4365 V
(26224)210 1122 A
(fild)168 2112 A
2322(=)S
(\(rfp->fp_fd)462 2406 A
2910(>>)S
3036(8\))S
3162(&)S
(BYTE;/*)294 3246 A
(extract)294 3582 A
(file)168 3918 A
(descriptor)420 4128 A
4590(*/)S
4455 V
(26225)210 1122 A
2112(if)S
(\(fild)210 2238 A
2490(<)S
2574(0)S
2658(||)S
(fild)168 2784 A
2994(>=)S
(OPEN_MAX\))378 3120 A
4545 V
(26226)210 1122 A
(panic\(__FILE__,"unpause)966 2448 A
(err)126 3456 A
(2",NO_NUM\);)462 3624 A
4635 V
(26227)210 1122 A
2112(f)S
2196(=)S
(rfp->fp_filp[fild];)798 2280 A
4725 V
(26228)210 1122 A
(dev)126 2112 A
2280(=)S
(\(dev_t\))294 2364 A
(f->filp_ino->i_zone[0];)966 2700 A
3792(/*)S
(device)252 3918 A
(hung)168 4212 A
4422(on)S
4548(*/)S
4815 V
(26229)210 1122 A
(mess.TTY_LINE)546 2112 A
2700(=)S
(\(dev)168 2784 A
2994(>>)S
(MINOR\))252 3120 A
3414(&)S
(BYTE;)210 3498 A
4905 V
(26230)210 1122 A
(mess.PROC_NR)504 2112 A
2658(=)S
(proc_nr;)336 2742 A
4995 V
(26231)210 1122 A
5085 V
(26232)210 1122 A
2112(/*)S
(Tell)168 2238 A
(kernel)252 2448 A
2742(R)S
2826(or)S
2952(W.)S
(Mode)168 3078 A
3288(is)S
(from)168 3414 A
(current)294 3624 A
(call,)210 3960 A
(not)126 4212 A
(open.)210 4380 A
4632(*/)S
5175 V
(26233)210 1122 A
(mess.COUNT)420 2112 A
2574(=)S
(\(rfp->fp_fd)462 2658 A
3162(&)S
(BYTE\))210 3246 A
3498(==)S
(READ)168 3624 A
3834(?)S
(R_BIT)210 3918 A
4170(:)S
(W_BIT;)252 4254 A
5265 V
(26234)210 1122 A
(mess.m_type)462 2112 A
2616(=)S
(CANCEL;)294 2700 A
5355 V
(26235)210 1122 A
2112(fp)S
2238(=)S
(rfp;)168 2322 A
2784(/*)S
(hack)168 2910 A
3120(-)S
(ctty_io)294 3204 A
(uses)168 3540 A
3750(fp)S
3876(*/)S
5445 V
(26236)210 1122 A
(\(*dmap[\(dev)462 2112 A
2616(>>)S
(MAJOR\))252 2742 A
3036(&)S
(BYTE].dmap_io\)\(task,)840 3120 A
(&mess\);)294 4002 A
5535 V
(26237)210 1122 A
1524(})S
5625 V
(26238)210 1122 A
5715 V
(26239)210 1122 A
(rfp->fp_suspended)714 1524 A
2280(=)S
(NOT_SUSPENDED;)588 2364 A
5805 V
(26240)210 1122 A
(reply\(proc_nr,)588 1524 A
(EINTR\);)294 2154 A
2784(/*)S
(signal)252 2910 A
(interrupted)462 3204 A
(call)168 3708 A
3918(*/)S
5895 V
(26241)210 1122 A
(return\(OK\);)462 1524 A
5985 V
(26242)210 1122 A
1440(})S
6165 V
(26244)210 1122 A
(/*===========================================================================*)3276 1440 A
6255 V
(26245)210 1122 A
1482(*)S
(select_request_pipe)798 2784 A
4674(*)S
6345 V
(26246)210 1122 A
(*===========================================================================*/)3276 1482 A
6435 V
(26247)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(select_request_pipe\(struct)1092 1902 A
(filp)168 3036 A
(*f,)126 3246 A
(int)126 3414 A
(*ops,)210 3582 A
(int)126 3834 A
(block\))252 4002 A
6525 V
(26248)210 1122 A
1440({)S
6615 V
(26249)210 1122 A
(int)126 1776 A
(orig_ops,)378 1944 A
2364(r)S
2448(=)S
2532(0,)S
(err,)168 2658 A
(canwrite;)378 2868 A
6705 V
(26250)210 1122 A
(orig_ops)336 1776 A
2154(=)S
(*ops;)210 2238 A
6795 V
(26251)210 1122 A
1776(if)S
(\(\(*ops)252 1902 A
2196(&)S
(SEL_RD\)\))336 2280 A
2658({)S
6885 V
(26252)210 1122 A
2112(if)S
(\(\(err)210 2238 A
2490(=)S
(pipe_check\(f->filp_ino,)966 2574 A
(READING,)336 3582 A
3960(0,)S
6975 V
(26253)210 1122 A
2448(1,)S
(f->filp_pos,)504 2574 A
(&canwrite,)420 3120 A
(1\)\))126 3582 A
3750(!=)S
(SUSPEND\))336 3876 A
7065 V
(26254)210 1122 A
2448(r)S
2532(|=)S
(SEL_RD;)294 2658 A
8418 V
EP
%%Page: 355 355
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2400(File:)S
2633(servers/fs/pipe.c)S
12 B
(355)180 4500 A
1755 V
7 LST
(26255)210 1122 A
2112(if)S
(\(err)168 2238 A
2448(<)S
2532(0)S
2616(&&)S
(err)126 2742 A
2910(!=)S
(SUSPEND)294 3036 A
3372(&&)S
(\(*ops)210 3498 A
3750(&)S
(SEL_ERR\)\))378 3834 A
1845 V
(26256)210 1122 A
2448(r)S
2532(|=)S
(SEL_ERR;)336 2658 A
1935 V
(26257)210 1122 A
1776(})S
2025 V
(26258)210 1122 A
1776(if)S
(\(\(*ops)252 1902 A
2196(&)S
(SEL_WR\)\))336 2280 A
2658({)S
2115 V
(26259)210 1122 A
2112(if)S
(\(\(err)210 2238 A
2490(=)S
(pipe_check\(f->filp_ino,)966 2574 A
(WRITING,)336 3582 A
3960(0,)S
2205 V
(26260)210 1122 A
2448(1,)S
(f->filp_pos,)504 2574 A
(&canwrite,)420 3120 A
(1\)\))126 3582 A
3750(!=)S
(SUSPEND\))336 3876 A
2295 V
(26261)210 1122 A
2448(r)S
2532(|=)S
(SEL_WR;)294 2658 A
2385 V
(26262)210 1122 A
2112(if)S
(\(err)168 2238 A
2448(<)S
2532(0)S
2616(&&)S
(err)126 2742 A
2910(!=)S
(SUSPEND)294 3036 A
3372(&&)S
(\(*ops)210 3498 A
3750(&)S
(SEL_ERR\)\))378 3834 A
2475 V
(26263)210 1122 A
2448(r)S
2532(|=)S
(SEL_ERR;)336 2658 A
2565 V
(26264)210 1122 A
1776(})S
2655 V
(26265)210 1122 A
2745 V
(26266)210 1122 A
(*ops)168 1776 A
1986(=)S
2070(r;)S
2835 V
(26267)210 1122 A
2925 V
(26268)210 1122 A
1776(if)S
(\(!r)126 1902 A
2070(&&)S
(block\))252 2196 A
2490({)S
3015 V
(26269)210 1122 A
(f->filp_pipe_select_ops)966 2112 A
3120(|=)S
(orig_ops;)378 3246 A
3105 V
(26270)210 1122 A
1776(})S
3195 V
(26271)210 1122 A
3285 V
(26272)210 1122 A
(return)252 1776 A
(SEL_OK;)294 2070 A
3375 V
(26273)210 1122 A
1440(})S
3555 V
(26275)210 1122 A
(/*===========================================================================*)3276 1440 A
3645 V
(26276)210 1122 A
1482(*)S
(select_match_pipe)714 2784 A
4674(*)S
3735 V
(26277)210 1122 A
(*===========================================================================*/)3276 1482 A
3825 V
(26278)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(select_match_pipe\(struct)1008 1902 A
(filp)168 2952 A
(*f\))126 3162 A
3915 V
(26279)210 1122 A
1440({)S
4005 V
(26280)210 1122 A
1776(/*)S
(recognize)378 1902 A
(either)252 2322 A
(pipe)168 2616 A
2826(or)S
(named)210 2952 A
(pipe)168 3204 A
(\(FIFO\))252 3414 A
3708(*/)S
4095 V
(26281)210 1122 A
1776(if)S
1902(\(f)S
2028(&&)S
(f->filp_ino)462 2154 A
2658(&&)S
(\(f->filp_ino->i_mode)840 2784 A
3666(&)S
(I_NAMED_PIPE\)\))588 3750 A
4185 V
(26282)210 1122 A
(return)252 2112 A
2406(1;)S
4275 V
(26283)210 1122 A
(return)252 1776 A
2070(0;)S
4365 V
(26284)210 1122 A
1440(})S
4995 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5085 V
(servers/fs/path.c)714 2676 A
5175 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5355 V
(26300)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(procedures)420 2532 A
(that)168 2994 A
(look)168 3204 A
3414(up)S
(path)168 3540 A
(names)210 3750 A
4002(in)S
(the)126 4128 A
(directory)378 4296 A
5445 V
(26301)210 1122 A
1482(*)S
(system)252 1566 A
(and)126 1860 A
(determine)378 2028 A
(the)126 2448 A
(inode)210 2616 A
(number)252 2868 A
(that)168 3162 A
(goes)168 3372 A
(with)168 3582 A
3792(a)S
(given)210 3876 A
(path)168 4128 A
(name.)210 4338 A
5535 V
(26302)210 1122 A
1482(*)S
5625 V
(26303)210 1122 A
1482(*)S
(The)126 1608 A
(entry)210 1776 A
(points)252 2028 A
(into)168 2322 A
(this)168 2532 A
(file)168 2742 A
(are)126 2952 A
5715 V
(26304)210 1122 A
1482(*)S
(eat_path:)378 1650 A
(the)126 2154 A
('main')252 2322 A
(routine)294 2616 A
2952(of)S
(the)126 3078 A
(path-to-inode)546 3246 A
(conversion)420 3834 A
(mechanism)378 4296 A
5805 V
(26305)210 1122 A
1482(*)S
(last_dir:)378 1650 A
(find)168 2154 A
(the)126 2364 A
(final)210 2532 A
(directory)378 2784 A
3204(on)S
3330(a)S
(given)210 3414 A
(path)168 3666 A
5895 V
(26306)210 1122 A
1482(*)S
(advance:)336 1650 A
(parse)210 2154 A
(one)126 2406 A
(component)378 2574 A
2994(of)S
3120(a)S
(path)168 3204 A
(name)168 3414 A
5985 V
(26307)210 1122 A
1482(*)S
(search_dir:)462 1650 A
(search)252 2154 A
2448(a)S
(directory)378 2532 A
(for)126 2952 A
3120(a)S
(string)252 3204 A
(and)126 3498 A
(return)252 3666 A
(its)126 3960 A
(inode)210 4128 A
(number)252 4380 A
6075 V
(26308)210 1122 A
1482(*/)S
6165 V
(26309)210 1122 A
6255 V
(26310)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
6345 V
(26311)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
6435 V
(26312)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
6525 V
(26313)210 1122 A
(#include)336 1440 A
("buf.h")294 1818 A
6615 V
(26314)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
6705 V
(26315)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
6795 V
(26316)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
6885 V
(26317)210 1122 A
(#include)336 1440 A
("super.h")378 1818 A
6975 V
(26318)210 1122 A
7065 V
(26319)210 1122 A
(PUBLIC)252 1440 A
(char)168 1734 A
(dot1[2])294 1944 A
2280(=)S
(".";)168 2364 A
2784(/*)S
(used)168 2910 A
(for)126 3120 A
(search_dir)420 3288 A
3750(to)S
(bypass)252 3876 A
(the)126 4170 A
(access)252 4338 A
4632(*/)S
8418 V
EP
%%Page: 356 356
BP
/slant 0 def
/height 0 def
1485 V
12 B
(356)180 1080 A
11 R
2400(File:)S
2633(servers/fs/path.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(26320)210 1122 A
(PUBLIC)252 1440 A
(char)168 1734 A
(dot2[3])294 1944 A
2280(=)S
("..";)210 2364 A
2784(/*)S
(permissions)462 2910 A
(for)126 3414 A
3582(.)S
(and)126 3666 A
3834(..)S
4632(*/)S
1845 V
(26321)210 1122 A
1935 V
(26322)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(char)168 2280 A
(*get_name,)420 2490 A
(\(char)210 2952 A
(*old_name,)420 3204 A
(char)168 3666 A
(string)252 3876 A
([NAME_MAX]\))462 4170 A
4674(\);)S
2025 V
(26323)210 1122 A
2115 V
(26324)210 1122 A
(/*===========================================================================*)3276 1440 A
2205 V
(26325)210 1122 A
1482(*)S
(eat_path)336 2784 A
4674(*)S
2295 V
(26326)210 1122 A
(*===========================================================================*/)3276 1482 A
2385 V
(26327)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(inode)210 2028 A
(*eat_path\(path\))630 2280 A
2475 V
(26328)210 1122 A
(char)168 1440 A
(*path;)252 1650 A
2784(/*)S
(the)126 2910 A
(path)168 3078 A
(name)168 3288 A
3498(to)S
3624(be)S
(parsed)252 3750 A
4044(*/)S
2565 V
(26329)210 1122 A
1440({)S
2655 V
(26330)210 1122 A
1440(/*)S
(Parse)210 1566 A
(the)126 1818 A
(path)168 1986 A
('path')252 2196 A
(and)126 2490 A
(put)126 2658 A
(its)126 2826 A
(inode)210 2994 A
3246(in)S
(the)126 3372 A
(inode)210 3540 A
(table.)252 3792 A
4086(If)S
(not)126 4212 A
(possible,)378 4380 A
2745 V
(26331)210 1122 A
1482(*)S
(return)252 1566 A
(NIL_INODE)378 1860 A
2280(as)S
(function)336 2406 A
(value)210 2784 A
(and)126 3036 A
3204(an)S
(error)210 3330 A
(code)168 3582 A
3792(in)S
('err_code'.)462 3918 A
2835 V
(26332)210 1122 A
1482(*/)S
2925 V
(26333)210 1122 A
3015 V
(26334)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*ldip,)252 2448 A
(*rip;)210 2742 A
3105 V
(26335)210 1122 A
(char)168 1524 A
(string[NAME_MAX];)714 1734 A
2784(/*)S
(hold)168 2910 A
3120(1)S
(path)168 3204 A
(component)378 3414 A
(name)168 3834 A
(here)168 4044 A
4254(*/)S
3195 V
(26336)210 1122 A
3285 V
(26337)210 1122 A
1524(/*)S
(First)210 1650 A
(open)168 1902 A
(the)126 2112 A
(path)168 2280 A
(down)168 2490 A
2700(to)S
(the)126 2826 A
(final)210 2994 A
(directory.)420 3246 A
3708(*/)S
3375 V
(26338)210 1122 A
1524(if)S
1650(\()S
(\(ldip)210 1734 A
1986(=)S
(last_dir\(path,)588 2070 A
(string\)\))336 2700 A
3078(==)S
(NIL_INODE\))420 3204 A
3666({)S
3465 V
(26339)210 1122 A
(return\(NIL_INODE\);)756 1776 A
2784(/*)S
2910(we)S
(couldn't)336 3036 A
(open)168 3414 A
(final)210 3624 A
(directory)378 3876 A
4296(*/)S
3555 V
(26340)210 1122 A
1776(})S
3645 V
(26341)210 1122 A
3735 V
(26342)210 1122 A
1524(/*)S
(The)126 1650 A
(path)168 1818 A
(consisting)420 2028 A
(only)168 2490 A
2700(of)S
("/")126 2826 A
2994(is)S
3120(a)S
(special)294 3204 A
(case,)210 3540 A
(check)210 3792 A
(for)126 4044 A
(it.)126 4212 A
4380(*/)S
3825 V
(26343)210 1122 A
1524(if)S
(\(string[0])420 1650 A
2112(==)S
('\\0'\))210 2238 A
(return\(ldip\);)546 2490 A
3915 V
(26344)210 1122 A
4005 V
(26345)210 1122 A
1524(/*)S
(Get)126 1650 A
(final)210 1818 A
(component)378 2070 A
2490(of)S
(the)126 2616 A
(path.)210 2784 A
3036(*/)S
4095 V
(26346)210 1122 A
(rip)126 1524 A
1692(=)S
(advance\(ldip,)546 1776 A
(string\);)336 2364 A
4185 V
(26347)210 1122 A
(put_inode\(ldip\);)672 1524 A
4275 V
(26348)210 1122 A
(return\(rip\);)504 1524 A
4365 V
(26349)210 1122 A
1440(})S
4545 V
(26351)210 1122 A
(/*===========================================================================*)3276 1440 A
4635 V
(26352)210 1122 A
1482(*)S
(last_dir)336 2784 A
4674(*)S
4725 V
(26353)210 1122 A
(*===========================================================================*/)3276 1482 A
4815 V
(26354)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(inode)210 2028 A
(*last_dir\(path,)630 2280 A
(string\))294 2952 A
4905 V
(26355)210 1122 A
(char)168 1440 A
(*path;)252 1650 A
2784(/*)S
(the)126 2910 A
(path)168 3078 A
(name)168 3288 A
3498(to)S
3624(be)S
(parsed)252 3750 A
4044(*/)S
4995 V
(26356)210 1122 A
(char)168 1440 A
(string[NAME_MAX];)714 1650 A
2784(/*)S
(the)126 2910 A
(final)210 3078 A
(component)378 3330 A
3750(is)S
(returned)336 3876 A
(here)168 4254 A
4464(*/)S
5085 V
(26357)210 1122 A
1440({)S
5175 V
(26358)210 1122 A
1440(/*)S
(Given)210 1566 A
1818(a)S
(path,)210 1902 A
('path',)294 2154 A
(located)294 2490 A
2826(in)S
(the)126 2952 A
3120(fs)S
(address)294 3246 A
(space,)252 3582 A
(parse)210 3876 A
4128(it)S
4254(as)S
5265 V
(26359)210 1122 A
1482(*)S
(far)126 1566 A
1734(as)S
(the)126 1860 A
(last)168 2028 A
(directory,)420 2238 A
(fetch)210 2700 A
(the)126 2952 A
(inode)210 3120 A
(for)126 3372 A
(the)126 3540 A
(last)168 3708 A
(directory)378 3918 A
(into)168 4338 A
5355 V
(26360)210 1122 A
1482(*)S
(the)126 1566 A
(inode)210 1734 A
(table,)252 1986 A
(and)126 2280 A
(return)252 2448 A
2742(a)S
(pointer)294 2826 A
3162(to)S
(the)126 3288 A
(inode.)252 3456 A
3792(In)S
5445 V
(26361)210 1122 A
1482(*)S
(addition,)378 1566 A
(return)252 1986 A
(the)126 2280 A
(final)210 2448 A
(component)378 2700 A
3120(of)S
(the)126 3246 A
(path)168 3414 A
3624(in)S
('string'.)378 3750 A
5535 V
(26362)210 1122 A
1482(*)S
1566(If)S
(the)126 1692 A
(last)168 1860 A
(directory)378 2070 A
(can't)210 2490 A
2742(be)S
(opened,)294 2868 A
(return)252 3204 A
(NIL_INODE)378 3498 A
(and)126 3918 A
5625 V
(26363)210 1122 A
1482(*)S
(the)126 1566 A
(reason)252 1734 A
(for)126 2028 A
(failure)294 2196 A
2532(in)S
('err_code'.)462 2658 A
5715 V
(26364)210 1122 A
1482(*/)S
5805 V
(26365)210 1122 A
5895 V
(26366)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
5985 V
(26367)210 1122 A
(register)336 1524 A
(char)168 1902 A
(*new_name;)420 2112 A
6075 V
(26368)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*new_ip;)336 2448 A
6165 V
(26369)210 1122 A
6255 V
(26370)210 1122 A
1524(/*)S
1650(Is)S
(the)126 1776 A
(path)168 1944 A
(absolute)336 2154 A
2532(or)S
(relative?)378 2658 A
(Initialize)420 3120 A
('rip')210 3582 A
(accordingly.)504 3834 A
4380(*/)S
6345 V
(26371)210 1122 A
(rip)126 1524 A
1692(=)S
(\(*path)252 1776 A
2070(==)S
('/')126 2196 A
2364(?)S
(fp->fp_rootdir)588 2448 A
3078(:)S
(fp->fp_workdir\);)672 3162 A
6435 V
(26372)210 1122 A
6525 V
(26373)210 1122 A
1524(/*)S
1650(If)S
(dir)126 1776 A
(has)126 1944 A
(been)168 2112 A
(removed)294 2322 A
2658(or)S
(path)168 2784 A
2994(is)S
(empty,)252 3120 A
(return)252 3414 A
(ENOENT.)294 3708 A
4044(*/)S
6615 V
(26374)210 1122 A
1524(if)S
(\(rip->i_nlinks)588 1650 A
2280(==)S
2406(0)S
2490(||)S
(*path)210 2616 A
2868(==)S
('\\0'\))210 2994 A
3246({)S
6705 V
(26375)210 1122 A
(err_code)336 1776 A
2154(=)S
(ENOENT;)294 2238 A
6795 V
(26376)210 1122 A
(return\(NIL_INODE\);)756 1776 A
6885 V
(26377)210 1122 A
1524(})S
6975 V
(26378)210 1122 A
7065 V
(26379)210 1122 A
(dup_inode\(rip\);)630 1524 A
2784(/*)S
(inode)210 2910 A
(will)168 3162 A
3372(be)S
(returned)336 3498 A
(with)168 3876 A
(put_inode)378 4086 A
4506(*/)S
8418 V
EP
%%Page: 357 357
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2400(File:)S
2633(servers/fs/path.c)S
12 B
(357)180 4500 A
1755 V
7 LST
(26380)210 1122 A
1845 V
(26381)210 1122 A
1524(/*)S
(Scan)168 1650 A
(the)126 1860 A
(path)168 2028 A
(component)378 2238 A
2658(by)S
(component.)420 2784 A
3246(*/)S
1935 V
(26382)210 1122 A
(while)210 1524 A
(\(TRUE\))252 1776 A
2070({)S
2025 V
(26383)210 1122 A
1776(/*)S
(Extract)294 1902 A
(one)126 2238 A
(component.)420 2406 A
2868(*/)S
2115 V
(26384)210 1122 A
1776(if)S
1902(\()S
(\(new_name)378 1986 A
2406(=)S
(get_name\(path,)588 2490 A
(string\)\))336 3120 A
3498(==)S
(\(char*\))294 3624 A
3960(0\))S
4086({)S
2205 V
(26385)210 1122 A
(put_inode\(rip\);)630 2112 A
2784(/*)S
(bad)126 2910 A
(path)168 3078 A
3288(in)S
(user)168 3414 A
(space)210 3624 A
3876(*/)S
2295 V
(26386)210 1122 A
(return\(NIL_INODE\);)756 2112 A
2385 V
(26387)210 1122 A
1776(})S
2475 V
(26388)210 1122 A
1776(if)S
(\(*new_name)420 1902 A
2364(==)S
('\\0'\))210 2490 A
2742({)S
2565 V
(26389)210 1122 A
2112(if)S
2238(\()S
(\(rip->i_mode)504 2322 A
2868(&)S
(I_TYPE\))294 2952 A
3288(==)S
(I_DIRECTORY\))504 3414 A
3960({)S
2655 V
(26390)210 1122 A
(return\(rip\);)504 2448 A
3120(/*)S
(normal)252 3246 A
(exit)168 3540 A
3750(*/)S
2745 V
(26391)210 1122 A
2112(})S
(else)168 2196 A
2406({)S
2835 V
(26392)210 1122 A
2448(/*)S
(last)168 2574 A
(file)168 2784 A
2994(of)S
(path)168 3120 A
(prefix)252 3330 A
3624(is)S
(not)126 3750 A
3918(a)S
(directory)378 4002 A
4422(*/)S
2925 V
(26393)210 1122 A
(put_inode\(rip\);)630 2448 A
3015 V
(26394)210 1122 A
(err_code)336 2448 A
2826(=)S
(ENOTDIR;)336 2910 A
3105 V
(26395)210 1122 A
(return\(NIL_INODE\);)756 2448 A
3195 V
(26396)210 1122 A
2112(})S
3285 V
(26397)210 1122 A
1776(})S
3375 V
(26398)210 1122 A
3465 V
(26399)210 1122 A
1776(/*)S
(There)210 1902 A
2154(is)S
(more)168 2280 A
(path.)210 2490 A
(Keep)168 2784 A
(parsing.)336 2994 A
3372(*/)S
3555 V
(26400)210 1122 A
(new_ip)252 1776 A
2070(=)S
(advance\(rip,)504 2154 A
(string\);)336 2700 A
3645 V
(26401)210 1122 A
(put_inode\(rip\);)630 1776 A
2784(/*)S
(rip)126 2910 A
(either)252 3078 A
(obsolete)336 3372 A
3750(or)S
(irrelevant)420 3876 A
4338(*/)S
3735 V
(26402)210 1122 A
1776(if)S
(\(new_ip)294 1902 A
2238(==)S
(NIL_INODE\))420 2364 A
(return\(NIL_INODE\);)756 2826 A
3825 V
(26403)210 1122 A
3915 V
(26404)210 1122 A
1776(/*)S
(The)126 1902 A
(call)168 2070 A
2280(to)S
(advance\(\))378 2406 A
(succeeded.)420 2826 A
(Fetch)210 3330 A
(next)168 3582 A
(component.)420 3792 A
4254(*/)S
4005 V
(26405)210 1122 A
(path)168 1776 A
1986(=)S
(new_name;)378 2070 A
4095 V
(26406)210 1122 A
(rip)126 1776 A
1944(=)S
(new_ip;)294 2028 A
4185 V
(26407)210 1122 A
1524(})S
4275 V
(26408)210 1122 A
1440(})S
4455 V
(26410)210 1122 A
(/*===========================================================================*)3276 1440 A
4545 V
(26411)210 1122 A
1482(*)S
(get_name)336 2784 A
4674(*)S
4635 V
(26412)210 1122 A
(*===========================================================================*/)3276 1482 A
4725 V
(26413)210 1122 A
(PRIVATE)294 1440 A
(char)168 1776 A
(*get_name\(old_name,)798 1986 A
(string\))294 2826 A
4815 V
(26414)210 1122 A
(char)168 1440 A
(*old_name;)420 1650 A
2784(/*)S
(path)168 2910 A
(name)168 3120 A
3330(to)S
(parse)210 3456 A
3708(*/)S
4905 V
(26415)210 1122 A
(char)168 1440 A
(string[NAME_MAX];)714 1650 A
2784(/*)S
(component)378 2910 A
(extracted)378 3330 A
(from)168 3750 A
('old_name')420 3960 A
4422(*/)S
4995 V
(26416)210 1122 A
1440({)S
5085 V
(26417)210 1122 A
1440(/*)S
(Given)210 1566 A
1818(a)S
(pointer)294 1902 A
2238(to)S
2364(a)S
(path)168 2448 A
(name)168 2658 A
2868(in)S
2994(fs)S
(space,)252 3120 A
('old_name',)462 3414 A
(copy)168 3918 A
(the)126 4128 A
(next)168 4296 A
5175 V
(26418)210 1122 A
1482(*)S
(component)378 1566 A
1986(to)S
('string')336 2112 A
(and)126 2490 A
(pad)126 2658 A
(with)168 2826 A
(zeros.)252 3036 A
3372(A)S
(pointer)294 3456 A
3792(to)S
(that)168 3918 A
(part)168 4128 A
4338(of)S
5265 V
(26419)210 1122 A
1482(*)S
(the)126 1566 A
(name)168 1734 A
1944(as)S
(yet)126 2070 A
(unparsed)336 2238 A
2616(is)S
(returned.)378 2742 A
(Roughly)294 3204 A
(speaking,)378 3540 A
5355 V
(26420)210 1122 A
1482(*)S
('get_name')420 1566 A
2028(=)S
('old_name')420 2112 A
2574(-)S
('string'.)378 2658 A
5445 V
(26421)210 1122 A
1482(*)S
5535 V
(26422)210 1122 A
1482(*)S
(This)168 1566 A
(routine)294 1776 A
(follows)294 2112 A
(the)126 2448 A
(standard)336 2616 A
(convention)420 2994 A
(that)168 3456 A
(/usr/ast,)378 3666 A
(/usr//ast,)420 4086 A
5625 V
(26423)210 1122 A
1482(*)S
(//usr///ast)462 1566 A
(and)126 2070 A
(/usr/ast/)378 2238 A
(are)126 2658 A
(all)126 2826 A
(equivalent.)462 2994 A
5715 V
(26424)210 1122 A
1482(*/)S
5805 V
(26425)210 1122 A
5895 V
(26426)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(c;)S
5985 V
(26427)210 1122 A
(register)336 1524 A
(char)168 1902 A
(*np,)168 2112 A
(*rnp;)210 2322 A
6075 V
(26428)210 1122 A
6165 V
(26429)210 1122 A
1524(np)S
1650(=)S
(string;)294 1734 A
2784(/*)S
('np')168 2910 A
(points)252 3120 A
3414(to)S
(current)294 3540 A
(position)336 3876 A
4254(*/)S
6255 V
(26430)210 1122 A
(rnp)126 1524 A
1692(=)S
(old_name;)378 1776 A
2784(/*)S
('rnp')210 2910 A
(points)252 3162 A
3456(to)S
(unparsed)336 3582 A
(string)252 3960 A
4254(*/)S
6345 V
(26431)210 1122 A
(while)210 1524 A
1776(\()S
1860(\(c)S
1986(=)S
(*rnp\))210 2070 A
2322(==)S
('/'\))168 2448 A
(rnp++;)252 2658 A
3120(/*)S
(skip)168 3246 A
(leading)294 3456 A
(slashes)294 3792 A
4128(*/)S
6435 V
(26432)210 1122 A
6525 V
(26433)210 1122 A
1524(/*)S
(Copy)168 1650 A
(the)126 1860 A
(unparsed)336 2028 A
(path,)210 2406 A
('old_name',)462 2658 A
3162(to)S
(the)126 3288 A
(array,)252 3456 A
('string'.)378 3750 A
4170(*/)S
6615 V
(26434)210 1122 A
(while)210 1524 A
1776(\()S
(rnp)126 1860 A
2028(<)S
(&old_name[PATH_MAX])798 2112 A
2994(&&)S
3162(c)S
3246(!=)S
('/')126 3372 A
3624(&&)S
3792(c)S
3876(!=)S
('\\0'\))210 4002 A
4254({)S
6705 V
(26435)210 1122 A
1776(if)S
(\(np)126 1902 A
2070(<)S
(&string[NAME_MAX]\))756 2154 A
(*np++)210 2952 A
3204(=)S
3288(c;)S
6795 V
(26436)210 1122 A
1776(c)S
1860(=)S
(*++rnp;)294 1944 A
2784(/*)S
(advance)294 2910 A
3246(to)S
(next)168 3372 A
(character)378 3582 A
4002(*/)S
6885 V
(26437)210 1122 A
1524(})S
6975 V
(26438)210 1122 A
7065 V
(26439)210 1122 A
1524(/*)S
1650(To)S
(make)168 1776 A
(/usr/ast/)378 1986 A
(equivalent)420 2406 A
2868(to)S
(/usr/ast,)378 2994 A
(skip)168 3414 A
(trailing)336 3624 A
(slashes.)336 4002 A
4380(*/)S
8418 V
EP
%%Page: 358 358
BP
/slant 0 def
/height 0 def
1485 V
12 B
(358)180 1080 A
11 R
2400(File:)S
2633(servers/fs/path.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(26440)210 1122 A
(while)210 1524 A
1776(\(c)S
1902(==)S
('/')126 2028 A
2196(&&)S
(rnp)126 2322 A
2490(<)S
(&old_name[PATH_MAX]\))840 2574 A
3456(c)S
3540(=)S
(*++rnp;)294 3624 A
1845 V
(26441)210 1122 A
1935 V
(26442)210 1122 A
1524(if)S
(\(np)126 1650 A
1818(<)S
(&string[NAME_MAX]\))756 1902 A
(*np)126 2700 A
2868(=)S
('\\0';)210 2952 A
3456(/*)S
(Terminate)378 3582 A
(string)252 4002 A
4296(*/)S
2025 V
(26443)210 1122 A
2115 V
(26444)210 1122 A
1524(if)S
(\(rnp)168 1650 A
1860(>=)S
(&old_name[PATH_MAX]\))840 1986 A
2868({)S
2205 V
(26445)210 1122 A
(err_code)336 1776 A
2154(=)S
(ENAMETOOLONG;)546 2238 A
2295 V
(26446)210 1122 A
(return\(\(char)504 1776 A
2322(*\))S
(0\);)126 2448 A
2385 V
(26447)210 1122 A
1524(})S
2475 V
(26448)210 1122 A
(return\(rnp\);)504 1524 A
2565 V
(26449)210 1122 A
1440(})S
2745 V
(26451)210 1122 A
(/*===========================================================================*)3276 1440 A
2835 V
(26452)210 1122 A
1482(*)S
(advance)294 2784 A
4674(*)S
2925 V
(26453)210 1122 A
(*===========================================================================*/)3276 1482 A
3015 V
(26454)210 1122 A
(PUBLIC)252 1440 A
(struct)252 1734 A
(inode)210 2028 A
(*advance\(dirp,)588 2280 A
(string\))294 2910 A
3105 V
(26455)210 1122 A
(struct)252 1440 A
(inode)210 1734 A
(*dirp;)252 1986 A
2784(/*)S
(inode)210 2910 A
(for)126 3162 A
(directory)378 3330 A
3750(to)S
3876(be)S
(searched)336 4002 A
4380(*/)S
3195 V
(26456)210 1122 A
(char)168 1440 A
(string[NAME_MAX];)714 1650 A
2784(/*)S
(component)378 2910 A
(name)168 3330 A
3540(to)S
(look)168 3666 A
(for)126 3876 A
4044(*/)S
3285 V
(26457)210 1122 A
1440({)S
3375 V
(26458)210 1122 A
1440(/*)S
(Given)210 1566 A
1818(a)S
(directory)378 1902 A
(and)126 2322 A
2490(a)S
(component)378 2574 A
2994(of)S
3120(a)S
(path,)210 3204 A
(look)168 3456 A
3666(up)S
(the)126 3792 A
(component)378 3960 A
4380(in)S
3465 V
(26459)210 1122 A
1482(*)S
(the)126 1566 A
(directory,)420 1734 A
(find)168 2196 A
(the)126 2406 A
(inode,)252 2574 A
(open)168 2868 A
(it,)126 3078 A
(and)126 3246 A
(return)252 3414 A
3708(a)S
(pointer)294 3792 A
4128(to)S
(its)126 4254 A
(inode)210 4422 A
3555 V
(26460)210 1122 A
1482(*)S
(slot.)210 1566 A
1860(If)S
1986(it)S
(can't)210 2112 A
2364(be)S
(done,)210 2490 A
(return)252 2742 A
(NIL_INODE.)420 3036 A
3645 V
(26461)210 1122 A
1482(*/)S
3735 V
(26462)210 1122 A
3825 V
(26463)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
3915 V
(26464)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*rip2;)252 2070 A
4005 V
(26465)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(super_block)462 2196 A
(*sp;)168 2700 A
4095 V
(26466)210 1122 A
(int)126 1524 A
1692(r,)S
(inumb;)252 1818 A
4185 V
(26467)210 1122 A
(dev_t)210 1524 A
(mnt_dev;)336 1776 A
4275 V
(26468)210 1122 A
(ino_t)210 1524 A
(numb;)210 1776 A
4365 V
(26469)210 1122 A
4455 V
(26470)210 1122 A
1524(/*)S
1650(If)S
('string')336 1776 A
2154(is)S
(empty,)252 2280 A
(yield)210 2574 A
(same)168 2826 A
(inode)210 3036 A
(straight)336 3288 A
(away.)210 3666 A
3918(*/)S
4545 V
(26471)210 1122 A
1524(if)S
(\(string[0])420 1650 A
2112(==)S
('\\0'\))210 2238 A
2490({)S
(return\(get_inode\(dirp->i_dev,)1218 2574 A
(\(int\))210 3834 A
(dirp->i_num\)\);)588 4086 A
4716(})S
4635 V
(26472)210 1122 A
4725 V
(26473)210 1122 A
1524(/*)S
(Check)210 1650 A
(for)126 1902 A
(NIL_INODE.)420 2070 A
2532(*/)S
4815 V
(26474)210 1122 A
1524(if)S
(\(dirp)210 1650 A
1902(==)S
(NIL_INODE\))420 2028 A
2490({)S
(return\(NIL_INODE\);)756 2574 A
3372(})S
4905 V
(26475)210 1122 A
4995 V
(26476)210 1122 A
1524(/*)S
1650(If)S
('string')336 1776 A
2154(is)S
(not)126 2280 A
(present)294 2448 A
2784(in)S
(the)126 2910 A
(directory,)420 3078 A
(signal)252 3540 A
(error.)252 3834 A
4128(*/)S
5085 V
(26477)210 1122 A
1524(if)S
1650(\()S
1734(\(r)S
1860(=)S
(search_dir\(dirp,)672 1944 A
(string,)294 2658 A
(&numb,)252 2994 A
(LOOK_UP\)\))378 3288 A
3708(!=)S
(OK\))126 3834 A
4002({)S
5175 V
(26478)210 1122 A
(err_code)336 1776 A
2154(=)S
2238(r;)S
5265 V
(26479)210 1122 A
(return\(NIL_INODE\);)756 1776 A
5355 V
(26480)210 1122 A
1524(})S
5445 V
(26481)210 1122 A
5535 V
(26482)210 1122 A
1524(/*)S
(Don't)210 1650 A
1902(go)S
(beyond)252 2028 A
(the)126 2322 A
(current)294 2490 A
(root)168 2826 A
(directory,)420 3036 A
(unless)252 3498 A
(the)126 3792 A
(string)252 3960 A
4254(is)S
(dot2.)210 4380 A
4632(*/)S
5625 V
(26483)210 1122 A
1524(if)S
(\(dirp)210 1650 A
1902(==)S
(fp->fp_rootdir)588 2028 A
2658(&&)S
(strcmp\(string,)588 2784 A
(".."\))210 3414 A
3666(==)S
3792(0)S
3876(&&)S
(string)252 4002 A
4296(!=)S
(dot2\))210 4422 A
5715 V
(26484)210 1122 A
(return\(get_inode\(dirp->i_dev,)1218 2112 A
(\(int\))210 3372 A
(dirp->i_num\)\);)588 3624 A
5805 V
(26485)210 1122 A
5895 V
(26486)210 1122 A
1524(/*)S
(The)126 1650 A
(component)378 1818 A
(has)126 2238 A
(been)168 2406 A
(found)210 2616 A
2868(in)S
(the)126 2994 A
(directory.)420 3162 A
(Get)126 3666 A
(inode.)252 3834 A
4128(*/)S
5985 V
(26487)210 1122 A
1524(if)S
1650(\()S
(\(rip)168 1734 A
1944(=)S
(get_inode\(dirp->i_dev,)924 2028 A
(\(int\))210 2994 A
(numb\)\))252 3246 A
3540(==)S
(NIL_INODE\))420 3666 A
4170({)S
6075 V
(26488)210 1122 A
(return\(NIL_INODE\);)756 1776 A
6165 V
(26489)210 1122 A
1776(})S
6255 V
(26490)210 1122 A
6345 V
(26491)210 1122 A
1524(if)S
(\(rip->i_num)462 1650 A
2154(==)S
(ROOT_INODE\))462 2280 A
6435 V
(26492)210 1122 A
1776(if)S
(\(dirp->i_num)504 1902 A
2448(==)S
(ROOT_INODE\))462 2574 A
3078({)S
6525 V
(26493)210 1122 A
1944(if)S
(\(string[1])420 2070 A
2532(==)S
('.'\))168 2658 A
2868({)S
6615 V
(26494)210 1122 A
(for)126 2112 A
(\(sp)126 2280 A
2448(=)S
(&super_block[1];)672 2532 A
3246(sp)S
3372(<)S
(&super_block[NR_SUPERS];)1008 3456 A
(sp++\){)252 4506 A
6705 V
(26495)210 1122 A
2448(if)S
(\(sp->s_dev)420 2574 A
3036(==)S
(rip->i_dev\))462 3162 A
3666({)S
6795 V
(26496)210 1122 A
2784(/*)S
(Release)294 2910 A
(the)126 3246 A
(root)168 3414 A
(inode.)252 3624 A
(Replace)294 3960 A
4296(by)S
(the)126 4422 A
6885 V
(26497)210 1122 A
2826(*)S
(inode)210 2910 A
(mounted)294 3162 A
(on.)126 3498 A
6975 V
(26498)210 1122 A
2826(*/)S
7065 V
(26499)210 1122 A
(put_inode\(rip\);)630 2784 A
8418 V
EP
%%Page: 359 359
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2400(File:)S
2633(servers/fs/path.c)S
12 B
(359)180 4500 A
1755 V
7 LST
(26500)210 1122 A
(mnt_dev)294 2784 A
3120(=)S
(sp->s_imount->i_dev;)840 3204 A
1845 V
(26501)210 1122 A
(inumb)210 2784 A
3036(=)S
(\(int\))210 3120 A
(sp->s_imount->i_num;)840 3372 A
1935 V
(26502)210 1122 A
(rip2)168 2784 A
2994(=)S
(get_inode\(mnt_dev,)756 3078 A
(inumb\);)294 3876 A
2025 V
(26503)210 1122 A
(rip)126 2784 A
2952(=)S
(advance\(rip2,)546 3036 A
(string\);)336 3624 A
2115 V
(26504)210 1122 A
(put_inode\(rip2\);)672 2784 A
2205 V
(26505)210 1122 A
(break;)252 2784 A
2295 V
(26506)210 1122 A
2448(})S
2385 V
(26507)210 1122 A
2112(})S
2475 V
(26508)210 1122 A
1944(})S
2565 V
(26509)210 1122 A
1776(})S
2655 V
(26510)210 1122 A
1524(if)S
(\(rip)168 1650 A
1860(==)S
(NIL_INODE\))420 1986 A
(return\(NIL_INODE\);)756 2448 A
2745 V
(26511)210 1122 A
2835 V
(26512)210 1122 A
1524(/*)S
(See)126 1650 A
1818(if)S
(the)126 1944 A
(inode)210 2112 A
2364(is)S
(mounted)294 2490 A
(on.)126 2826 A
3036(If)S
(so,)126 3162 A
(switch)252 3330 A
3624(to)S
(root)168 3750 A
(directory)378 3960 A
4380(of)S
(the)126 4506 A
2925 V
(26513)210 1122 A
1566(*)S
(mounted)294 1650 A
(file)168 1986 A
(system.)294 2196 A
(The)126 2574 A
(super_block)462 2742 A
(provides)336 3246 A
(the)126 3624 A
(linkage)294 3792 A
(between)294 4128 A
(the)126 4464 A
3015 V
(26514)210 1122 A
1566(*)S
(inode)210 1650 A
(mounted)294 1902 A
2238(on)S
(and)126 2364 A
(the)126 2532 A
(root)168 2700 A
(directory)378 2910 A
3330(of)S
(the)126 3456 A
(mounted)294 3624 A
(file)168 3960 A
(system.)294 4170 A
3105 V
(26515)210 1122 A
1566(*/)S
3195 V
(26516)210 1122 A
(while)210 1524 A
(\(rip)168 1776 A
1986(!=)S
(NIL_INODE)378 2112 A
2532(&&)S
(rip->i_mount)504 2658 A
3204(==)S
(I_MOUNT\))336 3330 A
3708({)S
3285 V
(26517)210 1122 A
1776(/*)S
(The)126 1902 A
(inode)210 2070 A
2322(is)S
(indeed)252 2448 A
(mounted)294 2742 A
(on.)126 3078 A
3246(*/)S
3375 V
(26518)210 1122 A
(for)126 1776 A
(\(sp)126 1944 A
2112(=)S
(&super_block[0];)672 2196 A
2910(sp)S
3036(<)S
(&super_block[NR_SUPERS];)1008 3120 A
(sp++\))210 4170 A
4422({)S
3465 V
(26519)210 1122 A
2112(if)S
(\(sp->s_imount)546 2238 A
2826(==)S
(rip\))168 2952 A
3162({)S
3555 V
(26520)210 1122 A
2448(/*)S
(Release)294 2574 A
(the)126 2910 A
(inode)210 3078 A
(mounted)294 3330 A
(on.)126 3666 A
(Replace)294 3876 A
4212(by)S
(the)126 4338 A
3645 V
(26521)210 1122 A
2490(*)S
(inode)210 2574 A
2826(of)S
(the)126 2952 A
(root)168 3120 A
(inode)210 3330 A
3582(of)S
(the)126 3708 A
(mounted)294 3876 A
(device.)294 4212 A
3735 V
(26522)210 1122 A
2490(*/)S
3825 V
(26523)210 1122 A
(put_inode\(rip\);)630 2448 A
3915 V
(26524)210 1122 A
(rip)126 2448 A
2616(=)S
(get_inode\(sp->s_dev,)840 2700 A
(ROOT_INODE\);)504 3582 A
4005 V
(26525)210 1122 A
(break;)252 2448 A
4095 V
(26526)210 1122 A
2112(})S
4185 V
(26527)210 1122 A
1776(})S
4275 V
(26528)210 1122 A
1524(})S
4365 V
(26529)210 1122 A
(return\(rip\);)504 1524 A
2448(/*)S
(return)252 2574 A
(pointer)294 2868 A
3204(to)S
(inode's)294 3330 A
(component)378 3666 A
4086(*/)S
4455 V
(26530)210 1122 A
1440(})S
4635 V
(26532)210 1122 A
(/*===========================================================================*)3276 1440 A
4725 V
(26533)210 1122 A
1482(*)S
(search_dir)420 2784 A
4674(*)S
4815 V
(26534)210 1122 A
(*===========================================================================*/)3276 1482 A
4905 V
(26535)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(search_dir\(ldir_ptr,)840 1902 A
(string,)294 2784 A
(numb,)210 3120 A
(flag\))210 3372 A
4995 V
(26536)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*ldir_ptr;)420 2364 A
2826(/*)S
(ptr)126 2952 A
3120(to)S
(inode)210 3246 A
(for)126 3498 A
(dir)126 3666 A
3834(to)S
(search)252 3960 A
4254(*/)S
5085 V
(26537)210 1122 A
(char)168 1440 A
(string[NAME_MAX];)714 1650 A
2826(/*)S
(component)378 2952 A
3372(to)S
(search)252 3498 A
(for)126 3792 A
3960(*/)S
5175 V
(26538)210 1122 A
(ino_t)210 1440 A
(*numb;)252 1692 A
2826(/*)S
(pointer)294 2952 A
3288(to)S
(inode)210 3414 A
(number)252 3666 A
3960(*/)S
5265 V
(26539)210 1122 A
(int)126 1440 A
(flag;)210 1608 A
2826(/*)S
(LOOK_UP,)336 2952 A
(ENTER,)252 3330 A
(DELETE)252 3624 A
3918(or)S
(IS_EMPTY)336 4044 A
4422(*/)S
5355 V
(26540)210 1122 A
1440({)S
5445 V
(26541)210 1122 A
1440(/*)S
(This)168 1566 A
(function)336 1776 A
(searches)336 2154 A
(the)126 2532 A
(directory)378 2700 A
(whose)210 3120 A
(inode)210 3372 A
3624(is)S
(pointed)294 3750 A
4086(to)S
4212(by)S
('ldip':)294 4338 A
5535 V
(26542)210 1122 A
1482(*)S
1566(if)S
(\(flag)210 1692 A
1944(==)S
(ENTER\))252 2070 A
(enter)210 2406 A
('string')336 2658 A
3036(in)S
(the)126 3162 A
(directory)378 3330 A
(with)168 3750 A
(inode)210 3960 A
4212(#)S
('*numb';)336 4296 A
5625 V
(26543)210 1122 A
1482(*)S
1566(if)S
(\(flag)210 1692 A
1944(==)S
(DELETE\))294 2070 A
(delete)252 2406 A
('string')336 2700 A
(from)168 3078 A
(the)126 3288 A
(directory;)420 3456 A
5715 V
(26544)210 1122 A
1482(*)S
1566(if)S
(\(flag)210 1692 A
1944(==)S
(LOOK_UP\))336 2070 A
(search)252 2448 A
(for)126 2742 A
('string')336 2910 A
(and)126 3288 A
(return)252 3456 A
(inode)210 3750 A
4002(#)S
4086(in)S
('numb';)294 4212 A
5805 V
(26545)210 1122 A
1482(*)S
1566(if)S
(\(flag)210 1692 A
1944(==)S
(IS_EMPTY\))378 2070 A
(return)252 2490 A
2784(OK)S
2910(if)S
(only)168 3036 A
3246(.)S
(and)126 3330 A
3498(..)S
3624(in)S
(dir)126 3750 A
(else)168 3918 A
(ENOTEMPTY;)420 4128 A
5895 V
(26546)210 1122 A
1482(*)S
5985 V
(26547)210 1122 A
1482(*)S
1692(if)S
('string')336 1818 A
2196(is)S
(dot1)168 2322 A
2532(or)S
(dot2,)210 2658 A
2910(no)S
(access)252 3036 A
(permissions)462 3330 A
(are)126 3834 A
(checked.)336 4002 A
6075 V
(26548)210 1122 A
1482(*/)S
6165 V
(26549)210 1122 A
6255 V
(26550)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(direct)252 2196 A
(*dp)126 2490 A
2658(=)S
(NULL;)210 2742 A
6345 V
(26551)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(buf)126 2196 A
(*bp)126 2364 A
2532(=)S
(NULL;)210 2616 A
6435 V
(26552)210 1122 A
(int)126 1524 A
1692(i,)S
1818(r,)S
(e_hit,)252 1944 A
2238(t,)S
(match;)252 2364 A
6525 V
(26553)210 1122 A
(mode_t)252 1524 A
(bits;)210 1818 A
6615 V
(26554)210 1122 A
(off_t)210 1524 A
(pos;)168 1776 A
6705 V
(26555)210 1122 A
(unsigned)336 1524 A
(new_slots,)420 1902 A
(old_slots;)420 2364 A
6795 V
(26556)210 1122 A
(block_t)294 1524 A
1860(b;)S
6885 V
(26557)210 1122 A
(struct)252 1524 A
(super_block)462 1818 A
(*sp;)168 2322 A
6975 V
(26558)210 1122 A
(int)126 1524 A
(extended)336 1692 A
2070(=)S
2154(0;)S
7065 V
(26559)210 1122 A
8418 V
EP
%%Page: 360 360
BP
/slant 0 def
/height 0 def
1485 V
12 B
(360)180 1080 A
11 R
2400(File:)S
2633(servers/fs/path.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(26560)210 1122 A
1524(/*)S
1650(If)S
('ldir_ptr')420 1776 A
2238(is)S
(not)126 2364 A
2532(a)S
(pointer)294 2616 A
2952(to)S
3078(a)S
(dir)126 3162 A
(inode,)252 3330 A
(error.)252 3624 A
3918(*/)S
1845 V
(26561)210 1122 A
1524(if)S
1650(\()S
(\(ldir_ptr->i_mode)714 1734 A
2490(&)S
(I_TYPE\))294 2574 A
2910(!=)S
(I_DIRECTORY\))504 3036 A
(return\(ENOTDIR\);)672 3582 A
1935 V
(26562)210 1122 A
2025 V
(26563)210 1122 A
1524(r)S
1608(=)S
(OK;)126 1692 A
2115 V
(26564)210 1122 A
2205 V
(26565)210 1122 A
1524(if)S
(\(flag)210 1650 A
1902(!=)S
(IS_EMPTY\))378 2028 A
2448({)S
2295 V
(26566)210 1122 A
(bits)168 1776 A
1986(=)S
(\(flag)210 2070 A
2322(==)S
(LOOK_UP)294 2448 A
2784(?)S
(X_BIT)210 2868 A
3120(:)S
(W_BIT)210 3204 A
3456(|)S
(X_BIT\);)294 3540 A
2385 V
(26567)210 1122 A
2475 V
(26568)210 1122 A
1776(if)S
(\(string)294 1902 A
2238(==)S
(dot1)168 2364 A
2574(||)S
(string)252 2700 A
2994(==)S
(dot2\))210 3120 A
3372({)S
2565 V
(26569)210 1122 A
2112(if)S
(\(flag)210 2238 A
2490(!=)S
(LOOK_UP\))336 2616 A
2994(r)S
3078(=)S
(read_only\(ldir_ptr\);)840 3162 A
2655 V
(26570)210 1122 A
2994(/*)S
(only)168 3120 A
3330(a)S
(writable)336 3414 A
(device)252 3792 A
4086(is)S
(required.)378 4212 A
4632(*/)S
2745 V
(26571)210 1122 A
1776(})S
2835 V
(26572)210 1122 A
(else)168 1776 A
1986(r)S
2070(=)S
(forbidden\(ldir_ptr,)798 2154 A
(bits\);)252 2994 A
3288(/*)S
(check)210 3414 A
(access)252 3666 A
(permissions)462 3960 A
4464(*/)S
2925 V
(26573)210 1122 A
1524(})S
3015 V
(26574)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
(return\(r\);)420 2070 A
3105 V
(26575)210 1122 A
3195 V
(26576)210 1122 A
1524(/*)S
(Step)168 1650 A
(through)294 1860 A
(the)126 2196 A
(directory)378 2364 A
(one)126 2784 A
(block)210 2952 A
3204(at)S
3330(a)S
(time.)210 3414 A
3666(*/)S
3285 V
(26577)210 1122 A
(old_slots)378 1524 A
1944(=)S
(\(unsigned\))420 2028 A
(\(ldir_ptr->i_size/DIR_ENTRY_SIZE\);)1428 2490 A
3375 V
(26578)210 1122 A
(new_slots)378 1524 A
1944(=)S
2028(0;)S
3465 V
(26579)210 1122 A
(e_hit)210 1524 A
1776(=)S
(FALSE;)252 1860 A
3555 V
(26580)210 1122 A
(match)210 1524 A
1776(=)S
1860(0;)S
2784(/*)S
(set)126 2910 A
(when)168 3078 A
3288(a)S
(string)252 3372 A
(match)210 3666 A
(occurs)252 3918 A
4212(*/)S
3645 V
(26581)210 1122 A
3735 V
(26582)210 1122 A
(for)126 1524 A
(\(pos)168 1692 A
1902(=)S
1986(0;)S
(pos)126 2112 A
2280(<)S
(ldir_ptr->i_size;)714 2364 A
(pos)126 3120 A
3288(+=)S
(ldir_ptr->i_sp->s_block_size\))1218 3414 A
4674({)S
3825 V
(26583)210 1122 A
1776(b)S
1860(=)S
(read_map\(ldir_ptr,)756 1944 A
(pos\);)210 2742 A
3120(/*)S
(get)126 3246 A
(block)210 3414 A
(number)252 3666 A
3960(*/)S
3915 V
(26584)210 1122 A
4005 V
(26585)210 1122 A
1776(/*)S
(Since)210 1902 A
(directories)462 2154 A
(don't)210 2658 A
(have)168 2910 A
(holes,)252 3120 A
('b')126 3414 A
(cannot)252 3582 A
3876(be)S
(NO_BLOCK.)378 4002 A
4422(*/)S
4095 V
(26586)210 1122 A
1776(bp)S
1902(=)S
(get_block\(ldir_ptr->i_dev,)1092 1986 A
3120(b,)S
(NORMAL\);)336 3246 A
3792(/*)S
(get)126 3918 A
4086(a)S
(dir)126 4170 A
(block)210 4338 A
4590(*/)S
4185 V
(26587)210 1122 A
4275 V
(26588)210 1122 A
1776(if)S
(\(bp)126 1902 A
2070(==)S
(NO_BLOCK\))378 2196 A
4365 V
(26589)210 1122 A
(panic\(__FILE__,"get_block)1050 2112 A
(returned)336 3204 A
(NO_BLOCK",)420 3582 A
(NO_NUM\);)336 4044 A
4455 V
(26590)210 1122 A
4545 V
(26591)210 1122 A
1776(/*)S
(Search)252 1902 A
2196(a)S
(directory)378 2280 A
(block.)252 2700 A
2994(*/)S
4635 V
(26592)210 1122 A
(for)126 1776 A
(\(dp)126 1944 A
2112(=)S
(&bp->b_dir[0];)588 2196 A
4725 V
(26593)210 1122 A
2112(dp)S
2238(<)S
(&bp->b_dir[NR_DIR_ENTRIES\(ldir_ptr->i_sp->s_block_size\)];)2394 2322 A
4815 V
(26594)210 1122 A
(dp++\))210 2112 A
2364({)S
4905 V
(26595)210 1122 A
2112(if)S
(\(++new_slots)504 2238 A
2784(>)S
(old_slots\))420 2868 A
3330({)S
3414(/*)S
(not)126 3540 A
(found,)252 3708 A
(but)126 4002 A
(room)168 4170 A
(left)168 4380 A
4590(*/)S
4995 V
(26596)210 1122 A
2448(if)S
(\(flag)210 2574 A
2826(==)S
(ENTER\))252 2952 A
(e_hit)210 3246 A
3498(=)S
(TRUE;)210 3582 A
5085 V
(26597)210 1122 A
(break;)252 2448 A
5175 V
(26598)210 1122 A
2112(})S
5265 V
(26599)210 1122 A
5355 V
(26600)210 1122 A
2112(/*)S
(Match)210 2238 A
(occurs)252 2490 A
2784(if)S
(string)252 2910 A
(found.)252 3204 A
3498(*/)S
5445 V
(26601)210 1122 A
2112(if)S
(\(flag)210 2238 A
2490(!=)S
(ENTER)210 2616 A
2868(&&)S
(dp->d_ino)378 2994 A
3414(!=)S
3540(0\))S
3666({)S
5535 V
(26602)210 1122 A
2448(if)S
(\(flag)210 2574 A
2826(==)S
(IS_EMPTY\))378 2952 A
3372({)S
5625 V
(26603)210 1122 A
2784(/*)S
2910(If)S
(this)168 3036 A
(test)168 3246 A
(succeeds,)378 3456 A
(dir)126 3876 A
4044(is)S
(not)126 4170 A
(empty.)252 4338 A
4632(*/)S
5715 V
(26604)210 1122 A
2784(if)S
(\(strcmp\(dp->d_name,)798 2910 A
(".")126 3750 A
3918(\))S
4002(!=)S
4128(0)S
4212(&&)S
5805 V
(26605)210 1122 A
(strcmp\(dp->d_name,)756 2952 A
(".."\))210 3750 A
4002(!=)S
4128(0\))S
(match)210 4254 A
4506(=)S
4590(1;)S
5895 V
(26606)210 1122 A
2448(})S
(else)168 2532 A
2742({)S
5985 V
(26607)210 1122 A
2784(if)S
(\(strncmp\(dp->d_name,)840 2910 A
(string,)294 3792 A
(NAME_MAX\))378 4128 A
4548(==)S
4674(0\))S
4800({)S
6075 V
(26608)210 1122 A
(match)210 3120 A
3372(=)S
3456(1;)S
6165 V
(26609)210 1122 A
2784(})S
6255 V
(26610)210 1122 A
2448(})S
6345 V
(26611)210 1122 A
2112(})S
6435 V
(26612)210 1122 A
6525 V
(26613)210 1122 A
2112(if)S
(\(match\))294 2238 A
2574({)S
6615 V
(26614)210 1122 A
2448(/*)S
(LOOK_UP)294 2574 A
2910(or)S
(DELETE)252 3036 A
(found)210 3330 A
(what)168 3582 A
3792(it)S
(wanted.)294 3918 A
4254(*/)S
6705 V
(26615)210 1122 A
2448(r)S
2532(=)S
(OK;)126 2616 A
6795 V
(26616)210 1122 A
2448(if)S
(\(flag)210 2574 A
2826(==)S
(IS_EMPTY\))378 2952 A
3372(r)S
3456(=)S
(ENOTEMPTY;)420 3540 A
6885 V
(26617)210 1122 A
(else)168 2448 A
2658(if)S
(\(flag)210 2784 A
3036(==)S
(DELETE\))294 3162 A
3498({)S
6975 V
(26618)210 1122 A
2784(/*)S
(Save)168 2910 A
(d_ino)210 3120 A
(for)126 3372 A
(recovery.)378 3540 A
3960(*/)S
7065 V
(26619)210 1122 A
2784(t)S
2868(=)S
(NAME_MAX)336 2952 A
3330(-)S
(sizeof\(ino_t\);)588 3414 A
8418 V
EP
%%Page: 361 361
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2400(File:)S
2633(servers/fs/path.c)S
12 B
(361)180 4500 A
1755 V
7 LST
(26620)210 1122 A
(*\(\(ino_t)336 2784 A
3162(*\))S
(&dp->d_name[t]\))630 3288 A
3960(=)S
(dp->d_ino;)420 4044 A
1845 V
(26621)210 1122 A
(dp->d_ino)378 2784 A
3204(=)S
3288(0;)S
3456(/*)S
(erase)210 3582 A
(entry)210 3834 A
4086(*/)S
1935 V
(26622)210 1122 A
(bp->b_dirt)420 2784 A
3246(=)S
(DIRTY;)252 3330 A
2025 V
(26623)210 1122 A
(ldir_ptr->i_update)756 2784 A
3582(|=)S
(CTIME)210 3708 A
3960(|)S
(MTIME;)252 4044 A
2115 V
(26624)210 1122 A
(ldir_ptr->i_dirt)672 2784 A
3498(=)S
(DIRTY;)252 3582 A
2205 V
(26625)210 1122 A
2448(})S
(else)168 2532 A
2742({)S
2295 V
(26626)210 1122 A
2784(sp)S
2910(=)S
(ldir_ptr->i_sp;)630 2994 A
3792(/*)S
('flag')252 3918 A
4212(is)S
(LOOK_UP)294 4338 A
4674(*/)S
2385 V
(26627)210 1122 A
(*numb)210 2784 A
3036(=)S
(conv4\(sp->s_native,)798 3120 A
(\(int\))210 3960 A
(dp->d_ino\);)462 4212 A
2475 V
(26628)210 1122 A
2448(})S
2565 V
(26629)210 1122 A
(put_block\(bp,)546 2448 A
(DIRECTORY_BLOCK\);)714 3036 A
2655 V
(26630)210 1122 A
(return\(r\);)420 2448 A
2745 V
(26631)210 1122 A
2112(})S
2835 V
(26632)210 1122 A
2925 V
(26633)210 1122 A
2112(/*)S
(Check)210 2238 A
(for)126 2490 A
(free)168 2658 A
(slot)168 2868 A
(for)126 3078 A
(the)126 3246 A
(benefit)294 3414 A
3750(of)S
(ENTER.)252 3876 A
4170(*/)S
3015 V
(26634)210 1122 A
2112(if)S
(\(flag)210 2238 A
2490(==)S
(ENTER)210 2616 A
2868(&&)S
(dp->d_ino)378 2994 A
3414(==)S
3540(0\))S
3666({)S
3105 V
(26635)210 1122 A
(e_hit)210 2448 A
2700(=)S
(TRUE;)210 2784 A
3120(/*)S
3246(we)S
(found)210 3372 A
3624(a)S
(free)168 3708 A
(slot)168 3918 A
4128(*/)S
3195 V
(26636)210 1122 A
(break;)252 2448 A
3285 V
(26637)210 1122 A
2112(})S
3375 V
(26638)210 1122 A
1776(})S
3465 V
(26639)210 1122 A
3555 V
(26640)210 1122 A
1776(/*)S
(The)126 1902 A
(whole)210 2070 A
(block)210 2322 A
(has)126 2574 A
(been)168 2742 A
(searched)336 2952 A
3330(or)S
(ENTER)210 3456 A
(has)126 3708 A
3876(a)S
(free)168 3960 A
(slot.)210 4170 A
4422(*/)S
3645 V
(26641)210 1122 A
1776(if)S
(\(e_hit\))294 1902 A
(break;)252 2238 A
2784(/*)S
(e_hit)210 2910 A
(set)126 3162 A
3330(if)S
(ENTER)210 3456 A
(can)126 3708 A
3876(be)S
(performed)378 4002 A
(now)126 4422 A
4590(*/)S
3735 V
(26642)210 1122 A
(put_block\(bp,)546 1776 A
(DIRECTORY_BLOCK\);)714 2364 A
3120(/*)S
(otherwise,)420 3246 A
(continue)336 3708 A
(searching)378 4086 A
(dir)126 4506 A
4674(*/)S
3825 V
(26643)210 1122 A
1524(})S
3915 V
(26644)210 1122 A
4005 V
(26645)210 1122 A
1524(/*)S
(The)126 1650 A
(whole)210 1818 A
(directory)378 2070 A
(has)126 2490 A
(now)126 2658 A
(been)168 2826 A
(searched.)378 3036 A
3456(*/)S
4095 V
(26646)210 1122 A
1524(if)S
(\(flag)210 1650 A
1902(!=)S
(ENTER\))252 2028 A
2322({)S
4185 V
(26647)210 1122 A
(return\(flag)462 1776 A
2280(==)S
(IS_EMPTY)336 2406 A
2784(?)S
2868(OK)S
2994(:)S
(ENOENT\);)336 3078 A
4275 V
(26648)210 1122 A
1524(})S
4365 V
(26649)210 1122 A
4455 V
(26650)210 1122 A
1524(/*)S
(This)168 1650 A
(call)168 1860 A
2070(is)S
(for)126 2196 A
(ENTER.)252 2364 A
2700(If)S
2826(no)S
(free)168 2952 A
(slot)168 3162 A
(has)126 3372 A
(been)168 3540 A
(found)210 3750 A
4002(so)S
(far,)168 4128 A
(try)126 4338 A
4506(to)S
4545 V
(26651)210 1122 A
1566(*)S
(extend)252 1650 A
(directory.)420 1944 A
4635 V
(26652)210 1122 A
1566(*/)S
4725 V
(26653)210 1122 A
1524(if)S
(\(e_hit)252 1650 A
1944(==)S
(FALSE\))252 2070 A
2364({)S
2448(/*)S
(directory)378 2574 A
2994(is)S
(full)168 3120 A
(and)126 3330 A
3498(no)S
(room)168 3624 A
(left)168 3834 A
4044(in)S
(last)168 4170 A
(block)210 4380 A
4632(*/)S
4815 V
(26654)210 1122 A
(new_slots++;)504 1776 A
2784(/*)S
(increase)336 2910 A
(directory)378 3288 A
(size)168 3708 A
3918(by)S
4044(1)S
(entry)210 4128 A
4380(*/)S
4905 V
(26655)210 1122 A
1776(if)S
(\(new_slots)420 1902 A
2364(==)S
2490(0\))S
(return\(EFBIG\);)588 2616 A
3246(/*)S
(dir)126 3372 A
(size)168 3540 A
(limited)294 3750 A
4086(by)S
(slot)168 4212 A
(count)210 4422 A
4674(*/)S
4995 V
(26656)210 1122 A
1776(if)S
1902(\()S
(\(bp)126 1986 A
2154(=)S
(new_block\(ldir_ptr,)798 2238 A
(ldir_ptr->i_size\)\))756 3078 A
3876(==)S
(NIL_BUF\))336 4002 A
5085 V
(26657)210 1122 A
(return\(err_code\);)714 2112 A
5175 V
(26658)210 1122 A
1776(dp)S
1902(=)S
(&bp->b_dir[0];)588 1986 A
5265 V
(26659)210 1122 A
(extended)336 1776 A
2154(=)S
2238(1;)S
5355 V
(26660)210 1122 A
1524(})S
5445 V
(26661)210 1122 A
5535 V
(26662)210 1122 A
1524(/*)S
('bp')168 1650 A
(now)126 1860 A
(points)252 2028 A
2322(to)S
2448(a)S
(directory)378 2532 A
(block)210 2952 A
(with)168 3204 A
(space.)252 3414 A
('dp')168 3708 A
(points)252 3918 A
4212(to)S
(slot.)210 4338 A
4590(*/)S
5625 V
(26663)210 1122 A
(\(void\))252 1524 A
(memset\(dp->d_name,)756 1818 A
2616(0,)S
(\(size_t\))336 2742 A
(NAME_MAX\);)420 3120 A
3582(/*)S
(clear)210 3708 A
(entry)210 3960 A
4212(*/)S
5715 V
(26664)210 1122 A
(for)126 1524 A
1692(\(i)S
1818(=)S
1902(0;)S
(string[i])378 2028 A
2448(&&)S
2574(i)S
2658(<)S
(NAME_MAX;)378 2742 A
(i++\))168 3162 A
(dp->d_name[i])546 3372 A
3960(=)S
(string[i];)420 4044 A
5805 V
(26665)210 1122 A
1524(sp)S
1650(=)S
(ldir_ptr->i_sp;)630 1734 A
5895 V
(26666)210 1122 A
(dp->d_ino)378 1524 A
1944(=)S
(conv4\(sp->s_native,)798 2028 A
(\(int\))210 2868 A
(*numb\);)294 3120 A
5985 V
(26667)210 1122 A
(bp->b_dirt)420 1524 A
1986(=)S
(DIRTY;)252 2070 A
6075 V
(26668)210 1122 A
(put_block\(bp,)546 1524 A
(DIRECTORY_BLOCK\);)714 2112 A
6165 V
(26669)210 1122 A
(ldir_ptr->i_update)756 1524 A
2322(|=)S
(CTIME)210 2448 A
2700(|)S
(MTIME;)252 2784 A
3120(/*)S
(mark)168 3246 A
(mtime)210 3456 A
(for)126 3708 A
(update)252 3876 A
(later)210 4170 A
4422(*/)S
6255 V
(26670)210 1122 A
(ldir_ptr->i_dirt)672 1524 A
2238(=)S
(DIRTY;)252 2322 A
6345 V
(26671)210 1122 A
1524(if)S
(\(new_slots)420 1650 A
2112(>)S
(old_slots\))420 2196 A
2658({)S
6435 V
(26672)210 1122 A
(ldir_ptr->i_size)672 1776 A
2490(=)S
(\(off_t\))294 2574 A
(new_slots)378 2910 A
3330(*)S
(DIR_ENTRY_SIZE;)630 3414 A
6525 V
(26673)210 1122 A
1776(/*)S
(Send)168 1902 A
(the)126 2112 A
(change)252 2280 A
2574(to)S
(disk)168 2700 A
2910(if)S
(the)126 3036 A
(directory)378 3204 A
3624(is)S
(extended.)378 3750 A
4170(*/)S
6615 V
(26674)210 1122 A
1776(if)S
(\(extended\))420 1902 A
(rw_inode\(ldir_ptr,)756 2364 A
(WRITING\);)378 3162 A
6705 V
(26675)210 1122 A
1524(})S
6795 V
(26676)210 1122 A
(return\(OK\);)462 1524 A
6885 V
(26677)210 1122 A
1440(})S
8418 V
EP
%%Page: 362 362
BP
/slant 0 def
/height 0 def
1485 V
12 B
(362)180 1080 A
11 R
2355(File:)S
(servers/fs/mount.c)817 2588 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1845 V
7 LST
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
1935 V
(servers/fs/mount.c)756 2676 A
2025 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2205 V
(26700)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(performs)336 1986 A
(the)126 2364 A
(MOUNT)210 2532 A
(and)126 2784 A
(UMOUNT)252 2952 A
(system)252 3246 A
(calls.)252 3540 A
2295 V
(26701)210 1122 A
1482(*)S
2385 V
(26702)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are)126 2910 A
2475 V
(26703)210 1122 A
1482(*)S
(do_mount:)378 1650 A
(perform)294 2112 A
(the)126 2448 A
(MOUNT)210 2616 A
(system)252 2868 A
(call)168 3162 A
2565 V
(26704)210 1122 A
1482(*)S
(do_umount:)420 1650 A
(perform)294 2112 A
(the)126 2448 A
(UMOUNT)252 2616 A
(system)252 2910 A
(call)168 3204 A
2655 V
(26705)210 1122 A
1482(*/)S
2745 V
(26706)210 1122 A
2835 V
(26707)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
2925 V
(26708)210 1122 A
(#include)336 1440 A
(<fcntl.h>)378 1818 A
3015 V
(26709)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
3105 V
(26710)210 1122 A
(#include)336 1440 A
(<sys/stat.h>)504 1818 A
3195 V
(26711)210 1122 A
(#include)336 1440 A
("buf.h")294 1818 A
3285 V
(26712)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
3375 V
(26713)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
3465 V
(26714)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
3555 V
(26715)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
3645 V
(26716)210 1122 A
(#include)336 1440 A
("super.h")378 1818 A
3735 V
(26717)210 1122 A
3825 V
(26718)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(dev_t)210 2280 A
(name_to_dev,)504 2532 A
(\(char)210 3078 A
(*path\))252 3330 A
4464(\);)S
3915 V
(26719)210 1122 A
4005 V
(26720)210 1122 A
(/*===========================================================================*)3276 1440 A
4095 V
(26721)210 1122 A
1482(*)S
(do_mount)336 2784 A
4674(*)S
4185 V
(26722)210 1122 A
(*===========================================================================*/)3276 1482 A
4275 V
(26723)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_mount\(\))420 1902 A
4365 V
(26724)210 1122 A
1440({)S
4455 V
(26725)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(mount\(name,)462 2070 A
(mfile,)252 2574 A
(rd_only\))336 2868 A
(system)252 3246 A
(call.)210 3540 A
3792(*/)S
4545 V
(26726)210 1122 A
4635 V
(26727)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip,)210 2448 A
(*root_ip;)378 2700 A
4725 V
(26728)210 1122 A
(struct)252 1524 A
(super_block)462 1818 A
(*xp,)168 2322 A
(*sp;)168 2532 A
4815 V
(26729)210 1122 A
(dev_t)210 1524 A
(dev;)168 1776 A
4905 V
(26730)210 1122 A
(mode_t)252 1524 A
(bits;)210 1818 A
4995 V
(26731)210 1122 A
(int)126 1524 A
(rdir,)210 1692 A
(mdir;)210 1944 A
2784(/*)S
(TRUE)168 2910 A
(iff)126 3120 A
({root|mount})504 3288 A
(file)168 3834 A
4044(is)S
(dir)126 4170 A
4338(*/)S
5085 V
(26732)210 1122 A
(int)126 1524 A
1692(r,)S
(found;)252 1818 A
5175 V
(26733)210 1122 A
5265 V
(26734)210 1122 A
1524(/*)S
(Only)168 1650 A
(the)126 1860 A
(super-user)420 2028 A
(may)126 2490 A
2658(do)S
(MOUNT.)252 2784 A
3078(*/)S
5355 V
(26735)210 1122 A
1524(if)S
(\(!super_user\))546 1650 A
(return\(EPERM\);)588 2238 A
5445 V
(26736)210 1122 A
5535 V
(26737)210 1122 A
1524(/*)S
1650(If)S
('name')252 1776 A
2070(is)S
(not)126 2196 A
(for)126 2364 A
2532(a)S
(block)210 2616 A
(special)294 2868 A
(file,)210 3204 A
(return)252 3456 A
(error.)252 3750 A
4044(*/)S
5625 V
(26738)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name1,)966 1650 A
(m_in.name1_length,)756 2658 A
(M1\))126 3456 A
3624(!=)S
(OK\))126 3750 A
(return\(err_code\);)714 3918 A
5715 V
(26739)210 1122 A
1524(if)S
1650(\()S
(\(dev)168 1734 A
1944(=)S
(name_to_dev\(user_path\)\))966 2028 A
3036(==)S
(NO_DEV\))294 3162 A
(return\(err_code\);)714 3498 A
5805 V
(26740)210 1122 A
5895 V
(26741)210 1122 A
1524(/*)S
(Scan)168 1650 A
(super)210 1860 A
(block)210 2112 A
(table)210 2364 A
2616(to)S
(see)126 2742 A
2910(if)S
(dev)126 3036 A
(already)294 3204 A
(mounted)294 3540 A
3876(&)S
(find)168 3960 A
4170(a)S
(free)168 4254 A
(slot.*/)294 4464 A
5985 V
(26742)210 1122 A
1524(sp)S
1650(=)S
(NIL_SUPER;)420 1734 A
6075 V
(26743)210 1122 A
(found)210 1524 A
1776(=)S
(FALSE;)252 1860 A
6165 V
(26744)210 1122 A
(for)126 1524 A
(\(xp)126 1692 A
1860(=)S
(&super_block[0];)672 1944 A
2658(xp)S
2784(<)S
(&super_block[NR_SUPERS];)1008 2868 A
(xp++\))210 3918 A
4170({)S
6255 V
(26745)210 1122 A
1776(if)S
(\(xp->s_dev)420 1902 A
2364(==)S
(dev\))168 2490 A
(found)210 2700 A
2952(=)S
(TRUE;)210 3036 A
3456(/*)S
3582(is)S
3708(it)S
(mounted)294 3834 A
(already?)336 4170 A
4548(*/)S
6345 V
(26746)210 1122 A
1776(if)S
(\(xp->s_dev)420 1902 A
2364(==)S
(NO_DEV\))294 2490 A
2826(sp)S
2952(=)S
(xp;)126 3036 A
3456(/*)S
(record)252 3582 A
(free)168 3876 A
(slot)168 4086 A
4296(*/)S
6435 V
(26747)210 1122 A
1524(})S
6525 V
(26748)210 1122 A
1524(if)S
(\(found\))294 1650 A
(return\(EBUSY\);)588 1986 A
2784(/*)S
(already)294 2910 A
(mounted)294 3246 A
3582(*/)S
6615 V
(26749)210 1122 A
1524(if)S
(\(sp)126 1650 A
1818(==)S
(NIL_SUPER\))420 1944 A
(return\(ENFILE\);)630 2406 A
3120(/*)S
3246(no)S
(super)210 3372 A
(block)210 3624 A
(available)378 3876 A
4296(*/)S
6705 V
(26750)210 1122 A
6795 V
(26751)210 1122 A
1524(/*)S
(Open)168 1650 A
(the)126 1860 A
(device)252 2028 A
(the)126 2322 A
(file)168 2490 A
(system)252 2700 A
(lives)210 2994 A
(on.)126 3246 A
3414(*/)S
6885 V
(26752)210 1122 A
1524(if)S
(\(dev_open\(dev,)588 1650 A
(who,)168 2280 A
(m_in.rd_only)504 2490 A
3036(?)S
(R_BIT)210 3120 A
3372(:)S
(\(R_BIT|W_BIT\)\))588 3456 A
4086(!=)S
(OK\))126 4212 A
6975 V
(26753)210 1122 A
(return\(EINVAL\);)630 1776 A
7065 V
(26754)210 1122 A
8418 V
EP
%%Page: 363 363
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2355(File:)S
(servers/fs/mount.c)817 2588 A
12 B
(363)180 4500 A
1755 V
7 LST
(26755)210 1122 A
1524(/*)S
(Make)168 1650 A
(the)126 1860 A
(cache)210 2028 A
(forget)252 2280 A
(about)210 2574 A
(blocks)252 2826 A
3120(it)S
(has)126 3246 A
(open)168 3414 A
3624(on)S
(the)126 3750 A
(filesystem)420 3918 A
4380(*/)S
1845 V
(26756)210 1122 A
(\(void\))252 1524 A
(do_sync\(\);)420 1818 A
1935 V
(26757)210 1122 A
(invalidate\(dev\);)672 1524 A
2025 V
(26758)210 1122 A
2115 V
(26759)210 1122 A
1524(/*)S
(Fill)168 1650 A
1860(in)S
(the)126 1986 A
(super)210 2154 A
(block.)252 2406 A
2700(*/)S
2205 V
(26760)210 1122 A
(sp->s_dev)378 1524 A
1944(=)S
(dev;)168 2028 A
2784(/*)S
(read_super\(\))504 2910 A
(needs)210 3456 A
3708(to)S
(know)168 3834 A
(which)210 4044 A
(dev)126 4296 A
4464(*/)S
2295 V
(26761)210 1122 A
1524(r)S
1608(=)S
(read_super\(sp\);)630 1692 A
2385 V
(26762)210 1122 A
2475 V
(26763)210 1122 A
1524(/*)S
1650(Is)S
1776(it)S
(recognized)420 1902 A
2364(as)S
2490(a)S
(Minix)210 2574 A
(filesystem?)462 2826 A
3330(*/)S
2565 V
(26764)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
2070({)S
2655 V
(26765)210 1122 A
(dev_close\(dev\);)630 1776 A
2745 V
(26766)210 1122 A
(sp->s_dev)378 1776 A
2196(=)S
(NO_DEV;)294 2280 A
2835 V
(26767)210 1122 A
(return\(r\);)420 1776 A
2925 V
(26768)210 1122 A
1524(})S
3015 V
(26769)210 1122 A
3105 V
(26770)210 1122 A
1524(/*)S
(Now)126 1650 A
(get)126 1818 A
(the)126 1986 A
(inode)210 2154 A
2406(of)S
(the)126 2532 A
(file)168 2700 A
2910(to)S
3036(be)S
(mounted)294 3162 A
(on.)126 3498 A
3666(*/)S
3195 V
(26771)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name2,)966 1650 A
(m_in.name2_length,)756 2658 A
(M1\))126 3456 A
3624(!=)S
(OK\))126 3750 A
3918({)S
3285 V
(26772)210 1122 A
(dev_close\(dev\);)630 1776 A
3375 V
(26773)210 1122 A
(sp->s_dev)378 1776 A
2196(=)S
(NO_DEV;)294 2280 A
3465 V
(26774)210 1122 A
(return\(err_code\);)714 1776 A
3555 V
(26775)210 1122 A
1524(})S
3645 V
(26776)210 1122 A
1524(if)S
1650(\()S
(\(rip)168 1734 A
1944(=)S
(eat_path\(user_path\)\))840 2028 A
2910(==)S
(NIL_INODE\))420 3036 A
3498({)S
3735 V
(26777)210 1122 A
(dev_close\(dev\);)630 1776 A
3825 V
(26778)210 1122 A
(sp->s_dev)378 1776 A
2196(=)S
(NO_DEV;)294 2280 A
3915 V
(26779)210 1122 A
(return\(err_code\);)714 1776 A
4005 V
(26780)210 1122 A
1524(})S
4095 V
(26781)210 1122 A
4185 V
(26782)210 1122 A
1524(/*)S
1650(It)S
(may)126 1776 A
(not)126 1944 A
2112(be)S
(busy.)210 2238 A
2490(*/)S
4275 V
(26783)210 1122 A
1524(r)S
1608(=)S
(OK;)126 1692 A
4365 V
(26784)210 1122 A
1524(if)S
(\(rip->i_count)546 1650 A
2238(>)S
2322(1\))S
2448(r)S
2532(=)S
(EBUSY;)252 2616 A
4455 V
(26785)210 1122 A
4545 V
(26786)210 1122 A
1524(/*)S
1650(It)S
(may)126 1776 A
(not)126 1944 A
2112(be)S
(special.)336 2238 A
2616(*/)S
4635 V
(26787)210 1122 A
(bits)168 1524 A
1734(=)S
(rip->i_mode)462 1818 A
2322(&)S
(I_TYPE;)294 2406 A
4725 V
(26788)210 1122 A
1524(if)S
(\(bits)210 1650 A
1902(==)S
(I_BLOCK_SPECIAL)630 2028 A
2700(||)S
(bits)168 2826 A
3036(==)S
(I_CHAR_SPECIAL\))630 3162 A
3834(r)S
3918(=)S
(ENOTDIR;)336 4002 A
4815 V
(26789)210 1122 A
4905 V
(26790)210 1122 A
1524(/*)S
(Get)126 1650 A
(the)126 1818 A
(root)168 1986 A
(inode)210 2196 A
2448(of)S
(the)126 2574 A
(mounted)294 2742 A
(file)168 3078 A
(system.)294 3288 A
3624(*/)S
4995 V
(26791)210 1122 A
(root_ip)294 1524 A
1860(=)S
(NIL_INODE;)420 1944 A
2784(/*)S
2910(if)S
('r')126 3036 A
(not)126 3204 A
(OK,)126 3372 A
(make)168 3540 A
(sure)168 3750 A
(this)168 3960 A
4170(is)S
(defined)294 4296 A
4632(*/)S
5085 V
(26792)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
2070({)S
5175 V
(26793)210 1122 A
1776(if)S
1902(\()S
(\(root_ip)336 1986 A
2364(=)S
(get_inode\(dev,)588 2448 A
(ROOT_INODE\)\))504 3078 A
3624(==)S
(NIL_INODE\))420 3750 A
4212(r)S
4296(=)S
(err_code;)378 4380 A
5265 V
(26794)210 1122 A
1524(})S
5355 V
(26795)210 1122 A
1524(if)S
(\(root_ip)336 1650 A
2028(!=)S
(NIL_INODE)378 2154 A
2574(&&)S
(root_ip->i_mode)630 2700 A
3372(==)S
3498(0\))S
3624({)S
5445 V
(26796)210 1122 A
1776(r)S
1860(=)S
(EINVAL;)294 1944 A
5535 V
(26797)210 1122 A
1524(})S
5625 V
(26798)210 1122 A
5715 V
(26799)210 1122 A
1524(/*)S
(File)168 1650 A
(types)210 1860 A
2112(of)S
('rip')210 2238 A
(and)126 2490 A
('root_ip')378 2658 A
(may)126 3078 A
(not)126 3246 A
(conflict.)378 3414 A
3834(*/)S
5805 V
(26800)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
2070({)S
5895 V
(26801)210 1122 A
(mdir)168 1776 A
1986(=)S
(\(\(rip->i_mode)546 2070 A
2658(&)S
(I_TYPE\))294 2742 A
3078(==)S
(I_DIRECTORY\);)546 3204 A
3834(/*)S
(TRUE)168 3960 A
(iff)126 4170 A
(dir)126 4338 A
4506(*/)S
5985 V
(26802)210 1122 A
(rdir)168 1776 A
1986(=)S
(\(\(root_ip->i_mode)714 2070 A
2826(&)S
(I_TYPE\))294 2910 A
3246(==)S
(I_DIRECTORY\);)546 3372 A
6075 V
(26803)210 1122 A
1776(if)S
(\(!mdir)252 1902 A
2196(&&)S
(rdir\))210 2322 A
2574(r)S
2658(=)S
(EISDIR;)294 2742 A
6165 V
(26804)210 1122 A
1524(})S
6255 V
(26805)210 1122 A
6345 V
(26806)210 1122 A
1524(/*)S
1650(If)S
(error,)252 1776 A
(return)252 2070 A
(the)126 2364 A
(super)210 2532 A
(block)210 2784 A
(and)126 3036 A
(both)168 3204 A
(inodes;)294 3414 A
(release)294 3750 A
(the)126 4086 A
(maps.)210 4254 A
4506(*/)S
6435 V
(26807)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
2070({)S
6525 V
(26808)210 1122 A
(put_inode\(rip\);)630 1776 A
6615 V
(26809)210 1122 A
(put_inode\(root_ip\);)798 1776 A
6705 V
(26810)210 1122 A
(\(void\))252 1776 A
(do_sync\(\);)420 2070 A
6795 V
(26811)210 1122 A
(invalidate\(dev\);)672 1776 A
6885 V
(26812)210 1122 A
(dev_close\(dev\);)630 1776 A
6975 V
(26813)210 1122 A
(sp->s_dev)378 1776 A
2196(=)S
(NO_DEV;)294 2280 A
7065 V
(26814)210 1122 A
(return\(r\);)420 1776 A
8418 V
EP
%%Page: 364 364
BP
/slant 0 def
/height 0 def
1485 V
12 B
(364)180 1080 A
11 R
2355(File:)S
(servers/fs/mount.c)817 2588 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(26815)210 1122 A
1524(})S
1845 V
(26816)210 1122 A
1935 V
(26817)210 1122 A
1524(/*)S
(Nothing)294 1650 A
(else)168 1986 A
(can)126 2196 A
2364(go)S
(wrong.)252 2490 A
(Perform)294 2826 A
(the)126 3162 A
(mount.)252 3330 A
3624(*/)S
2025 V
(26818)210 1122 A
(rip->i_mount)504 1524 A
2070(=)S
(I_MOUNT;)336 2154 A
2784(/*)S
(this)168 2910 A
(bit)126 3120 A
(says)168 3288 A
(the)126 3498 A
(inode)210 3666 A
3918(is)S
(mounted)294 4044 A
4380(on)S
4506(*/)S
2115 V
(26819)210 1122 A
(sp->s_imount)504 1524 A
2070(=)S
(rip;)168 2154 A
2205 V
(26820)210 1122 A
(sp->s_isup)420 1524 A
1986(=)S
(root_ip;)336 2070 A
2295 V
(26821)210 1122 A
(sp->s_rd_only)546 1524 A
2112(=)S
(m_in.rd_only;)546 2196 A
2385 V
(26822)210 1122 A
(return\(OK\);)462 1524 A
2475 V
(26823)210 1122 A
1440(})S
2655 V
(26825)210 1122 A
(/*===========================================================================*)3276 1440 A
2745 V
(26826)210 1122 A
1482(*)S
(do_umount)378 2784 A
4674(*)S
2835 V
(26827)210 1122 A
(*===========================================================================*/)3276 1482 A
2925 V
(26828)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_umount\(\))462 1902 A
3015 V
(26829)210 1122 A
1440({)S
3105 V
(26830)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(umount\(name\))504 2070 A
(system)252 2616 A
(call.)210 2910 A
3162(*/)S
3195 V
(26831)210 1122 A
(dev_t)210 1524 A
(dev;)168 1776 A
3285 V
(26832)210 1122 A
3375 V
(26833)210 1122 A
1524(/*)S
(Only)168 1650 A
(the)126 1860 A
(super-user)420 2028 A
(may)126 2490 A
2658(do)S
(UMOUNT.)294 2784 A
3120(*/)S
3465 V
(26834)210 1122 A
1524(if)S
(\(!super_user\))546 1650 A
(return\(EPERM\);)588 2238 A
3555 V
(26835)210 1122 A
3645 V
(26836)210 1122 A
1524(/*)S
1650(If)S
('name')252 1776 A
2070(is)S
(not)126 2196 A
(for)126 2364 A
2532(a)S
(block)210 2616 A
(special)294 2868 A
(file,)210 3204 A
(return)252 3456 A
(error.)252 3750 A
4044(*/)S
3735 V
(26837)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name,)924 1650 A
(m_in.name_length,)714 2616 A
(M3\))126 3372 A
3540(!=)S
(OK\))126 3666 A
(return\(err_code\);)714 3834 A
3825 V
(26838)210 1122 A
1524(if)S
1650(\()S
(\(dev)168 1734 A
1944(=)S
(name_to_dev\(user_path\)\))966 2028 A
3036(==)S
(NO_DEV\))294 3162 A
(return\(err_code\);)714 3498 A
3915 V
(26839)210 1122 A
4005 V
(26840)210 1122 A
(return\(unmount\(dev\)\);)882 1524 A
4095 V
(26841)210 1122 A
1440(})S
4275 V
(26843)210 1122 A
(/*===========================================================================*)3276 1440 A
4365 V
(26844)210 1122 A
1482(*)S
(unmount)294 2784 A
4674(*)S
4455 V
(26845)210 1122 A
(*===========================================================================*/)3276 1482 A
4545 V
(26846)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(unmount\(dev\))504 1902 A
4635 V
(26847)210 1122 A
(Dev_t)210 1440 A
(dev;)168 1692 A
4725 V
(26848)210 1122 A
1440({)S
4815 V
(26849)210 1122 A
1440(/*)S
(Unmount)294 1566 A
1902(a)S
(file)168 1986 A
(system)252 2196 A
2490(by)S
(device)252 2616 A
(number.)294 2910 A
3246(*/)S
4905 V
(26850)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
4995 V
(26851)210 1122 A
(struct)252 1524 A
(super_block)462 1818 A
(*sp,)168 2322 A
(*sp1;)210 2532 A
5085 V
(26852)210 1122 A
(int)126 1524 A
(count;)252 1692 A
5175 V
(26853)210 1122 A
5265 V
(26854)210 1122 A
1524(/*)S
(See)126 1650 A
1818(if)S
(the)126 1944 A
(mounted)294 2112 A
(device)252 2448 A
2742(is)S
(busy.)210 2868 A
(Only)168 3162 A
3372(1)S
(inode)210 3456 A
(using)210 3708 A
3960(it)S
(should)252 4086 A
4380(be)S
5355 V
(26855)210 1122 A
1566(*)S
(open)168 1650 A
1860(--)S
(the)126 1986 A
(root)168 2154 A
(inode)210 2364 A
2616(--)S
(and)126 2742 A
(that)168 2910 A
(inode)210 3120 A
(only)168 3372 A
3582(1)S
(time.)210 3666 A
5445 V
(26856)210 1122 A
1566(*/)S
5535 V
(26857)210 1122 A
(count)210 1524 A
1776(=)S
1860(0;)S
5625 V
(26858)210 1122 A
(for)126 1524 A
(\(rip)168 1692 A
1902(=)S
(&inode[0];)420 1986 A
(rip<)168 2448 A
(&inode[NR_INODES];)756 2658 A
(rip++\))252 3456 A
5715 V
(26859)210 1122 A
1776(if)S
(\(rip->i_count)546 1902 A
2490(>)S
2574(0)S
2658(&&)S
(rip->i_dev)420 2784 A
3246(==)S
(dev\))168 3372 A
(count)210 3582 A
3834(+=)S
(rip->i_count;)546 3960 A
5805 V
(26860)210 1122 A
1524(if)S
(\(count)252 1650 A
1944(>)S
2028(1\))S
(return\(EBUSY\);)588 2154 A
2784(/*)S
(can't)210 2910 A
(umount)252 3162 A
3456(a)S
(busy)168 3540 A
(file)168 3750 A
(system)252 3960 A
4254(*/)S
5895 V
(26861)210 1122 A
5985 V
(26862)210 1122 A
1524(/*)S
(Find)168 1650 A
(the)126 1860 A
(super)210 2028 A
(block.)252 2280 A
2574(*/)S
6075 V
(26863)210 1122 A
1524(sp)S
1650(=)S
(NIL_SUPER;)420 1734 A
6165 V
(26864)210 1122 A
(for)126 1524 A
(\(sp1)168 1692 A
1902(=)S
(&super_block[0];)672 1986 A
(sp1)126 2700 A
2868(<)S
(&super_block[NR_SUPERS];)1008 2952 A
(sp1++\))252 4002 A
4296({)S
6255 V
(26865)210 1122 A
1776(if)S
(\(sp1->s_dev)462 1902 A
2406(==)S
(dev\))168 2532 A
2742({)S
6345 V
(26866)210 1122 A
2112(sp)S
2238(=)S
(sp1;)168 2322 A
6435 V
(26867)210 1122 A
(break;)252 2112 A
6525 V
(26868)210 1122 A
1776(})S
6615 V
(26869)210 1122 A
1524(})S
6705 V
(26870)210 1122 A
6795 V
(26871)210 1122 A
1524(/*)S
(Sync)168 1650 A
(the)126 1860 A
(disk,)210 2028 A
(and)126 2280 A
(invalidate)420 2448 A
(cache.)252 2910 A
3204(*/)S
6885 V
(26872)210 1122 A
(\(void\))252 1524 A
(do_sync\(\);)420 1818 A
2784(/*)S
(force)210 2910 A
(any)126 3162 A
(cached)252 3330 A
(blocks)252 3624 A
(out)126 3918 A
4086(of)S
(memory)252 4212 A
4506(*/)S
6975 V
(26873)210 1122 A
(invalidate\(dev\);)672 1524 A
2784(/*)S
(invalidate)420 2910 A
(cache)210 3372 A
(entries)294 3624 A
(for)126 3960 A
(this)168 4128 A
(dev)126 4338 A
4506(*/)S
7065 V
(26874)210 1122 A
1524(if)S
(\(sp)126 1650 A
1818(==)S
(NIL_SUPER\))420 1944 A
2406({)S
8418 V
EP
%%Page: 365 365
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2355(File:)S
(servers/fs/mount.c)817 2588 A
12 B
(365)180 4500 A
1755 V
7 LST
(26875)210 1122 A
(return\(EINVAL\);)630 1776 A
1845 V
(26876)210 1122 A
1524(})S
1935 V
(26877)210 1122 A
2025 V
(26878)210 1122 A
1524(/*)S
(Close)210 1650 A
(the)126 1902 A
(device)252 2070 A
(the)126 2364 A
(file)168 2532 A
(system)252 2742 A
(lives)210 3036 A
(on.)126 3288 A
3456(*/)S
2115 V
(26879)210 1122 A
(dev_close\(dev\);)630 1524 A
2205 V
(26880)210 1122 A
2295 V
(26881)210 1122 A
1524(/*)S
(Finish)252 1650 A
(off)126 1944 A
(the)126 2112 A
(unmount.)336 2280 A
2658(*/)S
2385 V
(26882)210 1122 A
(sp->s_imount->i_mount)882 1524 A
2448(=)S
(NO_MOUNT;)378 2532 A
3120(/*)S
(inode)210 3246 A
(returns)294 3498 A
3834(to)S
(normal)252 3960 A
4254(*/)S
2475 V
(26883)210 1122 A
(put_inode\(sp->s_imount\);)1008 1524 A
2784(/*)S
(release)294 2910 A
(the)126 3246 A
(inode)210 3414 A
(mounted)294 3666 A
4002(on)S
4128(*/)S
2565 V
(26884)210 1122 A
(put_inode\(sp->s_isup\);)924 1524 A
2784(/*)S
(release)294 2910 A
(the)126 3246 A
(root)168 3414 A
(inode)210 3624 A
3876(of)S
(the)126 4002 A
(mounted)294 4170 A
4506(fs)S
4632(*/)S
2655 V
(26885)210 1122 A
(sp->s_imount)504 1524 A
2070(=)S
(NIL_INODE;)420 2154 A
2745 V
(26886)210 1122 A
(sp->s_dev)378 1524 A
1944(=)S
(NO_DEV;)294 2028 A
2835 V
(26887)210 1122 A
(return\(OK\);)462 1524 A
2925 V
(26888)210 1122 A
1440(})S
3105 V
(26890)210 1122 A
(/*===========================================================================*)3276 1440 A
3195 V
(26891)210 1122 A
1482(*)S
(name_to_dev)462 2784 A
4674(*)S
3285 V
(26892)210 1122 A
(*===========================================================================*/)3276 1482 A
3375 V
(26893)210 1122 A
(PRIVATE)294 1440 A
(dev_t)210 1776 A
(name_to_dev\(path\))714 2028 A
3465 V
(26894)210 1122 A
(char)168 1440 A
(*path;)252 1650 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(path)168 3372 A
(name)168 3582 A
3792(*/)S
3555 V
(26895)210 1122 A
1440({)S
3645 V
(26896)210 1122 A
1440(/*)S
(Convert)294 1566 A
(the)126 1902 A
(block)210 2070 A
(special)294 2322 A
(file)168 2658 A
('path')252 2868 A
3162(to)S
3288(a)S
(device)252 3372 A
(number.)294 3666 A
4044(If)S
('path')252 4170 A
3735 V
(26897)210 1122 A
1482(*)S
1566(is)S
(not)126 1692 A
1860(a)S
(block)210 1944 A
(special)294 2196 A
(file,)210 2532 A
(return)252 2784 A
(error)210 3078 A
(code)168 3330 A
3540(in)S
('err_code'.)462 3666 A
3825 V
(26898)210 1122 A
1482(*/)S
3915 V
(26899)210 1122 A
4005 V
(26900)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
4095 V
(26901)210 1122 A
(register)336 1524 A
(dev_t)210 1902 A
(dev;)168 2154 A
4185 V
(26902)210 1122 A
4275 V
(26903)210 1122 A
1524(/*)S
1650(If)S
('path')252 1776 A
(can't)210 2070 A
2322(be)S
(opened,)294 2448 A
(give)168 2784 A
2994(up)S
(immediately.)504 3120 A
3666(*/)S
4365 V
(26904)210 1122 A
1524(if)S
1650(\()S
(\(rip)168 1734 A
1944(=)S
(eat_path\(path\)\))630 2028 A
2700(==)S
(NIL_INODE\))420 2826 A
(return\(NO_DEV\);)630 3288 A
4455 V
(26905)210 1122 A
4545 V
(26906)210 1122 A
1524(/*)S
1650(If)S
('path')252 1776 A
2070(is)S
(not)126 2196 A
2364(a)S
(block)210 2448 A
(special)294 2700 A
(file,)210 3036 A
(return)252 3288 A
(error.)252 3582 A
3876(*/)S
4635 V
(26907)210 1122 A
1524(if)S
1650(\()S
(\(rip->i_mode)504 1734 A
2280(&)S
(I_TYPE\))294 2364 A
2700(!=)S
(I_BLOCK_SPECIAL\))672 2826 A
3540({)S
4725 V
(26908)210 1122 A
(err_code)336 1776 A
2154(=)S
(ENOTBLK;)336 2238 A
4815 V
(26909)210 1122 A
(put_inode\(rip\);)630 1776 A
4905 V
(26910)210 1122 A
(return\(NO_DEV\);)630 1776 A
4995 V
(26911)210 1122 A
1524(})S
5085 V
(26912)210 1122 A
5175 V
(26913)210 1122 A
1524(/*)S
(Extract)294 1650 A
(the)126 1986 A
(device)252 2154 A
(number.)294 2448 A
2784(*/)S
5265 V
(26914)210 1122 A
(dev)126 1524 A
1692(=)S
(\(dev_t\))294 1776 A
(rip->i_zone[0];)630 2112 A
5355 V
(26915)210 1122 A
(put_inode\(rip\);)630 1524 A
5445 V
(26916)210 1122 A
(return\(dev\);)504 1524 A
5535 V
(26917)210 1122 A
1440(})S
5895 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5985 V
(servers/fs/link.c)714 2676 A
6075 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6255 V
(27000)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(handles)294 1986 A
(the)126 2322 A
(LINK)168 2490 A
(and)126 2700 A
(UNLINK)252 2868 A
(system)252 3162 A
(calls.)252 3456 A
3792(It)S
(also)168 3918 A
(deals)210 4128 A
(with)168 4380 A
6345 V
(27001)210 1122 A
1482(*)S
(deallocating)504 1566 A
(the)126 2112 A
(storage)294 2280 A
(used)168 2616 A
2826(by)S
2952(a)S
(file)168 3036 A
(when)168 3246 A
(the)126 3456 A
(last)168 3624 A
(UNLINK)252 3834 A
4128(is)S
(done)168 4254 A
4464(to)S
4590(a)S
6435 V
(27002)210 1122 A
1482(*)S
(file)168 1566 A
(and)126 1776 A
(the)126 1944 A
(blocks)252 2112 A
(must)168 2406 A
2616(be)S
(returned)336 2742 A
3120(to)S
(the)126 3246 A
(free)168 3414 A
(block)210 3624 A
(pool.)210 3876 A
6525 V
(27003)210 1122 A
1482(*)S
6615 V
(27004)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are)126 2910 A
6705 V
(27005)210 1122 A
1482(*)S
(do_link:)336 1650 A
(perform)294 2112 A
(the)126 2448 A
(LINK)168 2616 A
(system)252 2826 A
(call)168 3120 A
6795 V
(27006)210 1122 A
1482(*)S
(do_unlink:)420 1650 A
(perform)294 2112 A
(the)126 2448 A
(UNLINK)252 2616 A
(and)126 2910 A
(RMDIR)210 3078 A
(system)252 3330 A
(calls)210 3624 A
6885 V
(27007)210 1122 A
1482(*)S
(do_rename:)420 1650 A
(perform)294 2112 A
(the)126 2448 A
(RENAME)252 2616 A
(system)252 2910 A
(call)168 3204 A
6975 V
(27008)210 1122 A
1482(*)S
(truncate:)378 1650 A
(release)294 2112 A
(all)126 2448 A
(the)126 2616 A
(blocks)252 2784 A
(associated)420 3078 A
(with)168 3540 A
3750(an)S
(inode)210 3876 A
7065 V
(27009)210 1122 A
1482(*/)S
8418 V
EP
%%Page: 366 366
BP
/slant 0 def
/height 0 def
1485 V
12 B
(366)180 1080 A
11 R
2410(File:)S
(servers/fs/link.c)707 2643 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(27010)210 1122 A
1845 V
(27011)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
1935 V
(27012)210 1122 A
(#include)336 1440 A
(<sys/stat.h>)504 1818 A
2025 V
(27013)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
2115 V
(27014)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
2205 V
(27015)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
2295 V
(27016)210 1122 A
(#include)336 1440 A
("buf.h")294 1818 A
2385 V
(27017)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
2475 V
(27018)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
2565 V
(27019)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
2655 V
(27020)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
2745 V
(27021)210 1122 A
(#include)336 1440 A
("super.h")378 1818 A
2835 V
(27022)210 1122 A
2925 V
(27023)210 1122 A
(#define)294 1440 A
(SAME)168 1776 A
(1000)168 1986 A
3015 V
(27024)210 1122 A
3105 V
(27025)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(remove_dir,)462 2448 A
(\(struct)294 2952 A
(inode)210 3288 A
(*rldirp,)336 3540 A
(struct)252 3918 A
(inode)210 4212 A
(*rip,)210 4464 A
3195 V
(27026)210 1122 A
(char)168 2448 A
(dir_name[NAME_MAX]\))798 2658 A
4464(\);)S
3285 V
(27027)210 1122 A
3375 V
(27028)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(unlink_file,)504 2448 A
(\(struct)294 2994 A
(inode)210 3330 A
(*dirp,)252 3582 A
(struct)252 3876 A
(inode)210 4170 A
(*rip,)210 4422 A
3465 V
(27029)210 1122 A
(char)168 2448 A
(file_name[NAME_MAX]\))840 2658 A
4464(\);)S
3555 V
(27030)210 1122 A
3645 V
(27031)210 1122 A
(/*===========================================================================*)3276 1440 A
3735 V
(27032)210 1122 A
1482(*)S
(do_link)294 2784 A
4674(*)S
3825 V
(27033)210 1122 A
(*===========================================================================*/)3276 1482 A
3915 V
(27034)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_link\(\))378 1902 A
4005 V
(27035)210 1122 A
1440({)S
4095 V
(27036)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(link\(name1,)462 2070 A
(name2\))252 2574 A
(system)252 2868 A
(call.)210 3162 A
3414(*/)S
4185 V
(27037)210 1122 A
4275 V
(27038)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*ip,)168 2448 A
(*rip;)210 2658 A
4365 V
(27039)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(r;)S
4455 V
(27040)210 1122 A
(char)168 1524 A
(string[NAME_MAX];)714 1734 A
4545 V
(27041)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*new_ip;)336 2070 A
4635 V
(27042)210 1122 A
4725 V
(27043)210 1122 A
1524(/*)S
(See)126 1650 A
1818(if)S
('name')252 1944 A
(\(file)210 2238 A
2490(to)S
2616(be)S
(linked\))294 2742 A
(exists.)294 3078 A
3414(*/)S
4815 V
(27044)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name1,)966 1650 A
(m_in.name1_length,)756 2658 A
(M1\))126 3456 A
3624(!=)S
(OK\))126 3750 A
(return\(err_code\);)714 3918 A
4905 V
(27045)210 1122 A
1524(if)S
1650(\()S
(\(rip)168 1734 A
1944(=)S
(eat_path\(user_path\)\))840 2028 A
2910(==)S
(NIL_INODE\))420 3036 A
(return\(err_code\);)714 3498 A
4995 V
(27046)210 1122 A
5085 V
(27047)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(to)S
(see)126 2028 A
2196(if)S
(the)126 2322 A
(file)168 2490 A
(has)126 2700 A
(maximum)294 2868 A
(number)252 3204 A
3498(of)S
(links)210 3624 A
(already.)336 3876 A
4254(*/)S
5175 V
(27048)210 1122 A
1524(r)S
1608(=)S
(OK;)126 1692 A
5265 V
(27049)210 1122 A
1524(if)S
(\(rip->i_nlinks)588 1650 A
2280(>=)S
(\(rip->i_sp->s_version)882 2406 A
3330(==)S
3456(V1)S
3582(?)S
(CHAR_MAX)336 3666 A
4044(:)S
(SHRT_MAX\)\))420 4128 A
5355 V
(27050)210 1122 A
1776(r)S
1860(=)S
(EMLINK;)294 1944 A
5445 V
(27051)210 1122 A
5535 V
(27052)210 1122 A
1524(/*)S
(Only)168 1650 A
(super_user)420 1860 A
(may)126 2322 A
(link)168 2490 A
2700(to)S
(directories.)504 2826 A
3372(*/)S
5625 V
(27053)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
5715 V
(27054)210 1122 A
1776(if)S
1902(\()S
(\(rip->i_mode)504 1986 A
2532(&)S
(I_TYPE\))294 2616 A
2952(==)S
(I_DIRECTORY)462 3078 A
3582(&&)S
(!super_user\))504 3708 A
4254(r)S
4338(=)S
(EPERM;)252 4422 A
5805 V
(27055)210 1122 A
5895 V
(27056)210 1122 A
1524(/*)S
1650(If)S
(error)210 1776 A
(with)168 2028 A
('name',)294 2238 A
(return)252 2574 A
(the)126 2868 A
(inode.)252 3036 A
3330(*/)S
5985 V
(27057)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
2070({)S
6075 V
(27058)210 1122 A
(put_inode\(rip\);)630 1776 A
6165 V
(27059)210 1122 A
(return\(r\);)420 1776 A
6255 V
(27060)210 1122 A
1524(})S
6345 V
(27061)210 1122 A
6435 V
(27062)210 1122 A
1524(/*)S
(Does)168 1650 A
(the)126 1860 A
(final)210 2028 A
(directory)378 2280 A
2700(of)S
('name2')294 2826 A
(exist?)252 3162 A
3456(*/)S
6525 V
(27063)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name2,)966 1650 A
(m_in.name2_length,)756 2658 A
(M1\))126 3456 A
3624(!=)S
(OK\))126 3750 A
3918({)S
6615 V
(27064)210 1122 A
(put_inode\(rip\);)630 1776 A
6705 V
(27065)210 1122 A
(return\(err_code\);)714 1776 A
6795 V
(27066)210 1122 A
1524(})S
6885 V
(27067)210 1122 A
1524(if)S
1650(\()S
(\(ip)126 1734 A
1902(=)S
(last_dir\(user_path,)798 1986 A
(string\)\))336 2826 A
3204(==)S
(NIL_INODE\))420 3330 A
3792(r)S
3876(=)S
(err_code;)378 3960 A
6975 V
(27068)210 1122 A
7065 V
(27069)210 1122 A
1524(/*)S
1650(If)S
('name2')294 1776 A
(exists)252 2112 A
2406(in)S
(full)168 2532 A
(\(even)210 2742 A
2994(if)S
3120(no)S
(space\))252 3246 A
(set)126 3540 A
('r')126 3708 A
3876(to)S
(error.)252 4002 A
4296(*/)S
8418 V
EP
%%Page: 367 367
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2410(File:)S
(servers/fs/link.c)707 2643 A
12 B
(367)180 4500 A
1755 V
7 LST
(27070)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
2070({)S
1845 V
(27071)210 1122 A
1776(if)S
1902(\()S
(\(new_ip)294 1986 A
2322(=)S
(advance\(ip,)462 2406 A
(string\)\))336 2910 A
3288(==)S
(NIL_INODE\))420 3414 A
3876({)S
1935 V
(27072)210 1122 A
2112(r)S
2196(=)S
(err_code;)378 2280 A
2025 V
(27073)210 1122 A
2112(if)S
2238(\(r)S
2364(==)S
(ENOENT\))294 2490 A
2826(r)S
2910(=)S
(OK;)126 2994 A
2115 V
(27074)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
2205 V
(27075)210 1122 A
(put_inode\(new_ip\);)756 2112 A
2295 V
(27076)210 1122 A
2112(r)S
2196(=)S
(EEXIST;)294 2280 A
2385 V
(27077)210 1122 A
1776(})S
2475 V
(27078)210 1122 A
1524(})S
2565 V
(27079)210 1122 A
2655 V
(27080)210 1122 A
1524(/*)S
(Check)210 1650 A
(for)126 1902 A
(links)210 2070 A
(across)252 2322 A
(devices.)336 2616 A
2994(*/)S
2745 V
(27081)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
2835 V
(27082)210 1122 A
1776(if)S
(\(rip->i_dev)462 1902 A
2406(!=)S
(ip->i_dev\))420 2532 A
2994(r)S
3078(=)S
(EXDEV;)252 3162 A
2925 V
(27083)210 1122 A
3015 V
(27084)210 1122 A
1524(/*)S
(Try)126 1650 A
1818(to)S
(link.)210 1944 A
2196(*/)S
3105 V
(27085)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
3195 V
(27086)210 1122 A
1776(r)S
1860(=)S
(search_dir\(ip,)588 1944 A
(string,)294 2574 A
(&rip->i_num,)504 2910 A
(ENTER\);)294 3456 A
3285 V
(27087)210 1122 A
3375 V
(27088)210 1122 A
1524(/*)S
1650(If)S
(success,)336 1776 A
(register)336 2154 A
(the)126 2532 A
(linking.)336 2700 A
3078(*/)S
3465 V
(27089)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
2070({)S
3555 V
(27090)210 1122 A
(rip->i_nlinks++;)672 1776 A
3645 V
(27091)210 1122 A
(rip->i_update)546 1776 A
2364(|=)S
(CTIME;)252 2490 A
3735 V
(27092)210 1122 A
(rip->i_dirt)462 1776 A
2280(=)S
(DIRTY;)252 2364 A
3825 V
(27093)210 1122 A
1524(})S
3915 V
(27094)210 1122 A
4005 V
(27095)210 1122 A
1524(/*)S
(Done.)210 1650 A
(Release)294 1944 A
(both)168 2280 A
(inodes.)294 2490 A
2826(*/)S
4095 V
(27096)210 1122 A
(put_inode\(rip\);)630 1524 A
4185 V
(27097)210 1122 A
(put_inode\(ip\);)588 1524 A
4275 V
(27098)210 1122 A
(return\(r\);)420 1524 A
4365 V
(27099)210 1122 A
1440(})S
4545 V
(27101)210 1122 A
(/*===========================================================================*)3276 1440 A
4635 V
(27102)210 1122 A
1482(*)S
(do_unlink)378 2784 A
4674(*)S
4725 V
(27103)210 1122 A
(*===========================================================================*/)3276 1482 A
4815 V
(27104)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_unlink\(\))462 1902 A
4905 V
(27105)210 1122 A
1440({)S
4995 V
(27106)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(unlink\(name\))504 2070 A
2616(or)S
(rmdir\(name\))462 2742 A
(system)252 3246 A
(call.)210 3540 A
(The)126 3792 A
(code)168 3960 A
(for)126 4170 A
(these)210 4338 A
(two)126 4590 A
5085 V
(27107)210 1122 A
1482(*)S
1566(is)S
(almost)252 1692 A
(the)126 1986 A
(same.)210 2154 A
(They)168 2448 A
(differ)252 2658 A
(only)168 2952 A
3162(in)S
(some)168 3288 A
(condition)378 3498 A
(testing.)336 3918 A
(Unlink\(\))336 4338 A
5175 V
(27108)210 1122 A
1482(*)S
(may)126 1566 A
1734(be)S
(used)168 1860 A
2070(by)S
(the)126 2196 A
(superuser)378 2364 A
2784(to)S
2910(do)S
(dangerous)378 3036 A
(things;)294 3456 A
(rmdir\(\))294 3792 A
(may)126 4128 A
(not.)168 4296 A
5265 V
(27109)210 1122 A
1482(*/)S
5355 V
(27110)210 1122 A
5445 V
(27111)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
5535 V
(27112)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*rldirp;)336 2070 A
5625 V
(27113)210 1122 A
(int)126 1524 A
1692(r;)S
5715 V
(27114)210 1122 A
(char)168 1524 A
(string[NAME_MAX];)714 1734 A
5805 V
(27115)210 1122 A
5895 V
(27116)210 1122 A
1524(/*)S
(Get)126 1650 A
(the)126 1818 A
(last)168 1986 A
(directory)378 2196 A
2616(in)S
(the)126 2742 A
(path.)210 2910 A
3162(*/)S
5985 V
(27117)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name,)924 1650 A
(m_in.name_length,)714 2616 A
(M3\))126 3372 A
3540(!=)S
(OK\))126 3666 A
(return\(err_code\);)714 3834 A
6075 V
(27118)210 1122 A
1524(if)S
1650(\()S
(\(rldirp)294 1734 A
2070(=)S
(last_dir\(user_path,)798 2154 A
(string\)\))336 2994 A
3372(==)S
(NIL_INODE\))420 3498 A
6165 V
(27119)210 1122 A
(return\(err_code\);)714 1776 A
6255 V
(27120)210 1122 A
6345 V
(27121)210 1122 A
1524(/*)S
(The)126 1650 A
(last)168 1818 A
(directory)378 2028 A
(exists.)294 2448 A
(Does)168 2826 A
(the)126 3036 A
(file)168 3204 A
(also)168 3414 A
(exist?)252 3624 A
3918(*/)S
6435 V
(27122)210 1122 A
1524(r)S
1608(=)S
(OK;)126 1692 A
6525 V
(27123)210 1122 A
1524(if)S
1650(\()S
(\(rip)168 1734 A
1944(=)S
(advance\(rldirp,)630 2028 A
(string\)\))336 2700 A
3078(==)S
(NIL_INODE\))420 3204 A
3666(r)S
3750(=)S
(err_code;)378 3834 A
6615 V
(27124)210 1122 A
6705 V
(27125)210 1122 A
1524(/*)S
1650(If)S
(error,)252 1776 A
(return)252 2070 A
(inode.)252 2364 A
2658(*/)S
6795 V
(27126)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
2070({)S
6885 V
(27127)210 1122 A
(put_inode\(rldirp\);)756 1776 A
6975 V
(27128)210 1122 A
(return\(r\);)420 1776 A
7065 V
(27129)210 1122 A
1524(})S
8418 V
EP
%%Page: 368 368
BP
/slant 0 def
/height 0 def
1485 V
12 B
(368)180 1080 A
11 R
2410(File:)S
(servers/fs/link.c)707 2643 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(27130)210 1122 A
1845 V
(27131)210 1122 A
1524(/*)S
1650(Do)S
(not)126 1776 A
(remove)252 1944 A
2238(a)S
(mount)210 2322 A
(point.)252 2574 A
2868(*/)S
1935 V
(27132)210 1122 A
1524(if)S
(\(rip->i_num)462 1650 A
2154(==)S
(ROOT_INODE\))462 2280 A
2784({)S
2025 V
(27133)210 1122 A
(put_inode\(rldirp\);)756 1776 A
2115 V
(27134)210 1122 A
(put_inode\(rip\);)630 1776 A
2205 V
(27135)210 1122 A
(return\(EBUSY\);)588 1776 A
2295 V
(27136)210 1122 A
1524(})S
2385 V
(27137)210 1122 A
2475 V
(27138)210 1122 A
1524(/*)S
(Now)126 1650 A
(test)168 1818 A
2028(if)S
(the)126 2154 A
(call)168 2322 A
2532(is)S
(allowed,)336 2658 A
(separately)420 3036 A
(for)126 3498 A
(unlink\(\))336 3666 A
(and)126 4044 A
(rmdir\(\).)336 4212 A
4590(*/)S
2565 V
(27139)210 1122 A
1524(if)S
(\(call_nr)336 1650 A
2028(==)S
(UNLINK\))294 2154 A
2490({)S
2655 V
(27140)210 1122 A
1776(/*)S
(Only)168 1902 A
(the)126 2112 A
2280(su)S
(may)126 2406 A
(unlink)252 2574 A
(directories,)504 2868 A
(but)126 3414 A
(the)126 3582 A
3750(su)S
(can)126 3876 A
(unlink)252 4044 A
(any)126 4338 A
(dir.*/)252 4506 A
2745 V
(27141)210 1122 A
1776(if)S
1902(\()S
(\(rip->i_mode)504 1986 A
2532(&)S
(I_TYPE\))294 2616 A
2952(==)S
(I_DIRECTORY)462 3078 A
3582(&&)S
(!super_user\))504 3708 A
4254(r)S
4338(=)S
(EPERM;)252 4422 A
2835 V
(27142)210 1122 A
2925 V
(27143)210 1122 A
1776(/*)S
(Don't)210 1902 A
(unlink)252 2154 A
2448(a)S
(file)168 2532 A
2742(if)S
2868(it)S
2994(is)S
(the)126 3120 A
(root)168 3288 A
3498(of)S
3624(a)S
(mounted)294 3708 A
(file)168 4044 A
(system.)294 4254 A
4590(*/)S
3015 V
(27144)210 1122 A
1776(if)S
(\(rip->i_num)462 1902 A
2406(==)S
(ROOT_INODE\))462 2532 A
3036(r)S
3120(=)S
(EBUSY;)252 3204 A
3105 V
(27145)210 1122 A
3195 V
(27146)210 1122 A
1776(/*)S
(Actually)336 1902 A
(try)126 2280 A
2448(to)S
(unlink)252 2574 A
(the)126 2868 A
(file;)210 3036 A
(fails)210 3288 A
3540(if)S
(parent)252 3666 A
3960(is)S
(mode)168 4086 A
4296(0)S
(etc.)168 4380 A
4590(*/)S
3285 V
(27147)210 1122 A
1776(if)S
1902(\(r)S
2028(==)S
(OK\))126 2154 A
2322(r)S
2406(=)S
(unlink_file\(rldirp,)798 2490 A
(rip,)168 3330 A
(string\);)336 3540 A
3375 V
(27148)210 1122 A
3465 V
(27149)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3555 V
(27150)210 1122 A
1776(r)S
1860(=)S
(remove_dir\(rldirp,)756 1944 A
(rip,)168 2742 A
(string\);)336 2952 A
3330(/*)S
(call)168 3456 A
3666(is)S
(RMDIR)210 3792 A
4044(*/)S
3645 V
(27151)210 1122 A
1524(})S
3735 V
(27152)210 1122 A
3825 V
(27153)210 1122 A
1524(/*)S
1650(If)S
(unlink)252 1776 A
(was)126 2070 A
(possible,)378 2238 A
2658(it)S
(has)126 2784 A
(been)168 2952 A
(done,)210 3162 A
(otherwise)378 3414 A
3834(it)S
(has)126 3960 A
(not.)168 4128 A
4338(*/)S
3915 V
(27154)210 1122 A
(put_inode\(rip\);)630 1524 A
4005 V
(27155)210 1122 A
(put_inode\(rldirp\);)756 1524 A
4095 V
(27156)210 1122 A
(return\(r\);)420 1524 A
4185 V
(27157)210 1122 A
1440(})S
4365 V
(27159)210 1122 A
(/*===========================================================================*)3276 1440 A
4455 V
(27160)210 1122 A
1482(*)S
(do_rename)378 2784 A
4674(*)S
4545 V
(27161)210 1122 A
(*===========================================================================*/)3276 1482 A
4635 V
(27162)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_rename\(\))462 1902 A
4725 V
(27163)210 1122 A
1440({)S
4815 V
(27164)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(rename\(name1,)546 2070 A
(name2\))252 2658 A
(system)252 2952 A
(call.)210 3246 A
3498(*/)S
4905 V
(27165)210 1122 A
4995 V
(27166)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*old_dirp,)420 2070 A
(*old_ip;)336 2532 A
3120(/*)S
(ptrs)168 3246 A
3456(to)S
(old)126 3582 A
(dir,)168 3750 A
(file)168 3960 A
(inodes)252 4170 A
4464(*/)S
5085 V
(27167)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*new_dirp,)420 2070 A
(*new_ip;)336 2532 A
3120(/*)S
(ptrs)168 3246 A
3456(to)S
(new)126 3582 A
(dir,)168 3750 A
(file)168 3960 A
(inodes)252 4170 A
4464(*/)S
5175 V
(27168)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*new_superdirp,)630 2070 A
(*next_new_superdirp;)840 2742 A
5265 V
(27169)210 1122 A
(int)126 1524 A
1692(r)S
1776(=)S
(OK;)126 1860 A
3120(/*)S
(error)210 3246 A
(flag;)210 3498 A
(initially)378 3750 A
4170(no)S
(error)210 4296 A
4548(*/)S
5355 V
(27170)210 1122 A
(int)126 1524 A
(odir,)210 1692 A
(ndir;)210 1944 A
3120(/*)S
(TRUE)168 3246 A
(iff)126 3456 A
({old|new})378 3624 A
(file)168 4044 A
4254(is)S
(dir)126 4380 A
4548(*/)S
5445 V
(27171)210 1122 A
(int)126 1524 A
(same_pdir;)420 1692 A
3120(/*)S
(TRUE)168 3246 A
(iff)126 3456 A
(parent)252 3624 A
(dirs)168 3918 A
(are)126 4128 A
(the)126 4296 A
(same)168 4464 A
4674(*/)S
5535 V
(27172)210 1122 A
(char)168 1524 A
(old_name[NAME_MAX],)798 1734 A
(new_name[NAME_MAX];)798 2574 A
5625 V
(27173)210 1122 A
(ino_t)210 1524 A
(numb;)210 1776 A
5715 V
(27174)210 1122 A
(int)126 1524 A
(r1;)126 1692 A
5805 V
(27175)210 1122 A
5895 V
(27176)210 1122 A
1524(/*)S
(See)126 1650 A
1818(if)S
('name1')294 1944 A
(\(existing)378 2280 A
(file\))210 2700 A
(exists.)294 2952 A
(Get)126 3330 A
(dir)126 3498 A
(and)126 3666 A
(file)168 3834 A
(inodes.)294 4044 A
4380(*/)S
5985 V
(27177)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name1,)966 1650 A
(m_in.name1_length,)756 2658 A
(M1\))126 3456 A
3624(!=)S
(OK\))126 3750 A
(return\(err_code\);)714 3918 A
6075 V
(27178)210 1122 A
1524(if)S
1650(\()S
(\(old_dirp)378 1734 A
2154(=)S
(last_dir\(user_path,)798 2238 A
(old_name\)\)==NIL_INODE\))924 3078 A
(return\(err_code\);)714 4044 A
6165 V
(27179)210 1122 A
6255 V
(27180)210 1122 A
1524(if)S
1650(\()S
(\(old_ip)294 1734 A
2070(=)S
(advance\(old_dirp,)714 2154 A
(old_name\)\))420 2910 A
3372(==)S
(NIL_INODE\))420 3498 A
3960(r)S
4044(=)S
(err_code;)378 4128 A
6345 V
(27181)210 1122 A
6435 V
(27182)210 1122 A
1524(/*)S
(See)126 1650 A
1818(if)S
('name2')294 1944 A
(\(new)168 2280 A
(name\))210 2490 A
(exists.)294 2742 A
(Get)126 3120 A
(dir)126 3288 A
(and)126 3456 A
(file)168 3624 A
(inodes.)294 3834 A
4170(*/)S
6525 V
(27183)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name2,)966 1650 A
(m_in.name2_length,)756 2658 A
(M1\))126 3456 A
3624(!=)S
(OK\))126 3750 A
3918(r)S
4002(=)S
(err_code;)378 4086 A
6615 V
(27184)210 1122 A
1524(if)S
1650(\()S
(\(new_dirp)378 1734 A
2154(=)S
(last_dir\(user_path,)798 2238 A
(new_name\)\))420 3078 A
3540(==)S
(NIL_INODE\))420 3666 A
4128(r)S
4212(=)S
(err_code;)378 4296 A
6705 V
(27185)210 1122 A
(new_ip)252 1524 A
1818(=)S
(advance\(new_dirp,)714 1902 A
(new_name\);)420 2658 A
3120(/*)S
(not)126 3246 A
(required)336 3414 A
3792(to)S
(exist)210 3918 A
4170(*/)S
6795 V
(27186)210 1122 A
6885 V
(27187)210 1122 A
1524(if)S
(\(old_ip)294 1650 A
1986(!=)S
(NIL_INODE\))420 2112 A
6975 V
(27188)210 1122 A
(odir)168 1776 A
1986(=)S
(\(\(old_ip->i_mode)672 2070 A
2784(&)S
(I_TYPE\))294 2868 A
3204(==)S
(I_DIRECTORY\);)546 3330 A
3960(/*)S
(TRUE)168 4086 A
(iff)126 4296 A
(dir)126 4464 A
4632(*/)S
7065 V
(27189)210 1122 A
8418 V
EP
%%Page: 369 369
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2410(File:)S
(servers/fs/link.c)707 2643 A
12 B
(369)180 4500 A
1755 V
7 LST
(27190)210 1122 A
1524(/*)S
1650(If)S
1776(it)S
1902(is)S
(ok,)126 2028 A
(check)210 2196 A
(for)126 2448 A
2616(a)S
(variety)294 2700 A
3036(of)S
(possible)336 3162 A
(errors.)294 3540 A
3876(*/)S
1845 V
(27191)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
2070({)S
1935 V
(27192)210 1122 A
(same_pdir)378 1776 A
2196(=)S
(\(old_dirp)378 2280 A
2700(==)S
(new_dirp\);)420 2826 A
2025 V
(27193)210 1122 A
2115 V
(27194)210 1122 A
1776(/*)S
(The)126 1902 A
(old)126 2070 A
(inode)210 2238 A
(must)168 2490 A
(not)126 2700 A
2868(be)S
2994(a)S
(superdirectory)588 3078 A
3708(of)S
(the)126 3834 A
(new)126 4002 A
(last)168 4170 A
(dir.)168 4380 A
4590(*/)S
2205 V
(27195)210 1122 A
1776(if)S
(\(odir)210 1902 A
2154(&&)S
(!same_pdir\))462 2280 A
2784({)S
2295 V
(27196)210 1122 A
(dup_inode\(new_superdirp)966 2112 A
3120(=)S
(new_dirp\);)420 3204 A
2385 V
(27197)210 1122 A
(while)210 2112 A
(\(TRUE\))252 2364 A
2658({)S
3120(/*)S
(may)126 3246 A
(hang)168 3414 A
3624(in)S
3750(a)S
(file)168 3834 A
(system)252 4044 A
(loop)168 4338 A
4548(*/)S
2475 V
(27198)210 1122 A
2448(if)S
(\(new_superdirp)588 2574 A
3204(==)S
(old_ip\))294 3330 A
3666({)S
2565 V
(27199)210 1122 A
2784(r)S
2868(=)S
(EINVAL;)294 2952 A
2655 V
(27200)210 1122 A
(break;)252 2784 A
2745 V
(27201)210 1122 A
2448(})S
2835 V
(27202)210 1122 A
(next_new_superdirp)756 2448 A
3246(=)S
(advance\(new_superdirp,)924 3330 A
(dot2\);)252 4296 A
2925 V
(27203)210 1122 A
(put_inode\(new_superdirp\);)1050 2448 A
3015 V
(27204)210 1122 A
2448(if)S
(\(next_new_superdirp)798 2574 A
3414(==)S
(new_superdirp\))588 3540 A
3105 V
(27205)210 1122 A
(break;)252 2784 A
3120(/*)S
(back)168 3246 A
3456(at)S
(system)252 3582 A
(root)168 3876 A
(directory)378 4086 A
4506(*/)S
3195 V
(27206)210 1122 A
(new_superdirp)546 2448 A
3036(=)S
(next_new_superdirp;)798 3120 A
3285 V
(27207)210 1122 A
2448(if)S
(\(new_superdirp)588 2574 A
3204(==)S
(NIL_INODE\))420 3330 A
3792({)S
3375 V
(27208)210 1122 A
2784(/*)S
(Missing)294 2910 A
("..")168 3246 A
(entry.)252 3456 A
(Assume)252 3792 A
(the)126 4086 A
(worst.)252 4254 A
4548(*/)S
3465 V
(27209)210 1122 A
2784(r)S
2868(=)S
(EINVAL;)294 2952 A
3555 V
(27210)210 1122 A
(break;)252 2784 A
3645 V
(27211)210 1122 A
2448(})S
3735 V
(27212)210 1122 A
2112(})S
3825 V
(27213)210 1122 A
(put_inode\(new_superdirp\);)1050 2112 A
3915 V
(27214)210 1122 A
1776(})S
4005 V
(27215)210 1122 A
4095 V
(27216)210 1122 A
1776(/*)S
(The)126 1902 A
(old)126 2070 A
2238(or)S
(new)126 2364 A
(name)168 2532 A
(must)168 2742 A
(not)126 2952 A
3120(be)S
3246(.)S
3330(or)S
3456(..)S
3582(*/)S
4185 V
(27217)210 1122 A
1776(if)S
(\(strcmp\(old_name,)714 1902 A
("."\)==0)294 2658 A
2994(||)S
(strcmp\(old_name,)672 3120 A
(".."\)==0)336 3834 A
4212(||)S
4275 V
(27218)210 1122 A
(strcmp\(new_name,)672 1944 A
("."\)==0)294 2658 A
2994(||)S
(strcmp\(new_name,)672 3120 A
(".."\)==0\))378 3834 A
4254(r)S
4338(=)S
(EINVAL;)294 4422 A
4365 V
(27219)210 1122 A
4455 V
(27220)210 1122 A
1776(/*)S
(Both)168 1902 A
(parent)252 2112 A
(directories)462 2406 A
(must)168 2910 A
3120(be)S
3246(on)S
(the)126 3372 A
(same)168 3540 A
(device.)294 3750 A
4086(*/)S
4545 V
(27221)210 1122 A
1776(if)S
(\(old_dirp->i_dev)672 1902 A
2616(!=)S
(new_dirp->i_dev\))672 2742 A
3456(r)S
3540(=)S
(EXDEV;)252 3624 A
4635 V
(27222)210 1122 A
4725 V
(27223)210 1122 A
1776(/*)S
(Parent)252 1902 A
(dirs)168 2196 A
(must)168 2406 A
2616(be)S
(writable,)378 2742 A
(searchable)420 3162 A
(and)126 3624 A
3792(on)S
3918(a)S
(writable)336 4002 A
(device)252 4380 A
4674(*/)S
4815 V
(27224)210 1122 A
1776(if)S
(\(\(r1)168 1902 A
2112(=)S
(forbidden\(old_dirp,)798 2196 A
(W_BIT)210 3036 A
3288(|)S
(X_BIT\)\))294 3372 A
3708(!=)S
3834(OK)S
3960(||)S
4905 V
(27225)210 1122 A
(\(r1)126 1944 A
2112(=)S
(forbidden\(new_dirp,)798 2196 A
(W_BIT)210 3036 A
3288(|)S
(X_BIT\)\))294 3372 A
3708(!=)S
(OK\))126 3834 A
4002(r)S
4086(=)S
(r1;)126 4170 A
4995 V
(27226)210 1122 A
5085 V
(27227)210 1122 A
1776(/*)S
(Some)168 1902 A
(tests)210 2112 A
(apply)210 2364 A
(only)168 2616 A
2826(if)S
(the)126 2952 A
(new)126 3120 A
(path)168 3288 A
(exists.)294 3498 A
3834(*/)S
5175 V
(27228)210 1122 A
1776(if)S
(\(new_ip)294 1902 A
2238(==)S
(NIL_INODE\))420 2364 A
2826({)S
5265 V
(27229)210 1122 A
2112(/*)S
(don't)210 2238 A
(rename)252 2490 A
2784(a)S
(file)168 2868 A
(with)168 3078 A
3288(a)S
(file)168 3372 A
(system)252 3582 A
(mounted)294 3876 A
4212(on)S
(it.)126 4338 A
4506(*/)S
5355 V
(27230)210 1122 A
2112(if)S
(\(old_ip->i_dev)588 2238 A
2868(!=)S
(old_dirp->i_dev\))672 2994 A
3708(r)S
3792(=)S
(EXDEV;)252 3876 A
5445 V
(27231)210 1122 A
2112(if)S
(\(odir)210 2238 A
2490(&&)S
(new_dirp->i_nlinks)756 2616 A
3414(>=)S
5535 V
(27232)210 1122 A
(\(new_dirp->i_sp->s_version)1092 2280 A
3414(==)S
3540(V1)S
3666(?)S
(CHAR_MAX)336 3750 A
4128(:)S
(SHRT_MAX\))378 4212 A
4632(&&)S
5625 V
(27233)210 1122 A
(!same_pdir)420 2280 A
2742(&&)S
2868(r)S
2952(==)S
(OK\))126 3078 A
3246(r)S
3330(=)S
(EMLINK;)294 3414 A
5715 V
(27234)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
5805 V
(27235)210 1122 A
2112(if)S
(\(old_ip)294 2238 A
2574(==)S
(new_ip\))294 2700 A
3036(r)S
3120(=)S
(SAME;)210 3204 A
3456(/*)S
(old=new)294 3582 A
3918(*/)S
5895 V
(27236)210 1122 A
5985 V
(27237)210 1122 A
2112(/*)S
(has)126 2238 A
(the)126 2406 A
(old)126 2574 A
(file)168 2742 A
2952(or)S
(new)126 3078 A
(file)168 3246 A
3456(a)S
(file)168 3540 A
(system)252 3750 A
(mounted)294 4044 A
4380(on)S
(it?)126 4506 A
4674(*/)S
6075 V
(27238)210 1122 A
2112(if)S
(\(old_ip->i_dev)588 2238 A
2868(!=)S
(new_ip->i_dev\))588 2994 A
3624(r)S
3708(=)S
(EXDEV;)252 3792 A
6165 V
(27239)210 1122 A
6255 V
(27240)210 1122 A
(ndir)168 2112 A
2322(=)S
(\(\(new_ip->i_mode)672 2406 A
3120(&)S
(I_TYPE\))294 3204 A
3540(==)S
(I_DIRECTORY\);)546 3666 A
4254(/*)S
(dir)126 4380 A
4548(?)S
4632(*/)S
6345 V
(27241)210 1122 A
2112(if)S
(\(odir)210 2238 A
2490(==)S
(TRUE)168 2616 A
2826(&&)S
(ndir)168 2952 A
3162(==)S
(FALSE\))252 3288 A
3582(r)S
3666(=)S
(ENOTDIR;)336 3750 A
6435 V
(27242)210 1122 A
2112(if)S
(\(odir)210 2238 A
2490(==)S
(FALSE)210 2616 A
2868(&&)S
(ndir)168 2994 A
3204(==)S
(TRUE\))210 3330 A
3582(r)S
3666(=)S
(EISDIR;)294 3750 A
6525 V
(27243)210 1122 A
1776(})S
6615 V
(27244)210 1122 A
1524(})S
6705 V
(27245)210 1122 A
6795 V
(27246)210 1122 A
1524(/*)S
1650(If)S
1776(a)S
(process)294 1860 A
(has)126 2196 A
(another)294 2364 A
(root)168 2700 A
(directory)378 2910 A
(than)168 3330 A
(the)126 3540 A
(system)252 3708 A
(root,)210 4002 A
4254(we)S
(might)210 4380 A
6885 V
(27247)210 1122 A
1566(*)S
("accidently")504 1650 A
2196(be)S
(moving)252 2322 A
(it's)168 2616 A
(working)294 2826 A
(directory)378 3162 A
3582(to)S
3708(a)S
(place)210 3792 A
(where)210 4044 A
(it's)168 4296 A
6975 V
(27248)210 1122 A
1566(*)S
(root)168 1650 A
(directory)378 1860 A
(isn't)210 2280 A
2532(a)S
(super)210 2616 A
(directory)378 2868 A
3288(of)S
3414(it)S
(anymore.)336 3540 A
(This)168 3918 A
(can)126 4128 A
(make)168 4296 A
7065 V
(27249)210 1122 A
1566(*)S
(the)126 1650 A
(function)336 1818 A
(chroot)252 2196 A
(useless.)336 2490 A
2868(If)S
(chroot)252 2994 A
(will)168 3288 A
3498(be)S
(used)168 3624 A
(often)210 3834 A
4086(we)S
(should)252 4212 A
8418 V
EP
%%Page: 370 370
BP
/slant 0 def
/height 0 def
1485 V
12 B
(370)180 1080 A
11 R
2410(File:)S
(servers/fs/link.c)707 2643 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(27250)210 1122 A
1566(*)S
(probably)336 1650 A
(check)210 2028 A
(for)126 2280 A
2448(it)S
(here.)210 2574 A
1845 V
(27251)210 1122 A
1566(*/)S
1935 V
(27252)210 1122 A
2025 V
(27253)210 1122 A
1524(/*)S
(The)126 1650 A
(rename)252 1818 A
(will)168 2112 A
(probably)336 2322 A
(work.)210 2700 A
(Only)168 2952 A
(two)126 3162 A
(things)252 3330 A
(can)126 3624 A
3792(go)S
(wrong)210 3918 A
(now:)168 4170 A
2115 V
(27254)210 1122 A
1566(*)S
1650(1.)S
(being)210 1776 A
(unable)252 2028 A
2322(to)S
(remove)252 2448 A
(the)126 2742 A
(new)126 2910 A
(file.)210 3078 A
(\(when)210 3330 A
(new)126 3582 A
(file)168 3750 A
(already)294 3960 A
(exists\))294 4296 A
2205 V
(27255)210 1122 A
1566(*)S
1650(2.)S
(being)210 1776 A
(unable)252 2028 A
2322(to)S
(make)168 2448 A
(the)126 2658 A
(new)126 2826 A
(directory)378 2994 A
(entry.)252 3414 A
(\(new)168 3708 A
(file)168 3918 A
(doesn't)294 4128 A
(exists\))294 4464 A
2295 V
(27256)210 1122 A
1566(*)S
([directory)420 1818 A
(has)126 2280 A
2448(to)S
(grow)168 2574 A
2784(by)S
(one)126 2910 A
(block)210 3078 A
(and)126 3330 A
(cannot)252 3498 A
(because)294 3792 A
(the)126 4128 A
(disk)168 4296 A
2385 V
(27257)210 1122 A
1566(*)S
1860(is)S
(completely)420 1986 A
(full].)252 2448 A
2475 V
(27258)210 1122 A
1566(*/)S
2565 V
(27259)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
2070({)S
2655 V
(27260)210 1122 A
1776(if)S
(\(new_ip)294 1902 A
2238(!=)S
(NIL_INODE\))420 2364 A
2826({)S
2745 V
(27261)210 1122 A
2196(/*)S
(There)210 2322 A
2574(is)S
(already)294 2700 A
3036(an)S
(entry)210 3162 A
(for)126 3414 A
('new'.)252 3582 A
(Try)126 3876 A
4044(to)S
(remove)252 4170 A
(it.)126 4464 A
4632(*/)S
2835 V
(27262)210 1122 A
2112(if)S
(\(odir\))252 2238 A
2925 V
(27263)210 1122 A
2448(r)S
2532(=)S
(remove_dir\(new_dirp,)840 2616 A
(new_ip,)294 3498 A
(new_name\);)420 3834 A
3015 V
(27264)210 1122 A
(else)168 2112 A
3105 V
(27265)210 1122 A
2448(r)S
2532(=)S
(unlink_file\(new_dirp,)882 2616 A
(new_ip,)294 3540 A
(new_name\);)420 3876 A
3195 V
(27266)210 1122 A
1776(})S
3285 V
(27267)210 1122 A
1776(/*)S
1902(if)S
2028(r)S
2112(is)S
(OK,)126 2238 A
(the)126 2406 A
(rename)252 2574 A
(will)168 2868 A
(succeed,)336 3078 A
(while)210 3456 A
(there)210 3708 A
3960(is)S
(now)126 4086 A
4254(an)S
3375 V
(27268)210 1122 A
1818(*)S
(unused)252 1902 A
(entry)210 2196 A
2448(in)S
(the)126 2574 A
(new)126 2742 A
(parent)252 2910 A
(directory.)420 3204 A
3465 V
(27269)210 1122 A
1818(*/)S
3555 V
(27270)210 1122 A
1524(})S
3645 V
(27271)210 1122 A
3735 V
(27272)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
2070({)S
3825 V
(27273)210 1122 A
1776(/*)S
1902(If)S
(the)126 2028 A
(new)126 2196 A
(name)168 2364 A
(will)168 2574 A
2784(be)S
2910(in)S
(the)126 3036 A
(same)168 3204 A
(parent)252 3414 A
(directory)378 3708 A
4128(as)S
(the)126 4254 A
(old)126 4422 A
(one,)168 4590 A
3915 V
(27274)210 1122 A
1818(*)S
(first)210 1902 A
(remove)252 2154 A
(the)126 2448 A
(old)126 2616 A
(name)168 2784 A
2994(to)S
(free)168 3120 A
3330(an)S
(entry)210 3456 A
(for)126 3708 A
(the)126 3876 A
(new)126 4044 A
(name,)210 4212 A
4005 V
(27275)210 1122 A
1818(*)S
(otherwise)378 1902 A
(first)210 2322 A
(try)126 2574 A
2742(to)S
(create)252 2868 A
(the)126 3162 A
(new)126 3330 A
(name)168 3498 A
(entry)210 3708 A
3960(to)S
(make)168 4086 A
(sure)168 4296 A
4095 V
(27276)210 1122 A
1818(*)S
(the)126 1902 A
(rename)252 2070 A
(will)168 2364 A
(succeed.)336 2574 A
4185 V
(27277)210 1122 A
1818(*/)S
4275 V
(27278)210 1122 A
(numb)168 1776 A
1986(=)S
(old_ip->i_num;)588 2070 A
3120(/*)S
(inode)210 3246 A
(number)252 3498 A
3792(of)S
(old)126 3918 A
(file)168 4086 A
4296(*/)S
4365 V
(27279)210 1122 A
4455 V
(27280)210 1122 A
1776(if)S
(\(same_pdir\))462 1902 A
2406({)S
4545 V
(27281)210 1122 A
2112(r)S
2196(=)S
(search_dir\(old_dirp,)840 2280 A
(old_name,)378 3162 A
(\(ino_t)252 3582 A
3876(*\))S
4002(0,)S
(DELETE\);)336 4128 A
4635 V
(27282)210 1122 A
3456(/*)S
(shouldn't)378 3582 A
4002(go)S
(wrong.)252 4128 A
4422(*/)S
4725 V
(27283)210 1122 A
2112(if)S
(\(r==OK\))294 2238 A
(\(void\))252 2574 A
(search_dir\(old_dirp,)840 2868 A
(new_name,)378 3750 A
(&numb,)252 4170 A
(ENTER\);)294 4464 A
4815 V
(27284)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
4905 V
(27285)210 1122 A
2112(r)S
2196(=)S
(search_dir\(new_dirp,)840 2280 A
(new_name,)378 3162 A
(&numb,)252 3582 A
(ENTER\);)294 3876 A
4995 V
(27286)210 1122 A
2112(if)S
2238(\(r)S
2364(==)S
(OK\))126 2490 A
5085 V
(27287)210 1122 A
(\(void\))252 2280 A
(search_dir\(old_dirp,)840 2574 A
(old_name,)378 3456 A
(\(ino_t)252 3876 A
4170(*\))S
4296(0,)S
(DELETE\);)336 4422 A
5175 V
(27288)210 1122 A
1776(})S
5265 V
(27289)210 1122 A
1524(})S
5355 V
(27290)210 1122 A
1524(/*)S
1650(If)S
1776(r)S
1860(is)S
(OK,)126 1986 A
(the)126 2154 A
(ctime)210 2322 A
(and)126 2574 A
(mtime)210 2742 A
2994(of)S
(old_dirp)336 3120 A
(and)126 3498 A
(new_dirp)336 3666 A
(have)168 4044 A
(been)168 4254 A
(marked)252 4464 A
5445 V
(27291)210 1122 A
1566(*)S
(for)126 1650 A
(update)252 1818 A
2112(in)S
(search_dir.)462 2238 A
5535 V
(27292)210 1122 A
1566(*/)S
5625 V
(27293)210 1122 A
5715 V
(27294)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
1902(OK)S
2028(&&)S
(odir)168 2154 A
2364(&&)S
(!same_pdir\))462 2490 A
2994({)S
5805 V
(27295)210 1122 A
1776(/*)S
(Update)252 1902 A
(the)126 2196 A
2364(..)S
(entry)210 2490 A
2742(in)S
(the)126 2868 A
(directory)378 3036 A
(\(still)252 3456 A
(points)252 3750 A
4044(to)S
(old_dirp\).)420 4170 A
4632(*/)S
5895 V
(27296)210 1122 A
(numb)168 1776 A
1986(=)S
(new_dirp->i_num;)672 2070 A
5985 V
(27297)210 1122 A
(\(void\))252 1776 A
(unlink_file\(old_ip,)798 2070 A
(NIL_INODE,)420 2910 A
(dot2\);)252 3372 A
6075 V
(27298)210 1122 A
1776(if)S
(\(search_dir\(old_ip,)798 1902 A
(dot2,)210 2742 A
(&numb,)252 2994 A
(ENTER\))252 3288 A
3582(==)S
(OK\))126 3708 A
3876({)S
6165 V
(27299)210 1122 A
2112(/*)S
(New)126 2238 A
(link)168 2406 A
(created.)336 2616 A
2994(*/)S
6255 V
(27300)210 1122 A
(new_dirp->i_nlinks++;)882 2112 A
6345 V
(27301)210 1122 A
(new_dirp->i_dirt)672 2112 A
2826(=)S
(DIRTY;)252 2910 A
6435 V
(27302)210 1122 A
1776(})S
6525 V
(27303)210 1122 A
1524(})S
6615 V
(27304)210 1122 A
6705 V
(27305)210 1122 A
1524(/*)S
(Release)294 1650 A
(the)126 1986 A
(inodes.)294 2154 A
2490(*/)S
6795 V
(27306)210 1122 A
(put_inode\(old_dirp\);)840 1524 A
6885 V
(27307)210 1122 A
(put_inode\(old_ip\);)756 1524 A
6975 V
(27308)210 1122 A
(put_inode\(new_dirp\);)840 1524 A
7065 V
(27309)210 1122 A
(put_inode\(new_ip\);)756 1524 A
8418 V
EP
%%Page: 371 371
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2410(File:)S
(servers/fs/link.c)707 2643 A
12 B
(371)180 4500 A
1755 V
7 LST
(27310)210 1122 A
(return\(r)336 1524 A
1902(==)S
(SAME)168 2028 A
2238(?)S
2322(OK)S
2448(:)S
(r\);)126 2532 A
1845 V
(27311)210 1122 A
1440(})S
2025 V
(27313)210 1122 A
(/*===========================================================================*)3276 1440 A
2115 V
(27314)210 1122 A
1482(*)S
(truncate)336 2784 A
4674(*)S
2205 V
(27315)210 1122 A
(*===========================================================================*/)3276 1482 A
2295 V
(27316)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(truncate\(rip\))546 1944 A
2385 V
(27317)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(inode)210 3372 A
3624(to)S
3750(be)S
(truncated)378 3876 A
4296(*/)S
2475 V
(27318)210 1122 A
1440({)S
2565 V
(27319)210 1122 A
1440(/*)S
(Remove)252 1566 A
(all)126 1860 A
(the)126 2028 A
(zones)210 2196 A
(from)168 2448 A
(the)126 2658 A
(inode)210 2826 A
('rip')210 3078 A
(and)126 3330 A
(mark)168 3498 A
3708(it)S
(dirty.)252 3834 A
4128(*/)S
2655 V
(27320)210 1122 A
2745 V
(27321)210 1122 A
(register)336 1524 A
(block_t)294 1902 A
2238(b;)S
2835 V
(27322)210 1122 A
(zone_t)252 1524 A
1818(z,)S
(zone_size,)420 1944 A
(z1;)126 2406 A
2925 V
(27323)210 1122 A
(off_t)210 1524 A
(position;)378 1776 A
3015 V
(27324)210 1122 A
(int)126 1524 A
1692(i,)S
(scale,)252 1818 A
(file_type,)420 2112 A
(waspipe,)336 2574 A
(single,)294 2952 A
(nr_indirects;)546 3288 A
3105 V
(27325)210 1122 A
(struct)252 1524 A
(buf)126 1818 A
(*bp;)168 1986 A
3195 V
(27326)210 1122 A
(dev_t)210 1524 A
(dev;)168 1776 A
3285 V
(27327)210 1122 A
3375 V
(27328)210 1122 A
(file_type)378 1524 A
1944(=)S
(rip->i_mode)462 2028 A
2532(&)S
(I_TYPE;)294 2616 A
3120(/*)S
(check)210 3246 A
3498(to)S
(see)126 3624 A
3792(if)S
(file)168 3918 A
4128(is)S
(special)294 4254 A
4590(*/)S
3465 V
(27329)210 1122 A
1524(if)S
(\(file_type)420 1650 A
2112(==)S
(I_CHAR_SPECIAL)588 2238 A
2868(||)S
(file_type)378 2994 A
3414(==)S
(I_BLOCK_SPECIAL\))672 3540 A
(return;)294 4254 A
3555 V
(27330)210 1122 A
(dev)126 1524 A
1692(=)S
(rip->i_dev;)462 1776 A
2784(/*)S
(device)252 2910 A
3204(on)S
(which)210 3330 A
(inode)210 3582 A
(resides)294 3834 A
4170(*/)S
3645 V
(27331)210 1122 A
(scale)210 1524 A
1776(=)S
(rip->i_sp->s_log_zone_size;)1134 1860 A
3735 V
(27332)210 1122 A
(zone_size)378 1524 A
1944(=)S
(\(zone_t\))336 2028 A
(rip->i_sp->s_block_size)966 2406 A
3414(<<)S
(scale;)252 3540 A
3825 V
(27333)210 1122 A
(nr_indirects)504 1524 A
2070(=)S
(rip->i_nindirs;)630 2154 A
3915 V
(27334)210 1122 A
4005 V
(27335)210 1122 A
1524(/*)S
(Pipes)210 1650 A
(can)126 1902 A
(shrink,)294 2070 A
2406(so)S
(adjust)252 2532 A
(size)168 2826 A
3036(to)S
(make)168 3162 A
(sure)168 3372 A
(all)126 3582 A
(zones)210 3750 A
(are)126 4002 A
(removed.)336 4170 A
4548(*/)S
4095 V
(27336)210 1122 A
(waspipe)294 1524 A
1860(=)S
(rip->i_pipe)462 1944 A
2448(==)S
(I_PIPE;)294 2574 A
3120(/*)S
(TRUE)168 3246 A
3456(is)S
(this)168 3582 A
(was)126 3792 A
3960(a)S
(pipe)168 4044 A
4254(*/)S
4185 V
(27337)210 1122 A
1524(if)S
(\(waspipe\))378 1650 A
(rip->i_size)462 2070 A
2574(=)S
(PIPE_SIZE\(rip->i_sp->s_block_size\);)1470 2658 A
4275 V
(27338)210 1122 A
4365 V
(27339)210 1122 A
1524(/*)S
(Step)168 1650 A
(through)294 1860 A
(the)126 2196 A
(file)168 2364 A
2574(a)S
(zone)168 2658 A
2868(at)S
2994(a)S
(time,)210 3078 A
(finding)294 3330 A
(and)126 3666 A
(freeing)294 3834 A
(the)126 4170 A
(zones.)252 4338 A
4632(*/)S
4455 V
(27340)210 1122 A
(for)126 1524 A
(\(position)378 1692 A
2112(=)S
2196(0;)S
(position)336 2322 A
2700(<)S
(rip->i_size;)504 2784 A
(position)336 3330 A
3708(+=)S
(zone_size\))420 3834 A
4296({)S
4545 V
(27341)210 1122 A
1776(if)S
1902(\()S
1986(\(b)S
2112(=)S
(read_map\(rip,)546 2196 A
(position\)\))420 2784 A
3246(!=)S
(NO_BLOCK\))378 3372 A
3792({)S
4635 V
(27342)210 1122 A
2112(z)S
2196(=)S
(\(zone_t\))336 2280 A
2658(b)S
2742(>>)S
(scale;)252 2868 A
4725 V
(27343)210 1122 A
(free_zone\(dev,)588 2112 A
(z\);)126 2742 A
4815 V
(27344)210 1122 A
1776(})S
4905 V
(27345)210 1122 A
1524(})S
4995 V
(27346)210 1122 A
5085 V
(27347)210 1122 A
1524(/*)S
(All)126 1650 A
(the)126 1818 A
(data)168 1986 A
(zones)210 2196 A
(have)168 2448 A
(been)168 2658 A
(freed.)252 2868 A
(Now)126 3204 A
(free)168 3372 A
(the)126 3582 A
(indirect)336 3750 A
(zones.)252 4128 A
4422(*/)S
5175 V
(27348)210 1122 A
(rip->i_dirt)462 1524 A
2028(=)S
(DIRTY;)252 2112 A
5265 V
(27349)210 1122 A
1524(if)S
(\(waspipe\))378 1650 A
2070({)S
5355 V
(27350)210 1122 A
(wipe_inode\(rip\);)672 1776 A
2784(/*)S
(clear)210 2910 A
(out)126 3162 A
(inode)210 3330 A
(for)126 3582 A
(pipes)210 3750 A
4002(*/)S
5445 V
(27351)210 1122 A
(return;)294 1776 A
2784(/*)S
(indirect)336 2910 A
(slots)210 3288 A
(contain)294 3540 A
(file)168 3876 A
(positions)378 4086 A
4506(*/)S
5535 V
(27352)210 1122 A
1524(})S
5625 V
(27353)210 1122 A
(single)252 1524 A
1818(=)S
(rip->i_ndzones;)630 1902 A
5715 V
(27354)210 1122 A
(free_zone\(dev,)588 1524 A
(rip->i_zone[single]\);)882 2154 A
3120(/*)S
(single)252 3246 A
(indirect)336 3540 A
(zone)168 3918 A
4128(*/)S
5805 V
(27355)210 1122 A
1524(if)S
1650(\()S
1734(\(z)S
1860(=)S
(rip->i_zone[single+1]\))924 1944 A
2910(!=)S
(NO_ZONE\))336 3036 A
3414({)S
5895 V
(27356)210 1122 A
1776(/*)S
(Free)168 1902 A
(all)126 2112 A
(the)126 2280 A
(single)252 2448 A
(indirect)336 2742 A
(zones)210 3120 A
(pointed)294 3372 A
3708(to)S
3834(by)S
(the)126 3960 A
(double.)294 4128 A
4464(*/)S
5985 V
(27357)210 1122 A
1776(b)S
1860(=)S
(\(block_t\))378 1944 A
2364(z)S
2448(<<)S
(scale;)252 2574 A
6075 V
(27358)210 1122 A
1776(bp)S
1902(=)S
(get_block\(dev,)588 1986 A
2616(b,)S
(NORMAL\);)336 2742 A
3120(/*)S
(get)126 3246 A
(double)252 3414 A
(indirect)336 3708 A
(zone)168 4086 A
4296(*/)S
6165 V
(27359)210 1122 A
(for)126 1776 A
1944(\(i)S
2070(=)S
2154(0;)S
2280(i)S
2364(<)S
(nr_indirects;)546 2448 A
(i++\))168 3036 A
3246({)S
6255 V
(27360)210 1122 A
2112(z1)S
2238(=)S
(rd_indir\(bp,)504 2322 A
(i\);)126 2868 A
6345 V
(27361)210 1122 A
(free_zone\(dev,)588 2112 A
(z1\);)168 2742 A
6435 V
(27362)210 1122 A
1776(})S
6525 V
(27363)210 1122 A
6615 V
(27364)210 1122 A
1776(/*)S
(Now)126 1902 A
(free)168 2070 A
(the)126 2280 A
(double)252 2448 A
(indirect)336 2742 A
(zone)168 3120 A
(itself.)294 3330 A
3666(*/)S
6705 V
(27365)210 1122 A
(put_block\(bp,)546 1776 A
(INDIRECT_BLOCK\);)672 2364 A
6795 V
(27366)210 1122 A
(free_zone\(dev,)588 1776 A
(z\);)126 2406 A
6885 V
(27367)210 1122 A
1524(})S
6975 V
(27368)210 1122 A
7065 V
(27369)210 1122 A
1524(/*)S
(Leave)210 1650 A
(zone)168 1902 A
(numbers)294 2112 A
(for)126 2448 A
(de\(1\))210 2616 A
2868(to)S
(recover)294 2994 A
(file)168 3330 A
(after)210 3540 A
3792(an)S
(unlink\(2\).)420 3918 A
4422(*/)S
8418 V
EP
%%Page: 372 372
BP
/slant 0 def
/height 0 def
1485 V
12 B
(372)180 1080 A
11 R
2410(File:)S
(servers/fs/link.c)707 2643 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(27370)210 1122 A
1440(})S
1935 V
(27372)210 1122 A
(/*===========================================================================*)3276 1440 A
2025 V
(27373)210 1122 A
1482(*)S
(remove_dir)420 2784 A
4674(*)S
2115 V
(27374)210 1122 A
(*===========================================================================*/)3276 1482 A
2205 V
(27375)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(remove_dir\(rldirp,)756 1944 A
(rip,)168 2742 A
(dir_name\))378 2952 A
2295 V
(27376)210 1122 A
(struct)252 1440 A
(inode)210 1734 A
(*rldirp;)336 1986 A
3120(/*)S
(parent)252 3246 A
(directory)378 3540 A
3960(*/)S
2385 V
(27377)210 1122 A
(struct)252 1440 A
(inode)210 1734 A
(*rip;)210 1986 A
3120(/*)S
(directory)378 3246 A
3666(to)S
3792(be)S
(removed)294 3918 A
4254(*/)S
2475 V
(27378)210 1122 A
(char)168 1440 A
(dir_name[NAME_MAX];)798 1650 A
3120(/*)S
(name)168 3246 A
3456(of)S
(directory)378 3582 A
4002(to)S
4128(be)S
(removed)294 4254 A
4590(*/)S
2565 V
(27379)210 1122 A
1440({)S
2655 V
(27380)210 1122 A
1524(/*)S
1650(A)S
(directory)378 1734 A
(file)168 2154 A
(has)126 2364 A
2532(to)S
2658(be)S
(removed.)336 2784 A
(Five)168 3162 A
(conditions)420 3372 A
(have)168 3834 A
4044(to)S
(met:)168 4170 A
2745 V
(27381)210 1122 A
1566(*)S
1776(-)S
(The)126 1860 A
(file)168 2028 A
(must)168 2238 A
2448(be)S
2574(a)S
(directory)378 2658 A
2835 V
(27382)210 1122 A
1566(*)S
1776(-)S
(The)126 1860 A
(directory)378 2028 A
(must)168 2448 A
2658(be)S
(empty)210 2784 A
(\(except)294 3036 A
(for)126 3372 A
3540(.)S
(and)126 3624 A
(..\))126 3792 A
2925 V
(27383)210 1122 A
1566(*)S
1776(-)S
(The)126 1860 A
(final)210 2028 A
(component)378 2280 A
2700(of)S
(the)126 2826 A
(path)168 2994 A
(must)168 3204 A
(not)126 3414 A
3582(be)S
3708(.)S
3792(or)S
3918(..)S
3015 V
(27384)210 1122 A
1566(*)S
1776(-)S
(The)126 1860 A
(directory)378 2028 A
(must)168 2448 A
(not)126 2658 A
2826(be)S
(the)126 2952 A
(root)168 3120 A
3330(of)S
3456(a)S
(mounted)294 3540 A
(file)168 3876 A
(system)252 4086 A
3105 V
(27385)210 1122 A
1566(*)S
1776(-)S
(The)126 1860 A
(directory)378 2028 A
(must)168 2448 A
(not)126 2658 A
2826(be)S
(anybody's)378 2952 A
(root/working)504 3372 A
(directory)378 3918 A
3195 V
(27386)210 1122 A
1566(*/)S
3285 V
(27387)210 1122 A
3375 V
(27388)210 1122 A
(int)126 1524 A
1692(r;)S
3465 V
(27389)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(fproc)210 2196 A
(*rfp;)210 2448 A
3555 V
(27390)210 1122 A
3645 V
(27391)210 1122 A
1524(/*)S
(search_dir)420 1650 A
(checks)252 2112 A
(that)168 2406 A
(rip)126 2616 A
2784(is)S
2910(a)S
(directory)378 2994 A
(too.)168 3414 A
3624(*/)S
3735 V
(27392)210 1122 A
1524(if)S
(\(\(r)126 1650 A
1818(=)S
(search_dir\(rip,)630 1902 A
("",)126 2574 A
(\(ino_t)252 2742 A
3036(*\))S
3162(0,)S
(IS_EMPTY\)\))420 3288 A
3750(!=)S
(OK\))126 3876 A
(return)252 4044 A
4338(r;)S
3825 V
(27393)210 1122 A
3915 V
(27394)210 1122 A
1524(if)S
(\(strcmp\(dir_name,)714 1650 A
("."\))168 2406 A
2616(==)S
2742(0)S
2826(||)S
(strcmp\(dir_name,)672 2952 A
(".."\))210 3666 A
3918(==)S
(0\)return\(EINVAL\);)714 4044 A
4005 V
(27395)210 1122 A
1524(if)S
(\(rip->i_num)462 1650 A
2154(==)S
(ROOT_INODE\))462 2280 A
(return\(EBUSY\);)588 2784 A
3414(/*)S
(can't)210 3540 A
(remove)252 3792 A
('root')252 4086 A
4380(*/)S
4095 V
(27396)210 1122 A
4185 V
(27397)210 1122 A
(for)126 1524 A
(\(rfp)168 1692 A
1902(=)S
(&fproc[INIT_PROC_NR)798 1986 A
2826(+)S
(1];)126 2910 A
(rfp)126 3078 A
3246(<)S
(&fproc[NR_PROCS];)714 3330 A
(rfp++\))252 4086 A
4275 V
(27398)210 1122 A
1776(if)S
(\(rfp->fp_workdir)672 1902 A
2616(==)S
(rip)126 2742 A
2910(||)S
(rfp->fp_rootdir)630 3036 A
3708(==)S
(rip\))168 3834 A
(return\(EBUSY\);)588 4044 A
4365 V
(27399)210 1122 A
2784(/*)S
(can't)210 2910 A
(remove)252 3162 A
(anybody's)378 3456 A
(working)294 3876 A
(dir)126 4212 A
4380(*/)S
4455 V
(27400)210 1122 A
4545 V
(27401)210 1122 A
1524(/*)S
(Actually)336 1650 A
(try)126 2028 A
2196(to)S
(unlink)252 2322 A
(the)126 2616 A
(file;)210 2784 A
(fails)210 3036 A
3288(if)S
(parent)252 3414 A
3708(is)S
(mode)168 3834 A
4044(0)S
(etc.)168 4128 A
4338(*/)S
4635 V
(27402)210 1122 A
1524(if)S
(\(\(r)126 1650 A
1818(=)S
(unlink_file\(rldirp,)798 1902 A
(rip,)168 2742 A
(dir_name\)\))420 2952 A
3414(!=)S
(OK\))126 3540 A
(return)252 3708 A
4002(r;)S
4725 V
(27403)210 1122 A
4815 V
(27404)210 1122 A
1524(/*)S
(Unlink)252 1650 A
1944(.)S
(and)126 2028 A
2196(..)S
(from)168 2322 A
(the)126 2532 A
(dir.)168 2700 A
(The)126 2910 A
(super)210 3078 A
(user)168 3330 A
(can)126 3540 A
(link)168 3708 A
(and)126 3918 A
(unlink)252 4086 A
(any)126 4380 A
(dir,)168 4548 A
4905 V
(27405)210 1122 A
1566(*)S
1650(so)S
(don't)210 1776 A
(make)168 2028 A
(too)126 2238 A
(many)168 2406 A
(assumptions)462 2616 A
(about)210 3120 A
(them.)210 3372 A
4995 V
(27406)210 1122 A
1566(*/)S
5085 V
(27407)210 1122 A
(\(void\))252 1524 A
(unlink_file\(rip,)672 1818 A
(NIL_INODE,)420 2532 A
(dot1\);)252 2994 A
5175 V
(27408)210 1122 A
(\(void\))252 1524 A
(unlink_file\(rip,)672 1818 A
(NIL_INODE,)420 2532 A
(dot2\);)252 2994 A
5265 V
(27409)210 1122 A
(return\(OK\);)462 1524 A
5355 V
(27410)210 1122 A
1440(})S
5535 V
(27412)210 1122 A
(/*===========================================================================*)3276 1440 A
5625 V
(27413)210 1122 A
1482(*)S
(unlink_file)462 2784 A
4674(*)S
5715 V
(27414)210 1122 A
(*===========================================================================*/)3276 1482 A
5805 V
(27415)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(unlink_file\(dirp,)714 1944 A
(rip,)168 2700 A
(file_name\))420 2910 A
5895 V
(27416)210 1122 A
(struct)252 1440 A
(inode)210 1734 A
(*dirp;)252 1986 A
2784(/*)S
(parent)252 2910 A
(directory)378 3204 A
3624(of)S
(file)168 3750 A
3960(*/)S
5985 V
(27417)210 1122 A
(struct)252 1440 A
(inode)210 1734 A
(*rip;)210 1986 A
2784(/*)S
(inode)210 2910 A
3162(of)S
(file,)210 3288 A
(may)126 3540 A
3708(be)S
(NIL_INODE)378 3834 A
(too.)168 4254 A
4464(*/)S
6075 V
(27418)210 1122 A
(char)168 1440 A
(file_name[NAME_MAX];)840 1650 A
2784(/*)S
(name)168 2910 A
3120(of)S
(file)168 3246 A
3456(to)S
3582(be)S
(removed)294 3708 A
4044(*/)S
6165 V
(27419)210 1122 A
1440({)S
6255 V
(27420)210 1122 A
1440(/*)S
(Unlink)252 1566 A
('file_name';)504 1860 A
(rip)126 2406 A
(must)168 2574 A
2784(be)S
(the)126 2910 A
(inode)210 3078 A
3330(of)S
('file_name')462 3456 A
3960(or)S
(NIL_INODE.)420 4086 A
4548(*/)S
6345 V
(27421)210 1122 A
6435 V
(27422)210 1122 A
(ino_t)210 1524 A
(numb;)210 1776 A
2784(/*)S
(inode)210 2910 A
(number)252 3162 A
3456(*/)S
6525 V
(27423)210 1122 A
(int)126 1524 A
1776(r;)S
6615 V
(27424)210 1122 A
6705 V
(27425)210 1122 A
1524(/*)S
1650(If)S
(rip)126 1776 A
1944(is)S
(not)126 2070 A
(NIL_INODE,)420 2238 A
2700(it)S
2826(is)S
(used)168 2952 A
3162(to)S
(get)126 3288 A
(faster)252 3456 A
(access)252 3750 A
4044(to)S
(the)126 4170 A
(inode.)252 4338 A
4632(*/)S
6795 V
(27426)210 1122 A
1524(if)S
(\(rip)168 1650 A
1860(==)S
(NIL_INODE\))420 1986 A
2448({)S
6885 V
(27427)210 1122 A
1776(/*)S
(Search)252 1902 A
(for)126 2196 A
(file)168 2364 A
2574(in)S
(directory)378 2700 A
(and)126 3120 A
(try)126 3288 A
3456(to)S
(get)126 3582 A
(its)126 3750 A
(inode.)252 3918 A
4212(*/)S
6975 V
(27428)210 1122 A
(err_code)336 1776 A
2154(=)S
(search_dir\(dirp,)672 2238 A
(file_name,)420 2952 A
(&numb,)252 3414 A
(LOOK_UP\);)378 3708 A
7065 V
(27429)210 1122 A
1776(if)S
(\(err_code)378 1902 A
2322(==)S
(OK\))126 2448 A
(rip)126 2616 A
2784(=)S
(get_inode\(dirp->i_dev,)924 2868 A
(\(int\))210 3834 A
(numb\);)252 4086 A
8418 V
EP
%%Page: 373 373
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2410(File:)S
(servers/fs/link.c)707 2643 A
12 B
(373)180 4500 A
1755 V
7 LST
(27430)210 1122 A
1776(if)S
(\(err_code)378 1902 A
2322(!=)S
2448(OK)S
2574(||)S
(rip)126 2700 A
2868(==)S
(NIL_INODE\))420 2994 A
(return\(err_code\);)714 3456 A
1845 V
(27431)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
1935 V
(27432)210 1122 A
(dup_inode\(rip\);)630 1776 A
2784(/*)S
(inode)210 2910 A
(will)168 3162 A
3372(be)S
(returned)336 3498 A
(with)168 3876 A
(put_inode)378 4086 A
4506(*/)S
2025 V
(27433)210 1122 A
1524(})S
2115 V
(27434)210 1122 A
2205 V
(27435)210 1122 A
1524(r)S
1608(=)S
(search_dir\(dirp,)672 1692 A
(file_name,)420 2406 A
(\(ino_t)252 2868 A
3162(*\))S
3288(0,)S
(DELETE\);)336 3414 A
2295 V
(27436)210 1122 A
2385 V
(27437)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
2070({)S
2475 V
(27438)210 1122 A
(rip->i_nlinks--;)672 1776 A
2784(/*)S
(entry)210 2910 A
(deleted)294 3162 A
(from)168 3498 A
(parent's)336 3708 A
(dir)126 4086 A
4254(*/)S
2565 V
(27439)210 1122 A
(rip->i_update)546 1776 A
2364(|=)S
(CTIME;)252 2490 A
2655 V
(27440)210 1122 A
(rip->i_dirt)462 1776 A
2280(=)S
(DIRTY;)252 2364 A
2745 V
(27441)210 1122 A
1524(})S
2835 V
(27442)210 1122 A
2925 V
(27443)210 1122 A
(put_inode\(rip\);)630 1524 A
3015 V
(27444)210 1122 A
(return\(r\);)420 1524 A
3105 V
(27445)210 1122 A
1440(})S
3645 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3735 V
(servers/fs/stadir.c)798 2676 A
3825 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4005 V
(27500)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(code)168 2532 A
(for)126 2742 A
(performing)420 2910 A
(four)168 3372 A
(system)252 3582 A
(calls)210 3876 A
(relating)336 4128 A
4506(to)S
4095 V
(27501)210 1122 A
1482(*)S
(status)252 1566 A
(and)126 1860 A
(directories.)504 2028 A
4185 V
(27502)210 1122 A
1482(*)S
4275 V
(27503)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are)126 2910 A
4365 V
(27504)210 1122 A
1482(*)S
(do_chdir:)378 1650 A
(perform)294 2112 A
(the)126 2448 A
(CHDIR)210 2616 A
(system)252 2868 A
(call)168 3162 A
4455 V
(27505)210 1122 A
1482(*)S
(do_chroot:)420 1650 A
(perform)294 2112 A
(the)126 2448 A
(CHROOT)252 2616 A
(system)252 2910 A
(call)168 3204 A
4545 V
(27506)210 1122 A
1482(*)S
(do_stat:)336 1650 A
(perform)294 2112 A
(the)126 2448 A
(STAT)168 2616 A
(system)252 2826 A
(call)168 3120 A
4635 V
(27507)210 1122 A
1482(*)S
(do_fstat:)378 1650 A
(perform)294 2112 A
(the)126 2448 A
(FSTAT)210 2616 A
(system)252 2868 A
(call)168 3162 A
4725 V
(27508)210 1122 A
1482(*)S
(do_fstatfs:)462 1650 A
(perform)294 2154 A
(the)126 2490 A
(FSTATFS)294 2658 A
(system)252 2994 A
(call)168 3288 A
4815 V
(27509)210 1122 A
1482(*/)S
4905 V
(27510)210 1122 A
4995 V
(27511)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
5085 V
(27512)210 1122 A
(#include)336 1440 A
(<sys/stat.h>)504 1818 A
5175 V
(27513)210 1122 A
(#include)336 1440 A
(<sys/statfs.h>)588 1818 A
5265 V
(27514)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
5355 V
(27515)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
5445 V
(27516)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
5535 V
(27517)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
5625 V
(27518)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
5715 V
(27519)210 1122 A
(#include)336 1440 A
("super.h")378 1818 A
5805 V
(27520)210 1122 A
5895 V
(27521)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(change,)294 2448 A
(\(struct)294 2784 A
(inode)210 3120 A
(**iip,)252 3372 A
(char)168 3666 A
(*name_ptr,)420 3876 A
(int)126 4338 A
(len\)\);)252 4506 A
5985 V
(27522)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(change_into,)504 2448 A
(\(struct)294 2994 A
(inode)210 3330 A
(**iip,)252 3582 A
(struct)252 3876 A
(inode)210 4170 A
(*ip\)\);)252 4422 A
6075 V
(27523)210 1122 A
(FORWARD)294 1440 A
(_PROTOTYPE\()462 1776 A
(int)126 2280 A
(stat_inode,)462 2448 A
(\(struct)294 2952 A
(inode)210 3288 A
(*rip,)210 3540 A
(struct)252 3792 A
(filp)168 4086 A
(*fil_ptr,)378 4296 A
6165 V
(27524)210 1122 A
(char)168 2448 A
(*user_addr\))462 2658 A
4464(\);)S
6255 V
(27525)210 1122 A
6345 V
(27526)210 1122 A
(/*===========================================================================*)3276 1440 A
6435 V
(27527)210 1122 A
1482(*)S
(do_fchdir)378 2784 A
4674(*)S
6525 V
(27528)210 1122 A
(*===========================================================================*/)3276 1482 A
6615 V
(27529)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_fchdir\(\))462 1902 A
6705 V
(27530)210 1122 A
1440({)S
6795 V
(27531)210 1122 A
1776(/*)S
(Change)252 1902 A
(directory)378 2196 A
2616(on)S
(already-opened)588 2742 A
(fd.)126 3372 A
3540(*/)S
6885 V
(27532)210 1122 A
(struct)252 1776 A
(filp)168 2070 A
(*rfilp;)294 2280 A
6975 V
(27533)210 1122 A
7065 V
(27534)210 1122 A
1776(/*)S
1902(Is)S
(the)126 2028 A
(file)168 2196 A
(descriptor)420 2406 A
(valid?)252 2868 A
3162(*/)S
8418 V
EP
%%Page: 374 374
BP
/slant 0 def
/height 0 def
1485 V
12 B
(374)180 1080 A
11 R
2372(File:)S
2605(servers/fs/stadir.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(27535)210 1122 A
1776(if)S
1902(\()S
(\(rfilp)252 1986 A
2280(=)S
(get_filp\(m_in.fd\)\))756 2364 A
3162(==)S
(NIL_FILP\))378 3288 A
(return\(err_code\);)714 3708 A
1845 V
(27536)210 1122 A
(return)252 1776 A
(change_into\(&fp->fp_workdir,)1176 2070 A
(rfilp->filp_ino\);)714 3288 A
1935 V
(27537)210 1122 A
1440(})S
2115 V
(27539)210 1122 A
(/*===========================================================================*)3276 1440 A
2205 V
(27540)210 1122 A
1482(*)S
(do_chdir)336 2784 A
4674(*)S
2295 V
(27541)210 1122 A
(*===========================================================================*/)3276 1482 A
2385 V
(27542)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_chdir\(\))420 1902 A
2475 V
(27543)210 1122 A
1440({)S
2565 V
(27544)210 1122 A
1440(/*)S
(Change)252 1566 A
(directory.)420 1860 A
(This)168 2364 A
(function)336 2574 A
2952(is)S
(also)168 3120 A
(called)252 3330 A
3624(by)S
3750(MM)S
3876(to)S
(simulate)336 4002 A
4380(a)S
(chdir)210 4464 A
2655 V
(27545)210 1122 A
1482(*)S
1566(in)S
(order)210 1692 A
1944(to)S
2070(do)S
(EXEC,)210 2196 A
(etc.)168 2448 A
2700(It)S
(also)168 2826 A
(changes)294 3036 A
(the)126 3372 A
(root)168 3540 A
(directory,)420 3750 A
(the)126 4212 A
(uids)168 4380 A
(and)126 4590 A
2745 V
(27546)210 1122 A
1482(*)S
(gids,)210 1566 A
(and)126 1818 A
(the)126 1986 A
(umask.)252 2154 A
2835 V
(27547)210 1122 A
1482(*/)S
2925 V
(27548)210 1122 A
3015 V
(27549)210 1122 A
(int)126 1524 A
1692(r;)S
3105 V
(27550)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(fproc)210 2196 A
(*rfp;)210 2448 A
3195 V
(27551)210 1122 A
3285 V
(27552)210 1122 A
1524(if)S
(\(who)168 1650 A
1860(==)S
(PM_PROC_NR\))462 1986 A
2490({)S
3375 V
(27553)210 1122 A
(rfp)126 1776 A
1944(=)S
(&fproc[m_in.slot1];)798 2028 A
3465 V
(27554)210 1122 A
(put_inode\(fp->fp_rootdir\);)1092 1776 A
3555 V
(27555)210 1122 A
(dup_inode\(fp->fp_rootdir)1008 1776 A
2826(=)S
(rfp->fp_rootdir\);)714 2910 A
3645 V
(27556)210 1122 A
(put_inode\(fp->fp_workdir\);)1092 1776 A
3735 V
(27557)210 1122 A
(dup_inode\(fp->fp_workdir)1008 1776 A
2826(=)S
(rfp->fp_workdir\);)714 2910 A
3825 V
(27558)210 1122 A
3915 V
(27559)210 1122 A
1776(/*)S
1902(MM)S
(uses)168 2028 A
(access\(\))336 2238 A
2616(to)S
(check)210 2742 A
(permissions.)504 2994 A
3582(To)S
(make)168 3708 A
(this)168 3918 A
(work,)210 4128 A
(pretend)294 4380 A
4005 V
(27560)210 1122 A
1818(*)S
(that)168 1902 A
(the)126 2112 A
(user's)252 2280 A
(real)168 2574 A
(ids)126 2784 A
(are)126 2952 A
(the)126 3120 A
(same)168 3288 A
3498(as)S
(the)126 3624 A
(user's)252 3792 A
(effective)378 4086 A
(ids.)168 4506 A
4095 V
(27561)210 1122 A
1818(*)S
1902(FS)S
(calls)210 2028 A
(other)210 2280 A
(than)168 2532 A
(access\(\))336 2742 A
3120(do)S
(not)126 3246 A
(use)126 3414 A
(the)126 3582 A
(real)168 3750 A
(ids,)168 3960 A
4170(so)S
(are)126 4296 A
(not)126 4464 A
4185 V
(27562)210 1122 A
1818(*)S
(affected.)378 1902 A
4275 V
(27563)210 1122 A
1818(*/)S
4365 V
(27564)210 1122 A
(fp->fp_realuid)588 1776 A
2406(=)S
4455 V
(27565)210 1122 A
(fp->fp_effuid)546 1776 A
2364(=)S
(rfp->fp_effuid;)630 2448 A
4545 V
(27566)210 1122 A
(fp->fp_realgid)588 1776 A
2406(=)S
4635 V
(27567)210 1122 A
(fp->fp_effgid)546 1776 A
2364(=)S
(rfp->fp_effgid;)630 2448 A
4725 V
(27568)210 1122 A
(fp->fp_umask)504 1776 A
2322(=)S
(rfp->fp_umask;)588 2406 A
4815 V
(27569)210 1122 A
(return\(OK\);)462 1776 A
4905 V
(27570)210 1122 A
1524(})S
4995 V
(27571)210 1122 A
5085 V
(27572)210 1122 A
1524(/*)S
(Perform)294 1650 A
(the)126 1986 A
(chdir\(name\))462 2154 A
(system)252 2658 A
(call.)210 2952 A
3204(*/)S
5175 V
(27573)210 1122 A
1524(r)S
1608(=)S
(change\(&fp->fp_workdir,)966 1692 A
(m_in.name,)420 2700 A
(m_in.name_length\);)756 3162 A
5265 V
(27574)210 1122 A
(return\(r\);)420 1524 A
5355 V
(27575)210 1122 A
1440(})S
5535 V
(27577)210 1122 A
(/*===========================================================================*)3276 1440 A
5625 V
(27578)210 1122 A
1482(*)S
(do_chroot)378 2784 A
4674(*)S
5715 V
(27579)210 1122 A
(*===========================================================================*/)3276 1482 A
5805 V
(27580)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_chroot\(\))462 1902 A
5895 V
(27581)210 1122 A
1440({)S
5985 V
(27582)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(chroot\(name\))504 2070 A
(system)252 2616 A
(call.)210 2910 A
3162(*/)S
6075 V
(27583)210 1122 A
6165 V
(27584)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(r;)S
6255 V
(27585)210 1122 A
6345 V
(27586)210 1122 A
1524(if)S
(\(!super_user\))546 1650 A
(return\(EPERM\);)588 2238 A
3120(/*)S
(only)168 3246 A
3456(su)S
(may)126 3582 A
(chroot\(\))336 3750 A
4128(*/)S
6435 V
(27587)210 1122 A
1524(r)S
1608(=)S
(change\(&fp->fp_rootdir,)966 1692 A
(m_in.name,)420 2700 A
(m_in.name_length\);)756 3162 A
6525 V
(27588)210 1122 A
(return\(r\);)420 1524 A
6615 V
(27589)210 1122 A
1440(})S
8418 V
EP
%%Page: 375 375
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2372(File:)S
2605(servers/fs/stadir.c)S
12 B
(375)180 4500 A
1755 V
7 LST
(27591)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(27592)210 1122 A
1482(*)S
(change)252 2784 A
4674(*)S
1935 V
(27593)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(27594)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(change\(iip,)462 1944 A
(name_ptr,)378 2448 A
(len\))168 2868 A
2115 V
(27595)210 1122 A
(struct)252 1440 A
(inode)210 1734 A
(**iip;)252 1986 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(the)126 3372 A
(inode)210 3540 A
(pointer)294 3792 A
(for)126 4128 A
(the)126 4296 A
(dir)126 4464 A
4632(*/)S
2205 V
(27596)210 1122 A
(char)168 1440 A
(*name_ptr;)420 1650 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(the)126 3372 A
(directory)378 3540 A
(name)168 3960 A
4170(to)S
(change)252 4296 A
4590(to)S
4716(*/)S
2295 V
(27597)210 1122 A
(int)126 1440 A
(len;)168 1608 A
2784(/*)S
(length)252 2910 A
3204(of)S
(the)126 3330 A
(directory)378 3498 A
(name)168 3918 A
(string)252 4128 A
4422(*/)S
2385 V
(27598)210 1122 A
1440({)S
2475 V
(27599)210 1122 A
1440(/*)S
1566(Do)S
(the)126 1692 A
(actual)252 1860 A
(work)168 2154 A
(for)126 2364 A
(chdir\(\))294 2532 A
(and)126 2868 A
(chroot\(\).)378 3036 A
3456(*/)S
2565 V
(27600)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*rip;)210 2070 A
2655 V
(27601)210 1122 A
2745 V
(27602)210 1122 A
1524(/*)S
(Try)126 1650 A
1818(to)S
(open)168 1944 A
(the)126 2154 A
(new)126 2322 A
(directory.)420 2490 A
2952(*/)S
2835 V
(27603)210 1122 A
1524(if)S
(\(fetch_name\(name_ptr,)882 1650 A
(len,)168 2574 A
(M3\))126 2784 A
2952(!=)S
(OK\))126 3078 A
(return\(err_code\);)714 3246 A
2925 V
(27604)210 1122 A
1524(if)S
1650(\()S
(\(rip)168 1734 A
1944(=)S
(eat_path\(user_path\)\))840 2028 A
2910(==)S
(NIL_INODE\))420 3036 A
(return\(err_code\);)714 3498 A
3015 V
(27605)210 1122 A
(return)252 1524 A
(change_into\(iip,)672 1818 A
(rip\);)210 2532 A
3105 V
(27606)210 1122 A
1440(})S
3285 V
(27608)210 1122 A
(/*===========================================================================*)3276 1440 A
3375 V
(27609)210 1122 A
1482(*)S
(change_into)462 2784 A
4674(*)S
3465 V
(27610)210 1122 A
(*===========================================================================*/)3276 1482 A
3555 V
(27611)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(change_into\(iip,)672 1944 A
(rip\))168 2658 A
3645 V
(27612)210 1122 A
(struct)252 1440 A
(inode)210 1734 A
(**iip;)252 1986 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(the)126 3372 A
(inode)210 3540 A
(pointer)294 3792 A
(for)126 4128 A
(the)126 4296 A
(dir)126 4464 A
4632(*/)S
3735 V
(27613)210 1122 A
(struct)252 1440 A
(inode)210 1734 A
(*rip;)210 1986 A
2784(/*)S
(this)168 2910 A
3120(is)S
(what)168 3246 A
(the)126 3456 A
(inode)210 3624 A
(has)126 3876 A
4044(to)S
(become)252 4170 A
4464(*/)S
3825 V
(27614)210 1122 A
1440({)S
3915 V
(27615)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(r;)S
4005 V
(27616)210 1122 A
4095 V
(27617)210 1122 A
1524(/*)S
1650(It)S
(must)168 1776 A
1986(be)S
2112(a)S
(directory)378 2196 A
(and)126 2616 A
(also)168 2784 A
2994(be)S
(searchable.)462 3120 A
3624(*/)S
4185 V
(27618)210 1122 A
1524(if)S
1650(\()S
(\(rip->i_mode)504 1734 A
2280(&)S
(I_TYPE\))294 2364 A
2700(!=)S
(I_DIRECTORY\))504 2826 A
4275 V
(27619)210 1122 A
1776(r)S
1860(=)S
(ENOTDIR;)336 1944 A
4365 V
(27620)210 1122 A
(else)168 1524 A
4455 V
(27621)210 1122 A
1776(r)S
1860(=)S
(forbidden\(rip,)588 1944 A
(X_BIT\);)294 2574 A
3120(/*)S
(check)210 3246 A
3498(if)S
(dir)126 3624 A
3792(is)S
(searchable)420 3918 A
4380(*/)S
4545 V
(27622)210 1122 A
4635 V
(27623)210 1122 A
1524(/*)S
1650(If)S
(error,)252 1776 A
(return)252 2070 A
(inode.)252 2364 A
2658(*/)S
4725 V
(27624)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
2070({)S
4815 V
(27625)210 1122 A
(put_inode\(rip\);)630 1776 A
4905 V
(27626)210 1122 A
(return\(r\);)420 1776 A
4995 V
(27627)210 1122 A
1524(})S
5085 V
(27628)210 1122 A
5175 V
(27629)210 1122 A
1524(/*)S
(Everything)420 1650 A
2112(is)S
(OK.)126 2238 A
(Make)168 2448 A
(the)126 2658 A
(change.)294 2826 A
3162(*/)S
5265 V
(27630)210 1122 A
(put_inode\(*iip\);)672 1524 A
2784(/*)S
(release)294 2910 A
(the)126 3246 A
(old)126 3414 A
(directory)378 3582 A
4002(*/)S
5355 V
(27631)210 1122 A
(*iip)168 1524 A
1734(=)S
(rip;)168 1818 A
2784(/*)S
(acquire)294 2910 A
(the)126 3246 A
(new)126 3414 A
(one)126 3582 A
3750(*/)S
5445 V
(27632)210 1122 A
(return\(OK\);)462 1524 A
5535 V
(27633)210 1122 A
1440(})S
5715 V
(27635)210 1122 A
(/*===========================================================================*)3276 1440 A
5805 V
(27636)210 1122 A
1482(*)S
(do_stat)294 2784 A
4674(*)S
5895 V
(27637)210 1122 A
(*===========================================================================*/)3276 1482 A
5985 V
(27638)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_stat\(\))378 1902 A
6075 V
(27639)210 1122 A
1440({)S
6165 V
(27640)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(stat\(name,)420 2070 A
(buf\))168 2532 A
(system)252 2742 A
(call.)210 3036 A
3288(*/)S
6255 V
(27641)210 1122 A
6345 V
(27642)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
6435 V
(27643)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(r;)S
6525 V
(27644)210 1122 A
6615 V
(27645)210 1122 A
1524(/*)S
(Both)168 1650 A
(stat\(\))252 1860 A
(and)126 2154 A
(fstat\(\))294 2322 A
(use)126 2658 A
(the)126 2826 A
(same)168 2994 A
(routine)294 3204 A
3540(to)S
3666(do)S
(the)126 3792 A
(real)168 3960 A
(work.)210 4170 A
(That)168 4464 A
6705 V
(27646)210 1122 A
1566(*)S
(routine)294 1650 A
(expects)294 1986 A
2322(an)S
(inode,)252 2448 A
2742(so)S
(acquire)294 2868 A
3204(it)S
(temporarily.)504 3330 A
6795 V
(27647)210 1122 A
1566(*/)S
6885 V
(27648)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name1,)966 1650 A
(m_in.name1_length,)756 2658 A
(M1\))126 3456 A
3624(!=)S
(OK\))126 3750 A
(return\(err_code\);)714 3918 A
6975 V
(27649)210 1122 A
1524(if)S
1650(\()S
(\(rip)168 1734 A
1944(=)S
(eat_path\(user_path\)\))840 2028 A
2910(==)S
(NIL_INODE\))420 3036 A
(return\(err_code\);)714 3498 A
7065 V
(27650)210 1122 A
1524(r)S
1608(=)S
(stat_inode\(rip,)630 1692 A
(NIL_FILP,)378 2364 A
(m_in.name2\);)504 2784 A
3456(/*)S
(actually)336 3582 A
3960(do)S
(the)126 4086 A
(work.*/)294 4254 A
8418 V
EP
%%Page: 376 376
BP
/slant 0 def
/height 0 def
1485 V
12 B
(376)180 1080 A
11 R
2372(File:)S
2605(servers/fs/stadir.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(27651)210 1122 A
(put_inode\(rip\);)630 1524 A
2784(/*)S
(release)294 2910 A
(the)126 3246 A
(inode)210 3414 A
3666(*/)S
1845 V
(27652)210 1122 A
(return\(r\);)420 1524 A
1935 V
(27653)210 1122 A
1440(})S
2115 V
(27655)210 1122 A
(/*===========================================================================*)3276 1440 A
2205 V
(27656)210 1122 A
1482(*)S
(do_fstat)336 2784 A
4674(*)S
2295 V
(27657)210 1122 A
(*===========================================================================*/)3276 1482 A
2385 V
(27658)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_fstat\(\))420 1902 A
2475 V
(27659)210 1122 A
1440({)S
2565 V
(27660)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(fstat\(fd,)378 2070 A
(buf\))168 2490 A
(system)252 2700 A
(call.)210 2994 A
3246(*/)S
2655 V
(27661)210 1122 A
2745 V
(27662)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(filp)168 2196 A
(*rfilp;)294 2406 A
2835 V
(27663)210 1122 A
2925 V
(27664)210 1122 A
1524(/*)S
1650(Is)S
(the)126 1776 A
(file)168 1944 A
(descriptor)420 2154 A
(valid?)252 2616 A
2910(*/)S
3015 V
(27665)210 1122 A
1524(if)S
1650(\()S
(\(rfilp)252 1734 A
2028(=)S
(get_filp\(m_in.fd\)\))756 2112 A
2910(==)S
(NIL_FILP\))378 3036 A
(return\(err_code\);)714 3456 A
3105 V
(27666)210 1122 A
3195 V
(27667)210 1122 A
(return\(stat_inode\(rfilp->filp_ino,)1428 1524 A
(rfilp,)252 2994 A
(m_in.buffer\)\);)588 3288 A
3285 V
(27668)210 1122 A
1440(})S
3465 V
(27670)210 1122 A
(/*===========================================================================*)3276 1440 A
3555 V
(27671)210 1122 A
1482(*)S
(stat_inode)420 2784 A
4674(*)S
3645 V
(27672)210 1122 A
(*===========================================================================*/)3276 1482 A
3735 V
(27673)210 1122 A
(PRIVATE)294 1440 A
(int)126 1776 A
(stat_inode\(rip,)630 1944 A
(fil_ptr,)336 2616 A
(user_addr\))420 2994 A
3825 V
(27674)210 1122 A
(register)336 1440 A
(struct)252 1818 A
(inode)210 2112 A
(*rip;)210 2364 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(inode)210 3372 A
3624(to)S
(stat)168 3750 A
3960(*/)S
3915 V
(27675)210 1122 A
(struct)252 1440 A
(filp)168 1734 A
(*fil_ptr;)378 1944 A
2784(/*)S
(filp)168 2910 A
(pointer,)336 3120 A
(supplied)336 3498 A
3876(by)S
('fstat')294 4002 A
4338(*/)S
4005 V
(27676)210 1122 A
(char)168 1440 A
(*user_addr;)462 1650 A
2784(/*)S
(user)168 2910 A
(space)210 3120 A
(address)294 3372 A
(where)210 3708 A
(stat)168 3960 A
(buf)126 4170 A
(goes)168 4338 A
4548(*/)S
4095 V
(27677)210 1122 A
1440({)S
4185 V
(27678)210 1122 A
1440(/*)S
(Common)252 1566 A
(code)168 1860 A
(for)126 2070 A
(stat)168 2238 A
(and)126 2448 A
(fstat)210 2616 A
(system)252 2868 A
(calls.)252 3162 A
3456(*/)S
4275 V
(27679)210 1122 A
4365 V
(27680)210 1122 A
(struct)252 1524 A
(stat)168 1818 A
(statbuf;)336 2028 A
4455 V
(27681)210 1122 A
(mode_t)252 1524 A
(mo;)126 1818 A
4545 V
(27682)210 1122 A
(int)126 1524 A
1692(r,)S
1818(s;)S
4635 V
(27683)210 1122 A
4725 V
(27684)210 1122 A
1524(/*)S
(Update)252 1650 A
(the)126 1944 A
(atime,)252 2112 A
(ctime,)252 2406 A
(and)126 2700 A
(mtime)210 2868 A
(fields)252 3120 A
3414(in)S
(the)126 3540 A
(inode,)252 3708 A
4002(if)S
(need)168 4128 A
(be.)126 4338 A
4506(*/)S
4815 V
(27685)210 1122 A
1524(if)S
(\(rip->i_update\))630 1650 A
(update_times\(rip\);)756 2322 A
4905 V
(27686)210 1122 A
4995 V
(27687)210 1122 A
1524(/*)S
(Fill)168 1650 A
1860(in)S
(the)126 1986 A
(statbuf)294 2154 A
(struct.)294 2490 A
2826(*/)S
5085 V
(27688)210 1122 A
1524(mo)S
1650(=)S
(rip->i_mode)462 1734 A
2238(&)S
(I_TYPE;)294 2322 A
5175 V
(27689)210 1122 A
5265 V
(27690)210 1122 A
1524(/*)S
(true)168 1650 A
(iff)126 1860 A
(special)294 2028 A
2364(*/)S
5355 V
(27691)210 1122 A
1524(s)S
1608(=)S
(\(mo)126 1692 A
1860(==)S
(I_CHAR_SPECIAL)588 1986 A
2616(||)S
2742(mo)S
2868(==)S
(I_BLOCK_SPECIAL\);)714 2994 A
5445 V
(27692)210 1122 A
5535 V
(27693)210 1122 A
(statbuf.st_dev)588 1524 A
2154(=)S
(rip->i_dev;)462 2238 A
5625 V
(27694)210 1122 A
(statbuf.st_ino)588 1524 A
2154(=)S
(rip->i_num;)462 2238 A
5715 V
(27695)210 1122 A
(statbuf.st_mode)630 1524 A
2196(=)S
(rip->i_mode;)504 2280 A
5805 V
(27696)210 1122 A
(statbuf.st_nlink)672 1524 A
2238(=)S
(rip->i_nlinks;)588 2322 A
5895 V
(27697)210 1122 A
(statbuf.st_uid)588 1524 A
2154(=)S
(rip->i_uid;)462 2238 A
5985 V
(27698)210 1122 A
(statbuf.st_gid)588 1524 A
2154(=)S
(rip->i_gid;)462 2238 A
6075 V
(27699)210 1122 A
(statbuf.st_rdev)630 1524 A
2196(=)S
(\(dev_t\))294 2280 A
2616(\(s)S
2742(?)S
(rip->i_zone[0])588 2826 A
3456(:)S
(NO_DEV\);)336 3540 A
6165 V
(27700)210 1122 A
(statbuf.st_size)630 1524 A
2196(=)S
(rip->i_size;)504 2280 A
6255 V
(27701)210 1122 A
6345 V
(27702)210 1122 A
1524(if)S
(\(rip->i_pipe)504 1650 A
2196(==)S
(I_PIPE\))294 2322 A
2658({)S
6435 V
(27703)210 1122 A
(statbuf.st_mode)630 1776 A
2448(&=)S
(\304I_REGULAR;)462 2574 A
3120(/*)S
(wipe)168 3246 A
(out)126 3456 A
(I_REGULAR)378 3624 A
(bit)126 4044 A
(for)126 4212 A
(pipes)210 4380 A
4632(*/)S
6525 V
(27704)210 1122 A
1776(if)S
(\(fil_ptr)336 1902 A
2280(!=)S
(NIL_FILP)336 2406 A
2784(&&)S
(fil_ptr->filp_mode)756 2910 A
3708(&)S
(R_BIT\))252 3792 A
6615 V
(27705)210 1122 A
(statbuf.st_size)630 2112 A
2784(-=)S
(fil_ptr->filp_pos;)756 2910 A
6705 V
(27706)210 1122 A
1524(})S
6795 V
(27707)210 1122 A
6885 V
(27708)210 1122 A
(statbuf.st_atime)672 1524 A
2238(=)S
(rip->i_atime;)546 2322 A
6975 V
(27709)210 1122 A
(statbuf.st_mtime)672 1524 A
2238(=)S
(rip->i_mtime;)546 2322 A
7065 V
(27710)210 1122 A
(statbuf.st_ctime)672 1524 A
2238(=)S
(rip->i_ctime;)546 2322 A
8418 V
EP
%%Page: 377 377
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2372(File:)S
2605(servers/fs/stadir.c)S
12 B
(377)180 4500 A
1755 V
7 LST
(27711)210 1122 A
1845 V
(27712)210 1122 A
1524(/*)S
(Copy)168 1650 A
(the)126 1860 A
(struct)252 2028 A
2322(to)S
(user)168 2448 A
(space.)252 2658 A
2952(*/)S
1935 V
(27713)210 1122 A
1524(r)S
1608(=)S
(sys_datacopy\(FS_PROC_NR,)1008 1692 A
(\(vir_bytes\))462 2742 A
(&statbuf,)378 3246 A
2025 V
(27714)210 1122 A
(who,)168 2112 A
(\(vir_bytes\))462 2322 A
(user_addr,)420 2826 A
(\(phys_bytes\))504 3288 A
(sizeof\(statbuf\)\);)714 3834 A
2115 V
(27715)210 1122 A
(return\(r\);)420 1524 A
2205 V
(27716)210 1122 A
1440(})S
2385 V
(27718)210 1122 A
(/*===========================================================================*)3276 1440 A
2475 V
(27719)210 1122 A
1482(*)S
(do_fstatfs)420 2784 A
4674(*)S
2565 V
(27720)210 1122 A
(*===========================================================================*/)3276 1482 A
2655 V
(27721)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_fstatfs\(\))504 1902 A
2745 V
(27722)210 1122 A
1440({)S
2835 V
(27723)210 1122 A
1524(/*)S
(Perform)294 1650 A
(the)126 1986 A
(fstatfs\(fd,)462 2154 A
(buf\))168 2658 A
(system)252 2868 A
(call.)210 3162 A
3414(*/)S
2925 V
(27724)210 1122 A
(struct)252 1524 A
(statfs)252 1818 A
(st;)126 2112 A
3015 V
(27725)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(filp)168 2196 A
(*rfilp;)294 2406 A
3105 V
(27726)210 1122 A
(int)126 1524 A
1692(r;)S
3195 V
(27727)210 1122 A
3285 V
(27728)210 1122 A
1524(/*)S
1650(Is)S
(the)126 1776 A
(file)168 1944 A
(descriptor)420 2154 A
(valid?)252 2616 A
2910(*/)S
3375 V
(27729)210 1122 A
1524(if)S
1650(\()S
(\(rfilp)252 1734 A
2028(=)S
(get_filp\(m_in.fd\)\))756 2112 A
2910(==)S
(NIL_FILP\))378 3036 A
(return\(err_code\);)714 3456 A
3465 V
(27730)210 1122 A
3555 V
(27731)210 1122 A
(st.f_bsize)420 1524 A
1986(=)S
(rfilp->filp_ino->i_sp->s_block_size;)1512 2070 A
3645 V
(27732)210 1122 A
3735 V
(27733)210 1122 A
1524(r)S
1608(=)S
(sys_datacopy\(FS_PROC_NR,)1008 1692 A
(\(vir_bytes\))462 2742 A
(&st,)168 3246 A
3825 V
(27734)210 1122 A
(who,)168 2112 A
(\(vir_bytes\))462 2322 A
(m_in.buffer,)504 2826 A
(\(phys_bytes\))504 3372 A
(sizeof\(st\)\);)504 3918 A
3915 V
(27735)210 1122 A
4005 V
(27736)210 1122 A
(return\(r\);)420 1566 A
4095 V
(27737)210 1122 A
1440(})S
4545 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4635 V
(servers/fs/protect.c)840 2676 A
4725 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
4905 V
(27800)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(deals)210 1986 A
(with)168 2238 A
(protection)420 2448 A
2910(in)S
(the)126 3036 A
(file)168 3204 A
(system.)294 3414 A
3792(It)S
(contains)336 3918 A
(the)126 4296 A
(code)168 4464 A
4995 V
(27801)210 1122 A
1482(*)S
(for)126 1566 A
(four)168 1734 A
(system)252 1944 A
(calls)210 2238 A
(that)168 2490 A
(relate)252 2700 A
2994(to)S
(protection.)462 3120 A
5085 V
(27802)210 1122 A
1482(*)S
5175 V
(27803)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are)126 2910 A
5265 V
(27804)210 1122 A
1482(*)S
(do_chmod:)378 1650 A
(perform)294 2112 A
(the)126 2448 A
(CHMOD)210 2616 A
(system)252 2868 A
(call)168 3162 A
5355 V
(27805)210 1122 A
1482(*)S
(do_chown:)378 1650 A
(perform)294 2112 A
(the)126 2448 A
(CHOWN)210 2616 A
(system)252 2868 A
(call)168 3162 A
5445 V
(27806)210 1122 A
1482(*)S
(do_umask:)378 1650 A
(perform)294 2112 A
(the)126 2448 A
(UMASK)210 2616 A
(system)252 2868 A
(call)168 3162 A
5535 V
(27807)210 1122 A
1482(*)S
(do_access:)420 1650 A
(perform)294 2112 A
(the)126 2448 A
(ACCESS)252 2616 A
(system)252 2910 A
(call)168 3204 A
5625 V
(27808)210 1122 A
1482(*)S
(forbidden:)420 1650 A
(check)210 2112 A
2364(to)S
(see)126 2490 A
2658(if)S
2784(a)S
(given)210 2868 A
(access)252 3120 A
3414(is)S
(allowed)294 3540 A
3876(on)S
4002(a)S
(given)210 4086 A
(inode)210 4338 A
5715 V
(27809)210 1122 A
1482(*/)S
5805 V
(27810)210 1122 A
5895 V
(27811)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
5985 V
(27812)210 1122 A
(#include)336 1440 A
(<unistd.h>)420 1818 A
6075 V
(27813)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
6165 V
(27814)210 1122 A
(#include)336 1440 A
("buf.h")294 1818 A
6255 V
(27815)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
6345 V
(27816)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
6435 V
(27817)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
6525 V
(27818)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
6615 V
(27819)210 1122 A
(#include)336 1440 A
("super.h")378 1818 A
6705 V
(27820)210 1122 A
8418 V
EP
%%Page: 378 378
BP
/slant 0 def
/height 0 def
1485 V
12 B
(378)180 1080 A
11 R
2341(File:)S
2574(servers/fs/protect.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(27821)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(27822)210 1122 A
1482(*)S
(do_chmod)336 2784 A
4674(*)S
1935 V
(27823)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(27824)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_chmod\(\))420 1902 A
2115 V
(27825)210 1122 A
1440({)S
2205 V
(27826)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(chmod\(name,)462 2070 A
(mode\))210 2574 A
(system)252 2826 A
(call.)210 3120 A
3372(*/)S
2295 V
(27827)210 1122 A
2385 V
(27828)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
2475 V
(27829)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(r;)S
2565 V
(27830)210 1122 A
2655 V
(27831)210 1122 A
1524(/*)S
(Temporarily)462 1650 A
(open)168 2154 A
(the)126 2364 A
(file.)210 2532 A
2784(*/)S
2745 V
(27832)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name,)924 1650 A
(m_in.name_length,)714 2616 A
(M3\))126 3372 A
3540(!=)S
(OK\))126 3666 A
(return\(err_code\);)714 3834 A
2835 V
(27833)210 1122 A
1524(if)S
1650(\()S
(\(rip)168 1734 A
1944(=)S
(eat_path\(user_path\)\))840 2028 A
2910(==)S
(NIL_INODE\))420 3036 A
(return\(err_code\);)714 3498 A
2925 V
(27834)210 1122 A
3015 V
(27835)210 1122 A
1524(/*)S
(Only)168 1650 A
(the)126 1860 A
(owner)210 2028 A
2280(or)S
(the)126 2406 A
(super_user)420 2574 A
(may)126 3036 A
(change)252 3204 A
(the)126 3498 A
(mode)168 3666 A
3876(of)S
4002(a)S
(file.)210 4086 A
3105 V
(27836)210 1122 A
1566(*)S
1650(No)S
(one)126 1776 A
(may)126 1944 A
(change)252 2112 A
(the)126 2406 A
(mode)168 2574 A
2784(of)S
2910(a)S
(file)168 2994 A
3204(on)S
3330(a)S
(read-only)378 3414 A
(file)168 3834 A
(system.)294 4044 A
3195 V
(27837)210 1122 A
1566(*/)S
3285 V
(27838)210 1122 A
1524(if)S
(\(rip->i_uid)462 1650 A
2154(!=)S
(fp->fp_effuid)546 2280 A
2868(&&)S
(!super_user\))504 2994 A
3375 V
(27839)210 1122 A
1776(r)S
1860(=)S
(EPERM;)252 1944 A
3465 V
(27840)210 1122 A
(else)168 1524 A
3555 V
(27841)210 1122 A
1776(r)S
1860(=)S
(read_only\(rip\);)630 1944 A
3645 V
(27842)210 1122 A
3735 V
(27843)210 1122 A
1524(/*)S
1650(If)S
(error,)252 1776 A
(return)252 2070 A
(inode.)252 2364 A
2658(*/)S
3825 V
(27844)210 1122 A
1524(if)S
1650(\(r)S
1776(!=)S
(OK\))126 1902 A
2112({)S
3915 V
(27845)210 1122 A
(put_inode\(rip\);)630 1776 A
4005 V
(27846)210 1122 A
(return\(r\);)420 1776 A
4095 V
(27847)210 1122 A
1524(})S
4185 V
(27848)210 1122 A
4275 V
(27849)210 1122 A
1524(/*)S
(Now)126 1650 A
(make)168 1818 A
(the)126 2028 A
(change.)294 2196 A
(Clear)210 2532 A
(setgid)252 2784 A
(bit)126 3078 A
3246(if)S
(file)168 3372 A
3582(is)S
(not)126 3708 A
3876(in)S
(caller's)336 4002 A
(grp)126 4380 A
4548(*/)S
4365 V
(27850)210 1122 A
(rip->i_mode)462 1524 A
2028(=)S
(\(rip->i_mode)504 2112 A
2658(&)S
(\304ALL_MODES\))462 2742 A
3246(|)S
(\(m_in.mode)420 3330 A
3792(&)S
(ALL_MODES\);)462 3876 A
4455 V
(27851)210 1122 A
1524(if)S
(\(!super_user)504 1650 A
2196(&&)S
(rip->i_gid)420 2322 A
2784(!=)S
(fp->fp_effgid\)rip->i_mode)1050 2910 A
4002(&=)S
(\304I_SET_GID_BIT;)630 4128 A
4545 V
(27852)210 1122 A
(rip->i_update)546 1524 A
2112(|=)S
(CTIME;)252 2238 A
4635 V
(27853)210 1122 A
(rip->i_dirt)462 1524 A
2028(=)S
(DIRTY;)252 2112 A
4725 V
(27854)210 1122 A
4815 V
(27855)210 1122 A
(put_inode\(rip\);)630 1524 A
4905 V
(27856)210 1122 A
(return\(OK\);)462 1524 A
4995 V
(27857)210 1122 A
1440(})S
5175 V
(27859)210 1122 A
(/*===========================================================================*)3276 1440 A
5265 V
(27860)210 1122 A
1482(*)S
(do_chown)336 2784 A
4674(*)S
5355 V
(27861)210 1122 A
(*===========================================================================*/)3276 1482 A
5445 V
(27862)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_chown\(\))420 1902 A
5535 V
(27863)210 1122 A
1440({)S
5625 V
(27864)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(chown\(name,)462 2070 A
(owner,)252 2574 A
(group\))252 2868 A
(system)252 3162 A
(call.)210 3456 A
3708(*/)S
5715 V
(27865)210 1122 A
5805 V
(27866)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
5895 V
(27867)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(r;)S
5985 V
(27868)210 1122 A
6075 V
(27869)210 1122 A
1524(/*)S
(Temporarily)462 1650 A
(open)168 2154 A
(the)126 2364 A
(file.)210 2532 A
2784(*/)S
6165 V
(27870)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name1,)966 1650 A
(m_in.name1_length,)756 2658 A
(M1\))126 3456 A
3624(!=)S
(OK\))126 3750 A
(return\(err_code\);)714 3918 A
6255 V
(27871)210 1122 A
1524(if)S
1650(\()S
(\(rip)168 1734 A
1944(=)S
(eat_path\(user_path\)\))840 2028 A
2910(==)S
(NIL_INODE\))420 3036 A
(return\(err_code\);)714 3498 A
6345 V
(27872)210 1122 A
6435 V
(27873)210 1122 A
1524(/*)S
(Not)126 1650 A
(permitted)378 1818 A
2238(to)S
(change)252 2364 A
(the)126 2658 A
(owner)210 2826 A
3078(of)S
3204(a)S
(file)168 3288 A
3498(on)S
3624(a)S
(read-only)378 3708 A
(file)168 4128 A
(sys.)168 4338 A
4548(*/)S
6525 V
(27874)210 1122 A
1524(r)S
1608(=)S
(read_only\(rip\);)630 1692 A
6615 V
(27875)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
2070({)S
6705 V
(27876)210 1122 A
1776(/*)S
1902(FS)S
2028(is)S
(R/W.)168 2154 A
(Whether)294 2406 A
(call)168 2742 A
2952(is)S
(allowed)294 3078 A
(depends)294 3414 A
3750(on)S
(ownership,)420 3876 A
(etc.)168 4338 A
4548(*/)S
6795 V
(27877)210 1122 A
1776(if)S
(\(super_user\))504 1902 A
2448({)S
6885 V
(27878)210 1122 A
2112(/*)S
(The)126 2238 A
(super)210 2406 A
(user)168 2658 A
(can)126 2868 A
3036(do)S
(anything.)378 3162 A
3582(*/)S
6975 V
(27879)210 1122 A
(rip->i_uid)420 2112 A
2574(=)S
(m_in.owner;)462 2658 A
3456(/*)S
(others)252 3582 A
(later)210 3876 A
4128(*/)S
7065 V
(27880)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
8418 V
EP
%%Page: 379 379
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2341(File:)S
2574(servers/fs/protect.c)S
12 B
(379)180 4500 A
1755 V
7 LST
(27881)210 1122 A
2112(/*)S
(Regular)294 2238 A
(users)210 2574 A
(can)126 2826 A
(only)168 2994 A
(change)252 3204 A
(groups)252 3498 A
3792(of)S
(their)210 3918 A
(own)126 4170 A
(files.)252 4338 A
4632(*/)S
1845 V
(27882)210 1122 A
2112(if)S
(\(rip->i_uid)462 2238 A
2742(!=)S
(fp->fp_effuid\))588 2868 A
3498(r)S
3582(=)S
(EPERM;)252 3666 A
1935 V
(27883)210 1122 A
2112(if)S
(\(rip->i_uid)462 2238 A
2742(!=)S
(m_in.owner\))462 2868 A
3372(r)S
3456(=)S
(EPERM;)252 3540 A
3876(/*)S
4002(no)S
(giving)252 4128 A
(away)168 4422 A
4632(*/)S
2025 V
(27884)210 1122 A
2112(if)S
(\(fp->fp_effgid)588 2238 A
2868(!=)S
(m_in.group\))462 2994 A
3498(r)S
3582(=)S
(EPERM;)252 3666 A
2115 V
(27885)210 1122 A
1776(})S
2205 V
(27886)210 1122 A
1524(})S
2295 V
(27887)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
2070({)S
2385 V
(27888)210 1122 A
(rip->i_gid)420 1776 A
2238(=)S
(m_in.group;)462 2322 A
2475 V
(27889)210 1122 A
(rip->i_mode)462 1776 A
2280(&=)S
(\304\(I_SET_UID_BIT)630 2406 A
3078(|)S
(I_SET_GID_BIT\);)630 3162 A
2565 V
(27890)210 1122 A
(rip->i_update)546 1776 A
2364(|=)S
(CTIME;)252 2490 A
2655 V
(27891)210 1122 A
(rip->i_dirt)462 1776 A
2280(=)S
(DIRTY;)252 2364 A
2745 V
(27892)210 1122 A
1524(})S
2835 V
(27893)210 1122 A
2925 V
(27894)210 1122 A
(put_inode\(rip\);)630 1524 A
3015 V
(27895)210 1122 A
(return\(r\);)420 1524 A
3105 V
(27896)210 1122 A
1440(})S
3285 V
(27898)210 1122 A
(/*===========================================================================*)3276 1440 A
3375 V
(27899)210 1122 A
1482(*)S
(do_umask)336 2784 A
4674(*)S
3465 V
(27900)210 1122 A
(*===========================================================================*/)3276 1482 A
3555 V
(27901)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_umask\(\))420 1902 A
3645 V
(27902)210 1122 A
1440({)S
3735 V
(27903)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(umask\(co_mode\))588 2070 A
(system)252 2700 A
(call.)210 2994 A
3246(*/)S
3825 V
(27904)210 1122 A
(register)336 1524 A
(mode_t)252 1902 A
2196(r;)S
3915 V
(27905)210 1122 A
4005 V
(27906)210 1122 A
1524(r)S
1608(=)S
(\304fp->fp_umask;)588 1692 A
2784(/*)S
(set)126 2910 A
('r')126 3078 A
3246(to)S
(complement)420 3372 A
3834(of)S
(old)126 3960 A
(mask)168 4128 A
4338(*/)S
4095 V
(27907)210 1122 A
(fp->fp_umask)504 1524 A
2070(=)S
(\304\(m_in.co_mode)588 2154 A
2784(&)S
(RWX_MODES\);)462 2868 A
4185 V
(27908)210 1122 A
(return\(r\);)420 1524 A
2784(/*)S
(return)252 2910 A
(complement)420 3204 A
3666(of)S
(old)126 3792 A
(mask)168 3960 A
4170(*/)S
4275 V
(27909)210 1122 A
1440(})S
4455 V
(27911)210 1122 A
(/*===========================================================================*)3276 1440 A
4545 V
(27912)210 1122 A
1482(*)S
(do_access)378 2784 A
4674(*)S
4635 V
(27913)210 1122 A
(*===========================================================================*/)3276 1482 A
4725 V
(27914)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_access\(\))462 1902 A
4815 V
(27915)210 1122 A
1440({)S
4905 V
(27916)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(access\(name,)504 2070 A
(mode\))210 2616 A
(system)252 2868 A
(call.)210 3162 A
3414(*/)S
4995 V
(27917)210 1122 A
5085 V
(27918)210 1122 A
(struct)252 1524 A
(inode)210 1818 A
(*rip;)210 2070 A
5175 V
(27919)210 1122 A
(register)336 1524 A
(int)126 1902 A
2070(r;)S
5265 V
(27920)210 1122 A
5355 V
(27921)210 1122 A
1524(/*)S
(First)210 1650 A
(check)210 1902 A
2154(to)S
(see)126 2280 A
2448(if)S
(the)126 2574 A
(mode)168 2742 A
2952(is)S
(correct.)336 3078 A
3456(*/)S
5445 V
(27922)210 1122 A
1524(if)S
1650(\()S
(\(m_in.mode)420 1734 A
2196(&)S
(\304\(R_OK)252 2280 A
2574(|)S
(W_OK)168 2658 A
2868(|)S
(X_OK\)\))252 2952 A
3246(!=)S
3372(0)S
3456(&&)S
(m_in.mode)378 3582 A
4002(!=)S
(F_OK\))210 4128 A
5535 V
(27923)210 1122 A
(return\(EINVAL\);)630 1776 A
5625 V
(27924)210 1122 A
5715 V
(27925)210 1122 A
1524(/*)S
(Temporarily)462 1650 A
(open)168 2154 A
(the)126 2364 A
(file)168 2532 A
(whose)210 2742 A
(access)252 2994 A
3288(is)S
3414(to)S
3540(be)S
(checked.)336 3666 A
4044(*/)S
5805 V
(27926)210 1122 A
1524(if)S
(\(fetch_name\(m_in.name,)924 1650 A
(m_in.name_length,)714 2616 A
(M3\))126 3372 A
3540(!=)S
(OK\))126 3666 A
(return\(err_code\);)714 3834 A
5895 V
(27927)210 1122 A
1524(if)S
1650(\()S
(\(rip)168 1734 A
1944(=)S
(eat_path\(user_path\)\))840 2028 A
2910(==)S
(NIL_INODE\))420 3036 A
(return\(err_code\);)714 3498 A
5985 V
(27928)210 1122 A
6075 V
(27929)210 1122 A
1524(/*)S
(Now)126 1650 A
(check)210 1818 A
(the)126 2070 A
(permissions.)504 2238 A
2784(*/)S
6165 V
(27930)210 1122 A
1524(r)S
1608(=)S
(forbidden\(rip,)588 1692 A
(\(mode_t\))336 2322 A
(m_in.mode\);)462 2700 A
6255 V
(27931)210 1122 A
(put_inode\(rip\);)630 1524 A
6345 V
(27932)210 1122 A
(return\(r\);)420 1524 A
6435 V
(27933)210 1122 A
1440(})S
6615 V
(27935)210 1122 A
(/*===========================================================================*)3276 1440 A
6705 V
(27936)210 1122 A
1482(*)S
(forbidden)378 2784 A
4674(*)S
6795 V
(27937)210 1122 A
(*===========================================================================*/)3276 1482 A
6885 V
(27938)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(forbidden\(register)756 1902 A
(struct)252 2700 A
(inode)210 2994 A
(*rip,)210 3246 A
(mode_t)252 3498 A
(access_desired\))630 3792 A
6975 V
(27939)210 1122 A
1440({)S
7065 V
(27940)210 1122 A
1440(/*)S
(Given)210 1566 A
1818(a)S
(pointer)294 1902 A
2238(to)S
2364(an)S
(inode,)252 2490 A
('rip',)252 2784 A
(and)126 3078 A
(the)126 3246 A
(access)252 3414 A
(desired,)336 3708 A
(determine)378 4086 A
8418 V
EP
%%Page: 380 380
BP
/slant 0 def
/height 0 def
1485 V
12 B
(380)180 1080 A
11 R
2341(File:)S
2574(servers/fs/protect.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(27941)210 1122 A
1482(*)S
1566(if)S
(the)126 1692 A
(access)252 1860 A
2154(is)S
(allowed,)336 2280 A
(and)126 2658 A
2826(if)S
(not)126 2952 A
(why)126 3120 A
(not.)168 3288 A
(The)126 3540 A
(routine)294 3708 A
(looks)210 4044 A
4296(up)S
(the)126 4422 A
1845 V
(27942)210 1122 A
1482(*)S
(caller's)336 1566 A
(uid)126 1944 A
2112(in)S
(the)126 2238 A
('fproc')294 2406 A
(table.)252 2742 A
3078(If)S
(access)252 3204 A
3498(is)S
(allowed,)336 3624 A
4002(OK)S
4128(is)S
(returned)336 4254 A
1935 V
(27943)210 1122 A
1482(*)S
1566(if)S
1692(it)S
1818(is)S
(forbidden,)420 1944 A
(EACCES)252 2406 A
2700(is)S
(returned.)378 2826 A
2025 V
(27944)210 1122 A
1482(*/)S
2115 V
(27945)210 1122 A
2205 V
(27946)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*old_rip)336 2448 A
2826(=)S
(rip;)168 2910 A
2295 V
(27947)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(super_block)462 2196 A
(*sp;)168 2700 A
2385 V
(27948)210 1122 A
(register)336 1524 A
(mode_t)252 1902 A
(bits,)210 2196 A
(perm_bits;)420 2448 A
2475 V
(27949)210 1122 A
(int)126 1524 A
1692(r,)S
(shift,)252 1818 A
(test_uid,)378 2112 A
(test_gid,)378 2532 A
(type;)210 2952 A
2565 V
(27950)210 1122 A
2655 V
(27951)210 1122 A
1524(if)S
(\(rip->i_mount)546 1650 A
2238(==)S
(I_MOUNT\))336 2364 A
2784(/*)S
(The)126 2910 A
(inode)210 3078 A
3330(is)S
(mounted)294 3456 A
(on.)126 3792 A
3960(*/)S
2745 V
(27952)210 1122 A
(for)126 1776 A
(\(sp)126 1944 A
2112(=)S
(&super_block[1];)672 2196 A
2910(sp)S
3036(<)S
(&super_block[NR_SUPERS];)1008 3120 A
(sp++\))210 4170 A
2835 V
(27953)210 1122 A
2112(if)S
(\(sp->s_imount)546 2238 A
2826(==)S
(rip\))168 2952 A
3162({)S
2925 V
(27954)210 1122 A
(rip)126 2448 A
2616(=)S
(get_inode\(sp->s_dev,)840 2700 A
(ROOT_INODE\);)504 3582 A
3015 V
(27955)210 1122 A
(break;)252 2448 A
3105 V
(27956)210 1122 A
2112(})S
2196(/*)S
2322(if)S
2448(*/)S
3195 V
(27957)210 1122 A
3285 V
(27958)210 1122 A
1524(/*)S
(Isolate)294 1650 A
(the)126 1986 A
(relevant)336 2154 A
(rwx)126 2532 A
(bits)168 2700 A
(from)168 2910 A
(the)126 3120 A
(mode.)210 3288 A
3540(*/)S
3375 V
(27959)210 1122 A
(bits)168 1524 A
1734(=)S
(rip->i_mode;)504 1818 A
3465 V
(27960)210 1122 A
(test_uid)336 1524 A
1902(=)S
(\(call_nr)336 1986 A
2364(==)S
(ACCESS)252 2490 A
2784(?)S
(fp->fp_realuid)588 2868 A
3498(:)S
(fp->fp_effuid\);)630 3582 A
3555 V
(27961)210 1122 A
(test_gid)336 1524 A
1902(=)S
(\(call_nr)336 1986 A
2364(==)S
(ACCESS)252 2490 A
2784(?)S
(fp->fp_realgid)588 2868 A
3498(:)S
(fp->fp_effgid\);)630 3582 A
3645 V
(27962)210 1122 A
1524(if)S
(\(test_uid)378 1650 A
2070(==)S
(SU_UID\))294 2196 A
2532({)S
3735 V
(27963)210 1122 A
1776(/*)S
(Grant)210 1902 A
(read)168 2154 A
(and)126 2364 A
(write)210 2532 A
(permission.)462 2784 A
(Grant)210 3330 A
(search)252 3582 A
(permission)420 3876 A
(for)126 4338 A
3825 V
(27964)210 1122 A
1818(*)S
(directories.)504 1902 A
(Grant)210 2490 A
(execute)294 2742 A
(permission)420 3078 A
(\(for)168 3540 A
(non-directories\))672 3750 A
4464(if)S
3915 V
(27965)210 1122 A
1818(*)S
(and)126 1902 A
(only)168 2070 A
2280(if)S
(one)126 2406 A
2574(of)S
(the)126 2700 A
('X')126 2868 A
(bits)168 3036 A
3246(is)S
(set.)168 3372 A
4005 V
(27966)210 1122 A
1818(*/)S
4095 V
(27967)210 1122 A
1776(if)S
1902(\()S
(\(bits)210 1986 A
2238(&)S
(I_TYPE\))294 2322 A
2658(==)S
(I_DIRECTORY)462 2784 A
3288(||)S
4185 V
(27968)210 1122 A
(bits)168 1986 A
2196(&)S
(\(\(X_BIT)294 2280 A
2616(<<)S
2742(6\))S
2868(|)S
(\(X_BIT)252 2952 A
3246(<<)S
3372(3\))S
3498(|)S
(X_BIT\)\))294 3582 A
4275 V
(27969)210 1122 A
(perm_bits)378 2112 A
2532(=)S
(R_BIT)210 2616 A
2868(|)S
(W_BIT)210 2952 A
3204(|)S
(X_BIT;)252 3288 A
4365 V
(27970)210 1122 A
(else)168 1776 A
4455 V
(27971)210 1122 A
(perm_bits)378 2112 A
2532(=)S
(R_BIT)210 2616 A
2868(|)S
(W_BIT;)252 2952 A
4545 V
(27972)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
4635 V
(27973)210 1122 A
1776(if)S
(\(test_uid)378 1902 A
2322(==)S
(rip->i_uid\))462 2448 A
(shift)210 2952 A
3204(=)S
3288(6;)S
3792(/*)S
(owner)210 3918 A
4170(*/)S
4725 V
(27974)210 1122 A
(else)168 1776 A
1986(if)S
(\(test_gid)378 2112 A
2532(==)S
(rip->i_gid)420 2658 A
3120(\))S
(shift)210 3204 A
3456(=)S
3540(3;)S
3792(/*)S
(group)210 3918 A
4170(*/)S
4815 V
(27975)210 1122 A
(else)168 1776 A
(shift)210 1986 A
2238(=)S
2322(0;)S
3792(/*)S
(other)210 3918 A
4170(*/)S
4905 V
(27976)210 1122 A
(perm_bits)378 1776 A
2196(=)S
(\(bits)210 2280 A
2532(>>)S
(shift\))252 2658 A
2952(&)S
(\(R_BIT)252 3036 A
3330(|)S
(W_BIT)210 3414 A
3666(|)S
(X_BIT\);)294 3750 A
4995 V
(27977)210 1122 A
1524(})S
5085 V
(27978)210 1122 A
5175 V
(27979)210 1122 A
1524(/*)S
1650(If)S
(access)252 1776 A
(desired)294 2070 A
2406(is)S
(not)126 2532 A
2700(a)S
(subset)252 2784 A
3078(of)S
(what)168 3204 A
3414(is)S
(allowed,)336 3540 A
3918(it)S
4044(is)S
(refused.)336 4170 A
4548(*/)S
5265 V
(27980)210 1122 A
1524(r)S
1608(=)S
(OK;)126 1692 A
5355 V
(27981)210 1122 A
1524(if)S
(\(\(perm_bits)462 1650 A
2154(|)S
(access_desired\))630 2238 A
2910(!=)S
(perm_bits\))420 3036 A
3498(r)S
3582(=)S
(EACCES;)294 3666 A
5445 V
(27982)210 1122 A
5535 V
(27983)210 1122 A
1524(/*)S
(Check)210 1650 A
1902(to)S
(see)126 2028 A
2196(if)S
(someone)294 2322 A
2658(is)S
(trying)252 2784 A
3078(to)S
(write)210 3204 A
3456(on)S
3582(a)S
(file)168 3666 A
(system)252 3876 A
(that)168 4170 A
4380(is)S
5625 V
(27984)210 1122 A
1566(*)S
(mounted)294 1650 A
(read-only.)420 1986 A
5715 V
(27985)210 1122 A
1566(*/)S
5805 V
(27986)210 1122 A
(type)168 1524 A
1734(=)S
(rip->i_mode)462 1818 A
2322(&)S
(I_TYPE;)294 2406 A
5895 V
(27987)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
5985 V
(27988)210 1122 A
1776(if)S
(\(access_desired)630 1902 A
2574(&)S
(W_BIT\))252 2658 A
6075 V
(27989)210 1122 A
2112(r)S
2196(=)S
(read_only\(rip\);)630 2280 A
6165 V
(27990)210 1122 A
6255 V
(27991)210 1122 A
1524(if)S
(\(rip)168 1650 A
1860(!=)S
(old_rip\))336 1986 A
(put_inode\(rip\);)630 2364 A
6345 V
(27992)210 1122 A
6435 V
(27993)210 1122 A
(return\(r\);)420 1524 A
6525 V
(27994)210 1122 A
1440(})S
6705 V
(27996)210 1122 A
(/*===========================================================================*)3276 1440 A
6795 V
(27997)210 1122 A
1482(*)S
(read_only)378 2784 A
4674(*)S
6885 V
(27998)210 1122 A
(*===========================================================================*/)3276 1482 A
6975 V
(27999)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(read_only\(ip\))546 1902 A
7065 V
(28000)210 1122 A
(struct)252 1440 A
(inode)210 1734 A
(*ip;)168 1986 A
2784(/*)S
(ptr)126 2910 A
3078(to)S
(inode)210 3204 A
(whose)210 3456 A
(file)168 3708 A
(sys)126 3918 A
4086(is)S
4212(to)S
4338(be)S
(cked)168 4464 A
4674(*/)S
8418 V
EP
%%Page: 381 381
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2341(File:)S
2574(servers/fs/protect.c)S
12 B
(381)180 4500 A
1755 V
7 LST
(28001)210 1122 A
1440({)S
1845 V
(28002)210 1122 A
1440(/*)S
(Check)210 1566 A
1818(to)S
(see)126 1944 A
2112(if)S
(the)126 2238 A
(file)168 2406 A
(system)252 2616 A
2910(on)S
(which)210 3036 A
(the)126 3288 A
(inode)210 3456 A
('ip')168 3708 A
(resides)294 3918 A
4254(is)S
(mounted)294 4380 A
1935 V
(28003)210 1122 A
1482(*)S
(read)168 1566 A
(only.)210 1776 A
2070(If)S
(so,)126 2196 A
(return)252 2364 A
(EROFS,)252 2658 A
(else)168 2952 A
(return)252 3162 A
(OK.)126 3456 A
2025 V
(28004)210 1122 A
1482(*/)S
2115 V
(28005)210 1122 A
2205 V
(28006)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(super_block)462 2196 A
(*sp;)168 2700 A
2295 V
(28007)210 1122 A
2385 V
(28008)210 1122 A
1524(sp)S
1650(=)S
(ip->i_sp;)378 1734 A
2475 V
(28009)210 1122 A
(return\(sp->s_rd_only)840 1524 A
2406(?)S
(EROFS)210 2490 A
2742(:)S
(OK\);)168 2826 A
2565 V
(28010)210 1122 A
1440(})S
2745 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2835 V
(servers/fs/dmap.c)714 2676 A
2925 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3105 V
(28100)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(contains)336 1986 A
(the)126 2364 A
(table)210 2532 A
(with)168 2784 A
(device)252 2994 A
(<->)126 3288 A
(driver)252 3456 A
(mappings.)378 3750 A
4170(It)S
(also)168 4296 A
3195 V
(28101)210 1122 A
1482(*)S
(contains)336 1566 A
(some)168 1944 A
(routines)336 2154 A
2532(to)S
(dynamically)462 2658 A
(add)126 3162 A
(and/)168 3330 A
3540(or)S
(remove)252 3666 A
(device)252 3960 A
(drivers)294 4254 A
3285 V
(28102)210 1122 A
1482(*)S
1566(or)S
(change)252 1692 A
(mappings.)378 1986 A
3375 V
(28103)210 1122 A
1482(*/)S
3465 V
(28104)210 1122 A
3555 V
(28105)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
3645 V
(28106)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
3735 V
(28107)210 1122 A
(#include)336 1440 A
(<string.h>)420 1818 A
3825 V
(28108)210 1122 A
(#include)336 1440 A
(<stdlib.h>)420 1818 A
3915 V
(28109)210 1122 A
(#include)336 1440 A
(<ctype.h>)378 1818 A
4005 V
(28110)210 1122 A
(#include)336 1440 A
(<unistd.h>)420 1818 A
4095 V
(28111)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
4185 V
(28112)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
4275 V
(28113)210 1122 A
4365 V
(28114)210 1122 A
1440(/*)S
(Some)168 1566 A
(devices)294 1776 A
(may)126 2112 A
2280(or)S
(may)126 2406 A
(not)126 2574 A
2742(be)S
(there)210 2868 A
3120(in)S
(the)126 3246 A
(next)168 3414 A
(table.)252 3624 A
3918(*/)S
4455 V
(28115)210 1122 A
(#define)294 1440 A
(DT\(enable,)420 1776 A
(opcl,)210 2238 A
(io,)126 2490 A
(driver,)294 2658 A
(flags\))252 2994 A
3288(\\)S
4545 V
(28116)210 1122 A
1524({)S
(\(enable?\(opcl\):no_dev\),)966 1608 A
(\(enable?\(io\):0\),)672 2616 A
3330(\\)S
4635 V
(28117)210 1122 A
(\(enable?\(driver\):0\),)840 1776 A
(\(flags\))294 2658 A
2994(},)S
4725 V
(28118)210 1122 A
(#define)294 1440 A
(NC\(x\))210 1776 A
(\(NR_CTRLRS)420 2028 A
2490(>=)S
(\(x\)\))168 2616 A
4815 V
(28119)210 1122 A
4905 V
(28120)210 1122 A
1440(/*)S
(The)126 1566 A
(order)210 1734 A
1986(of)S
(the)126 2112 A
(entries)294 2280 A
(here)168 2616 A
(determines)420 2826 A
(the)126 3288 A
(mapping)294 3456 A
(between)294 3792 A
(major)210 4128 A
(device)252 4380 A
4995 V
(28121)210 1122 A
1482(*)S
(numbers)294 1566 A
(and)126 1902 A
(tasks.)252 2070 A
(The)126 2406 A
(first)210 2574 A
(entry)210 2826 A
(\(major)252 3078 A
(device)252 3372 A
3666(0\))S
3792(is)S
(not)126 3918 A
(used.)210 4086 A
(The)126 4380 A
5085 V
(28122)210 1122 A
1482(*)S
(next)168 1566 A
(entry)210 1776 A
2028(is)S
(major)210 2154 A
(device)252 2406 A
2700(1,)S
(etc.)168 2826 A
(Character)378 3078 A
(and)126 3498 A
(block)210 3666 A
(devices)294 3918 A
(can)126 4254 A
4422(be)S
5175 V
(28123)210 1122 A
1482(*)S
(intermixed)420 1566 A
2028(at)S
(random.)294 2154 A
(The)126 2532 A
(ordering)336 2700 A
(determines)420 3078 A
(the)126 3540 A
(device)252 3708 A
(numbers)294 4002 A
4338(in)S
(/dev/.)252 4464 A
5265 V
(28124)210 1122 A
1482(*)S
(Note)168 1566 A
(that)168 1776 A
1986(FS)S
(knows)210 2112 A
(the)126 2364 A
(device)252 2532 A
(number)252 2826 A
3120(of)S
(/dev/ram/)378 3246 A
3666(to)S
(load)168 3792 A
(the)126 4002 A
(RAM)126 4170 A
(disk.)210 4338 A
5355 V
(28125)210 1122 A
1482(*)S
(Also)168 1566 A
(note)168 1776 A
(that)168 1986 A
(the)126 2196 A
(major)210 2364 A
(device)252 2616 A
(numbers)294 2910 A
(used)168 3246 A
3456(in)S
(/dev/)210 3582 A
(are)126 3834 A
(NOT)126 4002 A
(the)126 4170 A
(same)168 4338 A
4548(as)S
5445 V
(28126)210 1122 A
1482(*)S
(the)126 1566 A
(process)294 1734 A
(numbers)294 2070 A
2406(of)S
(the)126 2532 A
(device)252 2700 A
(drivers.)336 2994 A
5535 V
(28127)210 1122 A
1482(*/)S
5625 V
(28128)210 1122 A
1440(/*)S
5715 V
(28129)210 1122 A
(Driver)252 1524 A
(enabled)294 1818 A
(Open/Cls)336 2322 A
(I/O)126 2742 A
(Driver)252 3078 A
3372(#)S
(Flags)210 3624 A
(Device)252 3876 A
(File)168 4212 A
5805 V
(28130)210 1122 A
(--------------)588 1524 A
(--------)336 2322 A
(------)252 2742 A
(-----------)462 3078 A
(-----)210 3624 A
(------)252 3876 A
(----)168 4212 A
5895 V
(28131)210 1122 A
1482(*/)S
5985 V
(28132)210 1122 A
(struct)252 1440 A
(dmap)168 1734 A
(dmap[NR_DEVICES];)714 1944 A
3792(/*)S
(actual)252 3918 A
(map)126 4212 A
4380(*/)S
6075 V
(28133)210 1122 A
(PRIVATE)294 1440 A
(struct)252 1776 A
(dmap)168 2070 A
(init_dmap[])462 2280 A
2784(=)S
2868({)S
6165 V
(28134)210 1122 A
(DT\(1,)210 1524 A
(no_dev,)294 1776 A
2196(0,)S
2574(0,)S
3120(0\))S
3792(/*)S
3918(0)S
4002(=)S
(not)126 4086 A
(used)168 4254 A
4548(*/)S
6255 V
(28135)210 1122 A
(DT\(1,)210 1524 A
(gen_opcl,)378 1776 A
(gen_io,)294 2196 A
(MEM_PROC_NR,)504 2574 A
3120(0\))S
3792(/*)S
3918(1)S
4002(=)S
(/dev/mem)336 4086 A
4548(*/)S
6345 V
(28136)210 1122 A
(DT\(0,)210 1524 A
(no_dev,)294 1776 A
2196(0,)S
2574(0,)S
(DMAP_MUTABLE\))546 3120 A
3792(/*)S
3918(2)S
4002(=)S
(/dev/fd0)336 4086 A
4548(*/)S
6435 V
(28137)210 1122 A
(DT\(0,)210 1524 A
(no_dev,)294 1776 A
2196(0,)S
2574(0,)S
(DMAP_MUTABLE\))546 3120 A
3792(/*)S
3918(3)S
4002(=)S
(/dev/c0)294 4086 A
4548(*/)S
6525 V
(28138)210 1122 A
(DT\(1,)210 1524 A
(tty_opcl,)378 1776 A
(gen_io,)294 2196 A
(TTY_PROC_NR,)504 2574 A
3120(0\))S
3792(/*)S
3918(4)S
4002(=)S
(/dev/tty00)420 4086 A
4548(*/)S
6615 V
(28139)210 1122 A
(DT\(1,)210 1524 A
(ctty_opcl,ctty_io,)756 1776 A
(TTY_PROC_NR,)504 2574 A
3120(0\))S
3792(/*)S
3918(5)S
4002(=)S
(/dev/tty)336 4086 A
4548(*/)S
6705 V
(28140)210 1122 A
(DT\(0,)210 1524 A
(no_dev,)294 1776 A
2196(0,)S
(NONE,)210 2574 A
(DMAP_MUTABLE\))546 3120 A
3792(/*)S
3918(6)S
4002(=)S
(/dev/lp)294 4086 A
4548(*/)S
6795 V
(28141)210 1122 A
(DT\(1,)210 1524 A
(no_dev,)294 1776 A
2196(0,)S
2574(0,)S
(DMAP_MUTABLE\))546 3120 A
3792(/*)S
3918(7)S
4002(=)S
(/dev/ip)294 4086 A
4548(*/)S
6885 V
(28142)210 1122 A
(DT\(0,)210 1524 A
(no_dev,)294 1776 A
2196(0,)S
(NONE,)210 2574 A
(DMAP_MUTABLE\))546 3120 A
3792(/*)S
3918(8)S
4002(=)S
(/dev/c1)294 4086 A
4548(*/)S
6975 V
(28143)210 1122 A
(DT\(0,)210 1524 A
1776(0,)S
2196(0,)S
2574(0,)S
(DMAP_MUTABLE\))546 3120 A
3792(/*)S
3918(9)S
4002(=)S
(not)126 4086 A
(used)168 4254 A
4548(*/)S
7065 V
(28144)210 1122 A
(DT\(0,)210 1524 A
(no_dev,)294 1776 A
2196(0,)S
2574(0,)S
(DMAP_MUTABLE\))546 3120 A
(/*10)168 3792 A
4002(=)S
(/dev/c2)294 4086 A
4548(*/)S
8418 V
EP
%%Page: 382 382
BP
/slant 0 def
/height 0 def
1485 V
12 B
(382)180 1080 A
11 R
2373(File:)S
2606(servers/fs/dmap.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(28145)210 1122 A
(DT\(0,)210 1524 A
1776(0,)S
2196(0,)S
2574(0,)S
(DMAP_MUTABLE\))546 3120 A
(/*11)168 3792 A
4002(=)S
(not)126 4086 A
(used)168 4254 A
4548(*/)S
1845 V
(28146)210 1122 A
(DT\(0,)210 1524 A
(no_dev,)294 1776 A
2196(0,)S
(NONE,)210 2574 A
(DMAP_MUTABLE\))546 3120 A
(/*12)168 3792 A
4002(=)S
(/dev/c3)294 4086 A
4548(*/)S
1935 V
(28147)210 1122 A
(DT\(0,)210 1524 A
(no_dev,)294 1776 A
2196(0,)S
(NONE,)210 2574 A
(DMAP_MUTABLE\))546 3120 A
(/*13)168 3792 A
4002(=)S
(/dev/audio)420 4086 A
4548(*/)S
2025 V
(28148)210 1122 A
(DT\(0,)210 1524 A
(no_dev,)294 1776 A
2196(0,)S
(NONE,)210 2574 A
(DMAP_MUTABLE\))546 3120 A
(/*14)168 3792 A
4002(=)S
(/dev/mixer)420 4086 A
4548(*/)S
2115 V
(28149)210 1122 A
(DT\(1,)210 1524 A
(gen_opcl,)378 1776 A
(gen_io,)294 2196 A
(LOG_PROC_NR,)504 2574 A
3120(0\))S
(/*15)168 3792 A
4002(=)S
(/dev/klog)378 4086 A
4548(*/)S
2205 V
(28150)210 1122 A
(DT\(0,)210 1524 A
(no_dev,)294 1776 A
2196(0,)S
(NONE,)210 2574 A
(DMAP_MUTABLE\))546 3120 A
(/*16)168 3792 A
4002(=)S
(/dev/random*/)546 4086 A
2295 V
(28151)210 1122 A
(DT\(0,)210 1524 A
(no_dev,)294 1776 A
2196(0,)S
(NONE,)210 2574 A
(DMAP_MUTABLE\))546 3120 A
(/*17)168 3792 A
4002(=)S
(/dev/cmos)378 4086 A
4548(*/)S
2385 V
(28152)210 1122 A
1440(};)S
2475 V
(28153)210 1122 A
2565 V
(28154)210 1122 A
(/*===========================================================================*)3276 1440 A
2655 V
(28155)210 1122 A
1482(*)S
(do_devctl)378 2784 A
4674(*)S
2745 V
(28156)210 1122 A
(*===========================================================================*/)3276 1482 A
2835 V
(28157)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_devctl\(\))462 1902 A
2925 V
(28158)210 1122 A
1440({)S
3015 V
(28159)210 1122 A
(int)126 1524 A
(result;)294 1692 A
3105 V
(28160)210 1122 A
3195 V
(28161)210 1122 A
(switch\(m_in.ctl_req\))840 1524 A
2406({)S
3285 V
(28162)210 1122 A
(case)168 1524 A
(DEV_MAP:)336 1734 A
3375 V
(28163)210 1122 A
1692(/*)S
(Try)126 1818 A
1986(to)S
(update)252 2112 A
(device)252 2406 A
(mapping.)336 2700 A
3078(*/)S
3465 V
(28164)210 1122 A
(result)252 1692 A
1986(=)S
(map_driver\(m_in.dev_nr,)966 2070 A
(m_in.driver_nr,)630 3078 A
(m_in.dev_style\);)672 3750 A
3555 V
(28165)210 1122 A
(break;)252 1692 A
3645 V
(28166)210 1122 A
(case)168 1524 A
(DEV_UNMAP:)420 1734 A
3735 V
(28167)210 1122 A
(result)252 1692 A
1986(=)S
(ENOSYS;)294 2070 A
3825 V
(28168)210 1122 A
(break;)252 1692 A
3915 V
(28169)210 1122 A
(default:)336 1524 A
4005 V
(28170)210 1122 A
(result)252 1692 A
1986(=)S
(EINVAL;)294 2070 A
4095 V
(28171)210 1122 A
1524(})S
4185 V
(28172)210 1122 A
(return\(result\);)630 1524 A
4275 V
(28173)210 1122 A
1440(})S
4455 V
(28175)210 1122 A
(/*===========================================================================*)3276 1440 A
4545 V
(28176)210 1122 A
1482(*)S
(map_driver)420 2784 A
4674(*)S
4635 V
(28177)210 1122 A
(*===========================================================================*/)3276 1482 A
4725 V
(28178)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(map_driver\(major,)714 1902 A
(proc_nr,)336 2658 A
(style\))252 3036 A
4815 V
(28179)210 1122 A
(int)126 1440 A
(major;)252 1608 A
2784(/*)S
(major)210 2910 A
(number)252 3162 A
3456(of)S
(the)126 3582 A
(device)252 3750 A
4044(*/)S
4905 V
(28180)210 1122 A
(int)126 1440 A
(proc_nr;)336 1608 A
2784(/*)S
(process)294 2910 A
(number)252 3246 A
3540(of)S
(the)126 3666 A
(driver)252 3834 A
4128(*/)S
4995 V
(28181)210 1122 A
(int)126 1440 A
(style;)252 1608 A
2784(/*)S
(style)210 2910 A
3162(of)S
(the)126 3288 A
(device)252 3456 A
3750(*/)S
5085 V
(28182)210 1122 A
1440({)S
5175 V
(28183)210 1122 A
1440(/*)S
(Set)126 1566 A
1734(a)S
(new)126 1818 A
(device)252 1986 A
(driver)252 2280 A
(mapping)294 2574 A
2910(in)S
(the)126 3036 A
(dmap)168 3204 A
(table.)252 3414 A
(Given)210 3708 A
(that)168 3960 A
(correct)294 4170 A
5265 V
(28184)210 1122 A
1482(*)S
(arguments)378 1566 A
(are)126 1986 A
(given,)252 2154 A
(this)168 2448 A
(only)168 2658 A
(works)210 2868 A
3120(if)S
(the)126 3246 A
(entry)210 3414 A
3666(is)S
(mutable)294 3792 A
(and)126 4128 A
(the)126 4296 A
5355 V
(28185)210 1122 A
1482(*)S
(current)294 1566 A
(driver)252 1902 A
2196(is)S
(not)126 2322 A
(busy.)210 2490 A
5445 V
(28186)210 1122 A
1482(*)S
(Normal)252 1566 A
(error)210 1860 A
(codes)210 2112 A
(are)126 2364 A
(returned)336 2532 A
2910(so)S
(that)168 3036 A
(this)168 3246 A
(function)336 3456 A
(can)126 3834 A
4002(be)S
(used)168 4128 A
(from)168 4338 A
5535 V
(28187)210 1122 A
1482(*)S
1566(a)S
(system)252 1650 A
(call)168 1944 A
(that)168 2154 A
(tries)210 2364 A
2616(to)S
(dynamically)462 2742 A
(install)294 3246 A
3582(a)S
(new)126 3666 A
(driver.)294 3834 A
5625 V
(28188)210 1122 A
1482(*/)S
5715 V
(28189)210 1122 A
(struct)252 1524 A
(dmap)168 1818 A
(*dp;)168 2028 A
5805 V
(28190)210 1122 A
5895 V
(28191)210 1122 A
1524(/*)S
(Get)126 1650 A
(pointer)294 1818 A
2154(to)S
(device)252 2280 A
(entry)210 2574 A
2826(in)S
(the)126 2952 A
(dmap)168 3120 A
(table.)252 3330 A
3624(*/)S
5985 V
(28192)210 1122 A
1524(if)S
(\(major)252 1650 A
1944(>=)S
(NR_DEVICES\))462 2070 A
(return\(ENODEV\);)630 2574 A
6075 V
(28193)210 1122 A
1524(dp)S
1650(=)S
(&dmap[major];)546 1734 A
6165 V
(28194)210 1122 A
6255 V
(28195)210 1122 A
1524(/*)S
(See)126 1650 A
1818(if)S
(updating)336 1944 A
(the)126 2322 A
(entry)210 2490 A
2742(is)S
(allowed.)336 2868 A
3246(*/)S
6345 V
(28196)210 1122 A
1524(if)S
1650(\(!)S
(\(dp->dmap_flags)630 1776 A
2448(&)S
(DMAP_MUTABLE\)\))588 2532 A
(return\(EPERM\);)588 3204 A
6435 V
(28197)210 1122 A
1524(if)S
(\(dp->dmap_flags)630 1650 A
2322(&)S
(DMAP_BUSY\))420 2406 A
(return\(EBUSY\);)588 2910 A
6525 V
(28198)210 1122 A
6615 V
(28199)210 1122 A
1524(/*)S
(Check)210 1650 A
(process)294 1902 A
(number)252 2238 A
2532(of)S
(new)126 2658 A
(driver.)294 2826 A
3162(*/)S
6705 V
(28200)210 1122 A
1524(if)S
1650(\(!)S
(isokprocnr\(proc_nr\)\))840 1776 A
(return\(EINVAL\);)630 2700 A
6795 V
(28201)210 1122 A
6885 V
(28202)210 1122 A
1524(/*)S
(Try)126 1650 A
1818(to)S
(update)252 1944 A
(the)126 2238 A
(entry.)252 2406 A
2700(*/)S
6975 V
(28203)210 1122 A
(switch)252 1524 A
(\(style\))294 1818 A
2154({)S
7065 V
(28204)210 1122 A
(case)168 1524 A
(STYLE_DEV:)420 1734 A
(dp->dmap_opcl)546 2448 A
3036(=)S
(gen_opcl;)378 3120 A
(break;)252 3792 A
8418 V
EP
%%Page: 383 383
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2373(File:)S
2606(servers/fs/dmap.c)S
12 B
(383)180 4500 A
1755 V
7 LST
(28205)210 1122 A
(case)168 1524 A
(STYLE_TTY:)420 1734 A
(dp->dmap_opcl)546 2448 A
3036(=)S
(tty_opcl;)378 3120 A
(break;)252 3792 A
1845 V
(28206)210 1122 A
(case)168 1524 A
(STYLE_CLONE:)504 1734 A
(dp->dmap_opcl)546 2448 A
3036(=)S
(clone_opcl;)462 3120 A
(break;)252 3792 A
1935 V
(28207)210 1122 A
(default:)336 1524 A
(return\(EINVAL\);)630 2448 A
2025 V
(28208)210 1122 A
1524(})S
2115 V
(28209)210 1122 A
(dp->dmap_io)462 1524 A
2028(=)S
(gen_io;)294 2112 A
2205 V
(28210)210 1122 A
(dp->dmap_driver)630 1524 A
2196(=)S
(proc_nr;)336 2280 A
2295 V
(28211)210 1122 A
(return\(OK\);)462 1524 A
2385 V
(28212)210 1122 A
1440(})S
2565 V
(28214)210 1122 A
(/*===========================================================================*)3276 1440 A
2655 V
(28215)210 1122 A
1482(*)S
(build_dmap)420 2784 A
4674(*)S
2745 V
(28216)210 1122 A
(*===========================================================================*/)3276 1482 A
2835 V
(28217)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(build_dmap\(\))504 1944 A
2925 V
(28218)210 1122 A
1440({)S
3015 V
(28219)210 1122 A
1440(/*)S
(Initialize)420 1566 A
(the)126 2028 A
(table)210 2196 A
(with)168 2448 A
(all)126 2658 A
(device)252 2826 A
(<->)126 3120 A
(driver)252 3288 A
(mappings.)378 3582 A
(Then,)210 4002 A
(map)126 4254 A
3105 V
(28220)210 1122 A
1482(*)S
(the)126 1566 A
(boot)168 1734 A
(driver)252 1944 A
2238(to)S
2364(a)S
(controller)420 2448 A
(and)126 2910 A
(update)252 3078 A
(the)126 3372 A
(dmap)168 3540 A
(table)210 3750 A
4002(to)S
(that)168 4128 A
3195 V
(28221)210 1122 A
1482(*)S
(selection.)420 1566 A
(The)126 2028 A
(boot)168 2196 A
(driver)252 2406 A
(and)126 2700 A
(the)126 2868 A
(controller)420 3036 A
3498(it)S
(handles)294 3624 A
(are)126 3960 A
(set)126 4128 A
4296(at)S
3285 V
(28222)210 1122 A
1482(*)S
(the)126 1566 A
(boot)168 1734 A
(monitor.)336 1944 A
3375 V
(28223)210 1122 A
1482(*/)S
3465 V
(28224)210 1122 A
(char)168 1524 A
(driver[16];)462 1734 A
3555 V
(28225)210 1122 A
(char)168 1524 A
(*controller)462 1734 A
2238(=)S
("c##";)252 2322 A
3645 V
(28226)210 1122 A
(int)126 1524 A
(nr,)126 1692 A
(major)210 1860 A
2112(=)S
(-1;)126 2196 A
3735 V
(28227)210 1122 A
(int)126 1524 A
(i,s;)168 1692 A
3825 V
(28228)210 1122 A
(struct)252 1524 A
(dmap)168 1818 A
(*dp;)168 2028 A
3915 V
(28229)210 1122 A
4005 V
(28230)210 1122 A
1524(/*)S
(Build)210 1650 A
(table)210 1902 A
(with)168 2154 A
(device)252 2364 A
(<->)126 2658 A
(driver)252 2826 A
(mappings.)378 3120 A
3540(*/)S
4095 V
(28231)210 1122 A
(for)126 1524 A
(\(i=0;)210 1692 A
(i<NR_DEVICES;)546 1944 A
(i++\))168 2532 A
2742({)S
4185 V
(28232)210 1122 A
1692(dp)S
1818(=)S
(&dmap[i];)378 1902 A
4275 V
(28233)210 1122 A
1692(if)S
1818(\(i)S
1944(<)S
(sizeof\(init_dmap\)/sizeof\(struct)1302 2028 A
(dmap\))210 3372 A
3624(&&)S
4365 V
(28234)210 1122 A
(init_dmap[i].dmap_opcl)924 2028 A
2994(!=)S
(no_dev\))294 3120 A
3456({)S
3792(/*)S
3918(a)S
(preset)252 4002 A
(driver)252 4296 A
4590(*/)S
4455 V
(28235)210 1122 A
(dp->dmap_opcl)546 1860 A
2448(=)S
(init_dmap[i].dmap_opcl;)966 2532 A
4545 V
(28236)210 1122 A
(dp->dmap_io)462 1860 A
2364(=)S
(init_dmap[i].dmap_io;)882 2448 A
4635 V
(28237)210 1122 A
(dp->dmap_driver)630 1860 A
2532(=)S
(init_dmap[i].dmap_driver;)1050 2616 A
4725 V
(28238)210 1122 A
(dp->dmap_flags)588 1860 A
2490(=)S
(init_dmap[i].dmap_flags;)1008 2574 A
4815 V
(28239)210 1122 A
1692(})S
(else)168 1776 A
1986({)S
3792(/*)S
3918(no)S
(default)294 4044 A
4380(*/)S
4905 V
(28240)210 1122 A
(dp->dmap_opcl)546 1860 A
2448(=)S
(no_dev;)294 2532 A
4995 V
(28241)210 1122 A
(dp->dmap_io)462 1860 A
2364(=)S
2448(0;)S
5085 V
(28242)210 1122 A
(dp->dmap_driver)630 1860 A
2532(=)S
2616(0;)S
5175 V
(28243)210 1122 A
(dp->dmap_flags)588 1860 A
2490(=)S
(DMAP_MUTABLE;)546 2574 A
5265 V
(28244)210 1122 A
1692(})S
5355 V
(28245)210 1122 A
1524(})S
5445 V
(28246)210 1122 A
5535 V
(28247)210 1122 A
1524(/*)S
(Get)126 1650 A
(settings)336 1818 A
2196(of)S
('controller')504 2322 A
(and)126 2868 A
('driver')336 3036 A
3414(at)S
(the)126 3540 A
(boot)168 3708 A
(monitor.)336 3918 A
4296(*/)S
5625 V
(28248)210 1122 A
1524(if)S
(\(\(s)126 1650 A
1818(=)S
(env_get_param\("label",)924 1902 A
(driver,)294 2868 A
(sizeof\(driver\)\)\))672 3204 A
3918(!=)S
(OK\))126 4044 A
5715 V
(28249)210 1122 A
(panic\(__FILE__,"couldn't)1008 1692 A
(get)126 2742 A
(boot)168 2910 A
(monitor)294 3120 A
(parameter)378 3456 A
('driver'",)420 3876 A
(s\);)126 4338 A
5805 V
(28250)210 1122 A
1524(if)S
(\(\(s)126 1650 A
1818(=)S
(env_get_param\("controller",)1134 1902 A
(controller,)462 3078 A
(sizeof\(controller\)\)\))840 3582 A
4464(!=)S
(OK\))126 4590 A
5895 V
(28251)210 1122 A
(panic\(__FILE__,"couldn't)1008 1692 A
(get)126 2742 A
(boot)168 2910 A
(monitor)294 3120 A
(parameter)378 3456 A
('controller'",)588 3876 A
(s\);)126 4506 A
5985 V
(28252)210 1122 A
6075 V
(28253)210 1122 A
1524(/*)S
(Determine)378 1650 A
(major)210 2070 A
(number)252 2322 A
2616(to)S
(map)126 2742 A
(driver)252 2910 A
(onto.)210 3204 A
3456(*/)S
6165 V
(28254)210 1122 A
1524(if)S
(\(controller[0])588 1650 A
2280(==)S
('f')126 2406 A
2574(&&)S
(controller[1])546 2700 A
3288(==)S
('d'\))168 3414 A
3624({)S
6255 V
(28255)210 1122 A
(major)210 1692 A
1944(=)S
(FLOPPY_MAJOR;)546 2028 A
6345 V
(28256)210 1122 A
1524(})S
6435 V
(28257)210 1122 A
(else)168 1524 A
1734(if)S
(\(controller[0])588 1860 A
2490(==)S
('c')126 2616 A
2784(&&)S
(isdigit\(controller[1]\)\))966 2910 A
3918({)S
6525 V
(28258)210 1122 A
1692(if)S
(\(\(nr)168 1818 A
2028(=)S
(\(unsigned\))420 2112 A
(atoi\(&controller[1]\)\))882 2574 A
3498(>)S
(NR_CTRLRS\))420 3582 A
6615 V
(28259)210 1122 A
(panic\(__FILE__,"monitor)966 1860 A
('controller')504 2868 A
(maximum)294 3414 A
('c#')168 3750 A
(is",)168 3960 A
(NR_CTRLRS\);)462 4170 A
6705 V
(28260)210 1122 A
(major)210 1692 A
1944(=)S
(CTRLR\(nr\);)420 2028 A
6795 V
(28261)210 1122 A
1524(})S
6885 V
(28262)210 1122 A
(else)168 1524 A
1734({)S
6975 V
(28263)210 1122 A
(panic\(__FILE__,"monitor)966 1692 A
('controller')504 2700 A
(syntax)252 3246 A
3540(is)S
('c#')168 3666 A
3876(of)S
('fd'",)252 4002 A
(NO_NUM\);)336 4296 A
7065 V
(28264)210 1122 A
1524(})S
8418 V
EP
%%Page: 384 384
BP
/slant 0 def
/height 0 def
1485 V
12 B
(384)180 1080 A
11 R
2373(File:)S
2606(servers/fs/dmap.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(28265)210 1122 A
1845 V
(28266)210 1122 A
1524(/*)S
(Now)126 1650 A
(try)126 1818 A
1986(to)S
(set)126 2112 A
(the)126 2280 A
(actual)252 2448 A
(mapping)294 2742 A
(and)126 3078 A
(report)252 3246 A
3540(to)S
(the)126 3666 A
(user.)210 3834 A
4086(*/)S
1935 V
(28267)210 1122 A
1524(if)S
(\(\(s=map_driver\(major,)882 1650 A
(DRVR_PROC_NR,)546 2574 A
(STYLE_DEV\)\))462 3162 A
3666(!=)S
(OK\))126 3792 A
2025 V
(28268)210 1122 A
(panic\(__FILE__,"map_driver)1092 1692 A
(failed",s\);)462 2826 A
2115 V
(28269)210 1122 A
(printf\("Boot)504 1524 A
(medium)252 2070 A
(driver:)294 2364 A
2700(%s)S
(driver)252 2826 A
(mapped)252 3120 A
(onto)168 3414 A
(controller)420 3624 A
(%s.\\n",)294 4086 A
2205 V
(28270)210 1122 A
(driver,)294 1692 A
(controller\);)504 2028 A
2295 V
(28271)210 1122 A
1440(})S
2745 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
2835 V
(servers/fs/device.c)798 2676 A
2925 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
3105 V
(28300)210 1122 A
1440(/*)S
(When)168 1566 A
1776(a)S
(needed)252 1860 A
(block)210 2154 A
2406(is)S
(not)126 2532 A
2700(in)S
(the)126 2826 A
(cache,)252 2994 A
3288(it)S
(must)168 3414 A
3624(be)S
(fetched)294 3750 A
(from)168 4086 A
(the)126 4296 A
(disk.)210 4464 A
3195 V
(28301)210 1122 A
1482(*)S
(Special)294 1566 A
(character)378 1902 A
(files)210 2322 A
(also)168 2574 A
(require)294 2784 A
(I/O.)168 3120 A
(The)126 3372 A
(routines)336 3540 A
(for)126 3918 A
(these)210 4086 A
(are)126 4338 A
(here.)210 4506 A
3285 V
(28302)210 1122 A
1482(*)S
3375 V
(28303)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
2280(in)S
(this)168 2406 A
(file)168 2616 A
(are:)168 2826 A
3465 V
(28304)210 1122 A
1482(*)S
(dev_open:)378 1650 A
2154(FS)S
(opens)210 2280 A
2532(a)S
(device)252 2616 A
3555 V
(28305)210 1122 A
1482(*)S
(dev_close:)420 1650 A
2154(FS)S
(closes)252 2280 A
2574(a)S
(device)252 2658 A
3645 V
(28306)210 1122 A
1482(*)S
(dev_io:)294 1650 A
2154(FS)S
(does)168 2280 A
2490(a)S
(read)168 2574 A
2784(or)S
(write)210 2910 A
3162(on)S
3288(a)S
(device)252 3372 A
3735 V
(28307)210 1122 A
1482(*)S
(dev_status:)462 1650 A
2154(FS)S
(processes)378 2280 A
(callback)336 2700 A
(request)294 3078 A
(alert)210 3414 A
3825 V
(28308)210 1122 A
1482(*)S
(gen_opcl:)378 1650 A
(generic)294 2154 A
(call)168 2490 A
2700(to)S
2826(a)S
(task)168 2910 A
3120(to)S
(perform)294 3246 A
3582(an)S
(open/close)420 3708 A
3915 V
(28309)210 1122 A
1482(*)S
(gen_io:)294 1650 A
(generic)294 2154 A
(call)168 2490 A
2700(to)S
2826(a)S
(task)168 2910 A
3120(to)S
(perform)294 3246 A
3582(an)S
(I/O)126 3708 A
(operation)378 3876 A
4005 V
(28310)210 1122 A
1482(*)S
(no_dev:)294 1650 A
(open/close)420 2154 A
(processing)420 2616 A
(for)126 3078 A
(devices)294 3246 A
(that)168 3582 A
(don't)210 3792 A
(exist)210 4044 A
4095 V
(28311)210 1122 A
1482(*)S
(tty_opcl:)378 1650 A
(perform)294 2154 A
(tty-specific)504 2490 A
(processing)420 3036 A
(for)126 3498 A
(open/close)420 3666 A
4185 V
(28312)210 1122 A
1482(*)S
(ctty_opcl:)420 1650 A
(perform)294 2154 A
(controlling-tty-specific)1008 2490 A
(processing)420 3540 A
(for)126 4002 A
(open/close)420 4170 A
4275 V
(28313)210 1122 A
1482(*)S
(ctty_io:)336 1650 A
(perform)294 2154 A
(controlling-tty-specific)1008 2490 A
(processing)420 3540 A
(for)126 4002 A
(I/O)126 4170 A
4365 V
(28314)210 1122 A
1482(*)S
(do_ioctl:)378 1650 A
(perform)294 2154 A
(the)126 2490 A
(IOCTL)210 2658 A
(system)252 2910 A
(call)168 3204 A
4455 V
(28315)210 1122 A
1482(*)S
(do_setsid:)420 1650 A
(perform)294 2154 A
(the)126 2490 A
(SETSID)252 2658 A
(system)252 2952 A
(call)168 3246 A
(\(FS)126 3456 A
(side\))210 3624 A
4545 V
(28316)210 1122 A
1482(*/)S
4635 V
(28317)210 1122 A
4725 V
(28318)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
4815 V
(28319)210 1122 A
(#include)336 1440 A
(<fcntl.h>)378 1818 A
4905 V
(28320)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
4995 V
(28321)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
5085 V
(28322)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
5175 V
(28323)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
5265 V
(28324)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
5355 V
(28325)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
5445 V
(28326)210 1122 A
5535 V
(28327)210 1122 A
(#define)294 1440 A
(ELEMENTS\(a\))462 1776 A
(\(sizeof\(a\)/sizeof\(\(a\)[0]\)\))1092 2280 A
5625 V
(28328)210 1122 A
5715 V
(28329)210 1122 A
(extern)252 1440 A
(int)126 1734 A
(dmap_size;)420 1902 A
5805 V
(28330)210 1122 A
5895 V
(28331)210 1122 A
(/*===========================================================================*)3276 1440 A
5985 V
(28332)210 1122 A
1482(*)S
(dev_open)336 2784 A
4674(*)S
6075 V
(28333)210 1122 A
(*===========================================================================*/)3276 1482 A
6165 V
(28334)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(dev_open\(dev,)546 1902 A
(proc,)210 2490 A
(flags\))252 2742 A
6255 V
(28335)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
2784(/*)S
(device)252 2910 A
3204(to)S
(open)168 3330 A
3540(*/)S
6345 V
(28336)210 1122 A
(int)126 1440 A
(proc;)210 1608 A
2784(/*)S
(process)294 2910 A
3246(to)S
(open)168 3372 A
(for)126 3582 A
3750(*/)S
6435 V
(28337)210 1122 A
(int)126 1440 A
(flags;)252 1608 A
2784(/*)S
(mode)168 2910 A
(bits)168 3120 A
(and)126 3330 A
(flags)210 3498 A
3750(*/)S
6525 V
(28338)210 1122 A
1440({)S
6615 V
(28339)210 1122 A
(int)126 1524 A
(major,)252 1692 A
1986(r;)S
6705 V
(28340)210 1122 A
(struct)252 1524 A
(dmap)168 1818 A
(*dp;)168 2028 A
6795 V
(28341)210 1122 A
6885 V
(28342)210 1122 A
1524(/*)S
(Determine)378 1650 A
(the)126 2070 A
(major)210 2238 A
(device)252 2490 A
(number)252 2784 A
(call)168 3078 A
(the)126 3288 A
(device)252 3456 A
(class)210 3750 A
(specific)336 4002 A
6975 V
(28343)210 1122 A
1566(*)S
(open/close)420 1650 A
(routine.)336 2112 A
(\(This)210 2532 A
2784(is)S
(the)126 2910 A
(only)168 3078 A
(routine)294 3288 A
(that)168 3624 A
(must)168 3834 A
(check)210 4044 A
(the)126 4296 A
7065 V
(28344)210 1122 A
1566(*)S
(device)252 1650 A
(number)252 1944 A
(for)126 2238 A
(being)210 2406 A
2658(in)S
(range.)252 2784 A
(All)126 3120 A
(others)252 3288 A
(can)126 3582 A
(trust)210 3750 A
(this)168 4002 A
(check.\))294 4212 A
8418 V
EP
%%Page: 385 385
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2350(File:)S
2583(servers/fs/device.c)S
12 B
(385)180 4500 A
1755 V
7 LST
(28345)210 1122 A
1566(*/)S
1845 V
(28346)210 1122 A
(major)210 1524 A
1776(=)S
(\(dev)168 1860 A
2070(>>)S
(MAJOR\))252 2196 A
2490(&)S
(BYTE;)210 2574 A
1935 V
(28347)210 1122 A
1524(if)S
(\(major)252 1650 A
1944(>=)S
(NR_DEVICES\))462 2070 A
(major)210 2574 A
2826(=)S
2910(0;)S
2025 V
(28348)210 1122 A
1524(dp)S
1650(=)S
(&dmap[major];)546 1734 A
2115 V
(28349)210 1122 A
1524(r)S
1608(=)S
(\(*dp->dmap_opcl\)\(DEV_OPEN,)1092 1692 A
(dev,)168 2826 A
(proc,)210 3036 A
(flags\);)294 3288 A
2205 V
(28350)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(SUSPEND\))336 1902 A
(panic\(__FILE__,"suspend)966 2280 A
3288(on)S
(open)168 3414 A
(from",)252 3624 A
(dp->dmap_driver\);)714 3918 A
2295 V
(28351)210 1122 A
(return\(r\);)420 1524 A
2385 V
(28352)210 1122 A
1440(})S
2565 V
(28354)210 1122 A
(/*===========================================================================*)3276 1440 A
2655 V
(28355)210 1122 A
1482(*)S
(dev_close)378 2784 A
4674(*)S
2745 V
(28356)210 1122 A
(*===========================================================================*/)3276 1482 A
2835 V
(28357)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(dev_close\(dev\))588 1944 A
2925 V
(28358)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
2784(/*)S
(device)252 2910 A
3204(to)S
(close)210 3330 A
3582(*/)S
3015 V
(28359)210 1122 A
1440({)S
3105 V
(28360)210 1122 A
(\(void\))252 1524 A
(\(*dmap[\(dev)462 1818 A
2322(>>)S
(MAJOR\))252 2448 A
2742(&)S
(BYTE].dmap_opcl\)\(DEV_CLOSE,)1134 2826 A
(dev,)168 4002 A
4212(0,)S
(0\);)126 4338 A
3195 V
(28361)210 1122 A
1440(})S
3375 V
(28363)210 1122 A
(/*===========================================================================*)3276 1440 A
3465 V
(28364)210 1122 A
1482(*)S
(dev_status)420 2784 A
4800(*)S
3555 V
(28365)210 1122 A
(*===========================================================================*/)3276 1482 A
3645 V
(28366)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(dev_status\(message)756 1944 A
(*m\))126 2742 A
3735 V
(28367)210 1122 A
1440({)S
3825 V
(28368)210 1122 A
(message)294 1776 A
(st;)126 2112 A
3915 V
(28369)210 1122 A
(int)126 1776 A
1944(d,)S
(get_more)336 2070 A
2448(=)S
2532(1;)S
4005 V
(28370)210 1122 A
4095 V
(28371)210 1122 A
(for\(d)210 1776 A
2028(=)S
2112(0;)S
2238(d)S
2322(<)S
(NR_DEVICES;)462 2406 A
(d++\))168 2910 A
4185 V
(28372)210 1122 A
2112(if)S
(\(dmap[d].dmap_driver)840 2238 A
3120(==)S
(m->m_source\))504 3246 A
4275 V
(28373)210 1122 A
(break;)252 2448 A
4365 V
(28374)210 1122 A
4455 V
(28375)210 1122 A
1776(if)S
1902(\(d)S
2028(>=)S
(NR_DEVICES\))462 2154 A
4545 V
(28376)210 1122 A
(return;)294 2112 A
4635 V
(28377)210 1122 A
4725 V
(28378)210 1122 A
1776(do)S
1902({)S
4815 V
(28379)210 1122 A
(int)126 2112 A
2280(r;)S
4905 V
(28380)210 1122 A
(st.m_type)378 2112 A
2532(=)S
(DEV_STATUS;)462 2616 A
4995 V
(28381)210 1122 A
2112(if)S
(\(\(r=sendrec\(m->m_source,)1008 2238 A
(&st\)\))210 3288 A
3540(!=)S
(OK\))126 3666 A
5085 V
(28382)210 1122 A
(panic\(__FILE__,"couldn't)1008 2448 A
(sendrec)294 3498 A
(for)126 3834 A
(DEV_STATUS",)504 4002 A
(r\);)126 4548 A
5175 V
(28383)210 1122 A
5265 V
(28384)210 1122 A
(switch\(st.m_type\))714 2112 A
2868({)S
5355 V
(28385)210 1122 A
(case)168 2448 A
(DEV_REVIVE:)462 2658 A
5445 V
(28386)210 1122 A
(revive\(st.REP_PROC_NR,)924 2784 A
(st.REP_STATUS\);)630 3750 A
5535 V
(28387)210 1122 A
(break;)252 2784 A
5625 V
(28388)210 1122 A
(case)168 2448 A
(DEV_IO_READY:)546 2658 A
5715 V
(28389)210 1122 A
(select_notified\(d,)756 2784 A
(st.DEV_MINOR,)546 3582 A
(st.DEV_SEL_OPS\);)672 4170 A
5805 V
(28390)210 1122 A
(break;)252 2784 A
5895 V
(28391)210 1122 A
(default:)336 2448 A
5985 V
(28392)210 1122 A
(printf\("FS:)462 2784 A
(unrecognized)504 3288 A
(reply)210 3834 A
4086(%d)S
4212(to)S
(DEV_STATUS\\n",)588 4338 A
(st.m_type\);)462 4968 A
6075 V
(28393)210 1122 A
2784(/*)S
(Fall)168 2910 A
(through.)336 3120 A
3498(*/)S
6165 V
(28394)210 1122 A
(case)168 2448 A
(DEV_NO_STATUS:)588 2658 A
6255 V
(28395)210 1122 A
(get_more)336 2784 A
3162(=)S
3246(0;)S
6345 V
(28396)210 1122 A
(break;)252 2784 A
6435 V
(28397)210 1122 A
2112(})S
6525 V
(28398)210 1122 A
1776(})S
(while\(get_more\);)672 1860 A
6615 V
(28399)210 1122 A
6705 V
(28400)210 1122 A
(return;)294 1776 A
6795 V
(28401)210 1122 A
1440(})S
8418 V
EP
%%Page: 386 386
BP
/slant 0 def
/height 0 def
1485 V
12 B
(386)180 1080 A
11 R
2350(File:)S
2583(servers/fs/device.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(28403)210 1122 A
(/*===========================================================================*)3276 1440 A
1845 V
(28404)210 1122 A
1482(*)S
(dev_io)252 2784 A
4674(*)S
1935 V
(28405)210 1122 A
(*===========================================================================*/)3276 1482 A
2025 V
(28406)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(dev_io\(op,)420 1902 A
(dev,)168 2364 A
(proc,)210 2574 A
(buf,)168 2826 A
(pos,)168 3036 A
(bytes,)252 3246 A
(flags\))252 3540 A
2115 V
(28407)210 1122 A
(int)126 1440 A
(op;)126 1608 A
2784(/*)S
(DEV_READ,)378 2910 A
(DEV_WRITE,)420 3330 A
(DEV_IOCTL,)420 3792 A
(etc.)168 4254 A
4464(*/)S
2205 V
(28408)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
2784(/*)S
(major-minor)462 2910 A
(device)252 3414 A
(number)252 3708 A
4002(*/)S
2295 V
(28409)210 1122 A
(int)126 1440 A
(proc;)210 1608 A
2784(/*)S
2910(in)S
(whose)210 3036 A
(address)294 3288 A
(space)210 3624 A
3876(is)S
(buf?)168 4002 A
4212(*/)S
2385 V
(28410)210 1122 A
(void)168 1440 A
(*buf;)210 1650 A
2784(/*)S
(virtual)294 2910 A
(address)294 3246 A
3582(of)S
(the)126 3708 A
(buffer)252 3876 A
4170(*/)S
2475 V
(28411)210 1122 A
(off_t)210 1440 A
(pos;)168 1692 A
2784(/*)S
(byte)168 2910 A
(position)336 3120 A
3498(*/)S
2565 V
(28412)210 1122 A
(int)126 1440 A
(bytes;)252 1608 A
2784(/*)S
(how)126 2910 A
(many)168 3078 A
(bytes)210 3288 A
3540(to)S
(transfer)336 3666 A
4044(*/)S
2655 V
(28413)210 1122 A
(int)126 1440 A
(flags;)252 1608 A
2784(/*)S
(special)294 2910 A
(flags,)252 3246 A
(like)168 3540 A
(O_NONBLOCK)420 3750 A
4212(*/)S
2745 V
(28414)210 1122 A
1440({)S
2835 V
(28415)210 1122 A
1440(/*)S
(Read)168 1566 A
1776(or)S
(write)210 1902 A
(from)168 2154 A
2364(a)S
(device.)294 2448 A
(The)126 2826 A
(parameter)378 2994 A
('dev')210 3414 A
(tells)210 3666 A
(which)210 3918 A
(one.)168 4170 A
4380(*/)S
2925 V
(28416)210 1122 A
(struct)252 1524 A
(dmap)168 1818 A
(*dp;)168 2028 A
3015 V
(28417)210 1122 A
(message)294 1524 A
(dev_mess;)378 1860 A
3105 V
(28418)210 1122 A
3195 V
(28419)210 1122 A
1524(/*)S
(Determine)378 1650 A
(task)168 2070 A
(dmap.)210 2280 A
2532(*/)S
3285 V
(28420)210 1122 A
1524(dp)S
1650(=)S
(&dmap[\(dev)420 1734 A
2196(>>)S
(MAJOR\))252 2322 A
2616(&)S
(BYTE];)252 2700 A
3375 V
(28421)210 1122 A
3465 V
(28422)210 1122 A
1524(/*)S
(Set)126 1650 A
1818(up)S
(the)126 1944 A
(message)294 2112 A
(passed)252 2448 A
2742(to)S
(task.)210 2868 A
3120(*/)S
3555 V
(28423)210 1122 A
(dev_mess.m_type)630 1524 A
2280(=)S
(op;)126 2364 A
3645 V
(28424)210 1122 A
(dev_mess.DEVICE)630 1524 A
2280(=)S
(\(dev)168 2364 A
2574(>>)S
(MINOR\))252 2700 A
2994(&)S
(BYTE;)210 3078 A
3735 V
(28425)210 1122 A
(dev_mess.POSITION)714 1524 A
2280(=)S
(pos;)168 2364 A
3825 V
(28426)210 1122 A
(dev_mess.PROC_NR)672 1524 A
2280(=)S
(proc;)210 2364 A
3915 V
(28427)210 1122 A
(dev_mess.ADDRESS)672 1524 A
2280(=)S
(buf;)168 2364 A
4005 V
(28428)210 1122 A
(dev_mess.COUNT)588 1524 A
2280(=)S
(bytes;)252 2364 A
4095 V
(28429)210 1122 A
(dev_mess.TTY_FLAGS)756 1524 A
2322(=)S
(flags;)252 2406 A
4185 V
(28430)210 1122 A
4275 V
(28431)210 1122 A
1524(/*)S
(Call)168 1650 A
(the)126 1860 A
(task.)210 2028 A
2280(*/)S
4365 V
(28432)210 1122 A
(\(*dp->dmap_io\)\(dp->dmap_driver,)1302 1524 A
(&dev_mess\);)462 2868 A
4455 V
(28433)210 1122 A
4545 V
(28434)210 1122 A
1524(/*)S
(Task)168 1650 A
(has)126 1860 A
(completed.)420 2028 A
(See)126 2532 A
2700(if)S
(call)168 2826 A
(completed.)420 3036 A
3498(*/)S
4635 V
(28435)210 1122 A
1524(if)S
(\(dev_mess.REP_STATUS)840 1650 A
2532(==)S
(SUSPEND\))336 2658 A
3036({)S
4725 V
(28436)210 1122 A
1776(if)S
(\(flags)252 1902 A
2196(&)S
(O_NONBLOCK\))462 2280 A
2784({)S
4815 V
(28437)210 1122 A
2112(/*)S
(Not)126 2238 A
(supposed)336 2406 A
2784(to)S
(block.)252 2910 A
3204(*/)S
4905 V
(28438)210 1122 A
(dev_mess.m_type)630 2112 A
2784(=)S
(CANCEL;)294 2868 A
4995 V
(28439)210 1122 A
(dev_mess.PROC_NR)672 2112 A
2826(=)S
(proc;)210 2910 A
5085 V
(28440)210 1122 A
(dev_mess.DEVICE)630 2112 A
2784(=)S
(\(dev)168 2868 A
3078(>>)S
(MINOR\))252 3204 A
3498(&)S
(BYTE;)210 3582 A
5175 V
(28441)210 1122 A
(\(*dp->dmap_io\)\(dp->dmap_driver,)1302 2112 A
(&dev_mess\);)462 3456 A
5265 V
(28442)210 1122 A
2112(if)S
(\(dev_mess.REP_STATUS)840 2238 A
3120(==)S
(EINTR\))252 3246 A
(dev_mess.REP_STATUS)798 3540 A
4380(=)S
(EAGAIN;)294 4464 A
5355 V
(28443)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
5445 V
(28444)210 1122 A
2112(/*)S
(Suspend)294 2238 A
(user.)210 2574 A
2826(*/)S
5535 V
(28445)210 1122 A
(suspend\(dp->dmap_driver\);)1050 2112 A
5625 V
(28446)210 1122 A
(return\(SUSPEND\);)672 2112 A
5715 V
(28447)210 1122 A
1776(})S
5805 V
(28448)210 1122 A
1524(})S
5895 V
(28449)210 1122 A
(return\(dev_mess.REP_STATUS\);)1176 1524 A
5985 V
(28450)210 1122 A
1440(})S
6165 V
(28452)210 1122 A
(/*===========================================================================*)3276 1440 A
6255 V
(28453)210 1122 A
1482(*)S
(gen_opcl)336 2784 A
4674(*)S
6345 V
(28454)210 1122 A
(*===========================================================================*/)3276 1482 A
6435 V
(28455)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(gen_opcl\(op,)504 1902 A
(dev,)168 2448 A
(proc,)210 2658 A
(flags\))252 2910 A
6525 V
(28456)210 1122 A
(int)126 1440 A
(op;)126 1608 A
2784(/*)S
(operation,)420 2910 A
(DEV_OPEN)336 3372 A
3750(or)S
(DEV_CLOSE)378 3876 A
4296(*/)S
6615 V
(28457)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
2784(/*)S
(device)252 2910 A
3204(to)S
(open)168 3330 A
3540(or)S
(close)210 3666 A
3918(*/)S
6705 V
(28458)210 1122 A
(int)126 1440 A
(proc;)210 1608 A
2784(/*)S
(process)294 2910 A
3246(to)S
(open/close)420 3372 A
(for)126 3834 A
4002(*/)S
6795 V
(28459)210 1122 A
(int)126 1440 A
(flags;)252 1608 A
2784(/*)S
(mode)168 2910 A
(bits)168 3120 A
(and)126 3330 A
(flags)210 3498 A
3750(*/)S
6885 V
(28460)210 1122 A
1440({)S
6975 V
(28461)210 1122 A
1440(/*)S
(Called)252 1566 A
(from)168 1860 A
(the)126 2070 A
(dmap)168 2238 A
(struct)252 2448 A
2742(in)S
(table.c)294 2868 A
3204(on)S
(opens)210 3330 A
3582(&)S
(closes)252 3666 A
3960(of)S
(special)294 4086 A
(files.*/)336 4422 A
7065 V
(28462)210 1122 A
(struct)252 1524 A
(dmap)168 1818 A
(*dp;)168 2028 A
8418 V
EP
%%Page: 387 387
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2350(File:)S
2583(servers/fs/device.c)S
12 B
(387)180 4500 A
1755 V
7 LST
(28463)210 1122 A
(message)294 1524 A
(dev_mess;)378 1860 A
1845 V
(28464)210 1122 A
1935 V
(28465)210 1122 A
1524(/*)S
(Determine)378 1650 A
(task)168 2070 A
(dmap.)210 2280 A
2532(*/)S
2025 V
(28466)210 1122 A
1524(dp)S
1650(=)S
(&dmap[\(dev)420 1734 A
2196(>>)S
(MAJOR\))252 2322 A
2616(&)S
(BYTE];)252 2700 A
2115 V
(28467)210 1122 A
2205 V
(28468)210 1122 A
(dev_mess.m_type)630 1524 A
2280(=)S
(op;)126 2364 A
2295 V
(28469)210 1122 A
(dev_mess.DEVICE)630 1524 A
2280(=)S
(\(dev)168 2364 A
2574(>>)S
(MINOR\))252 2700 A
2994(&)S
(BYTE;)210 3078 A
2385 V
(28470)210 1122 A
(dev_mess.PROC_NR)672 1524 A
2280(=)S
(proc;)210 2364 A
2475 V
(28471)210 1122 A
(dev_mess.COUNT)588 1524 A
2280(=)S
(flags;)252 2364 A
2565 V
(28472)210 1122 A
2655 V
(28473)210 1122 A
1524(/*)S
(Call)168 1650 A
(the)126 1860 A
(task.)210 2028 A
2280(*/)S
2745 V
(28474)210 1122 A
(\(*dp->dmap_io\)\(dp->dmap_driver,)1302 1524 A
(&dev_mess\);)462 2868 A
2835 V
(28475)210 1122 A
2925 V
(28476)210 1122 A
(return\(dev_mess.REP_STATUS\);)1176 1524 A
3015 V
(28477)210 1122 A
1440(})S
3195 V
(28479)210 1122 A
(/*===========================================================================*)3276 1440 A
3285 V
(28480)210 1122 A
1482(*)S
(tty_opcl)336 2784 A
4674(*)S
3375 V
(28481)210 1122 A
(*===========================================================================*/)3276 1482 A
3465 V
(28482)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(tty_opcl\(op,)504 1902 A
(dev,)168 2448 A
(proc,)210 2658 A
(flags\))252 2910 A
3555 V
(28483)210 1122 A
(int)126 1440 A
(op;)126 1608 A
2784(/*)S
(operation,)420 2910 A
(DEV_OPEN)336 3372 A
3750(or)S
(DEV_CLOSE)378 3876 A
4296(*/)S
3645 V
(28484)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
2784(/*)S
(device)252 2910 A
3204(to)S
(open)168 3330 A
3540(or)S
(close)210 3666 A
3918(*/)S
3735 V
(28485)210 1122 A
(int)126 1440 A
(proc;)210 1608 A
2784(/*)S
(process)294 2910 A
3246(to)S
(open/close)420 3372 A
(for)126 3834 A
4002(*/)S
3825 V
(28486)210 1122 A
(int)126 1440 A
(flags;)252 1608 A
2784(/*)S
(mode)168 2910 A
(bits)168 3120 A
(and)126 3330 A
(flags)210 3498 A
3750(*/)S
3915 V
(28487)210 1122 A
1440({)S
4005 V
(28488)210 1122 A
1440(/*)S
(This)168 1566 A
(procedure)378 1776 A
2196(is)S
(called)252 2322 A
(from)168 2616 A
(the)126 2826 A
(dmap)168 2994 A
(struct)252 3204 A
3498(on)S
(tty)126 3624 A
(open/close.)462 3792 A
4296(*/)S
4095 V
(28489)210 1122 A
4185 V
(28490)210 1122 A
(int)126 1524 A
1692(r;)S
4275 V
(28491)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(fproc)210 2196 A
(*rfp;)210 2448 A
4365 V
(28492)210 1122 A
4455 V
(28493)210 1122 A
1524(/*)S
(Add)126 1650 A
(O_NOCTTY)336 1818 A
2196(to)S
(the)126 2322 A
(flags)210 2490 A
2742(if)S
(this)168 2868 A
(process)294 3078 A
3414(is)S
(not)126 3540 A
3708(a)S
(session)294 3792 A
(leader,)294 4128 A
4464(or)S
4545 V
(28494)210 1122 A
1566(*)S
1650(if)S
1776(it)S
(already)294 1902 A
(has)126 2238 A
2406(a)S
(controlling)462 2490 A
(tty,)168 2994 A
3204(or)S
3330(if)S
3456(it)S
3582(is)S
(someone)294 3708 A
(elses)210 4044 A
4635 V
(28495)210 1122 A
1566(*)S
(controlling)462 1650 A
(tty.)168 2154 A
4725 V
(28496)210 1122 A
1566(*/)S
4815 V
(28497)210 1122 A
1524(if)S
(\(!fp->fp_sesldr)630 1650 A
2322(||)S
(fp->fp_tty)420 2448 A
2910(!=)S
3036(0\))S
3162({)S
4905 V
(28498)210 1122 A
(flags)210 1776 A
2028(|=)S
(O_NOCTTY;)378 2154 A
4995 V
(28499)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
5085 V
(28500)210 1122 A
(for)126 1776 A
(\(rfp)168 1944 A
2154(=)S
(&fproc[0];)420 2238 A
(rfp)126 2700 A
2868(<)S
(&fproc[NR_PROCS];)714 2952 A
(rfp++\))252 3708 A
4002({)S
5175 V
(28501)210 1122 A
2112(if)S
(\(rfp->fp_tty)504 2238 A
2784(==)S
(dev\))168 2910 A
(flags)210 3120 A
3372(|=)S
(O_NOCTTY;)378 3498 A
5265 V
(28502)210 1122 A
1776(})S
5355 V
(28503)210 1122 A
1524(})S
5445 V
(28504)210 1122 A
5535 V
(28505)210 1122 A
1524(r)S
1608(=)S
(gen_opcl\(op,)504 1692 A
(dev,)168 2238 A
(proc,)210 2448 A
(flags\);)294 2700 A
5625 V
(28506)210 1122 A
5715 V
(28507)210 1122 A
1524(/*)S
(Did)126 1650 A
(this)168 1818 A
(call)168 2028 A
(make)168 2238 A
(the)126 2448 A
(tty)126 2616 A
(the)126 2784 A
(controlling)462 2952 A
(tty?)168 3456 A
3666(*/)S
5805 V
(28508)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
1902(1\))S
2028({)S
5895 V
(28509)210 1122 A
(fp->fp_tty)420 1776 A
2238(=)S
(dev;)168 2322 A
5985 V
(28510)210 1122 A
1776(r)S
1860(=)S
(OK;)126 1944 A
6075 V
(28511)210 1122 A
1524(})S
6165 V
(28512)210 1122 A
(return\(r\);)420 1524 A
6255 V
(28513)210 1122 A
1440(})S
6435 V
(28515)210 1122 A
(/*===========================================================================*)3276 1440 A
6525 V
(28516)210 1122 A
1482(*)S
(ctty_opcl)378 2784 A
4674(*)S
6615 V
(28517)210 1122 A
(*===========================================================================*/)3276 1482 A
6705 V
(28518)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(ctty_opcl\(op,)546 1902 A
(dev,)168 2490 A
(proc,)210 2700 A
(flags\))252 2952 A
6795 V
(28519)210 1122 A
(int)126 1440 A
(op;)126 1608 A
2784(/*)S
(operation,)420 2910 A
(DEV_OPEN)336 3372 A
3750(or)S
(DEV_CLOSE)378 3876 A
4296(*/)S
6885 V
(28520)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
2784(/*)S
(device)252 2910 A
3204(to)S
(open)168 3330 A
3540(or)S
(close)210 3666 A
3918(*/)S
6975 V
(28521)210 1122 A
(int)126 1440 A
(proc;)210 1608 A
2784(/*)S
(process)294 2910 A
3246(to)S
(open/close)420 3372 A
(for)126 3834 A
4002(*/)S
7065 V
(28522)210 1122 A
(int)126 1440 A
(flags;)252 1608 A
2784(/*)S
(mode)168 2910 A
(bits)168 3120 A
(and)126 3330 A
(flags)210 3498 A
3750(*/)S
8418 V
EP
%%Page: 388 388
BP
/slant 0 def
/height 0 def
1485 V
12 B
(388)180 1080 A
11 R
2350(File:)S
2583(servers/fs/device.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(28523)210 1122 A
1440({)S
1845 V
(28524)210 1122 A
1440(/*)S
(This)168 1566 A
(procedure)378 1776 A
2196(is)S
(called)252 2322 A
(from)168 2616 A
(the)126 2826 A
(dmap)168 2994 A
(struct)252 3204 A
3498(in)S
(table.c)294 3624 A
3960(on)S
(opening/closing)630 4086 A
1935 V
(28525)210 1122 A
1482(*)S
(/dev/tty,)378 1566 A
(the)126 1986 A
(magic)210 2154 A
(device)252 2406 A
(that)168 2700 A
(translates)420 2910 A
3372(to)S
(the)126 3498 A
(controlling)462 3666 A
(tty.)168 4170 A
2025 V
(28526)210 1122 A
1482(*/)S
2115 V
(28527)210 1122 A
2205 V
(28528)210 1122 A
(return\(fp->fp_tty)714 1524 A
2280(==)S
2406(0)S
2490(?)S
(ENXIO)210 2574 A
2826(:)S
(OK\);)168 2910 A
2295 V
(28529)210 1122 A
1440(})S
2475 V
(28531)210 1122 A
(/*===========================================================================*)3276 1440 A
2565 V
(28532)210 1122 A
1482(*)S
(do_setsid)378 2784 A
4674(*)S
2655 V
(28533)210 1122 A
(*===========================================================================*/)3276 1482 A
2745 V
(28534)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_setsid\(\))462 1902 A
2835 V
(28535)210 1122 A
1440({)S
2925 V
(28536)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
2070(FS)S
(side)168 2196 A
2406(of)S
(the)126 2532 A
(SETSID)252 2700 A
(call,)210 2994 A
(i.e.)168 3246 A
(get)126 3456 A
(rid)126 3624 A
3792(of)S
(the)126 3918 A
(controlling)462 4086 A
3015 V
(28537)210 1122 A
1482(*)S
(terminal)336 1566 A
1944(of)S
2070(a)S
(process,)336 2154 A
(and)126 2532 A
(make)168 2700 A
(the)126 2910 A
(process)294 3078 A
3414(a)S
(session)294 3498 A
(leader.)294 3834 A
3105 V
(28538)210 1122 A
1482(*/)S
3195 V
(28539)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(fproc)210 2196 A
(*rfp;)210 2448 A
3285 V
(28540)210 1122 A
3375 V
(28541)210 1122 A
1524(/*)S
(Only)168 1650 A
1860(MM)S
(may)126 1986 A
2154(do)S
(the)126 2280 A
(SETSID)252 2448 A
(call)168 2742 A
(directly.)378 2952 A
3372(*/)S
3465 V
(28542)210 1122 A
1524(if)S
(\(who)168 1650 A
1860(!=)S
(PM_PROC_NR\))462 1986 A
(return\(ENOSYS\);)630 2490 A
3555 V
(28543)210 1122 A
3645 V
(28544)210 1122 A
1524(/*)S
(Make)168 1650 A
(the)126 1860 A
(process)294 2028 A
2364(a)S
(session)294 2448 A
(leader)252 2784 A
(with)168 3078 A
3288(no)S
(controlling)462 3414 A
(tty.)168 3918 A
4128(*/)S
3735 V
(28545)210 1122 A
(rfp)126 1524 A
1692(=)S
(&fproc[m_in.slot1];)798 1776 A
3825 V
(28546)210 1122 A
(rfp->fp_sesldr)588 1524 A
2154(=)S
(TRUE;)210 2238 A
3915 V
(28547)210 1122 A
(rfp->fp_tty)462 1524 A
2028(=)S
2112(0;)S
4005 V
(28548)210 1122 A
(return\(OK\);)462 1524 A
4095 V
(28549)210 1122 A
1440(})S
4275 V
(28551)210 1122 A
(/*===========================================================================*)3276 1440 A
4365 V
(28552)210 1122 A
1482(*)S
(do_ioctl)336 2784 A
4674(*)S
4455 V
(28553)210 1122 A
(*===========================================================================*/)3276 1482 A
4545 V
(28554)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_ioctl\(\))420 1902 A
4635 V
(28555)210 1122 A
1440({)S
4725 V
(28556)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(ioctl\(ls_fd,)504 2070 A
(request,)336 2616 A
(argx\))210 2994 A
(system)252 3246 A
(call)168 3540 A
(\(uses)210 3750 A
4002(m2)S
(fmt\).)210 4128 A
4380(*/)S
4815 V
(28557)210 1122 A
4905 V
(28558)210 1122 A
(struct)252 1524 A
(filp)168 1818 A
(*f;)126 2028 A
4995 V
(28559)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
5085 V
(28560)210 1122 A
(dev_t)210 1524 A
(dev;)168 1776 A
5175 V
(28561)210 1122 A
5265 V
(28562)210 1122 A
1524(if)S
1650(\()S
1734(\(f)S
1860(=)S
(get_filp\(m_in.ls_fd\)\))882 1944 A
2868(==)S
(NIL_FILP\))378 2994 A
(return\(err_code\);)714 3414 A
5355 V
(28563)210 1122 A
(rip)126 1524 A
1692(=)S
(f->filp_ino;)504 1776 A
2784(/*)S
(get)126 2910 A
(inode)210 3078 A
(pointer)294 3330 A
3666(*/)S
5445 V
(28564)210 1122 A
1524(if)S
1650(\()S
(\(rip->i_mode)504 1734 A
2280(&)S
(I_TYPE\))294 2364 A
2700(!=)S
(I_CHAR_SPECIAL)588 2826 A
5535 V
(28565)210 1122 A
1776(&&)S
(\(rip->i_mode)504 1902 A
2448(&)S
(I_TYPE\))294 2532 A
2868(!=)S
(I_BLOCK_SPECIAL\))672 2994 A
(return\(ENOTTY\);)630 3708 A
5625 V
(28566)210 1122 A
(dev)126 1524 A
1692(=)S
(\(dev_t\))294 1776 A
(rip->i_zone[0];)630 2112 A
5715 V
(28567)210 1122 A
5805 V
(28568)210 1122 A
(return\(dev_io\(DEV_IOCTL,)1008 1524 A
(dev,)168 2574 A
(who,)168 2784 A
(m_in.ADDRESS,)546 2994 A
(0L,)126 3582 A
5895 V
(28569)210 1122 A
(m_in.REQUEST,)546 1776 A
(f->filp_flags\)\);)672 2364 A
5985 V
(28570)210 1122 A
1440(})S
6165 V
(28572)210 1122 A
(/*===========================================================================*)3276 1440 A
6255 V
(28573)210 1122 A
1482(*)S
(gen_io)252 2784 A
4674(*)S
6345 V
(28574)210 1122 A
(*===========================================================================*/)3276 1482 A
6435 V
(28575)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(gen_io\(task_nr,)630 1944 A
(mess_ptr\))378 2616 A
6525 V
(28576)210 1122 A
(int)126 1440 A
(task_nr;)336 1608 A
2784(/*)S
(which)210 2910 A
(task)168 3162 A
3372(to)S
(call)168 3498 A
3708(*/)S
6615 V
(28577)210 1122 A
(message)294 1440 A
(*mess_ptr;)420 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(message)294 3372 A
(for)126 3708 A
(task)168 3876 A
4086(*/)S
6705 V
(28578)210 1122 A
1440({)S
6795 V
(28579)210 1122 A
1440(/*)S
(All)126 1566 A
(file)168 1734 A
(system)252 1944 A
(I/O)126 2238 A
(ultimately)420 2406 A
(comes)210 2868 A
(down)168 3120 A
3330(to)S
(I/O)126 3456 A
3624(on)S
(major/minor)462 3750 A
(device)252 4254 A
6885 V
(28580)210 1122 A
1482(*)S
(pairs.)252 1566 A
(These)210 1902 A
(lead)168 2154 A
2364(to)S
(calls)210 2490 A
2742(on)S
(the)126 2868 A
(following)378 3036 A
(routines)336 3456 A
(via)126 3834 A
(the)126 4002 A
(dmap)168 4170 A
(table.)252 4380 A
6975 V
(28581)210 1122 A
1482(*/)S
7065 V
(28582)210 1122 A
8418 V
EP
%%Page: 389 389
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2350(File:)S
2583(servers/fs/device.c)S
12 B
(389)180 4500 A
1755 V
7 LST
(28583)210 1122 A
(int)126 1524 A
1692(r,)S
(proc_nr;)336 1818 A
1845 V
(28584)210 1122 A
(message)294 1524 A
(local_m;)336 1860 A
1935 V
(28585)210 1122 A
2025 V
(28586)210 1122 A
(proc_nr)294 1524 A
1860(=)S
(mess_ptr->PROC_NR;)756 1944 A
2115 V
(28587)210 1122 A
1524(if)S
1650(\(!)S
(isokprocnr\(proc_nr\)\))840 1776 A
2658({)S
2205 V
(28588)210 1122 A
(printf\("FS:)462 1692 A
(warning,)336 2196 A
(got)126 2574 A
(illegal)294 2742 A
(process)294 3078 A
(number)252 3414 A
(\(%d\))168 3708 A
(from)168 3918 A
(%d\\n",)252 4128 A
2295 V
(28589)210 1122 A
(mess_ptr->PROC_NR,)756 1860 A
(mess_ptr->m_source\);)840 2658 A
2385 V
(28590)210 1122 A
(return;)294 1692 A
2475 V
(28591)210 1122 A
1524(})S
2565 V
(28592)210 1122 A
2655 V
(28593)210 1122 A
(while)210 1524 A
(\(\(r)126 1776 A
1944(=)S
(sendrec\(task_nr,)672 2028 A
(mess_ptr\)\))420 2742 A
3204(==)S
(ELOCKED\))336 3330 A
3708({)S
2745 V
(28594)210 1122 A
1776(/*)S
(sendrec\(\))378 1902 A
(failed)252 2322 A
2616(to)S
(avoid)210 2742 A
(deadlock.)378 2994 A
(The)126 3414 A
(task)168 3582 A
('task_nr')378 3792 A
4212(is)S
2835 V
(28595)210 1122 A
1818(*)S
(trying)252 1902 A
2196(to)S
(send)168 2322 A
2532(a)S
(REVIVE)252 2616 A
(message)294 2910 A
(for)126 3246 A
3414(an)S
(earlier)294 3540 A
(request.)336 3876 A
2925 V
(28596)210 1122 A
1818(*)S
(Handle)252 1902 A
2196(it)S
(and)126 2322 A
2490(go)S
(try)126 2616 A
(again.)252 2784 A
3015 V
(28597)210 1122 A
1818(*/)S
3105 V
(28598)210 1122 A
1776(if)S
(\(\(r)126 1902 A
2070(=)S
(receive\(task_nr,)672 2154 A
(&local_m\)\))420 2868 A
3330(!=)S
(OK\))126 3456 A
3624({)S
3195 V
(28599)210 1122 A
(break;)252 2112 A
3285 V
(28600)210 1122 A
1776(})S
3375 V
(28601)210 1122 A
3465 V
(28602)210 1122 A
1776(/*)S
1902(If)S
(we're)210 2028 A
(trying)252 2280 A
2574(to)S
(send)168 2700 A
2910(a)S
(cancel)252 2994 A
(message)294 3288 A
3624(to)S
3750(a)S
(task)168 3834 A
(which)210 4044 A
(has)126 4296 A
(just)168 4464 A
3555 V
(28603)210 1122 A
1818(*)S
(sent)168 1902 A
2112(a)S
(completion)420 2196 A
(reply,)252 2658 A
(ignore)252 2952 A
(the)126 3246 A
(reply)210 3414 A
(and)126 3666 A
(abort)210 3834 A
(the)126 4086 A
(cancel)252 4254 A
3645 V
(28604)210 1122 A
1818(*)S
(request.)336 1902 A
(The)126 2280 A
(caller)252 2448 A
(will)168 2742 A
2952(do)S
(the)126 3078 A
(revive)252 3246 A
(for)126 3540 A
(the)126 3708 A
(process.)336 3876 A
3735 V
(28605)210 1122 A
1818(*/)S
3825 V
(28606)210 1122 A
1776(if)S
(\(mess_ptr->m_type)714 1902 A
2658(==)S
(CANCEL)252 2784 A
3078(&&)S
(local_m.REP_PROC_NR)798 3204 A
4044(==)S
(proc_nr\))336 4170 A
4548({)S
3915 V
(28607)210 1122 A
(return;)294 2112 A
4005 V
(28608)210 1122 A
1776(})S
4095 V
(28609)210 1122 A
4185 V
(28610)210 1122 A
1776(/*)S
(Otherwise)378 1902 A
2322(it)S
(should)252 2448 A
2742(be)S
2868(a)S
(REVIVE.)294 2952 A
3288(*/)S
4275 V
(28611)210 1122 A
1776(if)S
(\(local_m.m_type)630 1902 A
2574(!=)S
(REVIVE\))294 2700 A
3036({)S
4365 V
(28612)210 1122 A
(printf\()294 2112 A
4455 V
(28613)210 1122 A
("fs:)168 2112 A
(strange)294 2322 A
(device)252 2658 A
(reply)210 2952 A
(from)168 3204 A
(%d,)126 3414 A
(type)168 3582 A
3792(=)S
(%d,)126 3876 A
(proc)168 4044 A
4254(=)S
4338(%d)S
(\(1\)\\n",)294 4464 A
4545 V
(28614)210 1122 A
(local_m.m_source,)714 2448 A
4635 V
(28615)210 1122 A
(local_m.m_type,)630 2448 A
(local_m.REP_PROC_NR\);)882 3120 A
4725 V
(28616)210 1122 A
(continue;)378 2112 A
4815 V
(28617)210 1122 A
1776(})S
4905 V
(28618)210 1122 A
4995 V
(28619)210 1122 A
(revive\(local_m.REP_PROC_NR,)1134 1776 A
(local_m.REP_STATUS\);)840 2952 A
5085 V
(28620)210 1122 A
1524(})S
5175 V
(28621)210 1122 A
5265 V
(28622)210 1122 A
1524(/*)S
(The)126 1650 A
(message)294 1818 A
(received)336 2154 A
(may)126 2532 A
2700(be)S
2826(a)S
(reply)210 2910 A
3162(to)S
(this)168 3288 A
(call,)210 3498 A
3750(or)S
3876(a)S
(REVIVE)252 3960 A
(for)126 4254 A
(some)168 4422 A
5355 V
(28623)210 1122 A
1566(*)S
(other)210 1650 A
(process.)336 1902 A
5445 V
(28624)210 1122 A
1566(*/)S
5535 V
(28625)210 1122 A
(for)126 1524 A
(\(;;\))168 1692 A
1902({)S
5625 V
(28626)210 1122 A
1776(if)S
1902(\(r)S
2028(!=)S
(OK\))126 2154 A
2322({)S
5715 V
(28627)210 1122 A
2112(if)S
2238(\(r)S
2364(==)S
(EDEADDST\))378 2490 A
(return;)294 2910 A
3456(/*)S
(give)168 3582 A
3792(up)S
3918(*/)S
5805 V
(28628)210 1122 A
(else)168 2112 A
(panic\(__FILE__,"call_task:)1092 2322 A
(can't)210 3456 A
(send/receive",)588 3708 A
(r\);)126 4338 A
5895 V
(28629)210 1122 A
1776(})S
5985 V
(28630)210 1122 A
6075 V
(28631)210 1122 A
1776(/*)S
(Did)126 1902 A
(the)126 2070 A
(process)294 2238 A
2574(we)S
(did)126 2700 A
(the)126 2868 A
(sendrec\(\))378 3036 A
(for)126 3456 A
(get)126 3624 A
3792(a)S
(result?)294 3876 A
4212(*/)S
6165 V
(28632)210 1122 A
1776(if)S
(\(mess_ptr->REP_PROC_NR)924 1902 A
2868(==)S
(proc_nr\))336 2994 A
3372({)S
6255 V
(28633)210 1122 A
(break;)252 2112 A
6345 V
(28634)210 1122 A
1776(})S
(else)168 1860 A
2070(if)S
(\(mess_ptr->m_type)714 2196 A
2952(==)S
(REVIVE\))294 3078 A
3414({)S
6435 V
(28635)210 1122 A
2112(/*)S
(Otherwise)378 2238 A
2658(it)S
(should)252 2784 A
3078(be)S
3204(a)S
(REVIVE.)294 3288 A
3624(*/)S
6525 V
(28636)210 1122 A
(revive\(mess_ptr->REP_PROC_NR,)1218 2112 A
(mess_ptr->REP_STATUS\);)924 3372 A
6615 V
(28637)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
6705 V
(28638)210 1122 A
(printf\()294 2112 A
6795 V
(28639)210 1122 A
("fs:)168 2112 A
(strange)294 2322 A
(device)252 2658 A
(reply)210 2952 A
(from)168 3204 A
(%d,)126 3414 A
(type)168 3582 A
3792(=)S
(%d,)126 3876 A
(proc)168 4044 A
4254(=)S
4338(%d)S
(\(2\)\\n",)294 4464 A
6885 V
(28640)210 1122 A
(mess_ptr->m_source,)798 2448 A
6975 V
(28641)210 1122 A
(mess_ptr->m_type,)714 2448 A
(mess_ptr->REP_PROC_NR\);)966 3204 A
7065 V
(28642)210 1122 A
(return;)294 2112 A
8418 V
EP
%%Page: 390 390
BP
/slant 0 def
/height 0 def
1485 V
12 B
(390)180 1080 A
11 R
2350(File:)S
2583(servers/fs/device.c)S
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(28643)210 1122 A
1776(})S
1845 V
(28644)210 1122 A
1935 V
(28645)210 1122 A
1776(r)S
1860(=)S
(receive\(task_nr,)672 1944 A
(mess_ptr\);)420 2658 A
2025 V
(28646)210 1122 A
1524(})S
2115 V
(28647)210 1122 A
1440(})S
2295 V
(28649)210 1122 A
(/*===========================================================================*)3276 1440 A
2385 V
(28650)210 1122 A
1482(*)S
(ctty_io)294 2784 A
4674(*)S
2475 V
(28651)210 1122 A
(*===========================================================================*/)3276 1482 A
2565 V
(28652)210 1122 A
(PUBLIC)252 1440 A
(void)168 1734 A
(ctty_io\(task_nr,)672 1944 A
(mess_ptr\))378 2658 A
2655 V
(28653)210 1122 A
(int)126 1440 A
(task_nr;)336 1608 A
2784(/*)S
(not)126 2910 A
(used)168 3078 A
3288(-)S
(for)126 3372 A
(compatibility)546 3540 A
(with)168 4128 A
(dmap_t)252 4338 A
4632(*/)S
2745 V
(28654)210 1122 A
(message)294 1440 A
(*mess_ptr;)420 1776 A
2784(/*)S
(pointer)294 2910 A
3246(to)S
(message)294 3372 A
(for)126 3708 A
(task)168 3876 A
4086(*/)S
2835 V
(28655)210 1122 A
1440({)S
2925 V
(28656)210 1122 A
1440(/*)S
(This)168 1566 A
(routine)294 1776 A
2112(is)S
(only)168 2238 A
(called)252 2448 A
(for)126 2742 A
(one)126 2910 A
(device,)294 3078 A
(namely)252 3414 A
(/dev/tty.)378 3708 A
(Its)126 4170 A
(job)126 4338 A
3015 V
(28657)210 1122 A
1482(*)S
1566(is)S
1692(to)S
(change)252 1818 A
(the)126 2112 A
(message)294 2280 A
2616(to)S
(use)126 2742 A
(the)126 2910 A
(controlling)462 3078 A
(terminal,)378 3582 A
(instead)294 4002 A
4338(of)S
(the)126 4464 A
3105 V
(28658)210 1122 A
1482(*)S
(major/minor)462 1566 A
(pair)168 2070 A
(for)126 2280 A
(/dev/tty)336 2448 A
(itself.)294 2826 A
3195 V
(28659)210 1122 A
1482(*/)S
3285 V
(28660)210 1122 A
3375 V
(28661)210 1122 A
(struct)252 1524 A
(dmap)168 1818 A
(*dp;)168 2028 A
3465 V
(28662)210 1122 A
3555 V
(28663)210 1122 A
1524(if)S
(\(fp->fp_tty)462 1650 A
2154(==)S
2280(0\))S
2406({)S
3645 V
(28664)210 1122 A
1776(/*)S
1902(No)S
(controlling)462 2028 A
(tty)126 2532 A
(present)294 2700 A
(anymore,)336 3036 A
(return)252 3414 A
3708(an)S
(I/O)126 3834 A
(error.)252 4002 A
4296(*/)S
3735 V
(28665)210 1122 A
(mess_ptr->REP_STATUS)840 1776 A
2658(=)S
(EIO;)168 2742 A
3825 V
(28666)210 1122 A
1524(})S
(else)168 1608 A
1818({)S
3915 V
(28667)210 1122 A
1776(/*)S
(Substitute)420 1902 A
(the)126 2364 A
(controlling)462 2532 A
(terminal)336 3036 A
(device.)294 3414 A
3750(*/)S
4005 V
(28668)210 1122 A
1776(dp)S
1902(=)S
(&dmap[\(fp->fp_tty)714 1986 A
2742(>>)S
(MAJOR\))252 2868 A
3162(&)S
(BYTE];)252 3246 A
4095 V
(28669)210 1122 A
(mess_ptr->DEVICE)672 1776 A
2490(=)S
(\(fp->fp_tty)462 2574 A
3078(>>)S
(MINOR\))252 3204 A
3498(&)S
(BYTE;)210 3582 A
4185 V
(28670)210 1122 A
(\(*dp->dmap_io\)\(dp->dmap_driver,)1302 1776 A
(mess_ptr\);)420 3120 A
4275 V
(28671)210 1122 A
1524(})S
4365 V
(28672)210 1122 A
1440(})S
4545 V
(28674)210 1122 A
(/*===========================================================================*)3276 1440 A
4635 V
(28675)210 1122 A
1482(*)S
(no_dev)252 2784 A
4674(*)S
4725 V
(28676)210 1122 A
(*===========================================================================*/)3276 1482 A
4815 V
(28677)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(no_dev\(op,)420 1902 A
(dev,)168 2364 A
(proc,)210 2574 A
(flags\))252 2826 A
4905 V
(28678)210 1122 A
(int)126 1440 A
(op;)126 1608 A
2784(/*)S
(operation,)420 2910 A
(DEV_OPEN)336 3372 A
3750(or)S
(DEV_CLOSE)378 3876 A
4296(*/)S
4995 V
(28679)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
2784(/*)S
(device)252 2910 A
3204(to)S
(open)168 3330 A
3540(or)S
(close)210 3666 A
3918(*/)S
5085 V
(28680)210 1122 A
(int)126 1440 A
(proc;)210 1608 A
2784(/*)S
(process)294 2910 A
3246(to)S
(open/close)420 3372 A
(for)126 3834 A
4002(*/)S
5175 V
(28681)210 1122 A
(int)126 1440 A
(flags;)252 1608 A
2784(/*)S
(mode)168 2910 A
(bits)168 3120 A
(and)126 3330 A
(flags)210 3498 A
3750(*/)S
5265 V
(28682)210 1122 A
1440({)S
5355 V
(28683)210 1122 A
1440(/*)S
(Called)252 1566 A
(when)168 1860 A
(opening)294 2070 A
2406(a)S
(nonexistent)462 2490 A
(device.)294 2994 A
3330(*/)S
5445 V
(28684)210 1122 A
5535 V
(28685)210 1122 A
(return\(ENODEV\);)630 1524 A
5625 V
(28686)210 1122 A
1440(})S
5805 V
(28688)210 1122 A
(/*===========================================================================*)3276 1440 A
5895 V
(28689)210 1122 A
1482(*)S
(clone_opcl)420 2784 A
4674(*)S
5985 V
(28690)210 1122 A
(*===========================================================================*/)3276 1482 A
6075 V
(28691)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(clone_opcl\(op,)588 1902 A
(dev,)168 2532 A
(proc,)210 2742 A
(flags\))252 2994 A
6165 V
(28692)210 1122 A
(int)126 1440 A
(op;)126 1608 A
2784(/*)S
(operation,)420 2910 A
(DEV_OPEN)336 3372 A
3750(or)S
(DEV_CLOSE)378 3876 A
4296(*/)S
6255 V
(28693)210 1122 A
(dev_t)210 1440 A
(dev;)168 1692 A
2784(/*)S
(device)252 2910 A
3204(to)S
(open)168 3330 A
3540(or)S
(close)210 3666 A
3918(*/)S
6345 V
(28694)210 1122 A
(int)126 1440 A
(proc;)210 1608 A
2784(/*)S
(process)294 2910 A
3246(to)S
(open/close)420 3372 A
(for)126 3834 A
4002(*/)S
6435 V
(28695)210 1122 A
(int)126 1440 A
(flags;)252 1608 A
2784(/*)S
(mode)168 2910 A
(bits)168 3120 A
(and)126 3330 A
(flags)210 3498 A
3750(*/)S
6525 V
(28696)210 1122 A
1440({)S
6615 V
(28697)210 1122 A
1440(/*)S
(Some)168 1566 A
(devices)294 1776 A
(need)168 2112 A
(special)294 2322 A
(processing)420 2658 A
(upon)168 3120 A
(open.)210 3330 A
(Such)168 3624 A
3834(a)S
(device)252 3918 A
4212(is)S
("cloned",)378 4338 A
6705 V
(28698)210 1122 A
1482(*)S
(i.e.)168 1566 A
1776(on)S
1902(a)S
(succesful)378 1986 A
(open)168 2406 A
2616(it)S
2742(is)S
(replaced)336 2868 A
3246(by)S
3372(a)S
(new)126 3456 A
(device)252 3624 A
(with)168 3918 A
4128(a)S
(new)126 4212 A
(unique)252 4380 A
6795 V
(28699)210 1122 A
1482(*)S
(minor)210 1566 A
(device)252 1818 A
(number.)294 2112 A
(This)168 2490 A
(new)126 2700 A
(device)252 2868 A
(number)252 3162 A
(identifies)420 3456 A
3918(a)S
(new)126 4002 A
(object)252 4170 A
(\(such)210 4464 A
6885 V
(28700)210 1122 A
1482(*)S
1566(as)S
1692(a)S
(new)126 1776 A
(network)294 1944 A
(connection\))462 2280 A
(that)168 2784 A
(has)126 2994 A
(been)168 3162 A
(allocated)378 3372 A
(within)252 3792 A
4086(a)S
(task.)210 4170 A
6975 V
(28701)210 1122 A
1482(*/)S
7065 V
(28702)210 1122 A
(struct)252 1524 A
(dmap)168 1818 A
(*dp;)168 2028 A
8418 V
EP
%%Page: 391 391
BP
/slant 0 def
/height 0 def
1485 V
9 R
1080(MINIX)S
1377(SOURCE)S
1758(CODE)S
11 R
2350(File:)S
2583(servers/fs/device.c)S
12 B
(391)180 4500 A
1755 V
7 LST
(28703)210 1122 A
(int)126 1524 A
(minor;)252 1692 A
1845 V
(28704)210 1122 A
(message)294 1524 A
(dev_mess;)378 1860 A
1935 V
(28705)210 1122 A
2025 V
(28706)210 1122 A
1524(/*)S
(Determine)378 1650 A
(task)168 2070 A
(dmap.)210 2280 A
2532(*/)S
2115 V
(28707)210 1122 A
1524(dp)S
1650(=)S
(&dmap[\(dev)420 1734 A
2196(>>)S
(MAJOR\))252 2322 A
2616(&)S
(BYTE];)252 2700 A
2205 V
(28708)210 1122 A
(minor)210 1524 A
1776(=)S
(\(dev)168 1860 A
2070(>>)S
(MINOR\))252 2196 A
2490(&)S
(BYTE;)210 2574 A
2295 V
(28709)210 1122 A
2385 V
(28710)210 1122 A
(dev_mess.m_type)630 1524 A
2280(=)S
(op;)126 2364 A
2475 V
(28711)210 1122 A
(dev_mess.DEVICE)630 1524 A
2280(=)S
(minor;)252 2364 A
2565 V
(28712)210 1122 A
(dev_mess.PROC_NR)672 1524 A
2280(=)S
(proc;)210 2364 A
2655 V
(28713)210 1122 A
(dev_mess.COUNT)588 1524 A
2280(=)S
(flags;)252 2364 A
2745 V
(28714)210 1122 A
2835 V
(28715)210 1122 A
1524(/*)S
(Call)168 1650 A
(the)126 1860 A
(task.)210 2028 A
2280(*/)S
2925 V
(28716)210 1122 A
(\(*dp->dmap_io\)\(dp->dmap_driver,)1302 1524 A
(&dev_mess\);)462 2868 A
3015 V
(28717)210 1122 A
3105 V
(28718)210 1122 A
1524(if)S
(\(op)126 1650 A
1818(==)S
(DEV_OPEN)336 1944 A
2322(&&)S
(dev_mess.REP_STATUS)798 2448 A
3288(>=)S
3414(0\))S
3540({)S
3195 V
(28719)210 1122 A
1776(if)S
(\(dev_mess.REP_STATUS)840 1902 A
2784(!=)S
(minor\))252 2910 A
3204({)S
3285 V
(28720)210 1122 A
2112(/*)S
2238(A)S
(new)126 2322 A
(minor)210 2490 A
(device)252 2742 A
(number)252 3036 A
(has)126 3330 A
(been)168 3498 A
(returned.)378 3708 A
(Create)252 4170 A
4464(a)S
3375 V
(28721)210 1122 A
2154(*)S
(temporary)378 2238 A
(device)252 2658 A
(file)168 2952 A
3162(to)S
(hold)168 3288 A
(it.)126 3498 A
3465 V
(28722)210 1122 A
2154(*/)S
3555 V
(28723)210 1122 A
(struct)252 2112 A
(inode)210 2406 A
(*ip;)168 2658 A
3645 V
(28724)210 1122 A
3735 V
(28725)210 1122 A
2112(/*)S
(Device)252 2238 A
(number)252 2532 A
2826(of)S
(the)126 2952 A
(new)126 3120 A
(device.)294 3288 A
3624(*/)S
3825 V
(28726)210 1122 A
(dev)126 2112 A
2280(=)S
(\(dev)168 2364 A
2574(&)S
(\304\(BYTE)252 2658 A
2952(<<)S
(MINOR\)\))294 3078 A
3414(|)S
(\(dev_mess.REP_STATUS)840 3498 A
4380(<<)S
(MINOR\);)294 4506 A
3915 V
(28727)210 1122 A
4005 V
(28728)210 1122 A
2112(ip)S
2238(=)S
(alloc_inode\(root_dev,)882 2322 A
(ALL_MODES)378 3246 A
3666(|)S
(I_CHAR_SPECIAL\);)672 3750 A
4095 V
(28729)210 1122 A
2112(if)S
(\(ip)126 2238 A
2406(==)S
(NIL_INODE\))420 2532 A
2994({)S
4185 V
(28730)210 1122 A
2448(/*)S
(Oops,)210 2574 A
(that)168 2826 A
(didn't)252 3036 A
(work.)210 3330 A
(Undo)168 3624 A
(open.)210 3834 A
4086(*/)S
4275 V
(28731)210 1122 A
(\(void\))252 2448 A
(clone_opcl\(DEV_CLOSE,)882 2742 A
(dev,)168 3666 A
(proc,)210 3876 A
(0\);)126 4128 A
4365 V
(28732)210 1122 A
(return\(err_code\);)714 2448 A
4455 V
(28733)210 1122 A
2112(})S
4545 V
(28734)210 1122 A
(ip->i_zone[0])546 2112 A
2700(=)S
(dev;)168 2784 A
4635 V
(28735)210 1122 A
4725 V
(28736)210 1122 A
(put_inode\(fp->fp_filp[m_in.fd]->filp_ino\);)1764 2112 A
4815 V
(28737)210 1122 A
(fp->fp_filp[m_in.fd]->filp_ino)1260 2112 A
3414(=)S
(ip;)126 3498 A
4905 V
(28738)210 1122 A
1776(})S
4995 V
(28739)210 1122 A
(dev_mess.REP_STATUS)798 1776 A
2616(=)S
(OK;)126 2700 A
5085 V
(28740)210 1122 A
1524(})S
5175 V
(28741)210 1122 A
(return\(dev_mess.REP_STATUS\);)1176 1524 A
5265 V
(28742)210 1122 A
1440(})S
5895 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
5985 V
(servers/fs/time.c)714 2676 A
6075 V
(++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++)3360 1080 A
6255 V
(28800)210 1122 A
1440(/*)S
(This)168 1566 A
(file)168 1776 A
(takes)210 1986 A
(care)168 2238 A
2448(of)S
(those)210 2574 A
(system)252 2826 A
(calls)210 3120 A
(that)168 3372 A
(deal)168 3582 A
(with)168 3792 A
(time.)210 4002 A
6345 V
(28801)210 1122 A
1482(*)S
6435 V
(28802)210 1122 A
1482(*)S
(The)126 1566 A
(entry)210 1734 A
(points)252 1986 A
(into)168 2280 A
(this)168 2490 A
(file)168 2700 A
(are)126 2910 A
6525 V
(28803)210 1122 A
1482(*)S
(do_utime:)378 1650 A
(perform)294 2448 A
(the)126 2784 A
(UTIME)210 2952 A
(system)252 3204 A
(call)168 3498 A
6615 V
(28804)210 1122 A
1482(*)S
(do_stime:)378 1650 A
2448(PM)S
(informs)294 2574 A
2910(FS)S
(about)210 3036 A
(STIME)210 3288 A
(system)252 3540 A
(call)168 3834 A
6705 V
(28805)210 1122 A
1482(*/)S
6795 V
(28806)210 1122 A
6885 V
(28807)210 1122 A
(#include)336 1440 A
("fs.h")252 1818 A
6975 V
(28808)210 1122 A
(#include)336 1440 A
(<minix/callnr.h>)672 1818 A
7065 V
(28809)210 1122 A
(#include)336 1440 A
(<minix/com.h>)546 1818 A
8418 V
EP
%%Page: 392 392
BP
/slant 0 def
/height 0 def
1485 V
12 B
(392)180 1080 A
11 R
2397(File:)S
(servers/fs/time.c)733 2630 A
9 R
3754(MINIX)S
4051(SOURCE)S
4432(CODE)S
1755 V
7 LST
(28810)210 1122 A
(#include)336 1440 A
("file.h")336 1818 A
1845 V
(28811)210 1122 A
(#include)336 1440 A
("fproc.h")378 1818 A
1935 V
(28812)210 1122 A
(#include)336 1440 A
("inode.h")378 1818 A
2025 V
(28813)210 1122 A
(#include)336 1440 A
("param.h")378 1818 A
2115 V
(28814)210 1122 A
2205 V
(28815)210 1122 A
(/*===========================================================================*)3276 1440 A
2295 V
(28816)210 1122 A
1482(*)S
(do_utime)336 2784 A
4674(*)S
2385 V
(28817)210 1122 A
(*===========================================================================*/)3276 1482 A
2475 V
(28818)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_utime\(\))420 1902 A
2565 V
(28819)210 1122 A
1440({)S
2655 V
(28820)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(utime\(name,)462 2070 A
(timep\))252 2574 A
(system)252 2868 A
(call.)210 3162 A
3414(*/)S
2745 V
(28821)210 1122 A
2835 V
(28822)210 1122 A
(register)336 1524 A
(struct)252 1902 A
(inode)210 2196 A
(*rip;)210 2448 A
2925 V
(28823)210 1122 A
(register)336 1524 A
(int)126 1902 A
(len,)168 2070 A
2280(r;)S
3015 V
(28824)210 1122 A
3105 V
(28825)210 1122 A
1524(/*)S
(Adjust)252 1650 A
(for)126 1944 A
(case)168 2112 A
2322(of)S
('timep')294 2448 A
(being)210 2784 A
(NULL;)210 3036 A
3195 V
(28826)210 1122 A
1566(*)S
(utime_strlen)504 1650 A
(then)168 2196 A
(holds)210 2406 A
(the)126 2658 A
(actual)252 2826 A
(size:)210 3120 A
(strlen\(name\)+1.)630 3372 A
3285 V
(28827)210 1122 A
1566(*/)S
3375 V
(28828)210 1122 A
(len)126 1524 A
1692(=)S
(m_in.utime_length;)756 1776 A
3465 V
(28829)210 1122 A
1524(if)S
(\(len)168 1650 A
1860(==)S
1986(0\))S
(len)126 2112 A
2280(=)S
(m_in.utime_strlen;)756 2364 A
3555 V
(28830)210 1122 A
3645 V
(28831)210 1122 A
1524(/*)S
(Temporarily)462 1650 A
(open)168 2154 A
(the)126 2364 A
(file.)210 2532 A
2784(*/)S
3735 V
(28832)210 1122 A
1524(if)S
(\(fetch_name\(m_in.utime_file,)1176 1650 A
(len,)168 2868 A
(M1\))126 3078 A
3246(!=)S
(OK\))126 3372 A
(return\(err_code\);)714 3540 A
3825 V
(28833)210 1122 A
1524(if)S
1650(\()S
(\(rip)168 1734 A
1944(=)S
(eat_path\(user_path\)\))840 2028 A
2910(==)S
(NIL_INODE\))420 3036 A
(return\(err_code\);)714 3498 A
3915 V
(28834)210 1122 A
4005 V
(28835)210 1122 A
1524(/*)S
(Only)168 1650 A
(the)126 1860 A
(owner)210 2028 A
2280(of)S
2406(a)S
(file)168 2490 A
2700(or)S
(the)126 2826 A
(super_user)420 2994 A
(can)126 3456 A
(change)252 3624 A
(its)126 3918 A
(time.)210 4086 A
4338(*/)S
4095 V
(28836)210 1122 A
1524(r)S
1608(=)S
(OK;)126 1692 A
4185 V
(28837)210 1122 A
1524(if)S
(\(rip->i_uid)462 1650 A
2154(!=)S
(fp->fp_effuid)546 2280 A
2868(&&)S
(!super_user\))504 2994 A
3540(r)S
3624(=)S
(EPERM;)252 3708 A
4275 V
(28838)210 1122 A
1524(if)S
(\(m_in.utime_length)756 1650 A
2448(==)S
2574(0)S
2658(&&)S
2784(r)S
2868(!=)S
(OK\))126 2994 A
3162(r)S
3246(=)S
(forbidden\(rip,)588 3330 A
(W_BIT\);)294 3960 A
4365 V
(28839)210 1122 A
1524(if)S
(\(read_only\(rip\))630 1650 A
2322(!=)S
(OK\))126 2448 A
2616(r)S
2700(=)S
(EROFS;)252 2784 A
3120(/*)S
(not)126 3246 A
(even)168 3414 A
3624(su)S
(can)126 3750 A
(touch)210 3918 A
4170(if)S
(R/O)126 4296 A
4464(*/)S
4455 V
(28840)210 1122 A
1524(if)S
1650(\(r)S
1776(==)S
(OK\))126 1902 A
2070({)S
4545 V
(28841)210 1122 A
1776(if)S
(\(m_in.utime_length)756 1902 A
2700(==)S
2826(0\))S
2952({)S
4635 V
(28842)210 1122 A
(rip->i_atime)504 2112 A
2658(=)S
(clock_time\(\);)546 2742 A
4725 V
(28843)210 1122 A
(rip->i_mtime)504 2112 A
2658(=)S
(rip->i_atime;)546 2742 A
4815 V
(28844)210 1122 A
1776(})S
(else)168 1860 A
2070({)S
4905 V
(28845)210 1122 A
(rip->i_atime)504 2112 A
2658(=)S
(m_in.utime_actime;)756 2742 A
4995 V
(28846)210 1122 A
(rip->i_mtime)504 2112 A
2658(=)S
(m_in.utime_modtime;)798 2742 A
5085 V
(28847)210 1122 A
1776(})S
5175 V
(28848)210 1122 A
(rip->i_update)546 1776 A
2364(=)S
(CTIME;)252 2448 A
2784(/*)S
(discard)294 2910 A
(any)126 3246 A
(stale)210 3414 A
(ATIME)210 3666 A
(and)126 3918 A
(MTIME)210 4086 A
(flags)210 4338 A
4590(*/)S
5265 V
(28849)210 1122 A
(rip->i_dirt)462 1776 A
2280(=)S
(DIRTY;)252 2364 A
5355 V
(28850)210 1122 A
1524(})S
5445 V
(28851)210 1122 A
5535 V
(28852)210 1122 A
(put_inode\(rip\);)630 1524 A
5625 V
(28853)210 1122 A
(return\(r\);)420 1524 A
5715 V
(28854)210 1122 A
1440(})S
5895 V
(28856)210 1122 A
(/*===========================================================================*)3276 1440 A
5985 V
(28857)210 1122 A
1482(*)S
(do_stime)336 2784 A
4674(*)S
6075 V
(28858)210 1122 A
(*===========================================================================*/)3276 1482 A
6165 V
(28859)210 1122 A
(PUBLIC)252 1440 A
(int)126 1734 A
(do_stime\(\))420 1902 A
6255 V
(28860)210 1122 A
1440({)S
6345 V
(28861)210 1122 A
1440(/*)S
(Perform)294 1566 A
(the)126 1902 A
(stime\(tp\))378 2070 A
(system)252 2490 A
(call.)210 2784 A
3036(*/)S
6435 V
(28862)210 1122 A
(boottime)336 1524 A
1902(=)S
(\(long\))252 1986 A
(m_in.pm_stime;)588 2280 A
6525 V
(28863)210 1122 A
(return\(OK\);)462 1524 A
6615 V
(28864)210 1122 A
1440(})S
8418 V
EP
%%Trailer
%%DocumentFonts: Times-Roman Times-Bold LucidaSans-Typewriter
%%Pages: 392
